{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "navigation.settings:\n  title: Navigation settings\n  description: 'Manage navigation settings.'\n  route_name: navigation.settings\n  parent: system.admin_config_ui\n\nnavigation_block.admin_display:\n  title: Navigation blocks\n  parent: system.admin_config_ui\n  description: 'Manage navigation blocks.'\n  route_name: layout_builder.navigation.view\n\n# Navigation User default links.\nnavigation.user_links.user.page:\n  title: 'View profile'\n  weight: -10\n  route_name: user.page\n  menu_name: navigation-user-links\nnavigation.user_links.user.edit:\n  title: 'Edit profile'\n  weight: 0\n  route_name: user.edit\n  menu_name: navigation-user-links\nnavigation.user_links.user.logout:\n  title: 'Log out'\n  weight: 10\n  route_name: user.logout\n  menu_name: navigation-user-links\n", "metadata": {"source": "repos/drupal_core/core/modules/navigation/navigation.links.menu.yml", "type": "yaml_reference", "topic": "navigation.links.menu"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FormUploadedFile\nSource file: <source_file>\nFile name hint: FormUploadedFile.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\file\\Upload;\n\nuse Drupal\\file\\Validation\\Constraint\\UploadedFileConstraint;\nuse Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\nuse Symfony\\Component\\Validator\\ConstraintViolationListInterface;\nuse Symfony\\Component\\Validator\\Validator\\ValidatorInterface;\n\n/**\n * Provides a bridge to Symfony UploadedFile.\n */\nclass FormUploadedFile implements UploadedFileInterface {\n\n  /**\n   * The wrapped uploaded file.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\File\\UploadedFile\n   */\n  protected $uploadedFile;\n\n  /**\n   * Creates a new FormUploadedFile.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\File\\UploadedFile $uploadedFile\n   *   The wrapped Symfony uploaded file.\n   */\n  public function __construct(UploadedFile $uploadedFile) {\n    $this->uploadedFile = $uploadedFile;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClientOriginalName(): string {\n    return $this->uploadedFile->getClientOriginalName();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSize(): int {\n    return $this->uploadedFile->getSize();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRealPath() {\n    return $this->uploadedFile->getRealPath();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPathname(): string {\n    return $this->uploadedFile->getPathname();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFilename(): string {\n    return $this->uploadedFile->getFilename();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(ValidatorInterface $validator, array $options = []): ConstraintViolationListInterface {\n    $constraint = new UploadedFileConstraint(...$options);\n    return $validator->validate($this->uploadedFile, $constraint);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\file\\Upload;\n\nuse Drupal\\file\\Validation\\Constraint\\UploadedFileConstraint;\nuse Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\nuse Symfony\\Component\\Validator\\ConstraintViolationListInterface;\nuse Symfony\\Component\\Validator\\Validator\\ValidatorInterface;\n\n/**\n * Provides a bridge to Symfony UploadedFile.\n */\nclass FormUploadedFile implements UploadedFileInterface {\n\n  /**\n   * The wrapped uploaded file.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\File\\UploadedFile\n   */\n  protected $uploadedFile;\n\n  /**\n   * Creates a new FormUploadedFile.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\File\\UploadedFile $uploadedFile\n   *   The wrapped Symfony uploaded file.\n   */\n  public function __construct(UploadedFile $uploadedFile) {\n    $this->uploadedFile = $uploadedFile;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClientOriginalName(): string {\n    return $this->uploadedFile->getClientOriginalName();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSize(): int {\n    return $this->uploadedFile->getSize();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRealPath() {\n    return $this->uploadedFile->getRealPath();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPathname(): string {\n    return $this->uploadedFile->getPathname();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFilename(): string {\n    return $this->uploadedFile->getFilename();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(ValidatorInterface $validator, array $options = []): ConstraintViolationListInterface {\n    $constraint = new UploadedFileConstraint(...$options);\n    return $validator->validate($this->uploadedFile, $constraint);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Upload/FormUploadedFile.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FormUploadedFile", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: IconDefinitionInterface\nSource file: <source_file>\nFile name hint: IconDefinitionInterface.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\Core\\Theme\\Icon;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Interface for icon definition.\n *\n * @internal\n *   This API is experimental.\n */\ninterface IconDefinitionInterface {\n\n  /**\n   * Create an icon definition.\n   *\n   * @param string $pack_id\n   *   The id of the icon pack.\n   * @param string $icon_id\n   *   The id of the icon.\n   * @param string $template\n   *   The icon template from definition.\n   * @param string|null $source\n   *   The source, url or path of the icon.\n   * @param string|null $group\n   *   The group of the icon.\n   * @param array $data\n   *   The additional data of the icon. Used by extractors to dynamically add\n   *   any needed value.\n   *\n   * @return self\n   *   The icon definition.\n   */\n  public static function create(\n    string $pack_id,\n    string $icon_id,\n    string $template,\n    ?string $source = NULL,\n    ?string $group = NULL,\n    array $data = [],\n  ): self;\n\n  /**\n   * Create an icon full id.\n   *\n   * @param string $pack_id\n   *   The id of the icon pack.\n   * @param string $icon_id\n   *   The id of the icon.\n   *\n   * @return string\n   *   The icon full id.\n   */\n  public static function createIconId(string $pack_id, string $icon_id): string;\n\n  /**\n   * Get icon id and pack id from an icon full id.\n   *\n   * @param string $icon_full_id\n   *   The id of the icon including the pack.\n   *\n   * @return array|null\n   *   The icon data as keyed with `pack_id` and `icon_id`.\n   */\n  public static function getIconDataFromId(string $icon_full_id): ?array;\n\n  /**\n   * Get the icon renderable element array.\n   *\n   * Shortcut to use icon element quickly without check if the icon id is valid,\n   * then the element will simply be empty.\n   *\n   * @param string $icon_full_id\n   *   The id of the icon including the pack.\n   * @param array $settings\n   *   Settings to pass to the renderable for context. Can be indexed by the\n   *   icon pack id for lookup.\n   *\n   * @return array|null\n   *   The icon renderable.\n   */\n  public static function getRenderable(string $icon_full_id, array $settings = []): ?array;\n\n  /**\n   * Get the icon label as human friendly.\n   *\n   * @return string\n   *   The icon label.\n   */\n  public function getLabel(): string;\n\n  /**\n   * Get the full icon id.\n   *\n   * @return string\n   *   The icon id as pack_id:icon_id.\n   */\n  public function getId(): string;\n\n  /**\n   * Get the icon id.\n   *\n   * @return string\n   *   The icon id as icon_id.\n   */\n  public function getIconId(): string;\n\n  /**\n   * Get the icon Pack id.\n   *\n   * @return string\n   *   The icon Pack id.\n   */\n  public function getPackId(): string;\n\n  /**\n   * Get the icon source, path or url.", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Theme\\Icon;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Interface for icon definition.\n *\n * @internal\n *   This API is experimental.\n */\ninterface IconDefinitionInterface {\n\n  /**\n   * Create an icon definition.\n   *\n   * @param string $pack_id\n   *   The id of the icon pack.\n   * @param string $icon_id\n   *   The id of the icon.\n   * @param string $template\n   *   The icon template from definition.\n   * @param string|null $source\n   *   The source, url or path of the icon.\n   * @param string|null $group\n   *   The group of the icon.\n   * @param array $data\n   *   The additional data of the icon. Used by extractors to dynamically add\n   *   any needed value.\n   *\n   * @return self\n   *   The icon definition.\n   */\n  public static function create(\n    string $pack_id,\n    string $icon_id,\n    string $template,\n    ?string $source = NULL,\n    ?string $group = NULL,\n    array $data = [],\n  ): self;\n\n  /**\n   * Create an icon full id.\n   *\n   * @param string $pack_id\n   *   The id of the icon pack.\n   * @param string $icon_id\n   *   The id of the icon.\n   *\n   * @return string\n   *   The icon full id.\n   */\n  public static function createIconId(string $pack_id, string $icon_id): string;\n\n  /**\n   * Get icon id and pack id from an icon full id.\n   *\n   * @param string $icon_full_id\n   *   The id of the icon including the pack.\n   *\n   * @return array|null\n   *   The icon data as keyed with `pack_id` and `icon_id`.\n   */\n  public static function getIconDataFromId(string $icon_full_id): ?array;\n\n  /**\n   * Get the icon renderable element array.\n   *\n   * Shortcut to use icon element quickly without check if the icon id is valid,\n   * then the element will simply be empty.\n   *\n   * @param string $icon_full_id\n   *   The id of the icon including the pack.\n   * @param array $settings\n   *   Settings to pass to the renderable for context. Can be indexed by the\n   *   icon pack id for lookup.\n   *\n   * @return array|null\n   *   The icon renderable.\n   */\n  public static function getRenderable(string $icon_full_id, array $settings = []): ?array;\n\n  /**\n   * Get the icon label as human friendly.\n   *\n   * @return string\n   *   The icon label.\n   */\n  public function getLabel(): string;\n\n  /**\n   * Get the full icon id.\n   *\n   * @return string\n   *   The icon id as pack_id:icon_id.\n   */\n  public function getId(): string;\n\n  /**\n   * Get the icon id.\n   *\n   * @return string\n   *   The icon id as icon_id.\n   */\n  public function getIconId(): string;\n\n  /**\n   * Get the icon Pack id.\n   *\n   * @return string\n   *   The icon Pack id.\n   */\n  public function getPackId(): string;\n\n  /**\n   * Get the icon source, path or url.\n   *\n   * @return string|null\n   *   The icon source.\n   */\n  public function getSource(): ?string;\n\n  /**\n   * Get the icon Group.\n   *\n   * @return string|null\n   *   The icon Group.\n   */\n  public function getGroup(): ?string;\n\n  /**\n   * Get the icon Twig template.\n   *\n   * @return string\n   *   The icon template.\n   */\n  public function getTemplate(): string;\n\n  /**\n   * Get the icon pack label.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null\n   *   The icon pack label.\n   */\n  public function getPackLabel(): ?TranslatableMarkup;\n\n  /**\n   * Get the icon Twig library.\n   *\n   * @return string|null\n   *   The icon library.\n   */\n  public function getLibrary(): ?string;\n\n  /**\n   * Get all icon data.\n   *\n   * Icon data is injected by extractors and can be used to set any values\n   * needed for the extractor loadIcon() method.\n   * The data is then injected in the Twig template of the icon.\n   *\n   * @return array\n   *   All the icon data.\n   */\n  public function getAllData(): array;\n\n  /**\n   * Get a specific icon data.\n   *\n   * @param string $key\n   *   The data key to retrieve.\n   *\n   * @return mixed\n   *   The icon specific data if exist or null. The data being added as an array\n   *   by extractors, there is no specific type enforced.\n   */\n  public function getData(string $key): mixed;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/Icon/IconDefinitionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "IconDefinitionInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class SkipOp in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold\\Operations;\n\nuse Composer\\IO\\IOInterface;\nuse Drupal\\Composer\\Plugin\\Scaffold\\ScaffoldFilePath;\nuse Drupal\\Composer\\Plugin\\Scaffold\\ScaffoldOptions;\n\n/**\n * Scaffold operation to skip a scaffold file (do nothing).\n *\n * @internal\n */\nclass SkipOp extends AbstractOperation {\n\n  /**\n   * Identifies Skip operations.\n   */\n  const ID = 'skip';\n\n  /**\n   * The message to output while processing.\n   *\n   * @var string\n   */\n  protected $message;\n\n  /**\n   * SkipOp constructor.\n   *\n   * @param string $message\n   *   (optional) A custom message to output while skipping.\n   */\n  public function __construct($message = \"  - Skip <info>[dest-rel-path]</info>: disabled\") {\n    $this->message = $message;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function generateContents() {\n    return '';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ScaffoldFilePath $destination, IOInterface $io, ScaffoldOptions $options) {\n    $interpolator = $destination->getInterpolator();\n    $io->write($interpolator->interpolate($this->message));\n    return new ScaffoldResult($destination, FALSE);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/Operations/SkipOp.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SkipOp", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class IsNullConstraint in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Constraints\\IsNull;\n\n/**\n * Null constraint.\n *\n * Overrides the symfony constraint to handle empty Typed Data structures.\n */\n#[Constraint(\n  id: 'Null',\n  label: new TranslatableMarkup('Null', [], ['context' => 'Validation']),\n  type: FALSE\n)]\nclass IsNullConstraint extends IsNull {}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Validation/Plugin/Validation/Constraint/IsNullConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "IsNullConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - api_normalization\n  theme:\n    - llm_platform_manager\nid: api_import_status\ntheme: llm_platform_manager\nregion: content\nweight: 0\nprovider: null\nplugin: 'api_normalization_status_block'\nsettings:\n  id: 'api_normalization_status_block'\n  label: 'API Import Status'\n  label_display: visible\n  provider: api_normalization\n  show_total_imports: true\n  show_successful_imports: true\n  show_failed_imports: true\n  show_pending_imports: true\n  refresh_interval: 30\nvisibility: {  }\n", "metadata": {"source": "repos/api_normalization/config/optional.disabled/block.block.api-import-status.yml", "type": "yaml_reference", "topic": "block.block.api-import-status"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DocumentLoaderPluginManager.php\nTarget symbol: class DocumentLoaderPluginManager\nNamespace: Drupal\\document_loader\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DocumentLoaderPluginManager.\n- Include required imports:\n  - Drupal\\Core\\Plugin\\DefaultPluginManager\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\Extension\\ModuleHandlerInterface\n  - Drupal\\document_loader\\Plugin\\DocumentLoaderInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getLoaderByType()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader;\n\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\document_loader\\Plugin\\DocumentLoaderInterface;\n\n/**\n * Plugin manager for document loader plugins.\n */\nclass DocumentLoaderPluginManager extends DefaultPluginManager {\n\n  /**\n   * Constructs a DocumentLoaderPluginManager object.\n   *\n   * @param \\Traversable<string,string> $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke hooks on.\n   */\n  public function __construct(\n    \\Traversable $namespaces,\n    CacheBackendInterface $cache_backend,\n    ModuleHandlerInterface $module_handler,\n  ) {\n    parent::__construct(\n      'Plugin/DocumentLoader',\n      $namespaces,\n      $module_handler,\n      'Drupal\\document_loader\\Plugin\\DocumentLoaderInterface',\n      'Drupal\\document_loader\\Attribute\\DocumentLoader',\n    );\n\n    $this->setCacheBackend($cache_backend, 'document_loader_plugins');\n    $this->alterInfo('document_loader_info');\n  }\n\n  /**\n   * Gets a document loader plugin by document loader type.\n   *\n   * @param string $document_loader_type\n   *   The document loader type ID.\n   * @param string|null $output_type\n   *   (optional) The desired output type ID.\n   *\n   * @return \\Drupal\\document_loader\\Plugin\\DocumentLoaderInterface|null\n   *   The document loader plugin, or NULL if not found.\n   */\n  public function getLoaderByType(string $document_loader_type, ?string $output_type = NULL): ?object {\n    foreach ($this->getDefinitions() as $plugin_id => $definition) {\n      if (in_array($document_loader_type, $definition['document_loader_types'] ?? [])) {\n        if ($output_type === NULL || in_array($output_type, $definition['output_types'] ?? [])) {\n          try {\n            $instance = $this->createInstance($plugin_id);\n            return $instance instanceof DocumentLoaderInterface ? $instance : NULL;\n          }\n          catch (\\Exception $e) {\n            continue;\n          }\n        }\n      }\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/document_loader/src/DocumentLoaderPluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DocumentLoaderPluginManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - ai_image_crop\nname: ai_image_crop_preview\nlabel: 'AI Image Crop Preview (512px)'\neffects:\n  ai_image_crop_scale:\n    uuid: ai_image_crop_scale\n    id: image_scale\n    weight: 0\n    data:\n      width: 512\n      height: 512\n      upscale: true\n", "metadata": {"source": "repos/ai_image_crop/config/install/image.style.ai_image_crop_preview.yml", "type": "yaml_reference", "topic": "image.style.ai image crop preview"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Updating Modules", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Extending Drupal](/docs/extending-drupal)\n\n* [Overview](/docs/extending-drupal/overview)\n* [Themes](/docs/extending-drupal/themes)\n* [Contributed modules](/docs/extending-drupal/contributed-modules)\n* [Drupal Recipes](/docs/extending-drupal/drupal-recipes)\n* [Installing Modules](/docs/extending-drupal/installing-modules)\n* [Installing modules' Composer dependencies](/docs/extending-drupal/installing-modules-composer-dependencies)\n* [Updating Modules](/docs/extending-drupal/updating-modules)\n* [Module Configuration](/docs/extending-drupal/module-configuration)\n* [Module Documentation and Help](/docs/extending-drupal/module-documentation-and-help)\n* [Uninstalling Modules](/docs/extending-drupal/uninstalling-modules)\n* [Installing Sandbox Modules](/docs/extending-drupal/installing-sandbox-modules)\n\n# Updating Modules\n\nLast [updated](/node/2845608/discuss) on\n\n5 December 2021\n\nMost contributed modules will receive periodic updates that fix security issues, fix issues with the module's functionality, add new features, or all three. It's a good idea to regularly check for new versions of the module's you're using and update them when newer versions are released.\n\nThe process of updating a module is very well described in the User Guide - read [chapter 13.6: \"Updating A Module](https://www.drupal.org/docs/user_guide/en/security-update-module.html)\".\n\nIf you are using Composer to manage your site, read [3.5. Using Composer to Download and Update Files](https://www.drupal.org/docs/user_guide/en/install-composer.html).\n\n## Related Content\n\n## [13.6. Updating a Module](/docs/user_guide/en/security-update-module.html)\n\nHow to update a contributed module using Composer and the administrative\ninterface for running the Database Updates script.\n\n## [Updating Drupal](/docs/updating-drupal)\n\nUpgrading your site between Drupal minor versions.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2845608/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282845608%29%20Updating%20Modules) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/extending-drupal/updating-modules.md", "type": "doc_summary", "topic": "Updating Modules"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: AI Revision Assistant", "input": "", "output": "# AI Revision Assistant\n\nUnderstand what changed in your content revisions using AI-powered analysis.\n\n## What Does It Do?\n\nInstead of reading through every text change, this module uses AI to tell you:\n- **What changed** in plain English\n- **Why it matters** (tone shifts, facts added/removed)\n- **Any problems** (missing alt text, removed SEO tags)\n- **What to do** (keep, revert, or merge changes)\n\n## Quick Start\n\n### 1. Install\n```bash\ndrush en ai_revision_assistant -y\n```\n\n### 2. Configure\nGo to **Configuration > AI > Revision Assistant** and set:\n- How many recent revisions to analyze (default: 5)\n- Which problems to check for\n- Whether to analyze automatically when saving\n\n### 3. Use It\nOn any content with multiple revisions:\n- Click **\"Revisions\"** tab\n- Click **\"AI Summary\"** button\n- Read the AI analysis\n\n## Features\n\n**Smart Summaries** - AI explains changes in human language\n**Problem Detection** - Catches missing alt text, SEO issues, content loss\n**Cost Efficient** - Caches results, only analyzes recent revisions\n**Easy Access** - Button on revisions page, link in content operations\n\n## Settings\n\n**Configuration > AI > Revision Assistant**\n\n- **Revision depth**: How many recent revisions to analyze (2-50, default: 5)\n- **Auto-analyze**: Analyze automatically when saving content\n- **Problem checks**: Choose which issues to detect\n\n## Requirements\n\n- Drupal 10 or 11\n- [Drupal AI](https://www.drupal.org/project/ai) module\n- An AI provider (OpenAI, Anthropic, Gemini, etc.) configured\n", "metadata": {"source": "repos/ai_revision_assistant/README.md", "type": "doc_summary", "topic": "AI Revision Assistant"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  php:\n    # Specify the version of Drupal you wish to use for Tugboat below.\n    image: tugboatqa/drupal:11\n    default: true\n    http: false\n    depends: mysql\n    commands:\n      update: |\n        set -eux\n        # This is an environment variable we added in the Dockerfile that\n        # provides the path to Drupal composer root (not the web root).\n        cd $DRUPAL_COMPOSER_ROOT\n        # We need to change the minimum stability to dev to use the path\n        composer config minimum-stability dev\n        # We configure the Drupal project to use the checkout of the module as a\n        # Composer package repository.\n        composer config repositories.tugboat path $TUGBOAT_ROOT\n        # Now we can require this module\n        composer require drupal/oembed_formatter_plus\n        # Install Drupal on the site.\n        vendor/bin/drush \\\n          --yes \\\n          --db-url=mysql://tugboat:tugboat@mysql:3306/tugboat \\\n          --site-name=\"Live preview for ${TUGBOAT_PREVIEW_NAME}\" \\\n          --account-pass=admin \\\n          site:install standard\n        # Add tugboat URLs to the Drupal trusted host patterns.\n        echo \"\\$settings['trusted_host_patterns'] = ['\\.tugboatqa\\.com\\$'];\" >> $DOCROOT/sites/default/settings.php\n        # Set up the files directory permissions.\n        mkdir -p $DRUPAL_DOCROOT/sites/default/files\n        chgrp -R www-data $DRUPAL_DOCROOT/sites/default/files\n        chmod 2775 $DRUPAL_DOCROOT/sites/default/files\n        chmod -R g+w $DRUPAL_DOCROOT/sites/default/files\n        # Enable the module.\n        vendor/bin/drush --yes pm:enable oembed_formatter_plus\n      build: |\n        set -eux\n        cd $DRUPAL_COMPOSER_ROOT\n        composer install --optimize-autoloader\n        # Update this module, including all dependencies.\n        composer update drupal/oembed_formatter_plus --with-all-dependencies\n        vendor/bin/drush --yes updb\n        vendor/bin/drush cache:rebuild\n  mysql:\n    image: tugboatqa/mariadb\n", "metadata": {"source": "repos/oembed_formatter_plus/.tugboat/config.yml", "type": "yaml_reference", "topic": "config"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EbExtensionInterface.php\nTarget symbol: interface EbExtensionInterface\nNamespace: Drupal\\eb\\PluginInterfaces\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for EbExtensionInterface.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\PluginInspectionInterface\n- Ensure these methods exist where relevant:\n  - appliesTo()\n  - buildOperations()\n  - checkDependencies()\n  - detectChanges()\n  - extractConfig()\n  - getOperationDependencies()\n  - getOperations()\n  - getYamlKeys()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\eb\\PluginInterfaces;\n\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\n\n/**\n * Interface for Entity Builder Extension plugins.\n *\n * Extensions integrate contrib modules (field_group, pathauto, etc.) with\n * Entity Builder's definition-centric workflow:\n *\n * 1. YAML/UI \u2192 EbDefinition (stores extension's definitions)\n * 2. On Apply \u2192 buildOperations() converts definitions \u2192 operations\n * 3. Operations \u2192 Validate \u2192 Execute\n *\n * Required method: buildOperations()\n * Optional methods: getOperationDependencies(), detectChanges(),\n *                   checkDependencies(), extractConfig()\n *\n * @see \\Drupal\\eb\\Attribute\\EbExtension\n * @see \\Drupal\\eb\\PluginBase\\EbExtensionBase\n */\ninterface EbExtensionInterface extends PluginInspectionInterface {\n\n  /**\n   * Builds operations from definition data.\n   *\n   * This is the PRIMARY method extensions must implement. It converts\n   * definition data (from EbDefinition entity) into operation\n   * arrays for validation and execution.\n   *\n   * @param array<string, mixed> $data\n   *   Full definition data array containing all definition keys such as\n   *   bundle_definitions, field_definitions, field_group_definitions, etc.\n   *\n   * @return array<int, array<string, mixed>>\n   *   Array of operation data arrays for this extension's domain.\n   *   Each operation must contain 'operation' key with operation ID.\n   *   Return empty array if no operations to contribute.\n   */\n  public function buildOperations(array $data): array;\n\n  /**\n   * Gets dependencies for an operation.\n   *\n   * Override to declare what entities an operation depends on.\n   * Dependencies determine operation execution order via topological sort.\n   *\n   * @param array $operation\n   *   Operation data array with 'operation' key and operation-specific data.\n   * @param array $context\n   *   Context with 'all_operations' containing all operations for reference.\n   *\n   * @return array\n   *   Dependency keys (e.g., ['bundle:node:article', 'field:...']).\n   */\n  public function getOperationDependencies(array $operation, array $context): array;\n\n  /**\n   * Detects whether operation should create, update, or skip.\n   *\n   * Override to implement change detection for sync mode. Compares operation\n   * data against current Drupal state to determine appropriate action.\n   *\n   * @param array $operation\n   *   Operation data array.\n   * @param array $context\n   *   Context with metadata.\n   *\n   * @return string|null\n   *   One of:\n   *   - 'create_*': Create operation (e.g., 'create_field_group').\n   *   - 'update_*': Update operation (e.g., 'update_field_group').\n   *   - 'skip': Already exists and unchanged.\n   *   - NULL: Defer to core change detection.\n   */\n  public function detectChanges(array $operation, array $context): ?string;\n\n  /**\n   * Checks if custom dependency types exist in Drupal.\n   *\n   * Override to verify extension-specific entities exist during dependency\n   * resolution. Only needed if extension declares custom dependency types.\n   *\n   * @param array $dependencyKeys\n   *   Dependency keys to check (e.g., ['field_group:node:...:group_content']).\n   *\n   * @return array\n   *   Keyed array: dependency_key => exists (bool).\n   *   Return empty array for keys this extension doesn't handle.\n   */\n  public function checkDependencies(array $dependencyKeys): array;\n\n  /**\n   * Checks if this extension applies to an operation.\n   *\n   * Used to route operations to the correct extension for dependency\n   * resolution and change detection.\n   *\n   * @param array $operation\n   *   Operation data array with 'operation' key.\n   *\n   * @return bool\n   *   TRUE if this extension handles this operation type.\n   */\n  public function appliesTo(array $operation): bool;\n\n  /**\n   * Gets the YAML definition keys this extension handles.\n   *\n   * These keys are stored in EbDefinition and passed to\n   * buildOperations(). Defined in the plugin attribute.\n   *\n   * @return array\n   *   Array of YAML keys (e.g., ['field_group_definitions']).\n   */\n  public function getYamlKeys(): array;\n\n  /**\n   * Gets the operation types this extension provides.\n   *\n   * Used by appliesTo() to match operations. Defined in the plugin attribute.\n   *\n   * @return array\n   *   Array of operation IDs (e.g., ['create_field_group', '...']).\n   */\n  public function getOperations(): array;\n\n  /**\n   * Extracts configuration from an existing Drupal bundle.\n   *\n   * Used by export/generate features to extract extension-specific\n   * configuration from Drupal into definition format.\n   *\n   * @param string $entityTypeId\n   *   The entity type ID (e.g., 'node', 'taxonomy_term').\n   * @param string $bundle\n   *   The bundle machine name (e.g., 'article', 'tags').\n   *\n   * @return array<string, mixed>\n   *   Configuration data keyed by definition type (e.g.,\n   *   ['field_group_definitions' => [...]]).\n   *   Return empty array if no configuration to extract.\n   */\n  public function extractConfig(string $entityTypeId, string $bundle): array;\n\n}\n", "metadata": {"source": "repos/eb/src/PluginInterfaces/EbExtensionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EbExtensionInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class GrantCa3TextFormatPermissions in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\govcms_ca3_consumer_helper\\Plugin\\ConfigAction;\n\nuse Drupal\\Core\\Config\\Action\\Attribute\\ConfigAction;\nuse Drupal\\Core\\Config\\Action\\ConfigActionException;\nuse Drupal\\Core\\Config\\Action\\ConfigActionPluginInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Grants CA3 text format permissions to roles with media permissions.\n *\n * This config action identifies roles with media-related permissions and grants\n * them permission to use the CA3 text format. This ensures content authors can\n * edit CA3 media fields that use the ca3_format text format.\n *\n * @internal\n */\n#[ConfigAction(\n  id: 'grantCa3TextFormatPermissions',\n  admin_label: new TranslatableMarkup('Grant CA3 text format permissions'),\n)]\nfinal class GrantCa3TextFormatPermissions implements ConfigActionPluginInterface, ContainerFactoryPluginInterface {\n\n  use RoleMediaPermissionsTrait;\n\n  /**\n   * Constructs a GrantCa3TextFormatPermissions object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger service.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('logger.factory')->get('govcms_ca3_consumer_helper'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function apply(string $configName, mixed $value): void {\n    if (!is_array($value)) {\n      throw new ConfigActionException('The grantCa3TextFormatPermissions action requires an array of text format permissions.');\n    }\n\n    $role_storage = $this->entityTypeManager->getStorage('user_role');\n    $this->grantPermissionsToRoles(\n      $role_storage,\n      $value,\n      $this->logger,\n      'Granted CA3 text format permissions to role \"@role\": @permissions',\n    );\n  }\n\n}\n", "metadata": {"source": "repos/govcms_ca3_consumer_helper/src/Plugin/ConfigAction/GrantCa3TextFormatPermissions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GrantCa3TextFormatPermissions", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: EventBroadcaster\nSource file: <source_file>\nFile name hint: EventBroadcaster.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\RealTime;\n\nuse Psr\\Log\\LoggerInterface;\nuse Drupal\\flowdrop_runtime\\DTO\\RealTime\\RealTimeEvent;\nuse Drupal\\Core\\Logger\\LoggerChannelFactoryInterface;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Symfony\\Component\\EventDispatcher\\GenericEvent;\n\n/**\n * Broadcasts real-time events to connected clients.\n */\nclass EventBroadcaster {\n\n  /**\n   * Logger channel for this service.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  private readonly LoggerInterface $logger;\n\n  public function __construct(\n    LoggerChannelFactoryInterface $loggerFactory,\n    private readonly EventDispatcherInterface $eventDispatcher,\n  ) {\n    $this->logger = $loggerFactory->get('flowdrop_runtime');\n  }\n\n  /**\n   * Broadcast a real-time event.\n   */\n  public function broadcast(RealTimeEvent $event): void {\n    // Ensure all log values are strings to prevent Html::escape() errors.\n    // Convert to string to handle any edge cases where values might be null.\n    $type = (string) $event->getType();\n    $eventName = (string) $event->getEvent();\n    $executionId = (string) $event->getExecutionId();\n    $nodeId = $event->getNodeId() !== NULL ? (string) $event->getNodeId() : \"\";\n\n    $this->logger->debug('Broadcasting real-time event: @type:@event for @execution_id', [\n      '@type' => $type,\n      '@event' => $eventName,\n      '@execution_id' => $executionId,\n    ]);\n\n    // Dispatch Drupal event for other modules to listen to.\n    $drupalEvent = new GenericEvent($event, [\n      'type' => $event->getType(),\n      'execution_id' => $event->getExecutionId(),\n      'event' => $event->getEvent(),\n      'data' => $event->getData(),\n      'timestamp' => $event->getTimestamp(),\n      'node_id' => $event->getNodeId(),\n    ]);\n\n    $this->eventDispatcher->dispatch($drupalEvent, 'flowdrop_runtime.real_time_event');\n\n    // Log the event for debugging.\n    $this->logger->info('Real-time event broadcasted: @type:@event', [\n      '@type' => $type,\n      '@event' => $eventName,\n      '@execution_id' => $executionId,\n      '@node_id' => $nodeId,\n    ]);\n  }\n\n  /**\n   * Broadcast execution started event.\n   */\n  public function broadcastExecutionStarted(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'started',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast execution completed event.\n   */\n  public function broadcastExecutionCompleted(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'completed',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast execution failed event.\n   */\n  public function broadcastExecutionFailed(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'failed',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node started event.\n   */\n  public function broadcastNodeStarted(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\RealTime;\n\nuse Psr\\Log\\LoggerInterface;\nuse Drupal\\flowdrop_runtime\\DTO\\RealTime\\RealTimeEvent;\nuse Drupal\\Core\\Logger\\LoggerChannelFactoryInterface;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Symfony\\Component\\EventDispatcher\\GenericEvent;\n\n/**\n * Broadcasts real-time events to connected clients.\n */\nclass EventBroadcaster {\n\n  /**\n   * Logger channel for this service.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  private readonly LoggerInterface $logger;\n\n  public function __construct(\n    LoggerChannelFactoryInterface $loggerFactory,\n    private readonly EventDispatcherInterface $eventDispatcher,\n  ) {\n    $this->logger = $loggerFactory->get('flowdrop_runtime');\n  }\n\n  /**\n   * Broadcast a real-time event.\n   */\n  public function broadcast(RealTimeEvent $event): void {\n    // Ensure all log values are strings to prevent Html::escape() errors.\n    // Convert to string to handle any edge cases where values might be null.\n    $type = (string) $event->getType();\n    $eventName = (string) $event->getEvent();\n    $executionId = (string) $event->getExecutionId();\n    $nodeId = $event->getNodeId() !== NULL ? (string) $event->getNodeId() : \"\";\n\n    $this->logger->debug('Broadcasting real-time event: @type:@event for @execution_id', [\n      '@type' => $type,\n      '@event' => $eventName,\n      '@execution_id' => $executionId,\n    ]);\n\n    // Dispatch Drupal event for other modules to listen to.\n    $drupalEvent = new GenericEvent($event, [\n      'type' => $event->getType(),\n      'execution_id' => $event->getExecutionId(),\n      'event' => $event->getEvent(),\n      'data' => $event->getData(),\n      'timestamp' => $event->getTimestamp(),\n      'node_id' => $event->getNodeId(),\n    ]);\n\n    $this->eventDispatcher->dispatch($drupalEvent, 'flowdrop_runtime.real_time_event');\n\n    // Log the event for debugging.\n    $this->logger->info('Real-time event broadcasted: @type:@event', [\n      '@type' => $type,\n      '@event' => $eventName,\n      '@execution_id' => $executionId,\n      '@node_id' => $nodeId,\n    ]);\n  }\n\n  /**\n   * Broadcast execution started event.\n   */\n  public function broadcastExecutionStarted(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'started',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast execution completed event.\n   */\n  public function broadcastExecutionCompleted(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'completed',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast execution failed event.\n   */\n  public function broadcastExecutionFailed(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'failed',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node started event.\n   */\n  public function broadcastNodeStarted(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',\n      executionId: $executionId,\n      event: 'started',\n      data: $data,\n      timestamp: time(),\n      nodeId: $nodeId,\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node completed event.\n   */\n  public function broadcastNodeCompleted(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',\n      executionId: $executionId,\n      event: 'completed',\n      data: $data,\n      timestamp: time(),\n      nodeId: $nodeId,\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node failed event.\n   */\n  public function broadcastNodeFailed(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',\n      executionId: $executionId,\n      event: 'failed',\n      data: $data,\n      timestamp: time(),\n      nodeId: $nodeId,\n    );\n\n    $this->broadcast($event);\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/RealTime/EventBroadcaster.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EventBroadcaster", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: GenerateEntityNode.php\nTarget symbol: class GenerateEntityNode\nNamespace: Drupal\\api_normalization\\Plugin\\FlowDrop\\NodeHandler\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for GenerateEntityNode.\n- Include required imports:\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - create()\n  - defaultConfiguration()\n  - execute()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\FlowDrop\\NodeHandler;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * FlowDrop node handler for entity generation.\n *\n * @FlowDropNodeHandler(\n *   id = \"generate_entity\",\n *   label = @Translation(\"Generate Entity\"),\n *   description = @Translation(\"Generates Drupal entities from normalized data\")\n * )\n */\nclass GenerateEntityNode extends NodeHandlerBase implements\n  ContainerFactoryPluginInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return [\n      'entity_type' => 'node',\n      'bundle' => 'default',\n      'field_mappings' => [],\n    ] + parent::defaultConfiguration();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(array $data, array $context): array {\n    $inputData = $data['input'] ?? $context['transformed'] ?? [];\n    $entityType = $data['entity_type'] ?? $this->configuration['entity_type'] ?? 'node';\n    $bundle = $data['bundle'] ?? $this->configuration['bundle'] ?? 'default';\n    $fieldMappings = $data['field_mappings'] ?? $this->configuration['field_mappings'] ?? [];\n\n    if (empty($inputData)) {\n      return [\n        'error' => 'No input data provided',\n        'output' => [],\n      ];\n    }\n\n    // Use entity generator.\n    $entityGenerator = \\Drupal::service('api_normalization.entity_generator');\n    $entityMapper = \\Drupal::service('api_normalization.entity_mapper');\n\n    // Map fields.\n    $mappedData = $entityMapper->mapFields($inputData, $fieldMappings);\n\n    // Ensure entity type and bundle exist.\n    $entityTypeInfo = $entityGenerator->ensureEntityType($entityType, ucfirst($entityType), 'Generated from API Normalizer');\n    $entityGenerator->createBundle($entityType, $bundle, ucfirst($bundle), []);\n\n    // Create entity.\n    $entityTypeManager = \\Drupal::entityTypeManager();\n    $storage = $entityTypeManager->getStorage($entityType);\n    $entity = $storage->create(array_merge(['type' => $bundle], $mappedData));\n    $entity->save();\n\n    return [\n      'output' => [\n        'entity_id' => $entity->id(),\n        'entity_type' => $entityType,\n        'bundle' => $bundle,\n      ],\n      'entity' => $entity,\n      'entity_id' => $entity->id(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/FlowDrop/NodeHandler/GenerateEntityNode.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GenerateEntityNode", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: RestrictionPluginConfigForm.php\nTarget symbol: class RestrictionPluginConfigForm\nNamespace: Drupal\\layout_builder_restrictions\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for RestrictionPluginConfigForm.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigManager\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\layout_builder_restrictions\\Plugin\\LayoutBuilderRestrictionManager\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildForm()\n  - create()\n  - getEditableConfigNames()\n  - getFormId()\n  - submitForm()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\layout_builder_restrictions\\Form;\n\nuse Drupal\\Core\\Config\\ConfigManager;\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\layout_builder_restrictions\\Plugin\\LayoutBuilderRestrictionManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * The form for the restriction plugin.\n */\nclass RestrictionPluginConfigForm extends ConfigFormBase {\n\n  /**\n   * The UI for managing Layout Builder Restrictions Plugins.\n   *\n   * @var \\Drupal\\layout_builder_restrictions\\Plugin\\LayoutBuilderRestrictionManager\n   */\n  protected $pluginManagerLayoutBuilderRestriction;\n  /**\n   * Drupal\\Core\\Config\\ConfigManager definition.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigManager\n   */\n  protected $configManager;\n\n  /**\n   * Constructs a new RestrictionPluginConfigForm object.\n   */\n  public function __construct(\n    LayoutBuilderRestrictionManager $plugin_manager_layout_builder_restriction,\n    ConfigManager $config_manager,\n  ) {\n    $this->pluginManagerLayoutBuilderRestriction = $plugin_manager_layout_builder_restriction;\n    $this->configManager = $config_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('plugin.manager.layout_builder_restriction'),\n      $container->get('config.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'restriction_plugin_config_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $plugin_list = $this->pluginManagerLayoutBuilderRestriction->getSortedPlugins(TRUE);\n\n    $form['plugin-table'] = [\n      '#type' => 'table',\n      '#header' => [\n        $this->t('Plugin'),\n        $this->t('ID'),\n        $this->t('Enabled'),\n        $this->t('Weight'),\n      ],\n      '#empty' => $this->t('There are no restriction plugins defined.'),\n      // TableDrag: Each array value is a list of callback arguments for\n      // drupal_add_tabledrag().\n      '#tabledrag' => [\n        [\n          'action' => 'order',\n          'relationship' => 'sibling',\n          'group' => 'plugin-table-order-weight',\n        ],\n      ],\n      '#prefix' => '<p>Set the order of Layout Builder Restriction plugin execution, and enable or disable as needed.</p>',\n    ];\n    // Build the table rows and columns.\n    // The first nested level in the render array forms the table row,\n    // on which you likely want to set #attributes and #weight.\n    foreach ($plugin_list as $id => $data) {\n      // TableDrag: Mark the table row as draggable.\n      $form['plugin-table'][$id]['#attributes']['class'][] = 'draggable';\n      // Sort the row according to its existing/configured weight.\n      $form['plugin-table'][$id]['#weight'] = $data['weight'];\n      if ($data['description']) {\n        $form['plugin-table'][$id]['title'] = [\n          '#markup' => '<strong>' . $data['title'] . '</strong><br>' . $data['description'],\n        ];\n      }\n      else {\n        $form['plugin-table'][$id]['title'] = [\n          '#markup' => '<strong>' . $data['title'] . '</strong>',\n        ];\n      }\n      $form['plugin-table'][$id]['id'] = [\n        '#plain_text' => $id,\n      ];\n      $form['plugin-table'][$id]['enabled'] = [\n        '#type' => 'checkbox',\n        '#title' => $this->t('Enabled'),\n        '#title_display' => 'invisible',\n        '#default_value' => $data['enabled'],\n        // Classify the weight element for #tabledrag.\n        '#attributes' => ['class' => ['plugin-table-enabled']],\n      ];\n      // TableDrag: Weight column element.\n      $form['plugin-table'][$id]['weight'] = [\n        '#type' => 'weight',\n        '#title' => $this->t('Weight for @title', ['@title' => $id]),\n        '#title_display' => 'invisible',\n        '#default_value' => $data['weight'],\n        // Classify the weight element for #tabledrag.\n        '#attributes' => ['class' => ['plugin-table-order-weight']],\n      ];\n\n    }\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $data_to_save = [];\n    $restriction_definitions = $this->pluginManagerLayoutBuilderRestriction->getDefinitions();\n    foreach ($form_state->getValue('plugin-table') as $plugin_id => $vals) {\n      // Verify we have a registered plugin key.\n      if (isset($restriction_definitions[$plugin_id])) {\n        $data_to_save[$plugin_id] = [\n          'weight' => (int) $vals['weight'],\n          'enabled' => (bool) $vals['enabled'],\n        ];\n      }\n    }\n    // Save config.\n    $plugin_weighting_config = $this->configFactory()->getEditable('layout_builder_restrictions.plugins');\n    $plugin_weighting_config->set('plugin_config', $data_to_save);\n    $plugin_weighting_config->save();\n  }\n\n}\n", "metadata": {"source": "repos/layout_builder_restrictions/src/Form/RestrictionPluginConfigForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RestrictionPluginConfigForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: MenuTreeHierarchyConstraintValidator\nSource file: <source_file>\nFile name hint: MenuTreeHierarchyConstraintValidator.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\menu_link_content\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * Constraint validator for changing menu link parents in pending revisions.\n */\nclass MenuTreeHierarchyConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  private $entityTypeManager;\n\n  /**\n   * Creates a new MenuTreeHierarchyConstraintValidator instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager) {\n    $this->entityTypeManager = $entity_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($entity, Constraint $constraint): void {\n    if ($entity && !$entity->isNew() && !$entity->isDefaultRevision()) {\n      $original = $this->entityTypeManager->getStorage($entity->getEntityTypeId())->loadUnchanged($entity->id());\n\n      // Ensure that empty items do not affect the comparison checks below.\n      // @todo Remove this filtering when\n      //   https://www.drupal.org/project/drupal/issues/3039031 is fixed.\n      $entity->parent->filterEmptyItems();\n      if (($entity->parent->isEmpty() !== $original->parent->isEmpty()) || !$entity->parent->equals($original->parent)) {\n        $this->context->buildViolation($constraint->message)\n          ->atPath('menu_parent')\n          ->addViolation();\n      }\n      if (!$entity->weight->equals($original->weight)) {\n        $this->context->buildViolation($constraint->message)\n          ->atPath('weight')\n          ->addViolation();\n      }\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\menu_link_content\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * Constraint validator for changing menu link parents in pending revisions.\n */\nclass MenuTreeHierarchyConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  private $entityTypeManager;\n\n  /**\n   * Creates a new MenuTreeHierarchyConstraintValidator instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager) {\n    $this->entityTypeManager = $entity_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($entity, Constraint $constraint): void {\n    if ($entity && !$entity->isNew() && !$entity->isDefaultRevision()) {\n      $original = $this->entityTypeManager->getStorage($entity->getEntityTypeId())->loadUnchanged($entity->id());\n\n      // Ensure that empty items do not affect the comparison checks below.\n      // @todo Remove this filtering when\n      //   https://www.drupal.org/project/drupal/issues/3039031 is fixed.\n      $entity->parent->filterEmptyItems();\n      if (($entity->parent->isEmpty() !== $original->parent->isEmpty()) || !$entity->parent->equals($original->parent)) {\n        $this->context->buildViolation($constraint->message)\n          ->atPath('menu_parent')\n          ->addViolation();\n      }\n      if (!$entity->weight->equals($original->weight)) {\n        $this->context->buildViolation($constraint->message)\n          ->atPath('weight')\n          ->addViolation();\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/menu_link_content/src/Plugin/Validation/Constraint/MenuTreeHierarchyConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MenuTreeHierarchyConstraintValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Field Layout'\ntype: module\ndescription: 'Allows users to configure the display and form display by arranging fields in several columns.'\npackage: Core (Experimental)\nlifecycle: deprecated\nlifecycle_link: https://www.drupal.org/node/3223395#s-field-layout\nversion: VERSION\ndependencies:\n  - drupal:layout_discovery\n", "metadata": {"source": "repos/drupal_core/core/modules/field_layout/field_layout.info.yml", "type": "yaml_reference", "topic": "field layout.info"}}
{"instruction": "Show me the implementation of the class BlockVisibility in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block\\Plugin\\migrate\\process;\n\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateLookupInterface;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\MigrateSkipRowException;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Determines the visibility for a block.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess('block_visibility')]\nclass BlockVisibility extends ProcessPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   */\n  protected $moduleHandler;\n\n  /**\n   * The migrate lookup service.\n   *\n   * @var \\Drupal\\migrate\\MigrateLookupInterface\n   */\n  protected $migrateLookup;\n\n  /**\n   * Whether or not to skip blocks that use PHP for visibility.\n   *\n   * Only applies if the PHP module is not enabled.\n   *\n   * @var bool\n   */\n  protected $skipPHP = FALSE;\n\n  /**\n   * Constructs a BlockVisibility object.\n   *\n   * @param array $configuration\n   *   The plugin configuration.\n   * @param string $plugin_id\n   *   The plugin ID.\n   * @param mixed $plugin_definition\n   *   The plugin definition.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler service.\n   * @param \\Drupal\\migrate\\MigrateLookupInterface $migrate_lookup\n   *   The migrate lookup service.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, ModuleHandlerInterface $module_handler, MigrateLookupInterface $migrate_lookup) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->moduleHandler = $module_handler;\n    $this->migrateLookup = $migrate_lookup;\n\n    if (isset($configuration['skip_php'])) {\n      $this->skipPHP = $configuration['skip_php'];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    [$old_visibility, $pages, $roles] = $value;\n\n    $visibility = [];\n\n    // If the block is assigned to specific roles, add the user_role condition.\n    if ($roles) {\n      $visibility['user_role'] = [\n        'id' => 'user_role',\n        'roles' => [],\n        'context_mapping' => [\n          'user' => '@user.current_user_context:current_user',\n        ],\n        'negate' => FALSE,\n      ];\n      // Legacy generated migrations will not have the destination property\n      // '_role_ids'.\n      $role_ids = $row->getDestinationProperty('_role_ids');\n      foreach ($roles as $key => $role_id) {\n        if (!$role_ids) {\n          $lookup = $this->migrateLookup->lookup(['d6_user_role', 'd7_user_role'], [$role_id]);\n          $lookup_result = $lookup[0]['id'];\n        }\n        else {\n          $lookup_result = $role_ids[$role_id] ?? NULL;\n        }\n        if ($lookup_result) {\n          $roles[$key] = $lookup_result;\n        }\n      }\n\n      $visibility['user_role']['roles'] = array_combine($roles, $roles);\n    }\n\n    if ($pages) {\n      // 2 == BLOCK_VISIBILITY_PHP in Drupal 6 and 7.\n      if ($old_visibility == 2) {\n        // If the PHP module is present, migrate the visibility code unaltered.\n        if ($this->moduleHandler->moduleExists('php')) {\n          $visibility['php'] = [\n            'id' => 'php',\n            // PHP code visibility could not be negated in Drupal 6 or 7.\n            'negate' => FALSE,\n            'php' => $pages,\n          ];\n        }\n        // Skip the row if we're configured to. If not, we don't need to do\n        // anything else -- the block will simply have no PHP or request_path\n        // visibility configuration.\n        elseif ($this->skipPHP) {\n          throw new MigrateSkipRowException(sprintf(\"The block with bid '%d' from module '%s' will have no PHP or request_path visibility configuration.\", $row->getSourceProperty('bid'), $row->getSourceProperty('module')));\n        }\n      }\n      else {\n        $paths = preg_split(\"(\\r\\n?|\\n)\", $pages);\n        foreach ($paths as $key => $path) {\n          $paths[$key] = $path === '<front>' ? $path : '/' . ltrim($path, '/');\n        }\n        $visibility['request_path'] = [\n          'id' => 'request_path',\n          'negate' => !$old_visibility,\n          'pages' => implode(\"\\n\", $paths),\n        ];\n      }\n    }\n\n    return $visibility;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block/src/Plugin/migrate/process/BlockVisibility.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockVisibility", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LinkHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\link\\Hook;\n\nuse Drupal\\Core\\Field\\FieldTypeCategoryManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for link.\n */\nclass LinkHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.link':\n        $output = '';\n        $output .= '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The Link module allows you to create fields that contain internal or external URLs and optional link text. See the <a href=\":field\">Field module help</a> and the <a href=\":field_ui\">Field UI help</a> pages for general information on fields and how to create and manage them. For more information, see the <a href=\":link_documentation\">online documentation for the Link module</a>.', [\n          ':field' => Url::fromRoute('help.page', [\n            'name' => 'field',\n          ])->toString(),\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n          ':link_documentation' => 'https://www.drupal.org/documentation/modules/link',\n        ]) . '</p>';\n        $output .= '<h2>' . $this->t('Uses') . '</h2>';\n        $output .= '<dl>';\n        $output .= '<dt>' . $this->t('Managing and displaying link fields') . '</dt>';\n        $output .= '<dd>' . $this->t('The <em>settings</em> and the <em>display</em> of the link field can be configured separately. See the <a href=\":field_ui\">Field UI help</a> for more information on how to manage fields and their display.', [\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n        ]) . '</dd>';\n        $output .= '<dt>' . $this->t('Setting the allowed link type') . '</dt>';\n        $output .= '<dd>' . $this->t('In the field settings you can define the allowed link type to be <em>internal links only</em>, <em>external links only</em>, or <em>both internal and external links</em>. <em>Internal links only</em> and <em>both internal and external links</em> options enable an autocomplete widget for internal links, so a user does not have to copy or remember a URL.') . '</dd>';\n        $output .= '<dt>' . $this->t('Adding link text') . '</dt>';\n        $output .= '<dd>' . $this->t('In the field settings you can define additional link text to be <em>optional</em> or <em>required</em> in any link field.') . '</dd>';\n        $output .= '<dt>' . $this->t('Displaying link text') . '</dt>';\n        $output .= '<dd>' . $this->t('If link text has been submitted for a URL, then by default this link text is displayed as a link to the URL. If you want to display both the link text <em>and</em> the URL, choose the appropriate link format from the drop-down menu in the <em>Manage display</em> page. If you only want to display the URL even if link text has been submitted, choose <em>Link</em> as the format, and then change its <em>Format settings</em> to display <em>URL only</em>.') . '</dd>';\n        $output .= '<dt>' . $this->t('Adding attributes to links') . '</dt>';\n        $output .= '<dd>' . $this->t('You can add attributes to links, by changing the <em>Format settings</em> in the <em>Manage display</em> page. Adding <em>rel=\"nofollow\"</em> notifies search engines that links should not be followed.') . '</dd>';\n        $output .= '<dt>' . $this->t('Validating URLs') . '</dt>';\n        $output .= '<dd>' . $this->t('All links are validated after a link field is filled in. They can include anchors or query strings.') . '</dd>';\n        $output .= '</dl>';\n        return $output;\n    }\n    return NULL;\n  }\n\n  /**\n   * Implements hook_field_type_category_info_alter().\n   */\n  #[Hook('field_type_category_info_alter')]\n  public function fieldTypeCategoryInfoAlter(&$definitions): void {\n    // The `link` field type belongs in the `general` category, so the libraries\n    // need to be attached using an alter hook.\n    $definitions[FieldTypeCategoryManagerInterface::FALLBACK_CATEGORY]['libraries'][] = 'link/drupal.link-icon';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/link/src/Hook/LinkHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LinkHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: search_page\nlabel: Search page configuration\nmigration_tags:\n  - Drupal 6\n  - Configuration\nsource:\n  plugin: d6_search_page\n  variables:\n    - node_rank_comments\n    - node_rank_promote\n    - node_rank_recent\n    - node_rank_relevance\n    - node_rank_sticky\n    - node_rank_views\n  constants:\n    id: node_search\n    path: node\n    plugin: node_search\nprocess:\n  module: module\n  id: 'constants/id'\n  label: 'constants/id'\n  path: 'constants/path'\n  plugin: 'constants/plugin'\n  configuration:\n    plugin: default_value\n    default_value: [ ]\n  'configuration/rankings':\n    plugin: search_configuration_rankings\ndestination:\n  plugin: entity:search_page\n", "metadata": {"source": "repos/drupal_core/core/modules/search/migrations/search_page.yml", "type": "yaml_reference", "topic": "search page"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: OutboundPathProcessorInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\PathProcessor;\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Defines an interface for classes that process the outbound path.\n */\ninterface OutboundPathProcessorInterface {\n\n  /**\n   * Processes the outbound path.\n   *\n   * @param string $path\n   *   The path to process, with a leading slash.\n   * @param array $options\n   *   (optional) An associative array of additional options, with the following\n   *   elements:\n   *   - 'query': An array of query key/value-pairs (without any URL-encoding)\n   *     to append to the URL.\n   *   - 'fragment': A fragment identifier (named anchor) to append to the URL.\n   *     Do not include the leading '#' character.\n   *   - 'absolute': Defaults to FALSE. Whether to force the output to be an\n   *     absolute link (beginning with http:). Useful for links that will be\n   *     displayed outside the site, such as in an RSS feed.\n   *   - 'language': An optional language object used to look up the alias\n   *     for the URL. If $options['language'] is omitted, it defaults to the\n   *     current language for the language type LanguageInterface::TYPE_URL.\n   *   - 'https': Whether this URL should point to a secure location. If not\n   *     defined, the current scheme is used, so the user stays on HTTP or HTTPS\n   *     respectively. TRUE enforces HTTPS and FALSE enforces HTTP.\n   *   - 'base_url': Only used internally by a path processor, for example, to\n   *     modify the base URL when a language dependent URL requires so.\n   *   - 'prefix': Only used internally, to modify the path when a language\n   *     dependent URL requires so.\n   *   - 'route': The route object for the given path. It will be set by\n   *     \\Drupal\\Core\\Routing\\UrlGenerator::generateFromRoute().\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The HttpRequest object representing the current request.\n   * @param \\Drupal\\Core\\Render\\BubbleableMetadata $bubbleable_metadata\n   *   (optional) Object to collect path processors' bubbleable metadata.\n   *\n   * @return string\n   *   The processed path.\n   */\n  function processOutbound($path, &$options = [], ?Request $request = NULL, ?BubbleableMetadata $bubbleable_metadata = NULL);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\PathProcessor;\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Defines an interface for classes that process the outbound path.\n */\ninterface OutboundPathProcessorInterface {\n\n  /**\n   * Processes the outbound path.\n   *\n   * @param string $path\n   *   The path to process, with a leading slash.\n   * @param array $options\n   *   (optional) An associative array of additional options, with the following\n   *   elements:\n   *   - 'query': An array of query key/value-pairs (without any URL-encoding)\n   *     to append to the URL.\n   *   - 'fragment': A fragment identifier (named anchor) to append to the URL.\n   *     Do not include the leading '#' character.\n   *   - 'absolute': Defaults to FALSE. Whether to force the output to be an\n   *     absolute link (beginning with http:). Useful for links that will be\n   *     displayed outside the site, such as in an RSS feed.\n   *   - 'language': An optional language object used to look up the alias\n   *     for the URL. If $options['language'] is omitted, it defaults to the\n   *     current language for the language type LanguageInterface::TYPE_URL.\n   *   - 'https': Whether this URL should point to a secure location. If not\n   *     defined, the current scheme is used, so the user stays on HTTP or HTTPS\n   *     respectively. TRUE enforces HTTPS and FALSE enforces HTTP.\n   *   - 'base_url': Only used internally by a path processor, for example, to\n   *     modify the base URL when a language dependent URL requires so.\n   *   - 'prefix': Only used internally, to modify the path when a language\n   *     dependent URL requires so.\n   *   - 'route': The route object for the given path. It will be set by\n   *     \\Drupal\\Core\\Routing\\UrlGenerator::generateFromRoute().\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The HttpRequest object representing the current request.\n   * @param \\Drupal\\Core\\Render\\BubbleableMetadata $bubbleable_metadata\n   *   (optional) Object to collect path processors' bubbleable metadata.\n   *\n   * @return string\n   *   The processed path.\n   */\n  public function processOutbound($path, &$options = [], ?Request $request = NULL, ?BubbleableMetadata $bubbleable_metadata = NULL);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/PathProcessor/OutboundPathProcessorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "OutboundPathProcessorInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a feed icon.\n *\n * Available variables:\n * - url: An internal system path or a fully qualified external URL of the feed.\n * - title: Title of the feed for describing the feed on the subscribe link.\n * - attributes: Remaining HTML attributes for the feed link.\n *   - title: A descriptive title of the feed link.\n *   - class: HTML classes to be applied to the feed link.\n */\n#}\n\n{{ attach_library('olivero/feed') }}\n\n<a href=\"{{ url }}\"{{ attributes.addClass('feed-icon') }}>\n  <span class=\"feed-icon__label\">\n    {{ title }}\n  </span>\n  <span class=\"feed-icon__icon\" aria-hidden=\"true\">\n    {% include \"@olivero/../images/rss.svg\" %}\n  </span>\n</a>\n", "metadata": {"source": "repos/drupal_core/core/themes/olivero/templates/misc/feed-icon.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface WsdlImporterInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client;\n\n/**\n * Interface for WSDL importer.\n */\ninterface WsdlImporterInterface\n{\n\n  /**\n   * Processes WSDL services import.\n   *\n   * @param array<string, mixed> $service_data\n   *   Service data from WSDL parsing.\n   * @param bool $update_existing\n   *   Whether to update existing entities.\n   * @param array<string, mixed> $context\n   *   Batch context.\n   *\n   * @return $this\n   *   Reference to self.\n   */\n  public function processService(\n    array $service_data,\n    bool $update_existing,\n    array &$context,\n  ): static;\n\n  /**\n   * Processes WSDL operations import.\n   *\n   * @param array<string, mixed> $operation_data\n   *   Operation data from WSDL parsing.\n   * @param bool $update_existing\n   *   Whether to update existing entities.\n   * @param array<string, mixed> $context\n   *   Batch context.\n   *\n   * @return $this\n   *   Reference to self.\n   */\n  public function processOperation(\n    array $operation_data,\n    bool $update_existing,\n    array &$context,\n  ): static;\n\n  /**\n   * Installs Feed Types and Feeds for all SOAP operations.\n   *\n   * @return $this\n   *   Reference to self.\n   */\n  public function installFeeds(): static;\n\n  /**\n   * Displays batch finish messages.\n   *\n   * @param bool $success\n   *   Whether the batch completed successfully.\n   * @param array<string, mixed> $results\n   *   Batch results.\n   *\n   * @return $this\n   *   Reference to self.\n   */\n  public function displayResults(bool $success, array $results): static;\n\n}\n", "metadata": {"source": "repos/soap_client/src/WsdlImporterInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "WsdlImporterInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Profile in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\nuse Drupal\\Core\\Entity\\Attribute\\ConfigEntityType;\nuse Drupal\\Core\\Entity\\EntityDeleteForm;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\display_builder\\Form\\ProfileForm;\nuse Drupal\\display_builder\\Form\\ProfileIslandPluginForm;\nuse Drupal\\display_builder\\ProfileAccessControlHandler;\nuse Drupal\\display_builder\\ProfileInterface;\nuse Drupal\\display_builder\\ProfileViewBuilder;\nuse Drupal\\display_builder_ui\\ProfileListBuilder;\nuse Drupal\\user\\Entity\\Role;\nuse Drupal\\user\\RoleInterface;\n\n/**\n * Defines the display builder entity type.\n */\n#[ConfigEntityType(\n  id: 'display_builder_profile',\n  label: new TranslatableMarkup('Display builder profile'),\n  label_collection: new TranslatableMarkup('Display builder profiles'),\n  label_singular: new TranslatableMarkup('display builder profile'),\n  label_plural: new TranslatableMarkup('display builders profiles'),\n  entity_keys: [\n    'id' => 'id',\n    'label' => 'label',\n    'description' => 'description',\n    'weight' => 'weight',\n  ],\n  handlers: [\n    'access' => ProfileAccessControlHandler::class,\n    'route_provider' => [\n      'html' => 'Drupal\\display_builder\\Routing\\ProfileRouteProvider',\n    ],\n    'view_builder' => ProfileViewBuilder::class,\n    'list_builder' => ProfileListBuilder::class,\n    'form' => [\n      'add' => ProfileForm::class,\n      'edit' => ProfileForm::class,\n      'delete' => EntityDeleteForm::class,\n      'edit-plugin' => ProfileIslandPluginForm::class,\n    ],\n  ],\n  links: [\n    'add-form' => '/admin/structure/display-builder/add',\n    'edit-form' => '/admin/structure/display-builder/{display_builder_profile}',\n    'edit-plugin-form' => '/admin/structure/display-builder/{display_builder_profile}/edit/{island_id}',\n    'delete-form' => '/admin/structure/display-builder/{display_builder_profile}/delete',\n    'collection' => '/admin/structure/display-builder',\n  ],\n  admin_permission: 'administer display builder profile',\n  constraints: [\n    'ImmutableProperties' => [\n      'id',\n    ],\n  ],\n  // Example: display_builder.profile.default.yml.\n  config_prefix: 'profile',\n  config_export: [\n    'id',\n    'label',\n    'description',\n    'islands',\n    'weight',\n  ],\n)]\nfinal class Profile extends ConfigEntityBase implements ProfileInterface {\n\n  /**\n   * The display builder config ID.\n   */\n  protected string $id;\n\n  /**\n   * The display builder label.\n   */\n  protected string $label;\n\n  /**\n   * The display builder description.\n   */\n  protected string $description;\n\n  /**\n   * The display builder debug mode.\n   */\n  protected bool $debug = FALSE;\n\n  /**\n   * The islands configuration for storage.\n   */\n  protected ?array $islands = [];\n\n  /**\n   * Weight to order the entity in lists.\n   *\n   * @var int\n   */\n  protected $weight = 0;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIslandConfiguration(string $island_id): array {\n    return $this->islands[$island_id] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIslandConfigurations(): array {\n    return $this->islands ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setIslandConfiguration(string $island_id, array $configuration = []): void {\n    // When $configuration is updated from ProfileIslandPluginForm,\n    // 'weight', 'status' and 'region' properties are missing but they must not\n    // be reset.\n    $configuration['weight'] = $configuration['weight'] ?? $this->islands[$island_id]['weight'] ?? 0;\n    $configuration['status'] = $configuration['status'] ?? $this->islands[$island_id]['status'] ?? FALSE;\n\n    // Only View islands have regions.\n    if (isset($this->islands[$island_id]['region'])) {\n      $configuration['region'] = $configuration['region'] ?? $this->islands[$island_id]['region'];\n    }\n\n    $this->islands[$island_id] = $configuration;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEnabledIslands(): array {\n    $island_enabled = [];\n\n    foreach ($this->islands as $island_id => $configuration) {\n      if (isset($configuration['status']) && $configuration['status']) {\n        $island_enabled[$island_id] = $configuration['weight'] ?? 0;\n      }\n    }\n\n    return $island_enabled;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPermissionName(): string {\n    return 'use display builder ' . $this->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoles(): array {\n    // Do not list any roles if the permission does not exist.\n    $permission = $this->getPermissionName();\n\n    if (empty($permission)) {\n      return [];\n    }\n\n    $roles = \\array_filter(Role::loadMultiple(), static fn (RoleInterface $role) => $role->hasPermission($permission));\n\n    return \\array_map(static fn (RoleInterface $role) => $role->label(), $roles);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function toUrl($rel = NULL, array $options = []): Url {\n    if ($rel === 'edit-plugin-form' && $this->id() && isset($options['island_id'])) {\n      $island_id = $options['island_id'];\n      unset($options['island_id']);\n\n      return Url::fromRoute(\n        'entity.display_builder_profile.edit_plugin_form',\n        ['display_builder_profile' => $this->id(), 'island_id' => $island_id],\n        $options\n      );\n    }\n\n    return parent::toUrl($rel, $options);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isDebugModeActivated(): bool {\n    return $this->debug;\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Entity/Profile.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Profile", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SnapshotCleanupForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Form;\n\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Form for cleaning up old workflow snapshots.\n */\nclass SnapshotCleanupForm extends FormBase {\n\n  /**\n   * The entity snapshot storage service.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage\n   */\n  protected EntitySnapshotStorage $snapshotStorage;\n\n  /**\n   * Constructs a new SnapshotCleanupForm.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage $snapshot_storage\n   *   The entity snapshot storage service.\n   */\n  public function __construct(EntitySnapshotStorage $snapshot_storage) {\n    $this->snapshotStorage = $snapshot_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('flowdrop_runtime.entity_snapshot_storage'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'flowdrop_runtime_snapshot_cleanup';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $form['description'] = [\n      '#type' => 'markup',\n      '#markup' => '<p>' . $this->t('Use this form to clean up old workflow snapshots. This action is irreversible.') . '</p>',\n    ];\n\n    $form['age'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Delete snapshots older than'),\n      '#options' => [\n        '3600' => $this->t('1 hour'),\n        '86400' => $this->t('1 day'),\n        '604800' => $this->t('1 week'),\n        '2592000' => $this->t('30 days'),\n        '7776000' => $this->t('90 days'),\n      ],\n      '#default_value' => '604800',\n      '#required' => TRUE,\n    ];\n\n    $form['statuses'] = [\n      '#type' => 'checkboxes',\n      '#title' => $this->t('Only delete snapshots with status'),\n      '#options' => [\n        'completed' => $this->t('Completed'),\n        'failed' => $this->t('Failed'),\n        'pending' => $this->t('Pending'),\n        'running' => $this->t('Running'),\n        'paused' => $this->t('Paused'),\n      ],\n      '#default_value' => ['completed', 'failed'],\n      '#description' => $this->t('Leave all unchecked to delete all snapshots regardless of status.'),\n    ];\n\n    $form['actions'] = [\n      '#type' => 'actions',\n    ];\n\n    $form['actions']['preview'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Preview'),\n      '#submit' => ['::previewCleanup'],\n    ];\n\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Delete snapshots'),\n      '#button_type' => 'danger',\n    ];\n\n    return $form;\n  }\n\n  /**\n   * Preview cleanup handler.\n   */\n  public function previewCleanup(array &$form, FormStateInterface $form_state): void {\n    $age = (int) $form_state->getValue('age');\n    $statuses = array_filter($form_state->getValue('statuses') ?? []);\n    $olderThan = time() - $age;\n\n    // Count snapshots that would be deleted.\n    $query = \\Drupal::entityTypeManager()\n      ->getStorage('flowdrop_workflow_snapshot')\n      ->getQuery()\n      ->condition('created', $olderThan, '<')\n      ->accessCheck(FALSE);\n\n    if (!empty($statuses)) {\n      $query->condition('snapshot_status', array_keys($statuses), 'IN');\n    }\n\n    $count = $query->count()->execute();\n\n    $this->messenger()->addStatus($this->t('@count snapshots would be deleted.', [\n      '@count' => $count,\n    ]));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $age = (int) $form_state->getValue('age');\n    $statuses = array_filter($form_state->getValue('statuses') ?? []);\n    $olderThan = time() - $age;\n\n    $statusList = !empty($statuses) ? array_keys($statuses) : [];\n    $deleted = $this->snapshotStorage->cleanup($olderThan, $statusList);\n\n    $this->messenger()->addStatus($this->t('Deleted @count workflow snapshots.', [\n      '@count' => $deleted,\n    ]));\n\n    $form_state->setRedirect('entity.flowdrop_workflow_snapshot.collection');\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Form/SnapshotCleanupForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SnapshotCleanupForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DeleteField in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\FieldService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_delete_field',\n  label: new TranslatableMarkup('Delete Field'),\n  description: new TranslatableMarkup('Delete a field from an entity bundle. Data will be lost!'),\n  operation: ToolOperation::Write,\n  destructive: TRUE,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: 'node',\n    ),\n    'bundle' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'field_name' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Name'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'field_name' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Deleted Field Name'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DeleteField extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected FieldService $fieldService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->fieldService = $container->get('mcp_tools_structure.field');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? 'node';\n    $bundle = $input['bundle'] ?? '';\n    $fieldName = $input['field_name'] ?? '';\n\n    if (empty($bundle) || empty($fieldName)) {\n      return ['success' => FALSE, 'error' => 'bundle and field_name are required.'];\n    }\n\n    return $this->fieldService->deleteField($entityType, $bundle, $fieldName);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_structure/src/Plugin/tool/Tool/DeleteField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteField", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Example\nSource file: <source_file>\nFile name hint: Example.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\queue_manager_example\\Plugin\\QueueWorker;\n\nuse Drupal\\Core\\Queue\\Attribute\\QueueWorker;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Executes tasks of the example queue.\n */\n#[QueueWorker(\n  id: 'example',\n  title: new TranslatableMarkup('Example'),\n)]\nfinal class Example extends QueueWorkerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function processItem(mixed $data): void {\n    \\usleep(100_000);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\queue_manager_example\\Plugin\\QueueWorker;\n\nuse Drupal\\Core\\Queue\\Attribute\\QueueWorker;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Executes tasks of the example queue.\n */\n#[QueueWorker(\n  id: 'example',\n  title: new TranslatableMarkup('Example'),\n)]\nfinal class Example extends QueueWorkerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem(mixed $data): void {\n    \\usleep(100_000);\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/modules/queue_manager_example/src/Plugin/QueueWorker/Example.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Example", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class FieldUninstallValidator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\field;\n\nuse Drupal\\Core\\Config\\StorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Extension\\ConfigImportModuleUninstallValidatorInterface;\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\n\n/**\n * Prevents uninstallation of modules providing active field storage.\n */\nclass FieldUninstallValidator implements ConfigImportModuleUninstallValidatorInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The field storage config storage.\n   *\n   * @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityStorageInterface\n   */\n  protected $fieldStorageConfigStorage;\n\n  /**\n   * The field type plugin manager.\n   *\n   * @var \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface\n   */\n  protected $fieldTypeManager;\n\n  /**\n   * Constructs a new FieldUninstallValidator.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The string translation service.\n   * @param \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface $field_type_manager\n   *   The field type plugin manager.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation, FieldTypePluginManagerInterface $field_type_manager) {\n    $this->fieldStorageConfigStorage = $entity_type_manager->getStorage('field_storage_config');\n    $this->stringTranslation = $string_translation;\n    $this->fieldTypeManager = $field_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($module) {\n    $reasons = [];\n    if ($field_storages = $this->getFieldStoragesByModule($module)) {\n      // Provide an explanation message (only mention pending deletions if there\n      // remain no actual, non-deleted fields.)\n      $fields_in_use = [];\n      foreach ($field_storages as $field_storage) {\n        if (!$field_storage->isDeleted()) {\n          $fields_in_use[$field_storage->getType()][] = $field_storage->getLabel();\n        }\n      }\n      if (!empty($fields_in_use)) {\n        foreach ($fields_in_use as $field_type => $field_storages) {\n          $field_type_label = $this->getFieldTypeLabel($field_type);\n          $reasons[] = $this->formatPlural(count($fields_in_use[$field_type]), 'The %field_type_label field type is used in the following field: @fields', 'The %field_type_label field type is used in the following fields: @fields', ['%field_type_label' => $field_type_label, '@fields' => implode(', ', $field_storages)]);\n        }\n      }\n      else {\n        $reasons[] = $this->t('Fields pending deletion');\n      }\n    }\n    return $reasons;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateConfigImport(string $module, StorageInterface $source_storage): array {\n    // The field_config_import_steps_alter() method removes field data prior to\n    // configuration import so the checks in ::validate() are unnecessary.\n    return [];\n  }\n\n  /**\n   * Returns all field storages for a specified module.\n   *\n   * @param string $module\n   *   The module to filter field storages by.\n   *\n   * @return \\Drupal\\field\\FieldStorageConfigInterface[]\n   *   An array of field storages for a specified module.\n   */\n  protected function getFieldStoragesByModule($module) {\n    return $this->fieldStorageConfigStorage->loadByProperties(['module' => $module, 'include_deleted' => TRUE]);\n  }\n\n  /**\n   * Returns the label for a specified field type.\n   *\n   * @param string $field_type\n   *   The field type.\n   *\n   * @return string\n   *   The field type label.\n   */\n  protected function getFieldTypeLabel($field_type) {\n    return $this->fieldTypeManager->getDefinitions()[$field_type]['label'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/field/src/FieldUninstallValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldUninstallValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: EntityInsert\nSource file: <source_file>\nFile name hint: EntityInsert.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\n\n/**\n * Event type for entity insert events.\n *\n * Triggers when a new entity is created and saved to the database.\n * This event fires after the entity has been successfully inserted.\n */\n#[FlowDropEventType(\n  id: \"entity.insert\",\n  label: new TranslatableMarkup(\"Entity Insert\"),\n  description: new TranslatableMarkup(\"Triggered when a new entity is created\"),\n  category: \"entity\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [],\n)]\nclass EntityInsert extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for entity insert events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add insert-specific data.\n    $data[\"is_new\"] = TRUE;\n    $data[\"operation\"] = \"insert\";\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    $baseSchema = parent::getParameterSchema();\n\n    // Entity insert doesn't need additional configuration beyond base.\n    return $baseSchema;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\n\n/**\n * Event type for entity insert events.\n *\n * Triggers when a new entity is created and saved to the database.\n * This event fires after the entity has been successfully inserted.\n */\n#[FlowDropEventType(\n  id: \"entity.insert\",\n  label: new TranslatableMarkup(\"Entity Insert\"),\n  description: new TranslatableMarkup(\"Triggered when a new entity is created\"),\n  category: \"entity\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [],\n)]\nclass EntityInsert extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for entity insert events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add insert-specific data.\n    $data[\"is_new\"] = TRUE;\n    $data[\"operation\"] = \"insert\";\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    $baseSchema = parent::getParameterSchema();\n\n    // Entity insert doesn't need additional configuration beyond base.\n    return $baseSchema;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/EntityInsert.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityInsert", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.block.settings_tray_form:\n  path: '/admin/structure/block/manage/{block}/settings-tray'\n  defaults:\n    _entity_form: 'block.settings_tray'\n    _title_callback: '\\Drupal\\settings_tray\\Block\\BlockEntitySettingTrayForm::title'\n  requirements:\n    _permission: 'administer blocks'\n    _access_block_plugin_has_settings_tray_form: 'TRUE'\n    _access_block_has_overrides_settings_tray_form: 'TRUE'\n", "metadata": {"source": "repos/drupal_core/core/modules/settings_tray/settings_tray.routing.yml", "type": "yaml_reference", "topic": "settings tray.routing"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  ai_context.access_check.overview_page:\n    class: Drupal\\ai_context\\Access\\AiContextOverviewAccessCheck\n    arguments:\n      - '@config.factory'\n    tags:\n      - { name: access_check, applies_to: _ai_context_overview_access }\n\n  logger.channel.ai_context:\n    class: Drupal\\Core\\Logger\\LoggerChannel\n    factory: ['@logger.factory', get]\n    arguments: ['ai_context']\n\n  ai_context.router:\n    class: Drupal\\ai_context\\Service\\AiContextRouter\n    arguments:\n      - '@config.factory'\n      - '@entity_type.manager'\n      - '@ai.tokenizer'\n      - '@logger.channel.ai_context'\n      - '@ai.provider'\n\n  ai_context.renderer:\n    class: Drupal\\ai_context\\Service\\AiContextRenderer\n    arguments:\n      - '@entity_type.manager'\n      - '@ai.text_chunker'\n\n  ai_context.entity_target_resolver:\n    class: Drupal\\ai_context\\Service\\AiContextEntityTargetResolver\n    arguments:\n      - '@current_route_match'\n      - '@request_stack'\n      - '@config.factory'\n      - '@entity_type.manager'\n\n  ai_context.selector:\n    class: Drupal\\ai_context\\Service\\AiContextSelector\n    arguments:\n      - '@config.factory'\n      - '@entity_type.manager'\n      - '@ai_context.router'\n      - '@ai_context.renderer'\n      - '@ai_context.entity_target_resolver'\n\n  ai_context.system_prompt_subscriber:\n    class: Drupal\\ai_context\\EventSubscriber\\SystemPromptSubscriber\n    arguments: ['@ai_context.selector']\n    tags:\n      - { name: event_subscriber }\n\n  ai_context.uninstall_validator:\n    class: Drupal\\ai_context\\AiContextUninstallValidator\n    arguments:\n      - '@entity_type.manager'\n      - '@string_translation'\n    tags:\n      - { name: module_install.uninstall_validator }\n", "metadata": {"source": "repos/ai_context/ai_context.services.yml", "type": "yaml_reference", "topic": "ai context.services"}}
{"instruction": "Show me the implementation of the interface CheckpointStorageInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Config\\Checkpoint;\n\nuse Drupal\\Core\\Config\\StorageInterface;\n\n/**\n * Provides an interface for checkpoint storages.\n *\n * @internal\n *   This API is experimental.\n */\ninterface CheckpointStorageInterface extends StorageInterface {\n\n  /**\n   * Creates a checkpoint, if required, and returns the active checkpoint.\n   *\n   * If the storage determines that the current active checkpoint would contain\n   * the same information, it does not have to create a new checkpoint.\n   *\n   * @param string|\\Stringable $label\n   *   The checkpoint label to use if a new checkpoint is created.\n   *\n   * @return \\Drupal\\Core\\Config\\Checkpoint\\Checkpoint\n   *   The currently active checkpoint.\n   */\n  public function checkpoint(string|\\Stringable $label): Checkpoint;\n\n  /**\n   * Sets the checkpoint to read from.\n   *\n   * Calling read() or readMultiple() will return the configuration data at the\n   * time of the checkpoint that was set here. If none is set, then the\n   * configuration from the initial checkpoint will be returned.\n   *\n   * @param string|\\Drupal\\Core\\Config\\Checkpoint\\Checkpoint $checkpoint_id\n   *   The checkpoint ID to read from.\n   *\n   * @return $this\n   *\n   * @throws \\Drupal\\Core\\Config\\Checkpoint\\UnknownCheckpointException\n   *   Thrown when the provided checkpoint does not exist.\n   */\n  public function setCheckpointToReadFrom(string|Checkpoint $checkpoint_id): static;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/Checkpoint/CheckpointStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CheckpointStorageInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the views plugins of the File module.\n\n\nviews.argument.file_fid:\n  type: views.argument.numeric\n  label: 'File ID'\n\nviews.field.file:\n  type: views_field\n  label: 'File'\n  mapping:\n    link_to_file:\n      type: boolean\n      label: 'Link this field to download the file'\n\nviews.filter.file_status:\n  type: views.filter.in_operator\n  label: 'File status'\n", "metadata": {"source": "repos/drupal_core/core/modules/file/config/schema/file.views.schema.yml", "type": "yaml_reference", "topic": "file.views.schema"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: ValidationManagerInterface\nSource file: <source_file>\nFile name hint: ValidationManagerInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\eb\\Service;\n\nuse Drupal\\eb\\PluginInterfaces\\OperationInterface;\nuse Drupal\\eb\\Result\\ValidationResult;\n\n/**\n * Interface for the validation manager service.\n *\n * The validation manager coordinates validation of operations, performing\n * two-stage validation:\n * 1. Operation's own validation (specific to operation type)\n * 2. All applicable validator plugins (cross-cutting concerns)\n */\ninterface ValidationManagerInterface {\n\n  /**\n   * Validate a single operation.\n   *\n   * Performs two-stage validation:\n   * 1. Operation's own validation (specific to operation type)\n   * 2. All applicable validator plugins (cross-cutting concerns)\n   *\n   * @param \\Drupal\\eb\\PluginInterfaces\\OperationInterface $operation\n   *   The operation to validate.\n   *\n   * @return \\Drupal\\eb\\Result\\ValidationResult\n   *   The validation result containing all errors and warnings.\n   */\n  function validateOperation(OperationInterface $operation): ValidationResult;\n\n  /**\n   * Validate multiple operations in a batch.\n   *\n   * Validates operations with awareness of the batch context, allowing\n   * validators to check if dependencies will be satisfied by earlier\n   * operations in the same batch.\n   *\n   * @param array<\\Drupal\\eb\\PluginInterfaces\\OperationInterface> $operations\n   *   Array of operations to validate.\n   *\n   * @return \\Drupal\\eb\\Result\\ValidationResult\n   *   Aggregated validation result.\n   */\n  public function validateBatch(array $operations): ValidationResult;\n\n}", "output": "<?php\n\nnamespace Drupal\\eb\\Service;\n\nuse Drupal\\eb\\PluginInterfaces\\OperationInterface;\nuse Drupal\\eb\\Result\\ValidationResult;\n\n/**\n * Interface for the validation manager service.\n *\n * The validation manager coordinates validation of operations, performing\n * two-stage validation:\n * 1. Operation's own validation (specific to operation type)\n * 2. All applicable validator plugins (cross-cutting concerns)\n */\ninterface ValidationManagerInterface {\n\n  /**\n   * Validate a single operation.\n   *\n   * Performs two-stage validation:\n   * 1. Operation's own validation (specific to operation type)\n   * 2. All applicable validator plugins (cross-cutting concerns)\n   *\n   * @param \\Drupal\\eb\\PluginInterfaces\\OperationInterface $operation\n   *   The operation to validate.\n   *\n   * @return \\Drupal\\eb\\Result\\ValidationResult\n   *   The validation result containing all errors and warnings.\n   */\n  public function validateOperation(OperationInterface $operation): ValidationResult;\n\n  /**\n   * Validate multiple operations in a batch.\n   *\n   * Validates operations with awareness of the batch context, allowing\n   * validators to check if dependencies will be satisfied by earlier\n   * operations in the same batch.\n   *\n   * @param array<\\Drupal\\eb\\PluginInterfaces\\OperationInterface> $operations\n   *   Array of operations to validate.\n   *\n   * @return \\Drupal\\eb\\Result\\ValidationResult\n   *   Aggregated validation result.\n   */\n  public function validateBatch(array $operations): ValidationResult;\n\n}\n", "metadata": {"source": "repos/eb/src/Service/ValidationManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ValidationManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema definitions for FlowDrop Playground module\n\nflowdrop_playground.settings:\n  type: config_object\n  label: 'FlowDrop Playground settings'\n  mapping:\n    default_session_timeout:\n      type: integer\n      label: 'Default session timeout in seconds'\n    max_sessions_per_workflow:\n      type: integer\n      label: 'Maximum sessions per workflow'\n    message_retention_days:\n      type: integer\n      label: 'Number of days to retain messages'\n    auto_run:\n      type: boolean\n      label: 'Auto-run workflows on load'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_playground/config/schema/flowdrop_playground.schema.yml", "type": "yaml_reference", "topic": "flowdrop playground.schema"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: FieldPathExtractor.php\nTarget symbol: class for\nNamespace: Drupal\\api_normalization\\Util\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Ensure these methods exist where relevant:\n  - exists()\n  - extract()\n  - set()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Util;\n\n/**\n * Utility class for extracting and setting field values using dot-notation paths.\n *\n * This class provides methods to work with nested array structures using\n * dot-notation paths (e.g., 'choices[0].message.content').\n */\nclass FieldPathExtractor {\n\n  /**\n   * Extract field value by dot-notation path.\n   *\n   * @param array $data\n   *   The data array.\n   * @param string $path\n   *   The field path (e.g., 'choices[0].message.content').\n   *\n   * @return mixed|null\n   *   The extracted value, or NULL if not found.\n   */\n  public static function extract(array $data, string $path) {\n    // Handle array notation like 'choices[0].message.content'.\n    $path = str_replace(['[', ']'], ['.', ''], $path);\n    $keys = explode('.', $path);\n\n    $value = $data;\n    foreach ($keys as $key) {\n      // Skip empty keys from double dots.\n      if ($key === '') {\n        continue;\n      }\n\n      if (is_array($value) && isset($value[$key])) {\n        $value = $value[$key];\n      }\n      else {\n        return NULL;\n      }\n    }\n\n    return $value;\n  }\n\n  /**\n   * Set field value by dot-notation path.\n   *\n   * @param array $data\n   *   The data array (passed by reference).\n   * @param string $path\n   *   The field path (e.g., 'choices[0].message.content').\n   * @param mixed $value\n   *   The value to set.\n   *\n   * @return bool\n   *   TRUE if the value was set, FALSE if the path is invalid.\n   */\n  public static function set(array &$data, string $path, $value): bool {\n    // Handle array notation like 'choices[0].message.content'.\n    $path = str_replace(['[', ']'], ['.', ''], $path);\n    $keys = explode('.', $path);\n\n    // Remove empty keys from double dots.\n    $keys = array_filter($keys, fn($key) => $key !== '');\n\n    if (empty($keys)) {\n      return FALSE;\n    }\n\n    // Navigate to the target location.\n    $current = &$data;\n    $last_key = array_pop($keys);\n\n    foreach ($keys as $key) {\n      if (!isset($current[$key]) || !is_array($current[$key])) {\n        $current[$key] = [];\n      }\n      $current = &$current[$key];\n    }\n\n    // Set the value.\n    $current[$last_key] = $value;\n    return TRUE;\n  }\n\n  /**\n   * Check if a field path exists in the data.\n   *\n   * @param array $data\n   *   The data array.\n   * @param string $path\n   *   The field path (e.g., 'choices[0].message.content').\n   *\n   * @return bool\n   *   TRUE if the path exists, FALSE otherwise.\n   */\n  public static function exists(array $data, string $path): bool {\n    // Handle array notation like 'choices[0].message.content'.\n    $path = str_replace(['[', ']'], ['.', ''], $path);\n    $keys = explode('.', $path);\n\n    $current = $data;\n    foreach ($keys as $key) {\n      // Skip empty keys from double dots.\n      if ($key === '') {\n        continue;\n      }\n\n      if (is_array($current) && isset($current[$key])) {\n        $current = $current[$key];\n      }\n      else {\n        return FALSE;\n      }\n    }\n\n    return TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Util/FieldPathExtractor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldPathExtractor", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class EntityWipePlugin in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Plugin\\Wipe;\n\nuse Drupal\\Core\\Entity\\ContentEntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\db_wipe\\Plugin\\WipePluginBase;\nuse Drupal\\db_wipe_entity\\Service\\EntityWipeService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides entity wipe functionality using Drupal's entity API.\n *\n * @WipePlugin(\n *   id = \"entity_wipe\",\n *   label = @Translation(\"Entity Wipe\"),\n *   description = @Translation(\"Deletes entities using Drupal's entity API with full hooks and events.\"),\n *   category = \"entity\",\n *   weight = 0\n * )\n */\nclass EntityWipePlugin extends WipePluginBase {\n\n  /**\n   * Constructs an EntityWipePlugin object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\db_wipe_entity\\Service\\EntityWipeService $entityWipeService\n   *   The entity wipe service.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    protected EntityWipeService $entityWipeService,\n    protected EntityTypeManagerInterface $entityTypeManager,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('db_wipe_entity.entity_wipe'),\n      $container->get('entity_type.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supports($target): bool {\n    // Check if target is a valid content entity type.\n    if (!$this->entityTypeManager->hasDefinition($target)) {\n      return FALSE;\n    }\n\n    $definition = $this->entityTypeManager->getDefinition($target);\n    return $definition instanceof ContentEntityTypeInterface;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($target, array $options = []): array {\n    $errors = parent::validate($target, $options);\n\n    // Additional validation can be added here.\n    if (!empty($options['bundle'])) {\n      $entity_type = $this->entityTypeManager->getDefinition($target);\n      $bundle_entity_type = $entity_type->getBundleEntityType();\n\n      if (!$bundle_entity_type) {\n        $errors[] = $this->t('Entity type @type does not support bundles.', [\n          '@type' => $target,\n        ]);\n      }\n    }\n\n    return $errors;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preview($target, array $options = []): array {\n    $bundle = $options['bundle'] ?? NULL;\n    $exclude_ids = $options['exclude_ids'] ?? NULL;\n    $include_ids = $options['include_ids'] ?? NULL;\n\n    $query = $this->entityWipeService->buildQuery(\n      $target,\n      $bundle,\n      $exclude_ids,\n      $include_ids\n    );\n\n    $count = $this->entityWipeService->countEntities($query);\n    $ids = $this->entityWipeService->getEntityIds($query);\n\n    return [\n      'count' => $count,\n      'items' => array_slice($ids, 0, 10),\n      'details' => [\n        'entity_type' => $target,\n        'bundle' => $bundle,\n        'method' => 'entity_api',\n        'batch_processing' => !($options['no_batch'] ?? FALSE),\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute($target, array $options = []): array {\n    $bundle = $options['bundle'] ?? NULL;\n    $exclude_ids = $options['exclude_ids'] ?? NULL;\n    $include_ids = $options['include_ids'] ?? NULL;\n    $dry_run = $options['dry_run'] ?? FALSE;\n    $no_batch = $options['no_batch'] ?? FALSE;\n\n    $query = $this->entityWipeService->buildQuery(\n      $target,\n      $bundle,\n      $exclude_ids,\n      $include_ids\n    );\n\n    if ($dry_run) {\n      $preview = $this->preview($target, $options);\n      return [\n        'success' => TRUE,\n        'count' => $preview['count'],\n        'message' => $this->t('[DRY RUN] Would delete @count entities', [\n          '@count' => $preview['count'],\n        ]),\n        'prevented' => FALSE,\n      ];\n    }\n\n    if ($no_batch) {\n      $ids = $this->entityWipeService->getEntityIds($query);\n      $deleted = $this->entityWipeService->deleteEntitiesImmediate($target, $ids);\n\n      return [\n        'success' => TRUE,\n        'count' => $deleted,\n        'message' => $this->t('Deleted @count entities immediately.', [\n          '@count' => $deleted,\n        ]),\n        'prevented' => FALSE,\n      ];\n    }\n\n    $result = $this->entityWipeService->executeWipe(\n      $target,\n      $query,\n      $bundle,\n      $dry_run,\n      $exclude_ids,\n      $include_ids\n    );\n\n    return [\n      'success' => !$result['prevented'],\n      'count' => $result['count'] ?? 0,\n      'message' => $result['prevented']\n        ? $this->t('Wipe operation was prevented.')\n        : $this->t('Batch deletion initiated for @count entities.', ['@count' => $result['count']]),\n      'prevented' => $result['prevented'],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Plugin/Wipe/EntityWipePlugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityWipePlugin", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CreateRole in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\RoleService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_create_role',\n  label: new TranslatableMarkup('Create Role'),\n  description: new TranslatableMarkup('Create a new user role with optional initial permissions.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Machine Name'),\n      description: new TranslatableMarkup('Lowercase, underscores (e.g., \"content_editor\")'),\n      required: TRUE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label'),\n      description: new TranslatableMarkup('Human-readable name (e.g., \"Content Editor\")'),\n      required: TRUE,\n    ),\n    'permissions' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Permissions'),\n      description: new TranslatableMarkup('Initial permissions to grant'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Role ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Role Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'permissions_granted' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Permissions Granted'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateRole extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected RoleService $roleService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->roleService = $container->get('mcp_tools_structure.role');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $id = $input['id'] ?? '';\n    $label = $input['label'] ?? '';\n\n    if (empty($id) || empty($label)) {\n      return ['success' => FALSE, 'error' => 'Both id and label are required.'];\n    }\n\n    return $this->roleService->createRole($id, $label, $input['permissions'] ?? []);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_structure/src/Plugin/tool/Tool/CreateRole.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateRole", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BookNodeIsRemovableAccessCheck.php\nTarget symbol: class BookNodeIsRemovableAccessCheck\nNamespace: Drupal\\book\\Access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BookNodeIsRemovableAccessCheck.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Access\\AccessResultInterface\n  - Drupal\\Core\\Routing\\Access\\AccessInterface\n  - Drupal\\book\\BookManagerInterface\n  - Drupal\\node\\NodeInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - access()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\book\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Determines whether the requested node can be removed from its book.\n */\nclass BookNodeIsRemovableAccessCheck implements AccessInterface {\n\n  /**\n   * Constructs a BookNodeIsRemovableAccessCheck object.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   Book Manager Service.\n   */\n  public function __construct(protected BookManagerInterface $bookManager) {\n  }\n\n  /**\n   * Checks access for removing the node from its book.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The node requested to be removed from its book.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(NodeInterface $node): AccessResultInterface {\n    return AccessResult::allowedIf($this->bookManager->checkNodeIsRemovable($node))->addCacheableDependency($node);\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Access/BookNodeIsRemovableAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookNodeIsRemovableAccessCheck", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class DeleteImageStyle in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_image_styles\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_image_styles\\Service\\ImageStyleService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_image_styles_delete',\n  label: new TranslatableMarkup('Delete Image Style'),\n  description: new TranslatableMarkup('Delete an image style. Use force=true to delete even if in use.'),\n  operation: ToolOperation::Write,\n  destructive: TRUE,\n  input_definitions: [\n    'style_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Style ID'),\n      description: new TranslatableMarkup('The machine name of the image style to delete.'),\n      required: TRUE,\n    ),\n    'force' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Force'),\n      description: new TranslatableMarkup('Delete even if the style is in use.'),\n      required: FALSE,\n      default_value: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DeleteImageStyle extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'image_styles';\n\n\n  protected ImageStyleService $imageStyleService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->imageStyleService = $container->get('mcp_tools_image_styles.image_style_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access.\n    $accessCheck = $this->accessManager->checkWriteAccess('delete', 'image_style');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $styleId = $input['style_id'] ?? '';\n    $force = !empty($input['force']);\n\n    if (empty($styleId)) {\n      return [\n        'success' => FALSE,\n        'error' => 'style_id is required.',\n      ];\n    }\n\n    $result = $this->imageStyleService->deleteImageStyle($styleId, $force);\n\n    if ($result['success']) {\n      $this->auditLogger->log('delete', 'image_style', $styleId, [\n        'force' => $force,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_image_styles/src/Plugin/tool/Tool/DeleteImageStyle.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteImageStyle", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ReducerInterface.php\nTarget symbol: interface ReducerInterface\nNamespace: Drupal\\flowdrop_stategraph\\Reducer\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for ReducerInterface.\n- Ensure these methods exist where relevant:\n  - getDefaultValue()\n  - getId()\n  - reduce()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\Reducer;\n\n/**\n * Interface for state field reducers.\n *\n * Reducers define how state updates are applied to existing state values.\n * Each reducer implements a specific strategy for combining the current\n * state value with an incoming update.\n *\n * Available reducer implementations:\n * - AppendReducer: Appends values to arrays (for message history).\n * - ReplaceReducer: Replaces the current value entirely (default).\n * - MergeReducer: Deep merges arrays (for nested data transforms).\n *\n * @see \\Drupal\\flowdrop_stategraph\\Reducer\\AppendReducer\n * @see \\Drupal\\flowdrop_stategraph\\Reducer\\ReplaceReducer\n * @see \\Drupal\\flowdrop_stategraph\\Reducer\\MergeReducer\n */\ninterface ReducerInterface {\n\n  /**\n   * Gets the unique identifier for this reducer.\n   *\n   * @return string\n   *   The reducer ID (e.g., \"append\", \"replace\", \"merge\").\n   */\n  public function getId(): string;\n\n  /**\n   * Reduces the current state value with an incoming update.\n   *\n   * @param mixed $currentValue\n   *   The current value of the state field.\n   * @param mixed $updateValue\n   *   The incoming update value from a node execution.\n   *\n   * @return mixed\n   *   The new state value after reduction.\n   */\n  public function reduce(mixed $currentValue, mixed $updateValue): mixed;\n\n  /**\n   * Gets the default value for this reducer's field type.\n   *\n   * This is used to initialize state fields before any updates.\n   *\n   * @return mixed\n   *   The default value (e.g., [] for append, null for replace).\n   */\n  public function getDefaultValue(): mixed;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_stategraph/src/Reducer/ReducerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ReducerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Es vegano, libre de gluten, bajo en grasa, alto en fibra e incluso puede reducir el colesterol, pero la harina de avena es aburrida, \u00bfverdad? Pero, antes de descartar ese aburrido jarr\u00f3n de avena, es posible que desee inspirarse en nuestras ideas principales que har\u00e1n que su avena sea ins\u00edpida a creativa en s\u00f3lo unos minutos.", "input": "", "output": "Es vegano, libre de gluten, bajo en grasa, alto en fibra e incluso puede reducir el colesterol, pero la harina de avena es aburrida, \u00bfverdad? Pero, antes de descartar ese aburrido jarr\u00f3n de avena, es posible que desee inspirarse en nuestras ideas principales que har\u00e1n que su avena sea ins\u00edpida a creativa en s\u00f3lo unos minutos.\n\nLl\u00e1melo avena, avena, cereal caliente o simplemente avena, es amado en todo el mundo; pero recientemente, la avena humilde est\u00e1 recibiendo un cambio de imagen funky. Atr\u00e1s quedaron los d\u00edas de tartas de desayuno pesadas y gruesas, porque la avena se sirve como una deliciosa comida que puede adaptarse a cualquier momento del d\u00eda. Est\u00e1n surgiendo las modernas barras de avena para construir su propia harina de avena, y brindan la mejor experiencia de avena. Los comensales pueden elegir su avena para hacerla con leche o agua y luego ir a la ciudad con sus ingredientes favoritos: dulce, salado o incluso picante.\n\nSuena genial, \u00bfno es as\u00ed? As\u00ed que antes de cerrar la puerta de la alacena en ese frasco de avena de aspecto ins\u00edpido, creemos que deber\u00edas probar algunas de estas deliciosas ideas para inspirar tu propio cambio de imagen.\n\n## Frutas secas empapadas\n\nA veces, las frutas secas simples pueden ser un poco blandas y \u00e1speras cuando se combinan con avena cremosa. Pero si simplemente remoja su fruta seca en jugo de naranja durante la noche, desarrollar\u00e1n una espiga y se hinchar\u00e1n, haci\u00e9ndolos m\u00e1s suaves y a\u00fan m\u00e1s deliciosos. Adem\u00e1s, el toque de color realmente puede alegrar su d\u00eda.\n\n## Cr\u00e8me br\u00fbl\u00e9e gachas\n\nTan simple, pero \u00bfpor qu\u00e9 nadie lo ha pensado antes? Ponga su harina de avena cocida en un molde, espolvoree con az\u00facar y revuelva debajo de la parrilla. El az\u00facar se endurecer\u00e1, lo que te dar\u00e1 el placer de resquebrajarse en la superficie y extraer la deliciosa cremosidad que se encuentra debajo. Si eres realmente profesional, puedes usar un soplete.\n\n## S\u00faper semillas\n\nPara una opci\u00f3n de comida m\u00e1s sabrosa, cocine su avena con agua, un poco de sal y espolvoree con semillas tostadas. Puede elegir cualquiera que disfrute, pero las semillas de calabaza, s\u00e9samo, linaza y girasol son especialmente buenas. Algunos supermercados tambi\u00e9n venden mezclas de semillas para facilitar a\u00fan m\u00e1s el trabajo.\n\n## Torta De Zanahoria Deconstruida\n\nCocina la avena con zanahorias ralladas y un poco de az\u00facar, luego cubre con una pizca de canela, nueces picadas y una cucharada de queso crema endulzado. Si no te gusta esto, hay algo mal con tus papilas gustativas.\n\n## El Chocolate Oscuro\n\nEsta delicia baja en az\u00facar cumplir\u00e1 con todos esos antojos de chocolate y es el postre perfecto. Agregue una cucharada de cacao a su avena mientras se cocina, luego cubra con unos cuadrados de chocolate oscuro. A medida que se derrite, simplemente g\u00edralos en el taz\u00f3n tan ingeniosamente como puedas. Si eres realmente decadente, un chorrito de crema batida agregar\u00e1 m\u00e1s placeres.\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/modules/demo_umami_content/default_content/languages/es/article_body/give-your-oatmeal-the-ultimate-makeover.md", "type": "doc_summary", "topic": "Es vegano, libre de gluten, bajo en grasa, alto en fibra e incluso puede reducir el colesterol, pero la harina de avena es aburrida, \u00bfverdad? Pero, antes de descartar ese aburrido jarr\u00f3n de avena, es posible que desee inspirarse en nuestras ideas principales que har\u00e1n que su avena sea ins\u00edpida a creativa en s\u00f3lo unos minutos."}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ContactSettings\nSource file: <source_file>\nFile name hint: ContactSettings.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\contact\\Plugin\\migrate\\source;\n\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\Variable;\n\n/**\n * Drupal 6/7 contact settings source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"contact_settings\",\n *   source_module = \"contact\"\n * )\n */\nclass ContactSettings extends Variable {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function initializeIterator() {\n    $default_category = $this->select('contact', 'c')\n      ->fields('c', ['cid'])\n      ->condition('c.selected', 1)\n      ->execute()\n      ->fetchField();\n    return new \\ArrayIterator([$this->values() + ['default_category' => $default_category]]);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\contact\\Plugin\\migrate\\source;\n\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\Variable;\n\n/**\n * Drupal 6/7 contact settings source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"contact_settings\",\n *   source_module = \"contact\"\n * )\n */\nclass ContactSettings extends Variable {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function initializeIterator() {\n    $default_category = $this->select('contact', 'c')\n      ->fields('c', ['cid'])\n      ->condition('c.selected', 1)\n      ->execute()\n      ->fetchField();\n    return new \\ArrayIterator([$this->values() + ['default_category' => $default_category]]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contact/src/Plugin/migrate/source/ContactSettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContactSettings", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the interface ReducerInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\Reducer;\n\n/**\n * Interface for state field reducers.\n *\n * Reducers define how state updates are applied to existing state values.\n * Each reducer implements a specific strategy for combining the current\n * state value with an incoming update.\n *\n * Available reducer implementations:\n * - AppendReducer: Appends values to arrays (for message history).\n * - ReplaceReducer: Replaces the current value entirely (default).\n * - MergeReducer: Deep merges arrays (for nested data transforms).\n *\n * @see \\Drupal\\flowdrop_stategraph\\Reducer\\AppendReducer\n * @see \\Drupal\\flowdrop_stategraph\\Reducer\\ReplaceReducer\n * @see \\Drupal\\flowdrop_stategraph\\Reducer\\MergeReducer\n */\ninterface ReducerInterface {\n\n  /**\n   * Gets the unique identifier for this reducer.\n   *\n   * @return string\n   *   The reducer ID (e.g., \"append\", \"replace\", \"merge\").\n   */\n  public function getId(): string;\n\n  /**\n   * Reduces the current state value with an incoming update.\n   *\n   * @param mixed $currentValue\n   *   The current value of the state field.\n   * @param mixed $updateValue\n   *   The incoming update value from a node execution.\n   *\n   * @return mixed\n   *   The new state value after reduction.\n   */\n  public function reduce(mixed $currentValue, mixed $updateValue): mixed;\n\n  /**\n   * Gets the default value for this reducer's field type.\n   *\n   * This is used to initialize state fields before any updates.\n   *\n   * @return mixed\n   *   The default value (e.g., [] for append, null for replace).\n   */\n  public function getDefaultValue(): mixed;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_stategraph/src/Reducer/ReducerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ReducerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LayoutBuilderRestriction.php\nTarget symbol: class LayoutBuilderRestriction\nNamespace: Drupal\\layout_builder_restrictions\\Attribute\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LayoutBuilderRestriction.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\Attribute\\Plugin\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\layout_builder_restrictions\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a Layout Builder Restriction attribute for plugin discovery.\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass LayoutBuilderRestriction extends Plugin {\n\n  /**\n   * Constructs a LayoutBuilderRestriction attribute.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $title\n   *   The human-readable name of the restriction plugin.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $description\n   *   The human-readable description of the restriction plugin.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly TranslatableMarkup $title,\n    public readonly TranslatableMarkup $description\n  ) {\n  }\n}\n", "metadata": {"source": "repos/layout_builder_restrictions/src/Attribute/LayoutBuilderRestriction.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderRestriction", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "display_builder_views.views.manage:\n  path: '/admin/structure/views/view/{view}/display-builder/{display}'\n  defaults:\n    _title_callback: '\\Drupal\\display_builder_views\\Controller\\ViewsController::title'\n    _controller: '\\Drupal\\display_builder_views\\Controller\\ViewsController::getBuilder'\n  requirements:\n    _entity_access: view.update\n    _permission: 'administer views'\n    _module_dependencies: views_ui\n  options:\n    _admin_route: false\n    _display_builder_route: true\n    parameters:\n      view:\n        type: 'entity:view'\n        # To trigger Drupal\\views_ui\\ParamConverter\\ViewUIConverter.\n        # The value for {view} will be converted to a view entity loaded from\n        # the views temp store.\n        tempstore: true\n        converter: 'drupal.proxy_original_service.paramconverter.views_ui'\n\ndisplay_builder_views.views.collection:\n  path: '/admin/structure/views/display-builder'\n  defaults:\n    _title: ' Display builders in Views'\n    _controller: '\\Drupal\\display_builder_views\\Controller\\ViewsManagementController::pageViewsIndex'\n  requirements:\n    _permission: 'administer views'\n\ndisplay_builder_views.views.delete:\n  path: '/admin/structure/views/display-builder/{builder_id}/delete'\n  defaults:\n    _form: '\\Drupal\\display_builder_views\\Form\\ConfirmViewsBuilderDeleteForm'\n    _title: 'Confirm deletion'\n  requirements:\n    _permission: 'administer views'\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/display_builder_views.routing.yml", "type": "yaml_reference", "topic": "display builder views.routing"}}
{"instruction": "Show me the implementation of the class GenerateEntityNode in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\FlowDrop\\NodeHandler;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * FlowDrop node handler for entity generation.\n *\n * @FlowDropNodeHandler(\n *   id = \"generate_entity\",\n *   label = @Translation(\"Generate Entity\"),\n *   description = @Translation(\"Generates Drupal entities from normalized data\")\n * )\n */\nclass GenerateEntityNode extends NodeHandlerBase implements\n  ContainerFactoryPluginInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return [\n      'entity_type' => 'node',\n      'bundle' => 'default',\n      'field_mappings' => [],\n    ] + parent::defaultConfiguration();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(array $data, array $context): array {\n    $inputData = $data['input'] ?? $context['transformed'] ?? [];\n    $entityType = $data['entity_type'] ?? $this->configuration['entity_type'] ?? 'node';\n    $bundle = $data['bundle'] ?? $this->configuration['bundle'] ?? 'default';\n    $fieldMappings = $data['field_mappings'] ?? $this->configuration['field_mappings'] ?? [];\n\n    if (empty($inputData)) {\n      return [\n        'error' => 'No input data provided',\n        'output' => [],\n      ];\n    }\n\n    // Use entity generator.\n    $entityGenerator = \\Drupal::service('api_normalization.entity_generator');\n    $entityMapper = \\Drupal::service('api_normalization.entity_mapper');\n\n    // Map fields.\n    $mappedData = $entityMapper->mapFields($inputData, $fieldMappings);\n\n    // Ensure entity type and bundle exist.\n    $entityTypeInfo = $entityGenerator->ensureEntityType($entityType, ucfirst($entityType), 'Generated from API Normalizer');\n    $entityGenerator->createBundle($entityType, $bundle, ucfirst($bundle), []);\n\n    // Create entity.\n    $entityTypeManager = \\Drupal::entityTypeManager();\n    $storage = $entityTypeManager->getStorage($entityType);\n    $entity = $storage->create(array_merge(['type' => $bundle], $mappedData));\n    $entity->save();\n\n    return [\n      'output' => [\n        'entity_id' => $entity->id(),\n        'entity_type' => $entityType,\n        'bundle' => $bundle,\n      ],\n      'entity' => $entity,\n      'entity_id' => $entity->id(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/FlowDrop/NodeHandler/GenerateEntityNode.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GenerateEntityNode", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class HelpHook in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\layout_builder_formatter\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Implements hook_help().\n */\nclass HelpHook {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help(string $route_name, RouteMatchInterface $route_match): ?string {\n    return match ($route_name) {\n      'help.page.layout_builder_formatter' => $this->buildHelpPage(),\n      default => NULL,\n    };\n  }\n\n  /**\n   * Builds the help page content.\n   *\n   * @return string\n   *   The help page HTML.\n   */\n  protected function buildHelpPage(): string {\n    $output = '<h2>' . $this->t('About') . '</h2>';\n    $output .= '<p>' . $this->t('Layout Builder Formatter enables the Layout Builder field to be displayed using a standard field formatter, allowing you to configure field display settings when Layout Builder is enabled.') . '</p>';\n\n    $output .= '<h2>' . $this->t('Uses') . '</h2>';\n    $output .= '<dl>';\n\n    $output .= '<dt>' . $this->t('Displaying layouts via formatter') . '</dt>';\n    $output .= '<dd>' . $this->t('When enabled, the <code>layout_builder__layout</code> field can be configured like any other field on the \"Manage display\" page. The Layout Builder formatter renders the sections stored in the field.') . '</dd>';\n\n    $output .= '<dt>' . $this->t('Keeping fields visible') . '</dt>';\n    $output .= '<dd>' . $this->t('Unlike core Layout Builder which hides all fields when enabled, this module keeps the fields table visible so you can configure field formatters alongside the layout field.') . '</dd>';\n\n    $output .= '</dl>';\n\n    return $output;\n  }\n\n}\n", "metadata": {"source": "repos/layout_builder_formatter/src/Hook/HelpHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpHook", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ai_provider_openrouter.install\nSource file: <source_file>\nFile name hint: ai_provider_openrouter.install\nBroken snippet:\n<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the OpenRouter Provider module.\n */\n\n/**\n * Implements hook_install().\n */\nfunction ai_provider_openrouter_install() {\n  // Grant permissions to administrator role if it exists.\n  $role = \\Drupal::entityTypeManager()->getStorage('user_role')->load('administrator');\n  if ($role) {\n    $role->grantPermission('administer ai providers');\n    $role->grantPermission('use ai provider openrouter');\n    $role->save();\n  }\n}\n// BUG: ensure this implementation follows Drupal 11 and PHP 8.3.", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the OpenRouter Provider module.\n */\n\n/**\n * Implements hook_install().\n */\nfunction ai_provider_openrouter_install() {\n  // Grant permissions to administrator role if it exists.\n  $role = \\Drupal::entityTypeManager()->getStorage('user_role')->load('administrator');\n  if ($role) {\n    $role->grantPermission('administer ai providers');\n    $role->grantPermission('use ai provider openrouter');\n    $role->save();\n  }\n}\n", "metadata": {"source": "repos/ai_provider_openrouter/ai_provider_openrouter.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AiProviderOpenrouter", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Tag.php\nTarget symbol: class Tag\nNamespace: Drupal\\views\\Plugin\\views\\cache\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Tag.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\views\\Attribute\\ViewsCache\n- Ensure these methods exist where relevant:\n  - cacheExpire()\n  - getDefaultCacheMaxAge()\n  - summaryTitle()", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\cache;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsCache;\n\n/**\n * Simple caching of query results for Views displays.\n *\n * @ingroup views_cache_plugins\n */\n#[ViewsCache(\n  id: 'tag',\n  title: new TranslatableMarkup('Tag based'),\n  help: new TranslatableMarkup('Tag based caching of data. Caches will persist until any related cache tags are invalidated.'),\n)]\nclass Tag extends CachePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    return $this->t('Tag');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function cacheExpire($type) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultCacheMaxAge() {\n    return CacheBackendInterface::CACHE_PERMANENT;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/cache/Tag.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Tag", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class DepthLimitSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\jsonapi_security\\EventSubscriber;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\jsonapi_security\\Service\\JsonApiHelper;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\HttpKernel\\Event\\RequestEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\BadRequestHttpException;\nuse Symfony\\Component\\HttpKernel\\KernelEvents;\n\n/**\n * Enforces a maximum depth for JSON:API include queries.\n */\nclass DepthLimitSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new DepthLimitSubscriber.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory.\n   * @param \\Symfony\\Component\\EventDispatcher\\EventDispatcherInterface $eventDispatcher\n   *   The event dispatcher.\n   * @param \\Drupal\\jsonapi_security\\Service\\JsonApiHelper $helper\n   *   The JSON:API helper.\n   */\n  public function __construct(\n    protected readonly ConfigFactoryInterface $configFactory,\n    protected readonly EventDispatcherInterface $eventDispatcher,\n    protected readonly JsonApiHelper $helper,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      KernelEvents::REQUEST => ['onRequest', 0],\n    ];\n  }\n\n  /**\n   * Limits the depth of include queries.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\RequestEvent $event\n   *   The request event.\n   */\n  public function onRequest(RequestEvent $event): void {\n    $request = $event->getRequest();\n\n    // Only process JSON:API requests.\n    if (!$this->helper->isJsonApiRequest($request->getPathInfo())) {\n      return;\n    }\n\n    $config = $this->configFactory->get('jsonapi_security.settings');\n\n    if (!$config->get('limit_query_depth')) {\n      return;\n    }\n\n    $include = $request->query->get('include');\n    if (empty($include)) {\n      return;\n    }\n\n    $maxDepth = $config->get('max_depth') ?? 2;\n\n    // Check for overrides.\n    $overrides = $config->get('depth_overrides') ?? [];\n    if (!empty($overrides)) {\n      $resourceType = $this->helper->extractResourceType($request->getPathInfo());\n      $maxDepth = $this->getMaxDepthInitial($resourceType, $overrides, $maxDepth);\n    }\n\n    $includes = explode(',', $include);\n    foreach ($includes as $fieldPath) {\n      $depth = substr_count($fieldPath, '.');\n      if ($depth > ($maxDepth - 1)) {\n        throw new BadRequestHttpException(sprintf(\n          'The include parameter exceeds the maximum allowed depth of %d.',\n          $maxDepth\n        ));\n      }\n    }\n  }\n\n  /**\n   * Gets the maximum depth for a resource type.\n   *\n   * @param string $resourceType\n   *   The resource type.\n   * @param array $overrides\n   *   The depth overrides.\n   * @param int $default\n   *   The default max depth.\n   *\n   * @return int\n   *   The max depth.\n   */\n  protected function getMaxDepthInitial(string $resourceType, array $overrides, int $default): int {\n    foreach ($overrides as $override) {\n      [$type, $depth] = explode(':', $override);\n      if ($type === $resourceType) {\n        return (int) $depth;\n      }\n    }\n    return $default;\n  }\n\n}\n", "metadata": {"source": "repos/jsonapi_security/src/EventSubscriber/DepthLimitSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DepthLimitSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface PathAliasInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\path_alias;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Entity\\EntityPublishedInterface;\n\n/**\n * Provides an interface defining a path_alias entity.\n */\ninterface PathAliasInterface extends ContentEntityInterface, EntityPublishedInterface {\n\n  /**\n   * Gets the source path of the alias.\n   *\n   * @return string\n   *   The source path.\n   */\n  public function getPath();\n\n  /**\n   * Sets the source path of the alias.\n   *\n   * @param string $path\n   *   The source path.\n   *\n   * @return $this\n   */\n  public function setPath($path);\n\n  /**\n   * Gets the alias for this path.\n   *\n   * @return string\n   *   The alias for this path.\n   */\n  public function getAlias();\n\n  /**\n   * Sets the alias for this path.\n   *\n   * @param string $alias\n   *   The path alias.\n   *\n   * @return $this\n   */\n  public function setAlias($alias);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path_alias/src/PathAliasInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PathAliasInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: CKEditor5Plugin\nSource file: <source_file>\nFile name hint: CKEditor5Plugin.php\nBroken snippet:\n<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Attribute;\n\nuse Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition;\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * The CKEditor5Plugin attribute.\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass CKEditor5Plugin extends Plugin {\n\n  /**\n   * The CKEditor 5 aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Attribute\\CKEditor5AspectsOfCKEditor5Plugin|null\n   */\n  public readonly ?CKEditor5AspectsOfCKEditor5Plugin $ckeditor5;\n\n  /**\n   * The Drupal aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Attribute\\DrupalAspectsOfCKEditor5Plugin|null\n   */\n  public readonly ?DrupalAspectsOfCKEditor5Plugin $drupal;\n\n  /**\n   * Constructs a CKEditor5Plugin attribute.\n   *\n   * Overridden for compatibility with the AttributeBridgeDecorator, which\n   * ensures YAML-defined CKEditor 5 plugin definitions are also processed by\n   * attributes. Unfortunately it does not (yet) support nested attributes.\n   * Force YAML-defined plugin definitions to be parsed by the attributes, to\n   * ensure consistent handling of defaults.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param array|\\Drupal\\ckeditor5\\Attribute\\CKEditor5AspectsOfCKEditor5Plugin|null $ckeditor5\n   *   (optional) The CKEditor 5 aspects of the plugin definition. Required\n   *   unless set by deriver.\n   * @param array|\\Drupal\\ckeditor5\\Attribute\\DrupalAspectsOfCKEditor5Plugin|null $drupal\n   *   (optional) The Drupal aspects of the plugin definition. Required unless\n   *   set by deriver.\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   *\n   * @see \\Drupal\\Component\\Plugin\\Discovery\\AttributeBridgeDecorator::getDefinitions()\n   */\n  function __construct(\n    public readonly string $id,\n    array|CKEditor5AspectsOfCKEditor5Plugin|null $ckeditor5 = NULL,\n    array|DrupalAspectsOfCKEditor5Plugin|null $drupal = NULL,\n    public readonly ?string $deriver = NULL,\n  ) {\n    // If either of the two aspects of the plugin definition is in array form,\n    // then this is a YAML-defined CKEditor 5 plugin definition. To avoid errors\n    // due to violating either Attribute class constructor, verify basic data\n    // shape requirements here. This provides a better DX for YAML-defined\n    // plugins, and avoids the need for a PHP IDE or debugger.\n    // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginManager::processDefinition()\n    // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition::validateCKEditor5Aspects()\n    // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition::validateDrupalAspects()\n    if (!$drupal instanceof DrupalAspectsOfCKEditor5Plugin) {\n      if ($drupal === NULL) {\n        throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition must contain a \"drupal\" key.', $id));\n      }\n      // TRICKY: $this->deriver is incorrect due to AttributeBridgeDecorator!\n      // If there's no deriver, validate here. Otherwise: the base definition is\n      // allowed to be incomplete; let CKEditor5PluginManager::processDefinition\n      // perform the validation.\n      // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition::getDeriver()\n      // @see \\Drupal\\Component\\Plugin\\Discovery\\AttributeBridgeDecorator::getDefinitions()\n      if (!isset($drupal['deriver'])) {\n        if (isset($drupal['label']) && !is_string($drupal['label']) && !$drupal['label'] instanceof TranslatableMarkup) {\n          throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition has a \"drupal.label\" value that is not a string nor a TranslatableMarkup instance.', $id));\n        }\n        if (!$ckeditor5 instanceof CKEditor5AspectsOfCKEditor5Plugin) {\n          if ($ckeditor5 === NULL) {\n            throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition must contain a \"ckeditor5\" key.', $id));\n          }\n          if (!isset($ckeditor5['plugins'])) {\n            throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition must contain a \"ckeditor5.plugins\" key.', $id));\n          }\n        }\n      }\n    }\n\n    $this->ckeditor5 = is_array($ckeditor5) ? new CKEditor5AspectsOfCKEditor5Plugin(...$ckeditor5) : $ckeditor5;\n    $this->drupal = is_array($drupal) ? new DrupalAspectsOfCKEditor5Plugin(...$drupal) : $drupal;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClass(): string {\n    return $this->drupal?->getClass() ?? '';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setClass($class): void {\n    $this->drupal?->setClass($class);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get(): CKEditor5PluginDefinition {\n    return new CKEditor5PluginDefinition([\n      'id' => $this->id,\n      'ckeditor5' => $this->ckeditor5?->get(),\n      'drupal' => $this->drupal?->get(),\n      'provider' => $this->getProvider(),\n    ]);", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Attribute;\n\nuse Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition;\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * The CKEditor5Plugin attribute.\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass CKEditor5Plugin extends Plugin {\n\n  /**\n   * The CKEditor 5 aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Attribute\\CKEditor5AspectsOfCKEditor5Plugin|null\n   */\n  public readonly ?CKEditor5AspectsOfCKEditor5Plugin $ckeditor5;\n\n  /**\n   * The Drupal aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Attribute\\DrupalAspectsOfCKEditor5Plugin|null\n   */\n  public readonly ?DrupalAspectsOfCKEditor5Plugin $drupal;\n\n  /**\n   * Constructs a CKEditor5Plugin attribute.\n   *\n   * Overridden for compatibility with the AttributeBridgeDecorator, which\n   * ensures YAML-defined CKEditor 5 plugin definitions are also processed by\n   * attributes. Unfortunately it does not (yet) support nested attributes.\n   * Force YAML-defined plugin definitions to be parsed by the attributes, to\n   * ensure consistent handling of defaults.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param array|\\Drupal\\ckeditor5\\Attribute\\CKEditor5AspectsOfCKEditor5Plugin|null $ckeditor5\n   *   (optional) The CKEditor 5 aspects of the plugin definition. Required\n   *   unless set by deriver.\n   * @param array|\\Drupal\\ckeditor5\\Attribute\\DrupalAspectsOfCKEditor5Plugin|null $drupal\n   *   (optional) The Drupal aspects of the plugin definition. Required unless\n   *   set by deriver.\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   *\n   * @see \\Drupal\\Component\\Plugin\\Discovery\\AttributeBridgeDecorator::getDefinitions()\n   */\n  public function __construct(\n    public readonly string $id,\n    array|CKEditor5AspectsOfCKEditor5Plugin|null $ckeditor5 = NULL,\n    array|DrupalAspectsOfCKEditor5Plugin|null $drupal = NULL,\n    public readonly ?string $deriver = NULL,\n  ) {\n    // If either of the two aspects of the plugin definition is in array form,\n    // then this is a YAML-defined CKEditor 5 plugin definition. To avoid errors\n    // due to violating either Attribute class constructor, verify basic data\n    // shape requirements here. This provides a better DX for YAML-defined\n    // plugins, and avoids the need for a PHP IDE or debugger.\n    // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginManager::processDefinition()\n    // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition::validateCKEditor5Aspects()\n    // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition::validateDrupalAspects()\n    if (!$drupal instanceof DrupalAspectsOfCKEditor5Plugin) {\n      if ($drupal === NULL) {\n        throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition must contain a \"drupal\" key.', $id));\n      }\n      // TRICKY: $this->deriver is incorrect due to AttributeBridgeDecorator!\n      // If there's no deriver, validate here. Otherwise: the base definition is\n      // allowed to be incomplete; let CKEditor5PluginManager::processDefinition\n      // perform the validation.\n      // @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition::getDeriver()\n      // @see \\Drupal\\Component\\Plugin\\Discovery\\AttributeBridgeDecorator::getDefinitions()\n      if (!isset($drupal['deriver'])) {\n        if (isset($drupal['label']) && !is_string($drupal['label']) && !$drupal['label'] instanceof TranslatableMarkup) {\n          throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition has a \"drupal.label\" value that is not a string nor a TranslatableMarkup instance.', $id));\n        }\n        if (!$ckeditor5 instanceof CKEditor5AspectsOfCKEditor5Plugin) {\n          if ($ckeditor5 === NULL) {\n            throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition must contain a \"ckeditor5\" key.', $id));\n          }\n          if (!isset($ckeditor5['plugins'])) {\n            throw new InvalidPluginDefinitionException($id, sprintf('The \"%s\" CKEditor 5 plugin definition must contain a \"ckeditor5.plugins\" key.', $id));\n          }\n        }\n      }\n    }\n\n    $this->ckeditor5 = is_array($ckeditor5) ? new CKEditor5AspectsOfCKEditor5Plugin(...$ckeditor5) : $ckeditor5;\n    $this->drupal = is_array($drupal) ? new DrupalAspectsOfCKEditor5Plugin(...$drupal) : $drupal;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClass(): string {\n    return $this->drupal?->getClass() ?? '';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setClass($class): void {\n    $this->drupal?->setClass($class);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get(): CKEditor5PluginDefinition {\n    return new CKEditor5PluginDefinition([\n      'id' => $this->id,\n      'ckeditor5' => $this->ckeditor5?->get(),\n      'drupal' => $this->drupal?->get(),\n      'provider' => $this->getProvider(),\n    ]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Attribute/CKEditor5Plugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CKEditor5Plugin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class AiContextItemListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\ai_context;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\n\n/**\n * List builder for AI Context Item content entities.\n */\nfinal class AiContextItemListBuilder extends EntityListBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader(): array {\n    $header['label'] = $this->t('Label');\n    $header['description'] = $this->t('Description');\n    $header['status'] = $this->t('Status');\n    $header['tags'] = $this->t('Tags');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    /** @var \\Drupal\\ai_context\\Entity\\AiContextItem $entity */\n    $row['label'] = $entity->label();\n    $description = $entity->getDescription();\n    // Strip HTML tags from description before truncating.\n    $description = strip_tags($description);\n    $row['description'] = Unicode::truncate($description, 200);\n\n    $row['status'] = $entity->isPublished() ? $this->t('published') : $this->t('not published');\n\n    // Load tag labels instead of showing IDs.\n    $tag_ids = $entity->getTagIds();\n    $tag_labels = [];\n    if (!empty($tag_ids)) {\n      $terms = \\Drupal::entityTypeManager()->getStorage('taxonomy_term')->loadMultiple($tag_ids);\n      foreach ($terms as $term) {\n        $tag_labels[] = $term->label();\n      }\n    }\n    $row['tags'] = implode(', ', $tag_labels);\n\n    // Explicitly build operations to ensure they're included.\n    $row['operations']['data'] = $this->buildOperations($entity);\n\n    return $row;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultOperations(EntityInterface $entity): array {\n    $operations = parent::getDefaultOperations($entity);\n\n    // Add revisions link if user has permission.\n    if ($entity->access('view all revisions')) {\n      $operations['revisions'] = [\n        'title' => $this->t('Revisions'),\n        'weight' => 20,\n        'url' => $entity->toUrl('version-history'),\n      ];\n    }\n\n    return $operations;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(): array {\n    $build = parent::render();\n    $build['#empty'] = $this->t('There are no AI Context Items yet. <a href=\":url\">Add one</a>.', [\n      ':url' => $this->entityType->getLinkTemplate('add-form'),\n    ]);\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/ai_context/src/AiContextItemListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AiContextItemListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FindDuplicateContent\nSource file: <source_file>\nFile name hint: FindDuplicateContent.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_duplicates',\n  label: new TranslatableMarkup('Find Duplicate Content'),\n  description: new TranslatableMarkup('Find similar content based on field values. Useful for identifying redundant pages.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'content_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Content Type'),\n      description: new TranslatableMarkup('Machine name of the content type to search'),\n      required: TRUE,\n    ),\n    'field' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field'),\n      description: new TranslatableMarkup('Field to compare for similarity (default: \"title\")'),\n      required: FALSE,\n    ),\n    'threshold' => new InputDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Similarity Threshold'),\n      description: new TranslatableMarkup('Similarity threshold 0.1-1.0 (default: 0.8 = 80% similar)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'content_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Content Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'field_compared' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Compared'),\n      description: new TranslatableMarkup(''),\n    ),\n    'threshold' => new ContextDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Threshold Used'),\n      description: new TranslatableMarkup(''),\n    ),\n    'items_analyzed' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Items Analyzed'),\n      description: new TranslatableMarkup(''),\n    ),\n    'duplicates' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Potential Duplicates'),\n      description: new TranslatableMarkup('Pairs of similar content with similarity percentage'),\n    ),\n    'duplicate_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Duplicate Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass FindDuplicateContent extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $contentType = $input['content_type'] ?? '';\n    $field = $input['field'] ?? 'title';\n    $threshold = isset($input['threshold']) ? (float) $input['threshold'] : 0.8;\n\n    if (empty($contentType)) {\n      return ['success' => FALSE, 'error' => 'content_type is required.'];\n    }\n\n    if ($threshold < 0.1 || $threshold > 1.0) {\n      return ['success' => FALSE, 'error' => 'threshold must be between 0.1 and 1.0.'];\n    }\n\n    return $this->analysisService->findDuplicateContent($contentType, $field, $threshold);\n  }\n\n", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_duplicates',\n  label: new TranslatableMarkup('Find Duplicate Content'),\n  description: new TranslatableMarkup('Find similar content based on field values. Useful for identifying redundant pages.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'content_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Content Type'),\n      description: new TranslatableMarkup('Machine name of the content type to search'),\n      required: TRUE,\n    ),\n    'field' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field'),\n      description: new TranslatableMarkup('Field to compare for similarity (default: \"title\")'),\n      required: FALSE,\n    ),\n    'threshold' => new InputDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Similarity Threshold'),\n      description: new TranslatableMarkup('Similarity threshold 0.1-1.0 (default: 0.8 = 80% similar)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'content_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Content Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'field_compared' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Compared'),\n      description: new TranslatableMarkup(''),\n    ),\n    'threshold' => new ContextDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Threshold Used'),\n      description: new TranslatableMarkup(''),\n    ),\n    'items_analyzed' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Items Analyzed'),\n      description: new TranslatableMarkup(''),\n    ),\n    'duplicates' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Potential Duplicates'),\n      description: new TranslatableMarkup('Pairs of similar content with similarity percentage'),\n    ),\n    'duplicate_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Duplicate Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass FindDuplicateContent extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $contentType = $input['content_type'] ?? '';\n    $field = $input['field'] ?? 'title';\n    $threshold = isset($input['threshold']) ? (float) $input['threshold'] : 0.8;\n\n    if (empty($contentType)) {\n      return ['success' => FALSE, 'error' => 'content_type is required.'];\n    }\n\n    if ($threshold < 0.1 || $threshold > 1.0) {\n      return ['success' => FALSE, 'error' => 'threshold must be between 0.1 and 1.0.'];\n    }\n\n    return $this->analysisService->findDuplicateContent($contentType, $field, $threshold);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/src/Plugin/tool/Tool/FindDuplicateContent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FindDuplicateContent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Layer\nnoUi: true\ngroup: Display builder\nslots:\n  title:\n    title: Title\n  info:\n    title: Info\n  children:\n    title: Children\nprops:\n  type: object\n  properties: {}\n", "metadata": {"source": "repos/display_builder/components/layer/layer.component.yml", "type": "yaml_reference", "topic": "layer.component"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BookSettingsForm.php\nTarget symbol: class BookSettingsForm\nNamespace: Drupal\\book\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BookSettingsForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Site\\Settings\n- Ensure these methods exist where relevant:\n  - buildForm()\n  - getEditableConfigNames()\n  - getFormId()\n  - submitForm()\n  - validateForm()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\book\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Site\\Settings;\n\n/**\n * Configure book settings for this site.\n *\n * @internal\n */\nclass BookSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'book_admin_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array {\n    return ['book.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('book.settings');\n    // @phpstan-ignore-next-line\n    $types = node_type_get_names();\n\n    $allowed_types = $config->get('allowed_types') ?? [];\n\n    $allowed_types_indexed = [];\n    foreach ($allowed_types as $item) {\n      $allowed_types_indexed[$item['content_type']] = $item['child_type'];\n    }\n\n    $form['allowed_types'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Allowed content types and their children'),\n    ];\n\n    foreach ($types as $type => $label) {\n      $form['allowed_types'][$type] = [\n        '#type' => 'container',\n        '#attributes' => ['id' => 'allowed-types-wrapper-' . $type],\n      ];\n\n      $form['allowed_types'][$type]['enabled'] = [\n        '#type' => 'checkbox',\n        '#title' => $label,\n        '#default_value' => isset($allowed_types_indexed[$type]),\n        '#parents' => ['allowed_types', $type, 'enabled'],\n        '#id' => 'allowed-types-' . $type . '-enabled',\n      ];\n\n      $form['allowed_types'][$type]['child_type'] = [\n        '#type' => 'radios',\n        '#title' => $this->t('Allowed child type for %type', ['%type' => $label]),\n        '#options' => $types,\n        '#default_value' => $allowed_types_indexed[$type] ?? NULL,\n        '#parents' => ['allowed_types', $type, 'child_type'],\n        '#id' => 'allowed-types-' . $type . '-child-type',\n        '#states' => [\n          'visible' => [\n            ':input#allowed-types-' . $type . '-enabled' => ['checked' => TRUE],\n          ],\n        ],\n      ];\n    }\n\n    $form['book_sort'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Book list sorting for administrative pages, outlines, and menus'),\n      '#default_value' => $config->get('book_sort'),\n      '#options' => [\n        'weight' => $this->t('Sort by weight'),\n        'title' => $this->t('Sort alphabetically by title'),\n      ],\n      '#required' => TRUE,\n    ];\n    $form['truncate_label'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Truncate the book label'),\n      '#description' => $this->t('Truncate the book label if it is longer than @length characters.', [\n        '@length' => Settings::get('book.truncate_limit', 30),\n      ]),\n      '#default_value' => $config->get('truncate_label'),\n      '#config_target' => 'book.settings:truncate_label',\n    ];\n\n    $form['use_parent_selector'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Use new parent selector javascript library'),\n      '#description' => $this->t('Use new experimental javascript library to use nested parent selectors.'),\n      '#default_value' => $config->get('use_parent_selector'),\n      '#config_target' => 'book.settings:use_parent_selector',\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state) {\n    parent::validateForm($form, $form_state);\n\n    $values = $form_state->getValue('allowed_types') ?? [];\n    // Check if there is at least one child type for enabled content types.\n    foreach ($values as $content_type => $type_data) {\n      if (!empty($type_data['enabled'])) {\n        if (empty($type_data['child_type'])) {\n          $form_state->setErrorByName(\"allowed_types][$content_type][child_type\", $this->t('You must select a child type for the enabled content type.'));\n        }\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    parent::submitForm($form, $form_state);\n    $values = $form_state->getValue('allowed_types') ?? [];\n    $allowed_types_config = [];\n    foreach ($values as $content_type => $type_data) {\n      if (!empty($type_data['enabled'])) {\n        $allowed_types_config[] = [\n          'content_type' => $content_type,\n          'child_type' => $type_data['child_type'] ?? \"\",\n        ];\n      }\n    }\n\n    $this->config('book.settings')\n      ->set('allowed_types', $allowed_types_config)\n      ->set('book_sort', $form_state->getValue('book_sort'))\n      ->save();\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Form/BookSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookSettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ViewsPostUpdate in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Post update functions for Views.\n */\n\nuse Drupal\\block\\BlockInterface;\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityUpdater;\nuse Drupal\\views\\ViewEntityInterface;\nuse Drupal\\views\\ViewsConfigUpdater;\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction views_removed_post_updates(): array {\n  return [\n    'views_post_update_update_cacheability_metadata' => '9.0.0',\n    'views_post_update_cleanup_duplicate_views_data' => '9.0.0',\n    'views_post_update_field_formatter_dependencies' => '9.0.0',\n    'views_post_update_taxonomy_index_tid' => '9.0.0',\n    'views_post_update_serializer_dependencies' => '9.0.0',\n    'views_post_update_boolean_filter_values' => '9.0.0',\n    'views_post_update_grouped_filters' => '9.0.0',\n    'views_post_update_revision_metadata_fields' => '9.0.0',\n    'views_post_update_entity_link_url' => '9.0.0',\n    'views_post_update_bulk_field_moved' => '9.0.0',\n    'views_post_update_filter_placeholder_text' => '9.0.0',\n    'views_post_update_views_data_table_dependencies' => '9.0.0',\n    'views_post_update_table_display_cache_max_age' => '9.0.0',\n    'views_post_update_exposed_filter_blocks_label_display' => '9.0.0',\n    'views_post_update_make_placeholders_translatable' => '9.0.0',\n    'views_post_update_limit_operator_defaults' => '9.0.0',\n    'views_post_update_remove_core_key' => '9.0.0',\n    'views_post_update_field_names_for_multivalue_fields' => '10.0.0',\n    'views_post_update_configuration_entity_relationships' => '10.0.0',\n    'views_post_update_rename_default_display_setting' => '10.0.0',\n    'views_post_update_remove_sorting_global_text_field' => '10.0.0',\n    'views_post_update_title_translations' => '10.0.0',\n    'views_post_update_sort_identifier' => '10.0.0',\n    'views_post_update_provide_revision_table_relationship' => '10.0.0',\n    'views_post_update_image_lazy_load' => '10.0.0',\n    'views_post_update_boolean_custom_titles' => '11.0.0',\n    'views_post_update_oembed_eager_load' => '11.0.0',\n    'views_post_update_responsive_image_lazy_load' => '11.0.0',\n    'views_post_update_timestamp_formatter' => '11.0.0',\n    'views_post_update_fix_revision_id_part' => '11.0.0',\n    'views_post_update_add_missing_labels' => '11.0.0',\n    'views_post_update_remove_skip_cache_setting' => '11.0.0',\n    'views_post_update_remove_default_argument_skip_url' => '11.0.0',\n    'views_post_update_taxonomy_filter_user_context' => '11.0.0',\n    'views_post_update_pager_heading' => '11.0.0',\n    'views_post_update_rendered_entity_field_cache_metadata' => '11.0.0',\n  ];\n}\n\n/**\n * Post update configured views for entity reference argument plugin IDs.\n */\nfunction views_post_update_views_data_argument_plugin_id(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::service(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsEntityArgumentUpdate($view);\n  });\n}\n\n/**\n * Updates the format plural option for those views using aggregation.\n */\nfunction views_post_update_format_plural(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::classResolver(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsFormatPluralUpdate($view);\n  });\n}\n\n/**\n * Clean-up empty remember_roles display settings for views filters.\n */\nfunction views_post_update_update_remember_role_empty(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::service(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsRememberRolesUpdate($view);\n  });\n}\n\n/**\n * Adds a default table CSS class.\n */\nfunction views_post_update_table_css_class(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::service(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsTableCssClassUpdate($view);\n  });\n}\n\n/**\n * Defaults `items_per_page` to NULL in Views blocks.\n */\nfunction views_post_update_block_items_per_page(?array &$sandbox = NULL): void {\n  if (!\\Drupal::moduleHandler()->moduleExists('block')) {\n    return;\n  }\n  \\Drupal::classResolver(ConfigEntityUpdater::class)\n    ->update($sandbox, 'block', function (BlockInterface $block): bool {\n      if (str_starts_with($block->getPluginId(), 'views_block:')) {\n        $settings = $block->get('settings');\n        if ($settings['items_per_page'] === 'none') {\n          $settings['items_per_page'] = NULL;\n          $block->set('settings', $settings);\n          return TRUE;\n        }\n      }\n      return FALSE;\n    });\n}\n\n/**\n * Clear cache to add new date default arguments.\n */\nfunction views_post_update_add_date_default_arguments(): void {\n  // Empty update to cause a cache rebuild so that schema additions are read.\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/views.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsPostUpdate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the class RateLimitSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\webform_rate_limit\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configuration form for webform rate limiting.\n */\nclass RateLimitSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['webform_rate_limit.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'webform_rate_limit_settings_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $config = $this->config('webform_rate_limit.settings');\n\n    $form['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable rate limiting'),\n      '#description' => $this->t('Enable rate limiting for all webform submissions per IP address.'),\n      '#default_value' => $config->get('enabled'),\n    ];\n\n    $form['limits'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Rate limits'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['limits']['limit_10min'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum submissions per 10 minutes'),\n      '#description' => $this->t('Maximum number of submissions allowed per IP address within a 10-minute window. Applies to all webforms combined.'),\n      '#default_value' => $config->get('limit_10min'),\n      '#min' => 1,\n      '#required' => TRUE,\n    ];\n\n    $form['limits']['limit_24h'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum submissions per 24 hours'),\n      '#description' => $this->t('Maximum number of submissions allowed per IP address within a 24-hour window. Applies to all webforms combined.'),\n      '#default_value' => $config->get('limit_24h'),\n      '#min' => 1,\n      '#required' => TRUE,\n    ];\n\n    $form['messages'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Error messages'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['messages']['message_10min'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('10-minute limit error message'),\n      '#description' => $this->t('Message shown when the 10-minute limit is exceeded.'),\n      '#default_value' => $config->get('message_10min'),\n    ];\n\n    $form['messages']['message_24h'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('24-hour limit error message'),\n      '#description' => $this->t('Message shown when the 24-hour limit is exceeded.'),\n      '#default_value' => $config->get('message_24h'),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->config('webform_rate_limit.settings')\n      ->set('enabled', $form_state->getValue('enabled'))\n      ->set('limit_10min', $form_state->getValue('limit_10min'))\n      ->set('limit_24h', $form_state->getValue('limit_24h'))\n      ->set('message_10min', $form_state->getValue('message_10min'))\n      ->set('message_24h', $form_state->getValue('message_24h'))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/webform_rate_limit/src/Form/RateLimitSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RateLimitSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DocumentLoaderPluginManager in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader;\n\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\document_loader\\Plugin\\DocumentLoaderInterface;\n\n/**\n * Plugin manager for document loader plugins.\n */\nclass DocumentLoaderPluginManager extends DefaultPluginManager {\n\n  /**\n   * Constructs a DocumentLoaderPluginManager object.\n   *\n   * @param \\Traversable<string,string> $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke hooks on.\n   */\n  public function __construct(\n    \\Traversable $namespaces,\n    CacheBackendInterface $cache_backend,\n    ModuleHandlerInterface $module_handler,\n  ) {\n    parent::__construct(\n      'Plugin/DocumentLoader',\n      $namespaces,\n      $module_handler,\n      'Drupal\\document_loader\\Plugin\\DocumentLoaderInterface',\n      'Drupal\\document_loader\\Attribute\\DocumentLoader',\n    );\n\n    $this->setCacheBackend($cache_backend, 'document_loader_plugins');\n    $this->alterInfo('document_loader_info');\n  }\n\n  /**\n   * Gets a document loader plugin by document loader type.\n   *\n   * @param string $document_loader_type\n   *   The document loader type ID.\n   * @param string|null $output_type\n   *   (optional) The desired output type ID.\n   *\n   * @return \\Drupal\\document_loader\\Plugin\\DocumentLoaderInterface|null\n   *   The document loader plugin, or NULL if not found.\n   */\n  public function getLoaderByType(string $document_loader_type, ?string $output_type = NULL): ?object {\n    foreach ($this->getDefinitions() as $plugin_id => $definition) {\n      if (in_array($document_loader_type, $definition['document_loader_types'] ?? [])) {\n        if ($output_type === NULL || in_array($output_type, $definition['output_types'] ?? [])) {\n          try {\n            $instance = $this->createInstance($plugin_id);\n            return $instance instanceof DocumentLoaderInterface ? $instance : NULL;\n          }\n          catch (\\Exception $e) {\n            continue;\n          }\n        }\n      }\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/document_loader/src/DocumentLoaderPluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DocumentLoaderPluginManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class HelpController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\help\\Controller;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Extension\\ExtensionLifecycle;\nuse Drupal\\Core\\Extension\\ModuleExtensionList;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\help\\HelpSectionManager;\nuse Drupal\\system\\ModuleAdminLinksHelper;\nuse Drupal\\user\\ModulePermissionsLinkHelper;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\Autowire;\nuse Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n\n/**\n * Controller routines for help routes.\n */\nclass HelpController extends ControllerBase {\n\n  /**\n   * Creates a new HelpController.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $routeMatch\n   *   The current route match.\n   * @param \\Drupal\\help\\HelpSectionManager $helpManager\n   *   The help section manager.\n   * @param \\Drupal\\Core\\Extension\\ModuleExtensionList $moduleExtensionList\n   *   The module extension list.\n   * @param \\Drupal\\system\\ModuleAdminLinksHelper $moduleAdminLinks\n   *   The module admin links.\n   * @param \\Drupal\\user\\ModulePermissionsLinkHelper $modulePermissionsLinks\n   *   The module permissions link.\n   */\n  public function __construct(\n    protected RouteMatchInterface $routeMatch,\n    #[Autowire(service: 'plugin.manager.help_section')]\n    protected HelpSectionManager $helpManager,\n    protected ModuleExtensionList $moduleExtensionList,\n    protected ModuleAdminLinksHelper $moduleAdminLinks,\n    protected ModulePermissionsLinkHelper $modulePermissionsLinks,\n  ) {\n  }\n\n  /**\n   * Prints a page listing various types of help.\n   *\n   * The page has sections defined by \\Drupal\\help\\HelpSectionPluginInterface\n   * plugins.\n   *\n   * @return array\n   *   A render array for the help page.\n   */\n  public function helpMain() {\n    $output = [];\n\n    // We are checking permissions, so add the user.permissions cache context.\n    $cacheability = new CacheableMetadata();\n    $cacheability->addCacheContexts(['user.permissions']);\n\n    $plugins = $this->helpManager->getDefinitions();\n    $cacheability->addCacheableDependency($this->helpManager);\n\n    foreach ($plugins as $plugin_id => $plugin_definition) {\n      // Check the provided permission.\n      if (!empty($plugin_definition['permission']) && !$this->currentUser()->hasPermission($plugin_definition['permission'])) {\n        continue;\n      }\n\n      // Add the section to the page.\n      /** @var \\Drupal\\help\\HelpSectionPluginInterface $plugin */\n      $plugin = $this->helpManager->createInstance($plugin_id);\n      $this_output = [\n        '#theme' => 'help_section',\n        '#title' => $plugin->getTitle(),\n        '#description' => $plugin->getDescription(),\n        '#empty' => $this->t('There is currently nothing in this section.'),\n        '#links' => [],\n        '#weight' => $plugin_definition['weight'],\n      ];\n\n      $links = $plugin->listTopics();\n      if (is_array($links) && count($links)) {\n        $this_output['#links'] = $links;\n      }\n\n      $cacheability->addCacheableDependency($plugin);\n      $output[$plugin_id] = $this_output;\n    }\n\n    $cacheability->applyTo($output);\n    return $output;\n  }\n\n  /**\n   * Prints a page listing general help for a module.\n   *\n   * @param string $name\n   *   A module name to display a help page for.\n   *\n   * @return array\n   *   A render array as expected by\n   *   \\Drupal\\Core\\Render\\RendererInterface::render().\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException\n   */\n  public function helpPage($name) {\n    $build = [];\n    if ($this->moduleHandler()->hasImplementations('help', $name)) {\n      $module_name = $this->moduleExtensionList->getName($name);\n      $build['#title'] = $module_name;\n\n      $info = $this->moduleExtensionList->getExtensionInfo($name);\n      if ($info[ExtensionLifecycle::LIFECYCLE_IDENTIFIER] === ExtensionLifecycle::EXPERIMENTAL) {\n        $this->messenger()->addWarning($this->t('This module is experimental. <a href=\":url\">Experimental modules</a> are provided for testing purposes only. Use at your own risk.', [':url' => 'https://www.drupal.org/core/experimental']));\n      }\n\n      $temp = $this->moduleHandler()->invoke($name, 'help', [\"help.page.$name\", $this->routeMatch]);\n      if (empty($temp)) {\n        $build['top'] = ['#markup' => $this->t('No help is available for module %module.', ['%module' => $module_name])];\n      }\n      else {\n        if (!is_array($temp)) {\n          $temp = ['#markup' => $temp];\n        }\n        $build['top'] = $temp;\n      }\n\n      // Only print list of administration pages if the module in question has\n      // any such pages associated with it.\n      $admin_tasks = $this->moduleAdminLinks->getModuleAdminLinks($name);\n      if ($module_permissions_link = $this->modulePermissionsLinks->getModulePermissionsLink($name, $info['name'])) {\n        $admin_tasks[\"user.admin_permissions.{$name}\"] = $module_permissions_link;\n      }\n      if (!empty($admin_tasks)) {\n        $links = [];\n        foreach ($admin_tasks as $task) {\n          $link['url'] = $task['url'];\n          $link['title'] = $task['title'];\n          $links[] = $link;\n        }\n        $build['links'] = [\n          '#theme' => 'links__help',\n          '#heading' => [\n            'level' => 'h3',\n            'text' => $this->t('@module administration pages', ['@module' => $module_name]),\n          ],\n          '#links' => $links,\n        ];\n      }\n      return $build;\n    }\n    else {\n      throw new NotFoundHttpException();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/help/src/Controller/HelpController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DateRangeDefaultWidget in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime_range\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Field\\Attribute\\FieldWidget;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\datetime_range\\Plugin\\Field\\FieldType\\DateRangeItem;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Plugin implementation of the 'daterange_default' widget.\n */\n#[FieldWidget(\n  id: 'daterange_default',\n  label: new TranslatableMarkup('Date and time range'),\n  field_types: ['daterange'],\n)]\nclass DateRangeDefaultWidget extends DateRangeWidgetBase {\n\n  /**\n   * The date format storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected $dateStorage;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct($plugin_id, $plugin_definition, FieldDefinitionInterface $field_definition, array $settings, array $third_party_settings, EntityStorageInterface $date_storage) {\n    parent::__construct($plugin_id, $plugin_definition, $field_definition, $settings, $third_party_settings);\n\n    $this->dateStorage = $date_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $plugin_id,\n      $plugin_definition,\n      $configuration['field_definition'],\n      $configuration['settings'],\n      $configuration['third_party_settings'],\n      $container->get('entity_type.manager')->getStorage('date_format')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $element = parent::formElement($items, $delta, $element, $form, $form_state);\n\n    // Identify the type of date and time elements to use.\n    switch ($this->getFieldSetting('datetime_type')) {\n      case DateRangeItem::DATETIME_TYPE_DATE:\n      case DateRangeItem::DATETIME_TYPE_ALLDAY:\n        $date_type = 'date';\n        $time_type = 'none';\n        $date_format = $this->dateStorage->load('html_date')->getPattern();\n        $time_format = '';\n        break;\n\n      default:\n        $date_type = 'date';\n        $time_type = 'time';\n        $date_format = $this->dateStorage->load('html_date')->getPattern();\n        $time_format = $this->dateStorage->load('html_time')->getPattern();\n        break;\n    }\n\n    $element['value'] += [\n      '#date_date_format' => $date_format,\n      '#date_date_element' => $date_type,\n      '#date_date_callbacks' => [],\n      '#date_time_format' => $time_format,\n      '#date_time_element' => $time_type,\n      '#date_time_callbacks' => [],\n    ];\n\n    $element['end_value'] += [\n      '#date_date_format' => $date_format,\n      '#date_date_element' => $date_type,\n      '#date_date_callbacks' => [],\n      '#date_time_format' => $time_format,\n      '#date_time_element' => $time_type,\n      '#date_time_callbacks' => [],\n    ];\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime_range/src/Plugin/Field/FieldWidget/DateRangeDefaultWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateRangeDefaultWidget", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PackageManagerUpdateProcessor in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\package_manager;\n\nuse Drupal\\Component\\Datetime\\TimeInterface;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\KeyValueStore\\KeyValueExpirableFactoryInterface;\nuse Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface;\nuse Drupal\\Core\\PrivateKey;\nuse Drupal\\Core\\Queue\\QueueFactory;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\update\\UpdateFetcherInterface;\nuse Drupal\\update\\UpdateProcessor;\n\n/**\n * Extends the Update Status update processor allow fetching any project.\n *\n * The Update Status module's update processor service is intended to only fetch\n * information for projects in the active codebase. Although it would be\n * possible to use the Update Status module's update processor service to fetch\n * information for projects not in the active code base this would add the\n * project information to Update Status module's cache which would result in\n * these projects being returned from the Update Status module's global\n * functions such as update_get_available().\n *\n * @internal\n *   This is an internal part of Package Manager and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class PackageManagerUpdateProcessor extends UpdateProcessor {\n\n  public function __construct(\n    ConfigFactoryInterface $config_factory,\n    QueueFactory $queue_factory,\n    UpdateFetcherInterface $update_fetcher,\n    StateInterface $state_store,\n    PrivateKey $private_key,\n    KeyValueFactoryInterface $key_value_factory,\n    KeyValueExpirableFactoryInterface $key_value_expirable_factory,\n    TimeInterface $time,\n  ) {\n    parent::__construct(...func_get_args());\n    $this->fetchQueue = $queue_factory->get('package_manager.update_fetch_tasks');\n    $this->tempStore = $key_value_expirable_factory->get('package_manager.update');\n    $this->fetchTaskStore = $key_value_factory->get('package_manager.update_fetch_task');\n    $this->availableReleasesTempStore = $key_value_expirable_factory->get('package_manager.update_available_releases');\n  }\n\n  /**\n   * Gets the project data by name.\n   *\n   * @param string $name\n   *   The project name.\n   *\n   * @return mixed[]\n   *   The project data if any is available, otherwise NULL.\n   */\n  public function getProjectData(string $name): ?array {\n    if ($this->availableReleasesTempStore->has($name)) {\n      return $this->availableReleasesTempStore->get($name);\n    }\n    $project_fetch_data = [\n      'name' => $name,\n      'project_type' => 'unknown',\n      'includes' => [],\n    ];\n    $this->createFetchTask($project_fetch_data);\n    if ($this->processFetchTask($project_fetch_data)) {\n      // If the fetch task was successful return the project information.\n      return $this->availableReleasesTempStore->get($name);\n    }\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processFetchTask($project) {\n    // The parent method will set 'update.last_check' which will be used to\n    // inform the user when the last time update information was checked. In\n    // order to leave this value unaffected we will reset this to its previous\n    // value.\n    $last_check = $this->stateStore->get('update.last_check');\n    $success = parent::processFetchTask($project);\n    $this->stateStore->set('update.last_check', $last_check);\n    return $success;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/package_manager/src/PackageManagerUpdateProcessor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PackageManagerUpdateProcessor", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PathAlias in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\path_alias\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ContentEntityType;\nuse Drupal\\Core\\Entity\\ContentEntityBase;\nuse Drupal\\Core\\Entity\\EntityPublishedTrait;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Field\\BaseFieldDefinition;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\path_alias\\PathAliasInterface;\nuse Drupal\\path_alias\\PathAliasStorage;\nuse Drupal\\path_alias\\PathAliasStorageSchema;\n\n/**\n * Defines the path_alias entity class.\n */\n#[ContentEntityType(\n  id: 'path_alias',\n  label: new TranslatableMarkup('URL alias'),\n  label_collection: new TranslatableMarkup('URL aliases'),\n  label_singular: new TranslatableMarkup('URL alias'),\n  label_plural: new TranslatableMarkup('URL aliases'),\n  entity_keys: [\n    'id' => 'id',\n    'revision' => 'revision_id',\n    'langcode' => 'langcode',\n    'uuid' => 'uuid',\n    'published' => 'status',\n  ],\n  handlers: [\n    'storage' => PathAliasStorage::class,\n    'storage_schema' => PathAliasStorageSchema::class,\n  ],\n  admin_permission: 'administer url aliases',\n  base_table: 'path_alias',\n  revision_table: 'path_alias_revision',\n  label_count: [\n    'singular' => '@count URL alias',\n    'plural' => '@count URL aliases',\n  ],\n  list_cache_tags: ['route_match'],\n  constraints: [\n    'UniquePathAlias' => [],\n  ],\n)]\nclass PathAlias extends ContentEntityBase implements PathAliasInterface {\n\n  use EntityPublishedTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function baseFieldDefinitions(EntityTypeInterface $entity_type) {\n    $fields = parent::baseFieldDefinitions($entity_type);\n\n    $fields['path'] = BaseFieldDefinition::create('string')\n      ->setLabel(new TranslatableMarkup('System path'))\n      ->setDescription(new TranslatableMarkup('The path that this alias belongs to.'))\n      ->setRequired(TRUE)\n      ->setRevisionable(TRUE)\n      ->addPropertyConstraints('value', [\n        'Regex' => [\n          'pattern' => '/^\\//i',\n          'message' => new TranslatableMarkup('The source path has to start with a slash.'),\n        ],\n      ])\n      ->addPropertyConstraints('value', ['ValidPath' => []]);\n\n    $fields['alias'] = BaseFieldDefinition::create('string')\n      ->setLabel(new TranslatableMarkup('URL alias'))\n      ->setDescription(new TranslatableMarkup('An alias used with this path.'))\n      ->setRequired(TRUE)\n      ->setRevisionable(TRUE)\n      ->addPropertyConstraints('value', [\n        'Regex' => [\n          'pattern' => '/^\\//i',\n          'message' => new TranslatableMarkup('The alias path has to start with a slash.'),\n        ],\n      ]);\n\n    $fields['langcode']->setDefaultValue(LanguageInterface::LANGCODE_NOT_SPECIFIED);\n\n    // Add the published field.\n    $fields += static::publishedBaseFieldDefinitions($entity_type);\n    $fields['status']->setTranslatable(FALSE);\n\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preSave(EntityStorageInterface $storage) {\n    parent::preSave($storage);\n\n    // Trim the alias value of whitespace and slashes. Ensure to not trim the\n    // slash on the left side.\n    $alias = rtrim(trim($this->getAlias()), \"\\\\/\");\n    $this->setAlias($alias);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function postSave(EntityStorageInterface $storage, $update = TRUE) {\n    parent::postSave($storage, $update);\n\n    $alias_manager = \\Drupal::service('path_alias.manager');\n    $alias_manager->cacheClear($this->getPath());\n    if ($update) {\n      $alias_manager->cacheClear($this->getOriginal()->getPath());\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function postDelete(EntityStorageInterface $storage, array $entities) {\n    parent::postDelete($storage, $entities);\n\n    $alias_manager = \\Drupal::service('path_alias.manager');\n    foreach ($entities as $entity) {\n      $alias_manager->cacheClear($entity->getPath());\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPath() {\n    return $this->get('path')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPath($path) {\n    $this->set('path', $path);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAlias() {\n    return $this->get('alias')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setAlias($alias) {\n    $this->set('alias', $alias);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function label() {\n    return $this->getAlias();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheTagsToInvalidate() {\n    return ['route_match'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path_alias/src/Entity/PathAlias.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathAlias", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: BlocksDataCollector\nSource file: <source_file>\nFile name hint: BlocksDataCollector.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\webprofiler\\Entity\\EntityDecorator;\nuse Drupal\\webprofiler\\Entity\\EntityTypeManagerWrapper;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\n\n/**\n * Collects blocks data.\n */\nclass BlocksDataCollector extends DataCollector implements HasPanelInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * BlocksDataCollector constructor.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityManager\n   *   The Entity type manager service.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityManager,\n  ) {\n    $this->data['blocks']['loaded'] = [];\n    $this->data['blocks']['rendered'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'blocks';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n    $storage = $this->entityManager->getStorage('block');\n\n    \\assert($this->entityManager instanceof EntityTypeManagerWrapper);\n    $loaded = $this->entityManager->getLoaded('config', 'block');\n    $rendered = $this->entityManager->getRendered('block');\n\n    if ($loaded != NULL) {\n      $this->data['blocks']['loaded'] = $this->getBlocksData($loaded, $storage);\n    }\n\n    if ($rendered != NULL) {\n      $this->data['blocks']['rendered'] = $this->getBlocksData($rendered, $storage);\n    }\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return a list of rendered blocks.\n   *\n   * @return array\n   *   A list of rendered blocks.\n   */\n  public function getRenderedBlocks(): array {\n    return $this->data['blocks']['rendered'];\n  }\n\n  /**\n   * Return the number of rendered blocks.\n   *\n   * @return int\n   *   The number of rendered blocks.\n   */\n  public function getRenderedBlocksCount(): int {\n    return \\count($this->getRenderedBlocks());\n  }\n\n  /**\n   * Return a list of loaded blocks.\n   *\n   * @return array\n   *   A list of loaded blocks.\n   */\n  public function getLoadedBlocks(): array {\n    return $this->data['blocks']['loaded'];\n  }\n\n  /**\n   * Return the number of loaded blocks.\n   *\n   * @return int\n   *   The number of rendered blocks.\n   */\n  public function getLoadedBlocksCount(): int {\n    return \\count($this->getLoadedBlocks());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    $tabs = [\n      [\n        'label' => 'Loaded',\n        'content' => $this->renderBlocks($this->getLoadedBlocks(), 'Loaded'),\n      ],\n      [\n        'label' => 'Rendered',\n        'content' => $this->renderBlocks($this->getRenderedBlocks(), 'Rendered'),\n      ],", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\webprofiler\\Entity\\EntityDecorator;\nuse Drupal\\webprofiler\\Entity\\EntityTypeManagerWrapper;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\n\n/**\n * Collects blocks data.\n */\nclass BlocksDataCollector extends DataCollector implements HasPanelInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * BlocksDataCollector constructor.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityManager\n   *   The Entity type manager service.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityManager,\n  ) {\n    $this->data['blocks']['loaded'] = [];\n    $this->data['blocks']['rendered'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'blocks';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n    $storage = $this->entityManager->getStorage('block');\n\n    \\assert($this->entityManager instanceof EntityTypeManagerWrapper);\n    $loaded = $this->entityManager->getLoaded('config', 'block');\n    $rendered = $this->entityManager->getRendered('block');\n\n    if ($loaded != NULL) {\n      $this->data['blocks']['loaded'] = $this->getBlocksData($loaded, $storage);\n    }\n\n    if ($rendered != NULL) {\n      $this->data['blocks']['rendered'] = $this->getBlocksData($rendered, $storage);\n    }\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return a list of rendered blocks.\n   *\n   * @return array\n   *   A list of rendered blocks.\n   */\n  public function getRenderedBlocks(): array {\n    return $this->data['blocks']['rendered'];\n  }\n\n  /**\n   * Return the number of rendered blocks.\n   *\n   * @return int\n   *   The number of rendered blocks.\n   */\n  public function getRenderedBlocksCount(): int {\n    return \\count($this->getRenderedBlocks());\n  }\n\n  /**\n   * Return a list of loaded blocks.\n   *\n   * @return array\n   *   A list of loaded blocks.\n   */\n  public function getLoadedBlocks(): array {\n    return $this->data['blocks']['loaded'];\n  }\n\n  /**\n   * Return the number of loaded blocks.\n   *\n   * @return int\n   *   The number of rendered blocks.\n   */\n  public function getLoadedBlocksCount(): int {\n    return \\count($this->getLoadedBlocks());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    $tabs = [\n      [\n        'label' => 'Loaded',\n        'content' => $this->renderBlocks($this->getLoadedBlocks(), 'Loaded'),\n      ],\n      [\n        'label' => 'Rendered',\n        'content' => $this->renderBlocks($this->getRenderedBlocks(), 'Rendered'),\n      ],\n    ];\n\n    return [\n      '#theme' => 'webprofiler_dashboard_tabs',\n      '#tabs' => $tabs,\n    ];\n  }\n\n  /**\n   * Return the data to store about blocks.\n   *\n   * @param \\Drupal\\webprofiler\\Entity\\EntityDecorator $decorator\n   *   An entity decorator.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $storage\n   *   The block storage service.\n   *\n   * @return array\n   *   The data to store about blocks.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  private function getBlocksData(EntityDecorator $decorator, EntityStorageInterface $storage): array {\n    $blocks = [];\n\n    /** @var \\Drupal\\block\\BlockInterface $block */\n    foreach ($decorator->getEntities() as $block) {\n      if ($block != NULL) {\n        /** @var \\Drupal\\block\\Entity\\Block|null $entity */\n        $entity = $storage->load($block->get('id'));\n\n        if ($entity != NULL) {\n          $route = '';\n          if ($entity->hasLinkTemplate('edit-form')) {\n            $route = $entity->toUrl('edit-form')->toString();\n          }\n\n          $id = $block->get('id');\n          $blocks[$id] = [\n            'id' => $id,\n            'region' => $block->getRegion(),\n            'status' => $block->get('status'),\n            'theme' => $block->getTheme(),\n            'plugin' => $block->get('plugin'),\n            'settings' => $block->get('settings'),\n            'route' => $route,\n          ];\n        }\n      }\n    }\n\n    return $blocks;\n  }\n\n  /**\n   * Render a list of blocks.\n   *\n   * @param array $blocks\n   *   The list of blocks to render.\n   * @param string $label\n   *   The list's label.\n   *\n   * @return array\n   *   The render array of the list of blocks.\n   */\n  private function renderBlocks(array $blocks, string $label): array {\n    if (\\count($blocks) == 0) {\n      return [\n        $label => [\n          '#markup' => '<p>' . $this->t('No @label blocks collected',\n              ['@label' => $label]) . '</p>',\n        ],\n      ];\n    }\n\n    $rows = [];\n    foreach ($blocks as $block) {\n      $rows[] = [\n        $block['id'],\n        $block['settings']['label'],\n        $block['region'] ?? 'No region',\n        $block['settings']['provider'],\n        $block['theme'],\n        $block['status'] ? $this->t('Enabled') : $this->t('Disabled'),\n        $block['plugin'],\n      ];\n    }\n\n    return [\n      $label => [\n        '#theme' => 'webprofiler_dashboard_section',\n        '#data' => [\n          '#type' => 'table',\n          '#header' => [\n            $this->t('ID'),\n            $this->t('Label'),\n            $this->t('Region'),\n            $this->t('Source'),\n            $this->t('Theme'),\n            $this->t('Status'),\n            $this->t('Plugin'),\n          ],\n          '#rows' => $rows,\n          '#attributes' => [\n            'class' => [\n              'webprofiler__table',\n            ],\n          ],\n          '#sticky' => TRUE,\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/BlocksDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlocksDataCollector", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: MonthDate\nSource file: <source_file>\nFile name hint: MonthDate.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a month.\n */\n[ViewsArgument(\n  id: 'datetime_month',\n)]\nclass MonthDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'm';\n\n}", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a month.\n */\n#[ViewsArgument(\n  id: 'datetime_month',\n)]\nclass MonthDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'm';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/views/argument/MonthDate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MonthDate", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class SearchLocalTask in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\search\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\search\\SearchPageRepositoryInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides local tasks for each search page.\n */\nclass SearchLocalTask extends DeriverBase implements ContainerDeriverInterface {\n\n  /**\n   * The search page repository.\n   *\n   * @var \\Drupal\\search\\SearchPageRepositoryInterface\n   */\n  protected $searchPageRepository;\n\n  /**\n   * Constructs a new SearchLocalTask.\n   *\n   * @param \\Drupal\\search\\SearchPageRepositoryInterface $search_page_repository\n   *   The search page repository.\n   */\n  public function __construct(SearchPageRepositoryInterface $search_page_repository) {\n    $this->searchPageRepository = $search_page_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $container->get('search.search_page_repository')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $this->derivatives = [];\n\n    if ($this->searchPageRepository->getDefaultSearchPage()) {\n      $active_search_pages = $this->searchPageRepository->getActiveSearchPages();\n      foreach ($this->searchPageRepository->sortSearchPages($active_search_pages) as $entity_id => $entity) {\n        $this->derivatives[$entity_id] = [\n          'title' => $entity->label(),\n          'route_name' => 'search.view_' . $entity_id,\n          'base_route' => 'search.view',\n          'weight' => $entity->getWeight(),\n        ];\n      }\n    }\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/src/Plugin/Derivative/SearchLocalTask.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SearchLocalTask", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EckEntityTypeDeleteForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eck\\Form\\EntityType;\n\nuse Drupal\\Core\\Entity\\EntityDeleteForm;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Provides a confirm form for deleting the entity.\n *\n * @ingroup eck\n */\nclass EckEntityTypeDeleteForm extends EntityDeleteForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion() {\n    return $this->t('Are you sure you want to delete entity type %label?', [\n      '%label' => $this->entity->label(),\n    ]\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText() {\n    return $this->t('Delete entity type');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl() {\n    return new Url('eck.entity_type.list');\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Exception\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $content_number = $this->entityTypeManager\n      ->getStorage($this->entity->id())\n      ->getQuery()\n      ->accessCheck(FALSE)\n      ->count()\n      ->execute();\n\n    if (!empty($content_number)) {\n      $warning_message = '<p>' . $this->formatPlural($content_number, 'There is 1 %type entity. You can not remove this entity type until you have removed all of the %type entities.', 'There are @count %type entities. You may not remove %type until you have removed all of the %type entities.', ['%type' => $this->entity->label()]) . '</p>';\n\n      $form['#title'] = $this->getConfirmText();\n      $form['description'] = ['#markup' => $warning_message];\n      return $form;\n    }\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    parent::submitForm($form, $form_state);\n\n    // Redirect to list when completed.\n    $form_state->setRedirectUrl(new Url('eck.entity_type.list'));\n  }\n\n}\n", "metadata": {"source": "repos/eck/src/Form/EntityType/EckEntityTypeDeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EckEntityTypeDeleteForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "ai_components.build_form:\n  path: '/ai-components/build'\n  defaults:\n    _form: '\\Drupal\\ai_components\\Form\\ComponentBuilderForm'\n    _title: 'AI Component Builder'\n  requirements:\n    _custom_access: '\\Drupal\\ai_components\\Controller\\AIComponentPreviewController::access'\n\nai_components.preview:\n  path: '/ai-components/preview/{component_name}'\n  defaults:\n    _controller: '\\Drupal\\ai_components\\Controller\\AIComponentPreviewController::preview'\n    _title: 'AI Component Preview'\n  requirements:\n    _custom_access: '\\Drupal\\ai_components\\Controller\\AIComponentPreviewController::access'\n  options:\n    parameters:\n      component_name:\n        type: string\n", "metadata": {"source": "repos/ai_components/ai_components.routing.yml", "type": "yaml_reference", "topic": "ai components.routing"}}
{"instruction": "Show me the implementation of the class DateRangeWidgetBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime_range\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Datetime\\DrupalDateTime;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItemInterface;\nuse Drupal\\datetime\\Plugin\\Field\\FieldWidget\\DateTimeWidgetBase;\nuse Drupal\\datetime_range\\Plugin\\Field\\FieldType\\DateRangeItem;\n\n/**\n * Base class for the 'daterange_*' widgets.\n */\nclass DateRangeWidgetBase extends DateTimeWidgetBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $element = parent::formElement($items, $delta, $element, $form, $form_state);\n\n    // Wrap all of the select elements with a fieldset.\n    $element['#theme_wrappers'][] = 'fieldset';\n\n    $element['#element_validate'][] = [$this, 'validateStartEnd'];\n    $element['value']['#title'] = $this->t('Start date');\n\n    $element['end_value'] = [\n      '#title' => $this->t('End date'),\n    ] + $element['value'];\n\n    if ($items[$delta]->start_date) {\n      /** @var \\Drupal\\Core\\Datetime\\DrupalDateTime $start_date */\n      $start_date = $items[$delta]->start_date;\n      $element['value']['#default_value'] = $this->createDefaultValue($start_date, $element['value']['#date_timezone']);\n    }\n\n    if ($items[$delta]->end_date) {\n      /** @var \\Drupal\\Core\\Datetime\\DrupalDateTime $end_date */\n      $end_date = $items[$delta]->end_date;\n      $element['end_value']['#default_value'] = $this->createDefaultValue($end_date, $element['end_value']['#date_timezone']);\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function massageFormValues(array $values, array $form, FormStateInterface $form_state) {\n    // The widget form element type has transformed the value to a\n    // DrupalDateTime object at this point. We need to convert it back to the\n    // storage timezone and format.\n\n    $datetime_type = $this->getFieldSetting('datetime_type');\n    if ($datetime_type === DateRangeItem::DATETIME_TYPE_DATE) {\n      $storage_format = DateTimeItemInterface::DATE_STORAGE_FORMAT;\n    }\n    else {\n      $storage_format = DateTimeItemInterface::DATETIME_STORAGE_FORMAT;\n    }\n\n    $storage_timezone = new \\DateTimeZone(DateTimeItemInterface::STORAGE_TIMEZONE);\n    $user_timezone = new \\DateTimeZone(date_default_timezone_get());\n\n    foreach ($values as &$item) {\n      if (!empty($item['value']) && $item['value'] instanceof DrupalDateTime) {\n        /** @var \\Drupal\\Core\\Datetime\\DrupalDateTime $start_date */\n        $start_date = $item['value'];\n\n        if ($datetime_type === DateRangeItem::DATETIME_TYPE_ALLDAY) {\n          // All day fields start at midnight on the starting date, but are\n          // stored like datetime fields, so we need to adjust the time.\n          // This function is called twice, so to prevent a double conversion\n          // we need to explicitly set the timezone.\n          $start_date->setTimeZone($user_timezone)->setTime(0, 0, 0);\n        }\n\n        // Adjust the date for storage.\n        $item['value'] = $start_date->setTimezone($storage_timezone)->format($storage_format);\n      }\n\n      if (!empty($item['end_value']) && $item['end_value'] instanceof DrupalDateTime) {\n        /** @var \\Drupal\\Core\\Datetime\\DrupalDateTime $end_date */\n        $end_date = $item['end_value'];\n\n        if ($datetime_type === DateRangeItem::DATETIME_TYPE_ALLDAY) {\n          // All day fields start at midnight on the starting date, but are\n          // stored like datetime fields, so we need to adjust the time.\n          // This function is called twice, so to prevent a double conversion\n          // we need to explicitly set the timezone.\n          $end_date->setTimeZone($user_timezone)->setTime(23, 59, 59);\n        }\n\n        // Adjust the date for storage.\n        $item['end_value'] = $end_date->setTimezone($storage_timezone)->format($storage_format);\n      }\n    }\n\n    return $values;\n  }\n\n  /**\n   * Render API callback: Validates that the start date <= the end date.\n   *\n   * This function is assigned as a #element_validate callback.\n   *\n   * @param array $element\n   *   An associative array containing the properties and children of the\n   *   generic form element.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   * @param array $complete_form\n   *   The complete form structure.\n   */\n  public function validateStartEnd(array &$element, FormStateInterface $form_state, array &$complete_form) {\n    $start_date = $element['value']['#value']['object'];\n    $end_date = $element['end_value']['#value']['object'];\n\n    if ($start_date instanceof DrupalDateTime && $end_date instanceof DrupalDateTime) {\n      if ($start_date->getTimestamp() !== $end_date->getTimestamp()) {\n        $interval = $start_date->diff($end_date);\n        if ($interval->invert === 1) {\n          $form_state->setError($element, $this->t('The @title end date cannot be before the start date', ['@title' => $element['#title']]));\n        }\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime_range/src/Plugin/Field/FieldWidget/DateRangeWidgetBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateRangeWidgetBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: views.post_update.php\nTarget symbol: class views.post_update\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for views.post_update.\n- Include required imports:\n  - Drupal\\block\\BlockInterface\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityUpdater\n  - Drupal\\views\\ViewEntityInterface\n  - Drupal\\views\\ViewsConfigUpdater\n- Ensure these methods exist where relevant:\n  - views_post_update_add_date_default_arguments()\n  - views_post_update_block_items_per_page()\n  - views_post_update_format_plural()\n  - views_post_update_table_css_class()\n  - views_post_update_update_remember_role_empty()\n  - views_post_update_views_data_argument_plugin_id()\n  - views_removed_post_updates()", "output": "<?php\n\n/**\n * @file\n * Post update functions for Views.\n */\n\nuse Drupal\\block\\BlockInterface;\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityUpdater;\nuse Drupal\\views\\ViewEntityInterface;\nuse Drupal\\views\\ViewsConfigUpdater;\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction views_removed_post_updates(): array {\n  return [\n    'views_post_update_update_cacheability_metadata' => '9.0.0',\n    'views_post_update_cleanup_duplicate_views_data' => '9.0.0',\n    'views_post_update_field_formatter_dependencies' => '9.0.0',\n    'views_post_update_taxonomy_index_tid' => '9.0.0',\n    'views_post_update_serializer_dependencies' => '9.0.0',\n    'views_post_update_boolean_filter_values' => '9.0.0',\n    'views_post_update_grouped_filters' => '9.0.0',\n    'views_post_update_revision_metadata_fields' => '9.0.0',\n    'views_post_update_entity_link_url' => '9.0.0',\n    'views_post_update_bulk_field_moved' => '9.0.0',\n    'views_post_update_filter_placeholder_text' => '9.0.0',\n    'views_post_update_views_data_table_dependencies' => '9.0.0',\n    'views_post_update_table_display_cache_max_age' => '9.0.0',\n    'views_post_update_exposed_filter_blocks_label_display' => '9.0.0',\n    'views_post_update_make_placeholders_translatable' => '9.0.0',\n    'views_post_update_limit_operator_defaults' => '9.0.0',\n    'views_post_update_remove_core_key' => '9.0.0',\n    'views_post_update_field_names_for_multivalue_fields' => '10.0.0',\n    'views_post_update_configuration_entity_relationships' => '10.0.0',\n    'views_post_update_rename_default_display_setting' => '10.0.0',\n    'views_post_update_remove_sorting_global_text_field' => '10.0.0',\n    'views_post_update_title_translations' => '10.0.0',\n    'views_post_update_sort_identifier' => '10.0.0',\n    'views_post_update_provide_revision_table_relationship' => '10.0.0',\n    'views_post_update_image_lazy_load' => '10.0.0',\n    'views_post_update_boolean_custom_titles' => '11.0.0',\n    'views_post_update_oembed_eager_load' => '11.0.0',\n    'views_post_update_responsive_image_lazy_load' => '11.0.0',\n    'views_post_update_timestamp_formatter' => '11.0.0',\n    'views_post_update_fix_revision_id_part' => '11.0.0',\n    'views_post_update_add_missing_labels' => '11.0.0',\n    'views_post_update_remove_skip_cache_setting' => '11.0.0',\n    'views_post_update_remove_default_argument_skip_url' => '11.0.0',\n    'views_post_update_taxonomy_filter_user_context' => '11.0.0',\n    'views_post_update_pager_heading' => '11.0.0',\n    'views_post_update_rendered_entity_field_cache_metadata' => '11.0.0',\n  ];\n}\n\n/**\n * Post update configured views for entity reference argument plugin IDs.\n */\nfunction views_post_update_views_data_argument_plugin_id(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::service(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsEntityArgumentUpdate($view);\n  });\n}\n\n/**\n * Updates the format plural option for those views using aggregation.\n */\nfunction views_post_update_format_plural(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::classResolver(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsFormatPluralUpdate($view);\n  });\n}\n\n/**\n * Clean-up empty remember_roles display settings for views filters.\n */\nfunction views_post_update_update_remember_role_empty(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::service(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsRememberRolesUpdate($view);\n  });\n}\n\n/**\n * Adds a default table CSS class.\n */\nfunction views_post_update_table_css_class(?array &$sandbox = NULL): void {\n  /** @var \\Drupal\\views\\ViewsConfigUpdater $view_config_updater */\n  $view_config_updater = \\Drupal::service(ViewsConfigUpdater::class);\n  $view_config_updater->setDeprecationsEnabled(FALSE);\n  \\Drupal::classResolver(ConfigEntityUpdater::class)->update($sandbox, 'view', function (ViewEntityInterface $view) use ($view_config_updater): bool {\n    return $view_config_updater->needsTableCssClassUpdate($view);\n  });\n}\n\n/**\n * Defaults `items_per_page` to NULL in Views blocks.\n */\nfunction views_post_update_block_items_per_page(?array &$sandbox = NULL): void {\n  if (!\\Drupal::moduleHandler()->moduleExists('block')) {\n    return;\n  }\n  \\Drupal::classResolver(ConfigEntityUpdater::class)\n    ->update($sandbox, 'block', function (BlockInterface $block): bool {\n      if (str_starts_with($block->getPluginId(), 'views_block:')) {\n        $settings = $block->get('settings');\n        if ($settings['items_per_page'] === 'none') {\n          $settings['items_per_page'] = NULL;\n          $block->set('settings', $settings);\n          return TRUE;\n        }\n      }\n      return FALSE;\n    });\n}\n\n/**\n * Clear cache to add new date default arguments.\n */\nfunction views_post_update_add_date_default_arguments(): void {\n  // Empty update to cause a cache rebuild so that schema additions are read.\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/views.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsPostUpdate", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% extends \"block.html.twig\" %}\n{#\n/**\n * @file\n * Theme override for a branding block.\n *\n * Each branding element variable (logo, name, slogan) is only available if\n * enabled in the block configuration.\n *\n * Available variables:\n * - site_logo: Logo for site as defined in Appearance or theme settings.\n * - site_name: Name for site as defined in Site information settings.\n * - site_slogan: Slogan for site as defined in Site information settings.\n */\n#}\n{% block content %}\n  {% embed 'umami:branding' with {\n    attributes: create_attribute(),\n    site_logo,\n    site_name,\n    site_slogan,\n    url: path('<front>'),\n  } only %}\n    {% block site_name %}\n      {{ site_name }}\n    {% endblock %}\n    {% block site_slogan %}\n      {{ site_slogan }}\n    {% endblock %}\n  {% endembed %}\n{% endblock %}\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/components/branding/block--system-branding-block.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ThemeNegotiatorWrapper\nSource file: <source_file>\nFile name hint: ThemeNegotiatorWrapper.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Theme;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Theme\\ThemeNegotiator;\nuse Drupal\\Core\\Theme\\ThemeNegotiatorInterface;\n\n/**\n * Extends the ThemeNegotiatorWrapper to collect the current theme negotiator.\n */\nclass ThemeNegotiatorWrapper extends ThemeNegotiator {\n\n  /**\n   * The current theme negotiator.\n   *\n   * @var \\Drupal\\Core\\Theme\\ThemeNegotiatorInterface\n   */\n  private ThemeNegotiatorInterface $negotiator;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function determineActiveTheme(RouteMatchInterface $route_match) {\n    foreach ($this->negotiators as $negotiator_id) {\n      $negotiator = $this->classResolver->getInstanceFromDefinition($negotiator_id);\n      \\assert($negotiator instanceof ThemeNegotiatorInterface);\n\n      if ($negotiator->applies($route_match)) {\n        $theme = $negotiator->determineActiveTheme($route_match);\n        if ($theme !== NULL && $this->themeAccess->checkAccess($theme)) {\n          $this->negotiator = $negotiator;\n\n          return $theme;\n        }\n      }\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Return the current theme negotiator.\n   *\n   * @return \\Drupal\\Core\\Theme\\ThemeNegotiatorInterface|null\n   *   The current theme negotiator.\n   */\n  public function getNegotiator(): ?ThemeNegotiatorInterface {\n    return $this->negotiator ?? NULL;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Theme;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Theme\\ThemeNegotiator;\nuse Drupal\\Core\\Theme\\ThemeNegotiatorInterface;\n\n/**\n * Extends the ThemeNegotiatorWrapper to collect the current theme negotiator.\n */\nclass ThemeNegotiatorWrapper extends ThemeNegotiator {\n\n  /**\n   * The current theme negotiator.\n   *\n   * @var \\Drupal\\Core\\Theme\\ThemeNegotiatorInterface\n   */\n  private ThemeNegotiatorInterface $negotiator;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function determineActiveTheme(RouteMatchInterface $route_match) {\n    foreach ($this->negotiators as $negotiator_id) {\n      $negotiator = $this->classResolver->getInstanceFromDefinition($negotiator_id);\n      \\assert($negotiator instanceof ThemeNegotiatorInterface);\n\n      if ($negotiator->applies($route_match)) {\n        $theme = $negotiator->determineActiveTheme($route_match);\n        if ($theme !== NULL && $this->themeAccess->checkAccess($theme)) {\n          $this->negotiator = $negotiator;\n\n          return $theme;\n        }\n      }\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Return the current theme negotiator.\n   *\n   * @return \\Drupal\\Core\\Theme\\ThemeNegotiatorInterface|null\n   *   The current theme negotiator.\n   */\n  public function getNegotiator(): ?ThemeNegotiatorInterface {\n    return $this->negotiator ?? NULL;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Theme/ThemeNegotiatorWrapper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ThemeNegotiatorWrapper", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use media:\n  title: 'Use MCP media tools'\n  description: 'Create, upload, and manage media entities via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_media/mcp_tools_media.permissions.yml", "type": "yaml_reference", "topic": "mcp tools media.permissions"}}
{"instruction": "Show me the implementation of the class BatchController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Controller;\n\nuse Drupal\\Core\\Batch\\BatchStorageInterface;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException;\n\n/**\n * Controller routines for batch routes.\n */\nclass BatchController implements ContainerInjectionInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * Constructs a new BatchController.\n   */\n  public function __construct(\n    protected string $root,\n    protected BatchStorageInterface $batchStorage,\n  ) {\n    require_once $this->root . '/core/includes/batch.inc';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->getParameter('app.root'),\n      $container->get('batch.storage'),\n    );\n  }\n\n  /**\n   * Returns a system batch page.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\Response|array\n   *   A \\Symfony\\Component\\HttpFoundation\\Response object or render array.\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException\n   */\n  public function batchPage(Request $request) {\n    $output = _batch_page($request);\n\n    if ($output === FALSE) {\n      throw new AccessDeniedHttpException();\n    }\n    elseif ($output instanceof Response) {\n      return $output;\n    }\n    elseif (isset($output)) {\n      $title = $output['#title'] ?? NULL;\n      $page = [\n        '#type' => 'page',\n        '#title' => $title,\n        '#show_messages' => FALSE,\n        'content' => $output,\n      ];\n\n      // Also inject title as a page header (if available).\n      if ($title) {\n        $page['header'] = [\n          '#type' => 'page_title',\n          '#title' => $title,\n        ];\n      }\n\n      return $page;\n    }\n  }\n\n  /**\n   * The _title_callback for the system.batch_page.html route.\n   *\n   * @return string\n   *   The page title.\n   */\n  public function batchPageTitle(Request $request) {\n    $batch = &batch_get();\n\n    if (!($request_id = $request->query->get('id'))) {\n      return '';\n    }\n\n    // Retrieve the current state of the batch.\n    if (!$batch) {\n      $batch = $this->batchStorage->load($request_id);\n    }\n\n    if (!$batch) {\n      return '';\n    }\n\n    $current_set = _batch_current_set();\n    return !empty($current_set['title']) ? $current_set['title'] : '';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Controller/BatchController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BatchController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FlowDropEventTypeBase in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\n\n/**\n * Base class for FlowDrop Event Type plugins.\n *\n * Provides default implementations for common functionality.\n * Concrete event type plugins should extend this class.\n */\nabstract class FlowDropEventTypeBase extends PluginBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEventId(): string {\n    return $this->getPluginId();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLabel(): string {\n    $definition = $this->getPluginDefinition();\n    $label = $definition[\"label\"] ?? $this->getPluginId();\n    return (string) $label;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    $definition = $this->getPluginDefinition();\n    $description = $definition[\"description\"] ?? \"\";\n    return (string) $description;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"category\"] ?? \"entity\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultOrchestrator(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"defaultOrchestrator\"] ?? \"flowdrop_runtime:asynchronous\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultExecutionMode(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"defaultExecutionMode\"] ?? \"async\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedEntityTypes(): array {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"supportedEntityTypes\"] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsEntityType(string $entityType): bool {\n    $supportedTypes = $this->getSupportedEntityTypes();\n\n    // Empty array means all entity types are supported.\n    if (empty($supportedTypes)) {\n      return TRUE;\n    }\n\n    return in_array($entityType, $supportedTypes, TRUE);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"entity_types\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Entity Types\",\n          \"description\" => \"Entity types to trigger on (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n        \"bundles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Bundles\",\n          \"description\" => \"Bundles to trigger on (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Get base trigger data common to all event types.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity involved in the event.\n   *\n   * @return array\n   *   Base trigger data.\n   */\n  protected function getBaseTriggerData(EntityInterface $entity): array {\n    return [\n      \"event_type\" => $this->getEventId(),\n      \"entity_type\" => $entity->getEntityTypeId(),\n      \"entity_id\" => $entity->id(),\n      \"bundle\" => $entity->bundle(),\n      \"label\" => $entity->label(),\n      \"uuid\" => $entity->uuid(),\n      \"langcode\" => $entity->language()->getId(),\n      \"timestamp\" => time(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventTypeBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropEventTypeBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nname: square_large\nlabel: 'Square Large'\neffects:\n  c7627da6-934e-47e2-a795-f10a424bda34:\n    uuid: c7627da6-934e-47e2-a795-f10a424bda34\n    id: image_scale_and_crop\n    weight: 1\n    data:\n      width: 900\n      height: 900\n      anchor: center-center\n  54c8c29a-0a39-4ff0-b61b-8e85cc9367a4:\n    uuid: 54c8c29a-0a39-4ff0-b61b-8e85cc9367a4\n    id: image_convert_avif\n    weight: 2\n    data:\n      extension: webp\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/image.style.square_large.yml", "type": "yaml_reference", "topic": "image.style.square large"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ListThemes.php\nTarget symbol: class ListThemes\nNamespace: Drupal\\mcp_tools_theme\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ListThemes.\n- Include required imports:\n  - Drupal\\mcp_tools_theme\\Service\\ThemeService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_theme\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_theme\\Service\\ThemeService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_theme_list',\n  label: new TranslatableMarkup('List Themes'),\n  description: new TranslatableMarkup('List all installed themes. Optionally include uninstalled themes.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'include_uninstalled' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Include Uninstalled'),\n      description: new TranslatableMarkup('Include themes that are available but not installed'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'themes' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Themes'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Themes'),\n      description: new TranslatableMarkup(''),\n    ),\n    'default_theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Default Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'admin_theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Admin Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListThemes extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'theme';\n\n\n  protected ThemeService $themeService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->themeService = $container->get('mcp_tools_theme.theme');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $includeUninstalled = (bool) ($input['include_uninstalled'] ?? FALSE);\n    return $this->themeService->listThemes($includeUninstalled);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_theme/src/Plugin/tool/Tool/ListThemes.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListThemes", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class BookSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Site\\Settings;\n\n/**\n * Configure book settings for this site.\n *\n * @internal\n */\nclass BookSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'book_admin_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array {\n    return ['book.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('book.settings');\n    // @phpstan-ignore-next-line\n    $types = node_type_get_names();\n\n    $allowed_types = $config->get('allowed_types') ?? [];\n\n    $allowed_types_indexed = [];\n    foreach ($allowed_types as $item) {\n      $allowed_types_indexed[$item['content_type']] = $item['child_type'];\n    }\n\n    $form['allowed_types'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Allowed content types and their children'),\n    ];\n\n    foreach ($types as $type => $label) {\n      $form['allowed_types'][$type] = [\n        '#type' => 'container',\n        '#attributes' => ['id' => 'allowed-types-wrapper-' . $type],\n      ];\n\n      $form['allowed_types'][$type]['enabled'] = [\n        '#type' => 'checkbox',\n        '#title' => $label,\n        '#default_value' => isset($allowed_types_indexed[$type]),\n        '#parents' => ['allowed_types', $type, 'enabled'],\n        '#id' => 'allowed-types-' . $type . '-enabled',\n      ];\n\n      $form['allowed_types'][$type]['child_type'] = [\n        '#type' => 'radios',\n        '#title' => $this->t('Allowed child type for %type', ['%type' => $label]),\n        '#options' => $types,\n        '#default_value' => $allowed_types_indexed[$type] ?? NULL,\n        '#parents' => ['allowed_types', $type, 'child_type'],\n        '#id' => 'allowed-types-' . $type . '-child-type',\n        '#states' => [\n          'visible' => [\n            ':input#allowed-types-' . $type . '-enabled' => ['checked' => TRUE],\n          ],\n        ],\n      ];\n    }\n\n    $form['book_sort'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Book list sorting for administrative pages, outlines, and menus'),\n      '#default_value' => $config->get('book_sort'),\n      '#options' => [\n        'weight' => $this->t('Sort by weight'),\n        'title' => $this->t('Sort alphabetically by title'),\n      ],\n      '#required' => TRUE,\n    ];\n    $form['truncate_label'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Truncate the book label'),\n      '#description' => $this->t('Truncate the book label if it is longer than @length characters.', [\n        '@length' => Settings::get('book.truncate_limit', 30),\n      ]),\n      '#default_value' => $config->get('truncate_label'),\n      '#config_target' => 'book.settings:truncate_label',\n    ];\n\n    $form['use_parent_selector'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Use new parent selector javascript library'),\n      '#description' => $this->t('Use new experimental javascript library to use nested parent selectors.'),\n      '#default_value' => $config->get('use_parent_selector'),\n      '#config_target' => 'book.settings:use_parent_selector',\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state) {\n    parent::validateForm($form, $form_state);\n\n    $values = $form_state->getValue('allowed_types') ?? [];\n    // Check if there is at least one child type for enabled content types.\n    foreach ($values as $content_type => $type_data) {\n      if (!empty($type_data['enabled'])) {\n        if (empty($type_data['child_type'])) {\n          $form_state->setErrorByName(\"allowed_types][$content_type][child_type\", $this->t('You must select a child type for the enabled content type.'));\n        }\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    parent::submitForm($form, $form_state);\n    $values = $form_state->getValue('allowed_types') ?? [];\n    $allowed_types_config = [];\n    foreach ($values as $content_type => $type_data) {\n      if (!empty($type_data['enabled'])) {\n        $allowed_types_config[] = [\n          'content_type' => $content_type,\n          'child_type' => $type_data['child_type'] ?? \"\",\n        ];\n      }\n    }\n\n    $this->config('book.settings')\n      ->set('allowed_types', $allowed_types_config)\n      ->set('book_sort', $form_state->getValue('book_sort'))\n      ->save();\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Form/BookSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: UploadedFileConstraint\nSource file: <source_file>\nFile name hint: UploadedFileConstraint.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\file\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint;\n\n/**\n * A constraint for UploadedFile objects.\n */\nclass UploadedFileConstraint extends Constraint {\n\n  /**\n   * The upload max size. Defaults to checking the environment.\n   */\n  public ?int $maxSize = NULL;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?int $maxSize = NULL,\n    public string $uploadIniSizeErrorMessage = 'The file %file could not be saved because it exceeds %maxsize, the maximum allowed size for uploads.',\n    public string $uploadFormSizeErrorMessage = 'The file %file could not be saved because it exceeds %maxsize, the maximum allowed size for uploads.',\n    public string $uploadPartialErrorMessage = 'The file %file could not be saved because the upload did not complete.',\n    public string $uploadNoFileErrorMessage = 'The file %file could not be saved because the upload did not complete.',\n    public string $uploadErrorMessage = 'The file %file could not be saved. An unknown error has occurred.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->maxSize = $maxSize ?? $this->maxSize;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint;\n\n/**\n * A constraint for UploadedFile objects.\n */\nclass UploadedFileConstraint extends Constraint {\n\n  /**\n   * The upload max size. Defaults to checking the environment.\n   */\n  public ?int $maxSize = NULL;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?int $maxSize = NULL,\n    public string $uploadIniSizeErrorMessage = 'The file %file could not be saved because it exceeds %maxsize, the maximum allowed size for uploads.',\n    public string $uploadFormSizeErrorMessage = 'The file %file could not be saved because it exceeds %maxsize, the maximum allowed size for uploads.',\n    public string $uploadPartialErrorMessage = 'The file %file could not be saved because the upload did not complete.',\n    public string $uploadNoFileErrorMessage = 'The file %file could not be saved because the upload did not complete.',\n    public string $uploadErrorMessage = 'The file %file could not be saved. An unknown error has occurred.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->maxSize = $maxSize ?? $this->maxSize;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Validation/Constraint/UploadedFileConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UploadedFileConstraint", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "views.display_extender.display_builder:\n  type: views_display_extender\n  mapping:\n    profile:\n      label: 'Display Builder profile'\n      type: string\n      constraints:\n        ConfigExists:\n          prefix: 'display_builder.profile.'\n    sources:\n      label: 'UI Patterns sources'\n      sequence:\n        type: ui_patterns_source.[source_id]\n  constraints:\n    FullyValidatable: ~\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/config/schema/display_builder_views.schema.yml", "type": "yaml_reference", "topic": "display builder views.schema"}}
{"instruction": "Show me the implementation of the class WorkspacesHtmlEntityFormController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\workspaces\\Controller;\n\nuse Drupal\\Core\\Controller\\FormController;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Drupal\\Core\\Form\\FormInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\TypedData\\TypedDataManagerInterface;\nuse Drupal\\workspaces\\Plugin\\Validation\\Constraint\\EntityWorkspaceConflictConstraint;\nuse Drupal\\workspaces\\WorkspaceInformationInterface;\nuse Drupal\\workspaces\\WorkspaceManagerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Overrides the entity form controller service for workspaces operations.\n */\nclass WorkspacesHtmlEntityFormController extends FormController {\n\n  use DependencySerializationTrait;\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly FormController $entityFormController,\n    protected readonly WorkspaceManagerInterface $workspaceManager,\n    protected readonly WorkspaceInformationInterface $workspaceInfo,\n    protected readonly TypedDataManagerInterface $typedDataManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getContentResult(Request $request, RouteMatchInterface $route_match): array {\n    $form_arg = $this->getFormArgument($route_match);\n    // If no operation is provided, use 'default'.\n    $form_arg .= '.default';\n    [$entity_type_id, $operation] = explode('.', $form_arg);\n\n    if ($route_match->getRawParameter($entity_type_id) !== NULL) {\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $entity */\n      $entity = $route_match->getParameter($entity_type_id);\n    }\n\n    if (isset($entity) && $this->workspaceInfo->isEntitySupported($entity)) {\n      $active_workspace = $this->workspaceManager->getActiveWorkspace();\n\n      // Prepare a minimal render array in case we need to return it.\n      $build['#cache']['contexts'] = $entity->getCacheContexts();\n      $build['#cache']['tags'] = $entity->getCacheTags();\n      $build['#cache']['max-age'] = $entity->getCacheMaxAge();\n\n      // Prevent entities from being edited if they're tracked in workspace.\n      if ($operation !== 'delete') {\n        $constraints = array_values(array_filter($entity->getTypedData()->getConstraints(), function ($constraint) {\n          return $constraint instanceof EntityWorkspaceConflictConstraint;\n        }));\n\n        if (!empty($constraints)) {\n          $violations = $this->typedDataManager->getValidator()->validate(\n            $entity->getTypedData(),\n            $constraints[0]\n          );\n          if (count($violations)) {\n            $build['#markup'] = $violations->get(0)->getMessage();\n\n            return $build;\n          }\n        }\n      }\n\n      // Prevent entities from being deleted in a workspace if they have a\n      // published default revision.\n      if ($operation === 'delete' && $active_workspace && !$this->workspaceInfo->isEntityDeletable($entity, $active_workspace)) {\n        $build['#markup'] = $this->t('This @entity_type_label can only be deleted in the Live workspace.', [\n          '@entity_type_label' => $entity->getEntityType()->getSingularLabel(),\n        ]);\n\n        return $build;\n      }\n    }\n\n    return $this->entityFormController->getContentResult($request, $route_match);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getFormArgument(RouteMatchInterface $route_match): string {\n    return $this->entityFormController->getFormArgument($route_match);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getFormObject(RouteMatchInterface $route_match, $form_arg): FormInterface {\n    return $this->entityFormController->getFormObject($route_match, $form_arg);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces/src/Controller/WorkspacesHtmlEntityFormController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WorkspacesHtmlEntityFormController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Message in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\DTO;\n\n/**\n * Represents a chat message in the state graph.\n *\n * Messages are the primary data structure for conversational workflows,\n * including ReAct-style agent loops and multi-turn chat systems.\n *\n * Supported roles:\n * - \"system\": System/instruction messages.\n * - \"user\": User input messages.\n * - \"assistant\": AI/assistant responses.\n * - \"tool\": Tool/function call results.\n *\n * Example usage:\n * @code\n * $systemMsg = new Message(\"system\", \"You are a helpful assistant.\");\n * $userMsg = new Message(\"user\", \"What is the weather?\");\n * $assistantMsg = new Message(\"assistant\", \"Let me check...\", [\n *   \"tool_calls\" => [[\"name\" => \"get_weather\", \"args\" => [\"location\" => \"NYC\"]]],\n * ]);\n * $toolMsg = new Message(\"tool\", \"72\u00b0F, sunny\", [\n *   \"tool_call_id\" => \"call_123\",\n * ]);\n * @endcode\n */\nfinal class Message implements \\JsonSerializable {\n\n  /**\n   * Constructs a new Message.\n   *\n   * @param string $role\n   *   The message role (system, user, assistant, tool).\n   * @param string $content\n   *   The message content.\n   * @param array<string, mixed> $metadata\n   *   Additional metadata (tool calls, tool_call_id, etc.).\n   * @param int|null $timestamp\n   *   Unix timestamp when the message was created.\n   */\n  public function __construct(\n    public readonly string $role,\n    public readonly string $content,\n    public readonly array $metadata = [],\n    public readonly ?int $timestamp = NULL,\n  ) {}\n\n  /**\n   * Creates a system message.\n   *\n   * @param string $content\n   *   The system instruction content.\n   *\n   * @return self\n   *   A new Message with role \"system\".\n   */\n  public static function system(string $content): self {\n    return new self(\"system\", $content, [], time());\n  }\n\n  /**\n   * Creates a user message.\n   *\n   * @param string $content\n   *   The user message content.\n   *\n   * @return self\n   *   A new Message with role \"user\".\n   */\n  public static function user(string $content): self {\n    return new self(\"user\", $content, [], time());\n  }\n\n  /**\n   * Creates an assistant message.\n   *\n   * @param string $content\n   *   The assistant response content.\n   * @param array<string, mixed> $metadata\n   *   Optional metadata (e.g., tool_calls).\n   *\n   * @return self\n   *   A new Message with role \"assistant\".\n   */\n  public static function assistant(string $content, array $metadata = []): self {\n    return new self(\"assistant\", $content, $metadata, time());\n  }\n\n  /**\n   * Creates a tool result message.\n   *\n   * @param string $content\n   *   The tool result content.\n   * @param string $toolCallId\n   *   The ID of the tool call this is a response to.\n   *\n   * @return self\n   *   A new Message with role \"tool\".\n   */\n  public static function tool(string $content, string $toolCallId): self {\n    return new self(\"tool\", $content, [\"tool_call_id\" => $toolCallId], time());\n  }\n\n  /**\n   * Gets the tool calls from this message (if any).\n   *\n   * @return array<array{name: string, args: array<string, mixed>}>\n   *   Array of tool calls or empty array.\n   */\n  public function getToolCalls(): array {\n    return $this->metadata[\"tool_calls\"] ?? [];\n  }\n\n  /**\n   * Checks if this message has tool calls.\n   *\n   * @return bool\n   *   TRUE if message has tool calls.\n   */\n  public function hasToolCalls(): bool {\n    return !empty($this->metadata[\"tool_calls\"]);\n  }\n\n  /**\n   * Gets the tool call ID (for tool role messages).\n   *\n   * @return string|null\n   *   The tool call ID or NULL.\n   */\n  public function getToolCallId(): ?string {\n    $toolCallId = $this->metadata[\"tool_call_id\"] ?? NULL;\n    return $toolCallId !== NULL ? (string) $toolCallId : NULL;\n  }\n\n  /**\n   * Creates a Message from an array.\n   *\n   * @param array<string, mixed> $data\n   *   The message data.\n   *\n   * @return self\n   *   A new Message instance.\n   */\n  public static function fromArray(array $data): self {\n    return new self(\n      role: (string) ($data[\"role\"] ?? \"user\"),\n      content: (string) ($data[\"content\"] ?? \"\"),\n      metadata: $data[\"metadata\"] ?? [],\n      timestamp: isset($data[\"timestamp\"]) ? (int) $data[\"timestamp\"] : NULL,\n    );\n  }\n\n  /**\n   * Converts the message to an array.\n   *\n   * @return array<string, mixed>\n   *   The message as an array.\n   */\n  public function toArray(): array {\n    return [\n      \"role\" => $this->role,\n      \"content\" => $this->content,\n      \"metadata\" => $this->metadata,\n      \"timestamp\" => $this->timestamp,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function jsonSerialize(): mixed {\n    return $this->toArray();\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_stategraph/src/DTO/Message.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Message", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DefaultContentSubscriber.php\nTarget symbol: class DefaultContentSubscriber\nNamespace: Drupal\\media\\EventSubscriber\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DefaultContentSubscriber.\n- Include required imports:\n  - Drupal\\Core\\DefaultContent\\PreExportEvent\n  - Drupal\\media\\MediaInterface\n  - Symfony\\Component\\EventDispatcher\\EventSubscriberInterface\n- Ensure these methods exist where relevant:\n  - getSubscribedEvents()\n  - preExport()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\media\\EventSubscriber;\n\nuse Drupal\\Core\\DefaultContent\\PreExportEvent;\nuse Drupal\\media\\MediaInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Subscribes to default content-related events.\n *\n * @internal\n *   Event subscribers are internal.\n */\nclass DefaultContentSubscriber implements EventSubscriberInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [PreExportEvent::class => 'preExport'];\n  }\n\n  /**\n   * Reacts before a media item is exported.\n   *\n   * @param \\Drupal\\Core\\DefaultContent\\PreExportEvent $event\n   *   The event object.\n   */\n  public function preExport(PreExportEvent $event): void {\n    if ($event->entity instanceof MediaInterface) {\n      // Don't export the thumbnail because it is regenerated on import.\n      $event->setExportable('thumbnail', FALSE);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/EventSubscriber/DefaultContentSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DefaultContentSubscriber", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface CachePreWarmerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\PreWarm;\n\n/**\n * Interface for cache prewarmers.\n *\n * Drupal has multiple registries that are fairly expensive to build: plugins,\n * theme hooks etc. These registries are required to serve most requests, and\n * therefore are in the critical path. When the cache for one of them is empty,\n * it is likely that the rest are too, usually due to a deployment.\n *\n * After a full cache clear on a high traffic site, a cache stampede may occur,\n * where multiple simultaneous requests all hit the site before caches have been\n * built. This either results in the same expensive cache item being built\n * multiple times, or in requests being caught in a lock wait pattern while\n * others build them, if this has been implemented (e.g. router rebuilds). In\n * the worst cases, it can take several seconds before any pages can be served\n * at all, meanwhile more requests are coming in, affecting both server loads\n * and concurrent request limits.\n *\n * The cache prewarm API attempts to mitigate this situation significantly.\n * Except for via the lock system, Drupal can't detect that it's in a cache\n * stampede situation itself, but there are particular caches we can assume that\n * if they're empty, then we might be. On most sites, even in a stampede\n * situation, these caches have to be built sequentially, i.e. the router has to\n * exist before a controller can be rendered, Views plugins have to be available\n * for a Views query to run, entity/field caches have to be built before\n * entities can be rendered, theme and element info caches have to be built\n * before templates can be rendered. Very few requests will try to render\n * a template without first running routing, even if some minor details will be\n * different between different routes and sites.\n *\n * To reduce duplicate work, and to enable those first pages after a cache clear\n * to be served faster, we want to divide up cache building between different\n * requests that are coming in. This is achieved by the cache_prewarmable\n * service tag and Drupal\\Core\\PreWarm\\PreWarmableInterface* where any service\n * can define itself as prewarmable with a common method to call to warm caches.\n *\n * The default implementation takes the list of prewarmable services, and picks\n * one at random. By choosing the service at random, it increases the likelihood\n * that when multiple requests all try to prewarm at the same time, that they'll\n * try to prewarm different things. If we always chose the service to prewarm\n * sequentially, we could end up reproducing the cache stampede situation.\n *\n * @internal\n *\n * @see Drupal\\Core\\PreWarm\\PreWarmableInterface\n * @see Drupal\\Core\\DrupalKernel::handle()\n * @see Drupal\\Core\\LockBackendAbstract::wait()\n * @see Drupal\\Core\\Routing\\RouteProvider::preload()\n */\ninterface CachePreWarmerInterface {\n\n  /**\n   * Prewarms one PreWarmable service.\n   *\n   * @return bool\n   *   TRUE if a cache was prewarmed, FALSE if there was nothing to prewarm.\n   */\n  public function preWarmOneCache(): bool;\n\n  /**\n   * Prewarms all PreWarmable services.\n   *\n   * @return bool\n   *   TRUE if a cache was prewarmed, FALSE if there was nothing to prewarm.\n   */\n  public function preWarmAllCaches(): bool;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/PreWarm/CachePreWarmerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CachePreWarmerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: LayoutTempstoreRepositoryInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\layout_builder;\n\n/**\n * Provides an interface for loading layouts from tempstore.\n */\ninterface LayoutTempstoreRepositoryInterface {\n\n  /**\n   * Gets the tempstore version of a section storage, if it exists.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to check for in tempstore.\n   *\n   * @return \\Drupal\\layout_builder\\SectionStorageInterface\n   *   Either the version of this section storage from tempstore, or the passed\n   *   section storage if none exists.\n   *\n   * @throw \\UnexpectedValueException\n   *   Thrown if a value exists, but is not a section storage.\n   */\n  function get(SectionStorageInterface $section_storage);\n\n  /**\n   * Stores this section storage in tempstore.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to set in tempstore.\n   */\n  public function set(SectionStorageInterface $section_storage);\n\n  /**\n   * Checks for the existence of a tempstore version of a section storage.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to check for in tempstore.\n   *\n   * @return bool\n   *   TRUE if there is a tempstore version of this section storage.\n   */\n  public function has(SectionStorageInterface $section_storage);\n\n  /**\n   * Removes the tempstore version of a section storage.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to remove from tempstore.\n   */\n  public function delete(SectionStorageInterface $section_storage);\n\n}", "output": "<?php\n\nnamespace Drupal\\layout_builder;\n\n/**\n * Provides an interface for loading layouts from tempstore.\n */\ninterface LayoutTempstoreRepositoryInterface {\n\n  /**\n   * Gets the tempstore version of a section storage, if it exists.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to check for in tempstore.\n   *\n   * @return \\Drupal\\layout_builder\\SectionStorageInterface\n   *   Either the version of this section storage from tempstore, or the passed\n   *   section storage if none exists.\n   *\n   * @throw \\UnexpectedValueException\n   *   Thrown if a value exists, but is not a section storage.\n   */\n  public function get(SectionStorageInterface $section_storage);\n\n  /**\n   * Stores this section storage in tempstore.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to set in tempstore.\n   */\n  public function set(SectionStorageInterface $section_storage);\n\n  /**\n   * Checks for the existence of a tempstore version of a section storage.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to check for in tempstore.\n   *\n   * @return bool\n   *   TRUE if there is a tempstore version of this section storage.\n   */\n  public function has(SectionStorageInterface $section_storage);\n\n  /**\n   * Removes the tempstore version of a section storage.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage to remove from tempstore.\n   */\n  public function delete(SectionStorageInterface $section_storage);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/LayoutTempstoreRepositoryInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "LayoutTempstoreRepositoryInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class UserPreferenceLoginRedirectCommands in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\user_preference_login_redirect\\Commands;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\user\\UserDataInterface;\nuse Drupal\\user_preference_login_redirect\\RouteParser;\nuse Drush\\Attributes as CLI;\nuse Drush\\Commands\\DrushCommands;\n\n/**\n * Contains user preference login redirect drush commands.\n */\nfinal class UserPreferenceLoginRedirectCommands extends DrushCommands {\n\n  /**\n   * Constructs a UserPreferenceLoginRedirectCommands object.\n   */\n  public function __construct(\n    private readonly UserDataInterface $userData,\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly ConfigFactoryInterface $configFactory,\n    private readonly RouteParser $routeParser,\n  ) {\n    parent::__construct();\n  }\n\n  /**\n   * Bulk updates all users to use a given route.\n   */\n  #[CLI\\Command(name: 'user_preference_login_redirect:bulk-update', aliases: ['uplr-bu'])]\n  #[CLI\\Argument(name: 'route', description: 'The route key or label to set for all users.')]\n  #[CLI\\Usage(name: 'uplr-bu <front>', description: 'Set all users to redirect to <front>')]\n  #[CLI\\Usage(name: 'uplr-bu \"My Dashboard\"', description: 'Set all users to redirect to the route labeled \"My Dashboard\"')]\n  public function bulkUpdate(string $route): void {\n    $config = $this->configFactory->get('user_preference_login_redirect.settings');\n    $available_routes_text = $config->get('available_routes');\n\n    if (empty($available_routes_text)) {\n      $this->io()->error(dt('No available routes configured in user_preference_login_redirect.settings.'));\n      return;\n    }\n\n    $routes = $this->routeParser->parseRoutes($available_routes_text);\n    $route_key = NULL;\n\n    // Check if the input matches a key.\n    if (array_key_exists($route, $routes)) {\n      $route_key = $route;\n    }\n    // Check if the input matches a label.\n    elseif ($key = array_search($route, $routes)) {\n      $route_key = $key;\n    }\n\n    if (!$route_key) {\n      $this->io()->error(dt('The route / route label \"@route\" was not found in the configured available routes.', ['@route' => $route]));\n      $this->io()->info(dt('Available routes:'));\n      foreach ($routes as $key => $label) {\n        $this->io()->info(dt('  @key (@label)', ['@key' => $key, '@label' => $label]));\n      }\n      return;\n    }\n\n    $this->io()->title(dt('Bulk updating users redirect preference'));\n    $this->io()->text(dt('Target route: @key (@label)', ['@key' => $route_key, '@label' => $routes[$route_key]]));\n\n    if (!$this->io()->confirm(dt('Are you sure you want to update ALL users?'))) {\n      return;\n    }\n\n    $user_storage = $this->entityTypeManager->getStorage('user');\n    $uids = $user_storage->getQuery()\n      ->accessCheck(FALSE)\n      ->execute();\n\n    if (empty($uids)) {\n      $this->io()->warning(dt('No users found.'));\n      return;\n    }\n\n    $count = count($uids);\n    $this->io()->progressStart($count);\n\n    foreach ($uids as $uid) {\n      $this->userData->set('user_preference_login_redirect', (int) $uid, 'redirect_route', $route_key);\n      $this->io()->progressAdvance();\n    }\n\n    $this->io()->progressFinish();\n    $this->io()->success(dt(\n      'Updated @count users to use route \"@route\".',\n      ['@count' => $count, '@route' => $route_key]\n    ));\n  }\n\n}\n", "metadata": {"source": "repos/user_preference_login_redirect/src/Commands/UserPreferenceLoginRedirectCommands.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserPreferenceLoginRedirectCommands", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ContentTranslationLocalTasks.php\nTarget symbol: class ContentTranslationLocalTasks\nNamespace: Drupal\\content_translation\\Plugin\\Derivative\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ContentTranslationLocalTasks.\n- Include required imports:\n  - Drupal\\content_translation\\ContentTranslationManagerInterface\n  - Drupal\\Component\\Plugin\\Derivative\\DeriverBase\n  - Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\StringTranslation\\TranslationInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - getDerivativeDefinitions()", "output": "<?php\n\nnamespace Drupal\\content_translation\\Plugin\\Derivative;\n\nuse Drupal\\content_translation\\ContentTranslationManagerInterface;\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\n\n/**\n * Provides dynamic local tasks for content translation.\n */\nclass ContentTranslationLocalTasks extends DeriverBase implements ContainerDeriverInterface {\n  use StringTranslationTrait;\n\n  /**\n   * The base plugin ID.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The content translation manager.\n   *\n   * @var \\Drupal\\content_translation\\ContentTranslationManagerInterface\n   */\n  protected $contentTranslationManager;\n\n  /**\n   * Constructs a new ContentTranslationLocalTasks.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\content_translation\\ContentTranslationManagerInterface $content_translation_manager\n   *   The content translation manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The translation manager.\n   */\n  public function __construct($base_plugin_id, ContentTranslationManagerInterface $content_translation_manager, TranslationInterface $string_translation) {\n    $this->basePluginId = $base_plugin_id;\n    $this->contentTranslationManager = $content_translation_manager;\n    $this->stringTranslation = $string_translation;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('content_translation.manager'),\n      $container->get('string_translation')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    // Create tabs for all possible entity types.\n    foreach ($this->contentTranslationManager->getSupportedEntityTypes() as $entity_type_id => $entity_type) {\n      // Find the route name for the translation overview.\n      $translation_route_name = \"entity.$entity_type_id.content_translation_overview\";\n\n      $base_route_name = \"entity.$entity_type_id.canonical\";\n      $this->derivatives[$translation_route_name] = [\n        'entity_type' => $entity_type_id,\n        'title' => $this->t('Translate'),\n        'route_name' => $translation_route_name,\n        'base_route' => $base_route_name,\n      ] + $base_plugin_definition;\n    }\n    return parent::getDerivativeDefinitions($base_plugin_definition);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/src/Plugin/Derivative/ContentTranslationLocalTasks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContentTranslationLocalTasks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_users.user:\n    class: Drupal\\mcp_tools_users\\Service\\UserService\n    arguments:\n      - '@entity_type.manager'\n      - '@password_generator'\n      - '@mcp_tools.access_manager'\n      - '@mcp_tools.audit_logger'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_users/mcp_tools_users.services.yml", "type": "yaml_reference", "topic": "mcp tools users.services"}}
{"instruction": "Show me the implementation of the class FileDownloadHook in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\file\\FileRepositoryInterface;\nuse Drupal\\file\\FileUsage\\FileUsageInterface;\n\n/**\n * Implements hook_file_download().\n */\n#[Hook('file_download')]\nclass FileDownloadHook {\n\n  public function __construct(\n    private readonly FileRepositoryInterface $fileRepository,\n    private readonly FileUsageInterface $fileUsage,\n    private readonly AccountInterface $currentUser,\n  ) {}\n\n  /**\n   * Implements hook_file_download().\n   */\n  public function __invoke($uri): array|int|null {\n    // Get the file record based on the URI. If not in the database just return.\n    $file = $this->fileRepository->loadByUri($uri);\n    if (!$file) {\n      return NULL;\n    }\n    // Find out if a temporary file is still used in the system.\n    if ($file->isTemporary()) {\n      $usage = $this->fileUsage->listUsage($file);\n      if (empty($usage) && $file->getOwnerId() != $this->currentUser->id()) {\n        // Deny access to temporary files without usage that are not owned by\n        // the same user. This prevents the security issue that a private file\n        // that was protected by field permissions becomes available after its\n        // usage was removed and before it is actually deleted from the file\n        // system. Modules that depend on this behavior should make the file\n        // permanent instead.\n        return -1;\n      }\n    }\n    // Find out which (if any) fields of this type contain the file.\n    $references = file_get_file_references($file, NULL, EntityStorageInterface::FIELD_LOAD_CURRENT, NULL);\n    // Stop processing if there are no references in order to avoid returning\n    // headers for files controlled by other modules. Make an exception for\n    // temporary files where the host entity has not yet been saved (for\n    // example, an image preview on a node/add form) in which case, allow\n    // download by the file's owner.\n    if (empty($references) && ($file->isPermanent() || $file->getOwnerId() != $this->currentUser->id())) {\n      return NULL;\n    }\n    if (!$file->access('download')) {\n      return -1;\n    }\n    // Access is granted.\n    return $file->getDownloadHeaders();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Hook/FileDownloadHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileDownloadHook", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface CronInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core;\n\n/**\n * An interface for running cron tasks.\n *\n * @see https://www.drupal.org/docs/administering-a-drupal-site/cron-automated-tasks\n */\ninterface CronInterface {\n\n  /**\n   * Executes a cron run.\n   *\n   * Do not call this function from a test. Use $this->cronRun() instead.\n   *\n   * @return bool\n   *   TRUE upon success, FALSE otherwise.\n   */\n  public function run();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/CronInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CronInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Region in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\Attribute;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n#[\\Attribute(flags: \\Attribute::TARGET_PARAMETER)]\nclass Region {\n\n  public function __construct(\n    public ?string $name = NULL,\n    public TranslatableMarkup|string|null $label = NULL,\n  ) {\n  }\n\n}\n", "metadata": {"source": "repos/pinto_layout/src/Attribute/Region.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Region", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DrupalInstalledTemplate\nSource file: <source_file>\nFile name hint: DrupalInstalledTemplate.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold;\n\nuse Composer\\Package\\PackageInterface;\nuse Composer\\Repository\\InstalledRepositoryInterface;\n\n/**\n * Produces code for the DrupalInstalled file.\n *\n * @internal\n */\nclass DrupalInstalledTemplate {\n\n  /**\n   * Gets the code for the DrupalInstalled class.\n   *\n   * @param \\Composer\\Package\\PackageInterface $root_package\n   *   The root package.\n   * @param \\Composer\\Repository\\InstalledRepositoryInterface $repository\n   *   The local installed repository.\n   *\n   * @return string\n   *   The PHP code to write to the DrupalInstalled class.\n   */\n  public static function getCode(PackageInterface $root_package, InstalledRepositoryInterface $repository): string {\n    // Write out a hash of the version information to a file so we can use it.\n    $versions = array_reduce($repository->getPackages(), fn (string $carry, PackageInterface $package) => $carry . $package->getUniqueName() . '-' . $package->getSourceReference() . '|', '');\n    // Add the root_package package version info so custom code changes and\n    // root_package package version changes result in the hash changing.\n    $versions .= $root_package->getUniqueName() . '-' . $root_package->getSourceReference();\n    $version_hash = hash('xxh3', $versions);\n    return <<<EOF\n      <?php\n\n      namespace Drupal;\n\n      /**\n       * A class containing information determined during composer installation.\n       *\n       * This file is generated automatically by the\n       * drupal/core-composer-scaffold Composer plugin, and should not be\n       * edited.\n       *\n       * @see \\Drupal\\Composer\\Plugin\\Scaffold\\Plugin::preAutoloadDump()\n       */\n      class DrupalInstalled {\n\n        /**\n         * A hash of all the installed packages and their versions.\n         */\n        public const string VERSIONS_HASH = '$version_hash';\n\n      }\n\n      EOF;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold;\n\nuse Composer\\Package\\PackageInterface;\nuse Composer\\Repository\\InstalledRepositoryInterface;\n\n/**\n * Produces code for the DrupalInstalled file.\n *\n * @internal\n */\nclass DrupalInstalledTemplate {\n\n  /**\n   * Gets the code for the DrupalInstalled class.\n   *\n   * @param \\Composer\\Package\\PackageInterface $root_package\n   *   The root package.\n   * @param \\Composer\\Repository\\InstalledRepositoryInterface $repository\n   *   The local installed repository.\n   *\n   * @return string\n   *   The PHP code to write to the DrupalInstalled class.\n   */\n  public static function getCode(PackageInterface $root_package, InstalledRepositoryInterface $repository): string {\n    // Write out a hash of the version information to a file so we can use it.\n    $versions = array_reduce($repository->getPackages(), fn (string $carry, PackageInterface $package) => $carry . $package->getUniqueName() . '-' . $package->getSourceReference() . '|', '');\n    // Add the root_package package version info so custom code changes and\n    // root_package package version changes result in the hash changing.\n    $versions .= $root_package->getUniqueName() . '-' . $root_package->getSourceReference();\n    $version_hash = hash('xxh3', $versions);\n    return <<<EOF\n      <?php\n\n      namespace Drupal;\n\n      /**\n       * A class containing information determined during composer installation.\n       *\n       * This file is generated automatically by the\n       * drupal/core-composer-scaffold Composer plugin, and should not be\n       * edited.\n       *\n       * @see \\Drupal\\Composer\\Plugin\\Scaffold\\Plugin::preAutoloadDump()\n       */\n      class DrupalInstalled {\n\n        /**\n         * A hash of all the installed packages and their versions.\n         */\n        public const string VERSIONS_HASH = '$version_hash';\n\n      }\n\n      EOF;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/DrupalInstalledTemplate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DrupalInstalledTemplate", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: RegisterEntityResolversCompilerPass\nSource file: <source_file>\nFile name hint: RegisterEntityResolversCompilerPass.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\serialization;\n\nuse Symfony\\Component\\DependencyInjection\\Reference;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\n\n/**\n * Adds services tagged 'entity_resolver' to the Serializer.\n */\nclass RegisterEntityResolversCompilerPass implements CompilerPassInterface {\n\n  /**\n   * Adds services to the Serializer.\n   *\n   * @param \\Symfony\\Component\\DependencyInjection\\ContainerBuilder $container\n   *   The container to process.\n   */\n  function process(ContainerBuilder $container): void {\n    $definition = $container->getDefinition('serializer.entity_resolver');\n    $resolvers = [];\n\n    // Retrieve registered Normalizers and Encoders from the container.\n    foreach ($container->findTaggedServiceIds('entity_resolver') as $id => $attributes) {\n      $priority = $attributes[0]['priority'] ?? 0;\n      $resolvers[$priority][] = new Reference($id);\n    }\n\n    // Add the registered concrete EntityResolvers to the ChainEntityResolver.\n    foreach ($this->sort($resolvers) as $resolver) {\n      $definition->addMethodCall('addResolver', [$resolver]);\n    }\n  }\n\n  /**\n   * Sorts by priority.\n   *\n   * Order services from highest priority number to lowest (reverse sorting).\n   *\n   * @param array $services\n   *   A nested array keyed on priority number. For each priority number, the\n   *   value is an array of Symfony\\Component\\DependencyInjection\\Reference\n   *   objects, each a reference to a normalizer or encoder service.\n   *\n   * @return array\n   *   A flattened array of Reference objects from $services, ordered from high\n   *   to low priority.\n   */\n  protected function sort($services) {\n    krsort($services);\n    return array_merge(...$services);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\serialization;\n\nuse Symfony\\Component\\DependencyInjection\\Reference;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\n\n/**\n * Adds services tagged 'entity_resolver' to the Serializer.\n */\nclass RegisterEntityResolversCompilerPass implements CompilerPassInterface {\n\n  /**\n   * Adds services to the Serializer.\n   *\n   * @param \\Symfony\\Component\\DependencyInjection\\ContainerBuilder $container\n   *   The container to process.\n   */\n  public function process(ContainerBuilder $container): void {\n    $definition = $container->getDefinition('serializer.entity_resolver');\n    $resolvers = [];\n\n    // Retrieve registered Normalizers and Encoders from the container.\n    foreach ($container->findTaggedServiceIds('entity_resolver') as $id => $attributes) {\n      $priority = $attributes[0]['priority'] ?? 0;\n      $resolvers[$priority][] = new Reference($id);\n    }\n\n    // Add the registered concrete EntityResolvers to the ChainEntityResolver.\n    foreach ($this->sort($resolvers) as $resolver) {\n      $definition->addMethodCall('addResolver', [$resolver]);\n    }\n  }\n\n  /**\n   * Sorts by priority.\n   *\n   * Order services from highest priority number to lowest (reverse sorting).\n   *\n   * @param array $services\n   *   A nested array keyed on priority number. For each priority number, the\n   *   value is an array of Symfony\\Component\\DependencyInjection\\Reference\n   *   objects, each a reference to a normalizer or encoder service.\n   *\n   * @return array\n   *   A flattened array of Reference objects from $services, ordered from high\n   *   to low priority.\n   */\n  protected function sort($services) {\n    krsort($services);\n    return array_merge(...$services);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/RegisterEntityResolversCompilerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegisterEntityResolversCompilerPass", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the trait BytesFormatTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts\\Traits;\n\n/**\n * Class BootstrapLayout.\n */\ntrait BytesFormatTrait {\n\n  /**\n   * Converts a human-readable file size to bytes.\n   *\n   * @param string $size\n   *   The size string (e.g., \"2MB\", \"500k\").  May contain spaces.\n   *\n   * @return int|string\n   *   The size in bytes, or STRING on $size.\n   */\n  public function convertToBytes($size) {\n    // Normalize string and extract parts.\n    $size = mb_strtolower(trim($size));\n    preg_match('/^([\\d\\.]+)\\s*([a-z]+)$/i', $size, $matches);\n\n    if (!isset($matches[2])) {\n      // No unit, assume bytes simply return (ensure int).\n      return (int) $size;\n    }\n\n    $value = floatval($matches[1]);\n    $unit = $matches[2];\n\n    $units = [\n      'b' => 0,\n      'k' => 1, 'kb' => 1, 'kilo' => 1,\n      'm' => 2, 'mb' => 2, 'meg' => 2, 'mega' => 2,\n      'g' => 3, 'gb' => 3, 'gig' => 3, 'giga' => 3,\n      't' => 4, 'tb' => 4, 'ter' => 4, 'tera' => 4,\n      'p' => 5, 'pb' => 5, 'pet' => 5, 'peta' => 5,\n      'e' => 6, 'eb' => 6, 'ex' => 6, 'exa' => 6,\n      'z' => 7, 'zb' => 7, 'zet' => 7, 'zetta' => 7,\n      'y' => 8, 'yb' => 8, 'yot' => 8, 'yotta' => 8,\n    ];\n\n    if (!isset($units[$unit])) {\n      // Unknown, return false to signify error situation.\n      return FALSE;\n    }\n\n    return (int) round($value * pow(1024, $units[$unit]));\n  }\n\n  /**\n   * Formats bytes as a human-readable string.\n   *\n   * @param int $bytes\n   *   The number of bytes.\n   * @param int $decimals\n   *   Number of decimal places.\n   *\n   * @return string\n   *   The formatted string.\n   */\n  public function formatBytes($bytes, $decimals = 2) {\n    $sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    if ($bytes == 0) {\n      return '0 B';\n    }\n    $factor = floor(log($bytes, 1024));\n    $number = sprintf(\"%.{$decimals}f\", $bytes / pow(1024, $factor));\n    $number = rtrim(rtrim($number, '0'), '.');\n    return $number . ' ' . $sizes[$factor];\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/Traits/BytesFormatTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "BytesFormatTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BlockBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Block;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginAssignmentTrait;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginTrait;\nuse Drupal\\Core\\Plugin\\PluginBase;\nuse Drupal\\Core\\Plugin\\PluginWithFormsInterface;\nuse Drupal\\Core\\Plugin\\PreviewAwarePluginInterface;\nuse Drupal\\Core\\Render\\PreviewFallbackInterface;\n\n/**\n * Defines a base block implementation that most blocks plugins will extend.\n *\n * This abstract class provides the generic block configuration form, default\n * block settings, and handling for general user-defined block visibility\n * settings.\n *\n * @ingroup block_api\n */\nabstract class BlockBase extends PluginBase implements BlockPluginInterface, PluginWithFormsInterface, PreviewAwarePluginInterface, PreviewFallbackInterface, ContextAwarePluginInterface {\n\n  use BlockPluginTrait {\n    buildConfigurationForm as traitBuildConfigurationForm;\n    submitConfigurationForm as traitSubmitConfigurationForm;\n  }\n  use ContextAwarePluginTrait;\n  use ContextAwarePluginAssignmentTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state) {\n    $form = $this->traitBuildConfigurationForm($form, $form_state);\n\n    // Add context mapping UI form elements.\n    $contexts = $form_state->getTemporaryValue('gathered_contexts') ?: [];\n    $form['context_mapping'] = $this->addContextAssignmentElement($this, $contexts);\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state) {\n    if (!$form_state->getErrors() && $form_state->getValue('context_mapping')) {\n      $this->configuration['context_mapping'] = $form_state->getValue('context_mapping');\n    }\n    $this->traitSubmitConfigurationForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Block/BlockBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class KeyPruner in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\KeyManagement\\Port\\KeyRegistryInterface;\nuse Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Default application service for pruning unused encryption keys.\n *\n * An encryption key is considered unused when it is not the active key and\n * is not referenced by any Key entity using the easy_encrypted provider.\n *\n * The prune operation returns partial results: individual delete failures are\n * logged and returned, and do not abort the whole run.\n *\n * @internal This class is not part of the module's public programming API.\n */\nfinal class KeyPruner implements KeyPrunerInterface {\n\n  /**\n   * Constructs a new object.\n   *\n   * @phpstan-param iterable<\\Drupal\\easy_encryption\\KeyManagement\\Observers\\KeyDeletedObserverInterface> $observers\n   */\n  public function __construct(\n    private readonly SodiumKeyPairRepositoryInterface $keyPairRepository,\n    private readonly KeyUsageTrackerInterface $usageTracker,\n    private readonly KeyRegistryInterface&MutableKeyRegistryInterface $keyRegistry,\n    private readonly iterable $observers,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function planPruning(): KeyPrunePlan {\n    try {\n      $active = $this->keyRegistry->getActiveKeyId();\n      $referenced = $this->usageTracker->getReferencedEncryptionKeyIds();\n\n      $active_id = $active['result'];\n      $referenced_ids = $referenced['result'];\n\n      $all_ids = $this->keyRegistry->listKnownKeyIds()['result'];\n\n      $to_delete = [];\n      foreach ($all_ids as $id) {\n        if ($active_id !== NULL && $id == $active_id) {\n          continue;\n        }\n        if (in_array($id, $referenced_ids, TRUE)) {\n          continue;\n        }\n        $to_delete[] = $id;\n      }\n\n      // KeyPrunePlan currently has no cacheability: that\u2019s fine because pruning\n      // is an operational action, not something we cache.\n      return new KeyPrunePlan(\n        activeKeyId: $active_id,\n        toDelete: $to_delete,\n        referenced: $referenced_ids,\n      );\n    }\n    catch (\\Throwable $e) {\n      throw KeyPrunerException::planFailed($e);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function pruneUnused(): KeyPruneResult {\n    try {\n      $plan = $this->planPruning();\n    }\n    catch (\\Throwable $e) {\n      // If planning fails, pruning cannot proceed.\n      throw KeyPrunerException::pruneFailed($e);\n    }\n\n    $deleted = [];\n    $failed = [];\n\n    foreach ($plan->toDelete as $id) {\n      try {\n        $this->keyPairRepository->deleteKeyPair($id->value);\n        $this->keyRegistry->unregister($id);\n        $deleted[] = $id;\n\n        $this->logger->notice('Pruned unused encryption key {id}.', ['id' => $id->value]);\n\n        try {\n          foreach ($this->observers as $observer) {\n            $observer->onKeyDeletion($id);\n          }\n        }\n        catch (\\Throwable) {\n          // Do not allow secondary actions to fail the primary operation.\n        }\n      }\n      catch (\\Throwable $e) {\n        $failed[] = $id;\n\n        $this->logger->error('Failed pruning encryption key {id}: {message}', [\n          'id' => $id->value,\n          'message' => $e->getMessage(),\n        ]);\n      }\n    }\n\n    return new KeyPruneResult(deleted: $deleted, failed: $failed);\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyPruner.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyPruner", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GetSubmissions in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_get_webform_submissions',\n  label: new TranslatableMarkup('Get Webform Submissions'),\n  description: new TranslatableMarkup('Get submissions for a webform with pagination.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'webform_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit (max 100)'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'offset' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Offset'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'webform_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'webform_title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Submissions'),\n      description: new TranslatableMarkup(''),\n    ),\n    'limit' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup(''),\n    ),\n    'offset' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Offset'),\n      description: new TranslatableMarkup(''),\n    ),\n    'submissions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Submissions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetSubmissions extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $webformId = $input['webform_id'] ?? '';\n\n    if (empty($webformId)) {\n      return ['success' => FALSE, 'error' => 'Webform ID is required.'];\n    }\n\n    $limit = (int) ($input['limit'] ?? 50);\n    $offset = (int) ($input['offset'] ?? 0);\n\n    // Enforce reasonable limits.\n    $limit = min(max($limit, 1), 100);\n    $offset = max($offset, 0);\n\n    return $this->webformService->getSubmissions($webformId, $limit, $offset);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/src/Plugin/tool/Tool/GetSubmissions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetSubmissions", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override to display an oEmbed resource in an iframe.\n */\n#}\n<!DOCTYPE html>\n<html>\n  <head>\n    <css-placeholder token=\"{{ placeholder_token }}\">\n  </head>\n  <body style=\"margin: 0\">\n    {{ media|raw }}\n  </body>\n</html>\n", "metadata": {"source": "repos/drupal_core/core/themes/stable9/templates/content/media-oembed-iframe.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class InvalidPluginDefinitionException in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin\\Exception;\n\n/**\n * Defines a class for invalid plugin definition exceptions.\n */\nclass InvalidPluginDefinitionException extends PluginException {\n\n  /**\n   * The plugin ID of the mapper.\n   *\n   * @var string\n   */\n  protected $pluginId;\n\n  /**\n   * Constructs an InvalidPluginDefinitionException.\n   *\n   * @param string $plugin_id\n   *   The plugin ID of the mapper.\n   * @param string $message\n   *   The exception message.\n   * @param int $code\n   *   The exception code.\n   * @param \\Throwable|null $previous\n   *   The previous throwable used for exception chaining.\n   *\n   * @see \\Exception\n   */\n  public function __construct($plugin_id, $message = '', $code = 0, ?\\Throwable $previous = NULL) {\n    $this->pluginId = $plugin_id;\n    parent::__construct($message, $code, $previous);\n  }\n\n  /**\n   * Gets the plugin ID of the mapper that raised the exception.\n   *\n   * @return string\n   *   The plugin ID.\n   */\n  public function getPluginId() {\n    return $this->pluginId;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/Exception/InvalidPluginDefinitionException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InvalidPluginDefinitionException", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "drupal.field_ui:\n  version: VERSION\n  js:\n    js/field_ui.js: {}\n  css:\n    theme:\n      css/field_ui.admin.css: {}\n  dependencies:\n    - core/jquery\n    - core/drupal\n    - core/drupalSettings\n    - core/once\n    - core/drupal.ajax\n    - core/drupal.dialog\n\ndrupal.field_ui.manage_fields:\n  version: VERSION\n  css:\n    component:\n      css/field_ui_add_field.module.css: {}\n    theme:\n      css/field_ui_add_field.theme.css: {}\n      css/field_ui.icons.theme.css: {}\n\ndrupal.field_ui_table:\n  version: VERSION\n  css:\n    theme:\n      css/field_ui_display_mode_table.css: {}\n", "metadata": {"source": "repos/drupal_core/core/modules/field_ui/field_ui.libraries.yml", "type": "yaml_reference", "topic": "field ui.libraries"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - image.style.square_large\n    - image.style.square_medium\n    - image.style.square_small\nid: square\nlabel: Square\nimage_style_mappings:\n  -\n    image_mapping_type: sizes\n    image_mapping:\n      sizes: 100vw\n      sizes_image_styles:\n        - square_large\n        - square_medium\n        - square_small\n    breakpoint_id: responsive_image.viewport_sizing\n    multiplier: 1x\nbreakpoint_group: responsive_image\nfallback_image_style: square_medium\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/responsive_image.styles.square.yml", "type": "yaml_reference", "topic": "responsive image.styles.square"}}
{"instruction": "Show me the implementation of the class MarkdownOutput in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader\\DocumentLoaderType\\Output;\n\nuse Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface;\n\n/**\n * Markdown output for document loader operations.\n */\nclass MarkdownOutput implements DocumentLoaderOutputInterface {\n\n  /**\n   * Constructs a MarkdownOutput instance.\n   *\n   * @param string $content\n   *   The Markdown content.\n   * @param array $metadata\n   *   (optional) Additional metadata about the document.\n   */\n  public function __construct(\n    public readonly string $content,\n    public readonly array $metadata = [],\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getContent(): string {\n    return $this->content;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(): array {\n    return $this->metadata;\n  }\n\n}\n", "metadata": {"source": "repos/document_loader/src/DocumentLoaderType/Output/MarkdownOutput.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MarkdownOutput", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FindDuplicateContent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_duplicates',\n  label: new TranslatableMarkup('Find Duplicate Content'),\n  description: new TranslatableMarkup('Find similar content based on field values. Useful for identifying redundant pages.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'content_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Content Type'),\n      description: new TranslatableMarkup('Machine name of the content type to search'),\n      required: TRUE,\n    ),\n    'field' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field'),\n      description: new TranslatableMarkup('Field to compare for similarity (default: \"title\")'),\n      required: FALSE,\n    ),\n    'threshold' => new InputDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Similarity Threshold'),\n      description: new TranslatableMarkup('Similarity threshold 0.1-1.0 (default: 0.8 = 80% similar)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'content_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Content Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'field_compared' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Compared'),\n      description: new TranslatableMarkup(''),\n    ),\n    'threshold' => new ContextDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Threshold Used'),\n      description: new TranslatableMarkup(''),\n    ),\n    'items_analyzed' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Items Analyzed'),\n      description: new TranslatableMarkup(''),\n    ),\n    'duplicates' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Potential Duplicates'),\n      description: new TranslatableMarkup('Pairs of similar content with similarity percentage'),\n    ),\n    'duplicate_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Duplicate Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass FindDuplicateContent extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $contentType = $input['content_type'] ?? '';\n    $field = $input['field'] ?? 'title';\n    $threshold = isset($input['threshold']) ? (float) $input['threshold'] : 0.8;\n\n    if (empty($contentType)) {\n      return ['success' => FALSE, 'error' => 'content_type is required.'];\n    }\n\n    if ($threshold < 0.1 || $threshold > 1.0) {\n      return ['success' => FALSE, 'error' => 'threshold must be between 0.1 and 1.0.'];\n    }\n\n    return $this->analysisService->findDuplicateContent($contentType, $field, $threshold);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/src/Plugin/tool/Tool/FindDuplicateContent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FindDuplicateContent", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ViewsEntityArgumentValidator\nSource file: <source_file>\nFile name hint: ViewsEntityArgumentValidator.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\views\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides views argument validator plugin definitions for all entity types.\n *\n * @ingroup views_argument_validator_plugins\n *\n * @see \\Drupal\\views\\Plugin\\views\\argument_validator\\Entity\n */\nclass ViewsEntityArgumentValidator extends DeriverBase implements ContainerDeriverInterface {\n  use StringTranslationTrait;\n\n  /**\n   * The base plugin ID this derivative is for.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * List of derivative definitions.\n   *\n   * @var array\n   */\n  protected $derivatives = [];\n\n  /**\n   * Constructs a ViewsEntityArgumentValidator object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The string translation.\n   */\n  function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation) {\n    $this->basePluginId = $base_plugin_id;\n    $this->entityTypeManager = $entity_type_manager;\n    $this->stringTranslation = $string_translation;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('string_translation')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $entity_types = $this->entityTypeManager->getDefinitions();\n    $this->derivatives = [];\n    foreach ($entity_types as $entity_type_id => $entity_type) {\n      $this->derivatives[$entity_type_id] = [\n        'id' => 'entity:' . $entity_type_id,\n        'provider' => 'views',\n        'title' => $entity_type->getLabel(),\n        'help' => $this->t('Validate @label', ['@label' => $entity_type->getLabel()]),\n        'entity_type' => $entity_type_id,\n        'class' => $base_plugin_definition['class'],\n      ];\n    }\n\n    return $this->derivatives;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides views argument validator plugin definitions for all entity types.\n *\n * @ingroup views_argument_validator_plugins\n *\n * @see \\Drupal\\views\\Plugin\\views\\argument_validator\\Entity\n */\nclass ViewsEntityArgumentValidator extends DeriverBase implements ContainerDeriverInterface {\n  use StringTranslationTrait;\n\n  /**\n   * The base plugin ID this derivative is for.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * List of derivative definitions.\n   *\n   * @var array\n   */\n  protected $derivatives = [];\n\n  /**\n   * Constructs a ViewsEntityArgumentValidator object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The string translation.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation) {\n    $this->basePluginId = $base_plugin_id;\n    $this->entityTypeManager = $entity_type_manager;\n    $this->stringTranslation = $string_translation;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('string_translation')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $entity_types = $this->entityTypeManager->getDefinitions();\n    $this->derivatives = [];\n    foreach ($entity_types as $entity_type_id => $entity_type) {\n      $this->derivatives[$entity_type_id] = [\n        'id' => 'entity:' . $entity_type_id,\n        'provider' => 'views',\n        'title' => $entity_type->getLabel(),\n        'help' => $this->t('Validate @label', ['@label' => $entity_type->getLabel()]),\n        'entity_type' => $entity_type_id,\n        'class' => $base_plugin_definition['class'],\n      ];\n    }\n\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/Derivative/ViewsEntityArgumentValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsEntityArgumentValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: SettingsForm\nSource file: <source_file>\nFile name hint: SettingsForm.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\ai_image_crop\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\ai\\AiProviderPluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configuration form for AI Image Crop settings.\n */\nclass SettingsForm extends ConfigFormBase {\n\n  /**\n   * The AI provider plugin manager.\n   */\n  protected AiProviderPluginManager $aiProvider;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->aiProvider = $container->get('ai.provider');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'ai_image_crop_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array {\n    return ['ai_image_crop.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('ai_image_crop.settings');\n\n    // Get available AI providers.\n    $providers = [];\n    foreach ($this->aiProvider->getDefinitions() as $id => $definition) {\n      $providers[$id] = $definition['label'] ?? $id;\n    }\n\n    $form['ai_provider'] = [\n      '#type' => 'select',\n      '#title' => $this->t('AI Provider'),\n      '#description' => $this->t('Select the AI provider to use for image analysis.'),\n      '#options' => $providers,\n      '#default_value' => $config->get('ai_provider'),\n      '#required' => TRUE,\n    ];\n\n    $form['ai_model'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('AI Model'),\n      '#description' => $this->t('The model to use for image analysis (e.g., gpt-4-vision, gpt-5.1).'),\n      '#default_value' => $config->get('ai_model'),\n      '#required' => TRUE,\n    ];\n\n    $form['max_iterations'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum iterations'),\n      '#description' => $this->t('Maximum number of zoom iterations for the AI to refine the focal point.'),\n      '#default_value' => $config->get('max_iterations') ?? 5,\n      '#min' => 1,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['grid_settings'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Grid settings'),\n      '#description' => $this->t('Configure the grid used for focal point detection. The AI will select cells from this grid to zoom into.'),\n      '#open' => TRUE,\n    ];\n\n    $form['grid_settings']['grid_columns'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid columns'),\n      '#description' => $this->t('Number of columns in the selection grid.'),\n      '#default_value' => $config->get('grid_columns') ?? 6,\n      '#min' => 2,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['grid_settings']['grid_rows'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid rows'),\n      '#description' => $this->t('Number of rows in the selection grid.'),\n      '#default_value' => $config->get('grid_rows') ?? 6,\n      '#min' => 2,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['action_settings'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Bulk action settings'),\n      '#open' => FALSE,\n    ];\n\n    $form['action_settings']['action_override_behavior'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Existing crops behavior'),\n      '#description' => $this->t('Controls how bulk actions handle images that already have crops applied.'),", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\ai_image_crop\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\ai\\AiProviderPluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configuration form for AI Image Crop settings.\n */\nclass SettingsForm extends ConfigFormBase {\n\n  /**\n   * The AI provider plugin manager.\n   */\n  protected AiProviderPluginManager $aiProvider;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->aiProvider = $container->get('ai.provider');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'ai_image_crop_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array {\n    return ['ai_image_crop.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('ai_image_crop.settings');\n\n    // Get available AI providers.\n    $providers = [];\n    foreach ($this->aiProvider->getDefinitions() as $id => $definition) {\n      $providers[$id] = $definition['label'] ?? $id;\n    }\n\n    $form['ai_provider'] = [\n      '#type' => 'select',\n      '#title' => $this->t('AI Provider'),\n      '#description' => $this->t('Select the AI provider to use for image analysis.'),\n      '#options' => $providers,\n      '#default_value' => $config->get('ai_provider'),\n      '#required' => TRUE,\n    ];\n\n    $form['ai_model'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('AI Model'),\n      '#description' => $this->t('The model to use for image analysis (e.g., gpt-4-vision, gpt-5.1).'),\n      '#default_value' => $config->get('ai_model'),\n      '#required' => TRUE,\n    ];\n\n    $form['max_iterations'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum iterations'),\n      '#description' => $this->t('Maximum number of zoom iterations for the AI to refine the focal point.'),\n      '#default_value' => $config->get('max_iterations') ?? 5,\n      '#min' => 1,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['grid_settings'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Grid settings'),\n      '#description' => $this->t('Configure the grid used for focal point detection. The AI will select cells from this grid to zoom into.'),\n      '#open' => TRUE,\n    ];\n\n    $form['grid_settings']['grid_columns'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid columns'),\n      '#description' => $this->t('Number of columns in the selection grid.'),\n      '#default_value' => $config->get('grid_columns') ?? 6,\n      '#min' => 2,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['grid_settings']['grid_rows'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid rows'),\n      '#description' => $this->t('Number of rows in the selection grid.'),\n      '#default_value' => $config->get('grid_rows') ?? 6,\n      '#min' => 2,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['action_settings'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Bulk action settings'),\n      '#open' => FALSE,\n    ];\n\n    $form['action_settings']['action_override_behavior'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Existing crops behavior'),\n      '#description' => $this->t('Controls how bulk actions handle images that already have crops applied.'),\n      '#options' => [\n        'follow_widget' => $this->t('Follow widget settings - Use the \"Override existing crops\" setting from each field widget'),\n        'always_override' => $this->t('Always replace - Override all existing crops regardless of widget settings'),\n        'never_override' => $this->t('Skip existing - Never override existing crops regardless of widget settings'),\n      ],\n      '#default_value' => $config->get('action_override_behavior') ?? 'follow_widget',\n    ];\n\n    $form['prompts'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Default prompts'),\n      '#open' => TRUE,\n    ];\n\n    $form['prompts']['default_focal_point_prompt'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Default focal point prompt'),\n      '#description' => $this->t('The default prompt used for focal point detection. This can be overridden per widget.'),\n      '#default_value' => $config->get('default_focal_point_prompt'),\n      '#rows' => 4,\n      '#required' => TRUE,\n    ];\n\n    $form['prompts']['default_crop_prompt'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Default crop prompt'),\n      '#description' => $this->t('The default prompt used for crop area detection. This can be overridden per widget.'),\n      '#default_value' => $config->get('default_crop_prompt'),\n      '#rows' => 4,\n      '#required' => TRUE,\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $this->config('ai_image_crop.settings')\n      ->set('ai_provider', $form_state->getValue('ai_provider'))\n      ->set('ai_model', $form_state->getValue('ai_model'))\n      ->set('max_iterations', $form_state->getValue('max_iterations'))\n      ->set('grid_columns', $form_state->getValue('grid_columns'))\n      ->set('grid_rows', $form_state->getValue('grid_rows'))\n      ->set('action_override_behavior', $form_state->getValue('action_override_behavior'))\n      ->set('default_focal_point_prompt', $form_state->getValue('default_focal_point_prompt'))\n      ->set('default_crop_prompt', $form_state->getValue('default_crop_prompt'))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/ai_image_crop/src/Form/SettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: AccountProxy\nSource file: <source_file>\nFile name hint: AccountProxy.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Session;\n\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * A proxied implementation of AccountInterface.\n *\n * The reason why we need an account proxy is that we don't want to have global\n * state directly stored in the container.\n *\n * This proxy object avoids multiple invocations of the authentication manager\n * which can happen if the current user is accessed in constructors. It also\n * allows legacy code to change the current user where the user cannot be\n * directly injected into dependent code.\n */\nclass AccountProxy implements AccountProxyInterface {\n\n  use DependencySerializationTrait;\n\n  /**\n   * The instantiated account.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $account;\n\n  /**\n   * Account id.\n   *\n   * @var int\n   */\n  protected $id = 0;\n\n  /**\n   * Event dispatcher.\n   *\n   * @var \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface\n   */\n  protected $eventDispatcher;\n\n  /**\n   * AccountProxy constructor.\n   *\n   * @param \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface $eventDispatcher\n   *   Event dispatcher.\n   */\n  function __construct(EventDispatcherInterface $eventDispatcher) {\n    $this->eventDispatcher = $eventDispatcher;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setAccount(AccountInterface $account) {\n    // If the passed account is already proxied, use the actual account instead\n    // to prevent loops.\n    if ($account instanceof static) {\n      $account = $account->getAccount();\n    }\n    $this->account = $account;\n    $this->id = $account->id();\n    $this->eventDispatcher->dispatch(new AccountSetEvent($account), AccountEvents::SET_USER);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAccount() {\n    if (!isset($this->account)) {\n      if ($this->id) {\n        // After the container is rebuilt, DrupalKernel sets the initial\n        // account to the id of the logged in user. This is necessary in order\n        // to refresh the user account reference here.\n        $this->setAccount($this->loadUserEntity($this->id));\n      }\n      else {\n        $this->account = new AnonymousUserSession();\n      }\n    }\n\n    return $this->account;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function id() {\n    return $this->id;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoles($exclude_locked_roles = FALSE) {\n    return $this->getAccount()->getRoles($exclude_locked_roles);\n  }\n\n  /**\n   * Whether a user has a certain role.\n   *\n   * @param string $rid\n   *   The role ID to check.\n   *\n   * @return bool\n   *   Returns TRUE if the user has the role, otherwise FALSE.\n   *\n   * @todo in Drupal 11, add method to Drupal\\Core\\Session\\AccountInterface.\n   * @see https://www.drupal.org/node/3228209\n   */\n  public function hasRole(string $rid): bool {\n    return $this->getAccount()->hasRole($rid);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasPermission($permission) {", "output": "<?php\n\nnamespace Drupal\\Core\\Session;\n\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * A proxied implementation of AccountInterface.\n *\n * The reason why we need an account proxy is that we don't want to have global\n * state directly stored in the container.\n *\n * This proxy object avoids multiple invocations of the authentication manager\n * which can happen if the current user is accessed in constructors. It also\n * allows legacy code to change the current user where the user cannot be\n * directly injected into dependent code.\n */\nclass AccountProxy implements AccountProxyInterface {\n\n  use DependencySerializationTrait;\n\n  /**\n   * The instantiated account.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $account;\n\n  /**\n   * Account id.\n   *\n   * @var int\n   */\n  protected $id = 0;\n\n  /**\n   * Event dispatcher.\n   *\n   * @var \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface\n   */\n  protected $eventDispatcher;\n\n  /**\n   * AccountProxy constructor.\n   *\n   * @param \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface $eventDispatcher\n   *   Event dispatcher.\n   */\n  public function __construct(EventDispatcherInterface $eventDispatcher) {\n    $this->eventDispatcher = $eventDispatcher;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setAccount(AccountInterface $account) {\n    // If the passed account is already proxied, use the actual account instead\n    // to prevent loops.\n    if ($account instanceof static) {\n      $account = $account->getAccount();\n    }\n    $this->account = $account;\n    $this->id = $account->id();\n    $this->eventDispatcher->dispatch(new AccountSetEvent($account), AccountEvents::SET_USER);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAccount() {\n    if (!isset($this->account)) {\n      if ($this->id) {\n        // After the container is rebuilt, DrupalKernel sets the initial\n        // account to the id of the logged in user. This is necessary in order\n        // to refresh the user account reference here.\n        $this->setAccount($this->loadUserEntity($this->id));\n      }\n      else {\n        $this->account = new AnonymousUserSession();\n      }\n    }\n\n    return $this->account;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function id() {\n    return $this->id;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoles($exclude_locked_roles = FALSE) {\n    return $this->getAccount()->getRoles($exclude_locked_roles);\n  }\n\n  /**\n   * Whether a user has a certain role.\n   *\n   * @param string $rid\n   *   The role ID to check.\n   *\n   * @return bool\n   *   Returns TRUE if the user has the role, otherwise FALSE.\n   *\n   * @todo in Drupal 11, add method to Drupal\\Core\\Session\\AccountInterface.\n   * @see https://www.drupal.org/node/3228209\n   */\n  public function hasRole(string $rid): bool {\n    return $this->getAccount()->hasRole($rid);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasPermission($permission) {\n    return $this->getAccount()->hasPermission($permission);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isAuthenticated() {\n    return $this->getAccount()->isAuthenticated();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isAnonymous() {\n    return $this->getAccount()->isAnonymous();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPreferredLangcode($fallback_to_default = TRUE) {\n    return $this->getAccount()->getPreferredLangcode($fallback_to_default);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPreferredAdminLangcode($fallback_to_default = TRUE) {\n    return $this->getAccount()->getPreferredAdminLangcode($fallback_to_default);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAccountName() {\n    return $this->getAccount()->getAccountName();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDisplayName() {\n    return $this->getAccount()->getDisplayName();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEmail() {\n    return $this->getAccount()->getEmail();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTimeZone() {\n    return $this->getAccount()->getTimeZone();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLastAccessedTime() {\n    return $this->getAccount()->getLastAccessedTime();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setInitialAccountId($account_id) {\n    if (isset($this->account)) {\n      throw new \\LogicException('AccountProxyInterface::setInitialAccountId() cannot be called after an account was set on the AccountProxy');\n    }\n\n    $this->id = $account_id;\n  }\n\n  /**\n   * Load a user entity.\n   *\n   * The entity type manager requires additional initialization code and cache\n   * clearing after the list of modules is changed. Therefore it is necessary to\n   * retrieve it as late as possible.\n   *\n   * Because of serialization issues it is currently not possible to inject the\n   * container into the AccountProxy. Thus it is necessary to retrieve the\n   * entity type manager statically.\n   *\n   * @param int $account_id\n   *   The id of an account to load.\n   *\n   * @return \\Drupal\\Core\\Session\\AccountInterface|null\n   *   An account or NULL if none is found.\n   */\n  protected function loadUserEntity($account_id) {\n    return \\Drupal::entityTypeManager()->getStorage('user')->load($account_id);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Session/AccountProxy.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AccountProxy", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class InlineBlockConfigDeleteForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\block_description_modifier\\Form;\n\nuse Drupal\\block_description_modifier\\Repository\\InlineBlockConfigRepository;\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Confirm deletion of a bundle configuration.\n */\nfinal class InlineBlockConfigDeleteForm extends ConfirmFormBase {\n  private string $bundle = '';\n  public function __construct(\n    private readonly InlineBlockConfigRepository $repository,\n  ) {}\n  public static function create(ContainerInterface $container): self {\n    return new self(\n      $container->get('block_description_modifier.inline_block_config_repository'),\n    );\n  }\n  public function getFormId(): string {\n    return 'block_description_modifier_delete_form';\n  }\n  public function getQuestion(): string {\n    return (string) $this->t('Delete configuration for @bundle?', ['@bundle' => $this->bundle]);\n  }\n  public function getCancelUrl(): Url {\n    return Url::fromRoute('block_description_modifier.overview');\n  }\n  public function getConfirmText(): string {\n    return (string) $this->t('Delete');\n  }\n  public function buildForm(array $form, FormStateInterface $form_state, ?string $bundle = NULL): array {\n    $this->bundle = (string) $bundle;\n    return parent::buildForm($form, $form_state);\n  }\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $this->repository->deleteInline($this->bundle);\n    $this->messenger()\n      ->addStatus($this->t('Configuration deleted for @bundle.', ['@bundle' => $this->bundle]));\n    $form_state->setRedirect('block_description_modifier.overview');\n  }\n\n}\n", "metadata": {"source": "repos/block_description_modifier/src/Form/InlineBlockConfigDeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InlineBlockConfigDeleteForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Rss\nSource file: <source_file>\nFile name hint: Rss.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\node\\Plugin\\views\\row;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Plugin\\views\\row\\RssPluginBase;\n\n/**\n * Performs a node_view on the resulting object and formats it as an RSS item.\n */\n#[ViewsRow(\n  id: \"node_rss\",\n  title: new TranslatableMarkup(\"Content\"),\n  help: new TranslatableMarkup(\"Display the content with standard node view.\"),\n  theme: \"views_view_row_rss\",\n  register_theme: FALSE,\n  base: [\"node_field_data\"],\n  display_types: [\"feed\"]\n)]\nclass Rss extends RssPluginBase {\n\n  /**\n   * The base table for this row plugin.\n   *\n   * @var string\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  public $base_table = 'node_field_data';\n\n  /**\n   * The base field for this row plugin.\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  public string $base_field = 'nid';\n\n  /**\n   * Stores the nodes loaded with preRender.\n   *\n   * @var array\n   */\n  public $nodes = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $entityTypeId = 'node';\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm_summary_options() {\n    $options = parent::buildOptionsForm_summary_options();\n    $options[$this::TITLE_VIEW_MODE] = $this->t('Title only');\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    $options = $this->buildOptionsForm_summary_options();\n    return $options[$this->options['view_mode']];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender($values) {\n    $nids = [];\n    foreach ($values as $row) {\n      $nids[] = $row->{$this->field_alias};\n    }\n    if (!empty($nids)) {\n      $this->nodes = $this->entityTypeManager->getStorage('node')->loadMultiple($nids);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($row) {\n    global $base_url;\n\n    $nid = $row->{$this->field_alias};\n    if (!is_numeric($nid)) {\n      return;\n    }\n\n    $display_mode = $this->options['view_mode'];\n\n    // Load the specified node:\n    /** @var \\Drupal\\node\\NodeInterface $node */\n    $node = $this->nodes[$nid];\n    if (empty($node)) {\n      return;\n    }\n\n    $node->rss_namespaces = [];\n    $node->rss_elements = [\n      [\n        'key' => 'pubDate',\n        'value' => gmdate('r', $node->getCreatedTime()),\n      ],\n      [\n        'key' => 'dc:creator',\n        'value' => $node->getOwner()->getDisplayName(),\n      ],\n      [\n        'key' => 'guid',\n        'value' => $node->id() . ' at ' . $base_url,\n        'attributes' => ['isPermaLink' => 'false'],\n      ],\n    ];\n\n    // The node gets built and modules add to or modify $node->rss_elements\n    // and $node->rss_namespaces.\n\n    $build = \\Drupal::entityTypeManager()\n      ->getViewBuilder('node')", "output": "<?php\n\nnamespace Drupal\\node\\Plugin\\views\\row;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Plugin\\views\\row\\RssPluginBase;\n\n/**\n * Performs a node_view on the resulting object and formats it as an RSS item.\n */\n#[ViewsRow(\n  id: \"node_rss\",\n  title: new TranslatableMarkup(\"Content\"),\n  help: new TranslatableMarkup(\"Display the content with standard node view.\"),\n  theme: \"views_view_row_rss\",\n  register_theme: FALSE,\n  base: [\"node_field_data\"],\n  display_types: [\"feed\"]\n)]\nclass Rss extends RssPluginBase {\n\n  /**\n   * The base table for this row plugin.\n   *\n   * @var string\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  public $base_table = 'node_field_data';\n\n  /**\n   * The base field for this row plugin.\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  public string $base_field = 'nid';\n\n  /**\n   * Stores the nodes loaded with preRender.\n   *\n   * @var array\n   */\n  public $nodes = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $entityTypeId = 'node';\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm_summary_options() {\n    $options = parent::buildOptionsForm_summary_options();\n    $options[$this::TITLE_VIEW_MODE] = $this->t('Title only');\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    $options = $this->buildOptionsForm_summary_options();\n    return $options[$this->options['view_mode']];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender($values) {\n    $nids = [];\n    foreach ($values as $row) {\n      $nids[] = $row->{$this->field_alias};\n    }\n    if (!empty($nids)) {\n      $this->nodes = $this->entityTypeManager->getStorage('node')->loadMultiple($nids);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($row) {\n    global $base_url;\n\n    $nid = $row->{$this->field_alias};\n    if (!is_numeric($nid)) {\n      return;\n    }\n\n    $display_mode = $this->options['view_mode'];\n\n    // Load the specified node:\n    /** @var \\Drupal\\node\\NodeInterface $node */\n    $node = $this->nodes[$nid];\n    if (empty($node)) {\n      return;\n    }\n\n    $node->rss_namespaces = [];\n    $node->rss_elements = [\n      [\n        'key' => 'pubDate',\n        'value' => gmdate('r', $node->getCreatedTime()),\n      ],\n      [\n        'key' => 'dc:creator',\n        'value' => $node->getOwner()->getDisplayName(),\n      ],\n      [\n        'key' => 'guid',\n        'value' => $node->id() . ' at ' . $base_url,\n        'attributes' => ['isPermaLink' => 'false'],\n      ],\n    ];\n\n    // The node gets built and modules add to or modify $node->rss_elements\n    // and $node->rss_namespaces.\n\n    $build = \\Drupal::entityTypeManager()\n      ->getViewBuilder('node')\n      ->view($node, $display_mode);\n    // Add rss key to cache to differentiate this from other caches.\n    $build['#cache']['keys'][] = 'view_rss';\n\n    unset($build['#theme']);\n\n    if (!empty($node->rss_namespaces)) {\n      $this->view->style_plugin->namespaces = array_merge($this->view->style_plugin->namespaces, $node->rss_namespaces);\n    }\n\n    $item = new \\stdClass();\n    if ($display_mode != $this::TITLE_VIEW_MODE) {\n      // We render node contents.\n      $item->description = $build;\n    }\n    $item->title = $node->label();\n    $item->link = $node->toUrl('canonical', ['absolute' => TRUE])->toString();\n    // Provide a reference so that the render call in\n    // template_preprocess_views_view_row_rss() can still access it.\n    $item->elements = &$node->rss_elements;\n    $item->nid = $node->id();\n    $build = [\n      '#theme' => $this->themeFunctions(),\n      '#view' => $this->view,\n      '#options' => $this->options,\n      '#row' => $item,\n    ];\n\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/node/src/Plugin/views/row/Rss.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Rss", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class Any in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Plugin\\DataType;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\TypedData\\Attribute\\DataType;\nuse Drupal\\Core\\TypedData\\TypedData;\n\n/**\n * The \"any\" data type.\n *\n * The \"any\" data type does not implement a list or complex data interface, nor\n * is it mappable to any primitive type. Thus, it may contain any PHP data for\n * which no further metadata is available.\n */\n#[DataType(\n  id: \"any\",\n  label: new TranslatableMarkup(\"Any data\")\n)]\nclass Any extends TypedData {\n\n  /**\n   * The data value.\n   *\n   * @var mixed\n   */\n  protected $value;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Plugin/DataType/Any.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Any", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Equality\nSource file: <source_file>\nFile name hint: Equality.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\filter;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsFilter;\n\n/**\n * Simple filter to handle equal to / not equal to filters.\n *\n * @ingroup views_filter_handlers\n */\n#[ViewsFilter(\"equality\")]\nclass Equality extends FilterPluginBase {\n\n  /**\n   * Exposed filter options.\n   *\n   * @var bool\n   */\n  protected $alwaysMultiple = TRUE;\n\n  /**\n   * Provide simple equality operator.\n   */\n  function operatorOptions() {\n    return [\n      '=' => $this->t('Is equal to'),\n      '!=' => $this->t('Is not equal to'),\n    ];\n  }\n\n  /**\n   * Provide a simple textfield for equality.\n   */\n  protected function valueForm(&$form, FormStateInterface $form_state) {\n    $form['value'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Value'),\n      '#size' => 30,\n      '#default_value' => $this->value,\n    ];\n\n    if ($form_state->get('exposed')) {\n      $identifier = $this->options['expose']['identifier'];\n      $user_input = $form_state->getUserInput();\n      if (!isset($user_input[$identifier])) {\n        $user_input[$identifier] = $this->value;\n        $form_state->setUserInput($user_input);\n      }\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\filter;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsFilter;\n\n/**\n * Simple filter to handle equal to / not equal to filters.\n *\n * @ingroup views_filter_handlers\n */\n#[ViewsFilter(\"equality\")]\nclass Equality extends FilterPluginBase {\n\n  /**\n   * Exposed filter options.\n   *\n   * @var bool\n   */\n  protected $alwaysMultiple = TRUE;\n\n  /**\n   * Provide simple equality operator.\n   */\n  public function operatorOptions() {\n    return [\n      '=' => $this->t('Is equal to'),\n      '!=' => $this->t('Is not equal to'),\n    ];\n  }\n\n  /**\n   * Provide a simple textfield for equality.\n   */\n  protected function valueForm(&$form, FormStateInterface $form_state) {\n    $form['value'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Value'),\n      '#size' => 30,\n      '#default_value' => $this->value,\n    ];\n\n    if ($form_state->get('exposed')) {\n      $identifier = $this->options['expose']['identifier'];\n      $user_input = $form_state->getUserInput();\n      if (!isset($user_input[$identifier])) {\n        $user_input[$identifier] = $this->value;\n        $form_state->setUserInput($user_input);\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/filter/Equality.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Equality", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a section of the help page.\n *\n * This implementation divides the links into 4 columns.\n *\n * Available variables:\n * - title: The section title.\n * - description: The description text for the section.\n * - links: Links to display in the section.\n * - empty: Text to display if there are no links.\n */\n#}\n<div class=\"clearfix\">\n  <h2>{{ title }}</h2>\n  <p>{{ description }}</p>\n  {% if links %}\n    {# Calculate the column length, to divide links into 4 columns. #}\n    {% set size = links|length // 4 %}\n    {% if size * 4 < links|length %}\n      {% set size = size + 1 %}\n    {% endif %}\n\n    {# Output the links in 4 columns. #}\n    {% set count = 0 %}\n    {% for link in links %}\n      {% if count == 0 %}\n        {# Start a new column. #}\n        <div class=\"layout-column layout-column--quarter\"><ul>\n      {% endif %}\n      <li>{{ link }}</li>\n      {% set count = count + 1 %}\n      {% if count >= size %}\n        {# End the current column. #}\n        {% set count = 0 %}\n        </ul></div>\n      {% endif %}\n    {% endfor %}\n\n    {# End the last column, if one is open. #}\n    {% if count > 0 %}\n      </ul></div>\n    {% endif %}\n  {% else %}\n    <p>{{ empty }}</p>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/misc/help-section.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the views cache.\n\nviews.cache.none:\n  type: views_cache\n  label: 'No caching'\n  mapping:\n    options:\n      type: sequence\n      label: 'Options'\n\nviews.cache.tag:\n  type: views_cache\n  label: 'Tag based caching'\n  mapping:\n    options:\n      type: sequence\n      label: 'Options'\n\nviews.cache.time:\n  type: views_cache\n  label: 'Time based caching'\n  mapping:\n    options:\n      type: mapping\n      label: 'Cache options'\n      mapping:\n        results_lifespan:\n          type: integer\n          label: 'The length of time raw query results should be cached.'\n        results_lifespan_custom:\n          type: integer\n          label: 'Length of time in seconds raw query results should be cached.'\n        output_lifespan:\n          type: integer\n          label: 'The length of time rendered HTML output should be cached.'\n        output_lifespan_custom:\n          type: integer\n          label: 'Length of time in seconds rendered HTML output should be cached.'\n", "metadata": {"source": "repos/drupal_core/core/modules/views/config/schema/views.cache.schema.yml", "type": "yaml_reference", "topic": "views.cache.schema"}}
{"instruction": "Show me the implementation of the interface ProtectionRulePluginInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Plugin\\ProtectionRule;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Core\\Entity\\Query\\QueryInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Interface for protection rule plugins.\n */\ninterface ProtectionRulePluginInterface extends PluginInspectionInterface, ConfigurableInterface, PluginFormInterface {\n\n  /**\n   * Checks if this rule applies to the given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   *\n   * @return bool\n   *   TRUE if this rule applies, FALSE otherwise.\n   */\n  public function appliesTo(string $entity_type_id, ?string $bundle = NULL): bool;\n\n  /**\n   * Modifies the entity query to exclude protected entities.\n   *\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryInterface $query\n   *   The entity query.\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   */\n  public function modifyQuery(QueryInterface $query, string $entity_type_id, ?string $bundle = NULL): void;\n\n  /**\n   * Checks if a specific entity ID is protected by this rule.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param int|string $entity_id\n   *   The entity ID.\n   *\n   * @return bool\n   *   TRUE if the entity is protected, FALSE otherwise.\n   */\n  public function isEntityProtected(string $entity_type_id, int|string $entity_id): bool;\n\n  /**\n   * Gets a summary of this protection rule.\n   *\n   * @return string\n   *   A human-readable summary.\n   */\n  public function summary(): string;\n\n  /**\n   * Indicates whether this rule completely prevents wipe operations.\n   *\n   * Some rules may completely prevent wiping (e.g., protect entity type),\n   * while others only exclude specific entities from the query.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   *\n   * @return bool\n   *   TRUE if wipe should be completely prevented, FALSE if query modification\n   *   is sufficient.\n   */\n  public function shouldPreventWipe(string $entity_type_id, ?string $bundle = NULL): bool;\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Plugin/ProtectionRule/ProtectionRulePluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ProtectionRulePluginInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FieldPathExtractor in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Util;\n\n/**\n * Utility class for extracting and setting field values using dot-notation paths.\n *\n * This class provides methods to work with nested array structures using\n * dot-notation paths (e.g., 'choices[0].message.content').\n */\nclass FieldPathExtractor {\n\n  /**\n   * Extract field value by dot-notation path.\n   *\n   * @param array $data\n   *   The data array.\n   * @param string $path\n   *   The field path (e.g., 'choices[0].message.content').\n   *\n   * @return mixed|null\n   *   The extracted value, or NULL if not found.\n   */\n  public static function extract(array $data, string $path) {\n    // Handle array notation like 'choices[0].message.content'.\n    $path = str_replace(['[', ']'], ['.', ''], $path);\n    $keys = explode('.', $path);\n\n    $value = $data;\n    foreach ($keys as $key) {\n      // Skip empty keys from double dots.\n      if ($key === '') {\n        continue;\n      }\n\n      if (is_array($value) && isset($value[$key])) {\n        $value = $value[$key];\n      }\n      else {\n        return NULL;\n      }\n    }\n\n    return $value;\n  }\n\n  /**\n   * Set field value by dot-notation path.\n   *\n   * @param array $data\n   *   The data array (passed by reference).\n   * @param string $path\n   *   The field path (e.g., 'choices[0].message.content').\n   * @param mixed $value\n   *   The value to set.\n   *\n   * @return bool\n   *   TRUE if the value was set, FALSE if the path is invalid.\n   */\n  public static function set(array &$data, string $path, $value): bool {\n    // Handle array notation like 'choices[0].message.content'.\n    $path = str_replace(['[', ']'], ['.', ''], $path);\n    $keys = explode('.', $path);\n\n    // Remove empty keys from double dots.\n    $keys = array_filter($keys, fn($key) => $key !== '');\n\n    if (empty($keys)) {\n      return FALSE;\n    }\n\n    // Navigate to the target location.\n    $current = &$data;\n    $last_key = array_pop($keys);\n\n    foreach ($keys as $key) {\n      if (!isset($current[$key]) || !is_array($current[$key])) {\n        $current[$key] = [];\n      }\n      $current = &$current[$key];\n    }\n\n    // Set the value.\n    $current[$last_key] = $value;\n    return TRUE;\n  }\n\n  /**\n   * Check if a field path exists in the data.\n   *\n   * @param array $data\n   *   The data array.\n   * @param string $path\n   *   The field path (e.g., 'choices[0].message.content').\n   *\n   * @return bool\n   *   TRUE if the path exists, FALSE otherwise.\n   */\n  public static function exists(array $data, string $path): bool {\n    // Handle array notation like 'choices[0].message.content'.\n    $path = str_replace(['[', ']'], ['.', ''], $path);\n    $keys = explode('.', $path);\n\n    $current = $data;\n    foreach ($keys as $key) {\n      // Skip empty keys from double dots.\n      if ($key === '') {\n        continue;\n      }\n\n      if (is_array($current) && isset($current[$key])) {\n        $current = $current[$key];\n      }\n      else {\n        return FALSE;\n      }\n    }\n\n    return TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Util/FieldPathExtractor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldPathExtractor", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Editor.php\nTarget symbol: class Editor\nNamespace: Drupal\\editor\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Editor.\n- Include required imports:\n  - Drupal\\Component\\Annotation\\Plugin", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\editor\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines an Editor annotation object.\n *\n * Plugin Namespace: Plugin\\Editor\n *\n * Text editor plugin implementations need to define a plugin definition array\n * through annotation. These definition arrays may be altered through\n * hook_editor_info_alter(). The definition includes the following keys:\n *\n * - id: The unique, system-wide identifier of the text editor. Typically named\n *   the same as the editor library.\n * - label: The human-readable name of the text editor, translated.\n * - supports_content_filtering: Whether the editor supports \"allowed content\n *   only\" filtering.\n * - supports_inline_editing: Whether the editor supports the inline editing\n *   provided by the Edit module.\n * - is_xss_safe: Whether this text editor is not vulnerable to XSS attacks.\n * - supported_element_types: On which form element #types this text editor is\n *   capable of working.\n *\n * A complete sample plugin definition should be defined as in this example:\n *\n * @code\n * @Editor(\n *   id = \"my_editor\",\n *   label = @Translation(\"My Editor\"),\n *   supports_content_filtering = FALSE,\n *   supports_inline_editing = FALSE,\n *   is_xss_safe = FALSE,\n *   supported_element_types = {\n *     \"textarea\",\n *     \"textfield\",\n *   }\n * )\n * @endcode\n *\n * For a working example, see \\Drupal\\ckeditor5\\Plugin\\Editor\\CKEditor5\n *\n * @see \\Drupal\\editor\\Plugin\\EditorPluginInterface\n * @see \\Drupal\\editor\\Plugin\\EditorBase\n * @see \\Drupal\\editor\\Plugin\\EditorManager\n * @see hook_editor_info_alter()\n * @see plugin_api\n *\n * @Annotation\n */\nclass Editor extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The human-readable name of the editor plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * Whether the editor supports \"allowed content only\" filtering.\n   *\n   * @var bool\n   */\n  public $supports_content_filtering;\n\n  /**\n   * Whether the editor supports the inline editing provided by the Edit module.\n   *\n   * @var bool\n   */\n  public $supports_inline_editing;\n\n  /**\n   * Whether this text editor is not vulnerable to XSS attacks.\n   *\n   * @var bool\n   */\n  public $is_xss_safe;\n\n  /**\n   * A list of element types this text editor supports.\n   *\n   * @var string[]\n   */\n  public $supported_element_types;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/editor/src/Annotation/Editor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Editor", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a form element.\n *\n * @see\\Drupal\\Core\\Form\\FormPreprocess::preprocessFormElement()\n */\n#}\n{#\n  Most of core-provided js assumes that the CSS class pattern js-form-item-[something] or\n  js-form-type-[something] exists on form items. We have to keep them.\n#}\n{%\n  set classes = [\n    'js-form-item',\n    'form-item',\n    'js-form-type-' ~ type|clean_class,\n    'form-type--' ~ type|clean_class,\n    type in ['checkbox', 'radio'] ? 'form-type--boolean',\n    'js-form-item-' ~ name|clean_class,\n    'form-item--' ~ name|clean_class,\n    title_display not in ['after', 'before'] ? 'form-item--no-label',\n    disabled == 'disabled' ? 'form-item--disabled',\n    errors ? 'form-item--error',\n  ]\n%}\n{%\n  set description_classes = [\n    'form-item__description',\n    description_display == 'invisible' ? 'visually-hidden',\n  ]\n%}\n<div{{ attributes.addClass(classes) }}>\n  {% if label_display in ['before', 'invisible'] %}\n    {{ label }}\n  {% endif %}\n  {% if description_display == 'before' and description.content %}\n    <div{{ description.attributes.addClass(description_classes) }}>\n      {{ description.content }}\n    </div>\n  {% endif %}\n  {% if prefix is not empty %}\n    <span class=\"form-item__prefix{{ disabled == 'disabled' ? ' is-disabled' }}\">{{ prefix }}</span>\n  {% endif %}\n  {{ children }}\n  {% if suffix is not empty %}\n    <span class=\"form-item__suffix{{ disabled == 'disabled' ? ' is-disabled' }}\">{{ suffix }}</span>\n  {% endif %}\n  {% if label_display == 'after' %}\n    {{ label }}\n  {% endif %}\n  {% if errors %}\n    <div class=\"form-item__error-message\">\n      {{ errors }}\n    </div>\n  {% endif %}\n  {% if description_display in ['after', 'invisible'] and description.content %}\n    <div{{ description.attributes.addClass(description_classes) }}>\n      {{ description.content }}\n    </div>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/themes/claro/templates/form-element.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class QueueSize in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\nuse Drupal\\Core\\Render\\Element\\RenderElementBase;\nuse Drupal\\queue_manager\\Hook\\Theme;\n\n/**\n * Provides a render element to get queue size.\n *\n * Properties:\n * - #title: Element title.\n * - #queue_name: Queue name.\n * - #refresh: Refresh timeout in seconds.\n *\n * Usage Example:\n * @code\n * $build['example'] = [\n *   '#type' => 'queue_size',\n *   '#title' => 'Number of items',\n *   '#queue_name' => 'example',\n *   'refresh' => 1,\n * ];\n * @endcode\n */\n#[RenderElement(self::ID)]\nfinal class QueueSize extends RenderElementBase {\n\n  public const string ID = 'queue_size';\n\n  /**\n   * {@selfdoc}\n   */\n  public static function build(string|\\Stringable|null $title, string $queue_name, int|float $refresh): array {\n    if ($title instanceof \\Stringable) {\n      $title = (string) $title;\n    }\n    return [\n      '#type' => self::ID,\n      '#title' => $title ,\n      '#queue_name' => $queue_name,\n      '#refresh' => $refresh,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo(): array {\n    return [\n      '#theme' => Theme::QUEUE_SIZE,\n      '#attached' => ['library' => ['queue_manager/queue_size']],\n      '#pre_render' => [[self::class, 'preRender']],\n    ];\n  }\n\n  /**\n   * Element pre-sender callback.\n   */\n  public static function preRender(array $element): array {\n    // @phpstan-ignore argument.type\n    $queue = \\Drupal::queue($element['#queue_name']);\n    $element['#size'] = $queue->numberOfItems();\n    return $element;\n  }\n\n}\n\n$build['queue_status'] = [\n  '#type' => 'queue_size',\n  '#title' => 'Number of items',\n  '#queue_name' => 'example',\n  'refresh' => 1,\n];\n", "metadata": {"source": "repos/queue_manager/src/Element/QueueSize.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "QueueSize", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: AgentApiToolBase.php\nTarget symbol: class for\nNamespace: Drupal\\api_normalization_agents\\Plugin\\AgentApiTool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\PluginBase\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - create()\n  - execute()\n  - getOssaToolSchema()\n  - validateParameters()\n  - validateType()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Plugin\\AgentApiTool;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Base class for AgentApiTool plugins.\n */\nabstract class AgentApiToolBase extends PluginBase implements AgentApiToolInterface, ContainerFactoryPluginInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  abstract public function execute(array $parameters, array $context): array;\n\n  /**\n   * {@inheritdoc}\n   */\n  abstract public function getOssaToolSchema(): array;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParameters(array $parameters): array {\n    $schema = $this->getOssaToolSchema();\n\n    if (!isset($schema['function']['parameters'])) {\n      return ['valid' => TRUE, 'errors' => []];\n    }\n\n    $errors = [];\n    $paramSchema = $schema['function']['parameters'];\n\n    // Check required parameters.\n    if (isset($paramSchema['required'])) {\n      foreach ($paramSchema['required'] as $required) {\n        if (!array_key_exists($required, $parameters)) {\n          $errors[] = \"Missing required parameter: {$required}\";\n        }\n      }\n    }\n\n    // Basic type checking.\n    if (isset($paramSchema['properties'])) {\n      foreach ($parameters as $key => $value) {\n        if (!isset($paramSchema['properties'][$key])) {\n          continue;\n        }\n\n        $expectedType = $paramSchema['properties'][$key]['type'] ?? NULL;\n        if ($expectedType !== NULL && !$this->validateType($value, $expectedType)) {\n          $errors[] = \"Invalid type for parameter {$key}: expected {$expectedType}\";\n        }\n      }\n    }\n\n    return [\n      'valid' => empty($errors),\n      'errors' => $errors,\n    ];\n  }\n\n  /**\n   * Validates a value against a JSON Schema type.\n   *\n   * @param mixed $value\n   *   The value to validate.\n   * @param string $type\n   *   The expected type.\n   *\n   * @return bool\n   *   TRUE if valid.\n   */\n  protected function validateType($value, string $type): bool {\n    return match ($type) {\n      'string' => is_string($value),\n      'number', 'integer' => is_numeric($value),\n      'boolean' => is_bool($value),\n      'array' => is_array($value),\n      'object' => is_object($value) || is_array($value),\n      default => TRUE,\n    };\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/src/Plugin/AgentApiTool/AgentApiToolBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AgentApiToolBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BookNodePrintAccessCheck.php\nTarget symbol: class BookNodePrintAccessCheck\nNamespace: Drupal\\book\\Access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BookNodePrintAccessCheck.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Access\\AccessResultInterface\n  - Drupal\\Core\\Routing\\Access\\AccessInterface\n  - Drupal\\Core\\Session\\AccountInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - access()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\book\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Determines if a user has access to print.\n */\nclass BookNodePrintAccessCheck implements AccessInterface {\n\n  /**\n   * Constructs a BookNodePrintAccessCheck object.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $currentUser\n   *   The current logged-in user.\n   */\n  public function __construct(protected AccountInterface $currentUser) {\n  }\n\n  /**\n   * Checks if user has permission to access print link.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(): AccessResultInterface {\n    return AccessResult::allowedIfHasPermission($this->currentUser, 'access printer-friendly version');\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Access/BookNodePrintAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookNodePrintAccessCheck", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class BookUninstallValidator in the file <source_file>.", "input": "", "output": "<?php\n// phpcs:ignoreFile\n\n/**\n * This file was generated via php core/scripts/generate-proxy-class.php 'Drupal\\book\\BookUninstallValidator' \"core/modules/book/src\".\n */\n\nnamespace Drupal\\book\\ProxyClass {\n\n    /**\n     * Provides a proxy class for \\Drupal\\book\\BookUninstallValidator.\n     *\n     * @see \\Drupal\\Component\\ProxyBuilder\n     */\n    class BookUninstallValidator implements \\Drupal\\Core\\Extension\\ModuleUninstallValidatorInterface\n    {\n\n        use \\Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\n\n        /**\n         * The id of the original proxied service.\n         *\n         * @var string\n         */\n        protected $drupalProxyOriginalServiceId;\n\n        /**\n         * The real proxied service, after it was lazy loaded.\n         *\n         * @var \\Drupal\\book\\BookUninstallValidator\n         */\n        protected $service;\n\n        /**\n         * The service container.\n         *\n         * @var \\Symfony\\Component\\DependencyInjection\\ContainerInterface\n         */\n        protected $container;\n\n        /**\n         * Constructs a ProxyClass Drupal proxy object.\n         *\n         * @param \\Symfony\\Component\\DependencyInjection\\ContainerInterface $container\n         *   The container.\n         * @param string $drupal_proxy_original_service_id\n         *   The service ID of the original service.\n         */\n        public function __construct(\\Symfony\\Component\\DependencyInjection\\ContainerInterface $container, $drupal_proxy_original_service_id)\n        {\n            $this->container = $container;\n            $this->drupalProxyOriginalServiceId = $drupal_proxy_original_service_id;\n        }\n\n        /**\n         * Lazy loads the real service from the container.\n         *\n         * @return object\n         *   Returns the constructed real service.\n         */\n        protected function lazyLoadItself()\n        {\n            if (!isset($this->service)) {\n                $this->service = $this->container->get($this->drupalProxyOriginalServiceId);\n            }\n\n            return $this->service;\n        }\n\n        /**\n         * {@inheritdoc}\n         */\n        public function validate($module)\n        {\n            return $this->lazyLoadItself()->validate($module);\n        }\n\n        /**\n         * {@inheritdoc}\n         */\n        public function setStringTranslation(\\Drupal\\Core\\StringTranslation\\TranslationInterface $translation)\n        {\n            return $this->lazyLoadItself()->setStringTranslation($translation);\n        }\n\n    }\n\n}\n", "metadata": {"source": "repos/livre/book/src/ProxyClass/BookUninstallValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookUninstallValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: EnvironmentSupportValidator.php\nTarget symbol: class EnvironmentSupportValidator\nNamespace: Drupal\\package_manager\\Validator\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for EnvironmentSupportValidator.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\package_manager\\Event\\SandboxValidationEvent\n  - Drupal\\Core\\Url\n  - Symfony\\Component\\EventDispatcher\\EventSubscriberInterface\n- Ensure these methods exist where relevant:\n  - getSubscribedEvents()\n  - validate()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\package_manager\\Validator;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\package_manager\\Event\\SandboxValidationEvent;\nuse Drupal\\Core\\Url;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Checks that the environment has support for Package Manager.\n *\n * @internal\n *   This is an internal part of Package Manager and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class EnvironmentSupportValidator implements EventSubscriberInterface {\n\n  use BaseRequirementValidatorTrait {\n    getSubscribedEvents as private getSubscribedEventsFromTrait;\n  }\n  use StringTranslationTrait;\n\n  /**\n   * The name of the environment variable to check.\n   *\n   * This environment variable, if defined, should be parseable by\n   * \\Drupal\\Core\\Url::fromUri() and link to an explanation of why Package\n   * Manager is not supported in the current environment.\n   *\n   * @var string\n   */\n  public const VARIABLE_NAME = 'DRUPAL_PACKAGE_MANAGER_NOT_SUPPORTED_HELP_URL';\n\n  /**\n   * Checks that this environment supports Package Manager.\n   */\n  public function validate(SandboxValidationEvent $event): void {\n    $message = $this->t('Package Manager is not supported by your environment.');\n\n    $help_url = getenv(static::VARIABLE_NAME);\n    if (empty($help_url)) {\n      return;\n    }\n    // If the URL is not parseable, catch the exception that Url::fromUri()\n    // would generate.\n    try {\n      $message = $this->t('<a href=\":url\">@message</a>', [\n        ':url' => Url::fromUri($help_url)->toString(),\n        '@message' => $message,\n      ]);\n    }\n    catch (\\InvalidArgumentException) {\n      // No need to do anything here. The message just won't be a link.\n    }\n    $event->addError([$message]);\n    // If Package Manager is unsupported, there's no point in doing any more\n    // validation.\n    $event->stopPropagation();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    // Set priority to run before BaseRequirementsFulfilledValidator, and even\n    // before other base requirement validators.\n    // @see \\Drupal\\package_manager\\Validator\\BaseRequirementsFulfilledValidator\n    return array_map(fn () => ['validate', BaseRequirementsFulfilledValidator::PRIORITY + 1000], static::getSubscribedEventsFromTrait());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/package_manager/src/Validator/EnvironmentSupportValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EnvironmentSupportValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DateField\nSource file: <source_file>\nFile name hint: DateField.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\datetime\\Plugin\\migrate\\field;\n\nuse Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItemInterface;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Attribute\\MigrateField;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\field\\FieldPluginBase;\n\n// cspell:ignore todate\n\n/**\n * Provides a field plugin for date and time fields.\n */\n#[MigrateField(\n  id: 'datetime',\n  core: [6, 7],\n  type_map: [\n    'date' => 'datetime',\n    'datestamp' => 'timestamp',\n    'datetime' => 'datetime',\n  ],\n  source_module: 'date',\n  destination_module: 'datetime',\n)]\nclass DateField extends FieldPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function getFieldFormatterMap() {\n    return [\n      'date_default' => 'datetime_default',\n      'format_interval' => 'datetime_time_ago',\n      // The date_plain formatter exists in Drupal 7 but not Drupal 6. It is\n      // added here because this plugin is declared for Drupal 6 and Drupal 7.\n      'date_plain' => 'datetime_plain',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFieldWidgetMap() {\n    return [\n      'date' => 'datetime_default',\n      'datetime' => 'datetime_default',\n      'datestamp' => 'datetime_timestamp',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defineValueProcessPipeline(MigrationInterface $migration, $field_name, $data) {\n    $to_format = DateTimeItemInterface::DATETIME_STORAGE_FORMAT;\n    if (isset($data['field_definition']['data'])) {\n      $field_data = unserialize($data['field_definition']['data']);\n      if (isset($field_data['settings']['granularity'])) {\n        $granularity = $field_data['settings']['granularity'];\n        $collected_date_attributes = is_numeric(array_keys($granularity)[0])\n          ? $granularity\n          : array_keys(array_filter($granularity));\n        if (empty(array_intersect($collected_date_attributes, ['hour', 'minute', 'second']))) {\n          $to_format = DateTimeItemInterface::DATE_STORAGE_FORMAT;\n        }\n      }\n    }\n\n    switch ($data['type']) {\n      case 'date':\n        $from_format = 'Y-m-d\\TH:i:s';\n        break;\n\n      case 'datestamp':\n        $from_format = 'U';\n        $to_format = 'U';\n        break;\n\n      case 'datetime':\n        $from_format = 'Y-m-d H:i:s';\n        break;\n\n      default:\n        throw new MigrateException(sprintf('Field %s of type %s is an unknown date field type.', $field_name, var_export($data['type'], TRUE)));\n    }\n    $process = [\n      'value' => [\n        'plugin' => 'format_date',\n        'from_format' => $from_format,\n        'to_format' => $to_format,\n        'source' => 'value',\n      ],\n    ];\n\n    // If the 'todate' setting is specified the field is now a 'daterange' and\n    // so set the end value. If the datetime_range module is not enabled on the\n    // destination then end_value is ignored and a message is logged in the\n    // relevant migrate message table.\n    if (!empty($field_data['settings']['todate'])) {\n      $process['end_value'] = $process['value'];\n      $process['end_value']['source'] = 'value2';\n    }\n\n    $process = [\n      'plugin' => 'sub_process',\n      'source' => $field_name,\n      'process' => $process,\n    ];\n    $migration->mergeProcessOfProperty($field_name, $process);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFieldType(Row $row) {\n    $field_type = parent::getFieldType($row);\n", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\migrate\\field;\n\nuse Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItemInterface;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Attribute\\MigrateField;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\field\\FieldPluginBase;\n\n// cspell:ignore todate\n\n/**\n * Provides a field plugin for date and time fields.\n */\n#[MigrateField(\n  id: 'datetime',\n  core: [6, 7],\n  type_map: [\n    'date' => 'datetime',\n    'datestamp' => 'timestamp',\n    'datetime' => 'datetime',\n  ],\n  source_module: 'date',\n  destination_module: 'datetime',\n)]\nclass DateField extends FieldPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFieldFormatterMap() {\n    return [\n      'date_default' => 'datetime_default',\n      'format_interval' => 'datetime_time_ago',\n      // The date_plain formatter exists in Drupal 7 but not Drupal 6. It is\n      // added here because this plugin is declared for Drupal 6 and Drupal 7.\n      'date_plain' => 'datetime_plain',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFieldWidgetMap() {\n    return [\n      'date' => 'datetime_default',\n      'datetime' => 'datetime_default',\n      'datestamp' => 'datetime_timestamp',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defineValueProcessPipeline(MigrationInterface $migration, $field_name, $data) {\n    $to_format = DateTimeItemInterface::DATETIME_STORAGE_FORMAT;\n    if (isset($data['field_definition']['data'])) {\n      $field_data = unserialize($data['field_definition']['data']);\n      if (isset($field_data['settings']['granularity'])) {\n        $granularity = $field_data['settings']['granularity'];\n        $collected_date_attributes = is_numeric(array_keys($granularity)[0])\n          ? $granularity\n          : array_keys(array_filter($granularity));\n        if (empty(array_intersect($collected_date_attributes, ['hour', 'minute', 'second']))) {\n          $to_format = DateTimeItemInterface::DATE_STORAGE_FORMAT;\n        }\n      }\n    }\n\n    switch ($data['type']) {\n      case 'date':\n        $from_format = 'Y-m-d\\TH:i:s';\n        break;\n\n      case 'datestamp':\n        $from_format = 'U';\n        $to_format = 'U';\n        break;\n\n      case 'datetime':\n        $from_format = 'Y-m-d H:i:s';\n        break;\n\n      default:\n        throw new MigrateException(sprintf('Field %s of type %s is an unknown date field type.', $field_name, var_export($data['type'], TRUE)));\n    }\n    $process = [\n      'value' => [\n        'plugin' => 'format_date',\n        'from_format' => $from_format,\n        'to_format' => $to_format,\n        'source' => 'value',\n      ],\n    ];\n\n    // If the 'todate' setting is specified the field is now a 'daterange' and\n    // so set the end value. If the datetime_range module is not enabled on the\n    // destination then end_value is ignored and a message is logged in the\n    // relevant migrate message table.\n    if (!empty($field_data['settings']['todate'])) {\n      $process['end_value'] = $process['value'];\n      $process['end_value']['source'] = 'value2';\n    }\n\n    $process = [\n      'plugin' => 'sub_process',\n      'source' => $field_name,\n      'process' => $process,\n    ];\n    $migration->mergeProcessOfProperty($field_name, $process);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFieldType(Row $row) {\n    $field_type = parent::getFieldType($row);\n\n    // If the 'todate' setting is specified then change the field type to\n    // 'daterange' so we can migrate the end date.\n    if ($field_type === 'datetime' && !empty($row->get('settings/todate'))) {\n      if (\\Drupal::service('module_handler')->moduleExists('datetime_range')) {\n        return 'daterange';\n      }\n      else {\n        throw new MigrateException(sprintf(\"Can't migrate field '%s' with 'todate' settings. Enable the datetime_range module. See https://www.drupal.org/docs/8/upgrade/known-issues-when-upgrading-from-drupal-6-or-7-to-drupal-8#datetime\", $row->get('field_name')));\n      }\n    }\n\n    return $field_type;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/migrate/field/DateField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateField", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class RequiredConfigDependenciesConstraintValidator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\Core\\Config\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityTypeInterface;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\LogicException;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validates the RequiredConfigDependencies constraint.\n */\nclass RequiredConfigDependenciesConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  /**\n   * The entity type manager service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * Constructs a RequiredConfigDependenciesConstraintValidator object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager service.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager) {\n    $this->entityTypeManager = $entity_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $entity, Constraint $constraint): void {\n    assert($constraint instanceof RequiredConfigDependenciesConstraint);\n\n    // Only config entities can have config dependencies.\n    if (!$entity instanceof ConfigEntityInterface) {\n      throw new UnexpectedTypeException($entity, ConfigEntityInterface::class);\n    }\n\n    $config_dependencies = $entity->getDependencies()['config'] ?? [];\n\n    foreach ($constraint->entityTypes as $entity_type_id) {\n      $entity_type = $this->entityTypeManager->getDefinition($entity_type_id);\n\n      if (!$entity_type instanceof ConfigEntityTypeInterface) {\n        throw new LogicException(\"'$entity_type_id' is not a config entity type.\");\n      }\n\n      // Ensure the current entity type's config prefix is found in the config\n      // dependencies of the entity being validated.\n      $pattern = sprintf('/^%s\\\\.\\\\w+/', $entity_type->getConfigPrefix());\n      if (!preg_grep($pattern, $config_dependencies)) {\n        $this->context->addViolation($constraint->message, [\n          '@entity_type' => $entity->getEntityType()->getSingularLabel(),\n          '@dependency_type' => $entity_type->getSingularLabel(),\n        ]);\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/Plugin/Validation/Constraint/RequiredConfigDependenciesConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RequiredConfigDependenciesConstraintValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FormHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\social_auth_account_verification\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Messenger\\MessengerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\social_auth_account_verification\\Service\\VerificationServiceInterface;\n\n/**\n * Form hooks for social auth account verification.\n */\nclass FormHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Constructor.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\Drupal\\social_auth_account_verification\\Service\\VerificationServiceInterface $verificationService\n   *   The verification service.\n   * @param \\Drupal\\Core\\Messenger\\MessengerInterface $messenger\n   *   The messenger service.\n   */\n  public function __construct(\n    protected readonly EntityTypeManagerInterface $entityTypeManager,\n    protected readonly VerificationServiceInterface $verificationService,\n    protected readonly MessengerInterface $messenger,\n  ) {\n  }\n\n  /**\n   * Implements hook_form_FORM_ID_alter().\n   */\n  #[Hook('form_user_login_form_alter')]\n  public function userLoginFormAlter(array &$form, FormStateInterface $form_state): void {\n    // Add custom validation to check for users with pending verification\n    // entities.\n    $form['#validate'][] = [$this, 'validateUserLogin'];\n  }\n\n  /**\n   * Custom validation for user login form.\n   *\n   * @param array $form\n   *   The form array.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   */\n  public function validateUserLogin(array &$form, FormStateInterface $form_state): void {\n    $name = $form_state->getValue('name');\n    if (empty($name)) {\n      return;\n    }\n\n    // Load user by username or email.\n    $users = $this->entityTypeManager\n      ->getStorage('user')\n      ->loadByProperties(['name' => $name]);\n\n    // Also try by email if not found by username.\n    if (empty($users)) {\n      $users = $this->entityTypeManager\n        ->getStorage('user')\n        ->loadByProperties(['mail' => $name]);\n    }\n\n    if (!empty($users)) {\n      $user = reset($users);\n\n      // Check if user has a verification entity.\n      $verification = $this->verificationService->getVerification($user);\n      if ($verification) {\n        // User has verification but is trying to log in via regular form.\n        // They need to complete social auth flow to get session token for\n        // verification.\n        // Don't redirect - just show error message.\n        $form_state->setError($form['name'], $this->t('Your account requires verification. Please complete the social authentication process to verify your account.'));\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/social_auth_account_verification/src/Hook/FormHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FormHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Nav\ndescription: \"The base .nav component is built with flexbox and provide a strong foundation for building all types of navigation components. It includes some style overrides (for working with lists), some link padding for larger hit areas, and basic disabled styling.\"\ngroup: \"Navs and tabs\"\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/components/navs-tabs/\"\nvariants:\n  default:\n    title: Default\n  tabs:\n    title: Tabs\n  tabs__fill:\n    title: \"Tabs filled\"\n  tabs__justified:\n    title: \"Tabs filled with same width\"\n  pills:\n    title: Pills\n  pills__fill:\n    title: \"Pills filled\"\n  pills__justified:\n    title: \"Pills filled with same width\"\n  underline:\n    title: Underline\nslots:\n  tab_content:\n    title: \"Tab content\"\n    description: \"A list of renderable elements. Each item will be put in tab panes and the nav items will be used to navigate among the panes. You need to ensure that there is the same amount of nav links and tab items.\"\nprops:\n  type: object\n  properties:\n    nav_id:\n      title: \"Nav ID\"\n      description: \"Must start with a letter. Randomly generated if empty.\"\n      type: string\n    nav_type:\n      title: \"List type\"\n      type: string\n      enum:\n        - ul\n        - ol\n        - nav\n      \"meta:enum\":\n        ul: \"ul (Default)\"\n        ol: ol\n        nav: nav\n    dropdown_id:\n      title: \"Dropdown ID\"\n      description: \"Must start with a letter. Randomly generated if empty.\"\n      type: string\n    card_header:\n      title: \"Card header\"\n      description: \"Styling adjustment for tabs and pills variants when used in the header of the card component.\"\n      type: boolean\n    items:\n      title: \"Nav items\"\n      type: array\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/nav/nav.component.yml", "type": "yaml_reference", "topic": "nav.component"}}
{"instruction": "Show me the implementation of the class SynchronousOrchestratorPlugin in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Plugin\\Orchestrator;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_runtime\\Attribute\\Orchestrator;\nuse Drupal\\flowdrop_runtime\\DTO\\Orchestrator\\OrchestrationRequest;\nuse Drupal\\flowdrop_runtime\\DTO\\Orchestrator\\OrchestrationResponse;\nuse Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Synchronous workflow orchestrator plugin.\n *\n * Executes workflows directly without requiring pipeline entities. Uses the\n * ExecutionGraph for determining execution order and the DependencyGraph for\n * data resolution at runtime.\n *\n * This plugin delegates to the SynchronousOrchestrator service which is\n * configured with all required dependencies including the WorkflowStateManager\n * for snapshot generation.\n */\n#[Orchestrator(\n  id: \"synchronous\",\n  label: new TranslatableMarkup(\"Synchronous Orchestrator\"),\n  description: \"Executes workflows synchronously with real-time updates\",\n)]\nclass SynchronousOrchestratorPlugin extends OrchestratorPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The underlying synchronous orchestrator service.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator\n   */\n  protected SynchronousOrchestrator $orchestratorService;\n\n  /**\n   * Constructs a new SynchronousOrchestratorPlugin.\n   *\n   * @param array<string, mixed> $configuration\n   *   A configuration array.\n   * @param string $plugin_id\n   *   The plugin ID.\n   * @param mixed $plugin_definition\n   *   The plugin definition.\n   * @param \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator $orchestratorService\n   *   The synchronous orchestrator service (fully configured with all deps).\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    SynchronousOrchestrator $orchestratorService,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->orchestratorService = $orchestratorService;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get(\"flowdrop_runtime.synchronous_orchestrator\"),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function orchestrate(OrchestrationRequest $request): OrchestrationResponse {\n    return $this->orchestratorService->orchestrate($request);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsWorkflow(array $workflow): bool {\n    return $this->orchestratorService->supportsWorkflow($workflow);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCapabilities(): array {\n    return $this->orchestratorService->getCapabilities();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state, array $settings): array {\n    // Merge with defaults to ensure all settings have values.\n    $settings = array_merge($this->getDefaultConfiguration(), $settings);\n\n    // Synchronous orchestrator has minimal configuration.\n    // Just use the common fields (priority, timeout) from parent.\n    $form[\"info\"] = [\n      \"#type\" => \"markup\",\n      \"#markup\" => \"<p>\" . $this->t(\"The synchronous orchestrator executes workflows immediately in the current request. It provides real-time updates and is best suited for short-running workflows.\") . \"</p>\",\n    ];\n\n    $form[\"realtime\"] = [\n      \"#type\" => \"fieldset\",\n      \"#title\" => $this->t(\"Real-Time Settings\"),\n      \"#description\" => $this->t(\"Configure real-time execution behavior.\"),\n    ];\n\n    $form[\"realtime\"][\"enable_realtime_updates\"] = [\n      \"#type\" => \"checkbox\",\n      \"#title\" => $this->t(\"Enable Real-Time Updates\"),\n      \"#description\" => $this->t(\"Send real-time status updates during execution. Requires WebSocket or SSE support.\"),\n      \"#default_value\" => $settings[\"enable_realtime_updates\"] ?? TRUE,\n    ];\n\n    $form[\"realtime\"][\"log_level\"] = [\n      \"#type\" => \"select\",\n      \"#title\" => $this->t(\"Logging Level\"),\n      \"#description\" => $this->t(\"Detail level for execution logging.\"),\n      \"#options\" => [\n        \"minimal\" => $this->t(\"Minimal - Only errors\"),\n        \"normal\" => $this->t(\"Normal - Start/end and errors\"),\n        \"verbose\" => $this->t(\"Verbose - All node executions\"),\n        \"debug\" => $this->t(\"Debug - Everything including data\"),\n      ],\n      \"#default_value\" => $settings[\"log_level\"] ?? \"normal\",\n    ];\n\n    // Add common fields from parent (priority, timeout).\n    $form = parent::buildConfigurationForm($form, $form_state, $settings);\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array $form, FormStateInterface $form_state): array {\n    // Get base configuration from parent.\n    $config = parent::submitConfigurationForm($form, $form_state);\n\n    // Extract synchronous-specific values.\n    $values = $form_state->getValue(\"orchestrator_settings\") ?? [];\n\n    $realtimeSettings = $values[\"realtime\"] ?? [];\n    $config[\"enable_realtime_updates\"] = (bool) ($realtimeSettings[\"enable_realtime_updates\"] ?? TRUE);\n    $config[\"log_level\"] = $realtimeSettings[\"log_level\"] ?? \"normal\";\n\n    return $config;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultConfiguration(): array {\n    return [\n      \"type\" => $this->getPluginId(),\n      \"priority\" => \"normal\",\n      \"timeout\" => 300,\n      \"enable_realtime_updates\" => TRUE,\n      \"log_level\" => \"normal\",\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Plugin/Orchestrator/SynchronousOrchestratorPlugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SynchronousOrchestratorPlugin", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EntityDeriver in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Plugin\\DataType\\Deriver;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface;\nuse Drupal\\Core\\Entity\\Plugin\\DataType\\ConfigEntityAdapter;\nuse Drupal\\Core\\Entity\\Plugin\\DataType\\EntityAdapter;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides data type plugins for each existing entity type and bundle.\n */\nclass EntityDeriver implements ContainerDeriverInterface {\n\n  /**\n   * List of derivative definitions.\n   *\n   * @var array\n   */\n  protected $derivatives = [];\n\n  /**\n   * The base plugin ID this derivative is for.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The bundle info service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface\n   */\n  protected $bundleInfoService;\n\n  /**\n   * Constructs an EntityDeriver object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface $bundle_info_service\n   *   The bundle info service.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, EntityTypeBundleInfoInterface $bundle_info_service) {\n    $this->basePluginId = $base_plugin_id;\n    $this->entityTypeManager = $entity_type_manager;\n    $this->bundleInfoService = $bundle_info_service;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('entity_type.bundle.info')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinition($derivative_id, $base_plugin_definition) {\n    if (!empty($this->derivatives) && !empty($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n    $this->getDerivativeDefinitions($base_plugin_definition);\n    if (isset($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    // Also keep the 'entity' defined as is.\n    $this->derivatives[''] = $base_plugin_definition;\n    // Add definitions for each entity type and bundle.\n    foreach ($this->entityTypeManager->getDefinitions() as $entity_type_id => $entity_type) {\n      $class = $entity_type->entityClassImplements(ConfigEntityInterface::class) ? ConfigEntityAdapter::class : EntityAdapter::class;\n      $this->derivatives[$entity_type_id] = [\n        'class' => $class,\n        'label' => $entity_type->getLabel(),\n        'constraints' => $entity_type->getConstraints(),\n        'internal' => $entity_type->isInternal(),\n      ] + $base_plugin_definition;\n\n      // Incorporate the bundles as entity:$entity_type:$bundle, if any.\n      $bundle_info = $this->bundleInfoService->getBundleInfo($entity_type_id);\n      if (count($bundle_info) > 1 || $entity_type->getKey('bundle')) {\n        foreach ($bundle_info as $bundle => $info) {\n          $this->derivatives[$entity_type_id . ':' . $bundle] = [\n            'class' => $class,\n            'label' => $info['label'],\n            'constraints' => $this->derivatives[$entity_type_id]['constraints'],\n          ] + $base_plugin_definition;\n        }\n      }\n    }\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Plugin/DataType/Deriver/EntityDeriver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityDeriver", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Select in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\sqlite\\Driver\\Database\\sqlite;\n\nuse Drupal\\Core\\Database\\Query\\Select as QuerySelect;\n\n/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Query\\Select.\n */\nclass Select extends QuerySelect {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function forUpdate($set = TRUE) {\n    // SQLite does not support FOR UPDATE so nothing to do.\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/sqlite/src/Driver/Database/sqlite/Select.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Select", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "################\n# Uses the GitLabCI template for Drupal projects.\n# The full documentation is on https://project.pages.drupalcode.org/gitlab_templates/\n################\n\ninclude:\n  - project: $_GITLAB_TEMPLATES_REPO\n    ref: $_GITLAB_TEMPLATES_REF\n    file:\n      - \"/includes/include.drupalci.main.yml\"\n      - \"/includes/include.drupalci.variables.yml\"\n      - \"/includes/include.drupalci.workflows.yml\"\n\nvariables:\n  # Skip ESLint and Stylelint as this module has no JS/CSS assets.\n  SKIP_ESLINT: 1\n  SKIP_STYLELINT: 1\n  # Run tests on multiple PHP/Drupal versions.\n  OPT_IN_TEST_PREVIOUS_MAJOR: 1\n  OPT_IN_TEST_PREVIOUS_MINOR: 1\n  OPT_IN_TEST_NEXT_MINOR: 1\n  OPT_IN_TEST_MAX_PHP: 1\n", "metadata": {"source": "repos/multilingual_tokens/.gitlab-ci.yml", "type": "yaml_reference", "topic": ".gitlab-ci"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Layout Builder Restrictions By Region\ncore_version_requirement: ^10 || ^11\ndescription: 'Restricts layouts and blocks per layout region'\ntype: module\npackage: 'Layout Builder'\ndependencies:\n  - drupal:layout_builder\n  - layout_builder_restrictions:layout_builder_restrictions\n", "metadata": {"source": "repos/layout_builder_restrictions/modules/layout_builder_restrictions_by_region/layout_builder_restrictions_by_region.info.yml", "type": "yaml_reference", "topic": "layout builder restrictions by region.info"}}
{"instruction": "Show me the implementation of the class ExistsInConstraintValidator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\book\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Config\\Schema\\ArrayElement;\nuse Drupal\\Core\\TypedData\\TypedDataInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validates the ExistsIn constraint.\n */\nclass ExistsInConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $value, Constraint $constraint): void {\n    if (!$constraint instanceof ExistsInConstraint) {\n      throw new UnexpectedTypeException($constraint, ExistsInConstraint::class);\n    }\n\n    $this_property = $this->context->getObject();\n    assert($this_property instanceof TypedDataInterface);\n    $choices_raw = self::find($constraint->selector, $this_property)->getValue();\n\n    $allowed_types = [];\n    foreach ($choices_raw as $choice) {\n      $allowed_types[] = $choice['content_type'];\n    }\n\n    if (!in_array($value, $allowed_types)) {\n      $this->context->addViolation($constraint->message, [\n        '@child_type' => $value,\n      ]);\n    }\n  }\n\n  /**\n   * Resolves an expression that selects other typed data in the same root.\n   *\n   * The expression may contain the following special strings:\n   * - '%root', to reference the root of the array.\n   *\n   * Example expressions:\n   * - '%root.allowed_types', indicators the key to check.\n   *\n   * @param string $expression\n   *   Expression to be resolved.\n   * @param \\Drupal\\Core\\TypedData\\TypedDataInterface $data\n   *   Configuration data for the element.\n   *\n   * @return \\Drupal\\Core\\TypedData\\TypedDataInterface\n   *   The selected typed data elsewhere in the same config object.\n   *\n   * @see \\Drupal\\Core\\Config\\Schema\\TypeResolver::resolveExpression()\n   */\n  private static function find(string $expression, TypedDataInterface $data): TypedDataInterface {\n    $parts = explode('.', $expression);\n    // Process each value part, one at a time.\n    while ($name = array_shift($parts)) {\n\n      if ($name === '%root') {\n        $data = $data->getRoot();\n        continue;\n      }\n\n      if (!$data instanceof ArrayElement) {\n        $data = $data->getRoot();\n        if (!$data instanceof ArrayElement) {\n          throw new \\LogicException(sprintf('This is not an array element, so cannot get `%s`.', $name));\n        }\n      }\n\n      $elements = $data->getElements();\n      if (!array_key_exists($name, $elements)) {\n        throw new \\LogicException(sprintf('`%s` does not exist at `%s`.', $name, $data->getPropertyPath()));\n      }\n\n      $data = $elements[$name];\n    }\n\n    return $data;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/Validation/Constraint/ExistsInConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExistsInConstraintValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LayoutBuilderEvents in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder;\n\n/**\n * Defines events for the layout_builder module.\n *\n * @see \\Drupal\\layout_builder\\Event\\SectionComponentBuildRenderArrayEvent\n */\nfinal class LayoutBuilderEvents {\n\n  /**\n   * Name of the event fired when a component's render array is built.\n   *\n   * This event allows modules to collaborate on creating the render array of\n   * the SectionComponent object. The event listener method receives a\n   * \\Drupal\\layout_builder\\Event\\SectionComponentBuildRenderArrayEvent\n   * instance.\n   *\n   * @Event\n   *\n   * @see \\Drupal\\layout_builder\\Event\\SectionComponentBuildRenderArrayEvent\n   * @see \\Drupal\\layout_builder\\SectionComponent::toRenderArray()\n   *\n   * @var string\n   */\n  const SECTION_COMPONENT_BUILD_RENDER_ARRAY = 'section_component.build.render_array';\n\n  /**\n   * Name of the event fired in when preparing a layout builder element.\n   *\n   * This event allows modules to collaborate on creating the sections used in\n   * \\Drupal\\layout_builder\\Element\\LayoutBuilder during #pre_render.\n   *\n   * @see \\Drupal\\layout_builder\\Event\\PrepareLayoutEvent\n   * @see \\Drupal\\layout_builder\\Element\\LayoutBuilder\n   *\n   * @var string\n   */\n  const PREPARE_LAYOUT = 'prepare_layout';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/LayoutBuilderEvents.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderEvents", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class VocabularyTranslation in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\taxonomy\\Plugin\\migrate\\source\\d7;\n\n// cspell:ignore objectid objectindex plid textgroup\n\n/**\n * Drupal 7 i18n vocabulary translations source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d7_taxonomy_vocabulary_translation\",\n *   source_module = \"i18n_taxonomy\"\n * )\n */\nclass VocabularyTranslation extends Vocabulary {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $query = parent::query();\n    $query->leftJoin('i18n_string', 'i18n', 'CAST ([v].[vid] AS CHAR(222)) = [i18n].[objectid]');\n    $query->innerJoin('locales_target', 'lt', '[lt].[lid] = [i18n].[lid]');\n    $query\n      ->condition('type', 'vocabulary')\n      ->fields('lt')\n      ->fields('i18n');\n    $query->addField('lt', 'lid', 'lt_lid');\n\n    if ($this->getDatabase()\n      ->schema()\n      ->fieldExists('taxonomy_vocabulary', 'language')) {\n      $query->addField('v', 'language', 'v_language');\n    }\n    if ($this->getDatabase()\n      ->schema()\n      ->fieldExists('taxonomy_vocabulary', 'i18n_mode')) {\n      $query->addField('v', 'i18n_mode');\n    }\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = [\n      'i18n_mode' => $this->t('Internationalization mode.'),\n      'v_language' => $this->t('Language from the taxonomy_vocabulary table.'),\n      'property' => $this->t('Name of property being translated.'),\n      'type' => $this->t('Name of property being translated.'),\n      'objectid' => $this->t('Name of property being translated.'),\n      'lt_lid' => $this->t('Name of property being translated.'),\n      'translation' => $this->t('Translation of either the name or the description.'),\n      'lid' => $this->t('Language string ID'),\n      'textgroup' => $this->t('A module defined group of translations'),\n      'context' => $this->t('Full string ID for quick search: type:objectid:property.'),\n      'objectindex' => $this->t('Integer value of Object ID'),\n      'format' => $this->t('The {filter_format}.format of the string'),\n      'language' => $this->t('Language code from locales_target table'),\n      'plid' => $this->t('Parent lid'),\n      'plural' => $this->t('Plural index number'),\n      'i18n_status' => $this->t('Translation needs update'),\n    ];\n    return parent::fields() + $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids = [];\n    $ids['language']['type'] = 'string';\n    $ids['language']['alias'] = 'lt';\n    $ids['property']['type'] = 'string';\n    return parent::getIds() + $ids;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/src/Plugin/migrate/source/d7/VocabularyTranslation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "VocabularyTranslation", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CreateUser in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_users\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_users\\Service\\UserService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_create_user',\n  label: new TranslatableMarkup('Create User'),\n  description: new TranslatableMarkup('Create a new user account with optional roles and auto-generated password.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'username' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Username'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'email' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Email'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'password' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Password'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'roles' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Roles'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'status' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Active'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'uid' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('User ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'uuid' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('UUID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'username' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Username'),\n      description: new TranslatableMarkup(''),\n    ),\n    'email' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Email'),\n      description: new TranslatableMarkup(''),\n    ),\n    'status' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'roles' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Roles'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateUser extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'users';\n\n\n  protected UserService $userService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->userService = $container->get('mcp_tools_users.user');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $username = $input['username'] ?? '';\n    $email = $input['email'] ?? '';\n\n    if (empty($username) || empty($email)) {\n      return ['success' => FALSE, 'error' => 'Both username and email are required.'];\n    }\n\n    $options = [];\n    if (isset($input['password'])) {\n      $options['password'] = $input['password'];\n    }\n    if (isset($input['roles'])) {\n      $options['roles'] = $input['roles'];\n    }\n    if (isset($input['status'])) {\n      $options['status'] = (bool) $input['status'];\n    }\n\n    return $this->userService->createUser($username, $email, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_users/src/Plugin/tool/Tool/CreateUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateUser", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SectionComponentBuildRenderArrayEvent.php\nTarget symbol: class SectionComponentBuildRenderArrayEvent\nNamespace: Drupal\\layout_builder\\Event\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SectionComponentBuildRenderArrayEvent.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheableResponseTrait\n  - Drupal\\Core\\Plugin\\PreviewAwarePluginInterface\n  - Drupal\\layout_builder\\SectionComponent\n  - Drupal\\Component\\EventDispatcher\\Event\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getBuild()\n  - getComponent()\n  - getContexts()\n  - getPlugin()\n  - inPreview()\n  - setBuild()", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Event;\n\nuse Drupal\\Core\\Cache\\CacheableResponseTrait;\nuse Drupal\\Core\\Plugin\\PreviewAwarePluginInterface;\nuse Drupal\\layout_builder\\SectionComponent;\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Event fired when a section component's render array is being built.\n *\n * Subscribers to this event should manipulate the cacheability object and the\n * build array in this event.\n *\n * @see \\Drupal\\layout_builder\\LayoutBuilderEvents::SECTION_COMPONENT_BUILD_RENDER_ARRAY\n */\nclass SectionComponentBuildRenderArrayEvent extends Event {\n\n  use CacheableResponseTrait;\n\n  /**\n   * The section component whose render array is being built.\n   *\n   * @var \\Drupal\\layout_builder\\SectionComponent\n   */\n  protected $component;\n\n  /**\n   * The available contexts.\n   *\n   * @var \\Drupal\\Core\\Plugin\\Context\\ContextInterface[]\n   */\n  protected $contexts;\n\n  /**\n   * The plugin for the section component being built.\n   *\n   * @var \\Drupal\\Component\\Plugin\\PluginInspectionInterface\n   */\n  protected $plugin;\n\n  /**\n   * Whether the component is in preview mode or not.\n   *\n   * @var bool\n   */\n  protected $inPreview;\n\n  /**\n   * The render array built by the event subscribers.\n   *\n   * @var array\n   */\n  protected $build = [];\n\n  /**\n   * Creates a new SectionComponentBuildRenderArrayEvent object.\n   *\n   * @param \\Drupal\\layout_builder\\SectionComponent $component\n   *   The section component whose render array is being built.\n   * @param \\Drupal\\Core\\Plugin\\Context\\ContextInterface[] $contexts\n   *   The available contexts.\n   * @param bool $in_preview\n   *   (optional) Whether the component is in preview mode or not.\n   */\n  public function __construct(SectionComponent $component, array $contexts, $in_preview = FALSE) {\n    $this->component = $component;\n    $this->contexts = $contexts;\n    $this->plugin = $component->getPlugin($contexts);\n    $this->inPreview = $in_preview;\n\n    if ($this->plugin instanceof PreviewAwarePluginInterface) {\n      $this->plugin->setInPreview($in_preview);\n    }\n  }\n\n  /**\n   * Get the section component whose render array is being built.\n   *\n   * @return \\Drupal\\layout_builder\\SectionComponent\n   *   The section component whose render array is being built.\n   */\n  public function getComponent() {\n    return $this->component;\n  }\n\n  /**\n   * Get the available contexts.\n   *\n   * @return array|\\Drupal\\Core\\Plugin\\Context\\ContextInterface[]\n   *   The available contexts.\n   */\n  public function getContexts() {\n    return $this->contexts;\n  }\n\n  /**\n   * Get the plugin for the section component being built.\n   *\n   * @return \\Drupal\\Component\\Plugin\\PluginInspectionInterface\n   *   The plugin for the section component being built.\n   */\n  public function getPlugin() {\n    return $this->plugin;\n  }\n\n  /**\n   * Determine if the component is in preview mode.\n   *\n   * @return bool\n   *   Whether the component is in preview mode or not.\n   */\n  public function inPreview() {\n    return $this->inPreview;\n  }\n\n  /**\n   * Get the render array in its current state.\n   *\n   * @return array\n   *   The render array built by the event subscribers.\n   */\n  public function getBuild() {\n    return $this->build;\n  }\n\n  /**\n   * Set the render array.\n   *\n   * @param array $build\n   *   A render array.\n   */\n  public function setBuild(array $build) {\n    $this->build = $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Event/SectionComponentBuildRenderArrayEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SectionComponentBuildRenderArrayEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: BookOutlineConstraintValidator\nSource file: <source_file>\nFile name hint: BookOutlineConstraintValidator.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\book\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\book\\BookHelperTrait;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\book\\BookManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * Constraint validator for changing the book outline in pending revisions.\n */\nclass BookOutlineConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  use BookHelperTrait;\n\n  /**\n   * Creates a new BookOutlineConstraintValidator instance.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $currentUser\n   *   The current user.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   Configuration factory.\n   */\n  public function __construct(\n    protected BookManagerInterface $bookManager,\n    protected AccountProxyInterface $currentUser,\n    protected ConfigFactoryInterface $configFactory,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager'),\n      $container->get('current_user'),\n      $container->get('config.factory'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($value, Constraint $constraint): void {\n    // Validate the book structure when the user has access to manage book\n    // outlines. When the user can manage book outlines, the book variable will\n    // be populated even if the node is not part of the book. If the user cannot\n    // manage book outlines, the book variable will be empty, and we can safely\n    // ignore the constraints as the outline cannot be changed by this user.\n    if (isset($value) && !empty($value->getBook()) && !$value->isNew() && !$value->isDefaultRevision()) {\n      $book = $value->getBook();\n\n      // Skip validation if the node type is not allowed in book outlines\n      // This prevents BookOutlineConstraint from interfering with\n      // Layout Builder operations on content types that aren't book enabled\n      // Get list of allowed content types for books.\n      $allowed_types_config = $this->configFactory->get('book.settings')->get('allowed_types');\n      $allowed_types = $this->getBookContentTypes($allowed_types_config);\n      // Get the node's content type (bundle)\n      $node_type = $value->bundle();\n\n      if (in_array($node_type, $allowed_types)) {\n        /** @var \\Drupal\\Core\\Entity\\ContentEntityInterface $original */\n        $original = $this->bookManager->loadBookLink($value->id(), FALSE) ?: [\n          'bid' => 0,\n          'weight' => 0,\n        ];\n        if (empty($original['pid'])) {\n          $original['pid'] = -1;\n        }\n\n        if ($book['bid'] != $original['bid']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.bid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.bid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n        if ($book['pid'] != $original['pid']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.pid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.pid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n        if ($book['weight'] != $original['weight']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.weight')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }", "output": "<?php\n\nnamespace Drupal\\book\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\book\\BookHelperTrait;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\book\\BookManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * Constraint validator for changing the book outline in pending revisions.\n */\nclass BookOutlineConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  use BookHelperTrait;\n\n  /**\n   * Creates a new BookOutlineConstraintValidator instance.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $currentUser\n   *   The current user.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   Configuration factory.\n   */\n  public function __construct(\n    protected BookManagerInterface $bookManager,\n    protected AccountProxyInterface $currentUser,\n    protected ConfigFactoryInterface $configFactory,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager'),\n      $container->get('current_user'),\n      $container->get('config.factory'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($value, Constraint $constraint): void {\n    // Validate the book structure when the user has access to manage book\n    // outlines. When the user can manage book outlines, the book variable will\n    // be populated even if the node is not part of the book. If the user cannot\n    // manage book outlines, the book variable will be empty, and we can safely\n    // ignore the constraints as the outline cannot be changed by this user.\n    if (isset($value) && !empty($value->getBook()) && !$value->isNew() && !$value->isDefaultRevision()) {\n      $book = $value->getBook();\n\n      // Skip validation if the node type is not allowed in book outlines\n      // This prevents BookOutlineConstraint from interfering with\n      // Layout Builder operations on content types that aren't book enabled\n      // Get list of allowed content types for books.\n      $allowed_types_config = $this->configFactory->get('book.settings')->get('allowed_types');\n      $allowed_types = $this->getBookContentTypes($allowed_types_config);\n      // Get the node's content type (bundle)\n      $node_type = $value->bundle();\n\n      if (in_array($node_type, $allowed_types)) {\n        /** @var \\Drupal\\Core\\Entity\\ContentEntityInterface $original */\n        $original = $this->bookManager->loadBookLink($value->id(), FALSE) ?: [\n          'bid' => 0,\n          'weight' => 0,\n        ];\n        if (empty($original['pid'])) {\n          $original['pid'] = -1;\n        }\n\n        if ($book['bid'] != $original['bid']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.bid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.bid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n        if ($book['pid'] != $original['pid']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.pid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.pid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n        if ($book['weight'] != $original['weight']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.weight')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.weight')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/Validation/Constraint/BookOutlineConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookOutlineConstraintValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class ListWebforms in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_list_webforms',\n  label: new TranslatableMarkup('List Webforms'),\n  description: new TranslatableMarkup('List all webforms with submission counts.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Webforms'),\n      description: new TranslatableMarkup(''),\n    ),\n    'webforms' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Webforms'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListWebforms extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->webformService->listWebforms();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/src/Plugin/tool/Tool/ListWebforms.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListWebforms", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TempStoreException in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TempStore;\n\n/**\n * Thrown by SharedTempStore and PrivateTempStore if they cannot acquire a lock.\n *\n * @see \\Drupal\\Core\\TempStore\\SharedTempStore\n * @see \\Drupal\\Core\\TempStore\\PrivateTempStore\n */\nclass TempStoreException extends \\Exception {}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TempStore/TempStoreException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TempStoreException", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SubformState.php\nTarget symbol: class SubformState\nNamespace: Drupal\\Core\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SubformState.\n- Include required imports:\n  - Drupal\\Component\\Utility\\NestedArray\n- Ensure these methods exist where relevant:\n  - __construct()\n  - createForSubform()\n  - getCompleteFormState()\n  - getFormObject()\n  - getLimitValidationErrors()\n  - getParents()\n  - setErrorByName()\n  - setLimitValidationErrors()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Form;\n\nuse Drupal\\Component\\Utility\\NestedArray;\n\n/**\n * Stores information about the state of a subform.\n */\nclass SubformState extends FormStateDecoratorBase implements SubformStateInterface {\n\n  use FormStateValuesTrait;\n\n  /**\n   * The parent form.\n   *\n   * @var mixed[]\n   */\n  protected $parentForm;\n\n  /**\n   * The subform.\n   *\n   * @var mixed[]\n   */\n  protected $subform;\n\n  /**\n   * Constructs a new instance.\n   *\n   * @param mixed[] $subform\n   *   The subform for which to create a form state.\n   * @param mixed[] $parent_form\n   *   The subform's parent form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $parent_form_state\n   *   The parent form state.\n   * @param \\Drupal\\Core\\Form\\FormInterface|null $subformFormObject\n   *   The subform form object when it's not the same as the parent form.\n   */\n  protected function __construct(array &$subform, array &$parent_form, FormStateInterface $parent_form_state, protected readonly ?FormInterface $subformFormObject = NULL) {\n    $this->decoratedFormState = $parent_form_state;\n    $this->parentForm = $parent_form;\n    $this->subform = $subform;\n  }\n\n  /**\n   * Creates a new instance for a subform.\n   *\n   * @param mixed[] $subform\n   *   The subform for which to create a form state.\n   * @param mixed[] $parent_form\n   *   The subform's parent form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $parent_form_state\n   *   The parent form state.\n   * @param \\Drupal\\Core\\Form\\FormInterface|null $subform_form_object\n   *   The subform form object when it's not the same as the parent form.\n   *\n   * @return static\n   */\n  public static function createForSubform(array &$subform, array &$parent_form, FormStateInterface $parent_form_state, ?FormInterface $subform_form_object = NULL) {\n    return new static($subform, $parent_form, $parent_form_state, $subform_form_object);\n  }\n\n  /**\n   * Gets the subform's parents relative to its parent form.\n   *\n   * @param string $property\n   *   The property name (#parents or #array_parents).\n   *\n   * @return mixed\n   *   The form parents relative to its parent form.\n   *\n   * @throws \\InvalidArgumentException\n   *   Thrown when the requested property does not exist.\n   * @throws \\UnexpectedValueException\n   *   Thrown when the subform is not contained by the given parent form.\n   */\n  protected function getParents($property) {\n    foreach ([$this->subform, $this->parentForm] as $form) {\n      if (!isset($form[$property]) || !is_array($form[$property])) {\n        throw new \\RuntimeException(sprintf('The subform and parent form must contain the %s property, which must be an array. Try calling this method from a #process callback instead.', $property));\n      }\n    }\n\n    $relative_subform_parents = $this->subform[$property];\n    // Remove all of the subform's parents that are also the parent form's\n    // parents, so we are left with the parents relative to the parent form.\n    foreach ($this->parentForm[$property] as $parent_form_parent) {\n      if ($parent_form_parent !== $relative_subform_parents[0]) {\n        // The parent form's parents are the subform's parents as well. If we\n        // find no match, that means the given subform is not contained by the\n        // given parent form.\n        throw new \\UnexpectedValueException('The subform is not contained by the given parent form.');\n      }\n      array_shift($relative_subform_parents);\n    }\n\n    return $relative_subform_parents;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function &getValues() {\n    $exists = NULL;\n    $values = &NestedArray::getValue(parent::getValues(), $this->getParents('#parents'), $exists);\n    if (!$exists) {\n      $values = [];\n    }\n    elseif (!is_array($values)) {\n      throw new \\UnexpectedValueException('The form state values do not belong to the subform.');\n    }\n\n    return $values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCompleteFormState() {\n    return $this->decoratedFormState instanceof SubformStateInterface ? $this->decoratedFormState->getCompleteFormState() : $this->decoratedFormState;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setLimitValidationErrors($limit_validation_errors) {\n    if (is_array($limit_validation_errors)) {\n      $limit_validation_errors = array_merge($this->getParents('#parents'), $limit_validation_errors);\n    }\n\n    return parent::setLimitValidationErrors($limit_validation_errors);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLimitValidationErrors() {\n    $limit_validation_errors = parent::getLimitValidationErrors();\n    if (is_array($limit_validation_errors)) {\n      return array_slice($limit_validation_errors, count($this->getParents('#parents')));\n\n    }\n    return $limit_validation_errors;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setErrorByName($name, $message = '') {\n    $parents = $this->subform['#array_parents'];\n    $parents[] = $name;\n    $name = implode('][', $parents);\n    parent::setErrorByName($name, $message);\n\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormObject() {\n    if ($this->subformFormObject) {\n      return $this->subformFormObject;\n    }\n\n    return parent::getFormObject();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Form/SubformState.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SubformState", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  block_description_modifier.info_value_normalizer:\n    class: Drupal\\block_description_modifier\\Helper\\InfoValueNormalizer\n\n  block_description_modifier.inline_block_config_repository:\n    class: Drupal\\block_description_modifier\\Repository\\InlineBlockConfigRepository\n    arguments: [ '@config.factory' ]\n\n  block_description_modifier.label_provider_manager:\n    class: Drupal\\block_description_modifier\\Provider\\LabelProvider\\LabelProviderManager\n    arguments:\n      - !tagged_iterator block_description_modifier.label_provider\n\n  block_description_modifier.label_applier:\n    class: Drupal\\block_description_modifier\\Service\\InlineBlockLabelApplier\n    arguments:\n      - '@block_description_modifier.inline_block_config_repository'\n      - '@block_description_modifier.label_provider_manager'\n      - '@block_description_modifier.info_value_normalizer'\n      - '@entity_type.manager'\n\n  block_description_modifier.layout_builder_form_alter:\n    class: Drupal\\block_description_modifier\\Service\\LayoutBuilderFormAlter\n    arguments:\n      - '@block_description_modifier.inline_block_config_repository'\n      - '@block_description_modifier.label_applier'\n  block_description_modifier.layout_builder_inline_block_submit_handler:\n    class: Drupal\\block_description_modifier\\Service\\LayoutBuilderInlineBlockSubmitHandler\n    arguments:\n      - '@block_description_modifier.inline_block_config_repository'\n      - '@block_description_modifier.label_provider_manager'\n      - '@block_description_modifier.info_value_normalizer'\n\n\n  block_description_modifier.content_block_info_applier:\n    class: Drupal\\block_description_modifier\\Service\\ContentBlockInfoApplier\n    arguments:\n      - '@block_description_modifier.inline_block_config_repository'\n      - '@block_description_modifier.label_provider_manager'\n      - '@block_description_modifier.info_value_normalizer'\n\n  block_description_modifier.block_content_info_applier:\n    class: Drupal\\block_description_modifier\\Service\\BlockContentInfoApplier\n    arguments:\n      - '@block_description_modifier.inline_block_config_repository'\n      - '@block_description_modifier.content_block_info_applier'\n      - '@block_description_modifier.label_applier'\n\n  block_description_modifier.inline_entity_form_content_info_syncer:\n    class: Drupal\\block_description_modifier\\Service\\InlineEntityFormContentInfoSyncer\n    arguments:\n      - '@block_description_modifier.inline_block_config_repository'\n      - '@block_description_modifier.label_provider_manager'\n      - '@block_description_modifier.info_value_normalizer'\n\n\n  block_description_modifier.label_provider.string:\n    class: Drupal\\block_description_modifier\\Provider\\LabelProvider\\StringLabelProvider\n    tags:\n      - { name: block_description_modifier.label_provider }\n\n  block_description_modifier.label_provider.content_block_label:\n    class: Drupal\\block_description_modifier\\Provider\\LabelProvider\\ContentBlockLabelProvider\n    arguments: [ '@entity_type.manager' ]\n    tags:\n      - { name: block_description_modifier.label_provider }\n\n  block_description_modifier.label_provider.field:\n    class: Drupal\\block_description_modifier\\Provider\\LabelProvider\\FieldLabelProvider\n    arguments: [ '@block_description_modifier.info_value_normalizer' ]\n    tags:\n      - { name: block_description_modifier.label_provider }\n\n  block_description_modifier.text_field_options_provider:\n    class: Drupal\\block_description_modifier\\Provider\\TextFieldOptionsProvider\n    arguments:\n      - '@entity_field.manager'\n", "metadata": {"source": "repos/block_description_modifier/block_description_modifier.services.yml", "type": "yaml_reference", "topic": "block description modifier.services"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: MarkdownOutput.php\nTarget symbol: class MarkdownOutput\nNamespace: Drupal\\document_loader\\DocumentLoaderType\\Output\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for MarkdownOutput.\n- Include required imports:\n  - Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getContent()\n  - getMetadata()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader\\DocumentLoaderType\\Output;\n\nuse Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface;\n\n/**\n * Markdown output for document loader operations.\n */\nclass MarkdownOutput implements DocumentLoaderOutputInterface {\n\n  /**\n   * Constructs a MarkdownOutput instance.\n   *\n   * @param string $content\n   *   The Markdown content.\n   * @param array $metadata\n   *   (optional) Additional metadata about the document.\n   */\n  public function __construct(\n    public readonly string $content,\n    public readonly array $metadata = [],\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getContent(): string {\n    return $this->content;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(): array {\n    return $this->metadata;\n  }\n\n}\n", "metadata": {"source": "repos/document_loader/src/DocumentLoaderType/Output/MarkdownOutput.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MarkdownOutput", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Autoplaying carousels\"\nslots:\n  slides:\n    - type: component\n      component: \"bootstrap_components:carousel_item\"\n      slots:\n        image:\n          theme: image\n          uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAzLjVyZW07IHRleHQtYW5jaG9yOiBtaWRkbGU7IHVzZXItc2VsZWN0OiBub25lIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IEZpcnN0IHNsaWRlIj48dGl0bGU+UGxhY2Vob2xkZXI8L3RpdGxlPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiM3NzciPjwvcmVjdD48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZmlsbD0iIzU1NSIgZHk9Ii4zZW0iPkZpcnN0IHNsaWRlPC90ZXh0Pjwvc3ZnPgo=\"\n    - type: component\n      component: \"bootstrap_components:carousel_item\"\n      slots:\n        image:\n          theme: image\n          uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAzLjVyZW07IHRleHQtYW5jaG9yOiBtaWRkbGU7IHVzZXItc2VsZWN0OiBub25lIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IFNlY29uZCBzbGlkZSI+PHRpdGxlPlBsYWNlaG9sZGVyPC90aXRsZT48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY2Ij48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiM0NDQiIGR5PSIuM2VtIj5TZWNvbmQgc2xpZGU8L3RleHQ+PC9zdmc+Cg==\"\n    - type: component\n      component: \"bootstrap_components:carousel_item\"\n      slots:\n        image:\n          theme: image\n          uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAzLjVyZW07IHRleHQtYW5jaG9yOiBtaWRkbGU7IHVzZXItc2VsZWN0OiBub25lIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IFRoaXJkIHNsaWRlIj48dGl0bGU+UGxhY2Vob2xkZXI8L3RpdGxlPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiM1NTUiPjwvcmVjdD48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZmlsbD0iIzMzMyIgZHk9Ii4zZW0iPlRoaXJkIHNsaWRlPC90ZXh0Pjwvc3ZnPgo=\"\nprops:\n  variant: default\n  with_controls: true\n  with_indicators: false\n  with_touch: true\n  interval: 5000\n  autoplay_mode: carousel\n", "metadata": {"source": "repos/bootstrap_components/components/carousel/stories/carousel.autoplay.story.yml", "type": "yaml_reference", "topic": "carousel.autoplay.story"}}
{"instruction": "Show me the implementation of the class RegisterSerializationClassesCompilerPass in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\DependencyInjection\\Compiler;\n\nuse Drupal\\serialization\\RegisterSerializationClassesCompilerPass as DrupalRegisterSerializationClassesCompilerPass;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * Adds services tagged JSON:API-only normalizers to the Serializer.\n *\n * Services tagged with 'jsonapi_normalizer' will be added to the JSON:API\n * serializer. No extensions can provide such services.\n *\n * JSON:API does respect generic (non-JSON:API) DataType-level normalizers.\n *\n * @internal JSON:API maintains no PHP API. The API is the HTTP API. This class\n *   may change at any time and could break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nclass RegisterSerializationClassesCompilerPass extends DrupalRegisterSerializationClassesCompilerPass {\n\n  /**\n   * The service ID.\n   *\n   * @const string\n   */\n  const OVERRIDDEN_SERVICE_ID = 'jsonapi.serializer';\n\n  /**\n   * The service tag that only JSON:API normalizers should use.\n   *\n   * @const string\n   */\n  const OVERRIDDEN_SERVICE_NORMALIZER_TAG = 'jsonapi_normalizer';\n\n  /**\n   * The service tag that only JSON:API encoders should use.\n   *\n   * @const string\n   */\n  const OVERRIDDEN_SERVICE_ENCODER_TAG = 'jsonapi_encoder';\n\n  /**\n   * The ID for the JSON:API format.\n   *\n   * @const string\n   */\n  const FORMAT = 'api_json';\n\n  /**\n   * Adds services to the JSON:API Serializer.\n   *\n   * This code is copied from the class parent with two modifications. The\n   * service id has been changed and the service tag has been updated.\n   *\n   * ID: 'serializer' -> 'jsonapi.serializer'\n   * Tag: 'normalizer' -> 'jsonapi_normalizer'\n   *\n   * @param \\Symfony\\Component\\DependencyInjection\\ContainerBuilder $container\n   *   The container to process.\n   */\n  public function process(ContainerBuilder $container): void {\n    $definition = $container->getDefinition(static::OVERRIDDEN_SERVICE_ID);\n\n    // Retrieve registered Normalizers and Encoders from the container.\n    foreach ($container->findTaggedServiceIds(static::OVERRIDDEN_SERVICE_NORMALIZER_TAG) as $id => $attributes) {\n      // Normalizers are not an API: mark private.\n      $container->getDefinition($id)->setPublic(FALSE);\n\n      $priority = $attributes[0]['priority'] ?? 0;\n      $normalizers[$priority][] = new Reference($id);\n    }\n    foreach ($container->findTaggedServiceIds(static::OVERRIDDEN_SERVICE_ENCODER_TAG) as $id => $attributes) {\n      // Encoders are not an API: mark private.\n      $container->getDefinition($id)->setPublic(FALSE);\n\n      $priority = $attributes[0]['priority'] ?? 0;\n      $encoders[$priority][] = new Reference($id);\n    }\n\n    // Add the registered Normalizers and Encoders to the Serializer.\n    if (!empty($normalizers)) {\n      $definition->replaceArgument(0, $this->sort($normalizers));\n    }\n    if (!empty($encoders)) {\n      $definition->replaceArgument(1, $this->sort($encoders));\n    }\n\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/DependencyInjection/Compiler/RegisterSerializationClassesCompilerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegisterSerializationClassesCompilerPass", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface OutputInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\DTO;\n\n/**\n * Interface for output data transfer objects.\n *\n * This interface provides specialized methods for handling output data\n * in the FlowDrop system, including status management and metadata handling.\n */\ninterface OutputInterface extends DataInterface {\n\n  /**\n   * Set output data with validation.\n   *\n   * @param string $key\n   *   The output key.\n   * @param mixed $value\n   *   The output value.\n   * @param callable|null $validator\n   *   Optional validation function.\n   *\n   * @return static\n   *   The output object for method chaining.\n   *\n   * @throws \\InvalidArgumentException\n   *   When validation fails.\n   */\n  public function setOutput(string $key, mixed $value, ?callable $validator = NULL): static;\n\n  /**\n   * Add metadata to the output.\n   *\n   * @param string $key\n   *   The metadata key.\n   * @param mixed $value\n   *   The metadata value.\n   *\n   * @return static\n   *   The output object for method chaining.\n   */\n  public function addMetadata(string $key, mixed $value): static;\n\n  /**\n   * Get metadata from the output.\n   *\n   * @param string $key\n   *   The metadata key.\n   * @param mixed $default\n   *   The default value.\n   *\n   * @return mixed\n   *   The metadata value.\n   */\n  public function getMetadata(string $key, mixed $default = NULL): mixed;\n\n  /**\n   * Set execution status.\n   *\n   * @param string $status\n   *   The execution status (success, error, warning, etc.).\n   * @param string|null $message\n   *   Optional status message.\n   *\n   * @return static\n   *   The output object for method chaining.\n   */\n  public function setStatus(string $status, ?string $message = NULL): static;\n\n  /**\n   * Get execution status.\n   *\n   * @return string\n   *   The execution status.\n   */\n  public function getStatus(): string;\n\n  /**\n   * Check if the output indicates success.\n   *\n   * @return bool\n   *   TRUE if the output indicates success.\n   */\n  public function isSuccess(): bool;\n\n  /**\n   * Check if the output indicates an error.\n   *\n   * @return bool\n   *   TRUE if the output indicates an error.\n   */\n  public function isError(): bool;\n\n  /**\n   * Set error information.\n   *\n   * @param string $message\n   *   The error message.\n   * @param string|null $code\n   *   Optional error code.\n   *\n   * @return static\n   *   The output object for method chaining.\n   */\n  public function setError(string $message, ?string $code = NULL): static;\n\n  /**\n   * Get error message.\n   *\n   * @return string|null\n   *   The error message or NULL if no error.\n   */\n  public function getErrorMessage(): ?string;\n\n  /**\n   * Get error code.\n   *\n   * @return string|null\n   *   The error code or NULL if no error.\n   */\n  public function getErrorCode(): ?string;\n\n  /**\n   * Set success information.\n   *\n   * @param string|null $message\n   *   Optional success message.\n   *\n   * @return static\n   *   The output object for method chaining.\n   */\n  public function setSuccess(?string $message = NULL): static;\n\n  /**\n   * Get success message.\n   *\n   * @return string|null\n   *   The success message or NULL if no message.\n   */\n  public function getSuccessMessage(): ?string;\n\n  /**\n   * Add execution timing information.\n   *\n   * @param float $execution_time\n   *   The execution time in seconds.\n   *\n   * @return static\n   *   The output object for method chaining.\n   */\n  public function addExecutionTime(float $execution_time): static;\n\n  /**\n   * Get execution time.\n   *\n   * @return float|null\n   *   The execution time in seconds or NULL if not set.\n   */\n  public function getExecutionTime(): ?float;\n\n  /**\n   * Get all output data as an associative array.\n   *\n   * @return array\n   *   All output data as an array.\n   */\n  public function getAllOutput(): array;\n\n  /**\n   * Check if output has any data.\n   *\n   * @return bool\n   *   TRUE if output has data.\n   */\n  public function hasOutputData(): bool;\n\n  /**\n   * Get output count.\n   *\n   * @return int\n   *   Number of output fields.\n   */\n  public function getOutputCount(): int;\n\n  /**\n   * Merge output with another output object.\n   *\n   * @param \\Drupal\\flowdrop\\DTO\\OutputInterface $other\n   *   The other output object.\n   *\n   * @return static\n   *   The merged output object.\n   */\n  public function mergeOutput(OutputInterface $other): static;\n\n}\n", "metadata": {"source": "repos/flowdrop/src/DTO/OutputInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "OutputInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation to display queue size.\n */\n#}\n<div class=\"qm-queue-size\" {{ attributes }}>\n{% if title %}\n  <div class=\"qm-queue-size__title\">{{ title }}</div>\n{% endif %}\n  <div class=\"qm-queue-size__size\" data-qm-queue-name=\"{{ queue_name }}\" {% if refresh %} data-qm-queue-size-refresh=\"{{ refresh }}\"{% endif %}>{{ size }}</div>\n</div>\n", "metadata": {"source": "repos/queue_manager/templates/queue-size.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the enum AnonymousContact in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\comment;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Utility\\OptionsEnumTrait;\n\n/**\n * Defines the anonymous contact options for comments.\n */\nenum AnonymousContact: int {\n\n  use OptionsEnumTrait;\n\n  // Anonymous posters cannot enter their contact information.\n  case Forbidden = 0;\n\n  // Anonymous posters may leave their contact information.\n  case Allowed = 1;\n\n  // Anonymous posters are required to leave their contact information.\n  case Required = 2;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function label(): string|\\Stringable {\n    return match ($this) {\n      self::Forbidden => new TranslatableMarkup('Anonymous posters may not enter their contact information'),\n      self::Allowed => new TranslatableMarkup('Anonymous posters may leave their contact information'),\n      self::Required => new TranslatableMarkup('Anonymous posters must leave their contact information'),\n    };\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/AnonymousContact.php", "type": "code_reference", "symbol_kind": "enum", "symbol_name": "AnonymousContact", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ContentTranslationManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\content_translation;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\n\n/**\n * Provides an interface for common functionality for content translation.\n */\ninterface ContentTranslationManagerInterface {\n\n  /**\n   * Gets the entity types that support content translation.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityTypeInterface[]\n   *   An array of entity types that support content translation.\n   */\n  public function getSupportedEntityTypes();\n\n  /**\n   * Checks whether an entity type supports translation.\n   *\n   * @param string $entity_type_id\n   *   The entity type.\n   *\n   * @return bool\n   *   TRUE if an entity type is supported, FALSE otherwise.\n   */\n  public function isSupported($entity_type_id);\n\n  /**\n   * Returns an instance of the Content translation handler.\n   *\n   * @param string $entity_type_id\n   *   The type of the entity being translated.\n   *\n   * @return \\Drupal\\content_translation\\ContentTranslationHandlerInterface\n   *   An instance of the content translation handler.\n   */\n  public function getTranslationHandler($entity_type_id);\n\n  /**\n   * Returns an instance of the Content translation metadata.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $translation\n   *   The entity translation whose metadata needs to be retrieved.\n   *\n   * @return \\Drupal\\content_translation\\ContentTranslationMetadataWrapperInterface\n   *   An instance of the content translation metadata.\n   */\n  public function getTranslationMetadata(EntityInterface $translation);\n\n  /**\n   * Sets the value for translatability of the given entity type bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type.\n   * @param string $bundle\n   *   The bundle of the entity.\n   * @param bool $value\n   *   The boolean value we need to save.\n   */\n  public function setEnabled($entity_type_id, $bundle, $value);\n\n  /**\n   * Determines whether the given entity type is translatable.\n   *\n   * @param string $entity_type_id\n   *   The type of the entity.\n   * @param string $bundle\n   *   (optional) The bundle of the entity. If no bundle is provided, all the\n   *   available bundles are checked.\n   *\n   * @return bool\n   *   TRUE if the specified bundle is translatable. If no bundle is provided\n   *   returns TRUE if at least one of the entity bundles is translatable.\n   */\n  public function isEnabled($entity_type_id, $bundle = NULL);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/src/ContentTranslationManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ContentTranslationManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Range in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Generates a numeric sequence for use with ForEach loops.\n */\n#[FlowDropNodeProcessor(\n  id: \"range\",\n  label: new TranslatableMarkup(\"Range\"),\n  description: \"Generate a numeric sequence (e.g., 1 to 10)\",\n  version: \"1.0.0\"\n)]\nclass Range extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    if (!isset($params['end'])) {\n      return ValidationResult::error('end', 'End value is required', 'MISSING_END');\n    }\n    $step = $params['step'] ?? 1;\n    if ($step === 0) {\n      return ValidationResult::error('step', 'Step cannot be zero', 'INVALID_STEP');\n    }\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    $start = $params->getInt('start', 1);\n    $end = $params->getInt('end', 1);\n    $step = $params->getInt('step', 1);\n\n    // Auto-correct step direction if needed.\n    if (($start > $end && $step > 0) || ($start < $end && $step < 0)) {\n      $step = -$step;\n    }\n\n    $items = range($start, $end, abs($step));\n\n    return [\n      'items' => $items,\n      'count' => count($items),\n      'start' => $start,\n      'end' => $end,\n      'step' => $step,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      'type' => 'object',\n      'properties' => [\n        'start' => [\n          'type' => 'integer',\n          'title' => 'Start',\n          'description' => 'Starting value of the sequence',\n          'default' => 1,\n        ],\n        'end' => [\n          'type' => 'integer',\n          'title' => 'End',\n          'description' => 'Ending value of the sequence (inclusive)',\n        ],\n        'step' => [\n          'type' => 'integer',\n          'title' => 'Step',\n          'description' => 'Increment between values',\n          'default' => 1,\n        ],\n      ],\n      'required' => ['end'],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      'type' => 'object',\n      'properties' => [\n        'items' => [\n          'type' => 'array',\n          'description' => 'The generated numeric sequence',\n        ],\n        'count' => [\n          'type' => 'integer',\n          'description' => 'Number of items in the sequence',\n        ],\n        'start' => [\n          'type' => 'integer',\n          'description' => 'Start value used',\n        ],\n        'end' => [\n          'type' => 'integer',\n          'description' => 'End value used',\n        ],\n        'step' => [\n          'type' => 'integer',\n          'description' => 'Step value used',\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/Range.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Range", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ElementInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\n\n/**\n * Provides an interface for render element plugins.\n *\n * Render element plugins allow modules to declare their own Render API element\n * types and specify the default values for the properties. The values returned\n * by the getInfo() method of the element plugin will be merged with the\n * properties specified in render arrays. Thus, you can specify defaults for any\n * Render API keys, in addition to those explicitly documented by\n * \\Drupal\\Core\\Render\\ElementInfoManagerInterface::getInfo().\n *\n * Some render elements are specifically form input elements; see\n * \\Drupal\\Core\\Render\\Element\\FormElementInterface for more information.\n *\n * The public API of these objects must be designed with security in mind as\n * render elements process raw user input.\n *\n * @see \\Drupal\\Core\\Render\\ElementInfoManager\n * @see \\Drupal\\Core\\Render\\Attribute\\RenderElement\n * @see \\Drupal\\Core\\Render\\Element\\RenderElementBase\n * @see plugin_api\n *\n * @ingroup theme_render\n */\ninterface ElementInterface extends PluginInspectionInterface, RenderCallbackInterface {\n\n  /**\n   * Returns the element properties for this element.\n   *\n   * @return array\n   *   An array of element properties. See\n   *   \\Drupal\\Core\\Render\\ElementInfoManagerInterface::getInfo() for\n   *   documentation of the standard properties of all elements, and the\n   *   return value format.\n   */\n  public function getInfo();\n\n  /**\n   * Sets a form element's class attribute.\n   *\n   * Adds 'required' and 'error' classes as needed.\n   *\n   * @param array $element\n   *   The form element.\n   * @param array $class\n   *   Array of new class names to be added.\n   */\n  public static function setAttributes(&$element, $class = []);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/ElementInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ElementInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LocaleRequirements.php\nTarget symbol: class LocaleRequirements\nNamespace: Drupal\\locale\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LocaleRequirements.\n- Include required imports:\n  - Drupal\\Core\\Extension\\Requirement\\RequirementSeverity\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n  - Drupal\\Core\\Link\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\Url\n- Ensure these methods exist where relevant:\n  - runtime()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\locale\\Hook;\n\nuse Drupal\\Core\\Extension\\Requirement\\RequirementSeverity;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Link;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\n\n/**\n * Requirements for the Locale module.\n */\nclass LocaleRequirements {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_runtime_requirements().\n   */\n  #[Hook('runtime_requirements')]\n  public function runtime(): array {\n    $requirements = [];\n    $available_updates = [];\n    $untranslated = [];\n    $languages = locale_translatable_language_list();\n\n    if ($languages) {\n      // Determine the status of the translation updates per language.\n      $status = locale_translation_get_status();\n      if ($status) {\n        foreach ($status as $project) {\n          foreach ($project as $langcode => $project_info) {\n            if (empty($project_info->type)) {\n              $untranslated[$langcode] = $languages[$langcode]->getName();\n            }\n            elseif ($project_info->type == LOCALE_TRANSLATION_LOCAL || $project_info->type == LOCALE_TRANSLATION_REMOTE) {\n              $available_updates[$langcode] = $languages[$langcode]->getName();\n            }\n          }\n        }\n\n        if ($available_updates || $untranslated) {\n          if ($available_updates) {\n            $requirements['locale_translation'] = [\n              'title' => $this->t('Translation update status'),\n              'value' => Link::fromTextAndUrl($this->t('Updates available'), Url::fromRoute('locale.translate_status'))->toString(),\n              'severity' => RequirementSeverity::Warning,\n              'description' => $this->t('Updates available for: @languages. See the <a href=\":updates\">Available translation updates</a> page for more information.', [\n                '@languages' => implode(', ', $available_updates),\n                ':updates' => Url::fromRoute('locale.translate_status')->toString(),\n              ]),\n            ];\n          }\n          else {\n            $requirements['locale_translation'] = [\n              'title' => $this->t('Translation update status'),\n              'value' => $this->t('Missing translations'),\n              'severity' => RequirementSeverity::Info,\n              'description' => $this->t('Missing translations for: @languages. See the <a href=\":updates\">Available translation updates</a> page for more information.', [\n                '@languages' => implode(', ', $untranslated),\n                ':updates' => Url::fromRoute('locale.translate_status')->toString(),\n              ]),\n            ];\n          }\n        }\n        else {\n          $requirements['locale_translation'] = [\n            'title' => $this->t('Translation update status'),\n            'value' => $this->t('Up to date'),\n            'severity' => RequirementSeverity::OK,\n          ];\n        }\n      }\n      else {\n        $requirements['locale_translation'] = [\n          'title' => $this->t('Translation update status'),\n          'value' => Link::fromTextAndUrl($this->t('Can not determine status'), Url::fromRoute('locale.translate_status'))->toString(),\n          'severity' => RequirementSeverity::Warning,\n          'description' => $this->t('No translation status is available. See the <a href=\":updates\">Available translation updates</a> page for more information.', [':updates' => Url::fromRoute('locale.translate_status')->toString()]),\n        ];\n      }\n    }\n    return $requirements;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/src/Hook/LocaleRequirements.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LocaleRequirements", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class ProtectionRule in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a Protection Rule plugin annotation object.\n *\n * Plugin Namespace: Plugin\\ProtectionRule.\n *\n * @see \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginManager\n * @see plugin_api\n *\n * @Annotation\n */\nclass ProtectionRule extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public string $id;\n\n  /**\n   * The human-readable name of the plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * The description of the plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $description;\n\n  /**\n   * The category of the plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $category;\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Annotation/ProtectionRule.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProtectionRule", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "content_moderation.workflows:\n  deriver: 'Drupal\\content_moderation\\Plugin\\Derivative\\DynamicLocalTasks'\n  weight: 100\n\ncontent_moderation.content:\n  title: 'Overview'\n  route_name: system.admin_content\n  parent_id: system.admin_content\n", "metadata": {"source": "repos/drupal_core/core/modules/content_moderation/content_moderation.links.task.yml", "type": "yaml_reference", "topic": "content moderation.links.task"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  _defaults:\n    autowire: true\n\n  Drupal\\easy_encryption\\Encryption\\EncryptorInterface:\n    class: Drupal\\easy_encryption\\Encryption\\SodiumSealedBoxEncryptor\n\n  logger.channel.easy_encryption:\n    class: Drupal\\Core\\Logger\\LoggerChannel\n    factory: ['@logger.factory', 'get']\n    arguments: ['easy_encryption']\n\n  Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface:\n    class: Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryUsingKeyEntities\n    arguments:\n      $appRoot: '%app.root%'\n      $logger: '@logger.channel.easy_encryption'\n    tags:\n      - { name: 'easy_encryption.key_activation_observer' }\n      - { name: 'easy_encryption.key_deletion_observer' }\n\n  Drupal\\easy_encryption\\Internal\\EasyEncryptionUninstallValidator:\n    arguments:\n      $keyRepository: '@key.repository'\n    tags:\n      - { name: module_install.uninstall_validator }\n\n  Drupal\\easy_encryption\\KeyManagement\\KeyGeneratorInterface:\n    class: Drupal\\easy_encryption\\KeyManagement\\KeyGenerator\n    arguments:\n      $logger: '@logger.channel.easy_encryption'\n\n  Drupal\\easy_encryption\\KeyManagement\\KeyActivatorInterface:\n    class: Drupal\\easy_encryption\\KeyManagement\\KeyActivator\n    arguments:\n      $logger: '@logger.channel.easy_encryption'\n      $observers: !tagged_iterator 'easy_encryption.key_activation_observer'\n\n  Drupal\\easy_encryption\\KeyManagement\\KeyRotatorInterface:\n    class: Drupal\\easy_encryption\\KeyManagement\\KeyRotator\n    arguments:\n      $keyRepository: '@key.repository'\n      $logger: '@logger.channel.easy_encryption'\n\n  Drupal\\easy_encryption\\KeyManagement\\KeyPrunerInterface:\n    class: Drupal\\easy_encryption\\KeyManagement\\KeyPruner\n    arguments:\n      $logger: '@logger.channel.easy_encryption'\n      $observers: !tagged_iterator 'easy_encryption.key_deletion_observer'\n\n  Drupal\\easy_encryption\\KeyManagement\\KeyUsageTrackerInterface:\n    class: Drupal\\easy_encryption\\KeyManagement\\KeyUsageTracker\n    arguments:\n      $keyRepository: '@key.repository'\n\n  Drupal\\easy_encryption\\KeyManagement\\Adapter\\ConfigKeyRegistry:\n    class: Drupal\\easy_encryption\\KeyManagement\\Adapter\\ConfigKeyRegistry\n    private: true\n\n  Drupal\\easy_encryption\\KeyManagement\\Port\\KeyRegistryInterface: '@Drupal\\easy_encryption\\KeyManagement\\Adapter\\ConfigKeyRegistry'\n  Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface: '@Drupal\\easy_encryption\\KeyManagement\\Adapter\\ConfigKeyRegistry'\n", "metadata": {"source": "repos/easy_encryption/easy_encryption.services.yml", "type": "yaml_reference", "topic": "easy encryption.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Custom Menu Links'\ntype: module\ndescription: 'Allows users to create menu links.'\npackage: Core\nversion: VERSION\ndependencies:\n  - drupal:link\n", "metadata": {"source": "repos/drupal_core/core/modules/menu_link_content/menu_link_content.info.yml", "type": "yaml_reference", "topic": "menu link content.info"}}
{"instruction": "Show me the implementation of the class UserLogout in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Event type for user logout events.\n *\n * Triggers when a user logs out of the site.\n * This event fires after the session is destroyed.\n */\n#[FlowDropEventType(\n  id: \"user.logout\",\n  label: new TranslatableMarkup(\"User Logout\"),\n  description: new TranslatableMarkup(\"Triggered when a user logs out\"),\n  category: \"user\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [\"user\"],\n)]\nclass UserLogout extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    return \"user\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for user logout events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add user-specific data.\n    $data[\"operation\"] = \"logout\";\n\n    if ($entity instanceof UserInterface) {\n      $data[\"username\"] = $entity->getAccountName();\n      $data[\"email\"] = $entity->getEmail();\n      $data[\"roles\"] = $entity->getRoles();\n    }\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"roles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"User Roles\",\n          \"description\" => \"Only trigger for users with these roles (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/UserLogout.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserLogout", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ReindexIndex in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_search_api\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_search_api\\Service\\SearchApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_search_api_reindex',\n  label: new TranslatableMarkup('Reindex Search Index'),\n  description: new TranslatableMarkup('Mark all items in a search index for reindexing.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Index ID'),\n      description: new TranslatableMarkup('The machine name of the search index to reindex.'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result message'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_items' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total items to reindex'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ReindexIndex extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'search_api';\n\n\n  protected SearchApiService $searchApiService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->searchApiService = $container->get('mcp_tools_search_api.search_api_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access.\n    $accessCheck = $this->accessManager->checkWriteAccess('reindex', 'search_api_index');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $id = $input['id'] ?? '';\n    if (empty($id)) {\n      return [\n        'success' => FALSE,\n        'error' => 'id is required.',\n        'code' => 'VALIDATION_ERROR',\n      ];\n    }\n\n    $result = $this->searchApiService->reindexIndex($id);\n\n    if ($result['success']) {\n      $this->auditLogger->log('reindex', 'search_api_index', $id, [\n        'total_items' => $result['total_items'] ?? 0,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_search_api/src/Plugin/tool/Tool/ReindexIndex.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ReindexIndex", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DatetimeRangeHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime_range\\Hook;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for datetime_range.\n */\nclass DatetimeRangeHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.datetime_range':\n        $output = '';\n        $output .= '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The Datetime Range module provides a Date field that stores start dates and times, as well as end dates and times. See the <a href=\":field\">Field module help</a> and the <a href=\":field_ui\">Field UI module help</a> pages for general information on fields and how to create and manage them. For more information, see the <a href=\":datetime_do\">online documentation for the Datetime Range module</a>.', [\n          ':field' => Url::fromRoute('help.page', [\n            'name' => 'field',\n          ])->toString(),\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n          ':datetime_do' => 'https://www.drupal.org/documentation/modules/datetime_range',\n        ]) . '</p>';\n        $output .= '<h2>' . $this->t('Uses') . '</h2>';\n        $output .= '<dl>';\n        $output .= '<dt>' . $this->t('Managing and displaying date fields') . '</dt>';\n        $output .= '<dd>' . $this->t('The <em>settings</em> and the <em>display</em> of the Date field can be configured separately. See the <a href=\":field_ui\">Field UI help</a> for more information on how to manage fields and their display.', [\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n        ]) . '</dd>';\n        $output .= '<dt>' . $this->t('Displaying dates') . '</dt>';\n        $output .= '<dd>' . $this->t('Dates can be displayed using the <em>Plain</em> or the <em>Default</em> formatter. The <em>Plain</em> formatter displays the date in the <a href=\"http://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format. If you choose the <em>Default</em> formatter, you can choose a format from a predefined list that can be managed on the <a href=\":date_format_list\">Date and time formats</a> page.', [\n          ':date_format_list' => Url::fromRoute('entity.date_format.collection')->toString(),\n        ]) . '</dd>';\n        $output .= '</dl>';\n        return $output;\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime_range/src/Hook/DatetimeRangeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatetimeRangeHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LoggerChannel.php\nTarget symbol: class LoggerChannel\nNamespace: Drupal\\Core\\Logger\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LoggerChannel.\n- Include required imports:\n  - Drupal\\Core\\Session\\AccountInterface\n  - Psr\\Log\\LoggerInterface\n  - Psr\\Log\\LoggerTrait\n  - Psr\\Log\\LogLevel\n  - Symfony\\Component\\HttpFoundation\\RequestStack\n- Ensure these methods exist where relevant:\n  - __construct()\n  - addLogger()\n  - log()\n  - setCurrentUser()\n  - setLoggers()\n  - setRequestStack()\n  - sortLoggers()", "output": "<?php\n\nnamespace Drupal\\Core\\Logger;\n\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Psr\\Log\\LoggerInterface;\nuse Psr\\Log\\LoggerTrait;\nuse Psr\\Log\\LogLevel;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * Defines a logger channel that most implementations will use.\n */\nclass LoggerChannel implements LoggerChannelInterface {\n  use LoggerTrait;\n\n  /**\n   * Maximum call depth to self::log() for a single log message.\n   *\n   * It's very easy for logging channel code to call out to other library code\n   * that will create log messages. In that case, we will recurse back in to\n   * LoggerChannel::log() multiple times while processing a single originating\n   * message. To prevent infinite recursion, we track the call depth and bail\n   * out at LoggerChannel::MAX_CALL_DEPTH iterations.\n   *\n   * @var int\n   */\n  const MAX_CALL_DEPTH = 5;\n\n  /**\n   * Number of times LoggerChannel::log() has been called for a single message.\n   *\n   * @var int\n   */\n  protected $callDepth = 0;\n\n  /**\n   * The name of the channel of this logger instance.\n   *\n   * @var string\n   */\n  protected $channel;\n\n  /**\n   * Map of PSR3 log constants to RFC 5424 log constants.\n   *\n   * @var array\n   */\n  protected $levelTranslation = [\n    LogLevel::EMERGENCY => RfcLogLevel::EMERGENCY,\n    LogLevel::ALERT => RfcLogLevel::ALERT,\n    LogLevel::CRITICAL => RfcLogLevel::CRITICAL,\n    LogLevel::ERROR => RfcLogLevel::ERROR,\n    LogLevel::WARNING => RfcLogLevel::WARNING,\n    LogLevel::NOTICE => RfcLogLevel::NOTICE,\n    LogLevel::INFO => RfcLogLevel::INFO,\n    LogLevel::DEBUG => RfcLogLevel::DEBUG,\n  ];\n\n  /**\n   * An array of arrays of \\Psr\\Log\\LoggerInterface keyed by priority.\n   *\n   * @var array\n   */\n  protected $loggers = [];\n\n  /**\n   * The request stack object.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   */\n  protected $requestStack;\n\n  /**\n   * The current user object.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $currentUser;\n\n  /**\n   * Constructs a LoggerChannel object.\n   *\n   * @param string $channel\n   *   The channel name for this instance.\n   */\n  public function __construct($channel) {\n    $this->channel = $channel;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function log($level, string|\\Stringable $message, array $context = []): void {\n    if ($this->callDepth == self::MAX_CALL_DEPTH) {\n      return;\n    }\n    $this->callDepth++;\n\n    // Merge in defaults.\n    $context += [\n      'channel' => $this->channel,\n      'link' => '',\n      'uid' => 0,\n      'request_uri' => '',\n      'referer' => '',\n      'ip' => '',\n      'timestamp' => time(),\n    ];\n    // Some context values are only available when in a request context.\n    if ($this->requestStack && $request = $this->requestStack->getCurrentRequest()) {\n      $context['request_uri'] = $request->getUri();\n      $context['referer'] = $request->headers->get('Referer', '');\n      $context['ip'] = $request->getClientIP() ?: '';\n\n      if ($this->currentUser) {\n        $context['uid'] = $this->currentUser->id();\n      }\n    }\n\n    if (is_string($level)) {\n      // Convert to integer equivalent for consistency with RFC 5424.\n      $level = $this->levelTranslation[$level];\n    }\n    // Call all available loggers.\n    foreach ($this->sortLoggers() as $logger) {\n      $logger->log($level, $message, $context);\n    }\n\n    $this->callDepth--;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setRequestStack(?RequestStack $requestStack = NULL) {\n    $this->requestStack = $requestStack;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setCurrentUser(?AccountInterface $current_user = NULL) {\n    $this->currentUser = $current_user;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setLoggers(array $loggers) {\n    $this->loggers = $loggers;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addLogger(LoggerInterface $logger, $priority = 0) {\n    $this->loggers[$priority][] = $logger;\n  }\n\n  /**\n   * Sorts loggers according to priority.\n   *\n   * @return array\n   *   An array of sorted loggers by priority.\n   */\n  protected function sortLoggers() {\n    krsort($this->loggers);\n    return array_merge(...$this->loggers);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Logger/LoggerChannel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LoggerChannel", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface IconDefinitionInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Theme\\Icon;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Interface for icon definition.\n *\n * @internal\n *   This API is experimental.\n */\ninterface IconDefinitionInterface {\n\n  /**\n   * Create an icon definition.\n   *\n   * @param string $pack_id\n   *   The id of the icon pack.\n   * @param string $icon_id\n   *   The id of the icon.\n   * @param string $template\n   *   The icon template from definition.\n   * @param string|null $source\n   *   The source, url or path of the icon.\n   * @param string|null $group\n   *   The group of the icon.\n   * @param array $data\n   *   The additional data of the icon. Used by extractors to dynamically add\n   *   any needed value.\n   *\n   * @return self\n   *   The icon definition.\n   */\n  public static function create(\n    string $pack_id,\n    string $icon_id,\n    string $template,\n    ?string $source = NULL,\n    ?string $group = NULL,\n    array $data = [],\n  ): self;\n\n  /**\n   * Create an icon full id.\n   *\n   * @param string $pack_id\n   *   The id of the icon pack.\n   * @param string $icon_id\n   *   The id of the icon.\n   *\n   * @return string\n   *   The icon full id.\n   */\n  public static function createIconId(string $pack_id, string $icon_id): string;\n\n  /**\n   * Get icon id and pack id from an icon full id.\n   *\n   * @param string $icon_full_id\n   *   The id of the icon including the pack.\n   *\n   * @return array|null\n   *   The icon data as keyed with `pack_id` and `icon_id`.\n   */\n  public static function getIconDataFromId(string $icon_full_id): ?array;\n\n  /**\n   * Get the icon renderable element array.\n   *\n   * Shortcut to use icon element quickly without check if the icon id is valid,\n   * then the element will simply be empty.\n   *\n   * @param string $icon_full_id\n   *   The id of the icon including the pack.\n   * @param array $settings\n   *   Settings to pass to the renderable for context. Can be indexed by the\n   *   icon pack id for lookup.\n   *\n   * @return array|null\n   *   The icon renderable.\n   */\n  public static function getRenderable(string $icon_full_id, array $settings = []): ?array;\n\n  /**\n   * Get the icon label as human friendly.\n   *\n   * @return string\n   *   The icon label.\n   */\n  public function getLabel(): string;\n\n  /**\n   * Get the full icon id.\n   *\n   * @return string\n   *   The icon id as pack_id:icon_id.\n   */\n  public function getId(): string;\n\n  /**\n   * Get the icon id.\n   *\n   * @return string\n   *   The icon id as icon_id.\n   */\n  public function getIconId(): string;\n\n  /**\n   * Get the icon Pack id.\n   *\n   * @return string\n   *   The icon Pack id.\n   */\n  public function getPackId(): string;\n\n  /**\n   * Get the icon source, path or url.\n   *\n   * @return string|null\n   *   The icon source.\n   */\n  public function getSource(): ?string;\n\n  /**\n   * Get the icon Group.\n   *\n   * @return string|null\n   *   The icon Group.\n   */\n  public function getGroup(): ?string;\n\n  /**\n   * Get the icon Twig template.\n   *\n   * @return string\n   *   The icon template.\n   */\n  public function getTemplate(): string;\n\n  /**\n   * Get the icon pack label.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null\n   *   The icon pack label.\n   */\n  public function getPackLabel(): ?TranslatableMarkup;\n\n  /**\n   * Get the icon Twig library.\n   *\n   * @return string|null\n   *   The icon library.\n   */\n  public function getLibrary(): ?string;\n\n  /**\n   * Get all icon data.\n   *\n   * Icon data is injected by extractors and can be used to set any values\n   * needed for the extractor loadIcon() method.\n   * The data is then injected in the Twig template of the icon.\n   *\n   * @return array\n   *   All the icon data.\n   */\n  public function getAllData(): array;\n\n  /**\n   * Get a specific icon data.\n   *\n   * @param string $key\n   *   The data key to retrieve.\n   *\n   * @return mixed\n   *   The icon specific data if exist or null. The data being added as an array\n   *   by extractors, there is no specific type enforced.\n   */\n  public function getData(string $key): mixed;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/Icon/IconDefinitionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "IconDefinitionInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class AgentApiToolBase in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Plugin\\AgentApiTool;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Base class for AgentApiTool plugins.\n */\nabstract class AgentApiToolBase extends PluginBase implements AgentApiToolInterface, ContainerFactoryPluginInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  abstract public function execute(array $parameters, array $context): array;\n\n  /**\n   * {@inheritdoc}\n   */\n  abstract public function getOssaToolSchema(): array;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParameters(array $parameters): array {\n    $schema = $this->getOssaToolSchema();\n\n    if (!isset($schema['function']['parameters'])) {\n      return ['valid' => TRUE, 'errors' => []];\n    }\n\n    $errors = [];\n    $paramSchema = $schema['function']['parameters'];\n\n    // Check required parameters.\n    if (isset($paramSchema['required'])) {\n      foreach ($paramSchema['required'] as $required) {\n        if (!array_key_exists($required, $parameters)) {\n          $errors[] = \"Missing required parameter: {$required}\";\n        }\n      }\n    }\n\n    // Basic type checking.\n    if (isset($paramSchema['properties'])) {\n      foreach ($parameters as $key => $value) {\n        if (!isset($paramSchema['properties'][$key])) {\n          continue;\n        }\n\n        $expectedType = $paramSchema['properties'][$key]['type'] ?? NULL;\n        if ($expectedType !== NULL && !$this->validateType($value, $expectedType)) {\n          $errors[] = \"Invalid type for parameter {$key}: expected {$expectedType}\";\n        }\n      }\n    }\n\n    return [\n      'valid' => empty($errors),\n      'errors' => $errors,\n    ];\n  }\n\n  /**\n   * Validates a value against a JSON Schema type.\n   *\n   * @param mixed $value\n   *   The value to validate.\n   * @param string $type\n   *   The expected type.\n   *\n   * @return bool\n   *   TRUE if valid.\n   */\n  protected function validateType($value, string $type): bool {\n    return match ($type) {\n      'string' => is_string($value),\n      'number', 'integer' => is_numeric($value),\n      'boolean' => is_bool($value),\n      'array' => is_array($value),\n      'object' => is_object($value) || is_array($value),\n      default => TRUE,\n    };\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/src/Plugin/AgentApiTool/AgentApiToolBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AgentApiToolBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer bootstrap5 layouts config:\n  title: 'Administer Bootstrap5 Layouts Config'\nadminister bootstrap5 layouts background media:\n  title: 'Administer Bootstrap5 Background Media'\nreset bootstrap5 layouts bare options:\n  title: 'Reset Bootstrap5 Layouts Base Options'\n", "metadata": {"source": "repos/bootstrap_five_layouts/bootstrap_five_layouts.permissions.yml", "type": "yaml_reference", "topic": "bootstrap five layouts.permissions"}}
{"instruction": "Show me the implementation of the class NodeStorageBodyFieldHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_storage_body_field\\Hook;\n\nuse Drupal\\Core\\Extension\\Extension;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for node_storage_body_field.\n */\nclass NodeStorageBodyFieldHooks {\n\n  /**\n   * Implements hook_system_info_alter().\n   */\n  #[Hook('system_info_alter')]\n  public function systemInfoAlter(array &$info, Extension $file, $type): void {\n    // By default, node_storage_body_field is hidden but needs to be un-hidden\n    // when installed, so it can be uninstalled.\n    if ($file->getType() == 'module' && $file->getName() == 'node_storage_body_field') {\n      $info['hidden'] = FALSE;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/node/modules/node_storage_body_field/src/Hook/NodeStorageBodyFieldHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeStorageBodyFieldHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class MediaFilterController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\media\\Controller;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\ContentEntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Render\\RendererInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\filter\\FilterFormatInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException;\nuse Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n\n/**\n * Controller which renders a preview of the provided text.\n *\n * @internal\n *   This is an internal part of the media system in Drupal core and may be\n *   subject to change in minor releases. This class should not be\n *   instantiated or extended by external code.\n */\nclass MediaFilterController implements ContainerInjectionInterface {\n\n  /**\n   * The renderer service.\n   *\n   * @var \\Drupal\\Core\\Render\\RendererInterface\n   */\n  protected $renderer;\n\n  /**\n   * The media storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\ContentEntityStorageInterface\n   */\n  protected $mediaStorage;\n\n  /**\n   * The entity repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * Constructs an MediaFilterController instance.\n   *\n   * @param \\Drupal\\Core\\Render\\RendererInterface $renderer\n   *   The renderer service.\n   * @param \\Drupal\\Core\\Entity\\ContentEntityStorageInterface $media_storage\n   *   The media storage.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(RendererInterface $renderer, ContentEntityStorageInterface $media_storage, EntityRepositoryInterface $entity_repository) {\n    $this->renderer = $renderer;\n    $this->mediaStorage = $media_storage;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('renderer'),\n      $container->get('entity_type.manager')->getStorage('media'),\n      $container->get('entity.repository')\n    );\n  }\n\n  /**\n   * Returns a HTML response containing a preview of the text after filtering.\n   *\n   * Applies all of the given text format's filters, not just the `media_embed`\n   * filter, because for example `filter_align` and `filter_caption` may apply\n   * to it as well.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   * @param \\Drupal\\filter\\FilterFormatInterface $filter_format\n   *   The text format.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\Response\n   *   The filtered text.\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException\n   *   Throws an exception if 'text' parameter is not found in the query\n   *   string.\n   *\n   * @see \\Drupal\\editor\\EditorController::getUntransformedText\n   */\n  public function preview(Request $request, FilterFormatInterface $filter_format) {\n    self::checkCsrf($request, \\Drupal::currentUser());\n\n    $text = $request->query->get('text');\n    $uuid = $request->query->get('uuid');\n    if ($text == '' || $uuid == '') {\n      throw new NotFoundHttpException();\n    }\n\n    $build = [\n      '#type' => 'processed_text',\n      '#text' => $text,\n      '#format' => $filter_format->id(),\n    ];\n    $html = $this->renderer->renderInIsolation($build);\n\n    // Load the media item so we can embed the label in the response, for use\n    // in an ARIA label.\n    $headers = [];\n    if ($media = $this->entityRepository->loadEntityByUuid('media', $uuid)) {\n      $headers['Drupal-Media-Label'] = $this->entityRepository->getTranslationFromContext($media)->label();\n    }\n\n    // Note that we intentionally do not use:\n    // - \\Drupal\\Core\\Cache\\CacheableResponse because caching it on the server\n    //   side is wasteful, hence there is no need for cacheability metadata.\n    // - \\Drupal\\Core\\Render\\HtmlResponse because there is no need for\n    //   attachments nor cacheability metadata.\n    return (new Response($html, 200, $headers))\n      // Do not allow any intermediary to cache the response, only the end user.\n      ->setPrivate()\n      // Allow the end user to cache it for up to 5 minutes.\n      ->setMaxAge(300);\n  }\n\n  /**\n   * Checks access based on media_embed filter status on the text format.\n   *\n   * @param \\Drupal\\filter\\FilterFormatInterface $filter_format\n   *   The text format for which to check access.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public static function formatUsesMediaEmbedFilter(FilterFormatInterface $filter_format) {\n    $filters = $filter_format->filters();\n    return AccessResult::allowedIf($filters->has('media_embed') && $filters->get('media_embed')->status)\n      ->addCacheableDependency($filter_format);\n  }\n\n  /**\n   * Throws an AccessDeniedHttpException if the request fails CSRF validation.\n   *\n   * This is used instead of \\Drupal\\Core\\Access\\CsrfAccessCheck, in order to\n   * allow access for anonymous users.\n   *\n   * @todo Refactor this to an access checker.\n   */\n  private static function checkCsrf(Request $request, AccountInterface $account) {\n    $header = 'X-Drupal-MediaPreview-CSRF-Token';\n\n    if (!$request->headers->has($header)) {\n      throw new AccessDeniedHttpException();\n    }\n    if ($account->isAnonymous()) {\n      // For anonymous users, just the presence of the custom header is\n      // sufficient protection.\n      return;\n    }\n    // For authenticated users, validate the token value.\n    $token = $request->headers->get($header);\n    if (!\\Drupal::csrfToken()->validate($token, $header)) {\n      throw new AccessDeniedHttpException();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Controller/MediaFilterController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaFilterController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * FlowDrop Button Component\n *\n * Styled button with multiple variants.\n *\n * Available variables:\n * - label: Button text (required)\n * - variant: Style variant (primary, secondary, ghost, danger)\n * - size: Button size (sm, md, lg)\n * - url: If provided, renders as a link\n * - icon: Optional SVG icon markup\n * - icon_position: Icon position (start, end)\n * - disabled: Whether button is disabled\n * - full_width: Whether button takes full width\n * - type: HTML button type (button, submit, reset)\n */\n#}\n\n{% set variant = variant|default('primary') %}\n{% set size = size|default('md') %}\n{% set icon_position = icon_position|default('start') %}\n{% set type = type|default('button') %}\n\n{% set classes = [\n  'fd-button',\n  'fd-button--' ~ variant,\n  'fd-button--' ~ size,\n  full_width ? 'fd-button--full-width',\n  disabled ? 'fd-button--disabled'\n]|filter(v => v)|join(' ') %}\n\n{% if url and not disabled %}\n  <a href=\"{{ url }}\" class=\"{{ classes }}\">\n    {% if icon and icon_position == 'start' %}\n      <span class=\"fd-button__icon\">{{ icon|raw }}</span>\n    {% endif %}\n    <span class=\"fd-button__label\">{{ label }}</span>\n    {% if icon and icon_position == 'end' %}\n      <span class=\"fd-button__icon\">{{ icon|raw }}</span>\n    {% endif %}\n  </a>\n{% else %}\n  <button type=\"{{ type }}\" class=\"{{ classes }}\"{% if disabled %} disabled{% endif %}>\n    {% if icon and icon_position == 'start' %}\n      <span class=\"fd-button__icon\">{{ icon|raw }}</span>\n    {% endif %}\n    <span class=\"fd-button__label\">{{ label }}</span>\n    {% if icon and icon_position == 'end' %}\n      <span class=\"fd-button__icon\">{{ icon|raw }}</span>\n    {% endif %}\n  </button>\n{% endif %}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/button/button.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.storage.node.field_auto_import\n    - node.type.api_endpoint\nid: node.api_endpoint.field_auto_import\nfield_name: field_auto_import\nentity_type: node\nbundle: api_endpoint\nlabel: 'Auto Import Entities'\ndescription: 'Automatically generate Drupal entities when this API endpoint is updated.'\nrequired: false\ntranslatable: false\ndefault_value:\n  -\n    value: 0\ndefault_value_callback: ''\nsettings:\n  on_label: 'Yes'\n  off_label: 'No'\nfield_type: boolean\n", "metadata": {"source": "repos/api_normalization/config/install.disabled/field.field.node.api_endpoint.field_auto_import.yml", "type": "yaml_reference", "topic": "field.field.node.api endpoint.field auto import"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: CommentTypeListBuilder.php\nTarget symbol: class to\nNamespace: Drupal\\comment\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for to.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityStorageInterface\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildHeader()\n  - buildRow()\n  - createInstance()\n  - getDefaultOperations()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\comment;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Defines a class to build a listing of comment type entities.\n *\n * @see \\Drupal\\comment\\Entity\\CommentType\n */\nclass CommentTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * Constructs a new CommentTypeListBuilder object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $storage\n   *   The entity storage class.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   */\n  public function __construct(EntityTypeInterface $entity_type, EntityStorageInterface $storage, protected EntityTypeManagerInterface $entityTypeManager) {\n    parent::__construct($entity_type, $storage);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager')->getStorage($entity_type->id()),\n      $container->get('entity_type.manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultOperations(EntityInterface $entity/* , ?CacheableMetadata $cacheability = NULL */) {\n    $operations = parent::getDefaultOperations($entity);\n    // Place the edit operation after the operations added by field_ui.module\n    // which have the weights 15, 20, 25.\n    if (isset($operations['edit'])) {\n      $operations['edit']['weight'] = 30;\n    }\n    return $operations;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    $header['type'] = $this->t('Comment type');\n    $header['description'] = $this->t('Description');\n    $header['target'] = $this->t('Target entity type');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    assert($entity instanceof CommentTypeInterface);\n    $entity_type = $this->entityTypeManager->getDefinition($entity->getTargetEntityTypeId());\n    $row['type'] = $entity->label();\n    $row['description']['data'] = ['#markup' => $entity->getDescription()];\n    $row['target'] = $entity_type->getLabel();\n    return $row + parent::buildRow($entity);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/CommentTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CommentTypeListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: locale.pages.inc\nTarget symbol: class locale.pages.inc\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for locale.pages.inc.", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\n/**\n * @file\n */\n\n@trigger_error(__FILE__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Functions have been deprecated and moved to system.module. See https://www.drupal.org/node/3538089', E_USER_DEPRECATED);\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/locale.pages.inc", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LocalePages", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SoapConditionsResponder.php\nTarget symbol: class SoapConditionsResponder\nNamespace: Drupal\\soap_client_webform\\Element\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SoapConditionsResponder.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Render\\Element\\FormElementBase\n  - Drupal\\soap_client_webform\\Element\\SoapConditionsResponderInterface\n- Ensure these methods exist where relevant:\n  - getInfo()\n  - processElement()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client_webform\\Element;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Render\\Element\\FormElementBase;\nuse Drupal\\soap_client_webform\\Element\\SoapConditionsResponderInterface;\n\n/**\n * Provides Webform #states conditional element for SOAP responses.\n *\n * Creates boolean checkbox sub-elements based on SOAP operation output fields.\n * These checkboxes are automatically updated when a SOAP emitter element fires,\n * enabling Webform #states conditional logic based on SOAP response data.\n *\n * @FormElement(\"soap_conditions_responder\")\n */\nclass SoapConditionsResponder extends FormElementBase implements SoapConditionsResponderInterface\n{\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo(): array\n  {\n    $class = get_class($this);\n    return [\n      '#input' => TRUE,\n      '#process' => [[$class, 'processElement']],\n      '#theme_wrappers' => ['container'],\n      '#tree' => TRUE,\n      '#emitter_element' => '',\n      '#operation_id' => '',\n      '#field_mappings' => [],\n      '#debug_value' => FALSE,\n    ];\n  }\n\n  /**\n   * Processes the element.\n   *\n   * Creates checkbox sub-elements based on SOAP operation output fields for\n   * use with Webform #states conditional logic.\n   *\n   * @param array<string, mixed> $element\n   *   The form element.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   * @param array<string, mixed> $complete_form\n   *   The complete form.\n   *\n   * @return array<string, mixed>\n   *   The processed element.\n   */\n  public static function processElement(\n    array &$element,\n    FormStateInterface $form_state,\n    array &$complete_form,\n  ): array {\n    $operation_id = $element['#operation_id'] ?? '';\n    $element_key = $element['#webform_key'] ?? 'soap_conditions_responder';\n\n    if (empty($operation_id)) {\n      $element['error_message'] = [\n        '#type' => 'markup',\n        '#markup' => '<div class=\"messages messages--warning\">'\n          . t('No SOAP operation configured.')\n          . '</div>',\n      ];\n      return $element;\n    }\n\n    // Load SOAP operation to get output fields\n    $operation_storage = \\Drupal::entityTypeManager()\n      ->getStorage('soap_operation');\n    $operation = $operation_storage->load($operation_id);\n\n    if (!$operation) {\n      $element['error_message'] = [\n        '#type' => 'markup',\n        '#markup' => '<div class=\"messages messages--error\">'\n          . t('SOAP operation \"@id\" not found.', ['@id' => $operation_id])\n          . '</div>',\n      ];\n      return $element;\n    }\n\n    // Get output fields from operation schema\n    $schema = $operation->schema();\n    $output_fields = $schema['output']['fields'] ?? [];\n\n    $wrapper_id = 'soap-conditions-responder-' . $element_key;\n    $element['#attributes']['class'][] = 'soap-conditions-responder-wrapper';\n    $debug_value = $element['#debug_value'] ?? FALSE;\n    $visibility_class = $debug_value ? '' : 'visually-hidden';\n    $emitter_element = $element['#emitter_element'] ?? '';\n\n    $element['#prefix'] = \"<div id=\\\"{$wrapper_id}\\\" \"\n      . \"data-soap-conditions-responder=\\\"{$element_key}\\\" \"\n      . \"data-operation-id=\\\"{$operation_id}\\\" \"\n      . \"data-emitter-element=\\\"{$emitter_element}\\\">\"\n      . \"<div class=\\\"soap-conditions-responder-loading-overlay hidden\\\">\"\n      . \"<div class=\\\"soap-conditions-responder-spinner\\\"></div>\"\n      . \"</div>\"\n      . \"<div id=\\\"{$wrapper_id}-inner\\\" class='{$visibility_class}'>\";\n\n    $element['#suffix'] = '</div></div>';\n\n    $element['_has_data'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Has Data'),\n      '#default_value' => FALSE,\n      '#attributes' => [\n        'data-soap-conditions-responder-field' => '_has_data',\n        'class' => ['soap-conditions-responder-checkbox'],\n      ],\n      '#weight' => -50,\n    ];\n\n    $weight = 0;\n    foreach ($output_fields as $field_config) {\n      $field_name = $field_config['machine_name'] ?? $field_config['name'];\n      $field_label = $field_config['label']\n        ?? ucfirst(str_replace('_', ' ', $field_name));\n      $field_type = $field_config['type'] ?? 'string';\n\n      $is_boolean = in_array($field_type, ['boolean', 'bool']);\n      $form_element_type = $is_boolean ? 'checkbox' : 'hidden';\n\n      $element[$field_name] = [\n        '#type' => $form_element_type,\n        '#title' => $field_label,\n        '#default_value' => $is_boolean ? FALSE : '',\n        '#attributes' => [\n          'data-soap-conditions-responder-field' => $field_name,\n          'data-field-type' => $field_type,\n          'class' => ['soap-conditions-responder-field'],\n        ],\n        '#weight' => $weight++,\n      ];\n    }\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/modules/soap_client_webform/src/Element/SoapConditionsResponder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapConditionsResponder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ApiResponseEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Event;\n\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Event fired when an API response is received.\n */\nclass ApiResponseEvent extends Event {\n\n  /**\n   * Event name for successful API response.\n   */\n  const RESPONSE_RECEIVED = 'api_normalization.response_received';\n\n  /**\n   * Event name for API request failure.\n   */\n  const REQUEST_FAILED = 'api_normalization.request_failed';\n\n  /**\n   * Constructs an ApiResponseEvent object.\n   */\n  public function __construct(\n    protected string $provider,\n    protected int $statusCode,\n    protected array $responseData,\n    protected string $endpoint,\n    protected ?array $requestData = NULL,\n    protected ?float $responseTime = NULL,\n  ) {}\n\n  /**\n   * Gets the API provider name.\n   */\n  public function getProvider(): string {\n    return $this->provider;\n  }\n\n  /**\n   * Gets the HTTP status code.\n   */\n  public function getStatusCode(): int {\n    return $this->statusCode;\n  }\n\n  /**\n   * Gets the response data.\n   */\n  public function getResponseData(): array {\n    return $this->responseData;\n  }\n\n  /**\n   * Gets the API endpoint.\n   */\n  public function getEndpoint(): string {\n    return $this->endpoint;\n  }\n\n  /**\n   * Gets the request data.\n   */\n  public function getRequestData(): ?array {\n    return $this->requestData;\n  }\n\n  /**\n   * Gets the response time in seconds.\n   */\n  public function getResponseTime(): ?float {\n    return $this->responseTime;\n  }\n\n  /**\n   * Checks if the response was successful.\n   */\n  public function isSuccessful(): bool {\n    return $this->statusCode >= 200 && $this->statusCode < 300;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Event/ApiResponseEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiResponseEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override to present all user data.\n *\n * This template is used when viewing a registered user's page,\n * e.g., example.com/user/123. 123 being the user's ID.\n *\n * Available variables:\n * - content: A list of content items. Use 'content' to print all content, or\n *   print a subset such as 'content.field_example'. Fields attached to a user\n *   such as 'user_picture' are available as 'content.user_picture'.\n * - attributes: HTML attributes for the container element.\n * - user: A Drupal User entity.\n *\n * @see \\Drupal\\user\\UserThemeHooks::preprocessUser()\n */\n#}\n<article{{ attributes.addClass('profile') }}>\n  {% if content %}\n    {{- content -}}\n  {% endif %}\n</article>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/user/user.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: TransactionStatusUpdater\nSource file: <source_file>\nFile name hint: TransactionStatusUpdater.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Service;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Drupal\\nexi_xpay\\Event\\NexiXpayEvents;\nuse Drupal\\nexi_xpay\\Event\\TransactionStatusChangeEvent;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * Updates the transaction status.\n */\nfinal class TransactionStatusUpdater {\n\n  /**\n   * The logger context.\n   *\n   * @var array{amount?: int, body?: string, correlationId?: string, currentStatus?: string, currency?: string, endpoint?: string, error?: string, eventId?: string, httpStatus?: int, method?: string, mode?: string, newStatus?: string|null, payload?: string, operationResult?: string, orderId?: string, outcome?: string, transaction?: int, url?: string}\n   */\n  protected array $loggerContext;\n\n  /**\n   * The constructor.\n   *\n   * @param \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface $dispatcher\n   *   The event dispatcher.\n   * @param \\Drupal\\nexi_xpay\\Service\\Logger $logger\n   *   The logger.\n   */\n  public function __construct(\n    private readonly EventDispatcherInterface $dispatcher,\n    private readonly LoggerInterface $logger,\n  ) {\n    $this->loggerContext = $this->logger->setupContext();\n  }\n\n  /**\n   * Sets the transaction status if it changed.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param string $newStatus\n   *   The new status.\n   * @param array<string, mixed> $context\n   *   Extra context information for callers (debug/logging).\n   *\n   * @return bool\n   *   TRUE if the status changed.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityStorageException\n   */\n  public function setStatusIfChanged(NexiXpayTransactionInterface $transaction, string $newStatus, array $context = []): bool {\n    $currentStatus = $this->loggerContext['currentStatus'] = $transaction->getStatus();\n    $this->loggerContext['newStatus'] = $newStatus;\n    $this->loggerContext['transaction'] = (int) $transaction->id();\n\n    if ($currentStatus === $newStatus) {\n      return FALSE;\n    }\n    $transaction->setStatus($newStatus);\n    $transaction->save();\n\n    $this->dispatcher->dispatch(\n      new TransactionStatusChangeEvent($transaction, $currentStatus, $newStatus, $context),\n      NexiXpayEvents::TRANSACTION_STATUS_CHANGE\n    );\n\n    $this->loggerContext['mode'] =\n      isset($context['mode']) && is_string($context['mode']) ? $context['mode'] : '';\n    $this->loggerContext['orderId'] =\n      isset($context['orderId']) && is_string($context['orderId']) ? $context['orderId'] : '';\n\n    $this->logger->info('Transaction status changed.', $this->loggerContext);\n\n    return TRUE;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Service;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Drupal\\nexi_xpay\\Event\\NexiXpayEvents;\nuse Drupal\\nexi_xpay\\Event\\TransactionStatusChangeEvent;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * Updates the transaction status.\n */\nfinal class TransactionStatusUpdater {\n\n  /**\n   * The logger context.\n   *\n   * @var array{amount?: int, body?: string, correlationId?: string, currentStatus?: string, currency?: string, endpoint?: string, error?: string, eventId?: string, httpStatus?: int, method?: string, mode?: string, newStatus?: string|null, payload?: string, operationResult?: string, orderId?: string, outcome?: string, transaction?: int, url?: string}\n   */\n  protected array $loggerContext;\n\n  /**\n   * The constructor.\n   *\n   * @param \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface $dispatcher\n   *   The event dispatcher.\n   * @param \\Drupal\\nexi_xpay\\Service\\Logger $logger\n   *   The logger.\n   */\n  public function __construct(\n    private readonly EventDispatcherInterface $dispatcher,\n    private readonly LoggerInterface $logger,\n  ) {\n    $this->loggerContext = $this->logger->setupContext();\n  }\n\n  /**\n   * Sets the transaction status if it changed.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param string $newStatus\n   *   The new status.\n   * @param array<string, mixed> $context\n   *   Extra context information for callers (debug/logging).\n   *\n   * @return bool\n   *   TRUE if the status changed.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityStorageException\n   */\n  public function setStatusIfChanged(NexiXpayTransactionInterface $transaction, string $newStatus, array $context = []): bool {\n    $currentStatus = $this->loggerContext['currentStatus'] = $transaction->getStatus();\n    $this->loggerContext['newStatus'] = $newStatus;\n    $this->loggerContext['transaction'] = (int) $transaction->id();\n\n    if ($currentStatus === $newStatus) {\n      return FALSE;\n    }\n    $transaction->setStatus($newStatus);\n    $transaction->save();\n\n    $this->dispatcher->dispatch(\n      new TransactionStatusChangeEvent($transaction, $currentStatus, $newStatus, $context),\n      NexiXpayEvents::TRANSACTION_STATUS_CHANGE\n    );\n\n    $this->loggerContext['mode'] =\n      isset($context['mode']) && is_string($context['mode']) ? $context['mode'] : '';\n    $this->loggerContext['orderId'] =\n      isset($context['orderId']) && is_string($context['orderId']) ? $context['orderId'] : '';\n\n    $this->logger->info('Transaction status changed.', $this->loggerContext);\n\n    return TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Service/TransactionStatusUpdater.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TransactionStatusUpdater", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class AfterTableTruncateEvent in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_db\\Event;\n\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event dispatched after table truncate operation.\n */\nclass AfterTableTruncateEvent extends Event {\n\n  /**\n   * Constructs an AfterTableTruncateEvent object.\n   *\n   * @param string $tableName\n   *   The table name that was truncated.\n   * @param bool $success\n   *   Whether the truncate operation was successful.\n   * @param array $tables\n   *   Array of all tables that were truncated.\n   * @param int $deletedCount\n   *   The number of rows that were deleted.\n   */\n  public function __construct(\n    protected string $tableName,\n    protected bool $success,\n    protected array $tables = [],\n    protected int $deletedCount = 0,\n  ) {}\n\n  /**\n   * Gets the table name.\n   *\n   * @return string\n   *   The table name.\n   */\n  public function getTableName(): string {\n    return $this->tableName;\n  }\n\n  /**\n   * Checks if the operation was successful.\n   *\n   * @return bool\n   *   TRUE if successful, FALSE otherwise.\n   */\n  public function isSuccess(): bool {\n    return $this->success;\n  }\n\n  /**\n   * Gets all tables that were truncated.\n   *\n   * @return array\n   *   Array of table names.\n   */\n  public function getTables(): array {\n    return $this->tables;\n  }\n\n  /**\n   * Gets the number of rows that were deleted.\n   *\n   * @return int\n   *   The deleted row count.\n   */\n  public function getDeletedCount(): int {\n    return $this->deletedCount;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_db/src/Event/AfterTableTruncateEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AfterTableTruncateEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ThemeAdminForm.php\nTarget symbol: class ThemeAdminForm\nNamespace: Drupal\\system\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ThemeAdminForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - buildForm()\n  - getEditableConfigNames()\n  - getFormId()\n  - submitForm()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form to select the administration theme.\n *\n * @internal\n */\nclass ThemeAdminForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'system_themes_admin_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['system.theme'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?array $theme_options = NULL) {\n    // Administration theme settings.\n    $form['admin_theme'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Administration theme'),\n      '#open' => TRUE,\n    ];\n    $form['admin_theme']['admin_theme'] = [\n      '#type' => 'select',\n      '#options' => ['' => $this->t('Default theme')] + $theme_options,\n      '#title' => $this->t('Administration theme'),\n      '#description' => $this->t('Choose \"Default theme\" to always use the same theme as the rest of the site.'),\n      '#default_value' => $this->config('system.theme')->get('admin'),\n    ];\n    $form['admin_theme']['actions'] = ['#type' => 'actions'];\n    $form['admin_theme']['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Save configuration'),\n      '#button_type' => 'primary',\n    ];\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    parent::submitForm($form, $form_state);\n    $this->config('system.theme')->set('admin', $form_state->getValue('admin_theme'))->save();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/ThemeAdminForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ThemeAdminForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Flex Row Component", "input": "", "output": "# Flex Row Component\n\nA flexible container component with customizable flexbox properties that allows you to drop and arrange child components. Perfect for creating responsive layouts with precise control over spacing and alignment.\n\n## Features\n\n- **Flex Wrap Control**: Choose how items wrap to new lines\n- **Justify Content**: Control horizontal alignment (start, center, end, space-between, space-around, space-evenly)\n- **Align Items**: Control vertical alignment (start, center, end, stretch, baseline)\n- **Gap Control**: Adjust spacing between items (0-5)\n- **Margin Control**: Set top and bottom margins independently\n- **Nested Container**: Drop any components inside\n- **Bootstrap-Compatible**: Uses Bootstrap utility classes\n\n## Usage\n\n### In the PR Builder Editor\n\n1. Drag the \"Flex Row\" component from the toolbar\n2. Click on the component to open the sidebar editor\n3. Configure the following properties:\n   - **Flex Wrap**: How items should wrap (Wrap, No Wrap, Wrap Reverse)\n   - **Justify Content**: Horizontal alignment\n   - **Align Items**: Vertical alignment\n   - **Gap Size**: Space between items (0-5)\n   - **Bottom Margin**: Margin below the container\n   - **Top Margin**: Margin above the container\n4. Drag and drop other components (like Card Block) into the flex row\n\n### Example Use Cases\n\n#### Card Grid\n```\nFlex Row\n\u251c\u2500\u2500 flex_wrap: wrap\n\u251c\u2500\u2500 justify_content: center\n\u251c\u2500\u2500 gap: 5\n\u251c\u2500\u2500 Children:\n    \u251c\u2500\u2500 Card Block 1\n    \u251c\u2500\u2500 Card Block 2\n    \u251c\u2500\u2500 Card Block 3\n    \u2514\u2500\u2500 Card Block 4\n```\n\n#### Centered Content Row\n```\nFlex Row\n\u251c\u2500\u2500 flex_wrap: nowrap\n\u251c\u2500\u2500 justify_content: center\n\u251c\u2500\u2500 align_items: center\n\u2514\u2500\u2500 Children: (any components)\n```\n\n#### Space-Between Layout\n```\nFlex Row\n\u251c\u2500\u2500 flex_wrap: wrap\n\u251c\u2500\u2500 justify_content: space-between\n\u251c\u2500\u2500 gap: 3\n\u2514\u2500\u2500 Children: (any components)\n```\n\n## Properties\n\n### Flex Wrap\n- **wrap**: Items wrap to new lines (default)\n- **nowrap**: Items stay on one line\n- **wrap-reverse**: Items wrap in reverse order\n\n### Justify Content\n- **start**: Items align to the start\n- **center**: Items are centered (default)\n- **end**: Items align to the end\n- **space-between**: Items spaced evenly with first/last at edges\n- **space-around**: Items spaced evenly with equal space around\n- **space-evenly**: Items spaced with equal space between\n\n### Align Items\n- **start**: Items align to the top\n- **center**: Items are vertically centered\n- **end**: Items align to the bottom\n- **stretch**: Items stretch to fill container (default)\n- **baseline**: Items align to their baselines\n\n### Gap Size\n- **0**: No gap\n- **1**: 0.25rem (4px)\n- **2**: 0.5rem (8px)\n- **3**: 1rem (16px)\n- **4**: 1.5rem (24px)\n- **5**: 3rem (48px) - default\n\n### Margin Bottom\n- **mb-0**: No bottom margin\n- **mb-1**: 0.25rem\n- **mb-2**: 0.5rem\n- **mb-3**: 1rem\n- **mb-4**: 1.5rem\n- **mb-5**: 3rem\n- **mb-sm-5**: 3rem on small screens, 0 on larger screens (default)\n\n### Margin Top\n- **mt-0**: No top margin (default)\n- **mt-1**: 0.25rem\n- **mt-2**: 0.5rem\n- **mt-3**: 1rem\n- **mt-4**: 1.5rem\n- **mt-5**: 3rem\n\n## Example HTML Output\n\n```html\n<div data-sdc-component=\"sdc_inline_editor:flex-row\"\n     data-nested-container=\"true\"\n     class=\"d-flex flex-wrap gap-5 justify-content-center align-items-stretch mb-sm-5 mt-0\">\n  <div data-drop-container=\"true\" class=\"flex-row-container\" style=\"display: contents;\">\n    <!-- Child components render here -->\n  </div>\n</div>\n```\n\n## Comparison with Row Block\n\n### Flex Row\n- Single container for all items\n- Items flow naturally based on available space\n- Uses gap for spacing (modern CSS)\n- Perfect for card grids and dynamic layouts\n- Items can have different widths\n\n### Row Block\n- Defined columns (1-4)\n- Items are in separate columns\n- Column widths can be customized\n- Perfect for structured layouts\n- Each column is a distinct container\n\n## Responsive Behavior\n\nThe flex row is responsive by default:\n- Items will wrap to new lines on smaller screens if `flex-wrap: wrap` is set\n- Gap and margin values are consistent across breakpoints\n- Use `mb-sm-5` for responsive bottom margins\n\n## Best Practices\n\n1. **Card Layouts**: Use `gap-5` with `justify-content-center` and `flex-wrap: wrap`\n2. **Button Rows**: Use `gap-3` with `justify-content-start` and `flex-wrap: nowrap`\n3. **Image Galleries**: Use `gap-2` with `justify-content-space-evenly` and `flex-wrap: wrap`\n4. **Center Content**: Use `justify-content-center` with `align-items-center`\n\n## Styling\n\nThe component uses Bootstrap-compatible utility classes that are defined in `flex-row.css`. If your site already includes Bootstrap, you may see some style overlap, but the component's CSS uses `!important` to ensure consistency.\n\n## Accessibility\n\n- Semantic HTML structure\n- No accessibility barriers\n- Works with keyboard navigation\n- Child components maintain their own accessibility features\n\n## Browser Support\n\n- All modern browsers (Chrome, Firefox, Safari, Edge)\n- CSS Flexbox required\n- CSS Gap property supported in all modern browsers\n", "metadata": {"source": "repos/sdc_inline_editor/components/flex-row/README.md", "type": "doc_summary", "topic": "Flex Row Component"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SecurityAudit.php\nTarget symbol: class SecurityAudit\nNamespace: Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SecurityAudit.\n- Include required imports:\n  - Drupal\\mcp_tools_analysis\\Service\\AnalysisService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_security',\n  label: new TranslatableMarkup('Security Audit'),\n  description: new TranslatableMarkup('Review permissions, check for exposed data, and identify overly permissive roles.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'critical_issues' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Critical Issues'),\n      description: new TranslatableMarkup('Critical security issues requiring immediate attention'),\n    ),\n    'warnings' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Warnings'),\n      description: new TranslatableMarkup('Security warnings to review'),\n    ),\n    'critical_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Critical Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'warning_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Warning Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'admin_user_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Admin User Count'),\n      description: new TranslatableMarkup('Number of users with administrator role'),\n    ),\n    'registration_mode' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Registration Mode'),\n      description: new TranslatableMarkup('Current user registration setting'),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass SecurityAudit extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->analysisService->securityAudit();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/src/Plugin/tool/Tool/SecurityAudit.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SecurityAudit", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface DiscoverableInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Discovery;\n\n/**\n * Interface for classes providing a type of discovery.\n */\ninterface DiscoverableInterface {\n\n  /**\n   * Returns an array of discoverable items.\n   *\n   * @return array\n   *   An array of discovered data keyed by provider.\n   *\n   * @throws \\Drupal\\Component\\Discovery\\DiscoveryException\n   *   Exception thrown if there is a problem during discovery.\n   */\n  public function findAll();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Discovery/DiscoverableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DiscoverableInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: GenerateProxyClassApplication.php\nTarget symbol: class GenerateProxyClassApplication\nNamespace: Drupal\\Core\\Command\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for GenerateProxyClassApplication.\n- Include required imports:\n  - Drupal\\Component\\ProxyBuilder\\ProxyBuilder\n  - Symfony\\Component\\Console\\Application\n  - Symfony\\Component\\Console\\Input\\InputDefinition\n  - Symfony\\Component\\Console\\Input\\InputInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getCommandName()\n  - getDefaultCommands()\n  - getDefinition()", "output": "<?php\n\nnamespace Drupal\\Core\\Command;\n\nuse Drupal\\Component\\ProxyBuilder\\ProxyBuilder;\nuse Symfony\\Component\\Console\\Application;\nuse Symfony\\Component\\Console\\Input\\InputDefinition;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\n\n/**\n * Provides a console command to generate proxy classes.\n *\n * @see lazy_services\n * @see core/scripts/generate-proxy-class.php\n */\nclass GenerateProxyClassApplication extends Application {\n\n  /**\n   * The proxy builder.\n   *\n   * @var \\Drupal\\Component\\ProxyBuilder\\ProxyBuilder\n   */\n  protected $proxyBuilder;\n\n  /**\n   * Constructs a new GenerateProxyClassApplication instance.\n   *\n   * @param \\Drupal\\Component\\ProxyBuilder\\ProxyBuilder $proxy_builder\n   *   The proxy builder.\n   */\n  public function __construct(ProxyBuilder $proxy_builder) {\n    $this->proxyBuilder = $proxy_builder;\n\n    parent::__construct();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getCommandName(InputInterface $input): ?string {\n    return 'generate-proxy-class';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultCommands(): array {\n    // Even though this is a single command, keep the HelpCommand (--help).\n    $default_commands = parent::getDefaultCommands();\n    $default_commands[] = new GenerateProxyClassCommand($this->proxyBuilder);\n    return $default_commands;\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * Overridden so the application doesn't expect the command name as the first\n   * argument.\n   */\n  public function getDefinition(): InputDefinition {\n    $definition = parent::getDefinition();\n    // Clears the normal first argument (the command name).\n    $definition->setArguments();\n    return $definition;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Command/GenerateProxyClassApplication.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GenerateProxyClassApplication", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "preview:\n  version: 1.x\n  js:\n    js/ai_components.js: {}\n  css:\n    theme:\n      css/ai_components.css: {}\n  dependencies:\n    - core/drupal\n    - core/drupal.ajax\n    - core/jquery\n", "metadata": {"source": "repos/ai_components/ai_components.libraries.yml", "type": "yaml_reference", "topic": "ai components.libraries"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ExistsInConstraintValidator\nSource file: <source_file>\nFile name hint: ExistsInConstraintValidator.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\book\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Config\\Schema\\ArrayElement;\nuse Drupal\\Core\\TypedData\\TypedDataInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validates the ExistsIn constraint.\n */\nclass ExistsInConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $value, Constraint $constraint): void {\n    if (!$constraint instanceof ExistsInConstraint) {\n      throw new UnexpectedTypeException($constraint, ExistsInConstraint::class);\n    }\n\n    $this_property = $this->context->getObject();\n    assert($this_property instanceof TypedDataInterface);\n    $choices_raw = self::find($constraint->selector, $this_property)->getValue();\n\n    $allowed_types = [];\n    foreach ($choices_raw as $choice) {\n      $allowed_types[] = $choice['content_type'];\n    }\n\n    if (!in_array($value, $allowed_types)) {\n      $this->context->addViolation($constraint->message, [\n        '@child_type' => $value,\n      ]);\n    }\n  }\n\n  /**\n   * Resolves an expression that selects other typed data in the same root.\n   *\n   * The expression may contain the following special strings:\n   * - '%root', to reference the root of the array.\n   *\n   * Example expressions:\n   * - '%root.allowed_types', indicators the key to check.\n   *\n   * @param string $expression\n   *   Expression to be resolved.\n   * @param \\Drupal\\Core\\TypedData\\TypedDataInterface $data\n   *   Configuration data for the element.\n   *\n   * @return \\Drupal\\Core\\TypedData\\TypedDataInterface\n   *   The selected typed data elsewhere in the same config object.\n   *\n   * @see \\Drupal\\Core\\Config\\Schema\\TypeResolver::resolveExpression()\n   */\n  private static function find(string $expression, TypedDataInterface $data): TypedDataInterface {\n    $parts = explode('.', $expression);\n    // Process each value part, one at a time.\n    while ($name = array_shift($parts)) {\n\n      if ($name === '%root') {\n        $data = $data->getRoot();\n        continue;\n      }\n\n      if (!$data instanceof ArrayElement) {\n        $data = $data->getRoot();\n        if (!$data instanceof ArrayElement) {\n          throw new \\LogicException(sprintf('This is not an array element, so cannot get `%s`.', $name));\n        }\n      }\n\n      $elements = $data->getElements();\n      if (!array_key_exists($name, $elements)) {\n        throw new \\LogicException(sprintf('`%s` does not exist at `%s`.', $name, $data->getPropertyPath()));\n      }\n\n      $data = $elements[$name];\n    }\n\n    return $data;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\book\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Config\\Schema\\ArrayElement;\nuse Drupal\\Core\\TypedData\\TypedDataInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validates the ExistsIn constraint.\n */\nclass ExistsInConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $value, Constraint $constraint): void {\n    if (!$constraint instanceof ExistsInConstraint) {\n      throw new UnexpectedTypeException($constraint, ExistsInConstraint::class);\n    }\n\n    $this_property = $this->context->getObject();\n    assert($this_property instanceof TypedDataInterface);\n    $choices_raw = self::find($constraint->selector, $this_property)->getValue();\n\n    $allowed_types = [];\n    foreach ($choices_raw as $choice) {\n      $allowed_types[] = $choice['content_type'];\n    }\n\n    if (!in_array($value, $allowed_types)) {\n      $this->context->addViolation($constraint->message, [\n        '@child_type' => $value,\n      ]);\n    }\n  }\n\n  /**\n   * Resolves an expression that selects other typed data in the same root.\n   *\n   * The expression may contain the following special strings:\n   * - '%root', to reference the root of the array.\n   *\n   * Example expressions:\n   * - '%root.allowed_types', indicators the key to check.\n   *\n   * @param string $expression\n   *   Expression to be resolved.\n   * @param \\Drupal\\Core\\TypedData\\TypedDataInterface $data\n   *   Configuration data for the element.\n   *\n   * @return \\Drupal\\Core\\TypedData\\TypedDataInterface\n   *   The selected typed data elsewhere in the same config object.\n   *\n   * @see \\Drupal\\Core\\Config\\Schema\\TypeResolver::resolveExpression()\n   */\n  private static function find(string $expression, TypedDataInterface $data): TypedDataInterface {\n    $parts = explode('.', $expression);\n    // Process each value part, one at a time.\n    while ($name = array_shift($parts)) {\n\n      if ($name === '%root') {\n        $data = $data->getRoot();\n        continue;\n      }\n\n      if (!$data instanceof ArrayElement) {\n        $data = $data->getRoot();\n        if (!$data instanceof ArrayElement) {\n          throw new \\LogicException(sprintf('This is not an array element, so cannot get `%s`.', $name));\n        }\n      }\n\n      $elements = $data->getElements();\n      if (!array_key_exists($name, $elements)) {\n        throw new \\LogicException(sprintf('`%s` does not exist at `%s`.', $name, $data->getPropertyPath()));\n      }\n\n      $data = $elements[$name];\n    }\n\n    return $data;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/Validation/Constraint/ExistsInConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExistsInConstraintValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "lightgallery_formatter.profile.*:\n  type: config_entity\n  label: 'LightGallery profile'\n  mapping:\n    id:\n      type: string\n      label: 'Machine name'\n    label:\n      type: label\n      label: 'Label'\n    status:\n      type: boolean\n      label: 'Enabled'\n    plugin_settings:\n      type: sequence\n      label: 'Plugin settings'\n      sequence:\n        type: ignore\n        label: 'Plugin specific settings'\n", "metadata": {"source": "repos/lightgallery_formatter/config/schema/lightgallery_formatter.schema.yml", "type": "yaml_reference", "topic": "lightgallery formatter.schema"}}
{"instruction": "Show me the implementation of the class DecorativeImages in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Hook implementations for the decorative_images module.\n */\n\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\media\\MediaInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\image\\Plugin\\Field\\FieldType\\ImageItem;\nuse Drupal\\decorative_images\\Hook\\DecorativeConfigFormAlter;\nuse Drupal\\decorative_images\\Hook\\DecorativeWidgetFormAlter;\n\n/**\n * Implements hook_form_alter().\n *\n * Alters field configuration forms to add decorative image option.\n */\nfunction decorative_images_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  DecorativeConfigFormAlter::alterForm($form, $form_state, $form_id);\n}\n\n/**\n * Implements hook_field_widget_single_element_form_alter().\n *\n * Adds the decorative option if the field is configured to support it.\n */\nfunction decorative_images_field_widget_single_element_form_alter(array &$element, FormStateInterface $form_state, array $context) {\n  DecorativeWidgetFormAlter::alterForm($element, $form_state, $context);\n}\n\n/**\n * Implements hook_entity_presave().\n *\n * Saves 'Decorative' entity field value.\n */\nfunction decorative_images_entity_presave(EntityInterface $entity) {\n  if (!$entity instanceof NodeInterface && !$entity instanceof MediaInterface) {\n    return;\n  }\n\n  foreach ($entity->getFieldDefinitions() as $field_name => $field_definition) {\n    if ($field_definition->getType() !== 'image') {\n      continue;\n    }\n\n    foreach ($entity->get($field_name) as &$item) {\n      $is_decorative = (int) $item->is_decorative ?? 0;\n      \\Drupal::service('keyvalue')->get('decorative_images')->set($item->target_id, $is_decorative);\n    }\n  }\n}\n\n/**\n * Implements hook_preprocess_hook().\n *\n * Adds `role=\"presentation\"` to decorative images.\n */\nfunction decorative_images_preprocess_field(array &$variables, string $hook): void {\n  if ($variables['field_type'] !== 'image') {\n    return;\n  }\n  foreach ($variables['items'] as &$item) {\n    $image = $item['content']['#item'] ?? NULL;\n    if (!$image instanceof ImageItem) {\n      continue;\n    }\n    $is_decorative = (int) \\Drupal::service('keyvalue')->get('decorative_images')->get($image->target_id) ?? 0;\n    if ($is_decorative) {\n      $item['content']['#item_attributes']['role'] = 'presentation';\n    }\n  }\n}\n\n/**\n * Implements template_preprocess_image().\n *\n * If the image is for presentation only, remove the `role` attribute\n * and set the alternative text to an empty string.\n */\nfunction decorative_images_preprocess_image(&$variables) {\n  $role = $variables['attributes']['role'] ?? NULL;\n  if ($role === 'presentation') {\n    unset($variables['attributes']['role']);\n    $variables['attributes']['alt'] = '';\n  }\n}\n", "metadata": {"source": "repos/decorative_images/decorative_images.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DecorativeImages", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LinkCollectionNormalizer.php\nTarget symbol: class may\nNamespace: Drupal\\jsonapi\\Normalizer\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for may.\n- Include required imports:\n  - Drupal\\Component\\Utility\\Crypt\n  - Drupal\\Core\\Cache\\CacheableMetadata\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\jsonapi\\JsonApiResource\\LinkCollection\n  - Drupal\\jsonapi\\JsonApiResource\\Link\n  - Drupal\\jsonapi\\Normalizer\\Value\\CacheableNormalization\n  - Drupal\\jsonapi\\Normalizer\\Value\\CacheableOmission\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getSupportedTypes()\n  - hashByHref()\n  - normalize()", "output": "<?php\n\nnamespace Drupal\\jsonapi\\Normalizer;\n\nuse Drupal\\Component\\Utility\\Crypt;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\jsonapi\\JsonApiResource\\LinkCollection;\nuse Drupal\\jsonapi\\JsonApiResource\\Link;\nuse Drupal\\jsonapi\\Normalizer\\Value\\CacheableNormalization;\nuse Drupal\\jsonapi\\Normalizer\\Value\\CacheableOmission;\n\n/**\n * Normalizes a LinkCollection object.\n *\n * The JSON:API specification has the concept of a \"links collection\". A links\n * collection is a JSON object where each member of the object is a\n * \"link object\". Unfortunately, this means that it is not possible to have more\n * than one link for a given key.\n *\n * When normalizing more than one link in a LinkCollection with the same key, a\n * unique and random string is appended to the link's key after a double dash\n * (--) to differentiate the links. See this class's hashByHref() method for\n * details.\n *\n * This may change with a later version of the JSON:API specification.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nclass LinkCollectionNormalizer extends NormalizerBase {\n\n  /**\n   * The normalizer $context key name for the key of an individual link.\n   *\n   * @var string\n   */\n  const LINK_KEY = 'jsonapi_links_object_link_key';\n\n  /**\n   * The normalizer $context key name for the context object of the link.\n   *\n   * @var string\n   */\n  const LINK_CONTEXT = 'jsonapi_links_object_context';\n\n  /**\n   * A random string to use when hashing links.\n   *\n   * This string is unique per instance of a link collection, but always the\n   * same within it. This means that link key hashes will be non-deterministic\n   * for outside observers, but two links within the same collection will always\n   * have the same hash value.\n   *\n   * This is not used for cryptographic purposes.\n   *\n   * @var string\n   */\n  protected $hashSalt;\n\n  /**\n   * The current user making the request.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $currentUser;\n\n  /**\n   * LinkCollectionNormalizer constructor.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $current_user\n   *   The current user.\n   */\n  public function __construct(AccountInterface $current_user) {\n    $this->currentUser = $current_user;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function normalize($object, $format = NULL, array $context = []): array|string|int|float|bool|\\ArrayObject|NULL {\n    assert($object instanceof LinkCollection);\n    $normalized = [];\n    /** @var \\Drupal\\jsonapi\\JsonApiResource\\Link $link */\n    foreach ($object as $key => $links) {\n      $is_multiple = count($links) > 1;\n      foreach ($links as $link) {\n        $link_key = $is_multiple ? sprintf('%s--%s', $key, $this->hashByHref($link)) : $key;\n        $attributes = $link->getTargetAttributes();\n        $normalization = array_merge(['href' => $link->getHref()], !empty($attributes) ? ['meta' => $attributes] : []);\n        // Checking access on links is not about access to the link itself;\n        // it is about whether the current user has access to the route that is\n        // *targeted* by the link. This is done on a \"best effort\" basis. That\n        // is, some links target routes that depend on a request to determine if\n        // they're accessible or not. Some other links might target routes to\n        // which the current user will clearly not have access, in that case\n        // this code proactively removes those links from the response.\n        $access = $link->getUri()->access($this->currentUser, TRUE);\n        $cacheability = CacheableMetadata::createFromObject($link)->addCacheableDependency($access);\n        $normalized[$link_key] = $access->isAllowed()\n          ? new CacheableNormalization($cacheability, $normalization)\n          : new CacheableOmission($cacheability);\n      }\n    }\n    return CacheableNormalization::aggregate($normalized);\n  }\n\n  /**\n   * Hashes a link using its href and its target attributes, if any.\n   *\n   * This method generates an unpredictable, but deterministic, 7 character\n   * alphanumeric hash for a given link.\n   *\n   * The hash is unpredictable because a random hash salt will be used for every\n   * request. The hash is deterministic because, within a single request, links\n   * with the same href and target attributes (i.o.w. duplicates) will generate\n   * equivalent hash values.\n   *\n   * @param \\Drupal\\jsonapi\\JsonApiResource\\Link $link\n   *   A link to be hashed.\n   *\n   * @return string\n   *   A 7 character alphanumeric hash.\n   */\n  protected function hashByHref(Link $link) {\n    // Generate a salt unique to each instance of this class.\n    if (!$this->hashSalt) {\n      $this->hashSalt = Crypt::randomBytesBase64();\n    }\n    // Create a dictionary of link parameters.\n    $link_parameters = [\n      'href' => $link->getHref(),\n    ] + $link->getTargetAttributes();\n    // Serialize the dictionary into a string.\n    foreach ($link_parameters as $name => $value) {\n      $serialized_parameters[] = sprintf('%s=\"%s\"', $name, implode(' ', (array) $value));\n    }\n    // Hash the string.\n    $b64_hash = Crypt::hashBase64($this->hashSalt . implode('; ', $serialized_parameters));\n    // Remove any dashes and underscores from the base64 hash and then return\n    // the first 7 characters.\n    return substr(str_replace(['-', '_'], '', $b64_hash), 0, 7);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      LinkCollection::class => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/Normalizer/LinkCollectionNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LinkCollectionNormalizer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface ImageToolkitOperationManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\ImageToolkit;\n\n/**\n * Defines an interface for image toolkit operation managers.\n */\ninterface ImageToolkitOperationManagerInterface {\n\n  /**\n   * Returns a toolkit operation plugin instance.\n   *\n   * @param \\Drupal\\Core\\ImageToolkit\\ImageToolkitInterface $toolkit\n   *   The toolkit instance.\n   * @param string $operation\n   *   The operation (e.g. \"crop\").\n   *\n   * @return \\Drupal\\Core\\ImageToolkit\\ImageToolkitOperationInterface\n   *   An instance of the requested toolkit operation plugin.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   *   When no plugin is available.\n   */\n  public function getToolkitOperation(ImageToolkitInterface $toolkit, $operation);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/ImageToolkit/ImageToolkitOperationManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ImageToolkitOperationManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Navbar\ndescription: \"Powerful, responsive navigation header, the navbar. Includes support for branding, navigation, and more, including support for our collapse plugin.\"\ngroup: Navbar\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/components/navbar/\"\nvariants:\n  default:\n    title: Default\n  expand_sm:\n    title: \"Expand small\"\n  expand_md:\n    title: \"Expand medium\"\n  expand_lg:\n    title: \"Expand large\"\n  expand_xl:\n    title: \"Expand extra large\"\n  expand_xxl:\n    title: \"Expand extra extra large\"\nslots:\n  brand:\n    title: Brand\n  navigation:\n    title: Navigation\n    description: \"Navigation elements (brand, text, etc.) displayed even on small screens.\"\n  navigation_collapsible:\n    title: \"Navigation collapsible\"\n    description: \"Navigation elements (menu links, etc.) displayed on collapsible dropdown on small screens.\"\n  offcanvas_label:\n    title: \"Offcanvas label\"\n    description: \"When using the offcanvas feature, used for labelling.\"\nprops:\n  type: object\n  properties:\n    navbar_id:\n      title: ID\n      description: \"Must start with a letter. Randomly generated if empty.\"\n      type: string\n    toggler_position:\n      title: \"Toggler position\"\n      description: \"Navbar togglers are left-aligned by default, but should they follow a sibling element like a .navbar-brand, they\u2019ll automatically be aligned to the far right. Reversing your markup will reverse the placement of the toggler\"\n      type: string\n      enum:\n        - start\n        - end\n        - none\n      \"meta:enum\":\n        start: Start\n        end: End\n        none: None\n    toggle_action:\n      title: \"Toggle action\"\n      description: \"Transform your expanding and collapsing navbar into an offcanvas drawer with the offcanvas plugin.\"\n      type: string\n      enum:\n        - collapse\n        - offcanvas\n      \"meta:enum\":\n        collapse: \"Collapse (default)\"\n        offcanvas: Offcanvas\n    offcanvas_position:\n      title: \"Offcanvas position\"\n      type: string\n      enum:\n        - start\n        - end\n      \"meta:enum\":\n        start: Start\n        end: \"End (default)\"\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/navbar.component.yml", "type": "yaml_reference", "topic": "navbar.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\ndependencies:\n  module:\n    - responsive_image\n  enforced:\n    module:\n      - responsive_image\nname: max_325x325\nlabel: 'Max 325x325'\neffects:\n  cb842cc8-682f-42a6-bd05-5a1ac726f0d8:\n    uuid: cb842cc8-682f-42a6-bd05-5a1ac726f0d8\n    id: image_scale\n    weight: 1\n    data:\n      width: 325\n      height: 325\n      upscale: false\n  f2b6c795-26ae-4130-aa18-aa120ea3ba98:\n    uuid: f2b6c795-26ae-4130-aa18-aa120ea3ba98\n    id: image_convert_avif\n    weight: 2\n    data:\n      extension: webp\n", "metadata": {"source": "repos/drupal_core/core/profiles/standard/config/optional/image.style.max_325x325.yml", "type": "yaml_reference", "topic": "image.style.max 325x325"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer social auth account verification:\n  title: 'Administer Social Auth Account Verification'\n  description: 'Configure Social Auth Account Verification settings'\n  restrict access: true\n", "metadata": {"source": "repos/social_auth_account_verification/social_auth_account_verification.permissions.yml", "type": "yaml_reference", "topic": "social auth account verification.permissions"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: represents\nSource file: <source_file>\nFile name hint: Graph.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Component\\Graph;\n\n/**\n * Directed acyclic graph manipulation.\n *\n * This class represents a directed acyclic graph (DAG) and provides methods\n * for processing and sorting it.\n *\n * Example of a graph structure:\n * @code\n *   1\u2500\u2500\u2500\u2500\u25ba2\u2500\u2500\u2500\u2500\u25ba3\n *         \u2502     \u2502\n *         \u2502     \u25bc\n *         \u2514\u2500\u2500\u2500\u25ba 4\n * @endcode\n *\n * Example of defining a graph in PHP:\n * @code\n *   $graph[1]['edges'][2] = 1;\n *   $graph[2]['edges'][3] = 1;\n *   $graph[2]['edges'][4] = 1;\n *   $graph[3]['edges'][4] = 1;\n * @endcode\n */\nclass Graph {\n\n  /**\n   * Holds the directed acyclic graph.\n   *\n   * @var array\n   */\n  protected $graph;\n\n  /**\n   * Instantiates the directed acyclic graph object.\n   *\n   * @param array $graph\n   *   A three-dimensional associative array, with the first keys being the\n   *   names of the vertices, which can be strings or numbers. The second key is\n   *   'edges', whose value is an array keyed by the names of the vertices\n   *   connected to it; the values in this array can be simply TRUE or may\n   *   contain other data.\n   */\n  public function __construct($graph) {\n    $this->graph = $graph;\n  }\n\n  /**\n   * Performs a depth-first search and sort on the directed acyclic graph.\n   *\n   * @return array\n   *   The given $graph with more secondary keys filled in:\n   *   - 'paths': Contains a list of vertices than can be reached on a path from\n   *     this vertex.\n   *   - 'reverse_paths': Contains a list of vertices that has a path from them\n   *     to this vertex.\n   *   - 'weight': If there is a path from a vertex to another then the weight\n   *      of the latter is higher.\n   *   - 'component': Vertices in the same component have the same component\n   *     identifier.\n   */\n  public function searchAndSort() {\n    $state = [\n      // The order of last visit of the depth first search. This is the reverse\n      // of the topological order if the graph is acyclic.\n      'last_visit_order' => [],\n      // The components of the graph.\n      'components' => [],\n    ];\n    // Perform the actual search.\n    foreach ($this->graph as $start => $data) {\n      $this->depthFirstSearch($state, $start);\n    }\n\n    // We do such a numbering that every component starts with 0. This is useful\n    // for module installs as we can install every 0 weighted module in one\n    // request, and then every 1 weighted etc.\n    $component_weights = [];\n\n    foreach ($state['last_visit_order'] as $vertex) {\n      $component = $this->graph[$vertex]['component'];\n      if (!isset($component_weights[$component])) {\n        $component_weights[$component] = 0;\n      }\n      $this->graph[$vertex]['weight'] = $component_weights[$component]--;\n    }\n\n    return $this->graph;\n  }\n\n  /**\n   * Performs a depth-first search on a graph.\n   *\n   * @param array $state\n   *   An associative array. The key 'last_visit_order' stores a list of the\n   *   vertices visited. The key components stores list of vertices belonging\n   *   to the same the component.\n   * @param string|int $start\n   *   An arbitrary vertex where we started traversing the graph.\n   * @param string|int|null $component\n   *   The component of the last vertex.\n   *\n   * @see \\Drupal\\Component\\Graph\\Graph::searchAndSort()\n   */\n  protected function depthFirstSearch(&$state, $start, &$component = NULL) {\n    // Assign new component for each new vertex, i.e. when not called\n    // recursively.\n    if (!isset($component)) {\n      $component = $start;\n    }\n    // Nothing to do, if we already visited this vertex.\n    if (isset($this->graph[$start]['paths'])) {\n      return;\n    }\n    // Mark $start as visited.\n    $this->graph[$start]['paths'] = [];\n\n    // Assign $start to the current component.", "output": "<?php\n\nnamespace Drupal\\Component\\Graph;\n\n/**\n * Directed acyclic graph manipulation.\n *\n * This class represents a directed acyclic graph (DAG) and provides methods\n * for processing and sorting it.\n *\n * Example of a graph structure:\n * @code\n *   1\u2500\u2500\u2500\u2500\u25ba2\u2500\u2500\u2500\u2500\u25ba3\n *         \u2502     \u2502\n *         \u2502     \u25bc\n *         \u2514\u2500\u2500\u2500\u25ba 4\n * @endcode\n *\n * Example of defining a graph in PHP:\n * @code\n *   $graph[1]['edges'][2] = 1;\n *   $graph[2]['edges'][3] = 1;\n *   $graph[2]['edges'][4] = 1;\n *   $graph[3]['edges'][4] = 1;\n * @endcode\n */\nclass Graph {\n\n  /**\n   * Holds the directed acyclic graph.\n   *\n   * @var array\n   */\n  protected $graph;\n\n  /**\n   * Instantiates the directed acyclic graph object.\n   *\n   * @param array $graph\n   *   A three-dimensional associative array, with the first keys being the\n   *   names of the vertices, which can be strings or numbers. The second key is\n   *   'edges', whose value is an array keyed by the names of the vertices\n   *   connected to it; the values in this array can be simply TRUE or may\n   *   contain other data.\n   */\n  public function __construct($graph) {\n    $this->graph = $graph;\n  }\n\n  /**\n   * Performs a depth-first search and sort on the directed acyclic graph.\n   *\n   * @return array\n   *   The given $graph with more secondary keys filled in:\n   *   - 'paths': Contains a list of vertices than can be reached on a path from\n   *     this vertex.\n   *   - 'reverse_paths': Contains a list of vertices that has a path from them\n   *     to this vertex.\n   *   - 'weight': If there is a path from a vertex to another then the weight\n   *      of the latter is higher.\n   *   - 'component': Vertices in the same component have the same component\n   *     identifier.\n   */\n  public function searchAndSort() {\n    $state = [\n      // The order of last visit of the depth first search. This is the reverse\n      // of the topological order if the graph is acyclic.\n      'last_visit_order' => [],\n      // The components of the graph.\n      'components' => [],\n    ];\n    // Perform the actual search.\n    foreach ($this->graph as $start => $data) {\n      $this->depthFirstSearch($state, $start);\n    }\n\n    // We do such a numbering that every component starts with 0. This is useful\n    // for module installs as we can install every 0 weighted module in one\n    // request, and then every 1 weighted etc.\n    $component_weights = [];\n\n    foreach ($state['last_visit_order'] as $vertex) {\n      $component = $this->graph[$vertex]['component'];\n      if (!isset($component_weights[$component])) {\n        $component_weights[$component] = 0;\n      }\n      $this->graph[$vertex]['weight'] = $component_weights[$component]--;\n    }\n\n    return $this->graph;\n  }\n\n  /**\n   * Performs a depth-first search on a graph.\n   *\n   * @param array $state\n   *   An associative array. The key 'last_visit_order' stores a list of the\n   *   vertices visited. The key components stores list of vertices belonging\n   *   to the same the component.\n   * @param string|int $start\n   *   An arbitrary vertex where we started traversing the graph.\n   * @param string|int|null $component\n   *   The component of the last vertex.\n   *\n   * @see \\Drupal\\Component\\Graph\\Graph::searchAndSort()\n   */\n  protected function depthFirstSearch(&$state, $start, &$component = NULL) {\n    // Assign new component for each new vertex, i.e. when not called\n    // recursively.\n    if (!isset($component)) {\n      $component = $start;\n    }\n    // Nothing to do, if we already visited this vertex.\n    if (isset($this->graph[$start]['paths'])) {\n      return;\n    }\n    // Mark $start as visited.\n    $this->graph[$start]['paths'] = [];\n\n    // Assign $start to the current component.\n    $this->graph[$start]['component'] = $component;\n    $state['components'][$component][] = $start;\n\n    // Visit edges of $start.\n    if (isset($this->graph[$start]['edges'])) {\n      foreach ($this->graph[$start]['edges'] as $end => $v) {\n        // Mark that $start can reach $end.\n        $this->graph[$start]['paths'][$end] = $v;\n\n        if (isset($this->graph[$end]['component']) && $component != $this->graph[$end]['component']) {\n          // This vertex already has a component, use that from now on and\n          // reassign all the previously explored vertices.\n          $new_component = $this->graph[$end]['component'];\n          foreach ($state['components'][$component] as $vertex) {\n            $this->graph[$vertex]['component'] = $new_component;\n            $state['components'][$new_component][] = $vertex;\n          }\n          unset($state['components'][$component]);\n          $component = $new_component;\n        }\n        // Only visit existing vertices.\n        if (isset($this->graph[$end])) {\n          // Visit the connected vertex.\n          $this->depthFirstSearch($state, $end, $component);\n\n          // All vertices reachable by $end are also reachable by $start.\n          $this->graph[$start]['paths'] += $this->graph[$end]['paths'];\n        }\n      }\n    }\n\n    // Now that any other subgraph has been explored, add $start to all reverse\n    // paths.\n    foreach ($this->graph[$start]['paths'] as $end => $v) {\n      if (isset($this->graph[$end])) {\n        $this->graph[$end]['reverse_paths'][$start] = $v;\n      }\n    }\n\n    // Record the order of the last visit. This is the reverse of the\n    // topological order if the graph is acyclic.\n    $state['last_visit_order'][] = $start;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Graph/Graph.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Graph", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Connecting text editors to text formats'\nrelated:\n  - core.content_structure\n  - field_ui.manage_form\n  - filter.overview\n---\n{% set filter_overview_topic = render_var(help_topic_link('filter.overview')) %}\n{% set overview_link_text %}{% trans %}Text formats and editors{% endtrans %}{% endset %}\n{% set overview_link = render_var(help_route_link(overview_link_text, 'filter.admin_overview')) %}\n<h2>{% trans %}Goal{% endtrans %}</h2>\n<p>{% trans %}Configure a text format so that when a user is editing text and selects this text format, a text editor installed on your site is shown. Configure the text editor, such as choosing which buttons and functions are available. See {{ filter_overview_topic }} for more about text formats.{% endtrans %}</p>\n<h2>{% trans %}What is a text editor?{% endtrans %}</h2>\n<p>{% trans %}A text editor is software (typically, a JavaScript library) that provides buttons and other command mechanisms to make editing HTML text easier. Some editors are called <em>visual</em> or <em>WYSIWYG (What You See Is What You Get)</em> editors; these editors hide the details of HTML from the user, and instead show formatted output on the screen. The core Text Editor module provides a framework for deploying text editors on your site. The core CKEditor 5 module provides CKEditor 5, which is a widely-used JavaScript text editor that creates clean and valid HTML; the module also enforces the HTML tag restrictions in the associated text format. Various contributed modules provide other editors; to install a new editor, besides installing the module, you may need to download the editor library from a third-party site.{% endtrans %}</p>\n<h2>{% trans %}Steps{% endtrans %}</h2>\n<ol>\n  <li>{% trans %}In the <em>Manage</em> administrative menu, navigate to <em>Configuration</em> &gt; <em>Content Authoring</em> &gt; <em>{{ overview_link }}</em>. The <em>Text editor</em> column in the table shows the text editor that is currently connected to each text format, if any.{% endtrans %}</li>\n  <li>{% trans %}Follow the steps on {{ filter_overview_topic }} to add a new text format or configure an existing text format; when you reach the step about text editors, return to this topic.{% endtrans %}</li>\n  <li>{% trans %}Select <em>CKEditor 5</em> as the <em>Text editor</em>, or another text editor that you have installed. The rest of these steps assume you selected <em>CKEditor 5</em>.{% endtrans %}</li>\n  <li>{% trans %}Under <em>Toolbar configuration</em>, drag buttons between <em>Available buttons</em> and <em>Active toolbar</em>; only buttons in <em>Active toolbar</em> will be shown to the user. Focusing or hovering over a button will display a tooltip explaining what the button does.{% endtrans %}</li>\n  <li>{% trans %}Drag buttons within <em>Active toolbar</em> to the desired order, and group buttons by dragging them between group identifiers; drag <em>a new group identifier</em> to the toolbar to add additional groups.{% endtrans %}</li>\n  <li>{% trans %}If you add buttons that require configuration, the <em>CKEditor 5 plugin settings</em> section will be visible, and provide their respective configuration forms. {% endtrans %}</li>\n  <li>{% trans %}Return to {{ filter_overview_topic }} to complete the text format configuration, and be sure to save the text format.{% endtrans %}</li>\n</ol>\n", "metadata": {"source": "repos/drupal_core/core/modules/editor/help_topics/editor.overview.html.twig", "type": "twig_reference"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: RoleStorage.php\nTarget symbol: class for\nNamespace: Drupal\\user\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityStorage\n- Ensure these methods exist where relevant:\n  - isPermissionInRoles()", "output": "<?php\n\nnamespace Drupal\\user;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityStorage;\n\n/**\n * Defines the storage handler class for user roles.\n */\nclass RoleStorage extends ConfigEntityStorage implements RoleStorageInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isPermissionInRoles($permission, array $rids) {\n    foreach ($this->loadMultiple($rids) as $role) {\n      /** @var \\Drupal\\user\\RoleInterface $role */\n      if ($role->hasPermission($permission)) {\n        return TRUE;\n      }\n    }\n\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/RoleStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RoleStorage", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for displaying a single search result.\n *\n * This template renders a single search result. The list of results is\n * rendered using '#theme' => 'item_list', with suggestions of:\n * - item_list__search_results__(plugin_id)\n * - item_list__search_results\n *\n * Available variables:\n * - url: URL of the result.\n * - title: Title of the result.\n * - snippet: A small preview of the result. Does not apply to user searches.\n * - info: String of all the meta information ready for print. Does not apply\n *   to user searches.\n * - plugin_id: The machine-readable name of the plugin being executed,such\n *   as \"node_search\" or \"user_search\".\n * - title_prefix: Additional output populated by modules, intended to be\n *   displayed in front of the main title tag that appears in the template.\n * - title_suffix: Additional output populated by modules, intended to be\n *   displayed after the main title tag that appears in the template.\n * - info_split: Contains same data as info, but split into separate parts.\n *   - info_split.type: Node type (or item type string supplied by module).\n *   - info_split.user: Author of the node linked to users profile. Depends\n *     on permission.\n *   - info_split.date: Last update of the node. Short formatted.\n *   - info_split.comment: Number of comments output as \"% comments\", %\n *     being the count. (Depends on comment.module).\n * @todo The info variable needs to be made drillable and each of these sub\n *   items should instead be within info and renamed info.foo, info.bar, etc.\n *\n * Other variables:\n * - title_attributes: HTML attributes for the title.\n * - content_attributes: HTML attributes for the content.\n *\n * Since info_split is keyed, a direct print of the item is possible.\n * This array does not apply to user searches so it is recommended to check\n * for its existence before printing. The default keys of 'type', 'user' and\n * 'date' always exist for node searches. Modules may provide other data.\n * @code\n *   {% if (info_split.comment) %}\n *     <span class=\"info-comment\">\n *       {{ info_split.comment }}\n *     </span>\n *   {% endif %}\n * @endcode\n *\n * To check for all available data within info_split, use the code below.\n * @code\n *   <pre>\n *     {{ dump(info_split) }}\n *   </pre>\n * @endcode\n *\n * @see \\Drupal\\search\\Hook\\SearchThemeHooks::preprocessSearchResult()\n */\n#}\n{{ attach_library('umami/classy.search-results') }}\n{{ title_prefix }}\n<h3{{ title_attributes.addClass('search-result__title') }}>\n  <a href=\"{{ url }}\">{{ title }}</a>\n</h3>\n{{ title_suffix }}\n<div class=\"search-result__snippet-info\">\n  {% if snippet %}\n    <p{{ content_attributes.addClass('search-result__snippet') }}>{{ snippet }}</p>\n  {% endif %}\n  {% if info %}\n    <p class=\"search-result__info\">{{ info }}</p>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/content/search-result.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class FieldSyncWidget in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\content_translation;\n\nuse Drupal\\Core\\Config\\Entity\\ThirdPartySettingsInterface;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Field Sync Widget for content_translation.\n */\nclass FieldSyncWidget {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly FieldTypePluginManagerInterface $fieldTypePluginManager,\n  ) {}\n\n  /**\n   * Returns a form element to configure field synchronization.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldDefinitionInterface $field\n   *   A field definition object.\n   * @param string $element_name\n   *   (optional) The element name, which is added to drupalSettings so that\n   *   javascript can manipulate the form element.\n   *\n   * @return array\n   *   A form element to configure field synchronization.\n   */\n  public function widget(FieldDefinitionInterface $field, $element_name = 'third_party_settings[content_translation][translation_sync]'): array {\n    // No way to store field sync information on this field.\n    if (!($field instanceof ThirdPartySettingsInterface)) {\n      return [];\n    }\n\n    $element = [];\n    $definition = $this->fieldTypePluginManager->getDefinition($field->getType());\n    $column_groups = $definition['column_groups'];\n    if (!empty($column_groups) && count($column_groups) > 1) {\n      $options = [];\n      $default = [];\n      $require_all_groups_for_translation = [];\n\n      foreach ($column_groups as $group => $info) {\n        $options[$group] = $info['label'];\n        $default[$group] = !empty($info['translatable']) ? $group : FALSE;\n        if (!empty($info['require_all_groups_for_translation'])) {\n          $require_all_groups_for_translation[] = $group;\n        }\n      }\n\n      $default = $field->getThirdPartySetting('content_translation', 'translation_sync', $default);\n\n      $element = [\n        '#type' => 'checkboxes',\n        '#title' => $this->t('Translatable elements'),\n        '#options' => $options,\n        '#default_value' => $default,\n      ];\n\n      if ($require_all_groups_for_translation) {\n        // The actual checkboxes are sometimes rendered separately and the\n        // parent element is ignored. Attach to the first option to ensure that\n        // this does not get lost.\n        $element[key($options)]['#attached']['drupalSettings']['contentTranslationDependentOptions'] = [\n          'dependent_selectors' => [\n            $element_name => $require_all_groups_for_translation,\n          ],\n        ];\n        $element[key($options)]['#attached']['library'][] = 'content_translation/drupal.content_translation.admin';\n      }\n    }\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/src/FieldSyncWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldSyncWidget", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface KeyUsageTrackerInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\n/**\n * Tracks which encryption keys are active and which are referenced.\n */\ninterface KeyUsageTrackerInterface {\n\n  /**\n   * Returns referenced (in-use) encryption key IDs.\n   *\n   * @return array{result: \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[], cacheability: \\Drupal\\Core\\Cache\\CacheableDependencyInterface}\n   *   A set of key pair IDs (array keys), plus cacheability metadata.\n   */\n  public function getReferencedEncryptionKeyIds(): array;\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyUsageTrackerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "KeyUsageTrackerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LoggerChannel in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Logger;\n\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Psr\\Log\\LoggerInterface;\nuse Psr\\Log\\LoggerTrait;\nuse Psr\\Log\\LogLevel;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * Defines a logger channel that most implementations will use.\n */\nclass LoggerChannel implements LoggerChannelInterface {\n  use LoggerTrait;\n\n  /**\n   * Maximum call depth to self::log() for a single log message.\n   *\n   * It's very easy for logging channel code to call out to other library code\n   * that will create log messages. In that case, we will recurse back in to\n   * LoggerChannel::log() multiple times while processing a single originating\n   * message. To prevent infinite recursion, we track the call depth and bail\n   * out at LoggerChannel::MAX_CALL_DEPTH iterations.\n   *\n   * @var int\n   */\n  const MAX_CALL_DEPTH = 5;\n\n  /**\n   * Number of times LoggerChannel::log() has been called for a single message.\n   *\n   * @var int\n   */\n  protected $callDepth = 0;\n\n  /**\n   * The name of the channel of this logger instance.\n   *\n   * @var string\n   */\n  protected $channel;\n\n  /**\n   * Map of PSR3 log constants to RFC 5424 log constants.\n   *\n   * @var array\n   */\n  protected $levelTranslation = [\n    LogLevel::EMERGENCY => RfcLogLevel::EMERGENCY,\n    LogLevel::ALERT => RfcLogLevel::ALERT,\n    LogLevel::CRITICAL => RfcLogLevel::CRITICAL,\n    LogLevel::ERROR => RfcLogLevel::ERROR,\n    LogLevel::WARNING => RfcLogLevel::WARNING,\n    LogLevel::NOTICE => RfcLogLevel::NOTICE,\n    LogLevel::INFO => RfcLogLevel::INFO,\n    LogLevel::DEBUG => RfcLogLevel::DEBUG,\n  ];\n\n  /**\n   * An array of arrays of \\Psr\\Log\\LoggerInterface keyed by priority.\n   *\n   * @var array\n   */\n  protected $loggers = [];\n\n  /**\n   * The request stack object.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   */\n  protected $requestStack;\n\n  /**\n   * The current user object.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $currentUser;\n\n  /**\n   * Constructs a LoggerChannel object.\n   *\n   * @param string $channel\n   *   The channel name for this instance.\n   */\n  public function __construct($channel) {\n    $this->channel = $channel;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function log($level, string|\\Stringable $message, array $context = []): void {\n    if ($this->callDepth == self::MAX_CALL_DEPTH) {\n      return;\n    }\n    $this->callDepth++;\n\n    // Merge in defaults.\n    $context += [\n      'channel' => $this->channel,\n      'link' => '',\n      'uid' => 0,\n      'request_uri' => '',\n      'referer' => '',\n      'ip' => '',\n      'timestamp' => time(),\n    ];\n    // Some context values are only available when in a request context.\n    if ($this->requestStack && $request = $this->requestStack->getCurrentRequest()) {\n      $context['request_uri'] = $request->getUri();\n      $context['referer'] = $request->headers->get('Referer', '');\n      $context['ip'] = $request->getClientIP() ?: '';\n\n      if ($this->currentUser) {\n        $context['uid'] = $this->currentUser->id();\n      }\n    }\n\n    if (is_string($level)) {\n      // Convert to integer equivalent for consistency with RFC 5424.\n      $level = $this->levelTranslation[$level];\n    }\n    // Call all available loggers.\n    foreach ($this->sortLoggers() as $logger) {\n      $logger->log($level, $message, $context);\n    }\n\n    $this->callDepth--;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setRequestStack(?RequestStack $requestStack = NULL) {\n    $this->requestStack = $requestStack;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setCurrentUser(?AccountInterface $current_user = NULL) {\n    $this->currentUser = $current_user;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setLoggers(array $loggers) {\n    $this->loggers = $loggers;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addLogger(LoggerInterface $logger, $priority = 0) {\n    $this->loggers[$priority][] = $logger;\n  }\n\n  /**\n   * Sorts loggers according to priority.\n   *\n   * @return array\n   *   An array of sorted loggers by priority.\n   */\n  protected function sortLoggers() {\n    krsort($this->loggers);\n    return array_merge(...$this->loggers);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Logger/LoggerChannel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LoggerChannel", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: ConfigurableImageEffectInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\image;\n\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Defines the interface for configurable image effects.\n *\n * @see \\Drupal\\image\\Annotation\\ImageEffect\n * @see \\Drupal\\image\\ConfigurableImageEffectBase\n * @see \\Drupal\\image\\ImageEffectInterface\n * @see \\Drupal\\image\\ImageEffectBase\n * @see \\Drupal\\image\\ImageEffectManager\n * @see plugin_api\n */\ninterface ConfigurableImageEffectInterface extends ImageEffectInterface, PluginFormInterface {\n}", "output": "<?php\n\nnamespace Drupal\\image;\n\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Defines the interface for configurable image effects.\n *\n * @see \\Drupal\\image\\Annotation\\ImageEffect\n * @see \\Drupal\\image\\ConfigurableImageEffectBase\n * @see \\Drupal\\image\\ImageEffectInterface\n * @see \\Drupal\\image\\ImageEffectBase\n * @see \\Drupal\\image\\ImageEffectManager\n * @see plugin_api\n */\ninterface ConfigurableImageEffectInterface extends ImageEffectInterface, PluginFormInterface {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/src/ConfigurableImageEffectInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfigurableImageEffectInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: UrlAlias\nSource file: <source_file>\nFile name hint: UrlAlias.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\path\\Plugin\\migrate\\source\\d6;\n\nuse Drupal\\path\\Plugin\\migrate\\source\\UrlAliasBase;\n\n/**\n * Drupal 6 URL aliases source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d6_url_alias\",\n *   source_module = \"path\"\n * )\n */\nclass UrlAlias extends UrlAliasBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function fields() {\n    $fields = parent::fields();\n    $fields['src'] = $this->t('The internal system path.');\n    $fields['dst'] = $this->t('The path alias.');\n    return $fields;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\path\\Plugin\\migrate\\source\\d6;\n\nuse Drupal\\path\\Plugin\\migrate\\source\\UrlAliasBase;\n\n/**\n * Drupal 6 URL aliases source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d6_url_alias\",\n *   source_module = \"path\"\n * )\n */\nclass UrlAlias extends UrlAliasBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = parent::fields();\n    $fields['src'] = $this->t('The internal system path.');\n    $fields['dst'] = $this->t('The path alias.');\n    return $fields;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path/src/Plugin/migrate/source/d6/UrlAlias.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UrlAlias", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DevelopmentSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\DrupalKernelInterface;\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configure development settings for this site.\n *\n * @internal\n */\nclass DevelopmentSettingsForm extends FormBase {\n\n  /**\n   * Constructs a new development settings form.\n   *\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface $keyValueFactory\n   *   The key value factory.\n   * @param \\Drupal\\Core\\DrupalKernelInterface $kernel\n   *   The Drupal kernel.\n   */\n  public function __construct(\n    protected KeyValueFactoryInterface $keyValueFactory,\n    protected DrupalKernelInterface $kernel,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    $instance = new static(\n      $container->get('keyvalue'),\n      $container->get('kernel')\n    );\n    $instance->setMessenger($container->get('messenger'));\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'development_settings_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $development_settings = $this->keyValueFactory->get('development_settings');\n    $form['description'] = [\n      '#plain_text' => $this->t('These settings should only be enabled on development environments and never on production.'),\n    ];\n\n    $twig_debug = $development_settings->get('twig_debug', FALSE);\n    $twig_cache_disable = $development_settings->get('twig_cache_disable', FALSE);\n    $twig_development_state_conditions = [\n      'input[data-drupal-selector=\"edit-twig-development-mode\"]' => [\n        'checked' => TRUE,\n      ],\n    ];\n\n    $form['disable_rendered_output_cache_bins'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Do not cache markup'),\n      '#description' => $this->t('Disables render cache, dynamic page cache, and page cache.'),\n      '#default_value' => $development_settings->get('disable_rendered_output_cache_bins', FALSE),\n    ];\n\n    $form['twig_development_mode'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Twig development mode'),\n      '#description' => $this->t('Exposes Twig development settings.'),\n      '#default_value' => $twig_debug || $twig_cache_disable,\n    ];\n    $form['twig_development'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Twig development mode'),\n      '#states' => [\n        'visible' => $twig_development_state_conditions,\n      ],\n    ];\n    $form['twig_development']['twig_debug'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Twig debug mode'),\n      '#description' => $this->t(\"Provides Twig's <code>dump()</code> function for debugging, outputs template suggestions to HTML comments, and automatically recompile Twig templates after changes.\"),\n      '#default_value' => $twig_debug,\n    ];\n    $form['twig_development']['twig_cache_disable'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Disable Twig cache'),\n      '#description' => $this->t('Twig templates are not cached and are always compiled when rendered.'),\n      '#default_value' => $twig_cache_disable,\n    ];\n    if (!$twig_debug && !$twig_cache_disable) {\n      $form['twig_development']['twig_debug']['#states'] = [\n        'checked' => $twig_development_state_conditions,\n      ];\n      $form['twig_development']['twig_cache_disable']['#states'] = [\n        'checked' => $twig_development_state_conditions,\n      ];\n    }\n\n    $form['actions']['#type'] = 'actions';\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Save settings'),\n      '#button_type' => 'primary',\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $development_settings = $this->keyValueFactory->get('development_settings');\n    $disable_rendered_output_cache_bins_previous = $development_settings->get('disable_rendered_output_cache_bins', FALSE);\n    $disable_rendered_output_cache_bins = (bool) $form_state->getValue('disable_rendered_output_cache_bins');\n    if ($disable_rendered_output_cache_bins) {\n      $development_settings->set('disable_rendered_output_cache_bins', TRUE);\n    }\n    else {\n      $development_settings->delete('disable_rendered_output_cache_bins');\n    }\n\n    $twig_development_mode = (bool) $form_state->getValue('twig_development_mode');\n    $twig_development_previous = $development_settings->getMultiple(['twig_debug', 'twig_cache_disable']);\n    $twig_development = [\n      'twig_debug' => (bool) $form_state->getValue('twig_debug'),\n      'twig_cache_disable' => (bool) $form_state->getValue('twig_cache_disable'),\n    ];\n    if ($twig_development_mode) {\n      $invalidate_container = $twig_development_previous !== $twig_development;\n      $development_settings->setMultiple($twig_development);\n    }\n    else {\n      $invalidate_container = TRUE;\n      $development_settings->deleteMultiple(array_keys($twig_development));\n    }\n\n    if ($invalidate_container || $disable_rendered_output_cache_bins_previous !== $disable_rendered_output_cache_bins) {\n      $this->kernel->invalidateContainer();\n    }\n\n    $this->messenger()->addStatus($this->t('The settings have been saved.'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/DevelopmentSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DevelopmentSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface FieldConfigInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\field;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\n\n/**\n * Provides an interface defining a field entity.\n */\ninterface FieldConfigInterface extends ConfigEntityInterface, FieldDefinitionInterface {\n\n  /**\n   * Gets the deleted flag of the field.\n   *\n   * @return bool\n   *   Returns TRUE if the field is deleted.\n   */\n  public function isDeleted();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/field/src/FieldConfigInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FieldConfigInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a views UI preview section.\n *\n * Available variables:\n * - title: The human readable section title.\n * - links: A list of contextual links.\n * - content: The content for this section preview.\n *\n * @see template_preprocess_views_ui_view_preview_section()\n *\n * @ingroup themeable\n */\n#}\n<h1 class=\"section-title\">{{ title }}</h1>\n{% if links %}\n  <div class=\"contextual\">{{ links }}</div>\n{% endif %}\n<div class=\"views-exposed-form views-exposed-form--preview\">\n  {{ content }}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/themes/claro/templates/views/views-ui-view-preview-section--exposed.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class FormElementHelper in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Form;\n\nuse Drupal\\Core\\Render\\Element;\n\n/**\n * Provides common functionality for form elements.\n */\nclass FormElementHelper {\n\n  /**\n   * Retrieves a form element.\n   *\n   * @param string $name\n   *   The name of the form element. If the #parents property of your form\n   *   element is ['foo', 'bar', 'baz'] then the name is 'foo][bar][baz'.\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   *\n   * @return array\n   *   The form element.\n   */\n  public static function getElementByName($name, array $form) {\n    foreach (Element::children($form) as $key) {\n      if (implode('][', $form[$key]['#parents']) === $name) {\n        return $form[$key];\n      }\n      elseif ($element = static::getElementByName($name, $form[$key])) {\n        return $element;\n      }\n    }\n    return [];\n  }\n\n  /**\n   * Returns the title for the element.\n   *\n   * If the element has no title, this will recurse through all children of the\n   * element until a title is found.\n   *\n   * @param array $element\n   *   An associative array containing the properties of the form element.\n   *\n   * @return string\n   *   The title of the element, or an empty string if none is found.\n   */\n  public static function getElementTitle(array $element) {\n    $title = '';\n    if (isset($element['#title'])) {\n      $title = $element['#title'];\n    }\n    else {\n      foreach (Element::children($element) as $key) {\n        if ($title = static::getElementTitle($element[$key])) {\n          break;\n        }\n      }\n    }\n    return $title;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Form/FormElementHelper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FormElementHelper", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DatabaseCacheTagsChecksum in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Cache;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Database\\DatabaseException;\n\n/**\n * Cache tags invalidations checksum implementation that uses the database.\n */\nclass DatabaseCacheTagsChecksum implements CacheTagsChecksumInterface, CacheTagsInvalidatorInterface, CacheTagsChecksumPreloadInterface, CacheTagsPurgeInterface {\n\n  use CacheTagsChecksumTrait;\n\n  /**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $connection;\n\n  /**\n   * Constructs a DatabaseCacheTagsChecksum object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection.\n   */\n  public function __construct(Connection $connection) {\n    $this->connection = $connection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doInvalidateTags(array $tags) {\n    try {\n      foreach ($tags as $tag) {\n        $this->connection->merge('cachetags')\n          ->insertFields(['invalidations' => 1])\n          ->expression('invalidations', '[invalidations] + 1')\n          ->key('tag', $tag)\n          ->execute();\n      }\n    }\n    catch (\\Exception $e) {\n      // Create the cache table, which will be empty. This fixes cases during\n      // core install where cache tags are invalidated before the table is\n      // created.\n      if (!$this->ensureTableExists()) {\n        throw $e;\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getTagInvalidationCounts(array $tags) {\n    try {\n      return $this->connection->query('SELECT [tag], [invalidations] FROM {cachetags} WHERE [tag] IN ( :tags[] )', [':tags[]' => $tags])\n        ->fetchAllKeyed();\n    }\n    catch (\\Exception $e) {\n      // If the table does not exist yet, create.\n      if (!$this->ensureTableExists()) {\n        throw $e;\n      }\n    }\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function purge(): void {\n    try {\n      $this->connection->truncate('cachetags')->execute();\n    }\n    catch (\\Throwable $e) {\n      // If the table does not exist yet, there is nothing to purge.\n      if (!$this->ensureTableExists()) {\n        throw $e;\n      }\n    }\n    $this->reset();\n  }\n\n  /**\n   * Check if the cache tags table exists and create it if not.\n   */\n  protected function ensureTableExists() {\n    try {\n      $database_schema = $this->connection->schema();\n      $schema_definition = $this->schemaDefinition();\n      $database_schema->createTable('cachetags', $schema_definition);\n    }\n    // If another process has already created the cachetags table, attempting to\n    // recreate it will throw an exception. In this case just catch the\n    // exception and do nothing.\n    catch (DatabaseException) {\n    }\n    catch (\\Exception) {\n      return FALSE;\n    }\n    return TRUE;\n  }\n\n  /**\n   * Defines the schema for the {cachetags} table.\n   *\n   * @internal\n   */\n  public function schemaDefinition() {\n    $schema = [\n      'description' => 'Cache table for tracking cache tag invalidations.',\n      'fields' => [\n        'tag' => [\n          'description' => 'Namespace-prefixed tag string.',\n          'type' => 'varchar_ascii',\n          'length' => 255,\n          'not null' => TRUE,\n          'default' => '',\n        ],\n        'invalidations' => [\n          'description' => 'Number incremented when the tag is invalidated.',\n          'type' => 'int',\n          'not null' => TRUE,\n          'default' => 0,\n        ],\n      ],\n      'primary key' => ['tag'],\n    ];\n    return $schema;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDatabaseConnection() {\n    return $this->connection;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/DatabaseCacheTagsChecksum.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatabaseCacheTagsChecksum", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "field.formatter.settings.oembed_formatter_plus:\n  type: mapping\n  label: 'oEmbed display format settings'\n  mapping:\n    max_width:\n      type: integer\n      label: 'Maximum width'\n    max_height:\n      type: integer\n      label: 'Maximum height'\n    trusted_providers:\n      type: string\n      label: 'A semi-colon delimited list of oEmbed Providers to trust. When a provider is in the list and the html returned in the oembed result has an iframe as the outermost element, an outer iframe is not added. (@see: https://oembed.com/#section3)'\n    include_inner_iframe_title:\n      type: boolean\n      label: 'Include the title from the inner iframe as part of the outer iframe title'\n    outer_iframe_title:\n      type: string\n      label: \"Text to prepend to the outer iframe title when 'Include inner iframe title' is enabled and used as the title when it's disabled\"\n    loading:\n      type: mapping\n      label: 'oEmbed loading settings'\n      mapping:\n        attribute:\n          type: string\n          label: 'Loading attribute'\n", "metadata": {"source": "repos/oembed_formatter_plus/config/schema/oembed_formatter_plus.schema.yml", "type": "yaml_reference", "topic": "oembed formatter plus.schema"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Handle user input with care", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [The Drupal philosophy - Escape or filter when appropriate](/docs/develop/security/handle-user-input-with-care#s-the-drupal-philosophy-escape-or-filter-when-appropriate)\n\n## [Security](/docs/develop/security)\n\n* [Handle user input with care](/docs/develop/security/handle-user-input-with-care)\n* [Why does Drupal filter on output?](/docs/develop/security/why-does-drupal-filter-on-output)\n* [HMAC best practices](/docs/develop/security/hmac-best-practices)\n* [Information disclosure in error messages not a weakness (Path disclosure, SQL error messages, etc.)](/docs/develop/security/information-disclosure-in-error-messages-not-a-weakness-path-disclosure-sql)\n* [Your Drupal site got hacked. Now what?](/docs/develop/security/your-drupal-site-got-hacked-now-what)\n\n# Handle user input with care\n\nLast [updated](/node/101495/discuss) on\n\n17 December 2025\n\nThis documentation **needs work**. See \"Help improve this page\" in the sidebar.\n\nInput, whether it comes from visitors or servers, should be handled with care.\n\nConsider the following example, modified from W. J. Gilmore's *[A Programmer's Introduction to PHP 4.0](http://www.apress.com/book/view/1893115852)*. It takes an argument supplied by the user and stuffs it into a query.\n\n```\n/** Example 1 - Insecure\n  * SQL injection via $keyword\n  */\n$keyword = $_REQUEST['keyword'];\n$query = \"SELECT cust_id, cust_name, cust_email FROM customers WHERE category = '$keyword'\";\n$result = db_query($query);\n```\n\nThis enables the user to inject SQL statements into the query. What would happen if a visitor used the keyword `'; DROP TABLE customers; --`? The query would be:\n\n`SELECT cust_id, cust_name, cust_email FROM customers WHERE category = ''; DROP TABLE customers; --'`\n\n## The Drupal philosophy - Escape or filter when appropriate\n\nYou may have found the following expert advice in text dealing with security problems: always validate input. The problem with a content management system like Drupal is that the input is not well defined. A lot of senseless advice is available too. One sometimes encounters recommendations to strip quotes from for example name fields (') to prevent SQL injection. Let's hope none of the users of such a system have the name O'Reilly.\n\nAnother frequently touted 'solution' is filtering on keywords. To prevent SQL injection one would prohibit SQL keywords as SELECT or DROP in content. Unfortunately, no user would be able to mention 'insert', 'select' and 'update', not uncommon in normal English. To make matters worse, Dutch users wouldn't be able to mention licorice (drop) anymore. Obviously not a very generic (or even sane) approach.\n\nSo what we really have to do is make sure that, regardless of the data, **its content can never be interpreted as SQL**. To do this, we use the escaping functions provided by the database API. We do this escaping in the database layer and not directly after receiving input as it may not be the only escaping (or filtering) we have to do.\n\n```\n/** Example 2 - Insecure\n  * SQL injection via $keyword\n  * XSS via $keyword and (possibly) $row->cust_name, $row->cust_email\n  */\n$keyword = $_REQUEST['keyword'];\n$query = \"SELECT cust_id, cust_name, cust_email FROM customers WHERE category = '$keyword'\";\n$result = db_query($query);\necho \"$keyword\";\n\nwhile ($row = db_fetch_object($result)) {\n echo \"$row->cust_name, $row->cust_email\";\n}\n```\n\nExample 2 \u2014 though small, riddled with vulnerabilities \u2014 demonstrates the issue with input filtering escaping; the `$keyword` has to be filtered or escaped twice for different purposes: Once to prevent SQL injection and once more to prevent cross site scripting (XSS) attacks. Applying both filters directly to the input `$keyword` would result in extraneous slashes showing up in output, or failed search attempted with &quot; in them.\n\nThe solution is to **use an appropriate filter when needed**. For example, just before sending plain text to the browser or mixing plain text with HTML, escape it with [check\\_plain](http://api.drupal.org/apis/check_plain \"check_plain API documentation\").\n\n```\n/** Example 2 - corrected\n  */\n$keyword = $_REQUEST['keyword'];\n$query = \"SELECT cust_id, cust_name, cust_email FROM customers WHERE category = '%s'\";\n$result = db_query($query, $keyword);\necho ''. check_plain($keyword) .'':\n\nwhile ($row = db_fetch_object($result)) {\n// Not very elegant, but making a point.\necho check_plain($row->cust_name) .','. check_plain($row->cust_email) .'';\n}\n```\n\n##\n\n## Help improve this page\n\n**Page status:**  Needs work\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/101495/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%28101495%29%20Handle%20user%20input%20with%20care) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/security/handle-user-input-with-care.md", "type": "doc_summary", "topic": "Handle user input with care"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  serialization.skip_procedural_hook_scan: true\n\nservices:\n  _defaults:\n    autoconfigure: true\n  serializer:\n    class: Drupal\\serialization\\Serializer\\Serializer\n    arguments: [{  }, {  }]\n  serializer.normalizer.config_entity:\n    class: Drupal\\serialization\\Normalizer\\ConfigEntityNormalizer\n    tags:\n      - { name: normalizer }\n    arguments: ['@entity_type.manager', '@entity_type.repository', '@entity_field.manager']\n  serializer.normalizer.content_entity:\n    class: Drupal\\serialization\\Normalizer\\ContentEntityNormalizer\n    tags:\n      - { name: normalizer }\n    arguments: ['@entity_type.manager', '@entity_type.repository', '@entity_field.manager']\n  serializer.normalizer.entity:\n    class: Drupal\\serialization\\Normalizer\\EntityNormalizer\n    tags:\n      - { name: normalizer }\n    arguments: ['@entity_type.manager', '@entity_type.repository', '@entity_field.manager']\n  serializer.normalizer.primitive_data:\n    class: Drupal\\serialization\\Normalizer\\PrimitiveDataNormalizer\n    tags:\n      - { name: normalizer, priority: 5 }\n  serializer.normalizer.complex_data:\n    class: Drupal\\serialization\\Normalizer\\ComplexDataNormalizer\n    tags:\n      - { name: normalizer }\n  serializer.normalizer.entity_reference_field_item:\n    class: Drupal\\serialization\\Normalizer\\EntityReferenceFieldItemNormalizer\n    tags:\n      # Set the priority lower than the hal entity reference field item\n      # normalizer, so that we do not replace that for hal_json but higher than\n      # this modules generic field item normalizer.\n      # @todo Find a better way for this in https://www.drupal.org/node/2575761.\n      - { name: normalizer, priority: 8 }\n    arguments: ['@entity.repository']\n  serialization.normalizer.field_item:\n    class: Drupal\\serialization\\Normalizer\\FieldItemNormalizer\n    tags:\n      # Priority must be lower than serializer.normalizer.field_item.hal and any\n      # field type specific normalizer such as\n      # serializer.normalizer.entity_reference_field_item.\n      - { name: normalizer, priority: 6 }\n  serialization.normalizer.field:\n    class: Drupal\\serialization\\Normalizer\\FieldNormalizer\n    tags:\n      # Priority must be lower than serializer.normalizer.field.hal.\n      - { name: normalizer, priority: 6 }\n  serializer.normalizer.list:\n    class: Drupal\\serialization\\Normalizer\\ListNormalizer\n    tags:\n      # Priority must be higher than serialization.normalizer.field but less\n      # than hal field normalizer.\n      - { name: normalizer, priority: 9 }\n  serializer.normalizer.timestamp_item:\n    class: Drupal\\serialization\\Normalizer\\TimestampItemNormalizer\n    tags:\n      # Priority must be higher than serializer.normalizer.field_item and lower\n      # than hal normalizers.\n      - { name: normalizer, priority: 8 }\n  serializer.normalizer.timestamp:\n    class: Drupal\\serialization\\Normalizer\\TimestampNormalizer\n    arguments: ['@config.factory']\n    tags:\n      # Priority must be higher than serializer.normalizer.primitive_data.\n      - { name: normalizer, priority: 20 }\n  serializer.normalizer.datetimeiso8601:\n    class: \\Drupal\\serialization\\Normalizer\\DateTimeIso8601Normalizer\n    arguments: ['@config.factory']\n    tags:\n      # Priority must be higher than serializer.normalizer.primitive_data.\n      - { name: normalizer, priority: 20 }\n  serializer.normalizer.password_field_item:\n    class: Drupal\\serialization\\Normalizer\\NullNormalizer\n    arguments: ['Drupal\\Core\\Field\\Plugin\\Field\\FieldType\\PasswordItem']\n    tags:\n      - { name: normalizer, priority: 20 }\n  serializer.normalizer.safe_string:\n    class: Drupal\\serialization\\Normalizer\\MarkupNormalizer\n    tags:\n      - { name: normalizer }\n  serializer.normalizer.typed_data:\n    class: Drupal\\serialization\\Normalizer\\TypedDataNormalizer\n    tags:\n      - { name: normalizer }\n  serializer.encoder.json:\n    class: Drupal\\serialization\\Encoder\\JsonEncoder\n    tags:\n      - { name: encoder, format: json }\n  serializer.encoder.xml:\n    class: Drupal\\serialization\\Encoder\\XmlEncoder\n    tags:\n      - { name: encoder, format: xml }\n  serializer.entity_resolver:\n    class: Drupal\\serialization\\EntityResolver\\ChainEntityResolver\n  Drupal\\serialization\\EntityResolver\\ChainEntityResolverInterface: '@serializer.entity_resolver'\n  serializer.entity_resolver.uuid:\n    class: Drupal\\serialization\\EntityResolver\\UuidResolver\n    tags:\n      - { name: entity_resolver}\n    arguments: ['@entity.repository']\n  serialization.entity_resolver.target_id:\n    class: Drupal\\serialization\\EntityResolver\\TargetIdResolver\n    tags:\n      - { name: entity_resolver}\n  serialization.exception.default:\n    class: Drupal\\serialization\\EventSubscriber\\DefaultExceptionSubscriber\n    arguments: ['@serializer', '%serializer.formats%']\n  serialization.user_route_alter_subscriber:\n    class: Drupal\\serialization\\EventSubscriber\\UserRouteAlterSubscriber\n    arguments: ['%serializer.formats%']\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/serialization.services.yml", "type": "yaml_reference", "topic": "serialization.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'MCP Tools - Webform'\ntype: module\ndescription: 'Webform management: list, create, update, delete webforms and manage submissions.'\npackage: MCP Tools\ncore_version_requirement: ^10.3 || ^11\ndependencies:\n  - mcp_tools:mcp_tools\n  - webform:webform\nlifecycle: experimental\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/mcp_tools_webform.info.yml", "type": "yaml_reference", "topic": "mcp tools webform.info"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Making your site secure'\ntop_level: true\n---\n<h2>{% trans %}What are security updates?{% endtrans %}</h2>\n<p>{% trans %}Any software occasionally has bugs, and sometimes these bugs have security implications. When security bugs are fixed in the core software, modules, or themes that your site uses, they are released in a <em>security update</em>. You will need to apply security updates in order to keep your site secure.{% endtrans %}</p>\n<h2>{% trans %}What are security advisories?{% endtrans %}</h2>\n<p>{% trans %}A security advisory is a public announcement about a reported security problem in the core software. Contributed projects with a shield icon and \"Stable releases for this project are covered by the security advisory policy\" on their project page are also covered by Drupal's security advisory policy. Security advisories are managed by the <a href=\"https://www.drupal.org/drupal-security-team\">Drupal Security Team</a>.{% endtrans %}</p>\n<h2>{% trans %}Security tasks{% endtrans %}</h2>\n<p>{% trans %}Keeping track of updates, updating the core software, and updating contributed modules and/or themes are all part of keeping your site secure. See the related topics listed below for specific tasks.{% endtrans %}</p>\n<h2>{% trans %}Additional resources{% endtrans %}</h2>\n<ul>\n    <li>{% trans %}<a href=\"https://www.drupal.org/docs/user_guide/en/security-chapter.html\">Security and Maintenance (Drupal User Guide)</a>{% endtrans %}</li>\n  <li>{% trans %}<a href=\"https://www.drupal.org/drupal-security-team/security-advisory-process-and-permissions-policy\">Security advisory process and permissions policy</a>{% endtrans %}</li>\n</ul>\n", "metadata": {"source": "repos/drupal_core/core/modules/help/help_topics/core.security.html.twig", "type": "twig_reference"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for a 3x3 grid of checkboxes for image anchors.\n *\n * Available variables:\n * - table: HTML for the table of image anchors.\n *\n * @see \\Drupal\\image\\Hook\\ImageThemeHooks::preprocessImageAnchor()\n *\n * @ingroup themeable\n */\n#}\n{{ table }}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/templates/image-anchor.html.twig", "type": "twig_reference"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: StringItemBase.php\nTarget symbol: class for\nNamespace: Drupal\\Core\\Field\\Plugin\\Field\\FieldType\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Field\\FieldItemBase\n  - Drupal\\Core\\Field\\FieldStorageDefinitionInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\TypedData\\DataDefinition\n- Ensure these methods exist where relevant:\n  - defaultStorageSettings()\n  - isEmpty()\n  - propertyDefinitions()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldType;\n\nuse Drupal\\Core\\Field\\FieldItemBase;\nuse Drupal\\Core\\Field\\FieldStorageDefinitionInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\TypedData\\DataDefinition;\n\n/**\n * Base class for string field types.\n */\nabstract class StringItemBase extends FieldItemBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultStorageSettings() {\n    return [\n      'case_sensitive' => FALSE,\n    ] + parent::defaultStorageSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function propertyDefinitions(FieldStorageDefinitionInterface $field_definition) {\n    $properties['value'] = DataDefinition::create('string')\n      ->setLabel(new TranslatableMarkup('Text value'))\n      ->setSetting('case_sensitive', $field_definition->getSetting('case_sensitive'))\n      ->setRequired(TRUE);\n\n    return $properties;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isEmpty() {\n    $value = $this->get('value')->getValue();\n    return $value === NULL || $value === '';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldType/StringItemBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StringItemBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ListLayoutPlugins in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_layout_builder\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_layout_builder\\Service\\LayoutBuilderService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_layout_list_plugins',\n  label: new TranslatableMarkup('List Layout Plugins'),\n  description: new TranslatableMarkup('List available layout plugins (one-column, two-column, etc.).'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'layouts' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Available Layouts'),\n      description: new TranslatableMarkup(''),\n    ),\n    'count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Count'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListLayoutPlugins extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'layout_builder';\n\n\n  protected LayoutBuilderService $layoutBuilderService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->layoutBuilderService = $container->get('mcp_tools_layout_builder.layout_builder');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    return $this->layoutBuilderService->listLayoutPlugins();\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_layout_builder/src/Plugin/tool/Tool/ListLayoutPlugins.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListLayoutPlugins", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CronHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\flowdrop_trigger\\Service\\TriggerManager;\n\n/**\n * Implements cron hooks for FlowDrop ecosystem.\n *\n * Fires cron-based workflow triggers when Drupal's cron runs.\n * This allows workflows to be scheduled for periodic execution.\n */\nclass CronHooks {\n\n  /**\n   * Constructs a new CronHooks object.\n   *\n   * @param \\Drupal\\flowdrop_trigger\\Service\\TriggerManager $triggerManager\n   *   The trigger manager service.\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state service for tracking last cron run.\n   */\n  public function __construct(\n    protected readonly TriggerManager $triggerManager,\n    protected readonly StateInterface $state,\n  ) {}\n\n  /**\n   * Implements hook_cron().\n   *\n   * Fires the cron.run event to trigger any workflows configured\n   * for cron-based execution.\n   */\n  #[Hook('cron')]\n  public function cron(): void {\n    // Get the last cron run timestamp for context.\n    $lastRun = $this->state->get(\"flowdrop_trigger.last_cron_run\", 0);\n\n    // Build context with cron-specific information.\n    $context = [\n      \"last_run\" => $lastRun,\n      \"cron_key\" => NULL,\n    ];\n\n    // Process the cron event.\n    $this->triggerManager->processCronEvent(\"cron.run\", $context);\n\n    // Update the global last cron run timestamp.\n    $this->state->set(\"flowdrop_trigger.last_cron_run\", time());\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Hook/CronHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CronHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  seo_audit.crawler_queue_worker:\n    class: Drupal\\seo_audit\\Queue\\CrawlerQueueWorker\n    arguments: ['@queue']\n    tags:\n      - { name: 'queue_worker', queue_name: 'seo_audit_crawl_queue' }\n\n  seo_audit.breadcrumb_analyzer:\n    class: Drupal\\seo_audit\\BreadcrumbAnalyzer\n    arguments: []\n", "metadata": {"source": "repos/seo_audit/seo_audit.services.yml", "type": "yaml_reference", "topic": "seo audit.services"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DeleteImageStyle\nSource file: <source_file>\nFile name hint: DeleteImageStyle.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_image_styles\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_image_styles\\Service\\ImageStyleService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_image_styles_delete',\n  label: new TranslatableMarkup('Delete Image Style'),\n  description: new TranslatableMarkup('Delete an image style. Use force=true to delete even if in use.'),\n  operation: ToolOperation::Write,\n  destructive: TRUE,\n  input_definitions: [\n    'style_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Style ID'),\n      description: new TranslatableMarkup('The machine name of the image style to delete.'),\n      required: TRUE,\n    ),\n    'force' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Force'),\n      description: new TranslatableMarkup('Delete even if the style is in use.'),\n      required: FALSE,\n      default_value: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DeleteImageStyle extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'image_styles';\n\n\n  protected ImageStyleService $imageStyleService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->imageStyleService = $container->get('mcp_tools_image_styles.image_style_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access.\n    $accessCheck = $this->accessManager->checkWriteAccess('delete', 'image_style');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $styleId = $input['style_id'] ?? '';\n    $force = !empty($input['force']);\n\n    if (empty($styleId)) {\n      return [\n        'success' => FALSE,\n        'error' => 'style_id is required.',\n      ];\n    }\n\n    $result = $this->imageStyleService->deleteImageStyle($styleId, $force);\n\n    if ($result['success']) {\n      $this->auditLogger->log('delete', 'image_style', $styleId, [\n        'force' => $force,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_image_styles\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_image_styles\\Service\\ImageStyleService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_image_styles_delete',\n  label: new TranslatableMarkup('Delete Image Style'),\n  description: new TranslatableMarkup('Delete an image style. Use force=true to delete even if in use.'),\n  operation: ToolOperation::Write,\n  destructive: TRUE,\n  input_definitions: [\n    'style_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Style ID'),\n      description: new TranslatableMarkup('The machine name of the image style to delete.'),\n      required: TRUE,\n    ),\n    'force' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Force'),\n      description: new TranslatableMarkup('Delete even if the style is in use.'),\n      required: FALSE,\n      default_value: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DeleteImageStyle extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'image_styles';\n\n\n  protected ImageStyleService $imageStyleService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->imageStyleService = $container->get('mcp_tools_image_styles.image_style_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access.\n    $accessCheck = $this->accessManager->checkWriteAccess('delete', 'image_style');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $styleId = $input['style_id'] ?? '';\n    $force = !empty($input['force']);\n\n    if (empty($styleId)) {\n      return [\n        'success' => FALSE,\n        'error' => 'style_id is required.',\n      ];\n    }\n\n    $result = $this->imageStyleService->deleteImageStyle($styleId, $force);\n\n    if ($result['success']) {\n      $this->auditLogger->log('delete', 'image_style', $styleId, [\n        'force' => $force,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_image_styles/src/Plugin/tool/Tool/DeleteImageStyle.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteImageStyle", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class LayoutBuilderRestriction in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\layout_builder_restrictions\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a Layout Builder Restriction attribute for plugin discovery.\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass LayoutBuilderRestriction extends Plugin {\n\n  /**\n   * Constructs a LayoutBuilderRestriction attribute.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $title\n   *   The human-readable name of the restriction plugin.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $description\n   *   The human-readable description of the restriction plugin.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly TranslatableMarkup $title,\n    public readonly TranslatableMarkup $description\n  ) {\n  }\n}\n", "metadata": {"source": "repos/layout_builder_restrictions/src/Attribute/LayoutBuilderRestriction.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderRestriction", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ProtectionRule.php\nTarget symbol: class ProtectionRule\nNamespace: Drupal\\db_wipe_entity\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ProtectionRule.\n- Include required imports:\n  - Drupal\\Component\\Annotation\\Plugin", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a Protection Rule plugin annotation object.\n *\n * Plugin Namespace: Plugin\\ProtectionRule.\n *\n * @see \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginManager\n * @see plugin_api\n *\n * @Annotation\n */\nclass ProtectionRule extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public string $id;\n\n  /**\n   * The human-readable name of the plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * The description of the plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $description;\n\n  /**\n   * The category of the plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $category;\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Annotation/ProtectionRule.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProtectionRule", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class TopLevelBook in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Plugin\\views\\argument_default;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\node\\NodeStorageInterface;\nuse Drupal\\node\\Plugin\\views\\argument_default\\Node;\nuse Drupal\\views\\Attribute\\ViewsArgumentDefault;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Default argument plugin to get the current node's top level book.\n */\n#[ViewsArgumentDefault(\n  id: 'top_level_book',\n  title: new TranslatableMarkup('Top Level Book from current node\"'),\n)]\nclass TopLevelBook extends Node {\n\n  /**\n   * Constructs a Drupal\\book\\Plugin\\views\\argument_default\\TopLevelBook object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   * @param \\Drupal\\node\\NodeStorageInterface $nodeStorage\n   *   The node storage controller.\n   */\n  public function __construct(array $configuration, $plugin_id, array $plugin_definition, RouteMatchInterface $route_match, protected NodeStorageInterface $nodeStorage) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $route_match);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('current_route_match'),\n      $container->get('entity_type.manager')->getStorage('node')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getArgument() {\n    // Use the argument_default_node plugin to get the nid argument.\n    $nid = parent::getArgument();\n    if (!empty($nid)) {\n      $node = $this->nodeStorage->load($nid);\n      $book = $node->getBook();\n      if (isset($book['bid'])) {\n        return $book['bid'];\n      }\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/views/argument_default/TopLevelBook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TopLevelBook", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Country\ntype: module\ndescription: 'Defines a simple country field type.'\npackage: Field types\ncore_version_requirement: ^10 || ^11\ndependencies:\n  - drupal:field\n", "metadata": {"source": "repos/country/country.info.yml", "type": "yaml_reference", "topic": "country.info"}}
{"instruction": "Show me the implementation of the class ShortcutThemeHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\shortcut\\Hook;\n\nuse Drupal\\Component\\Render\\FormattableMarkup;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Extension\\ThemeSettingsProvider;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for shortcut.\n */\nclass ShortcutThemeHooks {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly ThemeSettingsProvider $themeSettingsProvider,\n  ) {}\n\n  /**\n   * Implements hook_preprocess_HOOK() for block templates.\n   */\n  #[Hook('preprocess_block')]\n  public function preprocessBlock(&$variables): void {\n    if ($variables['configuration']['provider'] == 'shortcut') {\n      $variables['attributes']['role'] = 'navigation';\n    }\n  }\n\n  /**\n   * Implements hook_preprocess_HOOK() for page title templates.\n   */\n  #[Hook('preprocess_page_title')]\n  public function preprocessPageTitle(&$variables): void {\n    // Only display the shortcut link if the user has the ability to edit\n    // shortcuts, the feature is enabled for the current theme and if the\n    // page's actual content is being shown (for example, we do not want to\n    // display it on \"access denied\" or \"page not found\" pages).\n    if (shortcut_set_edit_access()->isAllowed() && $this->themeSettingsProvider->getSetting('third_party_settings.shortcut.module_link') && !\\Drupal::request()->attributes->has('exception')) {\n      $link = Url::fromRouteMatch(\\Drupal::routeMatch())->getInternalPath();\n      $route_match = \\Drupal::routeMatch();\n      // Replicate template_preprocess_html()'s processing to get the title in\n      // string form, so we can set the default name for the shortcut.\n      $name = $variables['title'] ?? '';\n      if (is_array($name)) {\n        $name = \\Drupal::service('renderer')->render($name);\n      }\n      $query = [\n        'link' => $link,\n        'name' => trim(strip_tags($name)),\n      ];\n      $shortcut_set = \\Drupal::entityTypeManager()->getStorage('shortcut_set')->getDisplayedToUser(\\Drupal::currentUser());\n      // Pages with the add or remove shortcut button need cache invalidation\n      // when a shortcut is added, edited, or removed.\n      $cacheability_metadata = CacheableMetadata::createFromRenderArray($variables);\n      $cacheability_metadata->addCacheTags(\\Drupal::entityTypeManager()->getDefinition('shortcut')->getListCacheTags());\n      $cacheability_metadata->applyTo($variables);\n      // Check if $link is already a shortcut and set $link_mode accordingly.\n      $shortcuts = \\Drupal::entityTypeManager()->getStorage('shortcut')->loadByProperties([\n        'shortcut_set' => $shortcut_set->id(),\n      ]);\n      /** @var \\Drupal\\shortcut\\ShortcutInterface $shortcut */\n      foreach ($shortcuts as $shortcut) {\n        if (($shortcut_url = $shortcut->getUrl()) && $shortcut_url->isRouted() && $shortcut_url->getRouteName() == $route_match->getRouteName() && $shortcut_url->getRouteParameters() == $route_match->getRawParameters()->all()) {\n          $shortcut_id = $shortcut->id();\n          break;\n        }\n      }\n      $link_mode = isset($shortcut_id) ? \"remove\" : \"add\";\n      if ($link_mode == \"add\") {\n        $link_text = shortcut_set_switch_access()->isAllowed() ? $this->t('Add to %shortcut_set shortcuts', [\n          '%shortcut_set' => $shortcut_set->label(),\n        ]) : $this->t('Add to shortcuts');\n        $route_name = 'shortcut.link_add_inline';\n        $route_parameters = [\n          'shortcut_set' => $shortcut_set->id(),\n        ];\n      }\n      else {\n        $query['id'] = $shortcut_id;\n        $link_text = shortcut_set_switch_access()->isAllowed() ? $this->t('Remove from %shortcut_set shortcuts', [\n          '%shortcut_set' => $shortcut_set->label(),\n        ]) : $this->t('Remove from shortcuts');\n        $route_name = 'entity.shortcut.link_delete_inline';\n        $route_parameters = [\n          'shortcut' => $shortcut_id,\n        ];\n      }\n      $query += \\Drupal::destination()->getAsArray();\n      $variables['title_suffix']['add_or_remove_shortcut'] = [\n        '#attached' => [\n          'library' => [\n            'shortcut/drupal.shortcut',\n          ],\n        ],\n        '#type' => 'link',\n        '#title' => new FormattableMarkup('<span class=\"shortcut-action__icon\"></span><span class=\"shortcut-action__message\">@text</span>', [\n          '@text' => $link_text,\n        ]),\n        '#url' => Url::fromRoute($route_name, $route_parameters),\n        '#options' => [\n          'query' => $query,\n        ],\n        '#attributes' => [\n          'class' => [\n            'shortcut-action',\n            'shortcut-action--' . $link_mode,\n          ],\n        ],\n      ];\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/src/Hook/ShortcutThemeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ShortcutThemeHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SdkController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * SDK Controller for API Normalizer.\n */\nclass SdkController extends ControllerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static();\n  }\n\n  /**\n   * Generate SDK for API.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The JSON response.\n   */\n  public function generator(Request $request): JsonResponse {\n    $content = json_decode($request->getContent(), TRUE);\n\n    if (!$content || !isset($content['api_spec'])) {\n      return new JsonResponse(['error' => 'API specification is required'], 400);\n    }\n\n    $language = $content['language'] ?? 'javascript';\n    $framework = $content['framework'] ?? 'axios';\n\n    $sdk = [\n      'language' => $language,\n      'framework' => $framework,\n      'generated_at' => time(),\n      'endpoints' => count($content['api_spec']['paths'] ?? []),\n      'models' => count($content['api_spec']['components']['schemas'] ?? []),\n      'download_url' => '/api/sdk/download/' . uniqid(),\n    ];\n\n    return new JsonResponse([\n      'success' => TRUE,\n      'sdk' => $sdk,\n    ]);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Controller/SdkController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SdkController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Workflow Editor\nstatus: experimental\ndescription: 'A visual workflow editor component powered by the FlowDrop library. Provides a drag-and-drop interface for creating and editing node-based workflows with real-time execution support.'\ngroup: FlowDrop\n\nprops:\n  type: object\n  properties:\n    workflow:\n      type: object\n      title: Workflow Data\n      description: 'Initial workflow data object containing id, name, nodes, edges, and metadata'\n    endpoint_config:\n      type: object\n      title: Endpoint Configuration\n      description: 'API endpoint configuration for workflow operations (save, load, execute)'\n    editor_id:\n      type: string\n      title: Editor ID\n      description: 'Unique identifier for the editor instance'\n    container_class:\n      type: string\n      title: Container Class\n      description: 'Additional CSS class(es) to apply to the editor container'\n    height:\n      type: string\n      title: Height\n      description: 'Editor height (CSS value, e.g., \"100vh\", \"600px\")'\n      default: '100%'\n    width:\n      type: string\n      title: Width\n      description: 'Editor width (CSS value)'\n      default: '100%'\n    show_navbar:\n      type: boolean\n      title: Show Navbar\n      description: 'Whether to display the navigation bar with save/back actions'\n      default: true\n    navbar_title:\n      type: string\n      title: Navbar Title\n      description: 'Title displayed in the navigation bar'\n    back_url:\n      type: string\n      title: Back URL\n      description: 'URL for the back button in the navbar'\n      default: '/admin/flowdrop/workflows'\n    playground_url:\n      type: string\n      title: Playground URL\n      description: 'URL for the playground link in the dropdown menu'\n    show_save_button:\n      type: boolean\n      title: Show Save Button\n      description: 'Whether to show the save button in the navbar'\n      default: true\n    show_back_button:\n      type: boolean\n      title: Show Back Button\n      description: 'Whether to show the back button in the navbar'\n      default: true\n    enable_keyboard_shortcuts:\n      type: boolean\n      title: Enable Keyboard Shortcuts\n      description: 'Enable keyboard shortcuts like Ctrl+S for save'\n      default: true\n    attributes:\n      type: Drupal\\Core\\Template\\Attribute\n      title: Attributes\n      description: 'Additional HTML attributes for the container element'\n\nlibraryOverrides:\n  css:\n    component:\n      editor.css: {}\n  js:\n    editor.js: { preprocess: false }\n  dependencies:\n    - flowdrop_ui_components/flowdrop\n    - flowdrop_ui_components/fullscreen-layout\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/editor/editor.component.yml", "type": "yaml_reference", "topic": "editor.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.flowdrop_job.edit_form:\n  route_name: entity.flowdrop_job.edit_form\n  group: flowdrop_job\n  title: 'Edit'\n\nentity.flowdrop_job.delete_form:\n  route_name: entity.flowdrop_job.delete_form\n  group: flowdrop_job\n  title: 'Delete'\n  weight: 10\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_job/flowdrop_job.links.contextual.yml", "type": "yaml_reference", "topic": "flowdrop job.links.contextual"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Sizing: large\"\nprops:\n  items:\n    - title: \"1\"\n    - url: \"#\"\n      title: \"2\"\n    - url: \"#\"\n      title: \"3\"\n  variant: lg\n", "metadata": {"source": "repos/bootstrap_components/components/pagination/stories/pagination.sizing_large.story.yml", "type": "yaml_reference", "topic": "pagination.sizing large.story"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% extends \"block.html.twig\" %}\n{#\n/**\n * @file\n * Theme override for tabs.\n */\n#}\n{% block content %}\n  {% if content %}\n    <nav class=\"tabs\" role=\"navigation\" aria-label=\"{{ 'Tabs'|t }}\">\n      {{ content }}\n    </nav>\n  {% endif %}\n{% endblock %}\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/block/block--local-tasks-block.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class TransactionStatusChangeEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Event;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * The transaction status change event.\n */\nfinal class TransactionStatusChangeEvent extends Event {\n\n  /**\n   * The constructor.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param string $oldStatus\n   *   The old status.\n   * @param string $newStatus\n   *   The new status.\n   * @param array<string, mixed> $context\n   *   Extra context information for callers (debug/logging).\n   */\n  public function __construct(\n    public readonly NexiXpayTransactionInterface $transaction,\n    public readonly string $oldStatus,\n    public readonly string $newStatus,\n    public readonly array $context = [],\n  ) {}\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Event/TransactionStatusChangeEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TransactionStatusChangeEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set html_tag = html_tag ?? 'div' %}\n{% set width_class = width_class|default('w-100') %}\n{% set height_class = height_class|default('none') %}\n{% set container_class = container_type != 'none' ? container_type : '' %}\n{% set classes = [\n  container_class,\n  custom_class,\n  width_class != 'none' ? width_class : '',\n  height_class != 'none' ? height_class : '',\n  margin_for_all,\n  margin_top,\n  margin_bottom,\n  margin_start,\n  margin_end,\n  margin_x,\n  margin_y,\n  padding_all,\n  padding_top,\n  padding_bottom,\n  padding_start,\n  padding_end,\n  padding_x,\n  padding_y,\n] %}\n\n{% if flex_enabled %}\n  {% set flex_classes = [\n    'd-flex',\n    flex_direction,\n    flex_gap != 'none' ? flex_gap : '',\n    flex_width != 'none' ? flex_width : '',\n    justify_content != 'none' ? justify_content : '',\n    align_items != 'none' ? align_items : '',\n  ] %}\n  {% set classes = classes|merge(flex_classes) %}\n{% endif %}\n\n<{{ html_tag }}{{ attributes.addClass(classes|filter(v => v)) }}>\n  {% block content %}{% endblock %}\n</{{ html_tag }}>\n", "metadata": {"source": "repos/canvas_bootstrap/components/wrapper/wrapper.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class PluralTranslatableMarkup in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\StringTranslation;\n\nuse Drupal\\Component\\Gettext\\PoItem;\n\n/**\n * A class to hold plural translatable markup.\n */\nclass PluralTranslatableMarkup extends TranslatableMarkup {\n\n  /**\n   * The item count to display.\n   *\n   * @var numeric\n   */\n  protected $count;\n\n  /**\n   * The already translated string.\n   *\n   * @var string\n   */\n  protected $translatedString;\n\n  /**\n   * Constructs a new PluralTranslatableMarkup object.\n   *\n   * Parses values passed into this class through the format_plural() function\n   * in Drupal and handles an optional context for the string.\n   *\n   * @param numeric $count\n   *   The item count to display.\n   * @param string $singular\n   *   The string for the singular case. Make sure it is clear this is singular,\n   *   to ease translation (e.g. use \"1 new comment\" instead of \"1 new\"). Do not\n   *   use @count in the singular string.\n   * @param string $plural\n   *   The string for the plural case. Make sure it is clear this is plural, to\n   *   ease translation. Use @count in place of the item count, as in\n   *   \"@count new comments\".\n   * @param array $args\n   *   (optional) An array with placeholder replacements, keyed by placeholder.\n   *   See \\Drupal\\Component\\Render\\FormattableMarkup::placeholderFormat() for\n   *   additional information about placeholders. Note that you do not need to\n   *   include @count in this array; this replacement is done automatically\n   *   for the plural cases.\n   * @param array $options\n   *   (optional) An associative array of additional options. See t() for\n   *   allowed keys.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   (optional) The string translation service.\n   *\n   * @see \\Drupal\\Component\\Render\\FormattableMarkup::placeholderFormat()\n   */\n  public function __construct($count, $singular, $plural, array $args = [], array $options = [], ?TranslationInterface $string_translation = NULL) {\n    $this->count = $count;\n    $translatable_string = implode(PoItem::DELIMITER, [$singular, $plural]);\n    parent::__construct($translatable_string, $args, $options, $string_translation);\n  }\n\n  /**\n   * Constructs a new class instance from already translated markup.\n   *\n   * This method ensures that the string is pluralized correctly. As opposed\n   * to the __construct() method, this method is designed to be invoked with\n   * a string already translated (such as with configuration translation).\n   *\n   * @param numeric $count\n   *   The item count to display.\n   * @param string $translated_string\n   *   The already translated string.\n   * @param array $args\n   *   An associative array of replacements to make after translation. Instances\n   *   of any key in this array are replaced with the corresponding value.\n   *   Based on the first character of the key, the value is escaped and/or\n   *   themed. See \\Drupal\\Component\\Render\\FormattableMarkup. Note that you\n   *   do not need to include @count in this array; this replacement is done\n   *   automatically for the plural cases.\n   * @param array $options\n   *   An associative array of additional options. See t() for allowed keys.\n   *\n   * @return static\n   *   A PluralTranslatableMarkup object.\n   */\n  public static function createFromTranslatedString($count, $translated_string, array $args = [], array $options = []) {\n    $plural = new static($count, '', '', $args, $options);\n    $plural->translatedString = $translated_string;\n    return $plural;\n  }\n\n  /**\n   * Renders the object as a string.\n   *\n   * @return string\n   *   The translated string.\n   */\n  public function render() {\n    if (!$this->translatedString) {\n      $this->translatedString = $this->getStringTranslation()->translateString($this);\n    }\n    if ($this->translatedString === '') {\n      return '';\n    }\n\n    $arguments = $this->getArguments();\n    $arguments['@count'] = $this->count;\n    $translated_array = explode(PoItem::DELIMITER, $this->translatedString);\n\n    $index = $this->getPluralIndex();\n    if ($this->count == 1 || $index == 0 || count($translated_array) == 1) {\n      // Singular form.\n      $return = $translated_array[0];\n    }\n    else {\n      // Nth plural form, fallback to second plural form.\n      $return = $translated_array[$index] ?? $translated_array[1];\n    }\n    return $this->placeholderFormat($return, $arguments);\n  }\n\n  /**\n   * Gets the plural index through the gettext formula.\n   *\n   * @return int\n   *   The numeric index of the plural variant to use for this language and\n   *   count combination. Defaults to -1 when the language was not found or does\n   *   not have a plural formula.\n   */\n  protected function getPluralIndex() {\n    // We have to test both if the function and the service exist since in\n    // certain situations it is possible that locale code might be loaded but\n    // the service does not exist. For example, where the parent test site has\n    // locale installed but the child site does not.\n    // @todo Refactor in https://www.drupal.org/node/2660338 so this code does\n    // not depend on knowing that the Locale module exists.\n    if (function_exists('locale_get_plural') && \\Drupal::hasService('locale.plural.formula')) {\n      return locale_get_plural($this->count, $this->getOption('langcode'));\n    }\n    return -1;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __sleep(): array {\n    return array_merge(parent::__sleep(), ['count']);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/StringTranslation/PluralTranslatableMarkup.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PluralTranslatableMarkup", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: CronHooks\nSource file: <source_file>\nFile name hint: CronHooks.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\flowdrop_trigger\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\flowdrop_trigger\\Service\\TriggerManager;\n\n/**\n * Implements cron hooks for FlowDrop ecosystem.\n *\n * Fires cron-based workflow triggers when Drupal's cron runs.\n * This allows workflows to be scheduled for periodic execution.\n */\nclass CronHooks {\n\n  /**\n   * Constructs a new CronHooks object.\n   *\n   * @param \\Drupal\\flowdrop_trigger\\Service\\TriggerManager $triggerManager\n   *   The trigger manager service.\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state service for tracking last cron run.\n   */\n  public function __construct(\n    protected readonly TriggerManager $triggerManager,\n    protected readonly StateInterface $state,\n  ) {}\n\n  /**\n   * Implements hook_cron().\n   *\n   * Fires the cron.run event to trigger any workflows configured\n   * for cron-based execution.\n   */\n  #[Hook('cron')]\n  public function cron(): void {\n    // Get the last cron run timestamp for context.\n    $lastRun = $this->state->get(\"flowdrop_trigger.last_cron_run\", 0);\n\n    // Build context with cron-specific information.\n    $context = [\n      \"last_run\" => $lastRun,\n      \"cron_key\" => NULL,\n    ];\n\n    // Process the cron event.\n    $this->triggerManager->processCronEvent(\"cron.run\", $context);\n\n    // Update the global last cron run timestamp.\n    $this->state->set(\"flowdrop_trigger.last_cron_run\", time());\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\flowdrop_trigger\\Service\\TriggerManager;\n\n/**\n * Implements cron hooks for FlowDrop ecosystem.\n *\n * Fires cron-based workflow triggers when Drupal's cron runs.\n * This allows workflows to be scheduled for periodic execution.\n */\nclass CronHooks {\n\n  /**\n   * Constructs a new CronHooks object.\n   *\n   * @param \\Drupal\\flowdrop_trigger\\Service\\TriggerManager $triggerManager\n   *   The trigger manager service.\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state service for tracking last cron run.\n   */\n  public function __construct(\n    protected readonly TriggerManager $triggerManager,\n    protected readonly StateInterface $state,\n  ) {}\n\n  /**\n   * Implements hook_cron().\n   *\n   * Fires the cron.run event to trigger any workflows configured\n   * for cron-based execution.\n   */\n  #[Hook('cron')]\n  public function cron(): void {\n    // Get the last cron run timestamp for context.\n    $lastRun = $this->state->get(\"flowdrop_trigger.last_cron_run\", 0);\n\n    // Build context with cron-specific information.\n    $context = [\n      \"last_run\" => $lastRun,\n      \"cron_key\" => NULL,\n    ];\n\n    // Process the cron event.\n    $this->triggerManager->processCronEvent(\"cron.run\", $context);\n\n    // Update the global last cron run timestamp.\n    $this->state->set(\"flowdrop_trigger.last_cron_run\", time());\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Hook/CronHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CronHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DatabaseListener in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\EventListener;\n\nuse Drupal\\Core\\Database\\Event\\StatementExecutionEndEvent;\nuse Drupal\\webprofiler\\DataCollector\\DatabaseDataCollector;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * DatabaseListener collects data for the current request.\n */\nclass DatabaseListener implements EventSubscriberInterface {\n\n  /**\n   * DatabaseListener constructor.\n   */\n  public function __construct(\n    private readonly DatabaseDataCollector $collector,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      StatementExecutionEndEvent::class => 'onStatementExecutionEnd',\n    ];\n  }\n\n  /**\n   * Collects data for the current request.\n   */\n  public function onStatementExecutionEnd(StatementExecutionEndEvent $event): void {\n    $this->collector->addStatement($event);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/EventListener/DatabaseListener.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatabaseListener", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for exposed filter form.\n *\n * Available variables:\n * - form_description: The exposed filter's description.\n * - expose_button: The button to toggle the expose filter form.\n * - group_button: Toggle options between single and grouped filters.\n * - required: A checkbox to require this filter or not.\n * - label: A filter label input field.\n * - description: A filter description field.\n * - operator: The operators for how the filters value should be treated.\n *   - #type: The operator type.\n * - value: The filters available values.\n * - use_operator: Checkbox to allow the user to expose the operator.\n * - more: A details element for additional field exposed filter fields.\n *\n * @ingroup themeable\n */\n#}\n{{ form.form_description }}\n{{ form.expose_button }}\n{{ form.group_button }}\n{{ form.required }}\n{{ form.label }}\n{{ form.description }}\n\n{{ form.operator }}\n{{ form.value }}\n\n{% if form.use_operator %}\n  <div class=\"views-left-40\">\n  {{ form.use_operator }}\n  </div>\n{% endif %}\n\n{#\n  Collect a list of elements printed to exclude when printing the\n  remaining elements.\n#}\n{% set remaining_form = form|without(\n  'form_description',\n  'expose_button',\n  'group_button',\n  'required',\n  'label',\n  'description',\n  'operator',\n  'value',\n  'use_operator',\n  'more'\n  )\n%}\n\n{#\n  Only output the right column markup if there's a left column to begin with.\n#}\n{% if form.operator['#type'] %}\n  <div class=\"views-right-60\">\n  {{ remaining_form }}\n  </div>\n{% else %}\n  {{ remaining_form }}\n{% endif %}\n\n{{ form.more }}\n", "metadata": {"source": "repos/drupal_core/core/modules/views_ui/templates/views-ui-expose-filter-form.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class NodeTypeMapper in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\node\\ConfigTranslation;\n\nuse Drupal\\config_translation\\ConfigEntityMapper;\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\n\n/**\n * Provides a configuration mapper for node types.\n */\nclass NodeTypeMapper extends ConfigEntityMapper {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setEntity(ConfigEntityInterface $entity) {\n    parent::setEntity($entity);\n\n    // Adds the title label to the translation form.\n    $node_type = $entity->id();\n    $config = $this->configFactory->get(\"core.base_field_override.node.$node_type.title\");\n    if (!$config->isNew()) {\n      $this->addConfigName($config->getName());\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/node/src/ConfigTranslation/NodeTypeMapper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeTypeMapper", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RouteMatchValueResolver in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Controller\\ArgumentResolver;\n\nuse Drupal\\Core\\Routing\\RouteMatch;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ValueResolverInterface;\nuse Symfony\\Component\\HttpKernel\\ControllerMetadata\\ArgumentMetadata;\n\n/**\n * Yields a RouteMatch object based on the request object passed along.\n */\nfinal class RouteMatchValueResolver implements ValueResolverInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolve(Request $request, ArgumentMetadata $argument): array {\n    return $argument->getType() === RouteMatchInterface::class || is_subclass_of($argument->getType(), RouteMatchInterface::class) ? [RouteMatch::createFromRequest($request)] : [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/ArgumentResolver/RouteMatchValueResolver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RouteMatchValueResolver", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Editor library - for adding/editing hotspots\neditor:\n  version: 1.x\n  js:\n    js/hotspot-editor.js: {}\n    js/hotspot-variant-previews.js: {}\n  css:\n    component:\n      css/hotspot-editor.css: {}\n      css/hotspot-variant-previews.css: {}\n      css/hotspot-icon-previews.css: {}\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/once\n    - core/jquery\n    - core/drupal.ajax\n    - core/drupal.dialog.ajax\n\n# Display library - for frontend viewing\ndisplay:\n  version: 1.x\n  js:\n    js/hotspot-display.js: {}\n  css:\n    component:\n      css/hotspot-display.css: {}\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/once\n", "metadata": {"source": "repos/image_hotspots_agent/image_hotspot_agent.libraries.yml", "type": "yaml_reference", "topic": "image hotspot agent.libraries"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: RateLimitSettingsForm\nSource file: <source_file>\nFile name hint: RateLimitSettingsForm.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\webform_rate_limit\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configuration form for webform rate limiting.\n */\nclass RateLimitSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['webform_rate_limit.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'webform_rate_limit_settings_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $config = $this->config('webform_rate_limit.settings');\n\n    $form['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable rate limiting'),\n      '#description' => $this->t('Enable rate limiting for all webform submissions per IP address.'),\n      '#default_value' => $config->get('enabled'),\n    ];\n\n    $form['limits'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Rate limits'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['limits']['limit_10min'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum submissions per 10 minutes'),\n      '#description' => $this->t('Maximum number of submissions allowed per IP address within a 10-minute window. Applies to all webforms combined.'),\n      '#default_value' => $config->get('limit_10min'),\n      '#min' => 1,\n      '#required' => TRUE,\n    ];\n\n    $form['limits']['limit_24h'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum submissions per 24 hours'),\n      '#description' => $this->t('Maximum number of submissions allowed per IP address within a 24-hour window. Applies to all webforms combined.'),\n      '#default_value' => $config->get('limit_24h'),\n      '#min' => 1,\n      '#required' => TRUE,\n    ];\n\n    $form['messages'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Error messages'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['messages']['message_10min'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('10-minute limit error message'),\n      '#description' => $this->t('Message shown when the 10-minute limit is exceeded.'),\n      '#default_value' => $config->get('message_10min'),\n    ];\n\n    $form['messages']['message_24h'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('24-hour limit error message'),\n      '#description' => $this->t('Message shown when the 24-hour limit is exceeded.'),\n      '#default_value' => $config->get('message_24h'),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->config('webform_rate_limit.settings')\n      ->set('enabled', $form_state->getValue('enabled'))\n      ->set('limit_10min', $form_state->getValue('limit_10min'))\n      ->set('limit_24h', $form_state->getValue('limit_24h'))\n      ->set('message_10min', $form_state->getValue('message_10min'))\n      ->set('message_24h', $form_state->getValue('message_24h'))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\webform_rate_limit\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configuration form for webform rate limiting.\n */\nclass RateLimitSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['webform_rate_limit.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'webform_rate_limit_settings_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $config = $this->config('webform_rate_limit.settings');\n\n    $form['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable rate limiting'),\n      '#description' => $this->t('Enable rate limiting for all webform submissions per IP address.'),\n      '#default_value' => $config->get('enabled'),\n    ];\n\n    $form['limits'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Rate limits'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['limits']['limit_10min'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum submissions per 10 minutes'),\n      '#description' => $this->t('Maximum number of submissions allowed per IP address within a 10-minute window. Applies to all webforms combined.'),\n      '#default_value' => $config->get('limit_10min'),\n      '#min' => 1,\n      '#required' => TRUE,\n    ];\n\n    $form['limits']['limit_24h'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum submissions per 24 hours'),\n      '#description' => $this->t('Maximum number of submissions allowed per IP address within a 24-hour window. Applies to all webforms combined.'),\n      '#default_value' => $config->get('limit_24h'),\n      '#min' => 1,\n      '#required' => TRUE,\n    ];\n\n    $form['messages'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Error messages'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['messages']['message_10min'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('10-minute limit error message'),\n      '#description' => $this->t('Message shown when the 10-minute limit is exceeded.'),\n      '#default_value' => $config->get('message_10min'),\n    ];\n\n    $form['messages']['message_24h'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('24-hour limit error message'),\n      '#description' => $this->t('Message shown when the 24-hour limit is exceeded.'),\n      '#default_value' => $config->get('message_24h'),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->config('webform_rate_limit.settings')\n      ->set('enabled', $form_state->getValue('enabled'))\n      ->set('limit_10min', $form_state->getValue('limit_10min'))\n      ->set('limit_24h', $form_state->getValue('limit_24h'))\n      ->set('message_10min', $form_state->getValue('message_10min'))\n      ->set('message_24h', $form_state->getValue('message_24h'))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/webform_rate_limit/src/Form/RateLimitSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RateLimitSettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class SoapOperationListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Entity\\Controller;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\n\n/**\n * List builder for SOAP Operation entities.\n */\nclass SoapOperationListBuilder extends ConfigEntityListBuilder\n{\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader(): array {\n    return [\n      ...parent::buildHeader(),\n      'label' => $this->t('Label'),\n      'id' => $this->t('Machine name'),\n      'operation_name' => $this->t('Operation'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    return [\n      ...parent::buildRow($entity),\n      'label' => $entity->label(),\n      'id' => $entity->id(),\n      'operation_name' => $entity->operationName(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/src/Entity/Controller/SoapOperationListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapOperationListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Menu.php\nTarget symbol: class Menu\nNamespace: Drupal\\display_builder\\Plugin\\display_builder\\Island\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Menu.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\display_builder\\Attribute\\Island\n  - Drupal\\display_builder\\InstanceInterface\n  - Drupal\\display_builder\\IslandPluginBase\n  - Drupal\\display_builder\\IslandType\n- Ensure these methods exist where relevant:\n  - build()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\InstanceInterface;\nuse Drupal\\display_builder\\IslandPluginBase;\nuse Drupal\\display_builder\\IslandType;\n\n/**\n * Menu island plugin implementation.\n */\n#[Island(\n  id: 'menu',\n  label: new TranslatableMarkup('Main menu items'),\n  description: new TranslatableMarkup('Copy, paste and duplicate.'),\n  type: IslandType::Menu,\n)]\nclass Menu extends IslandPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(InstanceInterface $builder, array $data = [], array $options = []): array {\n    $builder_id = (string) $builder->id();\n    // Attribute data-contextual-menu is important for the js mapping.\n    // @see assets/js/contextual_menu.js\n    // Urls are generated with placeholders to be replaced in the js.\n    $duplicate = $this->buildMenuItem($this->t('Duplicate'), 'duplicate');\n    $duplicate = $this->htmxEvents->onClickDuplicate($duplicate, $builder_id, '__node_id__', '__parent_id__', '__slot_id__', '__slot_position__');\n\n    $paste = $this->buildMenuItem($this->t('Paste'), 'paste');\n    $paste = $this->htmxEvents->onClickPaste($paste, $builder_id, '__node_id__', '__parent_id__', '__slot_id__', '__slot_position__');\n\n    return [\n      $this->buildMenuItem($this->t('Copy'), 'copy'),\n      $paste,\n      $duplicate,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Plugin/display_builder/Island/Menu.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Menu", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class RecursiveValidator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Validation;\n\nuse Drupal\\Core\\TypedData\\TypedDataInterface;\nuse Drupal\\Core\\TypedData\\TypedDataManagerInterface;\nuse Symfony\\Component\\Validator\\ConstraintValidatorFactoryInterface;\nuse Symfony\\Component\\Validator\\ConstraintViolationListInterface;\nuse Symfony\\Component\\Validator\\Context\\ExecutionContextFactoryInterface;\nuse Symfony\\Component\\Validator\\Context\\ExecutionContextInterface;\nuse Symfony\\Component\\Validator\\Mapping\\MetadataInterface;\nuse Symfony\\Component\\Validator\\Validator\\ContextualValidatorInterface;\nuse Symfony\\Component\\Validator\\Validator\\ValidatorInterface;\n\n/**\n * Defines a recursive validator for Typed Data.\n *\n * The difference to \\Symfony\\Component\\Validator\\Validator\\RecursiveValidator\n * is that we just allow to validate typed data objects.\n */\nclass RecursiveValidator implements ValidatorInterface {\n\n  /**\n   * @var \\Symfony\\Component\\Validator\\Context\\ExecutionContextFactoryInterface\n   */\n  protected $contextFactory;\n\n  /**\n   * @var \\Symfony\\Component\\Validator\\ConstraintValidatorFactoryInterface\n   */\n  protected $constraintValidatorFactory;\n\n  /**\n   * @var \\Drupal\\Core\\TypedData\\TypedDataManager\n   */\n  protected $typedDataManager;\n\n  /**\n   * Creates a new validator.\n   *\n   * @param \\Symfony\\Component\\Validator\\Context\\ExecutionContextFactoryInterface $context_factory\n   *   The factory for creating new contexts.\n   * @param \\Symfony\\Component\\Validator\\ConstraintValidatorFactoryInterface $validator_factory\n   *   The constraint validator factory.\n   * @param \\Drupal\\Core\\TypedData\\TypedDataManagerInterface $typed_data_manager\n   *   The typed data manager.\n   */\n  public function __construct(ExecutionContextFactoryInterface $context_factory, ConstraintValidatorFactoryInterface $validator_factory, TypedDataManagerInterface $typed_data_manager) {\n    $this->contextFactory = $context_factory;\n    $this->constraintValidatorFactory = $validator_factory;\n    $this->typedDataManager = $typed_data_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function startContext($root = NULL): ContextualValidatorInterface {\n    return new RecursiveContextualValidator($this->contextFactory->createContext($this, $root), $this, $this->constraintValidatorFactory, $this->typedDataManager);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function inContext(ExecutionContextInterface $context): ContextualValidatorInterface {\n    return new RecursiveContextualValidator($context, $this, $this->constraintValidatorFactory, $this->typedDataManager);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @param \\Drupal\\Core\\TypedData\\TypedDataInterface $typed_data\n   *   A typed data object containing the value to validate.\n   */\n  public function getMetadataFor($typed_data): MetadataInterface {\n    if (!$typed_data instanceof TypedDataInterface) {\n      throw new \\InvalidArgumentException('The passed value must be a typed data object.');\n    }\n    return new TypedDataMetadata($typed_data);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasMetadataFor($value): bool {\n    return $value instanceof TypedDataInterface;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($value, $constraints = NULL, $groups = NULL): ConstraintViolationListInterface {\n    return $this->startContext($value)\n      ->validate($value, $constraints, $groups)\n      ->getViolations();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateProperty($object, $propertyName, $groups = NULL): ConstraintViolationListInterface {\n    return $this->startContext($object)\n      ->validateProperty($object, $propertyName, $groups)\n      ->getViolations();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validatePropertyValue($objectOrClass, $propertyName, $value, $groups = NULL): ConstraintViolationListInterface {\n    // Just passing a class name is not supported.\n    if (!is_object($objectOrClass)) {\n      throw new \\LogicException('Typed data validation does not support passing the class name only.');\n    }\n    return $this->startContext($objectOrClass)\n      ->validatePropertyValue($objectOrClass, $propertyName, $value, $groups)\n      ->getViolations();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Validation/RecursiveValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RecursiveValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: ProtectionRulePluginInterface\nSource file: <source_file>\nFile name hint: ProtectionRulePluginInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\db_wipe_entity\\Plugin\\ProtectionRule;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Core\\Entity\\Query\\QueryInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Interface for protection rule plugins.\n */\ninterface ProtectionRulePluginInterface extends PluginInspectionInterface, ConfigurableInterface, PluginFormInterface {\n\n  /**\n   * Checks if this rule applies to the given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   *\n   * @return bool\n   *   TRUE if this rule applies, FALSE otherwise.\n   */\n  function appliesTo(string $entity_type_id, ?string $bundle = NULL): bool;\n\n  /**\n   * Modifies the entity query to exclude protected entities.\n   *\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryInterface $query\n   *   The entity query.\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   */\n  public function modifyQuery(QueryInterface $query, string $entity_type_id, ?string $bundle = NULL): void;\n\n  /**\n   * Checks if a specific entity ID is protected by this rule.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param int|string $entity_id\n   *   The entity ID.\n   *\n   * @return bool\n   *   TRUE if the entity is protected, FALSE otherwise.\n   */\n  public function isEntityProtected(string $entity_type_id, int|string $entity_id): bool;\n\n  /**\n   * Gets a summary of this protection rule.\n   *\n   * @return string\n   *   A human-readable summary.\n   */\n  public function summary(): string;\n\n  /**\n   * Indicates whether this rule completely prevents wipe operations.\n   *\n   * Some rules may completely prevent wiping (e.g., protect entity type),\n   * while others only exclude specific entities from the query.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   *\n   * @return bool\n   *   TRUE if wipe should be completely prevented, FALSE if query modification\n   *   is sufficient.\n   */\n  public function shouldPreventWipe(string $entity_type_id, ?string $bundle = NULL): bool;\n\n}", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Plugin\\ProtectionRule;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Core\\Entity\\Query\\QueryInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Interface for protection rule plugins.\n */\ninterface ProtectionRulePluginInterface extends PluginInspectionInterface, ConfigurableInterface, PluginFormInterface {\n\n  /**\n   * Checks if this rule applies to the given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   *\n   * @return bool\n   *   TRUE if this rule applies, FALSE otherwise.\n   */\n  public function appliesTo(string $entity_type_id, ?string $bundle = NULL): bool;\n\n  /**\n   * Modifies the entity query to exclude protected entities.\n   *\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryInterface $query\n   *   The entity query.\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   */\n  public function modifyQuery(QueryInterface $query, string $entity_type_id, ?string $bundle = NULL): void;\n\n  /**\n   * Checks if a specific entity ID is protected by this rule.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param int|string $entity_id\n   *   The entity ID.\n   *\n   * @return bool\n   *   TRUE if the entity is protected, FALSE otherwise.\n   */\n  public function isEntityProtected(string $entity_type_id, int|string $entity_id): bool;\n\n  /**\n   * Gets a summary of this protection rule.\n   *\n   * @return string\n   *   A human-readable summary.\n   */\n  public function summary(): string;\n\n  /**\n   * Indicates whether this rule completely prevents wipe operations.\n   *\n   * Some rules may completely prevent wiping (e.g., protect entity type),\n   * while others only exclude specific entities from the query.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string|null $bundle\n   *   The bundle, or NULL if not specified.\n   *\n   * @return bool\n   *   TRUE if wipe should be completely prevented, FALSE if query modification\n   *   is sufficient.\n   */\n  public function shouldPreventWipe(string $entity_type_id, ?string $bundle = NULL): bool;\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Plugin/ProtectionRule/ProtectionRulePluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ProtectionRulePluginInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: UserStorage.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\user;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Controller class for users.\n *\n * This extends the Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage class,\n * adding required special handling for user objects.\n */\nclass UserStorage extends SqlContentEntityStorage implements UserStorageInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doSaveFieldItems(ContentEntityInterface $entity, array $names = []) {\n    // The anonymous user account is saved with the fixed user ID of 0. MySQL\n    // does not support inserting an ID of 0 into serial field unless the SQL\n    // mode is set to NO_AUTO_VALUE_ON_ZERO.\n    // @todo https://drupal.org/i/3222123 implement a generic fix for all entity\n    //   types.\n    if ($entity->id() === 0) {\n      $database = \\Drupal::database();\n      if ($database->databaseType() === 'mysql') {\n        $sql_mode = $database->query(\"SELECT @@sql_mode;\")->fetchField();\n        $database->query(\"SET sql_mode = '$sql_mode,NO_AUTO_VALUE_ON_ZERO'\");\n      }\n    }\n    parent::doSaveFieldItems($entity, $names);\n\n    // Reset the SQL mode if we've changed it.\n    if (isset($sql_mode, $database)) {\n      $database->query(\"SET sql_mode = '$sql_mode'\");\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  function updateLastLoginTimestamp(UserInterface $account) {\n    $this->database->update($this->getDataTable())\n      ->fields(['login' => $account->getLastLoginTime()])\n      ->condition('uid', $account->id())\n      ->execute();\n    // Ensure that the entity cache is cleared.\n    $this->resetCache([$account->id()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function updateLastAccessTimestamp(AccountInterface $account, $timestamp) {\n    $this->database->update($this->getDataTable())\n      ->fields([\n        'access' => $timestamp,\n      ])\n      ->condition('uid', $account->id())\n      ->execute();\n    // Ensure that the entity cache is cleared.\n    $this->resetCache([$account->id()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteRoleReferences(array $rids) {\n    // Remove the role from all users.\n    $this->database->delete('user__roles')\n      ->condition('roles_target_id', $rids, 'IN')\n      ->execute();\n\n    $this->resetCache();\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\user;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Controller class for users.\n *\n * This extends the Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage class,\n * adding required special handling for user objects.\n */\nclass UserStorage extends SqlContentEntityStorage implements UserStorageInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doSaveFieldItems(ContentEntityInterface $entity, array $names = []) {\n    // The anonymous user account is saved with the fixed user ID of 0. MySQL\n    // does not support inserting an ID of 0 into serial field unless the SQL\n    // mode is set to NO_AUTO_VALUE_ON_ZERO.\n    // @todo https://drupal.org/i/3222123 implement a generic fix for all entity\n    //   types.\n    if ($entity->id() === 0) {\n      $database = \\Drupal::database();\n      if ($database->databaseType() === 'mysql') {\n        $sql_mode = $database->query(\"SELECT @@sql_mode;\")->fetchField();\n        $database->query(\"SET sql_mode = '$sql_mode,NO_AUTO_VALUE_ON_ZERO'\");\n      }\n    }\n    parent::doSaveFieldItems($entity, $names);\n\n    // Reset the SQL mode if we've changed it.\n    if (isset($sql_mode, $database)) {\n      $database->query(\"SET sql_mode = '$sql_mode'\");\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function updateLastLoginTimestamp(UserInterface $account) {\n    $this->database->update($this->getDataTable())\n      ->fields(['login' => $account->getLastLoginTime()])\n      ->condition('uid', $account->id())\n      ->execute();\n    // Ensure that the entity cache is cleared.\n    $this->resetCache([$account->id()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function updateLastAccessTimestamp(AccountInterface $account, $timestamp) {\n    $this->database->update($this->getDataTable())\n      ->fields([\n        'access' => $timestamp,\n      ])\n      ->condition('uid', $account->id())\n      ->execute();\n    // Ensure that the entity cache is cleared.\n    $this->resetCache([$account->id()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteRoleReferences(array $rids) {\n    // Remove the role from all users.\n    $this->database->delete('user__roles')\n      ->condition('roles_target_id', $rids, 'IN')\n      ->execute();\n\n    $this->resetCache();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/UserStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserStorage", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: TextOutput\nSource file: <source_file>\nFile name hint: TextOutput.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Executor for Text Output nodes.\n */\n#[FlowDropNodeProcessor(\n  id: \"text_output\",\n  label: new \\Drupal\\Core\\StringTranslation\\TranslatableMarkup(\"Text Output\"),\n  description: \"Basic text output\",\n  version: \"1.0.0\"\n)]\nclass TextOutput extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Text output nodes can accept any inputs.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    $text = \"\";\n\n    $textParam = $params->get(\"text\");\n    if ($textParam !== NULL && $textParam !== \"\") {\n      $text = $textParam;\n    }\n\n    // Convert array to string if necessary.\n    if (is_array($text) || is_object($text)) {\n      $text = JSON::encode($text);\n    }\n\n    // Ensure text is a string.\n    $text = (string) $text;\n\n    // Apply max length if configured.\n    $maxLength = $params->get(\"maxLength\", 1000);\n    if (strlen($text) > $maxLength) {\n      $text = substr($text, 0, $maxLength) . \"...\";\n    }\n\n    return [\n      \"text\" => $text,\n      \"length\" => strlen($text),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"text\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text Input\",\n          \"description\" => \"The text to output\",\n          \"required\" => FALSE,\n        ],\n        \"maxLength\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Maximum Length\",\n          \"description\" => \"Maximum length of output text\",\n          \"default\" => 1000,\n          \"minimum\" => 1,\n          \"maximum\" => 10000,\n        ],\n        \"format\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text Format\",\n          \"description\" => \"Text formatting option\",\n          \"default\" => \"plain\",\n          \"enum\" => [\"plain\", \"html\", \"markdown\"],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"text\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text\",\n          \"description\" => \"The processed text output\",\n        ],\n        \"length\" => [", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Executor for Text Output nodes.\n */\n#[FlowDropNodeProcessor(\n  id: \"text_output\",\n  label: new \\Drupal\\Core\\StringTranslation\\TranslatableMarkup(\"Text Output\"),\n  description: \"Basic text output\",\n  version: \"1.0.0\"\n)]\nclass TextOutput extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Text output nodes can accept any inputs.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    $text = \"\";\n\n    $textParam = $params->get(\"text\");\n    if ($textParam !== NULL && $textParam !== \"\") {\n      $text = $textParam;\n    }\n\n    // Convert array to string if necessary.\n    if (is_array($text) || is_object($text)) {\n      $text = JSON::encode($text);\n    }\n\n    // Ensure text is a string.\n    $text = (string) $text;\n\n    // Apply max length if configured.\n    $maxLength = $params->get(\"maxLength\", 1000);\n    if (strlen($text) > $maxLength) {\n      $text = substr($text, 0, $maxLength) . \"...\";\n    }\n\n    return [\n      \"text\" => $text,\n      \"length\" => strlen($text),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"text\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text Input\",\n          \"description\" => \"The text to output\",\n          \"required\" => FALSE,\n        ],\n        \"maxLength\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Maximum Length\",\n          \"description\" => \"Maximum length of output text\",\n          \"default\" => 1000,\n          \"minimum\" => 1,\n          \"maximum\" => 10000,\n        ],\n        \"format\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text Format\",\n          \"description\" => \"Text formatting option\",\n          \"default\" => \"plain\",\n          \"enum\" => [\"plain\", \"html\", \"markdown\"],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"text\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text\",\n          \"description\" => \"The processed text output\",\n        ],\n        \"length\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Length\",\n          \"description\" => \"The length of the output text\",\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/TextOutput.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TextOutput", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: BookRemoveForm\nSource file: <source_file>\nFile name hint: BookRemoveForm.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\book\\Form;\n\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\node\\NodeInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Remove form for book module.\n *\n * @internal\n */\nclass BookRemoveForm extends ConfirmFormBase {\n\n  /**\n   * The node representing the book.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   */\n  protected NodeInterface $node;\n\n  /**\n   * Constructs a BookRemoveForm object.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   */\n  function __construct(protected BookManagerInterface $bookManager) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'book_remove_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?NodeInterface $node = NULL): array {\n    $this->node = $node;\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): TranslatableMarkup {\n    $title = ['%title' => $this->node->label()];\n    $book = $this->node->getBook();\n    if (isset($book['has_children']) && $book['has_children']) {\n      return $this->t('%title has associated child pages, which will be relocated automatically to maintain their connection to the book. To recreate the hierarchy (as it was before removing this page), %title may be added again using the Outline tab, and each of its former child pages will need to be relocated manually.', $title);\n    }\n    else {\n      return $this->t('%title may be added to hierarchy again using the Outline tab.', $title);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText(): TranslatableMarkup {\n    return $this->t('Remove');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion(): TranslatableMarkup {\n    return $this->t('Are you sure you want to remove %title from the book hierarchy?', ['%title' => $this->node->label()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function getCancelUrl(): Url {\n    return $this->node->toUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    if ($this->bookManager->checkNodeIsRemovable($this->node)) {\n      $this->bookManager->deleteFromBook($this->node->id());\n      $this->messenger()->addStatus($this->t('The post has been removed from the book.'));\n    }\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\book\\Form;\n\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\node\\NodeInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Remove form for book module.\n *\n * @internal\n */\nclass BookRemoveForm extends ConfirmFormBase {\n\n  /**\n   * The node representing the book.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   */\n  protected NodeInterface $node;\n\n  /**\n   * Constructs a BookRemoveForm object.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   */\n  public function __construct(protected BookManagerInterface $bookManager) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'book_remove_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?NodeInterface $node = NULL): array {\n    $this->node = $node;\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): TranslatableMarkup {\n    $title = ['%title' => $this->node->label()];\n    $book = $this->node->getBook();\n    if (isset($book['has_children']) && $book['has_children']) {\n      return $this->t('%title has associated child pages, which will be relocated automatically to maintain their connection to the book. To recreate the hierarchy (as it was before removing this page), %title may be added again using the Outline tab, and each of its former child pages will need to be relocated manually.', $title);\n    }\n    else {\n      return $this->t('%title may be added to hierarchy again using the Outline tab.', $title);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText(): TranslatableMarkup {\n    return $this->t('Remove');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion(): TranslatableMarkup {\n    return $this->t('Are you sure you want to remove %title from the book hierarchy?', ['%title' => $this->node->label()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function getCancelUrl(): Url {\n    return $this->node->toUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    if ($this->bookManager->checkNodeIsRemovable($this->node)) {\n      $this->bookManager->deleteFromBook($this->node->id());\n      $this->messenger()->addStatus($this->t('The post has been removed from the book.'));\n    }\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Form/BookRemoveForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookRemoveForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class BootstrapFiveLayoutsPluginManager in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Extension\\ThemeHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Theme\\ThemeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n *\n */\nclass BootstrapFiveLayoutsPluginManager extends DefaultPluginManager implements ContainerInjectionInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The theme handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ThemeHandlerInterface\n   */\n  protected ThemeHandlerInterface $themeHandler;\n\n  /**\n   * The theme manager.\n   *\n   * @var \\Drupal\\Core\\Theme\\ThemeManagerInterface\n   */\n  protected ThemeManagerInterface $themeManager;\n\n  /**\n   * The service container.\n   *\n   * @var \\Symfony\\Component\\DependencyInjection\\ContainerInterface\n   */\n  protected ContainerInterface $container;\n\n  /**\n   * Base plugin manager for Bootstrap Layouts plugin managers.\n   *\n   * The \"container.namespaces\" service does not contain theme namespaces\n   * since themes are not registered in the container. To allow themes to be\n   * able to participate in these plugins, the normal \"namespaces\" provided\n   * must be appending with the missing autoloader prefixes of the themes.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Extension\\ThemeHandlerInterface $theme_handler\n   *   The theme manager used to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Theme\\ThemeManagerInterface $theme_manager\n   *   The theme manager used to invoke the alter hook with.\n   * @param string|null $plugin_interface\n   *   (optional) The interface each plugin should implement.\n   * @param string $plugin_definition_annotation_name\n   *   (optional) The name of the annotation that contains the plugin definition.\n   *   Defaults to 'Drupal\\Component\\Annotation\\Plugin'.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler, ThemeHandlerInterface $theme_handler, ThemeManagerInterface $theme_manager, $plugin_interface = NULL, $plugin_definition_annotation_name = 'Drupal\\Component\\Annotation\\Plugin') {\n    /** @var \\Composer\\Autoload\\ClassLoader $class_loader */\n    $class_loader = \\Drupal::service('class_loader');\n\n    /** @var \\ArrayObject $namespaces */\n    $ns = $namespaces->getArrayCopy();\n\n    foreach ($class_loader->getPrefixesPsr4() as $prefix => $paths) {\n      // Remove trailing path separators.\n      $prefix = trim($prefix, '\\\\');\n\n      // Remove the DRUPAL_ROOT prefix.\n      $path = str_replace(\\Drupal::root() . '/', '', reset($paths));\n\n      // Only add missing contrib theme namespaces.\n      if (preg_match('/^(core|vendor)/', $path) === 0 && !isset($namespaces[$prefix])) {\n        $ns[$prefix] = $path;\n      }\n    }\n\n    // Replace the namespaces data.\n    $namespaces->exchangeArray($ns);\n\n    // Construct the plugin manager now.\n    parent::__construct('Plugin/BootstrapFiveLayouts', $namespaces, $module_handler, $plugin_interface, $plugin_definition_annotation_name);\n\n    // Set the theme handler and manager.\n    $this->themeHandler = $theme_handler;\n    $this->themeManager = $theme_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('container.namespaces'),\n      $container->get('cache.discovery'),\n      $container->get('module_handler'),\n      $container->get('theme_handler'),\n      $container->get('theme.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setContainer(ContainerInterface $container): void {\n    $this->container = $container;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function alterDefinitions(&$definitions) {\n    if ($this->alterHook) {\n      $this->moduleHandler->alter($this->alterHook, $definitions);\n      $this->themeManager->alter($this->alterHook, $definitions);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function providerExists($provider) {\n    return $this->moduleHandler->moduleExists($provider) || $this->themeHandler->themeExists($provider);\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/BootstrapFiveLayoutsPluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BootstrapFiveLayoutsPluginManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ProfileValues in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\migrate;\n\nuse Drupal\\migrate\\Exception\\RequirementsException;\nuse Drupal\\migrate\\MigrateExecutable;\nuse Drupal\\migrate\\Plugin\\Migration;\n\n/**\n * Plugin class for user migrations dealing with profile values.\n */\nclass ProfileValues extends Migration {\n\n  /**\n   * Flag determining whether the process plugin has been initialized.\n   *\n   * @var bool\n   */\n  protected $init = FALSE;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getProcess() {\n    if (!$this->init) {\n      $this->init = TRUE;\n      $definition['source'] = [\n        'plugin' => 'profile_field',\n        'ignore_map' => TRUE,\n      ] + $this->source;\n      $definition['destination']['plugin'] = 'null';\n      $definition['idMap']['plugin'] = 'null';\n      try {\n        $this->checkRequirements();\n        $profile_field_migration = $this->migrationPluginManager->createStubMigration($definition);\n        $migrate_executable = new MigrateExecutable($profile_field_migration);\n        $source_plugin = $profile_field_migration->getSourcePlugin();\n        $source_plugin->checkRequirements();\n        foreach ($source_plugin as $row) {\n          $name = $row->getSourceProperty('name');\n          $fid = $row->getSourceProperty('fid');\n          // The user profile field name can be greater than 32 characters. Use\n          // the migrated profile field name in the process pipeline.\n          $configuration =\n            [\n              'migration' => 'user_profile_field',\n              'source_ids' => $fid,\n              'no_stub' => TRUE,\n            ];\n          $plugin = $this->processPluginManager->createInstance('migration_lookup', $configuration, $profile_field_migration);\n          $new_value = $plugin->transform($fid, $migrate_executable, $row, 'tmp');\n          if (isset($new_value[1])) {\n            // Set the destination to the migrated profile field name.\n            $this->process[$new_value[1]] = $name;\n          }\n        }\n      }\n      catch (RequirementsException) {\n        // The checkRequirements() call will fail when the profile module does\n        // not exist on the source site, or if the required migrations have not\n        // yet run.\n      }\n    }\n    return parent::getProcess();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/migrate/ProfileValues.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProfileValues", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SecurityAudit in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_security',\n  label: new TranslatableMarkup('Security Audit'),\n  description: new TranslatableMarkup('Review permissions, check for exposed data, and identify overly permissive roles.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'critical_issues' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Critical Issues'),\n      description: new TranslatableMarkup('Critical security issues requiring immediate attention'),\n    ),\n    'warnings' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Warnings'),\n      description: new TranslatableMarkup('Security warnings to review'),\n    ),\n    'critical_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Critical Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'warning_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Warning Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'admin_user_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Admin User Count'),\n      description: new TranslatableMarkup('Number of users with administrator role'),\n    ),\n    'registration_mode' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Registration Mode'),\n      description: new TranslatableMarkup('Current user registration setting'),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass SecurityAudit extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->analysisService->securityAudit();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/src/Plugin/tool/Tool/SecurityAudit.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SecurityAudit", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme implementation for the FlowDrop Playground page.\n *\n * This minimal template renders only the page content without Drupal's\n * default page regions (header, breadcrumbs, local actions, etc.).\n * This provides a clean fullscreen canvas for the playground React app.\n *\n * Available variables:\n *\n * General utility variables:\n * - base_path: The base URL path of the Drupal installation. Will usually be\n *   \"/\" unless you have installed Drupal in a sub-directory.\n * - is_front: A flag indicating if the current page is the front page.\n * - logged_in: A flag indicating if the user is registered and signed in.\n * - is_admin: A flag indicating if the user has permission to access\n *   administration pages.\n *\n * Site identity:\n * - front_page: The URL of the front page. Use this instead of base_path when\n *   linking to the front page. This includes the language domain or prefix.\n *\n * Page content (in order of occurrence in the default page.html.twig):\n * - node: Fully loaded node, if there is an automatically-loaded node\n *   associated with the page and the node ID is the second argument in the\n *   page's path (e.g. node/12345 and node/12345/revisions, but not\n *   comment/reply/12345).\n *\n * Regions:\n * - page.header: Items for the header region.\n * - page.pre_content: Items for the pre-content region.\n * - page.breadcrumb: Items for the breadcrumb region.\n * - page.highlighted: Items for the highlighted region.\n * - page.help: Dynamic help text, mostly for admin pages.\n * - page.content: The main content of the current page.\n *\n * @see template_preprocess_page()\n * @see html.html.twig\n */\n#}\n<div class=\"flowdrop-playground-fullscreen\">\n  <main role=\"main\">\n    {{ page.content|without([local_actions_block, gin_secondary_toolbar]) }}\n  </main>\n</div>\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_playground/templates/page--flowdrop-playground.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class OptionsHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\options\\Hook;\n\nuse Drupal\\Core\\Entity\\Exception\\FieldStorageDefinitionUpdateForbiddenException;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\field\\FieldStorageConfigInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for options.\n */\nclass OptionsHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.options':\n        $output = '';\n        $output .= '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The Options module allows you to create fields where data values are selected from a fixed list of options. Usually these items are entered through a select list, checkboxes, or radio buttons. See the <a href=\":field\">Field module help</a> and the <a href=\":field_ui\">Field UI help</a> pages for general information on fields and how to create and manage them. For more information, see the <a href=\":options_do\">online documentation for the Options module</a>.', [\n          ':field' => Url::fromRoute('help.page', [\n            'name' => 'field',\n          ])->toString(),\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n          ':options_do' => 'https://www.drupal.org/documentation/modules/options',\n        ]) . '</p>';\n        $output .= '<h2>' . $this->t('Uses') . '</h2>';\n        $output .= '<dl>';\n        $output .= '<dt>' . $this->t('Managing and displaying list fields') . '</dt>';\n        $output .= '<dd>' . $this->t('The <em>settings</em> and the <em>display</em> of the list fields can be configured separately. See the <a href=\":field_ui\">Field UI help</a> for more information on how to manage fields and their display.', [\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n        ]) . '</dd>';\n        $output .= '<dt>' . $this->t('Defining option keys and labels') . '</dt>';\n        $output .= '<dd>' . $this->t('When you define the list options you can define a key and a label for each option in the list. The label will be shown to the users while the key gets stored in the database.') . '</dd>';\n        $output .= '<dt>' . $this->t('Choosing list field type') . '</dt>';\n        $output .= '<dd>' . $this->t('There are three types of list fields, which store different types of data: <em>float</em>, <em>integer</em> or, <em>text</em>. The <em>float</em> type allows storing approximate decimal values. The <em>integer</em> type allows storing whole numbers, such as years (for example, 2012) or values (for example, 1, 2, 5, 305). The <em>text</em> list field type allows storing text values. No matter which type of list field you choose, you can define whatever labels you wish for data entry.') . '</dd>';\n        $output .= '</dl>';\n        return $output;\n    }\n    return NULL;\n  }\n\n  /**\n   * Implements hook_ENTITY_TYPE_update() for 'field_storage_config'.\n   */\n  #[Hook('field_storage_config_update')]\n  public function fieldStorageConfigUpdate(FieldStorageConfigInterface $field_storage): void {\n    drupal_static_reset('options_allowed_values');\n  }\n\n  /**\n   * Implements hook_ENTITY_TYPE_delete() for 'field_storage_config'.\n   */\n  #[Hook('field_storage_config_delete')]\n  public function fieldStorageConfigDelete(FieldStorageConfigInterface $field_storage): void {\n    drupal_static_reset('options_allowed_values');\n  }\n\n  /**\n   * Implements hook_field_storage_config_update_forbid().\n   */\n  #[Hook('field_storage_config_update_forbid')]\n  public function fieldStorageConfigUpdateForbid(FieldStorageConfigInterface $field_storage, FieldStorageConfigInterface $prior_field_storage): void {\n    if ($field_storage->getTypeProvider() == 'options' && $field_storage->hasData()) {\n      // Forbid any update that removes allowed values with actual data.\n      $allowed_values = $field_storage->getSetting('allowed_values');\n      $prior_allowed_values = $prior_field_storage->getSetting('allowed_values');\n      $lost_keys = array_keys(array_diff_key($prior_allowed_values, $allowed_values));\n      if (_options_values_in_use($field_storage->getTargetEntityTypeId(), $field_storage->getName(), $lost_keys)) {\n        throw new FieldStorageDefinitionUpdateForbiddenException(\"A list field '{$field_storage->getName()}' with existing data cannot have its keys changed.\");\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/options/src/Hook/OptionsHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OptionsHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# API Normalizer task links (tabs) - only working routes\n\n# Main dashboard tabs\napi_normalization.dashboard_tab:\n  title: 'Dashboard'\n  route_name: api_normalization.dashboard\n  base_route: api_normalization.dashboard\n  weight: -10\n\napi_normalization.settings_tab:\n  title: 'Settings'\n  route_name: api_normalization.settings\n  base_route: api_normalization.dashboard\n  weight: -5\n\napi_normalization.config_tab:\n  title: 'Configuration'\n  route_name: api_normalization.config\n  base_route: api_normalization.dashboard\n  weight: 0\n\napi_normalization.providers_tab:\n  title: 'AI Providers'\n  route_name: api_normalization.dashboard_providers\n  base_route: api_normalization.dashboard\n  weight: 5\n\napi_normalization.openapi_tab:\n  title: 'OpenAPI Import'\n  route_name: api_normalization.openapi_import\n  base_route: api_normalization.dashboard\n  weight: 10\n\napi_normalization.endpoints_tab:\n  title: 'API Endpoints'\n  route_name: api_normalization.endpoints\n  base_route: api_normalization.dashboard\n  weight: 15\n\napi_normalization.gateway_tab:\n  title: 'API Gateway'\n  route_name: entity.gateway_route.collection\n  base_route: api_normalization.dashboard\n  weight: 20\n", "metadata": {"source": "repos/api_normalization/api_normalization.links.task.yml", "type": "yaml_reference", "topic": "api normalization.links.task"}}
{"instruction": "Show me the implementation of the class KeyPrunePlan in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\n\n/**\n * Describes what would be pruned without performing changes.\n *\n * @immutable\n */\nfinal class KeyPrunePlan {\n\n  /**\n   * Construct a KeyPrunePlan.\n   *\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId|null $activeKeyId\n   *   The active encryption key ID, if any.\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[] $toDelete\n   *   Encryption key IDs that would be deleted.\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[] $referenced\n   *   Encryption key IDs referenced, in use.\n   */\n  public function __construct(\n    public readonly ?EncryptionKeyId $activeKeyId,\n    public readonly array $toDelete = [],\n    public readonly array $referenced = [],\n  ) {}\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyPrunePlan.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyPrunePlan", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: TimeLogRequestListBuilder.php\nTarget symbol: class TimeLogRequestListBuilder\nNamespace: Drupal\\labor_time_tracker\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TimeLogRequestListBuilder.\n- Include required imports:\n  - Drupal\\Core\\Url\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityListBuilder\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\Core\\Entity\\EntityStorageInterface\n  - Drupal\\Core\\Datetime\\DateFormatterInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildHeader()\n  - buildRow()\n  - createInstance()\n  - getDefaultOperations()\n  - getEntityIds()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\labor_time_tracker;\n\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * List all time log requests.\n */\nclass TimeLogRequestListBuilder extends EntityListBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    EntityTypeInterface $entityType,\n    EntityStorageInterface $storage,\n    protected DateFormatterInterface $dateFormatter,\n  ) {\n    parent::__construct($entityType, $storage);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager')->getStorage($entity_type->id()),\n      $container->get('date.formatter')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityIds() {\n    $query = $this->getStorage()->getQuery()\n      ->accessCheck(TRUE);\n\n    // Sort by status.\n    // Since \"pending\" is alphabetically between \"approved\" and \"rejected\",\n    // we sort by status DESC to likely get \"pending\" near the top,\n    // or use multiple conditions.\n    $query->sort('status', 'DESC');\n    $query->sort('id', 'DESC');\n\n    if ($this->limit) {\n      $query->pager($this->limit);\n    }\n\n    return $query->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    // $header['id']        = $this->t('ID');\n    $header['user']      = $this->t('User');\n    $header['original']  = $this->t('Original Log');\n    $header['new_start'] = $this->t('Proposed Start');\n    $header['new_exit']  = $this->t('Proposed Exit');\n    $header['status']    = $this->t('Status');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    // $row['id']        = $entity->id();\n    $row['user']      = $entity->get('user_id')->entity ? $entity->get('user_id')->entity->label() : 'Unknown';\n    $row['original']  = $entity->get('time_log_id')->entity ? $entity->get('time_log_id')->entity->label() : 'Missing';\n    $row['new_start'] = $this->dateFormatter->format($entity->get('new_enter_time')->value, 'short');\n    $row['new_exit']  = $entity->get('new_exit_time')->value ? $this->dateFormatter->format($entity->get('new_exit_time')->value, 'short') : 'N/A';\n    $row['status']    = $entity->get('status')->value;\n\n    return $row + parent::buildRow($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultOperations(EntityInterface $entity) {\n    $operations = parent::getDefaultOperations($entity);\n\n    // Only show Accept/Reject if the status is pending.\n    if ($entity->get('status')->value == 'pending') {\n      $operations['accept'] = [\n        'title' => $this->t('Accept'),\n        'weight' => -10,\n        'url' => Url::fromRoute('labor_time_tracker.time_log_request.approve', ['time_log_request' => $entity->id()]),\n      ];\n      $operations['reject'] = [\n        'title' => $this->t('Reject'),\n        'weight' => -9,\n        'url' => Url::fromRoute('labor_time_tracker.time_log_request.reject', ['time_log_request' => $entity->id()]),\n      ];\n    }\n\n    return $operations;\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/TimeLogRequestListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TimeLogRequestListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: HtmxLocationResponseData.php\nTarget symbol: class HtmxLocationResponseData\nNamespace: Drupal\\Core\\Htmx\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for HtmxLocationResponseData.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheableMetadata\n  - Drupal\\Core\\Url\n- Ensure these methods exist where relevant:\n  - __construct()\n  - __toString()\n  - getCacheableMetadata()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Htmx;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Url;\n\n/**\n * Optional data object for HX-Location.\n */\nclass HtmxLocationResponseData implements \\Stringable {\n\n  /**\n   * Collects cache data for the URL.\n   */\n  protected CacheableMetadata $cacheableMetadata;\n\n  /**\n   * Data for HX-Location headers.\n   *\n   * @param \\Drupal\\Core\\Url $path\n   *   The path for the GET request.\n   * @param string $source\n   *   The source element of the request.\n   * @param string $event\n   *   An event that \u201ctriggered\u201d the request.\n   * @param string $handler\n   *   A callback that will handle the response HTML.\n   * @param string $target\n   *   The target for the swap.\n   * @param string $swap\n   *   The swap strategy.\n   * @param array<string, string> $values\n   *   A set of values to submit with the request.\n   * @param array<string, string> $headers\n   *   Headers to submit with the request.\n   * @param string $select\n   *   A selector for the content to swap into the target.\n   *\n   * @see https://htmx.org/headers/hx-location/\n   */\n  public function __construct(\n    public readonly Url $path,\n    public readonly string $source = '',\n    public readonly string $event = '',\n    public readonly string $handler = '',\n    public readonly string $target = '',\n    public readonly string $swap = '',\n    public readonly array $values = [],\n    public readonly array $headers = [],\n    public readonly string $select = '',\n  ) {\n    $this->cacheableMetadata = new CacheableMetadata();\n  }\n\n  /**\n   * Returns non-empty data, JSON encoded.\n   *\n   * @return string\n   *   The encoded data.\n   */\n  public function __toString(): string {\n    /** @var \\Drupal\\Core\\GeneratedUrl $generatedUrl */\n    $generatedUrl = $this->path->toString(TRUE);\n    $this->cacheableMetadata->addCacheableDependency($generatedUrl);\n    $path = $generatedUrl->getGeneratedUrl();\n    $data = [\n      'path' => $path,\n      'source' => $this->source,\n      'event' => $this->event,\n      'headers' => $this->headers,\n      'handler' => $this->handler,\n      'target' => $this->target,\n      'swap' => $this->swap,\n      'select' => $this->select,\n      'values' => $this->values,\n    ];\n    $data = array_filter($data, static fn ($item) => $item !== '' && $item !== []);\n    return json_encode($data);\n  }\n\n  /**\n   * Retrieves the cacheable metadata associated with the URL.\n   *\n   * @return \\Drupal\\Core\\Cache\\CacheableMetadata\n   *   The cacheable metadata instance.\n   */\n  public function getCacheableMetadata(): CacheableMetadata {\n    return $this->cacheableMetadata;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Htmx/HtmxLocationResponseData.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HtmxLocationResponseData", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - media\nid: media.square\nlabel: Square\ndescription: ''\ntargetEntityType: media\ncache: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_view_mode.media.square.yml", "type": "yaml_reference", "topic": "core.entity view mode.media.square"}}
{"instruction": "Show me the implementation of the class ConfigurableLanguageRenderer in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Entity\\Render;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\views\\ResultRow;\nuse Drupal\\views\\ViewExecutable;\n\n/**\n * Renders entities in a configured language.\n */\nclass ConfigurableLanguageRenderer extends EntityTranslationRendererBase {\n\n  /**\n   * A specific language code for rendering if available.\n   *\n   * @var string|null\n   */\n  protected $langcode;\n\n  /**\n   * Constructs a renderer object.\n   *\n   * @param \\Drupal\\views\\ViewExecutable $view\n   *   The entity row being rendered.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string|null $langcode\n   *   A specific language code to set, if available.\n   */\n  public function __construct(ViewExecutable $view, LanguageManagerInterface $language_manager, EntityTypeInterface $entity_type, $langcode) {\n    parent::__construct($view, $language_manager, $entity_type);\n    $this->langcode = $langcode;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLangcode(ResultRow $row) {\n    return $this->langcode;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Entity/Render/ConfigurableLanguageRenderer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigurableLanguageRenderer", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DeleteField.php\nTarget symbol: class DeleteField\nNamespace: Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DeleteField.\n- Include required imports:\n  - Drupal\\mcp_tools_structure\\Service\\FieldService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\FieldService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_delete_field',\n  label: new TranslatableMarkup('Delete Field'),\n  description: new TranslatableMarkup('Delete a field from an entity bundle. Data will be lost!'),\n  operation: ToolOperation::Write,\n  destructive: TRUE,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: 'node',\n    ),\n    'bundle' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'field_name' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Name'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'field_name' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Deleted Field Name'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DeleteField extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected FieldService $fieldService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->fieldService = $container->get('mcp_tools_structure.field');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? 'node';\n    $bundle = $input['bundle'] ?? '';\n    $fieldName = $input['field_name'] ?? '';\n\n    if (empty($bundle) || empty($fieldName)) {\n      return ['success' => FALSE, 'error' => 'bundle and field_name are required.'];\n    }\n\n    return $this->fieldService->deleteField($entityType, $bundle, $fieldName);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_structure/src/Plugin/tool/Tool/DeleteField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteField", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ImportDraftForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Form;\n\nuse Drupal\\Core\\Entity\\EntityForm;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form handler for Import Draft entities.\n */\nclass ImportDraftForm extends EntityForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state): array {\n    $form = parent::form($form, $form_state);\n\n    $entity = $this->entity;\n\n    $form['label'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Label'),\n      '#default_value' => $entity->label(),\n      '#required' => TRUE,\n    ];\n\n    $form['id'] = [\n      '#type' => 'machine_name',\n      '#default_value' => $entity->id(),\n      '#machine_name' => [\n        'exists' => [$this, 'exists'],\n        'source' => ['label'],\n      ],\n      '#disabled' => !$entity->isNew(),\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state): void {\n    $entity = $this->entity;\n    $status = $entity->save();\n\n    $this->messenger()->addStatus($this->t('Import draft @label saved.', [\n      '@label' => $entity->label(),\n    ]));\n\n    $form_state->setRedirect('entity.api_normalization_import_draft.collection');\n  }\n\n  /**\n   * Checks if an entity with the given ID exists.\n   *\n   * @param string $id\n   *   Entity ID.\n   *\n   * @return bool\n   *   TRUE if exists.\n   */\n  public function exists(string $id): bool {\n    $storage = $this->entityTypeManager->getStorage('api_normalization_import_draft');\n    return (bool) $storage->load($id);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Form/ImportDraftForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImportDraftForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait ConditionAccessResolverTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Condition;\n\nuse Drupal\\Component\\Plugin\\Exception\\ContextException;\n\n/**\n * Resolves a set of conditions.\n */\ntrait ConditionAccessResolverTrait {\n\n  /**\n   * Resolves the given conditions based on the condition logic ('and'/'or').\n   *\n   * @param \\Drupal\\Core\\Condition\\ConditionInterface[] $conditions\n   *   A set of conditions.\n   * @param string $condition_logic\n   *   The logic used to compute access, either 'and' or 'or'.\n   *\n   * @return bool\n   *   Whether these conditions grant or deny access.\n   */\n  protected function resolveConditions($conditions, $condition_logic) {\n    foreach ($conditions as $condition) {\n      try {\n        $pass = $condition->execute();\n      }\n      catch (ContextException) {\n        // If a condition is missing context and is not negated, consider that a\n        // fail.\n        $pass = $condition->isNegated();\n      }\n\n      // If a condition fails and all conditions were needed, deny access.\n      if (!$pass && $condition_logic == 'and') {\n        return FALSE;\n      }\n      // If a condition passes and only one condition was needed, grant access.\n      elseif ($pass && $condition_logic == 'or') {\n        return TRUE;\n      }\n    }\n\n    // Return TRUE if logic was 'and', meaning all rules passed.\n    // Return FALSE if logic was 'or', meaning no rule passed.\n    return $condition_logic == 'and';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Condition/ConditionAccessResolverTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "ConditionAccessResolverTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Book in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Plugin\\Condition;\n\nuse Drupal\\Core\\Condition\\Attribute\\Condition;\nuse Drupal\\Core\\Condition\\ConditionPluginBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Plugin\\Context\\EntityContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\book\\BookManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a 'Book' condition.\n */\n#[Condition(\n  id: \"book\",\n  label: new TranslatableMarkup(\"Book\"),\n  context_definitions: [\n    \"node\" => new EntityContextDefinition(\n      data_type: \"entity:node\",\n      label: new TranslatableMarkup(\"Node\"),\n    ),\n  ]\n)]\nclass Book extends ConditionPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * Creates a new NodeType instance.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   * @param array $configuration\n   *   The plugin configuration, i.e. an array with configuration values keyed\n   *   by configuration option name. The special key 'context' may be used to\n   *   initialize the defined contexts by setting it to an array of context\n   *   values keyed by context names.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   */\n  public function __construct(\n    protected BookManagerInterface $bookManager,\n    array $configuration,\n    string $plugin_id,\n    mixed $plugin_definition,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $container->get('book.manager'),\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $options = [];\n    $books = $this->bookManager->getAllBooks();\n    foreach ($books as $bid => $book) {\n      $options[$bid] = $book['title'];\n    }\n    $form['books'] = [\n      '#title' => $this->t('Books'),\n      '#type' => 'checkboxes',\n      '#options' => $options,\n      '#default_value' => $this->configuration['books'],\n    ];\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state): void {\n    $this->configuration['books'] = array_filter($form_state->getValue('books'));\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summary() {\n    $books = array_intersect_key($this->bookManager->getAllBooks(), array_combine($this->configuration['books'], $this->configuration['books']));\n    $book_titles = array_column($books, 'title');\n\n    if (count($book_titles) > 1) {\n      $last = array_pop($book_titles);\n      $book_titles = implode(', ', $book_titles);\n      return $this->t('The node is part of the @books or @last books', ['@books' => $book_titles, '@last' => $last]);\n    }\n    elseif (count($book_titles) == 1) {\n      $book = reset($book_titles);\n      return $this->t('The node is part of the @book book', ['@book' => $book]);\n    }\n    return $this->t('The node is not part of any books');\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\ContextException\n   */\n  public function evaluate(): bool {\n    if (empty($this->configuration['books']) && !$this->isNegated()) {\n      return TRUE;\n    }\n    $node = $this->getContextValue('node');\n    $book = $node->getBook();\n    if (!empty($book['bid'])) {\n      return !empty($this->configuration['books'][$book['bid']]);\n    }\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return [\n      'books' => [],\n    ] + parent::defaultConfiguration();\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/Condition/Book.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Book", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: AddField.php\nTarget symbol: class AddField\nNamespace: Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for AddField.\n- Include required imports:\n  - Drupal\\mcp_tools_structure\\Service\\FieldService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\FieldService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_add_field',\n  label: new TranslatableMarkup('Add Field'),\n  description: new TranslatableMarkup('Add a field to a content type, taxonomy vocabulary, or other entity bundle.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup('node, taxonomy_term, user, etc.'),\n      required: FALSE,\n      default_value: 'node',\n    ),\n    'bundle' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup('Content type or vocabulary ID'),\n      required: TRUE,\n    ),\n    'field_name' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Name'),\n      description: new TranslatableMarkup('Machine name (field_ prefix auto-added)'),\n      required: TRUE,\n    ),\n    'field_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Type'),\n      description: new TranslatableMarkup('string, text_long, integer, boolean, entity_reference, image, etc.'),\n      required: TRUE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'required' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Required'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: FALSE,\n    ),\n    'description' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Help Text'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'cardinality' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Cardinality'),\n      description: new TranslatableMarkup('1 for single, -1 for unlimited'),\n      required: FALSE,\n      default_value: 1,\n    ),\n    'target_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Reference Target Type'),\n      description: new TranslatableMarkup('For entity_reference: node, taxonomy_term, user, media'),\n      required: FALSE,\n    ),\n    'target_bundles' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Reference Target Bundles'),\n      description: new TranslatableMarkup('Limit references to specific bundles'),\n      required: FALSE,\n    ),\n    'allowed_values' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Allowed Values'),\n      description: new TranslatableMarkup('For list fields'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'field_name' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Name'),\n      description: new TranslatableMarkup(''),\n    ),\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'bundle' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass AddField extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected FieldService $fieldService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->fieldService = $container->get('mcp_tools_structure.field');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? 'node';\n    $bundle = $input['bundle'] ?? '';\n    $fieldName = $input['field_name'] ?? '';\n    $fieldType = $input['field_type'] ?? '';\n    $label = $input['label'] ?? '';\n\n    if (empty($bundle) || empty($fieldName) || empty($fieldType) || empty($label)) {\n      return ['success' => FALSE, 'error' => 'bundle, field_name, field_type, and label are required.'];\n    }\n\n    $options = [];\n    if (isset($input['required'])) $options['required'] = $input['required'];\n    if (isset($input['description'])) $options['description'] = $input['description'];\n    if (isset($input['cardinality'])) $options['cardinality'] = $input['cardinality'];\n    if (isset($input['target_type'])) $options['target_type'] = $input['target_type'];\n    if (isset($input['target_bundles'])) $options['target_bundles'] = $input['target_bundles'];\n    if (isset($input['allowed_values'])) $options['allowed_values'] = $input['allowed_values'];\n\n    return $this->fieldService->addField($entityType, $bundle, $fieldName, $fieldType, $label, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_structure/src/Plugin/tool/Tool/AddField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AddField", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: BlockEntitySettingTrayForm.php\nTarget symbol: class BlockEntitySettingTrayForm\nNamespace: Drupal\\settings_tray\\Block\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BlockEntitySettingTrayForm.\n- Include required imports:\n  - Drupal\\block\\BlockForm\n  - Drupal\\block\\BlockInterface\n  - Drupal\\Component\\Utility\\Html\n  - Drupal\\Core\\Ajax\\AjaxFormHelperTrait\n  - Drupal\\Core\\Ajax\\AjaxResponse\n  - Drupal\\Core\\Ajax\\RedirectCommand\n  - Drupal\\Core\\Block\\BlockPluginInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - actions()\n  - buildForm()\n  - buildVisibilityInterface()\n  - form()\n  - getPluginForm()\n  - getRedirectUrl()\n  - submitVisibility()\n  - successfulAjaxSubmit()\n  - title()\n  - validateVisibility()", "output": "<?php\n\nnamespace Drupal\\settings_tray\\Block;\n\nuse Drupal\\block\\BlockForm;\nuse Drupal\\block\\BlockInterface;\nuse Drupal\\Component\\Utility\\Html;\nuse Drupal\\Core\\Ajax\\AjaxFormHelperTrait;\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\RedirectCommand;\nuse Drupal\\Core\\Block\\BlockPluginInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\PluginWithFormsInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Provides form for block instance forms when used in the off-canvas dialog.\n *\n * This form removes advanced sections of regular block form such as the\n * visibility settings, machine ID and region.\n *\n * @internal\n */\nclass BlockEntitySettingTrayForm extends BlockForm {\n\n  use AjaxFormHelperTrait;\n\n  /**\n   * Provides a title callback to get the block's admin label.\n   *\n   * @param \\Drupal\\block\\BlockInterface $block\n   *   The block entity.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n   *   The title.\n   */\n  public function title(BlockInterface $block) {\n    // @todo Wrap \"Configure \" in <span class=\"visually-hidden\"></span> once\n    //   https://www.drupal.org/node/2359901 is fixed.\n    return $this->t('Configure @block', ['@block' => $block->getPlugin()->getPluginDefinition()['admin_label']]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    $form = parent::form($form, $form_state);\n\n    // Create link to full block form.\n    $query = [];\n    if ($destination = $this->getRequest()->query->get('destination')) {\n      $query['destination'] = $destination;\n    }\n    $form['advanced_link'] = [\n      '#type' => 'link',\n      '#title' => $this->t('Advanced block options'),\n      '#url' => $this->entity->toUrl('edit-form', ['query' => $query]),\n      '#weight' => 1000,\n    ];\n\n    // Remove the ID and region elements.\n    unset($form['id'], $form['region'], $form['settings']['admin_label']);\n\n    if (isset($form['settings']['label_display']) && isset($form['settings']['label'])) {\n      // Only show the label input if the label will be shown on the page.\n      $form['settings']['label_display']['#weight'] = -100;\n      $form['settings']['label']['#states']['visible'] = [\n        ':input[name=\"settings[label_display]\"]' => ['checked' => TRUE],\n      ];\n\n      // Relabel to \"Block title\" because on the front-end this may be confused\n      // with page title.\n      $form['settings']['label']['#title'] = $this->t(\"Block title\");\n      $form['settings']['label_display']['#title'] = $this->t(\"Display block title\");\n    }\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    $actions = parent::actions($form, $form_state);\n    $actions['submit']['#value'] = $this->t('Save @block', ['@block' => $this->entity->getPlugin()->getPluginDefinition()['admin_label']]);\n    $actions['delete']['#access'] = FALSE;\n    return $actions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildVisibilityInterface(array $form, FormStateInterface $form_state) {\n    // Do not display the visibility.\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function validateVisibility(array $form, FormStateInterface $form_state) {\n    // Intentionally empty.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function submitVisibility(array $form, FormStateInterface $form_state) {\n    // Intentionally empty.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getPluginForm(BlockPluginInterface $block) {\n    if ($block instanceof PluginWithFormsInterface) {\n      return $this->pluginFormFactory->createInstance($block, 'settings_tray', 'configure');\n    }\n    return $block;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form = parent::buildForm($form, $form_state);\n    $form['actions']['submit']['#ajax'] = [\n      'callback' => '::ajaxSubmit',\n    ];\n    $form['#attached']['library'][] = 'core/drupal.dialog.ajax';\n\n    // static::ajaxSubmit() requires data-drupal-selector to be the same between\n    // the various Ajax requests. A bug in \\Drupal\\Core\\Form\\FormBuilder\n    // prevents that from happening unless $form['#id'] is also the same.\n    // Normally, #id is set to a unique HTML ID via Html::getUniqueId(), but\n    // here we bypass that in order to work around the data-drupal-selector bug.\n    // This is okay so long as we assume that this form only ever occurs once on\n    // a page.\n    // @todo Remove this workaround once https://www.drupal.org/node/2897377 is\n    //   fixed.\n    $form['#id'] = Html::getId($form_state->getBuildInfo()['form_id']);\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function successfulAjaxSubmit(array $form, FormStateInterface $form_state) {\n    if ($redirect_url = $this->getRedirectUrl()) {\n      $command = new RedirectCommand($redirect_url->setAbsolute()->toString());\n    }\n    else {\n      // Settings Tray always provides a destination.\n      throw new \\Exception(\"No destination provided by Settings Tray form\");\n    }\n    $response = new AjaxResponse();\n    return $response->addCommand($command);\n  }\n\n  /**\n   * Gets the form's redirect URL from 'destination' provide in the request.\n   *\n   * @return \\Drupal\\Core\\Url|null\n   *   The redirect URL or NULL if dialog should just be closed.\n   */\n  protected function getRedirectUrl() {\n    // \\Drupal\\Core\\Routing\\RedirectDestination::get() cannot be used directly\n    // because it will use <current> if 'destination' is not in the query\n    // string.\n    if ($this->getRequest()->query->has('destination') && $destination = $this->getRedirectDestination()->get()) {\n      return Url::fromUserInput('/' . $destination);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/settings_tray/src/Block/BlockEntitySettingTrayForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockEntitySettingTrayForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class ApiMappingConfigHtmlRouteProvider in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Provides routes for API Mapping config entities.\n */\nclass ApiMappingConfigHtmlRouteProvider extends AdminHtmlRouteProvider {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoutes(EntityTypeInterface $entity_type) {\n    $collection = parent::getRoutes($entity_type);\n\n    // Add custom routes.\n    if ($test_route = $this->getTestRoute($entity_type)) {\n      $collection->add(\"api_normalization.mapping_test\", $test_route);\n    }\n\n    if ($preview_route = $this->getPreviewRoute($entity_type)) {\n      $collection->add(\"api_normalization.mapping_preview\", $preview_route);\n    }\n\n    return $collection;\n  }\n\n  /**\n   * Gets the test route.\n   */\n  protected function getTestRoute(EntityTypeInterface $entity_type) {\n    $route = new Route('/admin/config/services/api-normalizer/mappings/{api_mapping_config}/test');\n    $route\n      ->setDefaults([\n        '_controller' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::testMapping',\n        '_title_callback' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::testTitle',\n      ])\n      ->setRequirement('_permission', 'administer api normalizer')\n      ->setOption('_admin_route', TRUE)\n      ->setOption('parameters', [\n        'api_mapping_config' => ['type' => 'entity:api_mapping_config'],\n      ]);\n\n    return $route;\n  }\n\n  /**\n   * Gets the preview route.\n   */\n  protected function getPreviewRoute(EntityTypeInterface $entity_type) {\n    $route = new Route('/admin/config/services/api-normalizer/mappings/{api_mapping_config}/preview');\n    $route\n      ->setDefaults([\n        '_controller' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::previewMapping',\n        '_title_callback' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::previewTitle',\n      ])\n      ->setRequirement('_permission', 'administer api normalizer')\n      ->setOption('_admin_route', TRUE)\n      ->setOption('parameters', [\n        'api_mapping_config' => ['type' => 'entity:api_mapping_config'],\n      ]);\n\n    return $route;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Entity/ApiMappingConfigHtmlRouteProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiMappingConfigHtmlRouteProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: PHPStan", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Development tools](/docs/develop/development-tools)\n\n* [Development tools overview](/docs/develop/development-tools/development-tools-overview)\n* [Drush](/docs/develop/development-tools/drush)\n* [Editors and IDEs](/docs/develop/development-tools/editors-and-ides)\n* [DrupalPod](/docs/develop/development-tools/drupalpod)\n* [XHProf Code Profiler](/docs/develop/development-tools/xhprof-code-profiler)\n* [Xdebug debugger](/docs/develop/development-tools/xdebug-debugger)\n* [Disable caching](/docs/develop/development-tools/disabling-and-debugging-caching)\n* [PHPStan](/docs/develop/development-tools/phpstan)\n* [Stylelint](/docs/develop/development-tools/stylelint)\n* [Working efficiently with the command line](/docs/develop/development-tools/working-efficiently-with-the-command-line)\n* [cspell](/docs/develop/development-tools/cspell \"Automated code spell checking via cspell\")\n\n# PHPStan\n\n[PHPStan](https://phpstan.dev/)\u00a0is a static analysis tool that allows you to find bugs in your codebase without running the code. The [phpstan-drupal extension](https://github.com/mglaman/phpstan-drupal) for PHPStan makes it possible to perform static analysis of Drupal code.\n\n## [Getting started](/docs/develop/development-tools/phpstan/getting-started)\n\nInstalling PHPStan and related extensions\n\n## [Fixing reports of undefined methods](/docs/develop/development-tools/phpstan/fixing-reports-of-undefined-methods)\n\nIs PHPStan reporting a method as missing when you know it exists?\n\n## [Handling \"Unsafe usage of new static()\"](/docs/develop/development-tools/phpstan/handling-unsafe-usage-of-new-static)\n\nHow to handle the error of \"Unsafe usage of new static()\"\n\n## [PHPStan in Drupal core](/docs/develop/development-tools/phpstan/phpstan-in-drupal-core)\n\nSpecific information about how PHPStan is used in Drupal core, for example with its baseline.\n\n## Tags\n\n[phpstan](/taxonomy/term/196898)\n\n[static analysis](/taxonomy/term/196899)\n\n## Guide maintainers\n\n[![mglaman's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-2416470-1733517870.jpg?itok=dpr1kEgM)](/user/2416470 \"View mglaman's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/development-tools/phpstan.md", "type": "doc_summary", "topic": "PHPStan"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: KeyPrunePlan\nSource file: <source_file>\nFile name hint: KeyPrunePlan.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\n\n/**\n * Describes what would be pruned without performing changes.\n *\n * @immutable\n */\nfinal class KeyPrunePlan {\n\n  /**\n   * Construct a KeyPrunePlan.\n   *\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId|null $activeKeyId\n   *   The active encryption key ID, if any.\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[] $toDelete\n   *   Encryption key IDs that would be deleted.\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[] $referenced\n   *   Encryption key IDs referenced, in use.\n   */\n  public function __construct(\n    public readonly ?EncryptionKeyId $activeKeyId,\n    public readonly array $toDelete = [],\n    public readonly array $referenced = [],\n  ) {}\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\n\n/**\n * Describes what would be pruned without performing changes.\n *\n * @immutable\n */\nfinal class KeyPrunePlan {\n\n  /**\n   * Construct a KeyPrunePlan.\n   *\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId|null $activeKeyId\n   *   The active encryption key ID, if any.\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[] $toDelete\n   *   Encryption key IDs that would be deleted.\n   * @param \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[] $referenced\n   *   Encryption key IDs referenced, in use.\n   */\n  public function __construct(\n    public readonly ?EncryptionKeyId $activeKeyId,\n    public readonly array $toDelete = [],\n    public readonly array $referenced = [],\n  ) {}\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyPrunePlan.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyPrunePlan", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class AddField in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\FieldService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_add_field',\n  label: new TranslatableMarkup('Add Field'),\n  description: new TranslatableMarkup('Add a field to a content type, taxonomy vocabulary, or other entity bundle.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup('node, taxonomy_term, user, etc.'),\n      required: FALSE,\n      default_value: 'node',\n    ),\n    'bundle' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup('Content type or vocabulary ID'),\n      required: TRUE,\n    ),\n    'field_name' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Name'),\n      description: new TranslatableMarkup('Machine name (field_ prefix auto-added)'),\n      required: TRUE,\n    ),\n    'field_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Type'),\n      description: new TranslatableMarkup('string, text_long, integer, boolean, entity_reference, image, etc.'),\n      required: TRUE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'required' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Required'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: FALSE,\n    ),\n    'description' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Help Text'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'cardinality' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Cardinality'),\n      description: new TranslatableMarkup('1 for single, -1 for unlimited'),\n      required: FALSE,\n      default_value: 1,\n    ),\n    'target_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Reference Target Type'),\n      description: new TranslatableMarkup('For entity_reference: node, taxonomy_term, user, media'),\n      required: FALSE,\n    ),\n    'target_bundles' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Reference Target Bundles'),\n      description: new TranslatableMarkup('Limit references to specific bundles'),\n      required: FALSE,\n    ),\n    'allowed_values' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Allowed Values'),\n      description: new TranslatableMarkup('For list fields'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'field_name' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Field Name'),\n      description: new TranslatableMarkup(''),\n    ),\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'bundle' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass AddField extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected FieldService $fieldService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->fieldService = $container->get('mcp_tools_structure.field');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? 'node';\n    $bundle = $input['bundle'] ?? '';\n    $fieldName = $input['field_name'] ?? '';\n    $fieldType = $input['field_type'] ?? '';\n    $label = $input['label'] ?? '';\n\n    if (empty($bundle) || empty($fieldName) || empty($fieldType) || empty($label)) {\n      return ['success' => FALSE, 'error' => 'bundle, field_name, field_type, and label are required.'];\n    }\n\n    $options = [];\n    if (isset($input['required'])) $options['required'] = $input['required'];\n    if (isset($input['description'])) $options['description'] = $input['description'];\n    if (isset($input['cardinality'])) $options['cardinality'] = $input['cardinality'];\n    if (isset($input['target_type'])) $options['target_type'] = $input['target_type'];\n    if (isset($input['target_bundles'])) $options['target_bundles'] = $input['target_bundles'];\n    if (isset($input['allowed_values'])) $options['allowed_values'] = $input['allowed_values'];\n\n    return $this->fieldService->addField($entityType, $bundle, $fieldName, $fieldType, $label, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_structure/src/Plugin/tool/Tool/AddField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AddField", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Communicating the results", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Usability testing](/docs/develop/usability-testing)\n\n* [Usability testing](/docs/develop/usability-testing/usability-testing)\n* [Drupal usability test results](/docs/develop/usability-testing/results)\n* [Tutorial how-to conduct usability testing](/docs/develop/usability-testing/conducting-a-usability-test)\n* [Recording a usability test](/docs/develop/usability-testing/recording-a-usability-test)\n* [Communicate the results effectively with the community](/docs/develop/usability-testing/communicating-the-results)\n\n# Communicating the results\n\nLast [updated](/node/1319122/discuss) on\n\n27 September 2024\n\nHere are some ways to effectively communicate the results of a usability test:\n\n* Share [recordings](https://www.drupal.org/docs/develop/usability-testing/recording-a-usability-test#comment-12871101) of your test (with your participants' consent)\n* Summarize your test, including your methodology,\u00a0findings, and recommendations, in a blog post\n* Create actual issues based on the results of your test\n* Stay involved with the community to ensure the issues\u00a0are addressed in a timely manner \u2013 use [Drupal Slack](https://drupal.slack.com/)\u00a0to get in touch.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/1319122/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%281319122%29%20Communicating%20the%20results) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/usability-testing/communicating-the-results.md", "type": "doc_summary", "topic": "Communicating the results"}}
{"instruction": "Show me the implementation of the interface FieldTranslationSynchronizerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\content_translation;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\n\n/**\n * Provides field translation synchronization capabilities.\n */\ninterface FieldTranslationSynchronizerInterface {\n\n  /**\n   * Performs field column synchronization on the given entity.\n   *\n   * Field column synchronization takes care of propagating any change in the\n   * field items order and in the column values themselves to all the available\n   * translations. This functionality is provided by defining a\n   * 'translation_sync' key for the 'content_translation' module's portion of\n   * the field definition's 'third_party_settings', holding an array of\n   * column names to be synchronized. The synchronized column values are shared\n   * across translations, while the rest varies per-language. This is useful for\n   * instance to translate the \"alt\" and \"title\" textual elements of an image\n   * field, while keeping the same image on every translation.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity whose values should be synchronized.\n   * @param string $sync_langcode\n   *   The language of the translation whose values should be used as source for\n   *   synchronization.\n   * @param string $original_langcode\n   *   (optional) If a new translation is being created, this should be the\n   *   language code of the original values. Defaults to NULL.\n   */\n  public function synchronizeFields(ContentEntityInterface $entity, $sync_langcode, $original_langcode = NULL);\n\n  /**\n   * Synchronize the items of a single field.\n   *\n   * All the column values of the \"active\" language are compared to the\n   * unchanged values to detect any addition, removal or change in the items\n   * order. Subsequently the detected changes are performed on the field items\n   * in other available languages.\n   *\n   * @param array $field_values\n   *   The field values to be synchronized.\n   * @param array $unchanged_items\n   *   The unchanged items to be used to detect changes.\n   * @param string $sync_langcode\n   *   The language code of the items to use as source values.\n   * @param array $translations\n   *   An array of all the available language codes for the given field.\n   * @param array $properties\n   *   An array of property names to be synchronized.\n   */\n  public function synchronizeItems(array &$field_values, array $unchanged_items, $sync_langcode, array $translations, array $properties);\n\n  /**\n   * Returns the synchronized properties for the specified field definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldDefinitionInterface $field_definition\n   *   A field definition.\n   *\n   * @return string[]\n   *   An array of synchronized field property names.\n   */\n  public function getFieldSynchronizedProperties(FieldDefinitionInterface $field_definition);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/src/FieldTranslationSynchronizerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FieldTranslationSynchronizerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ViewsArgument in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\views\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\n\n/**\n * Defines a ViewsArgument attribute for plugin discovery.\n *\n * @see \\Drupal\\views\\Plugin\\views\\argument\\ArgumentPluginBase\n *\n * @ingroup views_argument_handlers\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass ViewsArgument extends Plugin {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Attribute/ViewsArgument.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsArgument", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SkipOp.php\nTarget symbol: class SkipOp\nNamespace: Drupal\\Composer\\Plugin\\Scaffold\\Operations\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SkipOp.\n- Include required imports:\n  - Composer\\IO\\IOInterface\n  - Drupal\\Composer\\Plugin\\Scaffold\\ScaffoldFilePath\n  - Drupal\\Composer\\Plugin\\Scaffold\\ScaffoldOptions\n- Ensure these methods exist where relevant:\n  - __construct()\n  - generateContents()\n  - process()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold\\Operations;\n\nuse Composer\\IO\\IOInterface;\nuse Drupal\\Composer\\Plugin\\Scaffold\\ScaffoldFilePath;\nuse Drupal\\Composer\\Plugin\\Scaffold\\ScaffoldOptions;\n\n/**\n * Scaffold operation to skip a scaffold file (do nothing).\n *\n * @internal\n */\nclass SkipOp extends AbstractOperation {\n\n  /**\n   * Identifies Skip operations.\n   */\n  const ID = 'skip';\n\n  /**\n   * The message to output while processing.\n   *\n   * @var string\n   */\n  protected $message;\n\n  /**\n   * SkipOp constructor.\n   *\n   * @param string $message\n   *   (optional) A custom message to output while skipping.\n   */\n  public function __construct($message = \"  - Skip <info>[dest-rel-path]</info>: disabled\") {\n    $this->message = $message;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function generateContents() {\n    return '';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ScaffoldFilePath $destination, IOInterface $io, ScaffoldOptions $options) {\n    $interpolator = $destination->getInterpolator();\n    $io->write($interpolator->interpolate($this->message));\n    return new ScaffoldResult($destination, FALSE);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/Operations/SkipOp.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SkipOp", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Feature Flags Configuration\n# Controls optional functionality based on contrib module availability\n\nfeatures:\n  graphql_integration:\n    label: 'GraphQL Integration'\n    description: 'Provides GraphQL query interface for API endpoints. Requires graphql and graphql_compose modules.'\n    enabled: false\n    required_modules:\n      - graphql\n      - graphql_compose\n    category: 'api_interface'\n\n  eca_integration:\n    label: 'ECA Workflow Integration'\n    description: 'Event-Condition-Action workflow automation for API orchestration. Requires eca module.'\n    enabled: false\n    required_modules:\n      - eca\n    category: 'automation'\n\n  feeds_integration:\n    label: 'Feeds Data Import'\n    description: 'Bulk API imports via Feeds integration. Requires feeds module.'\n    enabled: false\n    required_modules:\n      - feeds\n    category: 'data_import'\n\n  ai_agents:\n    label: 'AI Agents Integration'\n    description: 'AI service integration (OpenAI, Anthropic, Ollama) and agent framework. Requires ai and ai_agents modules.'\n    enabled: false\n    required_modules:\n      - ai\n      - ai_agents\n    category: 'ai_services'\n\n  ckeditor_ai:\n    label: 'CKEditor AI Integration'\n    description: 'AI-powered content editing features in CKEditor. Requires ckeditor_ai_agent module.'\n    enabled: false\n    required_modules:\n      - ckeditor_ai_agent\n    category: 'ai_services'\n\n  openapi_generation:\n    label: 'OpenAPI Spec Generation'\n    description: 'Automatic OpenAPI specification generation from Drupal APIs. Requires openapi and openapi_jsonapi modules.'\n    enabled: false\n    required_modules:\n      - openapi\n      - openapi_jsonapi\n    category: 'api_documentation'\n\n  jwt_auth:\n    label: 'JWT Authentication'\n    description: 'JSON Web Token authentication for secure API access. Requires jwt module.'\n    enabled: false\n    required_modules:\n      - jwt\n    category: 'authentication'\n\n  key_management:\n    label: 'Secure Key Management'\n    description: 'Secure storage for API keys and secrets. Requires key module.'\n    enabled: false\n    required_modules:\n      - key\n    category: 'security'\n\n  flowdrop_integration:\n    label: 'FlowDrop Workflow Engine'\n    description: 'FlowDrop workflow integration features. Requires flowdrop module.'\n    enabled: false\n    required_modules:\n      - flowdrop\n    category: 'automation'\n\n  mcp_integration:\n    label: 'MCP Tools Integration'\n    description: 'Model Context Protocol (MCP) tools integration for AI agents.'\n    enabled: true\n    required_modules: []\n    category: 'ai_services'\n\n  jsonapi_extras:\n    label: 'JSON:API Extras'\n    description: 'Enhanced JSON:API configuration and customization options. Requires jsonapi_extras module.'\n    enabled: false\n    required_modules:\n      - jsonapi_extras\n    category: 'api_interface'\n\n  rate_limiting:\n    label: 'Rate Limiting'\n    description: 'API throttling and protection. Requires rate_limit module.'\n    enabled: false\n    required_modules:\n      - rate_limit\n    category: 'security'\n\n  advanced_caching:\n    label: 'Advanced Cache Control'\n    description: 'Enhanced cache control for API response optimization. Requires cache_control module.'\n    enabled: false\n    required_modules:\n      - cache_control\n    category: 'performance'\n\n  eck_entities:\n    label: 'ECK Custom Entities'\n    description: 'Entity Construction Kit for custom entity types in API workflows. Requires eck module.'\n    enabled: false\n    required_modules:\n      - eck\n    category: 'entity_management'\n\n  rules_automation:\n    label: 'Rules Engine'\n    description: 'Business rules engine for workflow automation. Requires rules module.'\n    enabled: false\n    required_modules:\n      - rules\n    category: 'automation'\n\n  webform_config:\n    label: 'Webform Configuration UI'\n    description: 'Advanced form builder for API configuration interfaces. Requires webform module.'\n    enabled: false\n    required_modules:\n      - webform\n    category: 'ui_enhancement'\n\n  ossa_agents:\n    label: 'OSSA Agent Manifests'\n    description: 'OpenStandardAgents (OSSA) manifest import/export via api_normalization_agents submodule. Requires bluefly/openstandardagents library.'\n    enabled: false\n    required_modules: []\n    required_libraries:\n      - 'bluefly/openstandardagents'\n    category: 'ai_services'\n\n# Feature categories for organization\ncategories:\n  api_interface:\n    label: 'API Interfaces'\n    description: 'Different API interface types (GraphQL, JSON:API enhancements)'\n    weight: 0\n\n  ai_services:\n    label: 'AI Services'\n    description: 'AI provider integrations and agent frameworks'\n    weight: 1\n\n  automation:\n    label: 'Workflow Automation'\n    description: 'Automation and orchestration engines'\n    weight: 2\n\n  data_import:\n    label: 'Data Import/Export'\n    description: 'Bulk data operations and migrations'\n    weight: 3\n\n  authentication:\n    label: 'Authentication'\n    description: 'Authentication and authorization mechanisms'\n    weight: 4\n\n  security:\n    label: 'Security'\n    description: 'Security enhancements and protections'\n    weight: 5\n\n  performance:\n    label: 'Performance'\n    description: 'Caching and performance optimization'\n    weight: 6\n\n  api_documentation:\n    label: 'API Documentation'\n    description: 'API specification and documentation tools'\n    weight: 7\n\n  entity_management:\n    label: 'Entity Management'\n    description: 'Custom entity types and management'\n    weight: 8\n\n  ui_enhancement:\n    label: 'UI Enhancements'\n    description: 'User interface improvements'\n    weight: 9\n", "metadata": {"source": "repos/api_normalization/config/install/api_normalization.features.yml", "type": "yaml_reference", "topic": "api normalization.features"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: NodeExecutionContext\nSource file: <source_file>\nFile name hint: NodeExecutionContext.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\flowdrop_runtime\\DTO\\Runtime;\n\nuse Drupal\\flowdrop\\DTO\\OutputInterface;\n\n/**\n * Execution context for a workflow run.\n */\nclass NodeExecutionContext {\n\n  public function __construct(\n    private readonly string $workflowId,\n    private readonly string $pipelineId,\n    private readonly array $initialData,\n    private array $nodeOutputs = [],\n    private array $metadata = [],\n  ) {}\n\n  /**\n   * Get the workflow ID.\n   *\n   * @return string\n   *   The workflow ID.\n   */\n  public function getWorkflowId(): string {\n    return $this->workflowId;\n  }\n\n  /**\n   * Get the pipeline ID.\n   *\n   * @return string\n   *   The pipeline ID.\n   */\n  public function getPipelineId(): string {\n    return $this->pipelineId;\n  }\n\n  /**\n   * Get the initial data.\n   *\n   * @return array\n   *   The initial data array.\n   */\n  public function getInitialData(): array {\n    return $this->initialData;\n  }\n\n  /**\n   * Get all node outputs.\n   *\n   * @return array\n   *   Array of node outputs keyed by node ID.\n   */\n  public function getNodeOutputs(): array {\n    return $this->nodeOutputs;\n  }\n\n  /**\n   * Get output for a specific node.\n   *\n   * @param string $nodeId\n   *   The node ID.\n   *\n   * @return \\Drupal\\flowdrop\\DTO\\OutputInterface|null\n   *   The node output or NULL if not found.\n   */\n  public function getNodeOutput(string $nodeId): ?OutputInterface {\n    return $this->nodeOutputs[$nodeId] ?? NULL;\n  }\n\n  /**\n   * Add output for a node.\n   *\n   * @param string $nodeId\n   *   The node ID.\n   * @param \\Drupal\\flowdrop\\DTO\\OutputInterface $output\n   *   The node output.\n   */\n  public function addNodeOutput(string $nodeId, OutputInterface $output): void {\n    $this->nodeOutputs[$nodeId] = $output;\n  }\n\n  /**\n   * Get metadata.\n   *\n   * @return array\n   *   The metadata array.\n   */\n  public function getMetadata(): array {\n    return $this->metadata;\n  }\n\n  /**\n   * Set metadata.\n   *\n   * @param array $metadata\n   *   The metadata array.\n   */\n  public function setMetadata(array $metadata): void {\n    $this->metadata = $metadata;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\DTO\\Runtime;\n\nuse Drupal\\flowdrop\\DTO\\OutputInterface;\n\n/**\n * Execution context for a workflow run.\n */\nclass NodeExecutionContext {\n\n  public function __construct(\n    private readonly string $workflowId,\n    private readonly string $pipelineId,\n    private readonly array $initialData,\n    private array $nodeOutputs = [],\n    private array $metadata = [],\n  ) {}\n\n  /**\n   * Get the workflow ID.\n   *\n   * @return string\n   *   The workflow ID.\n   */\n  public function getWorkflowId(): string {\n    return $this->workflowId;\n  }\n\n  /**\n   * Get the pipeline ID.\n   *\n   * @return string\n   *   The pipeline ID.\n   */\n  public function getPipelineId(): string {\n    return $this->pipelineId;\n  }\n\n  /**\n   * Get the initial data.\n   *\n   * @return array\n   *   The initial data array.\n   */\n  public function getInitialData(): array {\n    return $this->initialData;\n  }\n\n  /**\n   * Get all node outputs.\n   *\n   * @return array\n   *   Array of node outputs keyed by node ID.\n   */\n  public function getNodeOutputs(): array {\n    return $this->nodeOutputs;\n  }\n\n  /**\n   * Get output for a specific node.\n   *\n   * @param string $nodeId\n   *   The node ID.\n   *\n   * @return \\Drupal\\flowdrop\\DTO\\OutputInterface|null\n   *   The node output or NULL if not found.\n   */\n  public function getNodeOutput(string $nodeId): ?OutputInterface {\n    return $this->nodeOutputs[$nodeId] ?? NULL;\n  }\n\n  /**\n   * Add output for a node.\n   *\n   * @param string $nodeId\n   *   The node ID.\n   * @param \\Drupal\\flowdrop\\DTO\\OutputInterface $output\n   *   The node output.\n   */\n  public function addNodeOutput(string $nodeId, OutputInterface $output): void {\n    $this->nodeOutputs[$nodeId] = $output;\n  }\n\n  /**\n   * Get metadata.\n   *\n   * @return array\n   *   The metadata array.\n   */\n  public function getMetadata(): array {\n    return $this->metadata;\n  }\n\n  /**\n   * Set metadata.\n   *\n   * @param array $metadata\n   *   The metadata array.\n   */\n  public function setMetadata(array $metadata): void {\n    $this->metadata = $metadata;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/DTO/Runtime/NodeExecutionContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeExecutionContext", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class PageManager in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts;\n\nuse Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout;\n\n/**\n * Handles Display Suite specific layout implementations.\n *\n * @BootstrapFiveLayoutsHandler(\"page_manager\")\n */\nclass PageManager extends BootstrapFiveLayoutsHandlerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadInstances(?array $entity_ids = NULL) {\n    $layouts = [];\n    $properties = ['variant' => 'panels_variant'];\n    if ($entity_ids) {\n      $properties['id'] = $entity_ids;\n    }\n    /** @var \\Drupal\\Core\\Entity\\EntityTypeManager $entity_type_manager */\n    $entity_type_manager = $this->container->get('entity_type.manager');\n    /** @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityInterface[] $config_entities */\n    $config_entities = $entity_type_manager->getStorage('page_variant')->loadByProperties($properties);\n    foreach ($config_entities as $entity_id => $config_entity) {\n      if (($info = $config_entity->get('variant_settings')) && isset($info['layout']) && isset($info['blocks'])) {\n        $id = $info['layout'];\n\n        // BootstrapLayout requires an associative array of \"items\" assigned to\n        // a particular region, keyed by that region. Unfortunately, Page\n        // Manager stores this value inside each block array; extract it.\n        $regions = [];\n        foreach ($info['blocks'] as $uuid => $block) {\n          $regions[$block['region']][$uuid] = $block;\n        }\n\n        // Retrieve any layout settings.\n        $settings = $info['layout_settings'] ?? [];\n\n        // Create a new BootstrapFiveLayout instance.\n        $layouts[$entity_id] = new BootstrapFiveLayout($id, $regions, $settings);\n      }\n    }\n    return $layouts;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function saveInstances(array $layouts = []) {\n    /** @var \\Drupal\\Core\\Entity\\EntityTypeManager $entity_type_manager */\n    $entity_type_manager = $this->container->get('entity_type.manager');\n\n    /** @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityInterface[] $config_entities */\n    $config_entities = $entity_type_manager->getStorage('page_variant')\n      ->loadByProperties(['variant' => 'panels_variant', 'id' => array_keys($layouts)]);\n\n    /** @var \\Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout[] $layouts */\n    foreach ($layouts as $entity_id => $layout) {\n      $config_entity = $config_entities[$entity_id];\n      $info = $config_entity->get('variant_settings');\n      $info['layout'] = $layout->getId();\n\n      // The region is stored inside the block array. To effectively change\n      // a region for a block, the variant's blocks must be iterated over and\n      // changed manually based on the associative region key provided by the\n      // BootstrapLayout instance.\n      $info['blocks'] = [];\n      foreach ($layout->getRegions() as $region => $blocks) {\n        foreach ($blocks as $uuid => $block) {\n          $block['region'] = $region;\n          $info['blocks'][$uuid] = $block;\n        }\n      }\n\n      $info['layout_settings'] = $layout->getSettings();\n      $config_entity->set('variant_settings', $info)->save();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/Plugin/BootstrapFiveLayouts/PageManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PageManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ProtectionRuleToggleStatusForm\nSource file: <source_file>\nFile name hint: ProtectionRuleToggleStatusForm.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\db_wipe_entity\\Form;\n\nuse Drupal\\Core\\Entity\\EntityConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\CloseModalDialogCommand;\nuse Drupal\\Core\\Ajax\\RedirectCommand;\n\n/**\n * Provides a confirmation form for toggling protection rule status.\n */\nclass ProtectionRuleToggleStatusForm extends EntityConfirmFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion() {\n    $action = $this->entity->status() ? $this->t('disable') : $this->t('enable');\n    return $this->t('Are you sure you want to @action the protection rule %label?', [\n      '@action' => $action,\n      '%label' => $this->entity->label(),\n    ]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription() {\n    if ($this->entity->status()) {\n      return $this->t('Disabling this rule will allow matching entities to be deleted.');\n    }\n    return $this->t('Enabling this rule will protect matching entities from deletion.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText() {\n    return $this->entity->status() ? $this->t('Disable') : $this->t('Enable');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl() {\n    return new Url('entity.protection_rule.collection');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form = parent::buildForm($form, $form_state);\n\n    // Add AJAX support for modal dialog.\n    $form['actions']['submit']['#ajax'] = [\n      'callback' => '::ajaxSubmit',\n      'event' => 'click',\n    ];\n\n    $form['actions']['cancel']['#attributes']['class'][] = 'dialog-cancel';\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $new_status = !$this->entity->status();\n    $this->entity->setStatus($new_status);\n    $this->entity->save();\n\n    $action = $new_status ? $this->t('enabled') : $this->t('disabled');\n    $this->messenger()->addStatus($this->t('Protection rule %label has been @action.', [\n      '%label' => $this->entity->label(),\n      '@action' => $action,\n    ]));\n\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n  /**\n   * AJAX callback for form submission.\n   */\n  public function ajaxSubmit(array &$form, FormStateInterface $form_state): AjaxResponse {\n    $response = new AjaxResponse();\n    $response->addCommand(new CloseModalDialogCommand());\n    $response->addCommand(new RedirectCommand($this->getCancelUrl()->toString()));\n    return $response;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\db_wipe_entity\\Form;\n\nuse Drupal\\Core\\Entity\\EntityConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\CloseModalDialogCommand;\nuse Drupal\\Core\\Ajax\\RedirectCommand;\n\n/**\n * Provides a confirmation form for toggling protection rule status.\n */\nclass ProtectionRuleToggleStatusForm extends EntityConfirmFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion() {\n    $action = $this->entity->status() ? $this->t('disable') : $this->t('enable');\n    return $this->t('Are you sure you want to @action the protection rule %label?', [\n      '@action' => $action,\n      '%label' => $this->entity->label(),\n    ]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription() {\n    if ($this->entity->status()) {\n      return $this->t('Disabling this rule will allow matching entities to be deleted.');\n    }\n    return $this->t('Enabling this rule will protect matching entities from deletion.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText() {\n    return $this->entity->status() ? $this->t('Disable') : $this->t('Enable');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl() {\n    return new Url('entity.protection_rule.collection');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form = parent::buildForm($form, $form_state);\n\n    // Add AJAX support for modal dialog.\n    $form['actions']['submit']['#ajax'] = [\n      'callback' => '::ajaxSubmit',\n      'event' => 'click',\n    ];\n\n    $form['actions']['cancel']['#attributes']['class'][] = 'dialog-cancel';\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $new_status = !$this->entity->status();\n    $this->entity->setStatus($new_status);\n    $this->entity->save();\n\n    $action = $new_status ? $this->t('enabled') : $this->t('disabled');\n    $this->messenger()->addStatus($this->t('Protection rule %label has been @action.', [\n      '%label' => $this->entity->label(),\n      '@action' => $action,\n    ]));\n\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n  /**\n   * AJAX callback for form submission.\n   */\n  public function ajaxSubmit(array &$form, FormStateInterface $form_state): AjaxResponse {\n    $response = new AjaxResponse();\n    $response->addCommand(new CloseModalDialogCommand());\n    $response->addCommand(new RedirectCommand($this->getCancelUrl()->toString()));\n    return $response;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Form/ProtectionRuleToggleStatusForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProtectionRuleToggleStatusForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: RoleInterface.php\nTarget symbol: interface defining\nNamespace: Drupal\\user\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for defining.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityInterface\n  - Drupal\\Core\\Session\\AccountInterface\n- Ensure these methods exist where relevant:\n  - getPermissions()\n  - getWeight()\n  - grantPermission()\n  - hasPermission()\n  - isAdmin()\n  - revokePermission()\n  - setIsAdmin()\n  - setWeight()", "output": "<?php\n\nnamespace Drupal\\user;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Provides an interface defining a user role entity.\n *\n * @ingroup user_api\n */\ninterface RoleInterface extends ConfigEntityInterface {\n\n  /**\n   * Role ID for anonymous users; should match the 'role' entity ID.\n   */\n  const ANONYMOUS_ID = AccountInterface::ANONYMOUS_ROLE;\n\n  /**\n   * Role ID for authenticated users; should match the 'role' entity ID.\n   */\n  const AUTHENTICATED_ID = AccountInterface::AUTHENTICATED_ROLE;\n\n  /**\n   * Returns a list of permissions assigned to the role.\n   *\n   * @return array\n   *   The permissions assigned to the role.\n   */\n  public function getPermissions();\n\n  /**\n   * Checks if the role has a permission.\n   *\n   * @param string $permission\n   *   The permission to check for.\n   *\n   * @return bool\n   *   TRUE if the role has the permission, FALSE if not.\n   */\n  public function hasPermission($permission);\n\n  /**\n   * Grant permissions to the role.\n   *\n   * @param string $permission\n   *   The permission to grant.\n   *\n   * @return $this\n   */\n  public function grantPermission($permission);\n\n  /**\n   * Revokes a permissions from the user role.\n   *\n   * @param string $permission\n   *   The permission to revoke.\n   *\n   * @return $this\n   */\n  public function revokePermission($permission);\n\n  /**\n   * Indicates that a role has all available permissions.\n   *\n   * @return bool\n   *   TRUE if the role has all permissions.\n   */\n  public function isAdmin();\n\n  /**\n   * Sets the role to be an admin role.\n   *\n   * @param bool $is_admin\n   *   TRUE if the role should be an admin role.\n   *\n   * @return $this\n   */\n  public function setIsAdmin($is_admin);\n\n  /**\n   * Returns the weight.\n   *\n   * @return int\n   *   The weight of this role.\n   */\n  public function getWeight();\n\n  /**\n   * Sets the weight to the given value.\n   *\n   * @param int $weight\n   *   The desired weight.\n   *\n   * @return $this\n   */\n  public function setWeight($weight);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/RoleInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "RoleInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Content language management'\ntype: module\ndescription: 'Splits the Content language settings screen into focused pages for Nodes, Paragraphs, and Custom blocks.'\npackage: Multilingual\ncore_version_requirement: '^10 || ^11'\ndependencies:\n  - drupal:language\n  - drupal:content_translation\n  - drupal:paragraphs\n  - drupal:block_content\n", "metadata": {"source": "repos/content_language_management/content_language_management.info.yml", "type": "yaml_reference", "topic": "content language management.info"}}
{"instruction": "Show me the implementation of the interface GatewayRouteInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\n\n/**\n * Interface for Gateway Route entities.\n */\ninterface GatewayRouteInterface extends ConfigEntityInterface {\n\n  /**\n   * Gets the description.\n   *\n   * @return string\n   *   The description.\n   */\n  public function getDescription(): string;\n\n  /**\n   * Sets the description.\n   *\n   * @param string $description\n   *   The description.\n   *\n   * @return $this\n   */\n  public function setDescription(string $description): GatewayRouteInterface;\n\n  /**\n   * Gets the weight.\n   *\n   * @return int\n   *   The weight.\n   */\n  public function getWeight(): int;\n\n  /**\n   * Sets the weight.\n   *\n   * @param int $weight\n   *   The weight.\n   *\n   * @return $this\n   */\n  public function setWeight(int $weight): GatewayRouteInterface;\n\n  /**\n   * Gets the source path pattern.\n   *\n   * @return string\n   *   The source path.\n   */\n  public function getSourcePath(): string;\n\n  /**\n   * Sets the source path pattern.\n   *\n   * @param string $path\n   *   The source path.\n   *\n   * @return $this\n   */\n  public function setSourcePath(string $path): GatewayRouteInterface;\n\n  /**\n   * Gets the target URL.\n   *\n   * @return string\n   *   The target URL.\n   */\n  public function getTargetUrl(): string;\n\n  /**\n   * Sets the target URL.\n   *\n   * @param string $url\n   *   The target URL.\n   *\n   * @return $this\n   */\n  public function setTargetUrl(string $url): GatewayRouteInterface;\n\n  /**\n   * Gets the allowed HTTP methods.\n   *\n   * @return array\n   *   Array of HTTP methods.\n   */\n  public function getMethods(): array;\n\n  /**\n   * Sets the allowed HTTP methods.\n   *\n   * @param array $methods\n   *   Array of HTTP methods.\n   *\n   * @return $this\n   */\n  public function setMethods(array $methods): GatewayRouteInterface;\n\n  /**\n   * Gets the authentication configuration.\n   *\n   * @return array\n   *   The auth config.\n   */\n  public function getAuth(): array;\n\n  /**\n   * Sets the authentication configuration.\n   *\n   * @param array $auth\n   *   The auth config.\n   *\n   * @return $this\n   */\n  public function setAuth(array $auth): GatewayRouteInterface;\n\n  /**\n   * Gets request transformations.\n   *\n   * @return array\n   *   Array of transforms.\n   */\n  public function getRequestTransforms(): array;\n\n  /**\n   * Sets request transformations.\n   *\n   * @param array $transforms\n   *   Array of transforms.\n   *\n   * @return $this\n   */\n  public function setRequestTransforms(array $transforms): GatewayRouteInterface;\n\n  /**\n   * Gets response transformations.\n   *\n   * @return array\n   *   Array of transforms.\n   */\n  public function getResponseTransforms(): array;\n\n  /**\n   * Sets response transformations.\n   *\n   * @param array $transforms\n   *   Array of transforms.\n   *\n   * @return $this\n   */\n  public function setResponseTransforms(array $transforms): GatewayRouteInterface;\n\n  /**\n   * Gets cache TTL.\n   *\n   * @return int\n   *   Cache TTL in seconds.\n   */\n  public function getCacheTtl(): int;\n\n  /**\n   * Sets cache TTL.\n   *\n   * @param int $ttl\n   *   Cache TTL in seconds.\n   *\n   * @return $this\n   */\n  public function setCacheTtl(int $ttl): GatewayRouteInterface;\n\n  /**\n   * Gets rate limit configuration.\n   *\n   * @return array\n   *   Rate limit config.\n   */\n  public function getRateLimit(): array;\n\n  /**\n   * Sets rate limit configuration.\n   *\n   * @param array $config\n   *   Rate limit config.\n   *\n   * @return $this\n   */\n  public function setRateLimit(array $config): GatewayRouteInterface;\n\n  /**\n   * Gets circuit breaker configuration.\n   *\n   * @return array\n   *   Circuit breaker config.\n   */\n  public function getCircuitBreaker(): array;\n\n  /**\n   * Sets circuit breaker configuration.\n   *\n   * @param array $config\n   *   Circuit breaker config.\n   *\n   * @return $this\n   */\n  public function setCircuitBreaker(array $config): GatewayRouteInterface;\n\n  /**\n   * Gets CORS configuration.\n   *\n   * @return array\n   *   CORS config.\n   */\n  public function getCors(): array;\n\n  /**\n   * Sets CORS configuration.\n   *\n   * @param array $config\n   *   CORS config.\n   *\n   * @return $this\n   */\n  public function setCors(array $config): GatewayRouteInterface;\n\n  /**\n   * Gets request timeout.\n   *\n   * @return int\n   *   Timeout in seconds.\n   */\n  public function getTimeout(): int;\n\n  /**\n   * Sets request timeout.\n   *\n   * @param int $timeout\n   *   Timeout in seconds.\n   *\n   * @return $this\n   */\n  public function setTimeout(int $timeout): GatewayRouteInterface;\n\n  /**\n   * Converts entity to route configuration array.\n   *\n   * @return array\n   *   Route configuration for ApiGatewayManager.\n   */\n  public function toRouteConfig(): array;\n\n  /**\n   * Matches a request path against this route.\n   *\n   * @param string $path\n   *   The request path.\n   * @param string $method\n   *   The HTTP method.\n   *\n   * @return array|null\n   *   Path parameters if matched, NULL otherwise.\n   */\n  public function matchPath(string $path, string $method): ?array;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Entity/GatewayRouteInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "GatewayRouteInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ResponseStatus in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\system\\Plugin\\Condition;\n\nuse Drupal\\Core\\Condition\\Attribute\\Condition;\nuse Drupal\\Core\\Condition\\ConditionPluginBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\Exception\\HttpExceptionInterface;\n\n/**\n * Provides a 'Response status' condition.\n */\n#[Condition(\n  id: \"response_status\",\n  label: new TranslatableMarkup(\"Response status\"),\n)]\nclass ResponseStatus extends ConditionPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The request stack.\n   */\n  protected RequestStack $requestStack;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = new static($configuration, $plugin_id, $plugin_definition);\n    $instance->setRequestStack($container->get('request_stack'));\n    return $instance;\n  }\n\n  /**\n   * Sets the request stack to the given input.\n   */\n  public function setRequestStack(RequestStack $requestStack): void {\n    $this->requestStack = $requestStack;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isNegated(): bool {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return ['status_codes' => []] + parent::defaultConfiguration();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $status_codes = [\n      Response::HTTP_OK => $this->t('Success (@status_code)', ['@status_code' => Response::HTTP_OK]),\n      Response::HTTP_FORBIDDEN => $this->t('Access denied (@status_code)', ['@status_code' => Response::HTTP_FORBIDDEN]),\n      Response::HTTP_NOT_FOUND => $this->t('Page not found (@status_code)', ['@status_code' => Response::HTTP_NOT_FOUND]),\n    ];\n    $form['status_codes'] = [\n      '#type' => 'checkboxes',\n      '#title' => $this->t('Response status'),\n      '#options' => $status_codes,\n      '#default_value' => $this->configuration['status_codes'],\n      '#description' => $this->t('Shows the block on pages with any matching response status. If nothing is checked, the block is shown on all pages. Other response statuses are not used.'),\n    ];\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state): void {\n    $this->configuration['status_codes'] = array_keys(array_filter($form_state->getValue('status_codes')));\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summary(): PluralTranslatableMarkup {\n    $allowed_codes = $this->configuration['status_codes'];\n    $status_codes = [Response::HTTP_OK, Response::HTTP_FORBIDDEN, Response::HTTP_NOT_FOUND];\n    $result = empty($allowed_codes) ? $status_codes : $allowed_codes;\n    $count = count($result);\n    $codes = implode(', ', $result);\n    if (!empty($this->configuration['negate'])) {\n      return $this->formatPlural($count, 'Request response code is not: @codes', 'Request response code is not one of the following: @codes', ['@codes' => $codes]);\n    }\n    return $this->formatPlural($count, 'Request response code is: @codes', 'Request response code is one of the following: @codes', ['@codes' => $codes]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function evaluate(): bool {\n    $allowed_codes = $this->configuration['status_codes'];\n    if (empty($allowed_codes)) {\n      return TRUE;\n    }\n    $exception = $this->requestStack->getCurrentRequest()->attributes->get('exception');\n    if ($exception) {\n      return ($exception instanceof HttpExceptionInterface && in_array($exception->getStatusCode(), $allowed_codes, TRUE));\n    }\n    return in_array(Response::HTTP_OK, $allowed_codes, TRUE);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts(): array {\n    $contexts = parent::getCacheContexts();\n    $contexts[] = 'url.path';\n    return $contexts;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/Condition/ResponseStatus.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ResponseStatus", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: LanguageNegotiationUser\nSource file: <source_file>\nFile name hint: LanguageNegotiationUser.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\user\\Plugin\\LanguageNegotiation;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\language\\Attribute\\LanguageNegotiation;\nuse Drupal\\language\\LanguageNegotiationMethodBase;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Class for identifying language from the user preferences.\n */\n#[LanguageNegotiation(\n  id: LanguageNegotiationUser::METHOD_ID,\n  name: new TranslatableMarkup('User'),\n  weight: -4,\n  description: new TranslatableMarkup(\"Follow the user's language preference.\")\n)]\nclass LanguageNegotiationUser extends LanguageNegotiationMethodBase {\n\n  /**\n   * The language negotiation method id.\n   */\n  const METHOD_ID = 'language-user';\n\n  /**\n   * {@inheritdoc}\n   */\n  function getLangcode(?Request $request = NULL) {\n    $langcode = NULL;\n\n    // User preference (only for authenticated users).\n    if ($this->languageManager && $this->currentUser->isAuthenticated()) {\n      $preferred_langcode = $this->currentUser->getPreferredLangcode(FALSE);\n      $languages = $this->languageManager->getLanguages();\n      if (!empty($preferred_langcode) && isset($languages[$preferred_langcode])) {\n        $langcode = $preferred_langcode;\n      }\n    }\n\n    // No language preference from the user.\n    return $langcode;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\LanguageNegotiation;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\language\\Attribute\\LanguageNegotiation;\nuse Drupal\\language\\LanguageNegotiationMethodBase;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Class for identifying language from the user preferences.\n */\n#[LanguageNegotiation(\n  id: LanguageNegotiationUser::METHOD_ID,\n  name: new TranslatableMarkup('User'),\n  weight: -4,\n  description: new TranslatableMarkup(\"Follow the user's language preference.\")\n)]\nclass LanguageNegotiationUser extends LanguageNegotiationMethodBase {\n\n  /**\n   * The language negotiation method id.\n   */\n  const METHOD_ID = 'language-user';\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLangcode(?Request $request = NULL) {\n    $langcode = NULL;\n\n    // User preference (only for authenticated users).\n    if ($this->languageManager && $this->currentUser->isAuthenticated()) {\n      $preferred_langcode = $this->currentUser->getPreferredLangcode(FALSE);\n      $languages = $this->languageManager->getLanguages();\n      if (!empty($preferred_langcode) && isset($languages[$preferred_langcode])) {\n        $langcode = $preferred_langcode;\n      }\n    }\n\n    // No language preference from the user.\n    return $langcode;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/LanguageNegotiation/LanguageNegotiationUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageNegotiationUser", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CronFailAlertHooks.php\nTarget symbol: class CronFailAlertHooks\nNamespace: Drupal\\cron_fail_alert\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CronFailAlertHooks.\n- Include required imports:\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n  - Drupal\\Core\\Mail\\MailFormatHelper\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n- Ensure these methods exist where relevant:\n  - mail()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\cron_fail_alert\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Mail\\MailFormatHelper;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Hook implementations for Cron Fail Alert module.\n */\nclass CronFailAlertHooks {\n\n  /**\n   * Implements hook_mail().\n   */\n  #[Hook('mail')]\n  public function mail(string $key, array &$message, array $params): void {\n    // Set the options including the language code.\n    $options = ['langcode' => $message['langcode']];\n\n    // Check if the email key is 'cron_fail_alert_mail'.\n    if ($key === 'cron_fail_alert_mail') {\n      // Set the 'from' email address and subject using translated title.\n      $message['from'] = \\Drupal::config('system.site')->get('mail');\n      $message['subject'] = new TranslatableMarkup('@title', ['@title' => $params['title']], $options);\n\n      // Wrap and add the message body using MailFormatHelper.\n      $message['body'][] = MailFormatHelper::wrapMail($params['message']);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/cron_fail_alert/src/Hook/CronFailAlertHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CronFailAlertHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ViewsSort.php\nTarget symbol: class ViewsSort\nNamespace: Drupal\\views\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ViewsSort.", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views sort handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\sort\\SortPluginBase\n *\n * @ingroup views_sort_handlers\n *\n * @Annotation\n */\nclass ViewsSort extends ViewsHandlerAnnotationBase {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Annotation/ViewsSort.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsSort", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface ContextAwarePluginInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin;\n\nuse Drupal\\Component\\Plugin\\Context\\ContextInterface;\n\n/**\n * Interface for defining context aware plugins.\n *\n * Context aware plugins can specify an array of context definitions keyed by\n * context name at the plugin definition under the \"context\" key.\n *\n * @ingroup plugin_api\n */\ninterface ContextAwarePluginInterface extends PluginInspectionInterface {\n\n  /**\n   * Gets the context definitions of the plugin.\n   *\n   * @return \\Drupal\\Component\\Plugin\\Context\\ContextDefinitionInterface[]\n   *   The array of context definitions, keyed by context name.\n   */\n  public function getContextDefinitions();\n\n  /**\n   * Gets a specific context definition of the plugin.\n   *\n   * @param string $name\n   *   The name of the context in the plugin definition.\n   *\n   * @return \\Drupal\\Component\\Plugin\\Context\\ContextDefinitionInterface\n   *   The definition against which the context value must validate.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\ContextException\n   *   If the requested context is not defined.\n   */\n  public function getContextDefinition($name);\n\n  /**\n   * Gets the defined contexts.\n   *\n   * @return array\n   *   The set context objects.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\ContextException\n   *   If contexts are defined but not set.\n   */\n  public function getContexts();\n\n  /**\n   * Gets a defined context.\n   *\n   * @param string $name\n   *   The name of the context in the plugin definition.\n   *\n   * @return \\Drupal\\Component\\Plugin\\Context\\ContextInterface\n   *   The context object.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\ContextException\n   *   If the requested context is not set.\n   */\n  public function getContext($name);\n\n  /**\n   * Gets the values for all defined contexts.\n   *\n   * @return array\n   *   An array of set context values, keyed by context name. If a context is\n   *   unset its value is returned as NULL.\n   */\n  public function getContextValues();\n\n  /**\n   * Gets the value for a defined context.\n   *\n   * @param string $name\n   *   The name of the context in the plugin configuration.\n   *\n   * @return mixed\n   *   The currently set context value.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\ContextException\n   *   If the requested context is not set.\n   */\n  public function getContextValue($name);\n\n  /**\n   * Set a context on this plugin.\n   *\n   * @param string $name\n   *   The name of the context in the plugin configuration.\n   * @param \\Drupal\\Component\\Plugin\\Context\\ContextInterface $context\n   *   The context object to set.\n   */\n  public function setContext($name, ContextInterface $context);\n\n  /**\n   * Sets the value for a defined context.\n   *\n   * @param string $name\n   *   The name of the context in the plugin definition.\n   * @param mixed $value\n   *   The value to set the context to. The value has to validate against the\n   *   provided context definition.\n   *\n   * @return $this\n   *   A context aware plugin object for chaining.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\ContextException\n   *   If the value does not pass validation.\n   */\n  public function setContextValue($name, $value);\n\n  /**\n   * Validates the set values for the defined contexts.\n   *\n   * @return \\Symfony\\Component\\Validator\\ConstraintViolationListInterface\n   *   A list of constraint violations. If the list is empty, validation\n   *   succeeded.\n   */\n  public function validateContexts();\n\n  /**\n   * Gets a mapping of the expected assignment names to their context names.\n   *\n   * @return array\n   *   A mapping of the expected assignment names to their context names. For\n   *   example, if one of the $contexts is named 'user.current_user', but the\n   *   plugin expects a context named 'user', then this map would contain\n   *   'user' => 'user.current_user'.\n   */\n  public function getContextMapping();\n\n  /**\n   * Sets a mapping of the expected assignment names to their context names.\n   *\n   * @param array $context_mapping\n   *   A mapping of the expected assignment names to their context names. For\n   *   example, if one of the $contexts is named 'user.current_user', but the\n   *   plugin expects a context named 'user', then this map would contain\n   *   'user' => 'user.current_user'.\n   *\n   * @return $this\n   */\n  public function setContextMapping(array $context_mapping);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/ContextAwarePluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ContextAwarePluginInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class MediaStorage in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\media;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage;\n\n/**\n * Defines the storage handler class for media.\n *\n * The default storage is overridden to handle metadata fetching outside of the\n * database transaction.\n */\nclass MediaStorage extends SqlContentEntityStorage {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(EntityInterface $media) {\n    // For backwards compatibility, modules that override the Media entity\n    // class, are not required to implement the prepareSave() method.\n    // @todo For Drupal 8.7, consider throwing a deprecation notice if the\n    //   method doesn't exist. See\n    //   https://www.drupal.org/project/drupal/issues/2992426 for further\n    //   discussion.\n    if (method_exists($media, 'prepareSave')) {\n      $media->prepareSave();\n    }\n    return parent::save($media);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/MediaStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaStorage", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BadPluginDefinitionException in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\Exception;\n\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\n\n/**\n * Defines a class for bad plugin definition exceptions.\n */\nclass BadPluginDefinitionException extends InvalidPluginDefinitionException {\n\n  /**\n   * Constructs a BadPluginDefinitionException.\n   *\n   * @param string $plugin_id\n   *   The plugin ID of the mapper.\n   * @param string $property\n   *   The name of the property that is missing from the plugin.\n   * @param int $code\n   *   (optional) The exception code. Defaults to 0.\n   * @param \\Throwable|null $previous\n   *   The previous throwable used for exception chaining.\n   *\n   * @see \\Exception\n   */\n  public function __construct($plugin_id, $property, $code = 0, ?\\Throwable $previous = NULL) {\n    $message = sprintf('The %s plugin must define the %s property.', $plugin_id, $property);\n    parent::__construct($plugin_id, $message, $code, $previous);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/Exception/BadPluginDefinitionException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BadPluginDefinitionException", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EntityActionBase.php\nTarget symbol: class for\nNamespace: Drupal\\Core\\Action\\Plugin\\Action\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\DependentPluginInterface\n  - Drupal\\Core\\Action\\ActionBase\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - calculateDependencies()", "output": "<?php\n\nnamespace Drupal\\Core\\Action\\Plugin\\Action;\n\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Action\\ActionBase;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\n\n/**\n * Base class for entity-based actions.\n */\nabstract class EntityActionBase extends ActionBase implements DependentPluginInterface, ContainerFactoryPluginInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * Constructs an EntityActionBase object.\n   *\n   * @param mixed[] $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, EntityTypeManagerInterface $entity_type_manager) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->entityTypeManager = $entity_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    $module_name = $this->entityTypeManager\n      ->getDefinition($this->getPluginDefinition()['type'])\n      ->getProvider();\n    return ['module' => [$module_name]];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Action/Plugin/Action/EntityActionBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityActionBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class BlockContentAccessControlHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block_content;\n\nuse Drupal\\block_content\\Event\\BlockContentGetDependencyEvent;\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Access\\DependentAccessInterface;\nuse Drupal\\Core\\Entity\\EntityAccessControlHandler;\nuse Drupal\\Core\\Entity\\EntityHandlerInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * Defines the access control handler for the content block entity type.\n *\n * @see \\Drupal\\block_content\\Entity\\BlockContent\n */\nclass BlockContentAccessControlHandler extends EntityAccessControlHandler implements EntityHandlerInterface {\n\n  /**\n   * The event dispatcher.\n   *\n   * @var \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface\n   */\n  protected $eventDispatcher;\n\n  /**\n   * BlockContentAccessControlHandler constructor.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface $dispatcher\n   *   The event dispatcher.\n   */\n  public function __construct(EntityTypeInterface $entity_type, EventDispatcherInterface $dispatcher) {\n    parent::__construct($entity_type);\n    $this->eventDispatcher = $dispatcher;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $entity_type,\n      $container->get('event_dispatcher')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account) {\n    assert($entity instanceof BlockContentInterface);\n    $bundle = $entity->bundle();\n    $forbidIfNotReusable = fn (): AccessResultInterface => AccessResult::forbiddenIf($entity->isReusable() === FALSE, sprintf('Block content must be reusable to use `%s` operation', $operation));\n    $access = AccessResult::allowedIfHasPermissions($account, ['administer block content']);\n    if (!$access->isAllowed()) {\n      $access = match ($operation) {\n        // Allow view and update access to user with the 'edit any (type) block\n        // content' permission or the 'administer block content' permission.\n        'view' => AccessResult::allowedIf($entity->isPublished())\n          ->orIf(AccessResult::allowedIfHasPermission($account, 'access block library')),\n        'update' => AccessResult::allowedIfHasPermission($account, 'edit any ' . $bundle . ' block content'),\n        'delete' => AccessResult::allowedIfHasPermission($account, 'delete any ' . $bundle . ' block content'),\n        // Revisions.\n        'view revision', 'view all revisions' => AccessResult::allowedIfHasPermission($account, 'view any ' . $bundle . ' block content history'),\n        'revert' => AccessResult::allowedIfHasPermission($account, 'revert any ' . $bundle . ' block content revisions')\n          ->orIf($forbidIfNotReusable()),\n        'delete revision' => AccessResult::allowedIfHasPermission($account, 'delete any ' . $bundle . ' block content revisions')\n          ->orIf($forbidIfNotReusable()),\n\n        default => parent::checkAccess($entity, $operation, $account),\n      };\n    }\n\n    // Add the entity as a cacheable dependency because access will at least be\n    // determined by whether the block is reusable.\n    $access->addCacheableDependency($entity);\n    if ($entity->isReusable() === FALSE && $access->isForbidden() !== TRUE) {\n      if (!$entity instanceof DependentAccessInterface) {\n        throw new \\LogicException(\"Non-reusable block entities must implement \\Drupal\\block_content\\Access\\DependentAccessInterface for access control.\");\n      }\n      $dependency = $entity->getAccessDependency();\n      if (empty($dependency)) {\n        // If an access dependency has not been set let modules set one.\n        $event = new BlockContentGetDependencyEvent($entity);\n        $this->eventDispatcher->dispatch($event, BlockContentEvents::BLOCK_CONTENT_GET_DEPENDENCY);\n        $dependency = $event->getAccessDependency();\n        if (empty($dependency)) {\n          return AccessResult::forbidden(\"Non-reusable blocks must set an access dependency for access control.\");\n        }\n      }\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $dependency */\n      $access = $access->andIf($dependency->access($operation, $account, TRUE));\n    }\n    return $access;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkCreateAccess(AccountInterface $account, array $context, $entity_bundle = NULL) {\n    return AccessResult::allowedIfHasPermissions($account, [\n      'create ' . $entity_bundle . ' block content',\n      'administer block content',\n    ], 'OR');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block_content/src/BlockContentAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockContentAccessControlHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: API Reference", "input": "", "output": "# API Reference\n\n**Developer API documentation for API Normalization module**\n\n---\n\n## Services\n\n### NormalizationOrchestrator\n\n**Service ID**: `api_normalization.orchestrator`\n\n**Purpose**: Orchestrates the complete API data import pipeline\n\n**Methods**:\n\n```php\n/**\n * Normalize API response data.\n *\n * @param mixed $data\n *   Raw API response data.\n * @param array $options\n *   Normalization options.\n *\n * @return array\n *   Normalized data.\n */\npublic function normalize($data, array $options = []): array;\n```\n\n### TransformationEngine\n\n**Service ID**: `api_normalization.transformation_engine`\n\n**Purpose**: Handles data transformations using plugin system\n\n**Methods**:\n\n```php\n/**\n * Transform normalized data.\n *\n * @param array $data\n *   Normalized data.\n * @param array $transformations\n *   Transformation configuration.\n *\n * @return array\n *   Transformed data.\n */\npublic function transform(array $data, array $transformations = []): array;\n```\n\n### EntityGenerator\n\n**Service ID**: `api_normalization.entity_generator`\n\n**Purpose**: Programmatically creates Drupal entities\n\n**Methods**:\n\n```php\n/**\n * Generate entity from normalized data.\n *\n * @param array $data\n *   Normalized/transformed data.\n * @param string $entity_type\n *   Entity type ID.\n * @param string $bundle\n *   Bundle name.\n * @param array $options\n *   Generation options.\n *\n * @return \\Drupal\\Core\\Entity\\EntityInterface\n *   Generated entity.\n */\npublic function generateEntity(\n  array $data,\n  string $entity_type,\n  string $bundle,\n  array $options = []\n): EntityInterface;\n```\n\n---\n\n## REST API Endpoints\n\nThe module provides 1,594 REST API endpoints. See `/admin/config/services/api_normalization/routes` for complete list.\n\n### Common Endpoints\n\n- `GET /api/normalization/schema/{schema_id}` - Get schema\n- `POST /api/normalization/normalize` - Normalize data\n- `POST /api/normalization/transform` - Transform data\n- `POST /api/normalization/generate-entity` - Generate entity\n\n---\n\n## Hooks\n\n### hook_api_normalization_normalize_alter()\n\nAlter normalized data before transformation.\n\n```php\n/**\n * Alter normalized data.\n *\n * @param array &$normalized\n *   Normalized data (by reference).\n * @param mixed $raw_data\n *   Raw API response data.\n */\nfunction hook_api_normalization_normalize_alter(array &$normalized, $raw_data) {\n  // Alter normalized data.\n}\n```\n\n### hook_api_normalization_transform_alter()\n\nAlter transformed data before entity generation.\n\n```php\n/**\n * Alter transformed data.\n *\n * @param array &$transformed\n *   Transformed data (by reference).\n * @param array $normalized\n *   Normalized data.\n */\nfunction hook_api_normalization_transform_alter(array &$transformed, array $normalized) {\n  // Alter transformed data.\n}\n```\n\n---\n\n## Plugins\n\n### Transformation Plugins\n\nCreate custom transformation plugins:\n\n```php\nnamespace Drupal\\my_module\\Plugin\\ApiNormalization\\Transformation;\n\nuse Drupal\\api_normalization\\Plugin\\TransformationBase;\n\n/**\n * Custom transformation plugin.\n *\n * @ApiNormalizationTransformation(\n *   id = \"my_custom_transform\",\n *   label = @Translation(\"My Custom Transform\"),\n * )\n */\nclass MyCustomTransform extends TransformationBase {\n  // Implementation.\n}\n```\n\n---\n\n## Events\n\n### ApiNormalizationCompleteEvent\n\nFired after normalization completes.\n\n```php\nuse Drupal\\api_normalization\\Event\\ApiNormalizationCompleteEvent;\n\n$event = new ApiNormalizationCompleteEvent($normalized_data);\n\\Drupal::service('event_dispatcher')->dispatch($event);\n```\n\n---\n\n## Related Documentation\n\n- [User Guide](./userGuide.md) - User documentation\n- [Examples](./examples.md) - Code examples\n- [Integration Guide](./integration.md) - Integration examples\n", "metadata": {"source": "repos/api_normalization/docs/apiReference.md", "type": "doc_summary", "topic": "API Reference"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: GetSubmissions\nSource file: <source_file>\nFile name hint: GetSubmissions.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_get_webform_submissions',\n  label: new TranslatableMarkup('Get Webform Submissions'),\n  description: new TranslatableMarkup('Get submissions for a webform with pagination.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'webform_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit (max 100)'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'offset' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Offset'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'webform_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'webform_title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Submissions'),\n      description: new TranslatableMarkup(''),\n    ),\n    'limit' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup(''),\n    ),\n    'offset' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Offset'),\n      description: new TranslatableMarkup(''),\n    ),\n    'submissions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Submissions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetSubmissions extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $webformId = $input['webform_id'] ?? '';\n\n    if (empty($webformId)) {\n      return ['success' => FALSE, 'error' => 'Webform ID is required.'];\n    }\n\n    $limit = (int) ($input['limit'] ?? 50);\n    $offset = (int) ($input['offset'] ?? 0);\n\n    // Enforce reasonable limits.\n    $limit = min(max($limit, 1), 100);\n    $offset = max($offset, 0);\n\n    return $this->webformService->getSubmissions($webformId, $limit, $offset);\n  }\n\n\n\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_get_webform_submissions',\n  label: new TranslatableMarkup('Get Webform Submissions'),\n  description: new TranslatableMarkup('Get submissions for a webform with pagination.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'webform_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit (max 100)'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'offset' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Offset'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'webform_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'webform_title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Submissions'),\n      description: new TranslatableMarkup(''),\n    ),\n    'limit' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup(''),\n    ),\n    'offset' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Offset'),\n      description: new TranslatableMarkup(''),\n    ),\n    'submissions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Submissions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetSubmissions extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $webformId = $input['webform_id'] ?? '';\n\n    if (empty($webformId)) {\n      return ['success' => FALSE, 'error' => 'Webform ID is required.'];\n    }\n\n    $limit = (int) ($input['limit'] ?? 50);\n    $offset = (int) ($input['offset'] ?? 0);\n\n    // Enforce reasonable limits.\n    $limit = min(max($limit, 1), 100);\n    $offset = max($offset, 0);\n\n    return $this->webformService->getSubmissions($webformId, $limit, $offset);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/src/Plugin/tool/Tool/GetSubmissions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetSubmissions", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class CronFailAlertHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\cron_fail_alert\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Mail\\MailFormatHelper;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Hook implementations for Cron Fail Alert module.\n */\nclass CronFailAlertHooks {\n\n  /**\n   * Implements hook_mail().\n   */\n  #[Hook('mail')]\n  public function mail(string $key, array &$message, array $params): void {\n    // Set the options including the language code.\n    $options = ['langcode' => $message['langcode']];\n\n    // Check if the email key is 'cron_fail_alert_mail'.\n    if ($key === 'cron_fail_alert_mail') {\n      // Set the 'from' email address and subject using translated title.\n      $message['from'] = \\Drupal::config('system.site')->get('mail');\n      $message['subject'] = new TranslatableMarkup('@title', ['@title' => $params['title']], $options);\n\n      // Wrap and add the message body using MailFormatHelper.\n      $message['body'][] = MailFormatHelper::wrapMail($params['message']);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/cron_fail_alert/src/Hook/CronFailAlertHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CronFailAlertHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ValidationManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eb\\Service;\n\nuse Drupal\\eb\\PluginInterfaces\\OperationInterface;\nuse Drupal\\eb\\Result\\ValidationResult;\n\n/**\n * Interface for the validation manager service.\n *\n * The validation manager coordinates validation of operations, performing\n * two-stage validation:\n * 1. Operation's own validation (specific to operation type)\n * 2. All applicable validator plugins (cross-cutting concerns)\n */\ninterface ValidationManagerInterface {\n\n  /**\n   * Validate a single operation.\n   *\n   * Performs two-stage validation:\n   * 1. Operation's own validation (specific to operation type)\n   * 2. All applicable validator plugins (cross-cutting concerns)\n   *\n   * @param \\Drupal\\eb\\PluginInterfaces\\OperationInterface $operation\n   *   The operation to validate.\n   *\n   * @return \\Drupal\\eb\\Result\\ValidationResult\n   *   The validation result containing all errors and warnings.\n   */\n  public function validateOperation(OperationInterface $operation): ValidationResult;\n\n  /**\n   * Validate multiple operations in a batch.\n   *\n   * Validates operations with awareness of the batch context, allowing\n   * validators to check if dependencies will be satisfied by earlier\n   * operations in the same batch.\n   *\n   * @param array<\\Drupal\\eb\\PluginInterfaces\\OperationInterface> $operations\n   *   Array of operations to validate.\n   *\n   * @return \\Drupal\\eb\\Result\\ValidationResult\n   *   Aggregated validation result.\n   */\n  public function validateBatch(array $operations): ValidationResult;\n\n}\n", "metadata": {"source": "repos/eb/src/Service/ValidationManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ValidationManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class HtmlLangOverride in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Contains \\Drupal\\html_lang_override\\Form\\HtmlLangOverrideForm.\n */\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Component\\Utility\\Html;\n\n/**\n * Implements hook_form_FORM_ID_alter().\n */\nfunction html_lang_override_form_node_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  $node = NULL;\n  $form_object = $form_state->getFormObject();\n  if (method_exists($form_object, 'getEntity')) {\n    $node = $form_object->getEntity();\n  }\n  $current_user = \\Drupal::currentUser();\n  $language_override_service = \\Drupal::service('html_lang_override.manager');\n  $default_lang = \\Drupal::languageManager()->getDefaultLanguage()->getId();\n  $node_lang = NULL;\n  if ($node && !$node->isNew()) {\n    $node_lang = $language_override_service->getLangForNode($node->id());\n  }\n\n  $form['html_lang_override_wrapper'] = [\n    '#type' => 'details',\n    '#title' => t('Override HTML Lang Attribute'),\n    '#open' => FALSE,\n    '#weight' => 100,\n    '#description' => t('Override the HTML lang attribute for this page.'),\n    '#group' => 'advanced',\n    '#access' => $current_user->hasPermission('Override HTML lang attribute'),\n  ];\n\n  $form['html_lang_override_wrapper']['html_lang_override'] = [\n    '#type' => 'textfield',\n    '#title' => t('Custom HTML Lang Attribute'),\n    '#default_value' => $node_lang,\n    '#placeholder' => $default_lang,\n    '#description' => t('Specify a language code (e.g., en, hi, ja). Leave empty to use global default. Make sure to use a valid language code.'),\n    '#maxlength' => 10,\n    '#access' => $current_user->hasPermission('Override HTML lang attribute'),\n  ];\n}\n\n/**\n * Implements hook_entity_presave().\n */\nfunction html_lang_override_entity_presave(EntityInterface $entity) {\n  if ($entity->getEntityTypeId() === 'node' && !$entity->isNew()) {\n    $value = \\Drupal::request()->request->get('html_lang_override');\n    if ($value !== NULL) {\n      $value = Html::escape(trim($value));\n      if (!empty($value)) {\n        \\Drupal::service('html_lang_override.manager')->saveLangForNode($entity->id(), $value);\n      }\n      if (empty($value)) {\n        \\Drupal::service('html_lang_override.manager')->deleteLangForNode($entity->id());\n      }\n    }\n  }\n}\n\n/**\n * Implements hook_entity_insert().\n */\nfunction html_lang_override_entity_insert(EntityInterface $entity) {\n  if ($entity->getEntityTypeId() === 'node') {\n    $value = \\Drupal::request()->request->get('html_lang_override');\n    if ($value !== NULL) {\n      $value = Html::escape(trim($value));\n      if (!empty($value)) {\n        \\Drupal::service('html_lang_override.manager')->saveLangForNode($entity->id(), $value);\n      }\n    }\n  }\n}\n\n/**\n * Implements hook_entity_delete().\n */\nfunction html_lang_override_entity_delete(EntityInterface $entity) {\n  if ($entity->getEntityTypeId() === 'node') {\n    \\Drupal::service('html_lang_override.manager')->deleteLangForNode($entity->id());\n  }\n}\n", "metadata": {"source": "repos/html_lang_override/html_lang_override.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HtmlLangOverride", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DefaultsSectionStorageInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\layout_builder\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ThirdPartySettingsInterface", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\layout_builder;\n\nuse Drupal\\Core\\Config\\Entity\\ThirdPartySettingsInterface;\n\n/**\n * Defines an interface for an object that stores layout sections for defaults.\n */\ninterface DefaultsSectionStorageInterface extends SupportAwareSectionStorageInterface, ThirdPartySettingsInterface, LayoutBuilderEnabledInterface, LayoutBuilderOverridableInterface {}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/DefaultsSectionStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DefaultsSectionStorageInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Playground tab on the workflow edit form\nflowdrop_playground.workflow.playground:\n  route_name: flowdrop_playground.page\n  title: 'Playground'\n  base_route: entity.flowdrop_workflow.edit_form\n  weight: 50\n\n# Playground tab on the workflow editor page\nflowdrop_playground.workflow.editor.playground:\n  route_name: flowdrop_playground.page\n  title: 'Playground'\n  base_route: flowdrop.workflow.editor\n  weight: 50\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_playground/flowdrop_playground.links.task.yml", "type": "yaml_reference", "topic": "flowdrop playground.links.task"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for the last time update data was checked.\n *\n * Available variables:\n * - last: The timestamp that the site was last checked for updates.\n * - time: The formatted time since the site last checked for updates.\n * - link: A link to check for updates manually.\n *\n * @see \\Drupal\\update\\Hook\\UpdateThemeHooks::preprocessUpdateLastCheck()\n */\n#}\n<p>\n  {% if last %}\n    {{ 'Last checked: @time ago'|t({'@time': time}) }}\n  {% else %}\n    {{ 'Last checked: never'|t }}\n  {% endif %}\n  ({{ link }})\n</p>\n", "metadata": {"source": "repos/drupal_core/core/themes/stable9/templates/admin/update-last-check.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: LaborTimeTrackerEntityHooks\nSource file: <source_file>\nFile name hint: LaborTimeTrackerEntityHooks.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\labor_time_tracker\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\labor_time_tracker\\Entity\\TimeLog;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Hook implementations for Labor Time Tracker.\n */\nclass LaborTimeTrackerEntityHooks {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    protected EntityTypeManagerInterface $entityTypeManager,\n    protected Connection $database,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('database')\n    );\n  }\n\n  /**\n   * Calculates duration when an 'exit' punch is saved.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The TimeLog entity.\n   */\n  #[Hook('entity_update')]\n  public function timeLogPresave(EntityInterface $entity): void {\n    if (!$entity instanceof TimeLog) {\n      return;\n    }\n\n    $start = (int) $entity->get('enter_time')->value;\n    $exit = (int) $entity->get('exit_time')->value;\n\n    if ($start > 0 && $exit > 0) {\n      $duration = $exit - $start;\n      $this->sqlFlush($entity->id(), $duration);\n    }\n  }\n\n  /**\n   * Helper to perform direct SQL update and clear cache.\n   */\n  protected function sqlFlush($id, $duration): void {\n    $this->database->update('time_log')\n      ->fields(['duration' => (int) $duration])\n      ->condition('id', $id)\n      ->execute();\n\n    $this->entityTypeManager->getStorage('time_log')->resetCache([$id]);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\labor_time_tracker\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\labor_time_tracker\\Entity\\TimeLog;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Hook implementations for Labor Time Tracker.\n */\nclass LaborTimeTrackerEntityHooks {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    protected EntityTypeManagerInterface $entityTypeManager,\n    protected Connection $database,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('database')\n    );\n  }\n\n  /**\n   * Calculates duration when an 'exit' punch is saved.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The TimeLog entity.\n   */\n  #[Hook('entity_update')]\n  public function timeLogPresave(EntityInterface $entity): void {\n    if (!$entity instanceof TimeLog) {\n      return;\n    }\n\n    $start = (int) $entity->get('enter_time')->value;\n    $exit = (int) $entity->get('exit_time')->value;\n\n    if ($start > 0 && $exit > 0) {\n      $duration = $exit - $start;\n      $this->sqlFlush($entity->id(), $duration);\n    }\n  }\n\n  /**\n   * Helper to perform direct SQL update and clear cache.\n   */\n  protected function sqlFlush($id, $duration): void {\n    $this->database->update('time_log')\n      ->fields(['duration' => (int) $duration])\n      ->condition('id', $id)\n      ->execute();\n\n    $this->entityTypeManager->getStorage('time_log')->resetCache([$id]);\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/Hook/LaborTimeTrackerEntityHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LaborTimeTrackerEntityHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.workspace.add_form:\n  route_name: entity.workspace.add_form\n  title: 'Add workspace'\n  appears_on:\n    - entity.workspace.collection\n\nentity.workspace.switch_to:\n  route_name: entity.workspace.activate_form\n  title: 'Switch to this workspace'\n  appears_on:\n    - entity.workspace.canonical\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces_ui/workspaces_ui.links.action.yml", "type": "yaml_reference", "topic": "workspaces ui.links.action"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ChangeDefaultLanguageForm\nSource file: <source_file>\nFile name hint: ChangeDefaultLanguageForm.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_change_default_language\\Form;\n\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\node_change_default_language\\NodeChangeDefaultLanguageInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Form for changing the default language of a node.\n */\nclass ChangeDefaultLanguageForm extends FormBase {\n\n  /**\n   * The node being edited.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   */\n  protected NodeInterface $node;\n\n  /**\n   * Constructs the form.\n   *\n   * @param \\Drupal\\node_change_default_language\\NodeChangeDefaultLanguageInterface $changeDefaultLanguage\n   *   The change default language service.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $languageManager\n   *   The language manager.\n   */\n  public function __construct(\n    protected NodeChangeDefaultLanguageInterface $changeDefaultLanguage,\n    protected LanguageManagerInterface $languageManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('node_change_default_language.service'),\n      $container->get('language_manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'node_change_default_language_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?NodeInterface $node = NULL): array {\n    if (!$node) {\n      return $form;\n    }\n\n    $this->node = $node;\n    $currentLangcode = $node->language()->getId();\n    $languages = $this->languageManager->getLanguages();\n    $currentLangName = $languages[$currentLangcode]->getName() ?? $currentLangcode;\n\n    // Get available translations.\n    $translationLanguages = $node->getTranslationLanguages();\n    $options = [];\n    foreach ($translationLanguages as $langcode => $language) {\n      if ($langcode !== $currentLangcode) {\n        $options[$langcode] = $language->getName();\n      }\n    }\n\n    if (empty($options)) {\n      $form['message'] = [\n        '#markup' => $this->t('This node has no translations. Add translations first before changing the default language.'),\n      ];\n      return $form;\n    }\n\n    $form['current_language'] = [\n      '#type' => 'item',\n      '#title' => $this->t('Current default language'),\n      '#markup' => $currentLangName,\n    ];\n\n    $form['new_langcode'] = [\n      '#type' => 'select',\n      '#title' => $this->t('New default language'),\n      '#options' => $options,\n      '#required' => TRUE,\n      '#description' => $this->t('Select the new default language for this node.'),\n    ];\n\n    $form['warning'] = [\n      '#type' => 'markup',\n      '#markup' => '<p><strong>' . $this->t('Warning:') . '</strong> ' .\n      $this->t('This will change the source language of this node. A new revision will be created.') . '</p>',\n    ];\n\n    $form['actions'] = [\n      '#type' => 'actions',\n    ];\n\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Change default language'),\n      '#button_type' => 'primary',\n    ];\n\n    $form['actions']['cancel'] = [\n      '#type' => 'link',\n      '#title' => $this->t('Cancel'),\n      '#url' => $node->toUrl(),\n      '#attributes' => [", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_change_default_language\\Form;\n\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\node_change_default_language\\NodeChangeDefaultLanguageInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Form for changing the default language of a node.\n */\nclass ChangeDefaultLanguageForm extends FormBase {\n\n  /**\n   * The node being edited.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   */\n  protected NodeInterface $node;\n\n  /**\n   * Constructs the form.\n   *\n   * @param \\Drupal\\node_change_default_language\\NodeChangeDefaultLanguageInterface $changeDefaultLanguage\n   *   The change default language service.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $languageManager\n   *   The language manager.\n   */\n  public function __construct(\n    protected NodeChangeDefaultLanguageInterface $changeDefaultLanguage,\n    protected LanguageManagerInterface $languageManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('node_change_default_language.service'),\n      $container->get('language_manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'node_change_default_language_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?NodeInterface $node = NULL): array {\n    if (!$node) {\n      return $form;\n    }\n\n    $this->node = $node;\n    $currentLangcode = $node->language()->getId();\n    $languages = $this->languageManager->getLanguages();\n    $currentLangName = $languages[$currentLangcode]->getName() ?? $currentLangcode;\n\n    // Get available translations.\n    $translationLanguages = $node->getTranslationLanguages();\n    $options = [];\n    foreach ($translationLanguages as $langcode => $language) {\n      if ($langcode !== $currentLangcode) {\n        $options[$langcode] = $language->getName();\n      }\n    }\n\n    if (empty($options)) {\n      $form['message'] = [\n        '#markup' => $this->t('This node has no translations. Add translations first before changing the default language.'),\n      ];\n      return $form;\n    }\n\n    $form['current_language'] = [\n      '#type' => 'item',\n      '#title' => $this->t('Current default language'),\n      '#markup' => $currentLangName,\n    ];\n\n    $form['new_langcode'] = [\n      '#type' => 'select',\n      '#title' => $this->t('New default language'),\n      '#options' => $options,\n      '#required' => TRUE,\n      '#description' => $this->t('Select the new default language for this node.'),\n    ];\n\n    $form['warning'] = [\n      '#type' => 'markup',\n      '#markup' => '<p><strong>' . $this->t('Warning:') . '</strong> ' .\n      $this->t('This will change the source language of this node. A new revision will be created.') . '</p>',\n    ];\n\n    $form['actions'] = [\n      '#type' => 'actions',\n    ];\n\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Change default language'),\n      '#button_type' => 'primary',\n    ];\n\n    $form['actions']['cancel'] = [\n      '#type' => 'link',\n      '#title' => $this->t('Cancel'),\n      '#url' => $node->toUrl(),\n      '#attributes' => [\n        'class' => ['button'],\n      ],\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $newLangcode = $form_state->getValue('new_langcode');\n\n    try {\n      $result = $this->changeDefaultLanguage->changeDefaultLanguage($this->node, $newLangcode);\n\n      if ($result) {\n        $languages = $this->languageManager->getLanguages();\n        $newLangName = $languages[$newLangcode]->getName() ?? $newLangcode;\n        $this->messenger()->addStatus(\n          $this->t('The default language has been changed to @language.', ['@language' => $newLangName])\n        );\n      }\n      else {\n        $this->messenger()->addWarning($this->t('The default language was not changed.'));\n      }\n    }\n    catch (\\Exception $e) {\n      $this->messenger()->addError(\n        $this->t('Failed to change the default language: @message', ['@message' => $e->getMessage()])\n      );\n    }\n\n    $form_state->setRedirectUrl(Url::fromRoute('entity.node.canonical', ['node' => $this->node->id()]));\n  }\n\n}\n", "metadata": {"source": "repos/node_change_default_language/src/Form/ChangeDefaultLanguageForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ChangeDefaultLanguageForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: The Drupal Project Message Plugin", "input": "", "output": "The Drupal Project Message Plugin\n=================================\n\nThanks for using this Drupal component.\n\nYou can participate in its development on Drupal.org, through our issue system:\nhttps://www.drupal.org/project/issues/drupal\n\nYou can get the full Drupal repo here:\nhttps://www.drupal.org/project/drupal/git-instructions\n\nYou can browse the full Drupal repo here:\nhttps://git.drupalcode.org/project/drupal\n\nWhat does it do?\n----------------\n\nThis Composer plugin displays a configurable message after Composer installation\nprocesses have finished.\n\nThis is ideal for a 'next steps' type prompt to help get the user oriented.\n\nCurrently only two Composer events are supported:\n- post-create-project-cmd, when a `composer create-project` command has\n  finished.\n- post-install-cmd, when a `composer install` command has finished.\n\nHow do I set it up?\n-------------------\n\nRequire this Composer plugin in your project template composer.json file:\n\n    \"require\": {\n      \"drupal/core-project-message\": \"^8.8\"\n    }\n\n### Configuration\n\nThere are three ways to configure this plugin to output information:\n- Using a text file.\n- Using composer.json schema keys.\n- Embedding the information in the extra section of the composer.json file.\n\n### Using a text file\n\nBy default, the plugin will respond to `post-install-cmd` or\n`post-create-project-cmd` Composer events by looking for a similarly-named file\nin the root of the project. For instance, if the user issues a `composer\ncreate-project` command, when that command is finished, the plugin will look for\na file named `post-create-project-cmd-message.txt` and then display it on the\ncommand line.\n\nThe file should be plain text, with markup suitable for Symfony's\n`OutputInterface::writeln()` method. See documentation here:\nhttps://symfony.com/doc/3.4/console/coloring.html\n\nYou can also configure your own file(s), using the `extra` section of your\ncomposer.json file:\n\n    \"extra\": {\n      \"drupal-core-project-message\": {\n        \"post-create-project-cmd-file\": \"bespoke/special_file.txt\"\n      }\n    }\n\n### Using composer.json schema keys\n\nYou can tell the plugin to output the structured support information from the\ncomposer.json file by telling it the keys you wish to display.\n\nCurrently, only `name`, `description`, `homepage` and `support` are supported.\n\n    \"extra\": {\n        \"drupal-core-project-message\": {\n            \"include-keys\": [\"homepage\", \"support\"],\n        }\n    }\n\nThen you can include this information in your composer.json file, which you\nshould probably be doing anyway.\n\n### Embedding the information in the extra section\n\nYou can specify text directly within the `extra` section by using the\n`[event-name]-message` key. This message should be an array, with one string for\neach line:\n\n    \"extra\": {\n      \"drupal-core-project-message\": {\n        \"post-create-project-cmd-message\": [\n          \"Thanks for installing this project.\",\n          \"Read our documentation here: http://example.com/docs\"\n        ]\n      }\n    }\n\nThese strings should be plain text, with markup suitable for Symfony's\n`OutputInterface::writeln()` method. See documentation here:\nhttps://symfony.com/doc/3.4/console/coloring.html\n\nThe `-message` section will always override `-file` for a given event.\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/ProjectMessage/README.md", "type": "doc_summary", "topic": "The Drupal Project Message Plugin"}}
{"instruction": "Show me the implementation of the class Resize in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Plugin\\ImageToolkit\\Operation\\gd;\n\nuse Drupal\\Core\\ImageToolkit\\Attribute\\ImageToolkitOperation;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines GD2 resize operation.\n */\n#[ImageToolkitOperation(\n  id: \"gd_resize\",\n  toolkit: \"gd\",\n  operation: \"resize\",\n  label: new TranslatableMarkup(\"Resize\"),\n  description: new TranslatableMarkup(\"Resizes an image to the given dimensions (ignoring aspect ratio).\")\n)]\nclass Resize extends GDImageToolkitOperationBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function arguments() {\n    return [\n      'width' => [\n        'description' => 'The new width of the resized image, in pixels',\n      ],\n      'height' => [\n        'description' => 'The new height of the resized image, in pixels',\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function validateArguments(array $arguments) {\n    // Assure integers for all arguments.\n    $arguments['width'] = (int) round($arguments['width']);\n    $arguments['height'] = (int) round($arguments['height']);\n\n    // Fail when width or height are 0 or negative.\n    if ($arguments['width'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid width ('{$arguments['width']}') specified for the image 'resize' operation\");\n    }\n    if ($arguments['height'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid height ('{$arguments['height']}') specified for the image 'resize' operation\");\n    }\n\n    return $arguments;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function execute(array $arguments = []) {\n    // Create a new image of the required dimensions, and copy and resize\n    // the original image on it with resampling.\n    $original_image = $this->getToolkit()->getImage();\n    $data = [\n      'width' => $arguments['width'],\n      'height' => $arguments['height'],\n      'extension' => image_type_to_extension($this->getToolkit()->getType(), FALSE),\n      'transparent_color' => $this->getToolkit()->getTransparentColor(),\n      'is_temp' => TRUE,\n    ];\n    if ($this->getToolkit()->apply('create_new', $data)) {\n      if (imagecopyresampled($this->getToolkit()->getImage(), $original_image, 0, 0, 0, 0, $arguments['width'], $arguments['height'], imagesx($original_image), imagesy($original_image))) {\n        return TRUE;\n      }\n      // In case of failure, restore the original image.\n      $this->getToolkit()->setImage($original_image);\n    }\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/ImageToolkit/Operation/gd/Resize.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Resize", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: PasswordInterface.php\nTarget symbol: interface PasswordInterface\nNamespace: Drupal\\Core\\Password\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for PasswordInterface.\n- Ensure these methods exist where relevant:\n  - check()\n  - hash()\n  - needsRehash()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Password;\n\n/**\n * Secure password hashing functions for user authentication.\n */\ninterface PasswordInterface {\n\n  /**\n   * Maximum password length.\n   */\n  const PASSWORD_MAX_LENGTH = 512;\n\n  /**\n   * Hash a password using a secure hash.\n   *\n   * @param string $password\n   *   A plain-text password.\n   *\n   * @return string\n   *   A string containing the hashed password, or FALSE on failure.\n   */\n  public function hash(#[\\SensitiveParameter] $password);\n\n  /**\n   * Check whether a plain text password matches a hashed password.\n   *\n   * @param string $password\n   *   A plain-text password.\n   * @param string|null $hash\n   *   A hashed password.\n   *\n   * @return bool\n   *   TRUE if the password is valid, FALSE if not.\n   */\n  public function check(#[\\SensitiveParameter] $password, #[\\SensitiveParameter] $hash);\n\n  /**\n   * Check whether a hashed password needs to be replaced with a new hash.\n   *\n   * This is typically called during the login process in order to trigger the\n   * rehashing of the password, as in that stage, the plain text password is\n   * available.\n   *\n   * This method returns TRUE if the password was hashed with an older\n   * algorithm.\n   *\n   * @param string|null $hash\n   *   The hash to be checked.\n   *\n   * @return bool\n   *   TRUE if the hash is outdated and needs rehash.\n   */\n  public function needsRehash(#[\\SensitiveParameter] $hash);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Password/PasswordInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PasswordInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class BookOutlineConstraintValidator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\book\\BookHelperTrait;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\book\\BookManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * Constraint validator for changing the book outline in pending revisions.\n */\nclass BookOutlineConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  use BookHelperTrait;\n\n  /**\n   * Creates a new BookOutlineConstraintValidator instance.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $currentUser\n   *   The current user.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   Configuration factory.\n   */\n  public function __construct(\n    protected BookManagerInterface $bookManager,\n    protected AccountProxyInterface $currentUser,\n    protected ConfigFactoryInterface $configFactory,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager'),\n      $container->get('current_user'),\n      $container->get('config.factory'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($value, Constraint $constraint): void {\n    // Validate the book structure when the user has access to manage book\n    // outlines. When the user can manage book outlines, the book variable will\n    // be populated even if the node is not part of the book. If the user cannot\n    // manage book outlines, the book variable will be empty, and we can safely\n    // ignore the constraints as the outline cannot be changed by this user.\n    if (isset($value) && !empty($value->getBook()) && !$value->isNew() && !$value->isDefaultRevision()) {\n      $book = $value->getBook();\n\n      // Skip validation if the node type is not allowed in book outlines\n      // This prevents BookOutlineConstraint from interfering with\n      // Layout Builder operations on content types that aren't book enabled\n      // Get list of allowed content types for books.\n      $allowed_types_config = $this->configFactory->get('book.settings')->get('allowed_types');\n      $allowed_types = $this->getBookContentTypes($allowed_types_config);\n      // Get the node's content type (bundle)\n      $node_type = $value->bundle();\n\n      if (in_array($node_type, $allowed_types)) {\n        /** @var \\Drupal\\Core\\Entity\\ContentEntityInterface $original */\n        $original = $this->bookManager->loadBookLink($value->id(), FALSE) ?: [\n          'bid' => 0,\n          'weight' => 0,\n        ];\n        if (empty($original['pid'])) {\n          $original['pid'] = -1;\n        }\n\n        if ($book['bid'] != $original['bid']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.bid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.bid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n        if ($book['pid'] != $original['pid']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.pid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.pid')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n        if ($book['weight'] != $original['weight']) {\n          if ($this->currentUser->hasPermission('administer book outlines')) {\n            $this->context->buildViolation($constraint->messageWithLink, [\n              ':link' => Url::fromRoute('book.admin')->toString(),\n            ])\n              ->atPath('book.weight')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n          else {\n            $this->context->buildViolation($constraint->message)\n              ->atPath('book.weight')\n              ->setInvalidValue($value)\n              ->addViolation();\n          }\n        }\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/Validation/Constraint/BookOutlineConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookOutlineConstraintValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Integration Guide", "input": "", "output": "# Integration Guide\n\n**Integration with ECA, FlowDrop, and AI ecosystem**\n\n---\n\n## ECA Integration\n\n### Available ECA Actions\n\n- **NormalizeApiResponse**: Normalize API response data\n- **TransformData**: Apply data transformations\n- **MapFields**: Map fields to entity fields\n- **CallApi**: Make API requests\n\n### Available ECA Events\n\n- **ApiNormalizationComplete**: Fired after normalization completes\n- **ApiRequestSent**: Fired when API request is sent\n- **ApiError**: Fired on API errors\n\n### Example ECA Model\n\n```yaml\nid: api_normalization_workflow\nlabel: API Normalization Workflow\nevents:\n  - id: webhook_received\n    plugin: webhook_received\nconditions:\n  - id: validate_data\n    plugin: data_validation\nactions:\n  - id: normalize\n    plugin: normalize_api_response\n    configuration:\n      schema_id: \"my_schema\"\n  - id: transform\n    plugin: transform_data\n    configuration:\n      transformations:\n        - case: snake_case\n        - date_format: Y-m-d\n  - id: generate_entity\n    plugin: generate_entity\n    configuration:\n      entity_type: node\n      bundle: article\n```\n\n---\n\n## FlowDrop Integration\n\n### Available FlowDrop Nodes\n\n- **ApiRequestNode**: Make API requests\n- **NormalizeDataNode**: Normalize data\n- **TransformDataNode**: Transform data\n- **GenerateEntityNode**: Generate entities\n- **MapFieldsNode**: Map fields\n\n### Visual Workflow Example\n\n1. Create new FlowDrop workflow\n2. Add API Request node\n3. Add Normalize Data node (connect to API Request)\n4. Add Transform Data node (connect to Normalize Data)\n5. Add Generate Entity node (connect to Transform Data)\n6. Configure each node\n7. Save and activate workflow\n\n---\n\n## AI Ecosystem Integration\n\n### AI Agents Module\n\nThe module provides:\n- Agent plugin for API normalization\n- Tool plugins for API operations\n- MCP server integration\n\n### AI Module\n\nIntegration features:\n- Schema mapping assistance\n- Data classification\n- Intelligent field mapping\n\n### MCP Integration\n\nThe module can act as an MCP server:\n- Expose normalization tools\n- Provide schema resources\n- Enable agent-to-agent communication\n\n---\n\n## Related Documentation\n\n- [User Guide](./userGuide.md) - User documentation\n- [API Reference](./apiReference.md) - Developer API\n- [Examples](./examples.md) - Code examples\n", "metadata": {"source": "repos/api_normalization/docs/integration.md", "type": "doc_summary", "topic": "Integration Guide"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "username_suggester.settings:\n  path: '/admin/config/people/username-suggester'\n  defaults:\n    _form: '\\Drupal\\username_suggester\\Form\\UsernameSuggesterSettingsForm'\n    _title: 'Username Suggester Settings'\n  requirements:\n    _permission: 'administer username suggester'\n\nusername_suggester.generate:\n  path: '/username-suggester/generate'\n  defaults:\n    _controller: '\\Drupal\\username_suggester\\Controller\\UsernameSuggestionController::generate'\n    _title: 'Generate Username'\n  requirements:\n    _access: 'TRUE'\n  options:\n    _htmx_route: TRUE\n", "metadata": {"source": "repos/username_suggester/username_suggester.routing.yml", "type": "yaml_reference", "topic": "username suggester.routing"}}
{"instruction": "Show me the implementation of the class ResourceTypeBuildEvents in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\ResourceType;\n\n/**\n * Contains all events emitted during the resource type build process.\n *\n * @see \\Drupal\\jsonapi\\ResourceType\\ResourceTypeBuildEvent\n * @see \\Drupal\\jsonapi\\ResourceType\\ResourceTypeRepository\n */\nfinal class ResourceTypeBuildEvents {\n\n  /**\n   * Emitted during the resource type build process.\n   */\n  const BUILD = 'jsonapi.resource_type.build';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/ResourceType/ResourceTypeBuildEvents.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ResourceTypeBuildEvents", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: TokenHooks.php\nTarget symbol: class TokenHooks\nNamespace: Drupal\\file\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TokenHooks.\n- Include required imports:\n  - Drupal\\Core\\Datetime\\DateFormatterInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n  - Drupal\\Core\\Render\\BubbleableMetadata\n  - Drupal\\Core\\StringTranslation\\ByteSizeMarkup\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\Utility\\Token\n- Ensure these methods exist where relevant:\n  - __construct()\n  - tokenInfo()\n  - tokens()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Hook;\n\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Render\\BubbleableMetadata;\nuse Drupal\\Core\\StringTranslation\\ByteSizeMarkup;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Utility\\Token;\n\n/**\n * Hook implementations for file tokens.\n */\nclass TokenHooks {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    private readonly Token $token,\n    private readonly DateFormatterInterface $dateFormatter,\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n  ) {}\n\n  /**\n   * Implements hook_tokens().\n   */\n  #[Hook('tokens')]\n  public function tokens($type, $tokens, array $data, array $options, BubbleableMetadata $bubbleable_metadata): array {\n    $langcode = $options['langcode'] ?? NULL;\n    $replacements = [];\n    if ($type == 'file' && !empty($data['file'])) {\n      $dateFormatStorage = $this->entityTypeManager->getStorage('date_format');\n      /** @var \\Drupal\\file\\FileInterface $file */\n      $file = $data['file'];\n      foreach ($tokens as $name => $original) {\n        switch ($name) {\n          // Basic keys and values.\n          case 'fid':\n            $replacements[$original] = $file->id();\n            break;\n\n          case 'uuid':\n            $replacements[$original] = $file->uuid();\n            break;\n\n          // Essential file data.\n          case 'name':\n            $replacements[$original] = $file->getFilename();\n            break;\n\n          case 'path':\n            $replacements[$original] = $file->getFileUri();\n            break;\n\n          case 'mime':\n            $replacements[$original] = $file->getMimeType();\n            break;\n\n          case 'size':\n            $replacements[$original] = ByteSizeMarkup::create($file->getSize());\n            break;\n\n          case 'url':\n            // Ideally, this would use return a relative URL, but because tokens\n            // are also often used in emails, it's better to keep absolute file\n            // URLs. The 'url.site' cache context is associated to ensure the\n            // correct absolute URL is used in case of a multisite setup.\n            $replacements[$original] = $file->createFileUrl(FALSE);\n            $bubbleable_metadata->addCacheContexts(['url.site']);\n            break;\n\n          // These tokens are default variations on the chained tokens handled\n          // below.\n          case 'created':\n            $date_format = $dateFormatStorage->load('medium');\n            $bubbleable_metadata->addCacheableDependency($date_format);\n            $replacements[$original] = $this->dateFormatter->format($file->getCreatedTime(), 'medium', '', NULL, $langcode);\n            break;\n\n          case 'changed':\n            $date_format = $dateFormatStorage->load('medium');\n            $bubbleable_metadata = $bubbleable_metadata->addCacheableDependency($date_format);\n            $replacements[$original] = $this->dateFormatter->format($file->getChangedTime(), 'medium', '', NULL, $langcode);\n            break;\n\n          case 'owner':\n            $owner = $file->getOwner();\n            $bubbleable_metadata->addCacheableDependency($owner);\n            $name = $owner->label();\n            $replacements[$original] = $name;\n            break;\n        }\n      }\n      if ($date_tokens = $this->token->findWithPrefix($tokens, 'created')) {\n        $replacements += $this->token->generate('date', $date_tokens, ['date' => $file->getCreatedTime()], $options, $bubbleable_metadata);\n      }\n      if ($date_tokens = $this->token->findWithPrefix($tokens, 'changed')) {\n        $replacements += $this->token->generate('date', $date_tokens, ['date' => $file->getChangedTime()], $options, $bubbleable_metadata);\n      }\n      if (($owner_tokens = $this->token->findWithPrefix($tokens, 'owner')) && $file->getOwner()) {\n        $replacements += $this->token->generate('user', $owner_tokens, ['user' => $file->getOwner()], $options, $bubbleable_metadata);\n      }\n    }\n    return $replacements;\n  }\n\n  /**\n   * Implements hook_token_info().\n   */\n  #[Hook('token_info')]\n  public function tokenInfo(): array {\n    $types['file'] = [\n      'name' => $this->t(\"Files\"),\n      'description' => $this->t(\"Tokens related to uploaded files.\"),\n      'needs-data' => 'file',\n    ];\n    // File related tokens.\n    $file['fid'] = [\n      'name' => $this->t(\"File ID\"),\n      'description' => $this->t(\"The unique ID of the uploaded file.\"),\n    ];\n    $file['uuid'] = ['name' => $this->t('UUID'), 'description' => $this->t('The UUID of the uploaded file.')];\n    $file['name'] = ['name' => $this->t(\"File name\"), 'description' => $this->t(\"The name of the file on disk.\")];\n    $file['path'] = [\n      'name' => $this->t(\"Path\"),\n      'description' => $this->t(\"The location of the file relative to Drupal root.\"),\n    ];\n    $file['mime'] = ['name' => $this->t(\"MIME type\"), 'description' => $this->t(\"The MIME type of the file.\")];\n    $file['size'] = ['name' => $this->t(\"File size\"), 'description' => $this->t(\"The size of the file.\")];\n    $file['url'] = ['name' => $this->t(\"URL\"), 'description' => $this->t(\"The web-accessible URL for the file.\")];\n    $file['created'] = [\n      'name' => $this->t(\"Created\"),\n      'description' => $this->t(\"The date the file created.\"),\n      'type' => 'date',\n    ];\n    $file['changed'] = [\n      'name' => $this->t(\"Changed\"),\n      'description' => $this->t(\"The date the file was most recently changed.\"),\n      'type' => 'date',\n    ];\n    $file['owner'] = [\n      'name' => $this->t(\"Owner\"),\n      'description' => $this->t(\"The user who originally uploaded the file.\"),\n      'type' => 'user',\n    ];\n    return ['types' => $types, 'tokens' => ['file' => $file]];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Hook/TokenHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TokenHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DatetimeRangeHooks.php\nTarget symbol: class DatetimeRangeHooks\nNamespace: Drupal\\datetime_range\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DatetimeRangeHooks.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\Url\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n- Ensure these methods exist where relevant:\n  - help()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\datetime_range\\Hook;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for datetime_range.\n */\nclass DatetimeRangeHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.datetime_range':\n        $output = '';\n        $output .= '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The Datetime Range module provides a Date field that stores start dates and times, as well as end dates and times. See the <a href=\":field\">Field module help</a> and the <a href=\":field_ui\">Field UI module help</a> pages for general information on fields and how to create and manage them. For more information, see the <a href=\":datetime_do\">online documentation for the Datetime Range module</a>.', [\n          ':field' => Url::fromRoute('help.page', [\n            'name' => 'field',\n          ])->toString(),\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n          ':datetime_do' => 'https://www.drupal.org/documentation/modules/datetime_range',\n        ]) . '</p>';\n        $output .= '<h2>' . $this->t('Uses') . '</h2>';\n        $output .= '<dl>';\n        $output .= '<dt>' . $this->t('Managing and displaying date fields') . '</dt>';\n        $output .= '<dd>' . $this->t('The <em>settings</em> and the <em>display</em> of the Date field can be configured separately. See the <a href=\":field_ui\">Field UI help</a> for more information on how to manage fields and their display.', [\n          ':field_ui' => \\Drupal::moduleHandler()->moduleExists('field_ui') ? Url::fromRoute('help.page', [\n            'name' => 'field_ui',\n          ])->toString() : '#',\n        ]) . '</dd>';\n        $output .= '<dt>' . $this->t('Displaying dates') . '</dt>';\n        $output .= '<dd>' . $this->t('Dates can be displayed using the <em>Plain</em> or the <em>Default</em> formatter. The <em>Plain</em> formatter displays the date in the <a href=\"http://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format. If you choose the <em>Default</em> formatter, you can choose a format from a predefined list that can be managed on the <a href=\":date_format_list\">Date and time formats</a> page.', [\n          ':date_format_list' => Url::fromRoute('entity.date_format.collection')->toString(),\n        ]) . '</dd>';\n        $output .= '</dl>';\n        return $output;\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime_range/src/Hook/DatetimeRangeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatetimeRangeHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "paragraphs_iframe_preview.paragraph_iframe_preview:\n  path: '/paragraph-iframe-preview/{paragraph_uuid}'\n  defaults:\n    _controller: '\\Drupal\\paragraphs_iframe_preview\\Controller\\ParagraphsIframePreviewController'\n  options:\n    no_cache: TRUE\n  requirements:\n    _permission: 'access content overview'\n", "metadata": {"source": "repos/paragraphs_iframe_preview/paragraphs_iframe_preview.routing.yml", "type": "yaml_reference", "topic": "paragraphs iframe preview.routing"}}
{"instruction": "Show me the implementation of the class Graph in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Graph;\n\n/**\n * Directed acyclic graph manipulation.\n *\n * This class represents a directed acyclic graph (DAG) and provides methods\n * for processing and sorting it.\n *\n * Example of a graph structure:\n * @code\n *   1\u2500\u2500\u2500\u2500\u25ba2\u2500\u2500\u2500\u2500\u25ba3\n *         \u2502     \u2502\n *         \u2502     \u25bc\n *         \u2514\u2500\u2500\u2500\u25ba 4\n * @endcode\n *\n * Example of defining a graph in PHP:\n * @code\n *   $graph[1]['edges'][2] = 1;\n *   $graph[2]['edges'][3] = 1;\n *   $graph[2]['edges'][4] = 1;\n *   $graph[3]['edges'][4] = 1;\n * @endcode\n */\nclass Graph {\n\n  /**\n   * Holds the directed acyclic graph.\n   *\n   * @var array\n   */\n  protected $graph;\n\n  /**\n   * Instantiates the directed acyclic graph object.\n   *\n   * @param array $graph\n   *   A three-dimensional associative array, with the first keys being the\n   *   names of the vertices, which can be strings or numbers. The second key is\n   *   'edges', whose value is an array keyed by the names of the vertices\n   *   connected to it; the values in this array can be simply TRUE or may\n   *   contain other data.\n   */\n  public function __construct($graph) {\n    $this->graph = $graph;\n  }\n\n  /**\n   * Performs a depth-first search and sort on the directed acyclic graph.\n   *\n   * @return array\n   *   The given $graph with more secondary keys filled in:\n   *   - 'paths': Contains a list of vertices than can be reached on a path from\n   *     this vertex.\n   *   - 'reverse_paths': Contains a list of vertices that has a path from them\n   *     to this vertex.\n   *   - 'weight': If there is a path from a vertex to another then the weight\n   *      of the latter is higher.\n   *   - 'component': Vertices in the same component have the same component\n   *     identifier.\n   */\n  public function searchAndSort() {\n    $state = [\n      // The order of last visit of the depth first search. This is the reverse\n      // of the topological order if the graph is acyclic.\n      'last_visit_order' => [],\n      // The components of the graph.\n      'components' => [],\n    ];\n    // Perform the actual search.\n    foreach ($this->graph as $start => $data) {\n      $this->depthFirstSearch($state, $start);\n    }\n\n    // We do such a numbering that every component starts with 0. This is useful\n    // for module installs as we can install every 0 weighted module in one\n    // request, and then every 1 weighted etc.\n    $component_weights = [];\n\n    foreach ($state['last_visit_order'] as $vertex) {\n      $component = $this->graph[$vertex]['component'];\n      if (!isset($component_weights[$component])) {\n        $component_weights[$component] = 0;\n      }\n      $this->graph[$vertex]['weight'] = $component_weights[$component]--;\n    }\n\n    return $this->graph;\n  }\n\n  /**\n   * Performs a depth-first search on a graph.\n   *\n   * @param array $state\n   *   An associative array. The key 'last_visit_order' stores a list of the\n   *   vertices visited. The key components stores list of vertices belonging\n   *   to the same the component.\n   * @param string|int $start\n   *   An arbitrary vertex where we started traversing the graph.\n   * @param string|int|null $component\n   *   The component of the last vertex.\n   *\n   * @see \\Drupal\\Component\\Graph\\Graph::searchAndSort()\n   */\n  protected function depthFirstSearch(&$state, $start, &$component = NULL) {\n    // Assign new component for each new vertex, i.e. when not called\n    // recursively.\n    if (!isset($component)) {\n      $component = $start;\n    }\n    // Nothing to do, if we already visited this vertex.\n    if (isset($this->graph[$start]['paths'])) {\n      return;\n    }\n    // Mark $start as visited.\n    $this->graph[$start]['paths'] = [];\n\n    // Assign $start to the current component.\n    $this->graph[$start]['component'] = $component;\n    $state['components'][$component][] = $start;\n\n    // Visit edges of $start.\n    if (isset($this->graph[$start]['edges'])) {\n      foreach ($this->graph[$start]['edges'] as $end => $v) {\n        // Mark that $start can reach $end.\n        $this->graph[$start]['paths'][$end] = $v;\n\n        if (isset($this->graph[$end]['component']) && $component != $this->graph[$end]['component']) {\n          // This vertex already has a component, use that from now on and\n          // reassign all the previously explored vertices.\n          $new_component = $this->graph[$end]['component'];\n          foreach ($state['components'][$component] as $vertex) {\n            $this->graph[$vertex]['component'] = $new_component;\n            $state['components'][$new_component][] = $vertex;\n          }\n          unset($state['components'][$component]);\n          $component = $new_component;\n        }\n        // Only visit existing vertices.\n        if (isset($this->graph[$end])) {\n          // Visit the connected vertex.\n          $this->depthFirstSearch($state, $end, $component);\n\n          // All vertices reachable by $end are also reachable by $start.\n          $this->graph[$start]['paths'] += $this->graph[$end]['paths'];\n        }\n      }\n    }\n\n    // Now that any other subgraph has been explored, add $start to all reverse\n    // paths.\n    foreach ($this->graph[$start]['paths'] as $end => $v) {\n      if (isset($this->graph[$end])) {\n        $this->graph[$end]['reverse_paths'][$start] = $v;\n      }\n    }\n\n    // Record the order of the last visit. This is the reverse of the\n    // topological order if the graph is acyclic.\n    $state['last_visit_order'][] = $start;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Graph/Graph.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Graph", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Flagger Notify\ntype: module\ndescription: 'Sends notifications to users when content they flagged (using selected flags) is updated via Cron.'\ncore_version_requirement: ^11\npackage: Flags\n\nautoload:\n  psr-4:\n    Drupal\\flagger_notify\\: src/\n\n\ndependencies:\n  - drupal:node\n  - drupal:user\n  - drupal:flag\n  - drupal:token\nconfigure: flagger_notify.settings_form\n", "metadata": {"source": "repos/flagger_notify/flagger_notify.info.yml", "type": "yaml_reference", "topic": "flagger notify.info"}}
{"instruction": "Show me the implementation of the class ViewsFilter in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\views\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\PluginID;\n\n/**\n * Defines a Plugin attribute class for views filter handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\filter\\FilterPluginBase\n *\n * @ingroup views_filter_handlers\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass ViewsFilter extends PluginID {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Attribute/ViewsFilter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsFilter", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: i.4. Reporting Problems", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Goal](/docs/user_guide/en/preface-reporting.html#s-goal)\n* [Steps](/docs/user_guide/en/preface-reporting.html#s-steps)\n\n## [Preface](/docs/user_guide/en/preface.html)\n\n* [i.1. Copyright](/docs/user_guide/en/copyright.html)\n* [i.2. Audience and Goal](/docs/user_guide/en/preface-audience.html)\n* [i.3. Organization](/docs/user_guide/en/preface-organization.html)\n* [i.4. Reporting Problems](/docs/user_guide/en/preface-reporting.html)\n* [i.5. Conventions of the Guide](/docs/user_guide/en/preface-conventions.html)\n* [i.6. Guiding Scenario](/docs/user_guide/en/preface-scenario.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/preface-reporting.html \"i.4. Informar de problemes\")\n* [Magyar](/hu/docs/user_guide/hu/preface-reporting.html \"i.4. Hibajelent\u00e9s\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/preface-reporting.html \"i.4. Reportando problemas\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/preface-reporting.html \"i.4. \u041f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u043f\u0440\u043e \u043f\u043e\u043c\u0438\u043b\u043a\u0443\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/preface-reporting.html \"i.4. Reporting Problems\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/preface-reporting.html \"i.4. Signaler des probl\u00e8mes\")\n* [Deutsch](/de/docs/user_guide/de/preface-reporting.html \"i.4. Probleme im Benutzerhandbuch melden\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/preface-reporting.html \"i.4. \u06af\u0632\u0627\u0631\u0634 \u0645\u0634\u06a9\u0644\u0627\u062a\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/preface-reporting.html \"i.4. Melaporkan Masalah\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/preface-reporting.html \"i.4. Reporting Problems\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/preface-reporting.html \"i.4. Reporting Problems\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/preface-reporting.html \"i.4. \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435\")\n\n# i.4. Reporting Problems\n\nLast [updated](/node/2827280/discuss) on\n\n14 April 2025\n\n### Goal\n\nReport a problem with this guide, such as:\n\n* Information that is incorrect or does not follow best practices\n* Steps that do not work\n* Screenshots or text that doesn\u2019t match what you see on the screen\n* Unclear writing\n* Places where a table or screenshot would help clarify the text\n* Failure to define terminology\n* Missing knowledge prerequisites or site prerequisites for a topic\n* Typographical, spelling, grammar, or formatting errors\n* Broken links\n\n### Steps\n\n1. Make a note of the topic or topics that contain the problem you have found.\n2. Log in to [*Drupal.org*](https://www.drupal.org) (you will need to create a user\n   account if you do not already have one).\n3. Visit the [User Guide issues\n   page on *Drupal.org*](https://www.drupal.org/project/issues/user_guide).\n4. Verify that the problem you found has not already been reported in another\n   issue:\n\n   * If there are only a few open issues, scan the *Summary* column to see if\n     any of their descriptions match the problem you found. You may also need to\n     read some of the issues to make sure, which you can do by clicking the links\n     in the *Summary* column.\n   * If the open issue list is long, enter either a keyword related to the\n     problem you found or the title of the topic where the problem occurs in the\n     *Search for* box, and click *Search* to reduce the issue list. Then either\n     scan the summaries or read the issues to see if they match your problem.\n5. If you determine that your problem has not already been reported, click\n   *Create a new issue*, and fill in the issue report as follows:\n\n   | Field name | Explanation | Example value |\n   | --- | --- | --- |\n   | Title | Short summary of the problem you found | Instructions in \"Adding a Content Type\" do not work |\n   | Category | Type of issue being reported | Bug report |\n   | Version | Version of the guide you found the problem in | 9.1.x-dev |\n   | Issue summary | Details of the problem you found | In the \"Adding a Content Type\" topic, in step 3, when I clicked *Save*, I got the following error message: \u2026 |\n6. Reread the *Title* and *Issue summary* you entered, and verify that the\n   following information is included in your report:\n\n   * A complete description of the problem you found\n   * The name of the topic or topics where you found the problem\n   * The language you are reading the guide in (if not English)\n   * If you read the guide on a website, a link to the page or pages\n     with the problem\n7. Click *Save* to create the issue.\n8. Check back on the issue in a few days. If one of the project maintainers has\n   asked for clarification, respond by adding a comment to the issue.\n\n**Attributions**\n\nWritten by [Jennifer Hodgdon](https://www.drupal.org/u/jhodgdon).\n\nNext [\u2192 i.5. Conventions of the Guide](/docs/user_guide/en/preface-conventions.html)\n\nPrevious [\u2190 i.3. Organization](/docs/user_guide/en/preface-organization.html)\n\n##\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: preface-reporting.asciidoc\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2827280/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282827280%29%20i.4.%20Reporting%20Problems) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/preface-reporting.md", "type": "doc_summary", "topic": "i.4. Reporting Problems"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BootstrapFiveLayoutsPluginManager.php\nTarget symbol: class BootstrapFiveLayoutsPluginManager\nNamespace: Drupal\\bootstrap_five_layouts\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BootstrapFiveLayoutsPluginManager.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface\n  - Drupal\\Core\\Extension\\ModuleHandlerInterface\n  - Drupal\\Core\\Extension\\ThemeHandlerInterface\n  - Drupal\\Core\\Plugin\\DefaultPluginManager\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\Theme\\ThemeManagerInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - alterDefinitions()\n  - create()\n  - providerExists()\n  - setContainer()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\bootstrap_five_layouts;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Extension\\ThemeHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Theme\\ThemeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n *\n */\nclass BootstrapFiveLayoutsPluginManager extends DefaultPluginManager implements ContainerInjectionInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The theme handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ThemeHandlerInterface\n   */\n  protected ThemeHandlerInterface $themeHandler;\n\n  /**\n   * The theme manager.\n   *\n   * @var \\Drupal\\Core\\Theme\\ThemeManagerInterface\n   */\n  protected ThemeManagerInterface $themeManager;\n\n  /**\n   * The service container.\n   *\n   * @var \\Symfony\\Component\\DependencyInjection\\ContainerInterface\n   */\n  protected ContainerInterface $container;\n\n  /**\n   * Base plugin manager for Bootstrap Layouts plugin managers.\n   *\n   * The \"container.namespaces\" service does not contain theme namespaces\n   * since themes are not registered in the container. To allow themes to be\n   * able to participate in these plugins, the normal \"namespaces\" provided\n   * must be appending with the missing autoloader prefixes of the themes.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Extension\\ThemeHandlerInterface $theme_handler\n   *   The theme manager used to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Theme\\ThemeManagerInterface $theme_manager\n   *   The theme manager used to invoke the alter hook with.\n   * @param string|null $plugin_interface\n   *   (optional) The interface each plugin should implement.\n   * @param string $plugin_definition_annotation_name\n   *   (optional) The name of the annotation that contains the plugin definition.\n   *   Defaults to 'Drupal\\Component\\Annotation\\Plugin'.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler, ThemeHandlerInterface $theme_handler, ThemeManagerInterface $theme_manager, $plugin_interface = NULL, $plugin_definition_annotation_name = 'Drupal\\Component\\Annotation\\Plugin') {\n    /** @var \\Composer\\Autoload\\ClassLoader $class_loader */\n    $class_loader = \\Drupal::service('class_loader');\n\n    /** @var \\ArrayObject $namespaces */\n    $ns = $namespaces->getArrayCopy();\n\n    foreach ($class_loader->getPrefixesPsr4() as $prefix => $paths) {\n      // Remove trailing path separators.\n      $prefix = trim($prefix, '\\\\');\n\n      // Remove the DRUPAL_ROOT prefix.\n      $path = str_replace(\\Drupal::root() . '/', '', reset($paths));\n\n      // Only add missing contrib theme namespaces.\n      if (preg_match('/^(core|vendor)/', $path) === 0 && !isset($namespaces[$prefix])) {\n        $ns[$prefix] = $path;\n      }\n    }\n\n    // Replace the namespaces data.\n    $namespaces->exchangeArray($ns);\n\n    // Construct the plugin manager now.\n    parent::__construct('Plugin/BootstrapFiveLayouts', $namespaces, $module_handler, $plugin_interface, $plugin_definition_annotation_name);\n\n    // Set the theme handler and manager.\n    $this->themeHandler = $theme_handler;\n    $this->themeManager = $theme_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('container.namespaces'),\n      $container->get('cache.discovery'),\n      $container->get('module_handler'),\n      $container->get('theme_handler'),\n      $container->get('theme.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setContainer(ContainerInterface $container): void {\n    $this->container = $container;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function alterDefinitions(&$definitions) {\n    if ($this->alterHook) {\n      $this->moduleHandler->alter($this->alterHook, $definitions);\n      $this->themeManager->alter($this->alterHook, $definitions);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function providerExists($provider) {\n    return $this->moduleHandler->moduleExists($provider) || $this->themeHandler->themeExists($provider);\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/BootstrapFiveLayoutsPluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BootstrapFiveLayoutsPluginManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Link wrapper\ndescription: A hyperlink to anything a URL can address.\nstatus: experimental\ngroup: Generic\nslots:\n  content:\n    title: Content\nprops:\n  type: object\n  properties:\n    url:\n      title: URL\n      type: string\n      format: iri-reference\n", "metadata": {"source": "repos/display_builder/components/generic/link/link.component.yml", "type": "yaml_reference", "topic": "link.component"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: canvas_full_html.module\nSource file: <source_file>\nFile name hint: canvas_full_html.module\nBroken snippet:\n<?php\n\n/**\n * @file\n * Allows using full_html text format in Drupal Canvas WYSIWYG editors.\n *\n * This module replaces Canvas's restricted text formats (canvas_html_block,\n * canvas_html_inline) with the full_html text format for unrestricted\n * HTML editing in Canvas component instances.\n */\n\ndeclare(strict_types=0);", "output": "<?php\n\n/**\n * @file\n * Allows using full_html text format in Drupal Canvas WYSIWYG editors.\n *\n * This module replaces Canvas's restricted text formats (canvas_html_block,\n * canvas_html_inline) with the full_html text format for unrestricted\n * HTML editing in Canvas component instances.\n */\n\ndeclare(strict_types=1);\n", "metadata": {"source": "repos/canvas_full_html/canvas_full_html.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CanvasFullHtml", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: KeyPruner.php\nTarget symbol: class is\nNamespace: Drupal\\easy_encryption\\KeyManagement\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for is.\n- Include required imports:\n  - Drupal\\easy_encryption\\KeyManagement\\Port\\KeyRegistryInterface\n  - Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface\n  - Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface\n  - Psr\\Log\\LoggerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - planPruning()\n  - pruneUnused()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\KeyManagement\\Port\\KeyRegistryInterface;\nuse Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Default application service for pruning unused encryption keys.\n *\n * An encryption key is considered unused when it is not the active key and\n * is not referenced by any Key entity using the easy_encrypted provider.\n *\n * The prune operation returns partial results: individual delete failures are\n * logged and returned, and do not abort the whole run.\n *\n * @internal This class is not part of the module's public programming API.\n */\nfinal class KeyPruner implements KeyPrunerInterface {\n\n  /**\n   * Constructs a new object.\n   *\n   * @phpstan-param iterable<\\Drupal\\easy_encryption\\KeyManagement\\Observers\\KeyDeletedObserverInterface> $observers\n   */\n  public function __construct(\n    private readonly SodiumKeyPairRepositoryInterface $keyPairRepository,\n    private readonly KeyUsageTrackerInterface $usageTracker,\n    private readonly KeyRegistryInterface&MutableKeyRegistryInterface $keyRegistry,\n    private readonly iterable $observers,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function planPruning(): KeyPrunePlan {\n    try {\n      $active = $this->keyRegistry->getActiveKeyId();\n      $referenced = $this->usageTracker->getReferencedEncryptionKeyIds();\n\n      $active_id = $active['result'];\n      $referenced_ids = $referenced['result'];\n\n      $all_ids = $this->keyRegistry->listKnownKeyIds()['result'];\n\n      $to_delete = [];\n      foreach ($all_ids as $id) {\n        if ($active_id !== NULL && $id == $active_id) {\n          continue;\n        }\n        if (in_array($id, $referenced_ids, TRUE)) {\n          continue;\n        }\n        $to_delete[] = $id;\n      }\n\n      // KeyPrunePlan currently has no cacheability: that\u2019s fine because pruning\n      // is an operational action, not something we cache.\n      return new KeyPrunePlan(\n        activeKeyId: $active_id,\n        toDelete: $to_delete,\n        referenced: $referenced_ids,\n      );\n    }\n    catch (\\Throwable $e) {\n      throw KeyPrunerException::planFailed($e);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function pruneUnused(): KeyPruneResult {\n    try {\n      $plan = $this->planPruning();\n    }\n    catch (\\Throwable $e) {\n      // If planning fails, pruning cannot proceed.\n      throw KeyPrunerException::pruneFailed($e);\n    }\n\n    $deleted = [];\n    $failed = [];\n\n    foreach ($plan->toDelete as $id) {\n      try {\n        $this->keyPairRepository->deleteKeyPair($id->value);\n        $this->keyRegistry->unregister($id);\n        $deleted[] = $id;\n\n        $this->logger->notice('Pruned unused encryption key {id}.', ['id' => $id->value]);\n\n        try {\n          foreach ($this->observers as $observer) {\n            $observer->onKeyDeletion($id);\n          }\n        }\n        catch (\\Throwable) {\n          // Do not allow secondary actions to fail the primary operation.\n        }\n      }\n      catch (\\Throwable $e) {\n        $failed[] = $id;\n\n        $this->logger->error('Failed pruning encryption key {id}: {message}', [\n          'id' => $id->value,\n          'message' => $e->getMessage(),\n        ]);\n      }\n    }\n\n    return new KeyPruneResult(deleted: $deleted, failed: $failed);\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyPruner.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyPruner", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Island\nSource file: <source_file>\nFile name hint: Island.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\display_builder\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\AttributeBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\IslandType;\n\n/**\n * The island attribute.\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nfinal class Island extends AttributeBase {\n\n  /**\n   * Constructs a new Island instance.\n   *\n   * @param string $id\n   *   The plugin ID. There are some implementation bugs that make the plugin\n   *   available only if the ID follows a specific pattern. It must be either\n   *   identical to group or prefixed with the group. E.g. if the group is \"foo\"\n   *   the ID must be either \"foo\" or \"foo:bar\".\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $label\n   *   (Optional) The human-readable name of the plugin.\n   * @param bool $enabled_by_default\n   *   Island is enabled by default on new configuration. Default: False.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $description\n   *   (Optional) A brief description of the plugin.\n   * @param class-string|null $deriver\n   *   (Optional) The deriver class.\n   * @param \\Drupal\\display_builder\\IslandType|null $type\n   *   (Optional) The island type from enumeration.\n   * @param string|null $default_region\n   *   (Optional) The island default region, if applicable.\n   * @param string|null $icon\n   *   (Optional) Icon for this island.\n   * @param string $theme\n   *   (Optional) Set 'admin' to load the island with the admin theme.\n   * @param array $modules\n   *   (Optional) List of other modules required for this Island.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $label,\n    public readonly bool $enabled_by_default = FALSE,\n    public readonly ?TranslatableMarkup $description = NULL,\n    public readonly ?string $deriver = NULL,\n    public readonly ?IslandType $type = NULL,\n    public readonly ?string $default_region = NULL,\n    public readonly ?string $icon = NULL,\n    public readonly string $theme = 'default',\n    public readonly array $modules = [],\n  ) {}\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\AttributeBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\IslandType;\n\n/**\n * The island attribute.\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nfinal class Island extends AttributeBase {\n\n  /**\n   * Constructs a new Island instance.\n   *\n   * @param string $id\n   *   The plugin ID. There are some implementation bugs that make the plugin\n   *   available only if the ID follows a specific pattern. It must be either\n   *   identical to group or prefixed with the group. E.g. if the group is \"foo\"\n   *   the ID must be either \"foo\" or \"foo:bar\".\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $label\n   *   (Optional) The human-readable name of the plugin.\n   * @param bool $enabled_by_default\n   *   Island is enabled by default on new configuration. Default: False.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $description\n   *   (Optional) A brief description of the plugin.\n   * @param class-string|null $deriver\n   *   (Optional) The deriver class.\n   * @param \\Drupal\\display_builder\\IslandType|null $type\n   *   (Optional) The island type from enumeration.\n   * @param string|null $default_region\n   *   (Optional) The island default region, if applicable.\n   * @param string|null $icon\n   *   (Optional) Icon for this island.\n   * @param string $theme\n   *   (Optional) Set 'admin' to load the island with the admin theme.\n   * @param array $modules\n   *   (Optional) List of other modules required for this Island.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $label,\n    public readonly bool $enabled_by_default = FALSE,\n    public readonly ?TranslatableMarkup $description = NULL,\n    public readonly ?string $deriver = NULL,\n    public readonly ?IslandType $type = NULL,\n    public readonly ?string $default_region = NULL,\n    public readonly ?string $icon = NULL,\n    public readonly string $theme = 'default',\n    public readonly array $modules = [],\n  ) {}\n\n}\n", "metadata": {"source": "repos/display_builder/src/Attribute/Island.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Island", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.mcp_server.overview:\n  title: MCP Client Servers\n  parent: system.admin_config_services\n  description: 'List of MCP Servers to extend site functionality.'\n  route_name: entity.mcp_server.collection\n", "metadata": {"source": "repos/mcp_client/mcp_client.links.menu.yml", "type": "yaml_reference", "topic": "mcp client.links.menu"}}
{"instruction": "Show me the implementation of the class BaseFieldFileFormatterBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\file\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldItemInterface;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Field\\FormatterBase;\nuse Drupal\\Core\\File\\FileUrlGeneratorInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Base class for file formatters, which allow to link to the file download URL.\n */\nabstract class BaseFieldFileFormatterBase extends FormatterBase {\n\n  /**\n   * The file URL generator.\n   *\n   * @var \\Drupal\\Core\\File\\FileUrlGeneratorInterface\n   */\n  protected $fileUrlGenerator;\n\n  /**\n   * Constructs a BaseFieldFileFormatterBase object.\n   *\n   * @param string $plugin_id\n   *   The plugin ID for the formatter.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Field\\FieldDefinitionInterface $field_definition\n   *   The definition of the field to which the formatter is associated.\n   * @param array $settings\n   *   The formatter settings.\n   * @param string $label\n   *   The formatter label display setting.\n   * @param string $view_mode\n   *   The view mode.\n   * @param array $third_party_settings\n   *   Any third party settings.\n   * @param \\Drupal\\Core\\File\\FileUrlGeneratorInterface $file_url_generator\n   *   The file URL generator.\n   */\n  public function __construct($plugin_id, $plugin_definition, FieldDefinitionInterface $field_definition, array $settings, $label, $view_mode, array $third_party_settings, FileUrlGeneratorInterface $file_url_generator) {\n    parent::__construct($plugin_id, $plugin_definition, $field_definition, $settings, $label, $view_mode, $third_party_settings);\n    $this->fileUrlGenerator = $file_url_generator;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    $settings['link_to_file'] = FALSE;\n\n    return $settings;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $form = parent::settingsForm($form, $form_state);\n\n    $form['link_to_file'] = [\n      '#title' => $this->t('Link this field to the file download URL'),\n      '#type' => 'checkbox',\n      '#default_value' => $this->getSetting('link_to_file'),\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewElements(FieldItemListInterface $items, $langcode) {\n    $elements = [];\n\n    $url = NULL;\n    // Add support to link to the entity itself.\n    if ($this->getSetting('link_to_file')) {\n      $url = $this->fileUrlGenerator->generate($items->getEntity()->getFileUri());\n    }\n\n    foreach ($items as $delta => $item) {\n      $view_value = $this->viewValue($item);\n\n      if ($url) {\n        $elements[$delta] = [\n          '#type' => 'link',\n          '#title' => $view_value,\n          '#url' => $url,\n        ];\n      }\n      else {\n        $elements[$delta] = is_array($view_value) ? $view_value : ['#markup' => $view_value];\n      }\n    }\n\n    return $elements;\n  }\n\n  /**\n   * Generate the output appropriate for one field item.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldItemInterface $item\n   *   One field item.\n   *\n   * @return mixed\n   *   The textual output generated.\n   */\n  abstract protected function viewValue(FieldItemInterface $item);\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function isApplicable(FieldDefinitionInterface $field_definition) {\n    return $field_definition->getTargetEntityTypeId() === 'file';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Field/FieldFormatter/BaseFieldFileFormatterBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BaseFieldFileFormatterBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DefaultContentSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\media\\EventSubscriber;\n\nuse Drupal\\Core\\DefaultContent\\PreExportEvent;\nuse Drupal\\media\\MediaInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Subscribes to default content-related events.\n *\n * @internal\n *   Event subscribers are internal.\n */\nclass DefaultContentSubscriber implements EventSubscriberInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [PreExportEvent::class => 'preExport'];\n  }\n\n  /**\n   * Reacts before a media item is exported.\n   *\n   * @param \\Drupal\\Core\\DefaultContent\\PreExportEvent $event\n   *   The event object.\n   */\n  public function preExport(PreExportEvent $event): void {\n    if ($event->entity instanceof MediaInterface) {\n      // Don't export the thumbnail because it is regenerated on import.\n      $event->setExportable('thumbnail', FALSE);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/EventSubscriber/DefaultContentSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DefaultContentSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RevisionAssistantAccessCheck in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\ai_revision_assistant\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Checks access for AI Revision Assistant routes.\n */\nclass RevisionAssistantAccessCheck implements AccessInterface {\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * Constructs a RevisionAssistantAccessCheck object.\n   */\n  public function __construct(ConfigFactoryInterface $config_factory) {\n    $this->configFactory = $config_factory;\n  }\n\n  /**\n   * Checks access based on enabled content types.\n   */\n  public function access(AccountInterface $account, RouteMatchInterface $route_match) {\n    // Get the node from the route.\n    $node = $route_match->getParameter('node');\n\n    if (!$node) {\n      return AccessResult::forbidden('No node found');\n    }\n\n    // Check if this content type is enabled.\n    $config = $this->configFactory->get('ai_revision_assistant.settings');\n    $enabled_types = $config->get('enabled_content_types') ?? [];\n\n    // If no types are enabled or this type is not in the list, deny access.\n    if (empty($enabled_types) || !in_array($node->bundle(), $enabled_types)) {\n      return AccessResult::forbidden('Content type not enabled for AI revision analysis')\n        ->addCacheTags(['config:ai_revision_assistant.settings'])\n        ->addCacheContexts(['route']);\n    }\n\n    // Check if user has permission to view revisions.\n    if (!$account->hasPermission('view all revisions')) {\n      return AccessResult::forbidden('User does not have permission to view revisions')\n        ->cachePerPermissions();\n    }\n\n    return AccessResult::allowed()\n      ->addCacheTags(['config:ai_revision_assistant.settings'])\n      ->addCacheContexts(['route'])\n      ->cachePerPermissions();\n  }\n\n}\n", "metadata": {"source": "repos/ai_revision_assistant/src/Access/RevisionAssistantAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RevisionAssistantAccessCheck", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for displaying a single search result.\n *\n * This template renders a single search result. The list of results is\n * rendered using '#theme' => 'item_list', with suggestions of:\n * - item_list__search_results__(plugin_id)\n * - item_list__search_results\n *\n * Available variables:\n * - url: URL of the result.\n * - title: Title of the result.\n * - snippet: A small preview of the result. Does not apply to user searches.\n * - info: String of all the meta information ready for print. Does not apply\n *   to user searches.\n * - plugin_id: The machine-readable name of the plugin being executed,such\n *   as \"node_search\" or \"user_search\".\n * - title_prefix: Additional output populated by modules, intended to be\n *   displayed in front of the main title tag that appears in the template.\n * - title_suffix: Additional output populated by modules, intended to be\n *   displayed after the main title tag that appears in the template.\n * - info_split: Contains same data as info, but split into separate parts.\n *   - info_split.type: Node type (or item type string supplied by module).\n *   - info_split.user: Author of the node linked to users profile. Depends\n *     on permission.\n *   - info_split.date: Last update of the node. Short formatted.\n *   - info_split.comment: Number of comments output as \"% comments\", %\n *     being the count. (Depends on comment.module).\n *   items should instead be within info and renamed info.foo, info.bar, etc.\n *\n * Other variables:\n * - title_attributes: HTML attributes for the title.\n * - content_attributes: HTML attributes for the content.\n *\n * Since info_split is keyed, a direct print of the item is possible.\n * This array does not apply to user searches so it is recommended to check\n * for its existence before printing. The default keys of 'type', 'user' and\n * 'date' always exist for node searches. Modules may provide other data.\n * @code\n *   {% if (info_split.comment) %}\n *     <span class=\"info-comment\">\n *       {{ info_split.comment }}\n *     </span>\n *   {% endif %}\n * @endcode\n *\n * To check for all available data within info_split, use the code below.\n * @code\n *   <pre>\n *     {{ dump(info_split) }}\n *   </pre>\n * @endcode\n *\n * @see \\Drupal\\search\\Hook\\SearchThemeHooks::preprocessSearchResult()\n */\n#}\n{{ attach_library('olivero/search-results') }}\n{% if info_split %}\n  <div class=\"search-result__meta\">\n    {% if info_split.user %}\n      <span>\n        {{ 'By'|t }} <span class=\"search-result__author\">{{- info_split.user -}}</span>\n      </span>\n    {% endif %}\n    {% if info_date %}\n      <span  class=\"search-result__date\">, {{ info_date }}</span>\n    {% endif %}\n  </div>\n{% endif %}\n{% if title %}\n  {{ title_prefix }}\n  <h3{{ title_attributes.addClass('search-result__title') }}>\n    <a href=\"{{ url }}\">{{ title }}</a>\n  </h3>\n  {{ title_suffix }}\n{% endif %}\n{% if snippet %}\n  <div{{ content_attributes.addClass('search-result__snippet', layout, 'text-content') }}>{{ snippet }}</div>\n{% endif %}\n", "metadata": {"source": "repos/drupal_core/core/themes/olivero/templates/content/search-result.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface PathValidatorInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Path;\n\n/**\n * Provides an interface for URL path validators.\n */\ninterface PathValidatorInterface {\n\n  /**\n   * Returns a URL object, if the path is valid and accessible.\n   *\n   * @param string $path\n   *   The path to check.\n   *\n   * @return \\Drupal\\Core\\Url|false\n   *   The \\Drupal\\Core\\Url object, or FALSE if the path is not valid.\n   */\n  public function getUrlIfValid($path);\n\n  /**\n   * Returns a URL object, if the path is valid.\n   *\n   * Unlike getUrlIfValid(), access check is not performed. Do not use this\n   * method if the $path is about to be presented to a user.\n   *\n   * @param string $path\n   *   The path to check.\n   *\n   * @return \\Drupal\\Core\\Url|false\n   *   The \\Drupal\\Core\\Url object, or FALSE if the path is not valid.\n   */\n  public function getUrlIfValidWithoutAccessCheck($path);\n\n  /**\n   * Checks if the URL path is valid and accessible by the current user.\n   *\n   * @param string $path\n   *   The path to check.\n   *\n   * @return bool\n   *   TRUE if the path is valid.\n   */\n  public function isValid($path);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Path/PathValidatorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PathValidatorInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class McpIntegrationCommands in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\ai_nl_test\\Commands;\n\nuse Drupal\\ai_nl_test\\Service\\TestRunnerService;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drush\\Attributes as CLI;\nuse Drush\\Commands\\DrushCommands;\nuse Symfony\\Component\\Console\\Helper\\Table;\n\n/**\n * MCP Integration Drush commands.\n */\nfinal class McpIntegrationCommands extends DrushCommands\n{\n\n  /**\n   * The test runner service.\n   */\n  protected TestRunnerService $testRunner;\n\n  /**\n   * The config factory.\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  public function __construct(\n    TestRunnerService $test_runner,\n    ConfigFactoryInterface $config_factory\n  ) {\n    parent::__construct();\n    $this->testRunner = $test_runner;\n    $this->configFactory = $config_factory;\n  }\n\n  #[CLI\\Command(name: 'mcp:test', aliases: ['mcp-test'])]\n  #[CLI\\Option(name: 'folder', description: 'Filter tests by folder path')]\n  #[CLI\\Option(name: 'filter', description: 'Filter tests by name pattern')]\n  #[CLI\\Option(name: 'tags', description: 'Filter tests by tags (comma-separated)')]\n  #[CLI\\Option(name: 'headless', description: 'Run browser in headless mode')]\n  #[CLI\\Option(name: 'list', description: 'List available tests without running')]\n  #[CLI\\Usage(name: 'mcp:test', description: 'Run all available tests')]\n  #[CLI\\Usage(name: 'mcp:test --folder=smoke', description: 'Run tests in the smoke folder')]\n  #[CLI\\Usage(name: 'mcp:test --filter=login', description: 'Run tests with login in their name')]\n  public function runTests(\n    array $options = [\n      'folder' => null,\n      'filter' => null,\n      'tags' => null,\n      'headless' => false,\n      'list' => false,\n    ]\n  ): int {\n\n    $this->io()->title('MCP Integration Test Runner');\n\n    $tests = $this->testRunner->discoverTests([\n      'folder' => $options['folder'],\n      'filter' => $options['filter'],\n      'tags' => $options['tags'] ? explode(',', $options['tags']) : null,\n    ]);\n\n    if (empty($tests)) {\n      $this->io()->warning('No tests found matching the specified criteria.');\n      return self::EXIT_SUCCESS;\n    }\n\n    if ($options['list']) {\n      $this->listTests($tests);\n      return self::EXIT_SUCCESS;\n    }\n\n    $this->io()->text(sprintf('Found %d test(s) to run', count($tests)));\n    $this->io()->newLine();\n\n    $results = [];\n    $passed = 0;\n    $failed = 0;\n\n    $config_headless = (bool) $this->configFactory\n      ->get('ai_nl_test.settings')\n      ->get('browser_headless');\n\n    $headless = $options['headless'] || $config_headless;\n\n    foreach ($tests as $test) {\n      $this->io()->section(\"Running: {$test['name']}\");\n      $this->io()->text(\"File: {$test['path']}\");\n\n      try {\n        $result = $this->testRunner->runTest($test['path'], [\n          'headless' => $headless,\n        ]);\n\n        if ($result['status'] === 'pass') {\n          $this->io()->success('\u2713 Test passed');\n          $passed++;\n          $results[] = [$test['name'], '\u2713 PASS'];\n        } else {\n          $this->io()->error('\u2717 Test failed');\n          if (!empty($result['output'])) {\n            $this->io()->text($result['output']);\n          }\n          $failed++;\n          $results[] = [$test['name'], '\u2717 FAIL'];\n        }\n      } catch (\\Throwable $e) {\n        $this->io()->error('\u2717 Test error: ' . $e->getMessage());\n        $failed++;\n        $results[] = [$test['name'], '\u2717 ERROR'];\n      }\n\n      $this->io()->newLine();\n    }\n\n    $this->displaySummary($results, $passed, $failed);\n\n    return $failed > 0 ? self::EXIT_FAILURE : self::EXIT_SUCCESS;\n  }\n\n  protected function listTests(array $tests): void\n  {\n    $rows = [];\n\n    foreach ($tests as $test) {\n      $rows[] = [\n        $test['name'],\n        $test['folder'] ?? 'root',\n        !empty($test['tags']) ? implode(', ', $test['tags']) : '-',\n        $test['path'],\n      ];\n    }\n\n    (new Table($this->output()))\n      ->setHeaders(['Test', 'Folder', 'Tags', 'Path'])\n      ->setRows($rows)\n      ->render();\n  }\n\n  protected function displaySummary(array $results, int $passed, int $failed): void\n  {\n    (new Table($this->output()))\n      ->setHeaders(['Test', 'Status'])\n      ->setRows($results)\n      ->render();\n\n    $this->io()->newLine();\n    $this->io()->text([\n      \"Total: \" . ($passed + $failed),\n      \"Passed: $passed\",\n      \"Failed: $failed\",\n    ]);\n  }\n\n}\n", "metadata": {"source": "repos/ai_nl_test/src/Commands/McpIntegrationCommands.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "McpIntegrationCommands", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ComponentEntityDisplayBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\destination;\n\nuse Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a destination plugin for migrating entity display components.\n *\n * Display modes provide different presentations for viewing ('view modes') or\n * editing ('form modes') content. This destination plugin is an abstract base\n * class for migrating fields and other components into view and form modes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\destination\\PerComponentEntityDisplay\n * @see \\Drupal\\migrate\\Plugin\\migrate\\destination\\PerComponentEntityFormDisplay\n */\nabstract class ComponentEntityDisplayBase extends DestinationBase implements ContainerFactoryPluginInterface {\n\n  const MODE_NAME = '';\n\n  /**\n   * The entity display repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface\n   */\n  protected $entityDisplayRepository;\n\n  /**\n   * PerComponentEntityDisplay constructor.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationInterface $migration\n   *   The migration.\n   * @param \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface $entity_display_repository\n   *   The entity display repository service.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, MigrationInterface $migration, EntityDisplayRepositoryInterface $entity_display_repository) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $migration);\n    $this->entityDisplayRepository = $entity_display_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition, ?MigrationInterface $migration = NULL) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $migration,\n      $container->get('entity_display.repository')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function import(Row $row, array $old_destination_id_values = []) {\n    $values = [];\n    // array_intersect_key() won't work because the order is important because\n    // this is also the return value.\n    foreach (array_keys($this->getIds()) as $id) {\n      $values[$id] = $row->getDestinationProperty($id);\n    }\n    $entity = $this->getEntity($values['entity_type'], $values['bundle'], $values[static::MODE_NAME]);\n    if (!$row->getDestinationProperty('hidden')) {\n      $entity->setComponent($values['field_name'], $row->getDestinationProperty('options') ?: []);\n    }\n    else {\n      $entity->removeComponent($values['field_name']);\n    }\n    $entity->save();\n    return array_values($values);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['entity_type']['type'] = 'string';\n    $ids['bundle']['type'] = 'string';\n    $ids[static::MODE_NAME]['type'] = 'string';\n    $ids['field_name']['type'] = 'string';\n    return $ids;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    // This is intentionally left empty.\n  }\n\n  /**\n   * Gets the entity.\n   *\n   * @param string $entity_type\n   *   The entity type to retrieve.\n   * @param string $bundle\n   *   The entity bundle.\n   * @param string $mode\n   *   The display mode.\n   *\n   * @return \\Drupal\\Core\\Entity\\Display\\EntityDisplayInterface\n   *   The entity display object.\n   */\n  abstract protected function getEntity($entity_type, $bundle, $mode);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/destination/ComponentEntityDisplayBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ComponentEntityDisplayBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  workspaces_ui.skip_procedural_hook_scan: true\n\nservices:\n  _defaults:\n    autoconfigure: true\n\n  workspaces_ui.lazy_builders:\n    class: Drupal\\workspaces_ui\\WorkspacesUiLazyBuilders\n    arguments: [ '@workspaces.manager', '@plugin.manager.element_info' ]\n  Drupal\\workspaces_ui\\WorkspacesUiLazyBuilders: '@workspaces_ui.lazy_builders'\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces_ui/workspaces_ui.services.yml", "type": "yaml_reference", "topic": "workspaces ui.services"}}
{"instruction": "Show me the implementation of the trait MenuLinkFieldDefinitions in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Menu;\n\n/**\n * Provides default values for menu link plugin definitions.\n *\n * @package Drupal\\Core\\Menu\n */\ntrait MenuLinkFieldDefinitions {\n\n  /**\n   * Provides some default values for the definition of all menu link plugins.\n   *\n   * @var array\n   */\n  protected $defaults = [\n    // (required) The name of the menu for this link.\n    'menu_name' => 'tools',\n    // (required) The name of the route this links to, unless it's external.\n    'route_name' => '',\n    // Parameters for route variables when generating a link.\n    'route_parameters' => [],\n    // The external URL if this link has one (required if route_name is empty).\n    'url' => '',\n    // The static title for the menu link. If this came from a YAML definition\n    // or other safe source this may be a TranslatableMarkup object.\n    'title' => '',\n    // The description. If this came from a YAML definition or other safe source\n    // this may be be a TranslatableMarkup object.\n    'description' => '',\n    // The plugin ID of the parent link (or NULL for a top-level link).\n    'parent' => '',\n    // The weight of the link.\n    'weight' => 0,\n    // The default link options.\n    'options' => [],\n    'expanded' => 0,\n    'enabled' => 1,\n    // The name of the module providing this link.\n    'provider' => '',\n    'metadata' => [],\n    // Default class for local task implementations.\n    'class' => 'Drupal\\Core\\Menu\\MenuLinkDefault',\n    'form_class' => 'Drupal\\Core\\Menu\\Form\\MenuLinkDefaultForm',\n    // The plugin ID. Set by the plugin system based on the top-level YAML key.\n    'id' => '',\n  ];\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Menu/MenuLinkFieldDefinitions.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "MenuLinkFieldDefinitions", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DocumentLoaderSettingsForm\nSource file: <source_file>\nFile name hint: DocumentLoaderSettingsForm.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\document_loader\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\document_loader\\DocumentLoaderPluginManager;\nuse Drupal\\document_loader\\DocumentLoaderTypePluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configuration form for document loader settings.\n */\nclass DocumentLoaderSettingsForm extends ConfigFormBase {\n\n  /**\n   * The document loader plugin manager.\n   *\n   * @var \\Drupal\\document_loader\\DocumentLoaderPluginManager\n   */\n  protected DocumentLoaderPluginManager $loaderManager;\n\n  /**\n   * The document loader type plugin manager.\n   *\n   * @var \\Drupal\\document_loader\\DocumentLoaderTypePluginManager\n   */\n  protected DocumentLoaderTypePluginManager $typeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->loaderManager = $container->get('plugin.manager.document_loader');\n    $instance->typeManager = $container->get('plugin.manager.document_loader_type');\n    return $instance;\n  }\n\n  /**\n   * Gets the names of editable configuration objects.\n   *\n   * @return string[]\n   *   An array of editable configuration object names.\n   */\n  protected function getEditableConfigNames(): array {\n    return ['document_loader.settings'];\n  }\n\n  /**\n   * Gets the unique string identifying the form.\n   *\n   * @return string\n   *   The unique string identifying the form.\n   */\n  public function getFormId(): string {\n    return 'document_loader_settings_form';\n  }\n\n  /**\n   * Builds the document loader settings form.\n   *\n   * @param array<string, mixed> $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return array<mixed>\n   *   The form array.\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('document_loader.settings');\n    $default_loaders = $config->get('default_loaders') ?? [];\n\n    $form['#tree'] = TRUE;\n    $form['default_loaders'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Default Document Loaders'),\n      '#description' => $this->t('Set default document loader plugins for each document loader type.'),\n    ];\n\n    // Get all document loader types.\n    $loader_types = $this->typeManager->getDefinitions();\n    $loader_definitions = $this->loaderManager->getDefinitions();\n\n    foreach ($loader_types as $type_id => $type_definition) {\n      // Build options for loaders that support this type.\n      $options = [];\n      foreach ($loader_definitions as $loader_id => $loader_definition) {\n        if (in_array($type_id, $loader_definition['document_loader_types'] ?? [])) {\n          $options[$loader_id] = $loader_definition['label'];\n        }\n      }\n\n      if (empty($options)) {\n        continue;\n      }\n\n      $form['default_loaders'][$type_id] = [\n        '#type' => 'select',\n        '#title' => $type_definition['label'],\n        '#options' => $options,\n        '#default_value' => $default_loaders[$type_id] ?? '',\n        '#empty_option' => $this->t('- None -'),\n        '#description' => $type_definition['description'] ?? '',\n      ];\n    }\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * Submits the document loader settings form.\n   *\n   * @param array<mixed> $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\document_loader\\DocumentLoaderPluginManager;\nuse Drupal\\document_loader\\DocumentLoaderTypePluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configuration form for document loader settings.\n */\nclass DocumentLoaderSettingsForm extends ConfigFormBase {\n\n  /**\n   * The document loader plugin manager.\n   *\n   * @var \\Drupal\\document_loader\\DocumentLoaderPluginManager\n   */\n  protected DocumentLoaderPluginManager $loaderManager;\n\n  /**\n   * The document loader type plugin manager.\n   *\n   * @var \\Drupal\\document_loader\\DocumentLoaderTypePluginManager\n   */\n  protected DocumentLoaderTypePluginManager $typeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->loaderManager = $container->get('plugin.manager.document_loader');\n    $instance->typeManager = $container->get('plugin.manager.document_loader_type');\n    return $instance;\n  }\n\n  /**\n   * Gets the names of editable configuration objects.\n   *\n   * @return string[]\n   *   An array of editable configuration object names.\n   */\n  protected function getEditableConfigNames(): array {\n    return ['document_loader.settings'];\n  }\n\n  /**\n   * Gets the unique string identifying the form.\n   *\n   * @return string\n   *   The unique string identifying the form.\n   */\n  public function getFormId(): string {\n    return 'document_loader_settings_form';\n  }\n\n  /**\n   * Builds the document loader settings form.\n   *\n   * @param array<string, mixed> $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return array<mixed>\n   *   The form array.\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('document_loader.settings');\n    $default_loaders = $config->get('default_loaders') ?? [];\n\n    $form['#tree'] = TRUE;\n    $form['default_loaders'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Default Document Loaders'),\n      '#description' => $this->t('Set default document loader plugins for each document loader type.'),\n    ];\n\n    // Get all document loader types.\n    $loader_types = $this->typeManager->getDefinitions();\n    $loader_definitions = $this->loaderManager->getDefinitions();\n\n    foreach ($loader_types as $type_id => $type_definition) {\n      // Build options for loaders that support this type.\n      $options = [];\n      foreach ($loader_definitions as $loader_id => $loader_definition) {\n        if (in_array($type_id, $loader_definition['document_loader_types'] ?? [])) {\n          $options[$loader_id] = $loader_definition['label'];\n        }\n      }\n\n      if (empty($options)) {\n        continue;\n      }\n\n      $form['default_loaders'][$type_id] = [\n        '#type' => 'select',\n        '#title' => $type_definition['label'],\n        '#options' => $options,\n        '#default_value' => $default_loaders[$type_id] ?? '',\n        '#empty_option' => $this->t('- None -'),\n        '#description' => $type_definition['description'] ?? '',\n      ];\n    }\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * Submits the document loader settings form.\n   *\n   * @param array<mixed> $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $config = $this->configFactory->getEditable('document_loader.settings');\n\n    $default_loaders = $form_state->getValue('default_loaders', []);\n    // Remove empty values.\n    $default_loaders = array_filter($default_loaders);\n\n    $config->set('default_loaders', $default_loaders)->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/document_loader/src/Form/DocumentLoaderSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DocumentLoaderSettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: GrantCa3TextFormatPermissions.php\nTarget symbol: class GrantCa3TextFormatPermissions\nNamespace: Drupal\\govcms_ca3_consumer_helper\\Plugin\\ConfigAction\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for GrantCa3TextFormatPermissions.\n- Include required imports:\n  - Drupal\\Core\\Config\\Action\\Attribute\\ConfigAction\n  - Drupal\\Core\\Config\\Action\\ConfigActionException\n  - Drupal\\Core\\Config\\Action\\ConfigActionPluginInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Psr\\Log\\LoggerInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - apply()\n  - create()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\govcms_ca3_consumer_helper\\Plugin\\ConfigAction;\n\nuse Drupal\\Core\\Config\\Action\\Attribute\\ConfigAction;\nuse Drupal\\Core\\Config\\Action\\ConfigActionException;\nuse Drupal\\Core\\Config\\Action\\ConfigActionPluginInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Grants CA3 text format permissions to roles with media permissions.\n *\n * This config action identifies roles with media-related permissions and grants\n * them permission to use the CA3 text format. This ensures content authors can\n * edit CA3 media fields that use the ca3_format text format.\n *\n * @internal\n */\n#[ConfigAction(\n  id: 'grantCa3TextFormatPermissions',\n  admin_label: new TranslatableMarkup('Grant CA3 text format permissions'),\n)]\nfinal class GrantCa3TextFormatPermissions implements ConfigActionPluginInterface, ContainerFactoryPluginInterface {\n\n  use RoleMediaPermissionsTrait;\n\n  /**\n   * Constructs a GrantCa3TextFormatPermissions object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger service.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('logger.factory')->get('govcms_ca3_consumer_helper'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function apply(string $configName, mixed $value): void {\n    if (!is_array($value)) {\n      throw new ConfigActionException('The grantCa3TextFormatPermissions action requires an array of text format permissions.');\n    }\n\n    $role_storage = $this->entityTypeManager->getStorage('user_role');\n    $this->grantPermissionsToRoles(\n      $role_storage,\n      $value,\n      $this->logger,\n      'Granted CA3 text format permissions to role \"@role\": @permissions',\n    );\n  }\n\n}\n", "metadata": {"source": "repos/govcms_ca3_consumer_helper/src/Plugin/ConfigAction/GrantCa3TextFormatPermissions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GrantCa3TextFormatPermissions", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: 9.1. Concept: Uses of Views", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Prerequisite knowledge](/docs/user_guide/en/views-concept.html#s-prerequisite-knowledge)\n* [What is a view?](/docs/user_guide/en/views-concept.html#s-what-is-a-view)\n* [What types of data can be displayed using views?](/docs/user_guide/en/views-concept.html#s-what-types-of-data-can-be-displayed-using-views)\n* [What are the ways data can be output using views?](/docs/user_guide/en/views-concept.html#s-what-are-the-ways-data-can-be-output-using-views)\n* [Related topics](/docs/user_guide/en/views-concept.html#s-related-topics)\n\n## [Chapter 9. Creating Listings with Views](/docs/user_guide/en/views-chapter.html)\n\n* [9.1. Concept: Uses of Views](/docs/user_guide/en/views-concept.html)\n* [9.2. Concept: The Parts of a View](/docs/user_guide/en/views-parts.html)\n* [9.3. Creating a Content List View](/docs/user_guide/en/views-create.html)\n* [9.4. Duplicating a View](/docs/user_guide/en/views-duplicate.html)\n* [9.5. Adding a Block Display to a View](/docs/user_guide/en/views-block.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/views-concept.html \"9.1. Concept: Uses of Views\")\n* [Magyar](/hu/docs/user_guide/hu/views-concept.html \"9.1. Alapfogalom: N\u00e9zetek haszn\u00e1lata\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/views-concept.html \"9.1. Concept: Uses of Views\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/views-concept.html \"9.1. \u041e\u0441\u043d\u043e\u0432\u0438: \u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0412\u0438\u0434\u0456\u0432\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/views-concept.html \"9.1. Concept: Uses of Views\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/views-concept.html \"9.1. Concept: usages des vues\")\n* [Deutsch](/de/docs/user_guide/de/views-concept.html \"9.1. Konzept: Verwendung von Ansichten\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/views-concept.html \"9.1. \u0645\u0641\u0647\u0648\u0645: \u06a9\u0627\u0631\u0628\u0631\u062f\u0647\u0627\u06cc Views\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/views-concept.html \"9.1. Concept: Uses of Views\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/views-concept.html \"9.1. Concept: Uses of Views\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/views-concept.html \"9.1. Concept: Uses of Views\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/views-concept.html \"9.1. \u041e\u0441\u043d\u043e\u0432\u044b: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0439\")\n\n# 9.1. Concept: Uses of Views\n\nLast [updated](/node/2827349/discuss) on\n\n14 April 2025\n\n### Prerequisite knowledge\n\n* [Section\u00a02.4, \u201cConcept: Modular Content\u201d](/docs/user_guide/en/planning-modular.html \" Modular Content\")\n* [Section\u00a02.3, \u201cConcept: Content Entities and Fields\u201d](/docs/user_guide/en/planning-data-types.html \" Content Entities and Fields\")\n\n### What is a view?\n\nA *view* is a listing of content on a website. The core Views module handles the\ndisplay of views, and the core Views UI module allows you to create and edit\nthem in the administrative interface. When you define views, you are interested\nin taking data from your website and displaying it to the user.\n\n### What types of data can be displayed using views?\n\nYou can create views to output practically any content entity that is stored in\nthe system. For example, you can create the following lists for the farmers\nmarket site:\n\n* Lists of vendors\n* Lists of recipes\n* Lists of the most recent content on the site\n* Lists of users on the site\n\n### What are the ways data can be output using views?\n\nA listing created by a view can be in any of the following forms:\n\n* Table with sortable fields\n* Grid layouts\n* Teasers or pictures that link to articles\n* Blocks\n* JSON output\n* RSS feeds\n* Calendars\n* On-screen slideshows\n\n### Related topics\n\n* [Section\u00a09.2, \u201cConcept: The Parts of a View\u201d](/docs/user_guide/en/views-parts.html \" The Parts of a View\")\n* [Section\u00a09.3, \u201cCreating a Content List View\u201d](/docs/user_guide/en/views-create.html \"9.3.\u00a0Creating a Content List View\")\n\n**Attributions**\n\nWritten and edited by\n[Michael Lenahan](https://www.drupal.org/u/michaellenahan) at\n[erdfisch](https://erdfisch.de), and\n[Jojy Alphonso](https://www.drupal.org/u/jojyja) at\n[Red Crackle](http://redcrackle.com).\n\nNext [\u2192 9.2. Concept: The Parts of a View](/docs/user_guide/en/views-parts.html)\n\nPrevious [\u2190 8.3. Placing a Block in a Region](/docs/user_guide/en/block-place.html)\n\n##\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: views-concept.asciidoc\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2827349/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282827349%29%209.1.%20Concept%3A%20Uses%20of%20Views) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/views-concept.md", "type": "doc_summary", "topic": "9.1. Concept: Uses of Views"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Static backdrop\"\nslots:\n  title: \"Offcanvas\"\n  body:\n    - type: html_tag\n      tag: div\n      value: \"I will not close if you click outside of me.\"\nprops:\n  variant: start\n  scroll: false\n  backdrop: static\n  heading_level: 5\nlibrary_wrapper: >\n  {% set offcanvas_id = offcanvas_id|default(\"offcanvas-\" ~ random()) %}\n  {% set props = {'#props': _story['#props']|merge({'offcanvas_id': offcanvas_id})} %}\n  {{ include('bootstrap_components:button', {\n    'label': 'Toggle static offcanvas'|t,\n    'variant': 'primary',\n    'attributes': {\n      'data-bs-target': '#' ~ offcanvas_id,\n      'data-bs-toggle': 'offcanvas',\n      'aria-controls': offcanvas_id,\n      'aria-expanded': 'false',\n    },\n  }, with_context = false) }}\n  {{ _story|merge(props) }}\n", "metadata": {"source": "repos/bootstrap_components/components/offcanvas/stories/offcanvas.static_backdrop.story.yml", "type": "yaml_reference", "topic": "offcanvas.static backdrop.story"}}
{"instruction": "Show me the implementation of the class PreExportEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\DefaultContent;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Entity\\ContentEntityTypeInterface;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event dispatched before an entity is exported as default content.\n *\n * Subscribers to this event can attach callback functions which can be used\n * to export specific fields or field types. When exporting fields that either\n * have that name, or match that data type, callback will be called for each\n * field item with two arguments: the field item, and an object which holds\n * metadata (e.g., dependencies) about the entity being exported. The callback\n * should return an array of exported values for that field item, or NULL if the\n * item should not be exported.\n *\n * Subscribers may also mark specific fields as either not exportable, or\n * as explicitly exportable -- for example, computed fields are not normally\n * exported, but a subscriber could flag a computed field as exportable if\n * circumstances require it.\n */\nfinal class PreExportEvent extends Event {\n\n  /**\n   * An array of export callbacks, keyed by field type.\n   *\n   * @var array<string, callable>\n   */\n  private array $callbacks = [];\n\n  /**\n   * Whether specific fields (keyed by name) should be exported or not.\n   *\n   * @var array<string, bool>\n   */\n  private array $allowList = [];\n\n  public function __construct(\n    public readonly ContentEntityInterface $entity,\n    public readonly ExportMetadata $metadata,\n  ) {}\n\n  /**\n   * Toggles whether a specific entity key should be exported.\n   *\n   * @param string $key\n   *   An entity key, e.g. `uuid` or `langcode`. Can be a regular entity key, or\n   *   a revision metadata key.\n   * @param bool $export\n   *   Whether to export the entity key, even if it is computed.\n   */\n  public function setEntityKeyExportable(string $key, bool $export = TRUE): void {\n    $entity_type = $this->entity->getEntityType();\n    assert($entity_type instanceof ContentEntityTypeInterface);\n\n    if ($entity_type->hasKey($key)) {\n      $this->setExportable($entity_type->getKey($key), $export);\n    }\n    elseif ($entity_type->hasRevisionMetadataKey($key)) {\n      $this->setExportable($entity_type->getRevisionMetadataKey($key), $export);\n    }\n  }\n\n  /**\n   * Toggles whether a specific field should be exported.\n   *\n   * @param string $name\n   *   The name of the field.\n   * @param bool $export\n   *   Whether to export the field, even if it is computed.\n   */\n  public function setExportable(string $name, bool $export = TRUE): void {\n    $this->allowList[$name] = $export;\n  }\n\n  /**\n   * Returns a map of which fields should be exported.\n   *\n   * @return bool[]\n   *   An array whose keys are field names, and the values are booleans\n   *   indicating whether the field should be exported, even if it is computed.\n   */\n  public function getAllowList(): array {\n    return $this->allowList;\n  }\n\n  /**\n   * Sets the export callback for a specific field name or data type.\n   *\n   * @param string $name_or_data_type\n   *   A field name or field item data type, like `field_item:image`. If the\n   *   callback should run for every field a given type, this should be prefixed\n   *   with `field_item:`, which is the Typed Data prefix for field items. If\n   *   there is no prefix, this is treated as a field name.\n   * @param callable $callback\n   *   The callback which should export items of the specified field type. See\n   *   the class documentation for details.\n   */\n  public function setCallback(string $name_or_data_type, callable $callback): void {\n    $this->callbacks[$name_or_data_type] = $callback;\n  }\n\n  /**\n   * Returns the field export callbacks collected by this event.\n   *\n   * @return callable[]\n   *   The export callbacks, keyed by field type.\n   */\n  public function getCallbacks(): array {\n    return $this->callbacks;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/DefaultContent/PreExportEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PreExportEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ApiNormalizationServiceInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\n/**\n * Interface for API normalization service.\n */\ninterface ApiNormalizationServiceInterface {\n\n  /**\n   * Normalizes an API request.\n   *\n   * @param array $request_data\n   *   The request data to normalize.\n   * @param string $provider\n   *   The API provider name.\n   *\n   * @return array\n   *   The normalized request data.\n   */\n  public function normalizeRequest(array $request_data, string $provider): array;\n\n  /**\n   * Normalizes an API response.\n   *\n   * @param array $response_data\n   *   The response data to normalize.\n   * @param string $provider\n   *   The API provider name.\n   *\n   * @return array\n   *   The normalized response data.\n   */\n  public function normalizeResponse(array $response_data, string $provider): array;\n\n  /**\n   * Logs an API request.\n   *\n   * @param array $request_data\n   *   The request data to log.\n   */\n  public function logRequest(array $request_data): void;\n\n  /**\n   * Validates API request against OpenAPI schema.\n   *\n   * @param array $request_data\n   *   The request data to validate.\n   * @param string $schema_id\n   *   The OpenAPI schema identifier.\n   *\n   * @return array\n   *   Validation result with success status and errors.\n   */\n  public function validateRequestSchema(array $request_data, string $schema_id): array;\n\n  /**\n   * Validates API response against OpenAPI schema.\n   *\n   * @param array $response_data\n   *   The response data to validate.\n   * @param string $schema_id\n   *   The OpenAPI schema identifier.\n   *\n   * @return array\n   *   Validation result with success status and errors.\n   */\n  public function validateResponseSchema(array $response_data, string $schema_id): array;\n\n  /**\n   * Gets OpenAPI 3.1 compliant schema for an endpoint.\n   *\n   * @param string $endpoint\n   *   The API endpoint path.\n   * @param string $method\n   *   The HTTP method.\n   *\n   * @return array|null\n   *   The OpenAPI schema or null if not found.\n   */\n  public function getOpenApiSchema(string $endpoint, string $method): ?array;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/ApiNormalizationServiceInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ApiNormalizationServiceInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BootstrapFiveLayoutsUpdateManager.php\nTarget symbol: class BootstrapFiveLayoutsUpdateManager\nNamespace: Drupal\\bootstrap_five_layouts\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BootstrapFiveLayoutsUpdateManager.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\Extension\\ModuleHandlerInterface\n  - Drupal\\Core\\Extension\\ThemeHandlerInterface\n  - Drupal\\Core\\Theme\\ThemeManagerInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getUpdates()\n  - setContainer()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\bootstrap_five_layouts;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Extension\\ThemeHandlerInterface;\nuse Drupal\\Core\\Theme\\ThemeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n *\n */\nclass BootstrapFiveLayoutsUpdateManager extends BootstrapFiveLayoutsPluginManager {\n\n  /**\n   * The service container.\n   *\n   * @var \\Symfony\\Component\\DependencyInjection\\ContainerInterface\n   */\n  protected ContainerInterface $container;\n\n  /**\n   * Constructs a new \\Drupal\\bootstrap_five_layouts\\BootstrapFiveLayoutsManager object.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Extension\\ThemeHandlerInterface $theme_handler\n   *   The theme manager used to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Theme\\ThemeManagerInterface $theme_manager\n   *   The theme manager used to invoke the alter hook with.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler, ThemeHandlerInterface $theme_handler, ThemeManagerInterface $theme_manager) {\n    parent::__construct($namespaces, $cache_backend, $module_handler, $theme_handler, $theme_manager, 'Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts\\BootstrapFiveLayoutsUpdateInterface', 'Drupal\\bootstrap_five_layouts\\Annotation\\BootstrapFiveLayoutsUpdate');\n    $this->alterInfo('bootstrap_five_layouts_update_info');\n    $this->setCacheBackend($cache_backend, 'bootstrap_five_layouts_update_info');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setContainer(ContainerInterface $container): void {\n    $this->container = $container;\n  }\n\n  /**\n   * Retrieves the update plugins for a specific schema version.\n   *\n   * @param int $schema\n   *   The update schema version to retrieve.\n   *\n   * @return \\Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts\\BootstrapFiveLayoutsUpdateInterface[]\n   *   An array of update plugins, keyed by their plugin id.\n   */\n  public function getUpdates($schema) {\n    $updates = [];\n    foreach ($this->getDefinitions() as $plugin_id => $definition) {\n      if (isset($definition['schema']) && $definition['schema'] == $schema) {\n        $updates[$plugin_id] = $this->createInstance($plugin_id);\n      }\n    }\n    return $updates;\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/BootstrapFiveLayoutsUpdateManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BootstrapFiveLayoutsUpdateManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use analysis:\n  title: 'Use MCP analysis tools'\n  description: 'Run site/content analysis tools (security audit, performance, broken links, accessibility checks) via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/mcp_tools_analysis.permissions.yml", "type": "yaml_reference", "topic": "mcp tools analysis.permissions"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ViewsQuery.php\nTarget symbol: class ViewsQuery\nNamespace: Drupal\\views\\Attribute\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ViewsQuery.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\Attribute\\Plugin\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\views\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a ViewsQuery attribute for plugin discovery.\n *\n * @see \\Drupal\\views\\Plugin\\views\\query\\QueryPluginBase\n *\n * @ingroup views_query_plugins\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass ViewsQuery extends Plugin {\n\n  /**\n   * Constructs an ViewsDisplayExtender attribute.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $title\n   *   The plugin title used in the views UI.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $short_title\n   *   (optional) The short title used in the views UI.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $help\n   *   (optional) A short help string; this is displayed in the views UI.\n   * @param bool $no_ui\n   *   (optional) Whether the plugin should be not selectable in the UI.\n   *   If set to TRUE, you can still use it via the API in config files.\n   *   Defaults to FALSE.\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $title,\n    public readonly ?TranslatableMarkup $short_title = NULL,\n    public readonly ?TranslatableMarkup $help = NULL,\n    public readonly bool $no_ui = FALSE,\n    public readonly ?string $deriver = NULL,\n  ) {}\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Attribute/ViewsQuery.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsQuery", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: UserPreferenceLoginRedirectCommands\nSource file: <source_file>\nFile name hint: UserPreferenceLoginRedirectCommands.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\user_preference_login_redirect\\Commands;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\user\\UserDataInterface;\nuse Drupal\\user_preference_login_redirect\\RouteParser;\nuse Drush\\Attributes as CLI;\nuse Drush\\Commands\\DrushCommands;\n\n/**\n * Contains user preference login redirect drush commands.\n */\nfinal class UserPreferenceLoginRedirectCommands extends DrushCommands {\n\n  /**\n   * Constructs a UserPreferenceLoginRedirectCommands object.\n   */\n  public function __construct(\n    private readonly UserDataInterface $userData,\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly ConfigFactoryInterface $configFactory,\n    private readonly RouteParser $routeParser,\n  ) {\n    parent::__construct();\n  }\n\n  /**\n   * Bulk updates all users to use a given route.\n   */\n  #[CLI\\Command(name: 'user_preference_login_redirect:bulk-update', aliases: ['uplr-bu'])]\n  #[CLI\\Argument(name: 'route', description: 'The route key or label to set for all users.')]\n  #[CLI\\Usage(name: 'uplr-bu <front>', description: 'Set all users to redirect to <front>')]\n  #[CLI\\Usage(name: 'uplr-bu \"My Dashboard\"', description: 'Set all users to redirect to the route labeled \"My Dashboard\"')]\n  public function bulkUpdate(string $route): void {\n    $config = $this->configFactory->get('user_preference_login_redirect.settings');\n    $available_routes_text = $config->get('available_routes');\n\n    if (empty($available_routes_text)) {\n      $this->io()->error(dt('No available routes configured in user_preference_login_redirect.settings.'));\n      return;\n    }\n\n    $routes = $this->routeParser->parseRoutes($available_routes_text);\n    $route_key = NULL;\n\n    // Check if the input matches a key.\n    if (array_key_exists($route, $routes)) {\n      $route_key = $route;\n    }\n    // Check if the input matches a label.\n    elseif ($key = array_search($route, $routes)) {\n      $route_key = $key;\n    }\n\n    if (!$route_key) {\n      $this->io()->error(dt('The route / route label \"@route\" was not found in the configured available routes.', ['@route' => $route]));\n      $this->io()->info(dt('Available routes:'));\n      foreach ($routes as $key => $label) {\n        $this->io()->info(dt('  @key (@label)', ['@key' => $key, '@label' => $label]));\n      }\n      return;\n    }\n\n    $this->io()->title(dt('Bulk updating users redirect preference'));\n    $this->io()->text(dt('Target route: @key (@label)', ['@key' => $route_key, '@label' => $routes[$route_key]]));\n\n    if (!$this->io()->confirm(dt('Are you sure you want to update ALL users?'))) {\n      return;\n    }\n\n    $user_storage = $this->entityTypeManager->getStorage('user');\n    $uids = $user_storage->getQuery()\n      ->accessCheck(FALSE)\n      ->execute();\n\n    if (empty($uids)) {\n      $this->io()->warning(dt('No users found.'));\n      return;\n    }\n\n    $count = count($uids);\n    $this->io()->progressStart($count);\n\n    foreach ($uids as $uid) {\n      $this->userData->set('user_preference_login_redirect', (int) $uid, 'redirect_route', $route_key);\n      $this->io()->progressAdvance();\n    }\n\n    $this->io()->progressFinish();\n    $this->io()->success(dt(\n      'Updated @count users to use route \"@route\".',\n      ['@count' => $count, '@route' => $route_key]\n    ));\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\user_preference_login_redirect\\Commands;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\user\\UserDataInterface;\nuse Drupal\\user_preference_login_redirect\\RouteParser;\nuse Drush\\Attributes as CLI;\nuse Drush\\Commands\\DrushCommands;\n\n/**\n * Contains user preference login redirect drush commands.\n */\nfinal class UserPreferenceLoginRedirectCommands extends DrushCommands {\n\n  /**\n   * Constructs a UserPreferenceLoginRedirectCommands object.\n   */\n  public function __construct(\n    private readonly UserDataInterface $userData,\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly ConfigFactoryInterface $configFactory,\n    private readonly RouteParser $routeParser,\n  ) {\n    parent::__construct();\n  }\n\n  /**\n   * Bulk updates all users to use a given route.\n   */\n  #[CLI\\Command(name: 'user_preference_login_redirect:bulk-update', aliases: ['uplr-bu'])]\n  #[CLI\\Argument(name: 'route', description: 'The route key or label to set for all users.')]\n  #[CLI\\Usage(name: 'uplr-bu <front>', description: 'Set all users to redirect to <front>')]\n  #[CLI\\Usage(name: 'uplr-bu \"My Dashboard\"', description: 'Set all users to redirect to the route labeled \"My Dashboard\"')]\n  public function bulkUpdate(string $route): void {\n    $config = $this->configFactory->get('user_preference_login_redirect.settings');\n    $available_routes_text = $config->get('available_routes');\n\n    if (empty($available_routes_text)) {\n      $this->io()->error(dt('No available routes configured in user_preference_login_redirect.settings.'));\n      return;\n    }\n\n    $routes = $this->routeParser->parseRoutes($available_routes_text);\n    $route_key = NULL;\n\n    // Check if the input matches a key.\n    if (array_key_exists($route, $routes)) {\n      $route_key = $route;\n    }\n    // Check if the input matches a label.\n    elseif ($key = array_search($route, $routes)) {\n      $route_key = $key;\n    }\n\n    if (!$route_key) {\n      $this->io()->error(dt('The route / route label \"@route\" was not found in the configured available routes.', ['@route' => $route]));\n      $this->io()->info(dt('Available routes:'));\n      foreach ($routes as $key => $label) {\n        $this->io()->info(dt('  @key (@label)', ['@key' => $key, '@label' => $label]));\n      }\n      return;\n    }\n\n    $this->io()->title(dt('Bulk updating users redirect preference'));\n    $this->io()->text(dt('Target route: @key (@label)', ['@key' => $route_key, '@label' => $routes[$route_key]]));\n\n    if (!$this->io()->confirm(dt('Are you sure you want to update ALL users?'))) {\n      return;\n    }\n\n    $user_storage = $this->entityTypeManager->getStorage('user');\n    $uids = $user_storage->getQuery()\n      ->accessCheck(FALSE)\n      ->execute();\n\n    if (empty($uids)) {\n      $this->io()->warning(dt('No users found.'));\n      return;\n    }\n\n    $count = count($uids);\n    $this->io()->progressStart($count);\n\n    foreach ($uids as $uid) {\n      $this->userData->set('user_preference_login_redirect', (int) $uid, 'redirect_route', $route_key);\n      $this->io()->progressAdvance();\n    }\n\n    $this->io()->progressFinish();\n    $this->io()->success(dt(\n      'Updated @count users to use route \"@route\".',\n      ['@count' => $count, '@route' => $route_key]\n    ));\n  }\n\n}\n", "metadata": {"source": "repos/user_preference_login_redirect/src/Commands/UserPreferenceLoginRedirectCommands.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserPreferenceLoginRedirectCommands", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DecimalFormatter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'number_decimal' formatter.\n *\n * The 'Default' formatter is different for integer fields on the one hand, and\n * for decimal and float fields on the other hand, in order to be able to use\n * different settings.\n */\n#[FieldFormatter(\n  id: 'number_decimal',\n  label: new TranslatableMarkup('Default'),\n  field_types: [\n    'decimal',\n    'float',\n  ],\n)]\nclass DecimalFormatter extends NumericFormatterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    return [\n      'thousand_separator' => '',\n      'decimal_separator' => '.',\n      'scale' => 2,\n      'prefix_suffix' => TRUE,\n    ] + parent::defaultSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $elements = parent::settingsForm($form, $form_state);\n\n    $elements['decimal_separator'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Decimal marker'),\n      '#options' => ['.' => $this->t('Decimal point'), ',' => $this->t('Comma')],\n      '#default_value' => $this->getSetting('decimal_separator'),\n      '#weight' => 5,\n    ];\n    $elements['scale'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Scale', [], ['context' => 'decimal places']),\n      '#min' => 0,\n      '#max' => 10,\n      '#default_value' => $this->getSetting('scale'),\n      '#description' => $this->t('The number of digits to the right of the decimal.'),\n      '#weight' => 6,\n    ];\n\n    return $elements;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function numberFormat($number) {\n    return number_format($number, $this->getSetting('scale'), $this->getSetting('decimal_separator'), $this->getSetting('thousand_separator'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldFormatter/DecimalFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DecimalFormatter", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  commerce_referral.referral_manager:\n    class: Drupal\\commerce_referral\\ReferralManager\n    arguments:\n      - '@entity_type.manager'\n      - '@commerce_promotion.coupon_code_generator'\n      - '@config.factory'\n      - '@cache.default'\n  commerce_referral.order_subscriber:\n    class: Drupal\\commerce_referral\\EventSubscriber\\OrderSubscriber\n    arguments: ['@entity_type.manager', '@logger.channel.commerce_referral', '@commerce_referral.referral_manager', '@config.factory']\n    tags:\n      - { name: 'event_subscriber' }\n  commerce_referral.referral_coupon_constraint_validator:\n    class: Drupal\\commerce_referral\\Plugin\\Validation\\Constraint\\ReferralCouponConstraintValidator\n    arguments: ['@commerce_referral.referral_manager']\n    tags:\n      - { name: 'validator.constraint_validator', alias: 'ReferralCoupon' }\n  logger.channel.commerce_referral:\n    parent: 'logger.channel_base'\n    arguments: ['commerce_referral']\n", "metadata": {"source": "repos/commerce_referral/commerce_referral.services.yml", "type": "yaml_reference", "topic": "commerce referral.services"}}
{"instruction": "Show me the implementation of the class ExecutionContext in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Runtime;\n\nuse Psr\\Log\\LoggerInterface;\nuse Drupal\\flowdrop\\DTO\\OutputInterface;\nuse Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext;\nuse Drupal\\Core\\Logger\\LoggerChannelFactoryInterface;\n\n/**\n * Manages execution context for workflow runs.\n */\nclass ExecutionContext {\n\n  /**\n   * Logger channel for this service.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  private readonly LoggerInterface $logger;\n\n  public function __construct(LoggerChannelFactoryInterface $loggerFactory) {\n    $this->logger = $loggerFactory->get('flowdrop_runtime');\n  }\n\n  /**\n   * Create a new execution context.\n   */\n  public function createContext(\n    string $workflowId,\n    string $pipelineId,\n    array $initialData = [],\n  ): NodeExecutionContext {\n    return new NodeExecutionContext(\n      workflowId: $workflowId,\n      pipelineId: $pipelineId,\n      initialData: $initialData,\n    );\n  }\n\n  /**\n   * Update context with node output.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext $context\n   *   The execution context.\n   * @param string $nodeId\n   *   The node ID.\n   * @param \\Drupal\\flowdrop\\DTO\\OutputInterface $output\n   *   The node output.\n   *\n   * @return \\Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext\n   *   The updated context.\n   */\n  public function updateContext(\n    NodeExecutionContext $context,\n    string $nodeId,\n    OutputInterface $output,\n  ): NodeExecutionContext {\n    $context->addNodeOutput($nodeId, $output);\n\n    // Track execution order using an incrementing counter.\n    // This counter is used for conflict resolution when multiple sources\n    // target the same input port (latest execution = higher counter).\n    $metadata = $context->getMetadata();\n    $executionCounter = ($metadata[\"execution_counter\"] ?? 0) + 1;\n    $metadata[\"execution_counter\"] = $executionCounter;\n    $metadata[\"node_execution_order\"][$nodeId] = $executionCounter;\n    $context->setMetadata($metadata);\n\n    $this->logger->debug('Updated execution context for node @node_id (execution order: @order)', [\n      '@node_id' => $nodeId,\n      '@order' => $executionCounter,\n    ]);\n\n    return $context;\n  }\n\n  /**\n   * Get input data for a node based on its dependencies.\n   */\n  public function getNodeInputData(\n    NodeExecutionContext $context,\n    array $nodeDependencies,\n  ): array {\n    $inputData = $context->getInitialData();\n\n    // Add outputs from dependent nodes.\n    foreach ($nodeDependencies as $dependencyNodeId) {\n      $dependencyOutput = $context->getNodeOutput($dependencyNodeId);\n      if ($dependencyOutput) {\n        $inputData = array_merge($inputData, $dependencyOutput->toArray());\n      }\n    }\n\n    return $inputData;\n  }\n\n  /**\n   * Validate execution context.\n   */\n  public function validateContext(NodeExecutionContext $context): bool {\n    if (empty($context->getWorkflowId())) {\n      $this->logger->error('Execution context missing workflow ID');\n      return FALSE;\n    }\n\n    if (empty($context->getPipelineId())) {\n      $this->logger->error('Execution context missing pipeline ID');\n      return FALSE;\n    }\n\n    return TRUE;\n  }\n\n  /**\n   * Get execution summary.\n   */\n  public function getExecutionSummary(NodeExecutionContext $context): array {\n    return [\n      'workflow_id' => $context->getWorkflowId(),\n      'pipeline_id' => $context->getPipelineId(),\n      'node_count' => count($context->getNodeOutputs()),\n      'metadata' => $context->getMetadata(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Runtime/ExecutionContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExecutionContext", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  node_change_default_language.service:\n    class: Drupal\\node_change_default_language\\NodeChangeDefaultLanguage\n    arguments:\n      - '@database'\n      - '@entity_type.manager'\n      - '@logger.factory'\n      - '@language_manager'\n      - '@datetime.time'\n      - '@current_user'\n", "metadata": {"source": "repos/node_change_default_language/node_change_default_language.services.yml", "type": "yaml_reference", "topic": "node change default language.services"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: FieldItemDeriver.php\nTarget symbol: class FieldItemDeriver\nNamespace: Drupal\\Core\\Field\\Plugin\\DataType\\Deriver\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for FieldItemDeriver.\n- Include required imports:\n  - Drupal\\Core\\Field\\FieldTypePluginManagerInterface\n  - Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - getDerivativeDefinition()\n  - getDerivativeDefinitions()", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\DataType\\Deriver;\n\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides data type plugins for each existing field type plugin.\n */\nclass FieldItemDeriver implements ContainerDeriverInterface {\n\n  /**\n   * List of derivative definitions.\n   *\n   * @var array\n   */\n  protected $derivatives = [];\n\n  /**\n   * The base plugin ID this derivative is for.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The field type plugin manager.\n   *\n   * @var \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface\n   */\n  protected $fieldTypePluginManager;\n\n  /**\n   * Constructs a FieldItemDeriver object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface $field_type_plugin_manager\n   *   The field type plugin manager.\n   */\n  public function __construct($base_plugin_id, FieldTypePluginManagerInterface $field_type_plugin_manager) {\n    $this->basePluginId = $base_plugin_id;\n    $this->fieldTypePluginManager = $field_type_plugin_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('plugin.manager.field.field_type')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinition($derivative_id, $base_plugin_definition) {\n    if (!isset($this->derivatives)) {\n      $this->getDerivativeDefinitions($base_plugin_definition);\n    }\n    if (isset($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    foreach ($this->fieldTypePluginManager->getDefinitions() as $plugin_id => $definition) {\n      $definition['definition_class'] = '\\Drupal\\Core\\Field\\TypedData\\FieldItemDataDefinition';\n      $definition['list_definition_class'] = '\\Drupal\\Core\\Field\\BaseFieldDefinition';\n      $definition['unwrap_for_canonical_representation'] = FALSE;\n      $this->derivatives[$plugin_id] = $definition;\n    }\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/DataType/Deriver/FieldItemDeriver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldItemDeriver", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "social_auth_account_verification.settings:\n  type: config_object\n  label: 'Social Auth Account Verification settings'\n  mapping:\n    email_subject:\n      type: string\n      label: 'Email subject'\n    email_body:\n      type: string\n      label: 'Email body'\n    code_expiration_minutes:\n      type: integer\n      label: 'Code expiration time in minutes'\n    max_attempts:\n      type: integer\n      label: 'Maximum verification attempts'\n    session_key_prefix:\n      type: string\n      label: 'Session key prefix for verification tokens'\n    session_token_expiration:\n      type: integer\n      label: 'Session token expiration time in seconds'\n    url_timeout:\n      type: integer\n      label: 'Verification URL timeout in seconds'\n    message_link_expired:\n      type: string\n      label: 'Message when verification link has expired'\n    message_code_expired:\n      type: string\n      label: 'Message when verification code has expired'\n    message_no_verification_required:\n      type: string\n      label: 'Message when account does not require verification'\n    message_invalid_verification:\n      type: string\n      label: 'Message when verification is invalid'\n    message_verified_can_login:\n      type: string\n      label: 'Message when account is verified and user can log in'\n    message_verified_pending_approval:\n      type: string\n      label: 'Message when email is verified but account pending admin approval'\n    message_code_resent:\n      type: string\n      label: 'Message when a new verification code has been sent'\n    message_verification_form_intro:\n      type: string\n      label: 'Intro message on the verification form (use @email to show the user email, omit for privacy)'\n    message_send_failed:\n      type: string\n      label: 'Message when sending verification code failed'\n", "metadata": {"source": "repos/social_auth_account_verification/config/schema/social_auth_account_verification.schema.yml", "type": "yaml_reference", "topic": "social auth account verification.schema"}}
{"instruction": "Show me the implementation of the class RegisterServicesForDestructionPass in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\DependencyInjection\\Compiler;\n\nuse Symfony\\Component\\DependencyInjection\\Compiler\\PriorityTaggedServiceTrait;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\n\n/**\n * Adds services to the \"kernel.destructable_services\" container parameter.\n *\n * Only services tagged with \"needs_destruction\" are added.\n *\n * @see \\Drupal\\Core\\DestructableInterface\n */\nclass RegisterServicesForDestructionPass implements CompilerPassInterface {\n\n  use PriorityTaggedServiceTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ContainerBuilder $container): void {\n    $service_ids = array_values(array_map(strval(...), $this->findAndSortTaggedServices('needs_destruction', $container)));\n    $container->setParameter('kernel.destructable_services', $service_ids);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/DependencyInjection/Compiler/RegisterServicesForDestructionPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegisterServicesForDestructionPass", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait PrecedingConstraintAwareValidatorTrait in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Validation\\ExecutionContext;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintViolationInterface;\n\n/**\n * A constraint may need preceding constraints to not have been violated.\n *\n * @internal\n */\ntrait PrecedingConstraintAwareValidatorTrait {\n\n  /**\n   * Checks whether any preceding constraints have been violated.\n   *\n   * @param \\Symfony\\Component\\Validator\\Constraint $current_constraint\n   *   The constraint currently being validated.\n   *\n   * @return bool\n   *   TRUE if any preceding constraints have been violated, FALSE otherwise.\n   */\n  protected function hasViolationsForPrecedingConstraints(Constraint $current_constraint): bool {\n    assert($this->context instanceof ExecutionContext);\n    $earlier_constraints = iterator_to_array($this->getPrecedingConstraints($current_constraint));\n    $earlier_violations = array_filter(\n      iterator_to_array($this->context->getViolations()),\n      function (ConstraintViolationInterface $violation) use ($earlier_constraints) {\n        return in_array($violation->getConstraint(), $earlier_constraints);\n      }\n    );\n    return !empty($earlier_violations);\n  }\n\n  /**\n   * Gets the constraints preceding the given constraint in the current context.\n   *\n   * @param \\Symfony\\Component\\Validator\\Constraint $needle\n   *   The constraint to find the preceding constraints for.\n   *\n   * @return iterable\n   *   The preceding constraints.\n   */\n  private function getPrecedingConstraints(Constraint $needle): iterable {\n    assert($this->context instanceof ExecutionContext);\n    $constraints = $this->context->getMetadata()->getConstraints();\n    if (!in_array($needle, $constraints)) {\n      throw new \\OutOfBoundsException();\n    }\n    foreach ($constraints as $constraint) {\n      if ($constraint != $needle) {\n        yield $constraint;\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Plugin/Validation/Constraint/PrecedingConstraintAwareValidatorTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "PrecedingConstraintAwareValidatorTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\ndependencies:\n  module:\n    - responsive_image\n  enforced:\n    module:\n      - responsive_image\nname: max_1300x1300\nlabel: 'Max 1300x1300'\neffects:\n  04caae9a-fa3e-4ea6-ae09-9c26aec7d308:\n    uuid: 04caae9a-fa3e-4ea6-ae09-9c26aec7d308\n    id: image_scale\n    weight: 1\n    data:\n      width: 1300\n      height: 1300\n      upscale: false\n  e8c9d6ba-a017-4a87-9999-7ce52e138e1d:\n    uuid: e8c9d6ba-a017-4a87-9999-7ce52e138e1d\n    id: image_convert_avif\n    weight: 2\n    data:\n      extension: webp\n", "metadata": {"source": "repos/drupal_core/core/profiles/standard/config/optional/image.style.max_1300x1300.yml", "type": "yaml_reference", "topic": "image.style.max 1300x1300"}}
{"instruction": "Show me the implementation of the class DisableTheme in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_theme\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_theme\\Service\\ThemeService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_theme_disable',\n  label: new TranslatableMarkup('Disable Theme'),\n  description: new TranslatableMarkup('Disable/uninstall a theme. Cannot disable the default or admin theme.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'theme' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup('Machine name of the theme to disable'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n    'changed' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Changed'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DisableTheme extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'theme';\n\n\n  protected ThemeService $themeService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->themeService = $container->get('mcp_tools_theme.theme');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $theme = $input['theme'] ?? '';\n\n    if (empty($theme)) {\n      return ['success' => FALSE, 'error' => 'Theme name is required.'];\n    }\n\n    return $this->themeService->disableTheme($theme);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_theme/src/Plugin/tool/Tool/DisableTheme.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DisableTheme", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LanguageNegotiationUser in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\LanguageNegotiation;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\language\\Attribute\\LanguageNegotiation;\nuse Drupal\\language\\LanguageNegotiationMethodBase;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Class for identifying language from the user preferences.\n */\n#[LanguageNegotiation(\n  id: LanguageNegotiationUser::METHOD_ID,\n  name: new TranslatableMarkup('User'),\n  weight: -4,\n  description: new TranslatableMarkup(\"Follow the user's language preference.\")\n)]\nclass LanguageNegotiationUser extends LanguageNegotiationMethodBase {\n\n  /**\n   * The language negotiation method id.\n   */\n  const METHOD_ID = 'language-user';\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLangcode(?Request $request = NULL) {\n    $langcode = NULL;\n\n    // User preference (only for authenticated users).\n    if ($this->languageManager && $this->currentUser->isAuthenticated()) {\n      $preferred_langcode = $this->currentUser->getPreferredLangcode(FALSE);\n      $languages = $this->languageManager->getLanguages();\n      if (!empty($preferred_langcode) && isset($languages[$preferred_langcode])) {\n        $langcode = $preferred_langcode;\n      }\n    }\n\n    // No language preference from the user.\n    return $langcode;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/LanguageNegotiation/LanguageNegotiationUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageNegotiationUser", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FileExtensionSecureConstraintValidator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\File\\FileSystemInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validator for the FileExtensionSecureConstraint.\n */\nclass FileExtensionSecureConstraintValidator extends BaseFileConstraintValidator implements ContainerInjectionInterface {\n\n  /**\n   * Creates a new FileExtensionSecureConstraintValidator.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory.\n   */\n  public function __construct(\n    protected ConfigFactoryInterface $configFactory,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static($container->get('config.factory'));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $value, Constraint $constraint): void {\n    $file = $this->assertValueIsFile($value);\n    if (!$constraint instanceof FileExtensionSecureConstraint) {\n      throw new UnexpectedTypeException($constraint, FileExtensionSecureConstraint::class);\n    }\n\n    $allowInsecureUploads = $this->configFactory->get('system.file')->get('allow_insecure_uploads');\n    if (!$allowInsecureUploads && preg_match(FileSystemInterface::INSECURE_EXTENSION_REGEX, $file->getFilename())) {\n      $this->context->addViolation($constraint->message);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Validation/Constraint/FileExtensionSecureConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileExtensionSecureConstraintValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class McpClient in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the MCP Client module.\n */\n\nuse Drupal\\Core\\Extension\\Requirement\\RequirementSeverity;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Implements hook_requirements().\n *\n * @phpstan-param string $phase\n * @phpstan-return array<string, array<string, mixed>>\n */\nfunction mcp_client_requirements(string $phase): array {\n  $requirements = [];\n\n  // Check PHP version for SwisNL library compatibility.\n  if ($phase === 'runtime' || $phase === 'install') {\n    $requirements['mcp_client_php_version'] = [\n      'title' => t('MCP Client PHP Version'),\n      'value' => PHP_VERSION,\n    ];\n\n    if (version_compare(PHP_VERSION, '8.2.0', '<')) {\n      $requirements['mcp_client_php_version']['severity'] = class_exists(RequirementSeverity::class) ? RequirementSeverity::Error : \\REQUIREMENT_ERROR;\n      $requirements['mcp_client_php_version']['description'] = t(\n        'MCP Client requires PHP 8.2 or higher. You are running @version.',\n        ['@version' => PHP_VERSION]\n      );\n    }\n    else {\n      $requirements['mcp_client_php_version']['severity'] = class_exists(RequirementSeverity::class) ? RequirementSeverity::OK : \\REQUIREMENT_OK;\n    }\n  }\n\n  return $requirements;\n}\n\n/**\n * Add transport type and configuration fields to existing MCP servers.\n *\n * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n *   The result message.\n */\nfunction mcp_client_update_10001(): TranslatableMarkup {\n  $config_factory = \\Drupal::configFactory();\n  $updated_count = 0;\n\n  // Update all existing MCP server configurations.\n  foreach ($config_factory->listAll('mcp_client.mcp_server.') as $config_name) {\n    $config = $config_factory->getEditable($config_name);\n\n    // Set default transport type to http if not set.\n    if (!$config->get('transport_type')) {\n      $config->set('transport_type', 'http');\n      $updated_count++;\n    }\n\n    // Set default timeout if not set.\n    if (!$config->get('timeout')) {\n      $config->set('timeout', 30);\n    }\n\n    // Initialize empty arrays for new fields if not set.\n    if ($config->get('stdio_env') === NULL) {\n      $config->set('stdio_env', []);\n    }\n\n    if ($config->get('http_headers') === NULL) {\n      $config->set('http_headers', []);\n    }\n\n    $config->save();\n  }\n\n  // Clear all caches to ensure new services and schema are loaded.\n  drupal_flush_all_caches();\n\n  return new TranslatableMarkup('Added transport type configuration to @count MCP server(s). All caches have been cleared.', [\n    '@count' => $updated_count,\n  ]);\n}\n\n/**\n * Clear plugin cache after SwisNL library integration.\n *\n * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n *   The result message.\n */\nfunction mcp_client_update_10002(): TranslatableMarkup {\n  // Clear the AI function calls plugin cache.\n  /** @var \\Drupal\\Core\\Plugin\\DefaultPluginManager $plugin_manager */\n  $plugin_manager = \\Drupal::service('plugin.manager.ai.function_calls');\n  $plugin_manager->clearCachedDefinitions();\n\n  return new TranslatableMarkup('Cleared AI function calls plugin cache to ensure compatibility with SwisNL MCP Client library.');\n}\n", "metadata": {"source": "repos/mcp_client/mcp_client.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "McpClient", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.flowdrop_pipeline.edit_form:\n  route_name: entity.flowdrop_pipeline.edit_form\n  group: flowdrop_pipeline\n  title: 'Edit'\n\nentity.flowdrop_pipeline.delete_form:\n  route_name: entity.flowdrop_pipeline.delete_form\n  group: flowdrop_pipeline\n  title: 'Delete'\n  weight: 10\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_pipeline/flowdrop_pipeline.links.contextual.yml", "type": "yaml_reference", "topic": "flowdrop pipeline.links.contextual"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Glossary", "input": "", "output": "# Glossary\n\n- **Batch Processing**: Executing multiple workflow runs over varying inputs, typically via queues or Drupal Batch API.\n- **Data Edge**: An edge that passes data from one node's output port to another node's input port; does not control execution flow.\n- **Deterministic Execution**: Given the same inputs and seed, produces reproducible outputs; randomness is controlled via a seed.\n- **Execution Session**: A single run of a workflow carrying transient context (inputs, intermediates, outputs) across nodes.\n- **Field Mapping**: Configuration that binds Drupal fields or form inputs to workflow\u2011node parameters.\n- **Headless Mode**: Running workflows via HTTP APIs without Drupal\u2011rendered UIs.\n- **Idempotency**: Re\u2011running a node with identical inputs/config yields the same state and side\u2011effects.\n- **Image/Asset Proxy**: A Drupal endpoint that serves or caches artifacts produced by external runtimes.\n- **Layout Builder Block**: A Drupal block placed with Layout Builder to assemble inputs, run controls, and results.\n- **Loopback Edge**: A special edge type for loop iteration; connects loop body output back to iterator node; excluded from dependency checking and cycle detection.\n- **Node Processor**: The backend component that executes a node; should be idempotent and deterministic.\n- **Output Handling**: Normalizing, storing, and delivering images, video, text, or other artifacts from workflows.\n- **Queue Processing**: Offloading long\u2011running or asynchronous execution to Drupal\u2019s Queue API or cron workers.\n- **Session Context**: Strongly\u2011typed key\u2013value data accessible to nodes within an execution session.\n- **Trigger Edge**: An edge that controls execution flow; connects to a node's trigger input port to determine if/when the node executes.\n- **Validation Rules**: Constraints applied to inputs or mappings to ensure safe, correct execution.\n- **Workflow**: A directed graph of steps that transforms inputs into outputs within a defined context.\n- **Workflow Node**: A discrete, reusable step with typed inputs, typed outputs, and configuration.\n- **Workflow UI**: The editor used by site builders/admins to author and configure workflows.\n", "metadata": {"source": "repos/flowdrop/docs/meta/glossary.md", "type": "doc_summary", "topic": "Glossary"}}
{"instruction": "Show me the implementation of the class LinkNotExistingInternalConstraint in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\link\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Defines a protocol validation constraint for links to broken internal URLs.\n */\n#[Constraint(\n  id: 'LinkNotExistingInternal',\n  label: new TranslatableMarkup('No broken internal links', [], ['context' => 'Validation'])\n)]\nclass LinkNotExistingInternalConstraint extends SymfonyConstraint {\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    public string $message = \"The path '@uri' is invalid.\",\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/link/src/Plugin/Validation/Constraint/LinkNotExistingInternalConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LinkNotExistingInternalConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface BusinessIdentityManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\business_identity;\n\n/**\n * Interface for business identity management service.\n */\ninterface BusinessIdentityManagerInterface {\n\n  /**\n   * Gets comprehensive business information.\n   *\n   * @return \\Drupal\\business_identity\\BusinessInformation\n   *   The business information object.\n   */\n  public function getBusinessInfo(): BusinessInformation;\n\n  /**\n   * Gets the primary contact information.\n   *\n   * @return array\n   *   An array containing primary contact details.\n   */\n  public function getPrimaryContact(): array;\n\n  /**\n   * Gets all business locations.\n   *\n   * @return array\n   *   An array of location objects/arrays.\n   */\n  public function getLocations(): array;\n\n  /**\n   * Gets a specific location by type.\n   *\n   * @param string $type\n   *   The location type (e.g., 'headquarters', 'point_of_sale').\n   *\n   * @return array|null\n   *   The location data or NULL if not found.\n   */\n  public function getLocation(string $type): ?array;\n\n  /**\n   * Gets business social media links.\n   *\n   * @return array\n   *   Array of social media platform URLs.\n   */\n  public function getSocialLinks(): array;\n\n  /**\n   * Gets business legal information.\n   *\n   * @return array\n   *   Array containing legal name, tax ID, etc.\n   */\n  public function getLegalInfo(): array;\n\n  /**\n   * Gets formatted business address.\n   *\n   * @param string $type\n   *   The location type.\n   * @param string $format\n   *   The format (html, inline, plain).\n   *\n   * @return string\n   *   Formatted address string.\n   */\n  public function getFormattedAddress(string $type = 'headquarters', string $format = 'html'): string;\n\n  /**\n   * Gets business operating hours.\n   *\n   * @return array\n   *   Array of operating hours by day.\n   */\n  public function getOperatingHours(): array;\n\n  /**\n   * Checks if business is currently open.\n   *\n   * @return bool\n   *   TRUE if business is open, FALSE otherwise.\n   */\n  public function isOpen(): bool;\n\n  /**\n   * Gets business contact methods.\n   *\n   * @return array\n   *   Array of available contact methods.\n   */\n  public function getContactMethods(): array;\n\n  /**\n   * Validates business information completeness.\n   *\n   * @return array\n   *   Array of validation results/missing fields.\n   */\n  public function validateBusinessInfo(): array;\n\n}\n", "metadata": {"source": "repos/business_identity/src/BusinessIdentityManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "BusinessIdentityManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: AfterTableTruncateEvent\nSource file: <source_file>\nFile name hint: AfterTableTruncateEvent.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\db_wipe_db\\Event;\n\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event dispatched after table truncate operation.\n */\nclass AfterTableTruncateEvent extends Event {\n\n  /**\n   * Constructs an AfterTableTruncateEvent object.\n   *\n   * @param string $tableName\n   *   The table name that was truncated.\n   * @param bool $success\n   *   Whether the truncate operation was successful.\n   * @param array $tables\n   *   Array of all tables that were truncated.\n   * @param int $deletedCount\n   *   The number of rows that were deleted.\n   */\n  public function __construct(\n    protected string $tableName,\n    protected bool $success,\n    protected array $tables = [],\n    protected int $deletedCount = 0,\n  ) {}\n\n  /**\n   * Gets the table name.\n   *\n   * @return string\n   *   The table name.\n   */\n  public function getTableName(): string {\n    return $this->tableName;\n  }\n\n  /**\n   * Checks if the operation was successful.\n   *\n   * @return bool\n   *   TRUE if successful, FALSE otherwise.\n   */\n  public function isSuccess(): bool {\n    return $this->success;\n  }\n\n  /**\n   * Gets all tables that were truncated.\n   *\n   * @return array\n   *   Array of table names.\n   */\n  public function getTables(): array {\n    return $this->tables;\n  }\n\n  /**\n   * Gets the number of rows that were deleted.\n   *\n   * @return int\n   *   The deleted row count.\n   */\n  public function getDeletedCount(): int {\n    return $this->deletedCount;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\db_wipe_db\\Event;\n\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event dispatched after table truncate operation.\n */\nclass AfterTableTruncateEvent extends Event {\n\n  /**\n   * Constructs an AfterTableTruncateEvent object.\n   *\n   * @param string $tableName\n   *   The table name that was truncated.\n   * @param bool $success\n   *   Whether the truncate operation was successful.\n   * @param array $tables\n   *   Array of all tables that were truncated.\n   * @param int $deletedCount\n   *   The number of rows that were deleted.\n   */\n  public function __construct(\n    protected string $tableName,\n    protected bool $success,\n    protected array $tables = [],\n    protected int $deletedCount = 0,\n  ) {}\n\n  /**\n   * Gets the table name.\n   *\n   * @return string\n   *   The table name.\n   */\n  public function getTableName(): string {\n    return $this->tableName;\n  }\n\n  /**\n   * Checks if the operation was successful.\n   *\n   * @return bool\n   *   TRUE if successful, FALSE otherwise.\n   */\n  public function isSuccess(): bool {\n    return $this->success;\n  }\n\n  /**\n   * Gets all tables that were truncated.\n   *\n   * @return array\n   *   Array of table names.\n   */\n  public function getTables(): array {\n    return $this->tables;\n  }\n\n  /**\n   * Gets the number of rows that were deleted.\n   *\n   * @return int\n   *   The deleted row count.\n   */\n  public function getDeletedCount(): int {\n    return $this->deletedCount;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_db/src/Event/AfterTableTruncateEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AfterTableTruncateEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class EnforcedFormResponseSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\EventSubscriber;\n\nuse Drupal\\Core\\Form\\EnforcedResponse;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\HttpKernel\\Event\\ResponseEvent;\nuse Symfony\\Component\\HttpKernel\\Event\\ExceptionEvent;\nuse Symfony\\Component\\HttpKernel\\KernelEvents;\n\n/**\n * Handle the EnforcedResponseException and deliver an EnforcedResponse.\n */\nclass EnforcedFormResponseSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Replaces the response in case an EnforcedResponseException was thrown.\n   */\n  public function onKernelException(ExceptionEvent $event) {\n    if ($response = EnforcedResponse::createFromException($event->getThrowable())) {\n      // Setting the response stops the event propagation.\n      $event->setResponse($response);\n    }\n  }\n\n  /**\n   * Unwraps an enforced response.\n   */\n  public function onKernelResponse(ResponseEvent $event) {\n    $response = $event->getResponse();\n    if ($response instanceof EnforcedResponse && $event->isMainRequest()) {\n      $event->setResponse($response->getResponse());\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    $events[KernelEvents::EXCEPTION] = ['onKernelException', 128];\n    $events[KernelEvents::RESPONSE] = ['onKernelResponse', 128];\n\n    return $events;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/EventSubscriber/EnforcedFormResponseSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EnforcedFormResponseSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TextOutput in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Executor for Text Output nodes.\n */\n#[FlowDropNodeProcessor(\n  id: \"text_output\",\n  label: new \\Drupal\\Core\\StringTranslation\\TranslatableMarkup(\"Text Output\"),\n  description: \"Basic text output\",\n  version: \"1.0.0\"\n)]\nclass TextOutput extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Text output nodes can accept any inputs.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    $text = \"\";\n\n    $textParam = $params->get(\"text\");\n    if ($textParam !== NULL && $textParam !== \"\") {\n      $text = $textParam;\n    }\n\n    // Convert array to string if necessary.\n    if (is_array($text) || is_object($text)) {\n      $text = JSON::encode($text);\n    }\n\n    // Ensure text is a string.\n    $text = (string) $text;\n\n    // Apply max length if configured.\n    $maxLength = $params->get(\"maxLength\", 1000);\n    if (strlen($text) > $maxLength) {\n      $text = substr($text, 0, $maxLength) . \"...\";\n    }\n\n    return [\n      \"text\" => $text,\n      \"length\" => strlen($text),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"text\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text Input\",\n          \"description\" => \"The text to output\",\n          \"required\" => FALSE,\n        ],\n        \"maxLength\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Maximum Length\",\n          \"description\" => \"Maximum length of output text\",\n          \"default\" => 1000,\n          \"minimum\" => 1,\n          \"maximum\" => 10000,\n        ],\n        \"format\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text Format\",\n          \"description\" => \"Text formatting option\",\n          \"default\" => \"plain\",\n          \"enum\" => [\"plain\", \"html\", \"markdown\"],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"text\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Text\",\n          \"description\" => \"The processed text output\",\n        ],\n        \"length\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Length\",\n          \"description\" => \"The length of the output text\",\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/TextOutput.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TextOutput", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# One column.\nbsfl_1col:\n  label: 'BS5 \u2014 1 Column'\n  category: 'Bootstrap Five Layouts'\n  class: '\\Drupal\\bootstrap_five_layouts\\Plugin\\Layout\\BsfLayout'\n  template: 'templates/5.0.0/bs-1col'\n  type: partial\n  icon: images/1col.png\n  default_region: column\n  regions:\n    column:\n      label: 'Single Column'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n\n# Two column.\nbsfl_2col:\n  label: 'BS5 \u2014 2 Columns'\n  category: 'Bootstrap Five Layouts'\n  class: '\\Drupal\\bootstrap_five_layouts\\Plugin\\Layout\\BsfLayout'\n  template: 'templates/5.0.0/bs-2col'\n  type: partial\n  icon: images/2col.png\n  default_region: left\n  regions:\n    left:\n      label: 'Left'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-6\n    right:\n      label: 'Right'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-6\n\n# Three column.\nbsfl_3col:\n  label: 'BS5 \u2014 3 Columns'\n  category: 'Bootstrap Five Layouts'\n  class: '\\Drupal\\bootstrap_five_layouts\\Plugin\\Layout\\BsfLayout'\n  template: 'templates/5.0.0/bs-3col'\n  type: partial\n  icon: images/3col.png\n  default_region: left\n  regions:\n    left:\n      label: 'Left'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-4\n    middle:\n      label: 'Middle'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-4\n    right:\n      label: 'Right'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-4\n\n# Four column.\nbsfl_4col:\n  label: 'BS5 \u2014 4 Columns'\n  category: 'Bootstrap Five Layouts'\n  class: '\\Drupal\\bootstrap_five_layouts\\Plugin\\Layout\\BsfLayout'\n  template: 'templates/5.0.0/bs-4col'\n  default_region: first\n  type: partial\n  icon: images/4col.png\n  regions:\n    first:\n      label: 'First'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-3\n    second:\n      label: 'Second'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-3\n    third:\n      label: 'Third'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n         - col-12\n         - col-md-3\n    fourth:\n      label: 'Fourth'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-3\n\n# Five column.\nbsfl_5col:\n  label: 'BS5 \u2014 5 Columns'\n  category: 'Bootstrap Five Layouts'\n  class: '\\Drupal\\bootstrap_five_layouts\\Plugin\\Layout\\BsfLayout'\n  template: 'templates/5.0.0/bs-5col'\n  default_region: first\n  type: partial\n  icon: images/5col.png\n  regions:\n    first:\n      label: 'First'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n    second:\n      label: 'Second'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-3\n    third:\n      label: 'Third'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n         - col-12\n         - col-md-3\n    fourth:\n      label: 'Fourth'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n    fifth:\n      label: 'Fifth'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n\n# Six column.\nbsfl_6col:\n  label: 'BS5 \u2014 6 Columns'\n  category: 'Bootstrap Five Layouts'\n  class: '\\Drupal\\bootstrap_five_layouts\\Plugin\\Layout\\BsfLayout'\n  template: 'templates/5.0.0/bs-6col'\n  default_region: first\n  type: partial\n  icon: images/6col.png\n  regions:\n    first:\n      label: 'First'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n    second:\n      label: 'Second'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n    third:\n      label: 'Third'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n         - col-12\n         - col-md-2\n    fourth:\n      label: 'Fourth'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n    fifth:\n      label: 'Fifth'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n    sixth:\n      label: 'Sixth'\n      add_region_classes: TRUE\n      add_base_col: TRUE\n      classes:\n        - col-12\n        - col-md-2\n", "metadata": {"source": "repos/bootstrap_five_layouts/bootstrap_five_layouts.layouts.yml", "type": "yaml_reference", "topic": "bootstrap five layouts.layouts"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Profile.php\nTarget symbol: class Profile\nNamespace: Drupal\\display_builder\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Profile.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityBase\n  - Drupal\\Core\\Entity\\Attribute\\ConfigEntityType\n  - Drupal\\Core\\Entity\\EntityDeleteForm\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\Url\n  - Drupal\\display_builder\\Form\\ProfileForm\n  - Drupal\\display_builder\\Form\\ProfileIslandPluginForm\n  - Drupal\\display_builder\\ProfileAccessControlHandler\n- Ensure these methods exist where relevant:\n  - getEnabledIslands()\n  - getIslandConfiguration()\n  - getIslandConfigurations()\n  - getPermissionName()\n  - getRoles()\n  - isDebugModeActivated()\n  - setIslandConfiguration()\n  - toUrl()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\nuse Drupal\\Core\\Entity\\Attribute\\ConfigEntityType;\nuse Drupal\\Core\\Entity\\EntityDeleteForm;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\display_builder\\Form\\ProfileForm;\nuse Drupal\\display_builder\\Form\\ProfileIslandPluginForm;\nuse Drupal\\display_builder\\ProfileAccessControlHandler;\nuse Drupal\\display_builder\\ProfileInterface;\nuse Drupal\\display_builder\\ProfileViewBuilder;\nuse Drupal\\display_builder_ui\\ProfileListBuilder;\nuse Drupal\\user\\Entity\\Role;\nuse Drupal\\user\\RoleInterface;\n\n/**\n * Defines the display builder entity type.\n */\n#[ConfigEntityType(\n  id: 'display_builder_profile',\n  label: new TranslatableMarkup('Display builder profile'),\n  label_collection: new TranslatableMarkup('Display builder profiles'),\n  label_singular: new TranslatableMarkup('display builder profile'),\n  label_plural: new TranslatableMarkup('display builders profiles'),\n  entity_keys: [\n    'id' => 'id',\n    'label' => 'label',\n    'description' => 'description',\n    'weight' => 'weight',\n  ],\n  handlers: [\n    'access' => ProfileAccessControlHandler::class,\n    'route_provider' => [\n      'html' => 'Drupal\\display_builder\\Routing\\ProfileRouteProvider',\n    ],\n    'view_builder' => ProfileViewBuilder::class,\n    'list_builder' => ProfileListBuilder::class,\n    'form' => [\n      'add' => ProfileForm::class,\n      'edit' => ProfileForm::class,\n      'delete' => EntityDeleteForm::class,\n      'edit-plugin' => ProfileIslandPluginForm::class,\n    ],\n  ],\n  links: [\n    'add-form' => '/admin/structure/display-builder/add',\n    'edit-form' => '/admin/structure/display-builder/{display_builder_profile}',\n    'edit-plugin-form' => '/admin/structure/display-builder/{display_builder_profile}/edit/{island_id}',\n    'delete-form' => '/admin/structure/display-builder/{display_builder_profile}/delete',\n    'collection' => '/admin/structure/display-builder',\n  ],\n  admin_permission: 'administer display builder profile',\n  constraints: [\n    'ImmutableProperties' => [\n      'id',\n    ],\n  ],\n  // Example: display_builder.profile.default.yml.\n  config_prefix: 'profile',\n  config_export: [\n    'id',\n    'label',\n    'description',\n    'islands',\n    'weight',\n  ],\n)]\nfinal class Profile extends ConfigEntityBase implements ProfileInterface {\n\n  /**\n   * The display builder config ID.\n   */\n  protected string $id;\n\n  /**\n   * The display builder label.\n   */\n  protected string $label;\n\n  /**\n   * The display builder description.\n   */\n  protected string $description;\n\n  /**\n   * The display builder debug mode.\n   */\n  protected bool $debug = FALSE;\n\n  /**\n   * The islands configuration for storage.\n   */\n  protected ?array $islands = [];\n\n  /**\n   * Weight to order the entity in lists.\n   *\n   * @var int\n   */\n  protected $weight = 0;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIslandConfiguration(string $island_id): array {\n    return $this->islands[$island_id] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIslandConfigurations(): array {\n    return $this->islands ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setIslandConfiguration(string $island_id, array $configuration = []): void {\n    // When $configuration is updated from ProfileIslandPluginForm,\n    // 'weight', 'status' and 'region' properties are missing but they must not\n    // be reset.\n    $configuration['weight'] = $configuration['weight'] ?? $this->islands[$island_id]['weight'] ?? 0;\n    $configuration['status'] = $configuration['status'] ?? $this->islands[$island_id]['status'] ?? FALSE;\n\n    // Only View islands have regions.\n    if (isset($this->islands[$island_id]['region'])) {\n      $configuration['region'] = $configuration['region'] ?? $this->islands[$island_id]['region'];\n    }\n\n    $this->islands[$island_id] = $configuration;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEnabledIslands(): array {\n    $island_enabled = [];\n\n    foreach ($this->islands as $island_id => $configuration) {\n      if (isset($configuration['status']) && $configuration['status']) {\n        $island_enabled[$island_id] = $configuration['weight'] ?? 0;\n      }\n    }\n\n    return $island_enabled;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPermissionName(): string {\n    return 'use display builder ' . $this->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoles(): array {\n    // Do not list any roles if the permission does not exist.\n    $permission = $this->getPermissionName();\n\n    if (empty($permission)) {\n      return [];\n    }\n\n    $roles = \\array_filter(Role::loadMultiple(), static fn (RoleInterface $role) => $role->hasPermission($permission));\n\n    return \\array_map(static fn (RoleInterface $role) => $role->label(), $roles);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function toUrl($rel = NULL, array $options = []): Url {\n    if ($rel === 'edit-plugin-form' && $this->id() && isset($options['island_id'])) {\n      $island_id = $options['island_id'];\n      unset($options['island_id']);\n\n      return Url::fromRoute(\n        'entity.display_builder_profile.edit_plugin_form',\n        ['display_builder_profile' => $this->id(), 'island_id' => $island_id],\n        $options\n      );\n    }\n\n    return parent::toUrl($rel, $options);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isDebugModeActivated(): bool {\n    return $this->debug;\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Entity/Profile.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Profile", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: UrlEncode.php\nTarget symbol: class UrlEncode\nNamespace: Drupal\\migrate\\Plugin\\migrate\\process\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for UrlEncode.\n- Include required imports:\n  - Drupal\\migrate\\Attribute\\MigrateProcess\n  - Drupal\\migrate\\MigrateExecutableInterface\n  - Drupal\\migrate\\MigrateException\n  - Drupal\\migrate\\ProcessPluginBase\n  - Drupal\\migrate\\Row\n  - GuzzleHttp\\Psr7\\Uri\n- Ensure these methods exist where relevant:\n  - transform()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\nuse GuzzleHttp\\Psr7\\Uri;\n\n/**\n * URL-encodes the input value.\n *\n * Example:\n *\n * @code\n * process:\n *   new_url:\n *     plugin: urlencode\n *     source: 'http://example.com/a url with spaces.html'\n * @endcode\n *\n * This will convert the source URL 'http://example.com/a url with spaces.html'\n * into 'http://example.com/a%20url%20with%20spaces.html'.\n *\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('urlencode')]\nclass UrlEncode extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    // Only apply to a full URL.\n    if (is_string($value) && strpos($value, '://') > 0) {\n      // URL encode everything after the hostname.\n      $parsed_url = parse_url($value);\n      // Fail on seriously malformed URLs.\n      if ($parsed_url === FALSE) {\n        throw new MigrateException(\"Value '$value' is not a valid URL\");\n      }\n      // Iterate over specific pieces of the URL raw URL encoding each one.\n      $url_parts_to_encode = ['path', 'query', 'fragment'];\n      foreach ($parsed_url as $parsed_url_key => $parsed_url_value) {\n        if (in_array($parsed_url_key, $url_parts_to_encode)) {\n          // urlencode() would convert spaces to + signs.\n          $urlencoded_parsed_url_value = rawurlencode($parsed_url_value);\n          // Restore special characters depending on which part of the URL this\n          // is.\n          switch ($parsed_url_key) {\n            case 'query':\n              $urlencoded_parsed_url_value = str_replace('%26', '&', $urlencoded_parsed_url_value);\n              break;\n\n            case 'path':\n              $urlencoded_parsed_url_value = str_replace('%2F', '/', $urlencoded_parsed_url_value);\n              break;\n          }\n\n          $parsed_url[$parsed_url_key] = $urlencoded_parsed_url_value;\n        }\n      }\n      $value = (string) Uri::fromParts($parsed_url);\n    }\n    return $value;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/UrlEncode.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UrlEncode", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class PintoLayout in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\DrupalLayoutDiscovery;\n\nuse Drupal\\Core\\Layout\\LayoutDefault;\nuse Drupal\\Core\\Layout\\LayoutDefinition;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Plugin\\PluginWithFormsInterface;\nuse Drupal\\pinto_layout\\Discovery\\FrozenLayoutDefinition;\nuse Drupal\\pinto_layout\\Hook\\PintoLayoutHooks;\nuse Drupal\\pinto_layout\\PintoLayout\\Data\\PluginConfiguration;\nuse Pinto\\Resource\\ResourceInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Pinto Layout plugin.\n *\n * This is not a part of regular plugin discovery as we do our own thing.\n *\n * @todo stop extending LayoutDefault\n *\n * @internal\n *\n * @template Configuration of array<mixed>\n * @method Configuration getConfiguration()\n * @method void setConfiguration(Configuration $configuration)\n */\nfinal class PintoLayout extends LayoutDefault implements ContainerFactoryPluginInterface, PluginWithFormsInterface {\n\n  public function __construct(\n    array $configuration,\n    string $plugin_id,\n    LayoutDefinition $plugin_definition,\n    private DrupalLayoutDefinitionRepository $drupalLayoutDefinitionRepository,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * Ignore regression from https://www.drupal.org/project/drupal/issues/3452852.\n   *\n   * @phpstan-ignore-next-line method.childParameterType\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    /** @var \\Drupal\\Core\\Layout\\LayoutDefinition $plugin_definition */\n    return new static($configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get(DrupalLayoutDefinitionRepository::class),\n    );\n  }\n\n  public function build(array $regions): array {\n    /** @var array<string, array<mixed>> $regions */\n    $layoutDefinition = $this->getFrozenDefinition();\n\n    $build = [\n      '#theme' => PintoLayoutHooks::FAUX_THEME_ELEMENT,\n      '#' . PintoLayoutHooks::FROZEN_DEFINITION_RENDER_KEY => $layoutDefinition,\n      '#' . PintoLayoutHooks::PLUGIN_CONFIGURATION_RENDER_KEY => PluginConfiguration::fromData($this->getConfiguration()),\n    ];\n\n    // LB expects a certain structure:\n    // We cannot clear out region data (blocks) here as LayoutBuilder::buildAdministrativeSection needs to decorate each block with attributes. (`build[$region][$uuid]['#attributes']['class'][]` etc).\n    foreach ($layoutDefinition->regions->regions as $regionName) {\n      if (\\array_key_exists($regionName, $regions)) {\n        $build[$regionName] = $regions[$regionName];\n      }\n    }\n\n    return $build;\n  }\n\n  private function getFrozenDefinition(): FrozenLayoutDefinition {\n    $resource = $this->getPluginDefinition()->get(DrupalLayoutDefinitionRepository::LAYOUT_PLUGIN_ADDITIONAL_RESOURCE);\n    if (!$resource instanceof ResourceInterface) {\n      // As set by  DrupalLayoutDefinitionRepository::getDefinitionsAsHookLayouts.\n      throw new \\LogicException('Impossible! Layout definition missing Pinto resource');\n    }\n\n    return $this->drupalLayoutDefinitionRepository->getFrozenDefinitionByResource($resource);\n  }\n\n  /**\n   * @phpstan-return class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>\n   */\n  public function getFormClass($operation) {\n    if ($this->realHasFormClass($operation)) {\n      // @phpstan-ignore-next-line offsetAccess.nonOffsetAccessible return.type\n      return $this->getPluginDefinition()->get(DrupalLayoutDefinitionRepository::LAYOUT_PLUGIN_ADDITIONAL_FORMS)[$operation];\n    }\n    else {\n      return NullPluginForm::class;\n    }\n  }\n\n  public function hasFormClass($operation): bool {\n    // No matter what, we must always return a form. If this class *can* return forms: then it must always return forms.\n    return TRUE;\n  }\n\n  private function realHasFormClass(string $operation): bool {\n    /** @var array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $formClasses */\n    $formClasses = $this->getPluginDefinition()->get(DrupalLayoutDefinitionRepository::LAYOUT_PLUGIN_ADDITIONAL_FORMS);\n    return \\array_key_exists($operation, $formClasses);\n  }\n\n}\n", "metadata": {"source": "repos/pinto_layout/src/DrupalLayoutDiscovery/PintoLayout.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PintoLayout", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Inline image saver", "input": "", "output": "# Inline image saver\n\nThis module will help solve the problem of loss of inline images in markup from\nnode fields and other entities.\n\n## Requirements\n\nThis module requires no modules outside of Drupal core.\n\n## Installation\n\nInstall as you would normally install a contributed Drupal module.\nVisit https://www.drupal.org/node/1897420 for further information.\n\n## Configuration\n\n1. Go to the settings form `/admin/config/media/inline-image-saver/settings`.\n2. Fill out and submit the form.\n", "metadata": {"source": "repos/inline_image_saver/README.md", "type": "doc_summary", "topic": "Inline image saver"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Counter.php\nTarget symbol: class Counter\nNamespace: Drupal\\views\\Plugin\\views\\field\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Counter.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\views\\Attribute\\ViewsField\n  - Drupal\\views\\ResultRow\n- Ensure these methods exist where relevant:\n  - buildOptionsForm()\n  - defineOptions()\n  - getValue()\n  - query()\n  - usesGroupBy()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\field;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsField;\nuse Drupal\\views\\ResultRow;\n\n/**\n * Field handler to show a counter of the current row.\n *\n * @ingroup views_field_handlers\n */\n#[ViewsField(\"counter\")]\nclass Counter extends FieldPluginBase {\n\n  use UncacheableFieldHandlerTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesGroupBy() {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['counter_start'] = ['default' => 1];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    $form['counter_start'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Starting value'),\n      '#default_value' => $this->options['counter_start'],\n      '#description' => $this->t('Specify the number the counter should start at.'),\n      '#size' => 2,\n    ];\n\n    parent::buildOptionsForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Do nothing -- to override the parent query.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getValue(ResultRow $values, $field = NULL) {\n    // Note:  1 is subtracted from the counter start value below because the\n    // counter value is incremented by 1 at the end of this function.\n    $count = is_numeric($this->options['counter_start']) ? $this->options['counter_start'] - 1 : 0;\n    $pager = $this->view->pager;\n    // Get the base count of the pager.\n    if ($pager->usePager()) {\n      $count += ($pager->getItemsPerPage() * $pager->getCurrentPage() + $pager->getOffset());\n    }\n    // Add the counter for the current site.\n    $count += $this->view->row_index + 1;\n\n    return $count;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/field/Counter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Counter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  block.skip_procedural_hook_scan: true\n\nservices:\n  _defaults:\n    autoconfigure: true\n  theme.negotiator.block.admin_demo:\n    class: Drupal\\block\\Theme\\AdminDemoNegotiator\n    tags:\n      - { name: theme_negotiator, priority: 1000 }\n  block.page_display_variant_subscriber:\n    class: Drupal\\block\\EventSubscriber\\BlockPageDisplayVariantSubscriber\n  block.repository:\n    class: Drupal\\block\\BlockRepository\n    arguments: ['@entity_type.manager', '@theme.manager', '@context.handler']\n  Drupal\\block\\BlockRepositoryInterface: '@block.repository'\n  Drupal\\block\\BlockConfigUpdater: ~\n", "metadata": {"source": "repos/drupal_core/core/modules/block/block.services.yml", "type": "yaml_reference", "topic": "block.services"}}
{"instruction": "Show me the implementation of the class ComponentNegotiator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Theme;\n\nuse Drupal\\Core\\DependencyInjection\\DeprecatedServicePropertyTrait;\nuse Drupal\\Core\\Extension\\Extension;\n\n/**\n * Determines which component should be used.\n */\nclass ComponentNegotiator {\n\n  use DeprecatedServicePropertyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $deprecatedProperties = ['moduleExtensionList' => 'extension.list.module'];\n\n  /**\n   * Holds the component IDs from previous negotiations.\n   *\n   * @var array\n   */\n  protected array $cache = [];\n\n  /**\n   * Constructs ComponentNegotiator objects.\n   *\n   * @param \\Drupal\\Core\\Theme\\ThemeManagerInterface $themeManager\n   *   The theme manager.\n   */\n  public function __construct(\n    protected ThemeManagerInterface $themeManager,\n  ) {\n  }\n\n  /**\n   * Negotiates the active component for the current request.\n   *\n   * @param string $component_id\n   *   The requested component id. Ex: 'my-button', 'my-button--primary',\n   *   'component_example:my-button--primary', ...\n   * @param array[] $all_definitions\n   *   All the plugin definitions for components keyed by plugin ID.\n   *\n   * @return string|null\n   *   The negotiated plugin ID or null if no negotiation was successful.\n   */\n  public function negotiate(string $component_id, array $all_definitions): ?string {\n    $cache_key = $this->generateCacheKey($component_id);\n    $cached_data = $this->cache[$cache_key] ?? NULL;\n    if (isset($cached_data)) {\n      return $cached_data;\n    }\n    $negotiated = $this->doNegotiate($component_id, $all_definitions);\n    $this->cache[$cache_key] = $negotiated;\n    return $negotiated;\n  }\n\n  /**\n   * Negotiates the active component for the current request.\n   *\n   * @param string $component_id\n   *   The requested component id. Ex: 'my-button', 'my-button--primary',\n   *   'component_example:my-button--primary', ...\n   * @param array[] $all_definitions\n   *   All the plugin definitions for components keyed by plugin ID.\n   *\n   * @return string|null\n   *   The negotiated plugin ID or null if no negotiation was successful.\n   */\n  private function doNegotiate(string $component_id, array $all_definitions): ?string {\n    // Consider only the component definitions matching the component ID in the\n    // 'replaces' key.\n    $matches = array_filter(\n      $all_definitions,\n      static fn(array $definition) => $component_id === ($definition['replaces'] ?? NULL),\n    );\n    $negotiated_plugin_id = $this->maybeNegotiateByTheme($matches);\n    if ($negotiated_plugin_id) {\n      return $negotiated_plugin_id;\n    }\n    return $this->maybeNegotiateByModule($matches);\n  }\n\n  /**\n   * See if there is a candidate in the theme hierarchy.\n   *\n   * @param array[] $candidates\n   *   All the components that might be a match.\n   *\n   * @return string|null\n   *   The plugin ID for the negotiated component, or NULL if none was found.\n   */\n  private function maybeNegotiateByTheme(array $candidates): ?string {\n    // Prepare the error message.\n    $theme_name = $this->themeManager->getActiveTheme()->getName();\n    // Let's do theme based negotiation.\n    $base_theme_names = array_map(\n      static fn(Extension $extension) => $extension->getName(),\n      $this->themeManager->getActiveTheme()->getBaseThemeExtensions()\n    );\n    $considered_themes = [$theme_name, ...$base_theme_names];\n    // Only consider components in the theme hierarchy tree.\n    $candidates = array_filter(\n      $candidates,\n      static fn(array $definition) => $definition['extension_type'] === ExtensionType::Theme\n        && in_array($definition['provider'], $considered_themes, TRUE)\n    );\n    if (empty($candidates)) {\n      return NULL;\n    }\n    $theme_weights = array_flip($considered_themes);\n    $sort_by_theme_weight = static fn(array $definition_a, array $definition_b) =>\n      $theme_weights[$definition_a['provider']] <=> $theme_weights[$definition_b['provider']];\n    // Sort the candidates by weight and choose the one with the lowest weight.\n    uasort($candidates, $sort_by_theme_weight);\n    $definition = reset($candidates);\n    return $definition['id'] ?? NULL;\n  }\n\n  /**\n   * Negotiate the component from the list of candidates for a module.\n   *\n   * @param array[] $candidates\n   *   The candidate definitions.\n   *\n   * @return string|null\n   *   The negotiated plugin ID, or NULL if none found.\n   */\n  private function maybeNegotiateByModule(array $candidates): ?string {\n    foreach ($candidates as $candidate) {\n      if ($candidate['extension_type'] === ExtensionType::Module) {\n        return $candidate['id'];\n      }\n    }\n    return NULL;\n  }\n\n  /**\n   * Generates the cache key for the current theme and the provided component.\n   *\n   * @param string $component_id\n   *   The component ID.\n   *\n   * @return string\n   *   The cache key.\n   */\n  private function generateCacheKey(string $component_id): string {\n    return sprintf(\n      'component-negotiation::%s::%s',\n      $component_id,\n      $this->themeManager->getActiveTheme()->getName()\n    );\n  }\n\n  /**\n   * Clears the negotiation cache.\n   */\n  public function clearCache(): void {\n    $this->cache = [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/ComponentNegotiator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ComponentNegotiator", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 trait for readability and maintainability while preserving behavior.", "input": "Symbol: SchematicNormalizerHelperTrait\nSource file: <source_file>\nFile name hint: SchematicNormalizerHelperTrait.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\serialization\\Normalizer;\n\n/**\n * Methods for normalizing JSON schema.\n */\ntrait SchematicNormalizerHelperTrait {\n\n  use JsonSchemaReflectionTrait;\n\n  /**\n   * Retrieve JSON Schema for the normalization.\n   *\n   * @param mixed $object\n   *   Supported object or class/interface name being normalized.\n   * @param array $context\n   *   Context options. Well-defined keys include:\n   *   - dialect: Used to specify a dialect for the desired schema being\n   *     generated. The dialect meta-schema MUST extend JSON Schema draft\n   *     2020-12 or later. Normalizers MAY choose to return a schema with\n   *     keywords supported by a dialect it supports, but only when they\n   *     are supported by the dialect specified in this key. For instance,\n   *     normalizers may return a schema with a 'discriminator' as supported\n   *     by OpenAPI if that dialect is passed, but return a more permissive but\n   *     less specific schema when it is not.\n   *\n   * @return array\n   *   JSON Schema for the normalization, conforming to version draft 2020-12.\n   *\n   * @see https://json-schema.org/specification#specification-documents\n   */\n  protected function getNormalizationSchema(mixed $object, array $context = []): array {\n    return $this->getJsonSchemaForMethod($this, 'normalize', ['$comment' => 'No schema available.']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkFormat($format = NULL) {\n    if ($format === 'json_schema') {\n      return TRUE;\n    }\n    return parent::checkFormat($format);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\serialization\\Normalizer;\n\n/**\n * Methods for normalizing JSON schema.\n */\ntrait SchematicNormalizerHelperTrait {\n\n  use JsonSchemaReflectionTrait;\n\n  /**\n   * Retrieve JSON Schema for the normalization.\n   *\n   * @param mixed $object\n   *   Supported object or class/interface name being normalized.\n   * @param array $context\n   *   Context options. Well-defined keys include:\n   *   - dialect: Used to specify a dialect for the desired schema being\n   *     generated. The dialect meta-schema MUST extend JSON Schema draft\n   *     2020-12 or later. Normalizers MAY choose to return a schema with\n   *     keywords supported by a dialect it supports, but only when they\n   *     are supported by the dialect specified in this key. For instance,\n   *     normalizers may return a schema with a 'discriminator' as supported\n   *     by OpenAPI if that dialect is passed, but return a more permissive but\n   *     less specific schema when it is not.\n   *\n   * @return array\n   *   JSON Schema for the normalization, conforming to version draft 2020-12.\n   *\n   * @see https://json-schema.org/specification#specification-documents\n   */\n  protected function getNormalizationSchema(mixed $object, array $context = []): array {\n    return $this->getJsonSchemaForMethod($this, 'normalize', ['$comment' => 'No schema available.']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkFormat($format = NULL) {\n    if ($format === 'json_schema') {\n      return TRUE;\n    }\n    return parent::checkFormat($format);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/Normalizer/SchematicNormalizerHelperTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "SchematicNormalizerHelperTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Puede que esto no le sorprenda, pero su supermercado es un hervidero de marketing ca\u00f3tico dise\u00f1ado para mejorar sus ganancias y para alentar al consumidor a gastar m\u00e1s de lo que pretend\u00eda. Los trucos que emplean todos los supermercados son a veces t\u00e1cticas sensatas que cualquier minorista deber\u00eda hacer para mejorar las ventas, pero algunas de ellas pueden ser m\u00e1s sutiles y menos obvias de lo que cree.", "input": "", "output": "Puede que esto no le sorprenda, pero su supermercado es un hervidero de marketing ca\u00f3tico dise\u00f1ado para mejorar sus ganancias y para alentar al consumidor a gastar m\u00e1s de lo que pretend\u00eda. Los trucos que emplean todos los supermercados son a veces t\u00e1cticas sensatas que cualquier minorista deber\u00eda hacer para mejorar las ventas, pero algunas de ellas pueden ser m\u00e1s sutiles y menos obvias de lo que cree.\n\nDebido a los art\u00edculos y los documentales de sensibilizaci\u00f3n, los consumidores retoman este tema con frecuencia y es probable que a los minoristas les resulte m\u00e1s dif\u00edcil salirse con la suya usando solamente los trucos m\u00e1s obvios. Nos estamos convirtiendo en unos consumidores cada vez m\u00e1s inteligentes y probablemente no hay muchas cosas que nos sorprendan. Pero aqu\u00ed hay algunos trucos para la venta al por menor que debe tener en cuenta cuando se apresura a realizar la compra semanal en el supermercado.\n\n## Productos esenciales escondidos\n\nLa distribuci\u00f3n de su supermercado puede tener mucho sentido para usted cuando lleva comprando ah\u00ed un tiempo, pero para los nuevos clientes que est\u00e1n intentando encontrar los productos esenciales puede que no tenga ning\u00fan sentido. Algunos supermercados han notado como la gente que viene a su tienda a comprar leche, pan o huevos y que, ocultando esos productos esenciales en esquinas rec\u00f3nditas de la tienda, los animan a deambular por ella mientras a\u00f1aden a la cesta otros productos antes de irse.\n\nPor supuesto, esto puede ser genial para recordar productos esenciales que de otra forma olvidar\u00eda, pero no lo es si lo que quiere es ahorrar unas monedas y solo comprar las cosas a por las que vino, y eso lo los supermercados lo saben.\n\n> Nuestro consejo: Realice la lista de la compra antes de salir de casa, revisando que necesita y marc\u00e1ndolo en la lista. Le sorprender\u00e1 lo que ahorra con el tiempo.\n\n## Descuentos por n\u00famero\n\nCompre uno y ll\u00e9vese otro gratis; dos por 2\u00a3 y ofertas en comida. Todo esto descuentos parecen una buena oportunidad, pero en algunos casos son productos vendidos a p\u00e9rdidas con el \u00fanico objetivo de atraerle y que compre m\u00e1s cosas mientras est\u00e1 all\u00ed. En otros casos, las ofertas para m\u00faltiples productos o packs de tama\u00f1o espec\u00edfico pueden parecer una ganga hasta que se comparan los precios con marcas similares u otros tama\u00f1os de la misma marca. Estos descuentos pueden hacerle pensar que paga menos pero es menos por algo que no necesita e incluso puede terminar pagando m\u00e1s por el art\u00edculo. Recuerde, los supermercados saben que a menudo tiene prisa y no tiene tiempo suficiente de considerar la imagen completa del producto.\n\n> Nuestro consejo: No se apresure y t\u00f3mese el tiempo necesario para leer la letra peque\u00f1a. La letra grande le atraer\u00e1 pero en la letra peque\u00f1a encontrar\u00e1 el precio por cada 100g de producto o el precio por litro y se sorprender\u00e1 de la de veces que no existe tal oferta o incluso que es m\u00e1s caro que el paquete peque\u00f1o.\n\n## Entendiendo nuestros h\u00e1bitos de compra\n\nLos productos m\u00e1s baratos del supermercado casi siempre se colocan en la parte baja de las estanter\u00edas, donde tendr\u00e1 que agacharse para tomarlos. Tambi\u00e9n es posible que no pueda leer f\u00e1cilmente el precio en el ticket. La mayor\u00eda de la gente selecciona los productos de la parte media de las estanter\u00edas dado que es m\u00e1s f\u00e1cil y r\u00e1pido. Esos productos son los que tienen mayores beneficios y son los que el supermercado quiere que compre.\n\nLa distribuci\u00f3n de m\u00fasica, colores y tipos de productos est\u00e1 decidido en base a unos principios establecidos por expertos en personas: psic\u00f3logos y expertos en comportamiento que saben c\u00f3mo pensamos. Y as\u00ed, el comprador inteligente sin duda podr\u00e1 aprovechar las grandes ofertas en su tienda semanal, pero se necesita un poco de tiempo y esfuerzo para ser m\u00e1s conscientes de lo que se nos incita a escoger en los pasillos.\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/modules/demo_umami_content/default_content/languages/es/article_body/the-real-deal-for-supermarket-savvy-shopping.md", "type": "doc_summary", "topic": "Puede que esto no le sorprenda, pero su supermercado es un hervidero de marketing ca\u00f3tico dise\u00f1ado para mejorar sus ganancias y para alentar al consumidor a gastar m\u00e1s de lo que pretend\u00eda. Los trucos que emplean todos los supermercados son a veces t\u00e1cticas sensatas que cualquier minorista deber\u00eda hacer para mejorar las ventas, pero algunas de ellas pueden ser m\u00e1s sutiles y menos obvias de lo que cree."}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n\n  soap_client_webform.soap_conditions_responder_handler:\n    class: Drupal\\soap_client_webform\\Service\\SoapConditionsResponderHandler\n    arguments:\n      - '@plugin.manager.operation_dispatcher'\n      - '@logger.channel.soap_client_webform'\n\n  logger.channel.soap_client_webform:\n    parent: logger.channel_base\n    arguments:\n      - 'soap_client_webform'\n", "metadata": {"source": "repos/soap_client/modules/soap_client_webform/soap_client_webform.services.yml", "type": "yaml_reference", "topic": "soap client webform.services"}}
{"instruction": "Show me the implementation of the class CanvasFullHtml in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Allows using full_html text format in Drupal Canvas WYSIWYG editors.\n *\n * This module replaces Canvas's restricted text formats (canvas_html_block,\n * canvas_html_inline) with the full_html text format for unrestricted\n * HTML editing in Canvas component instances.\n */\n\ndeclare(strict_types=1);\n", "metadata": {"source": "repos/canvas_full_html/canvas_full_html.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CanvasFullHtml", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: FileDownloadHook\nSource file: <source_file>\nFile name hint: FileDownloadHook.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\file\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\file\\FileRepositoryInterface;\nuse Drupal\\file\\FileUsage\\FileUsageInterface;\n\n/**\n * Implements hook_file_download().\n */\n#[Hook('file_download')]\nclass FileDownloadHook {\n\n  public function __construct(\n    private readonly FileRepositoryInterface $fileRepository,\n    private readonly FileUsageInterface $fileUsage,\n    private readonly AccountInterface $currentUser,\n  ) {}\n\n  /**\n   * Implements hook_file_download().\n   */\n  public function __invoke($uri): array|int|null {\n    // Get the file record based on the URI. If not in the database just return.\n    $file = $this->fileRepository->loadByUri($uri);\n    if (!$file) {\n      return NULL;\n    }\n    // Find out if a temporary file is still used in the system.\n    if ($file->isTemporary()) {\n      $usage = $this->fileUsage->listUsage($file);\n      if (empty($usage) && $file->getOwnerId() != $this->currentUser->id()) {\n        // Deny access to temporary files without usage that are not owned by\n        // the same user. This prevents the security issue that a private file\n        // that was protected by field permissions becomes available after its\n        // usage was removed and before it is actually deleted from the file\n        // system. Modules that depend on this behavior should make the file\n        // permanent instead.\n        return -1;\n      }\n    }\n    // Find out which (if any) fields of this type contain the file.\n    $references = file_get_file_references($file, NULL, EntityStorageInterface::FIELD_LOAD_CURRENT, NULL);\n    // Stop processing if there are no references in order to avoid returning\n    // headers for files controlled by other modules. Make an exception for\n    // temporary files where the host entity has not yet been saved (for\n    // example, an image preview on a node/add form) in which case, allow\n    // download by the file's owner.\n    if (empty($references) && ($file->isPermanent() || $file->getOwnerId() != $this->currentUser->id())) {\n      return NULL;\n    }\n    if (!$file->access('download')) {\n      return -1;\n    }\n    // Access is granted.\n    return $file->getDownloadHeaders();\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\file\\FileRepositoryInterface;\nuse Drupal\\file\\FileUsage\\FileUsageInterface;\n\n/**\n * Implements hook_file_download().\n */\n#[Hook('file_download')]\nclass FileDownloadHook {\n\n  public function __construct(\n    private readonly FileRepositoryInterface $fileRepository,\n    private readonly FileUsageInterface $fileUsage,\n    private readonly AccountInterface $currentUser,\n  ) {}\n\n  /**\n   * Implements hook_file_download().\n   */\n  public function __invoke($uri): array|int|null {\n    // Get the file record based on the URI. If not in the database just return.\n    $file = $this->fileRepository->loadByUri($uri);\n    if (!$file) {\n      return NULL;\n    }\n    // Find out if a temporary file is still used in the system.\n    if ($file->isTemporary()) {\n      $usage = $this->fileUsage->listUsage($file);\n      if (empty($usage) && $file->getOwnerId() != $this->currentUser->id()) {\n        // Deny access to temporary files without usage that are not owned by\n        // the same user. This prevents the security issue that a private file\n        // that was protected by field permissions becomes available after its\n        // usage was removed and before it is actually deleted from the file\n        // system. Modules that depend on this behavior should make the file\n        // permanent instead.\n        return -1;\n      }\n    }\n    // Find out which (if any) fields of this type contain the file.\n    $references = file_get_file_references($file, NULL, EntityStorageInterface::FIELD_LOAD_CURRENT, NULL);\n    // Stop processing if there are no references in order to avoid returning\n    // headers for files controlled by other modules. Make an exception for\n    // temporary files where the host entity has not yet been saved (for\n    // example, an image preview on a node/add form) in which case, allow\n    // download by the file's owner.\n    if (empty($references) && ($file->isPermanent() || $file->getOwnerId() != $this->currentUser->id())) {\n      return NULL;\n    }\n    if (!$file->access('download')) {\n      return -1;\n    }\n    // Access is granted.\n    return $file->getDownloadHeaders();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Hook/FileDownloadHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileDownloadHook", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: MessageInterface.php\nTarget symbol: interface defining\nNamespace: Drupal\\contact\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for defining.\n- Include required imports:\n  - Drupal\\Core\\Entity\\ContentEntityInterface\n- Ensure these methods exist where relevant:\n  - copySender()\n  - getContactForm()\n  - getMessage()\n  - getPersonalRecipient()\n  - getSenderMail()\n  - getSenderName()\n  - getSubject()\n  - isPersonal()\n  - setCopySender()\n  - setMessage()\n  - setSenderMail()\n  - setSenderName()", "output": "<?php\n\nnamespace Drupal\\contact;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\n\n/**\n * Provides an interface defining a contact message entity.\n */\ninterface MessageInterface extends ContentEntityInterface {\n\n  /**\n   * Returns the form this contact message belongs to.\n   *\n   * @return \\Drupal\\contact\\ContactFormInterface\n   *   The contact form entity.\n   */\n  public function getContactForm();\n\n  /**\n   * Returns the name of the sender.\n   *\n   * @return string\n   *   The name of the message sender.\n   */\n  public function getSenderName();\n\n  /**\n   * Sets the name of the message sender.\n   *\n   * @param string $sender_name\n   *   The name of the message sender.\n   */\n  public function setSenderName($sender_name);\n\n  /**\n   * Returns the email address of the sender.\n   *\n   * @return string\n   *   The email address of the message sender.\n   */\n  public function getSenderMail();\n\n  /**\n   * Sets the email address of the sender.\n   *\n   * @param string $sender_mail\n   *   The email address of the message sender.\n   */\n  public function setSenderMail($sender_mail);\n\n  /**\n   * Returns the message subject.\n   *\n   * @return string\n   *   The message subject.\n   */\n  public function getSubject();\n\n  /**\n   * Sets the subject for the email.\n   *\n   * @param string $subject\n   *   The message subject.\n   */\n  public function setSubject($subject);\n\n  /**\n   * Returns the message body.\n   *\n   * @return string\n   *   The message body.\n   */\n  public function getMessage();\n\n  /**\n   * Sets the email message to send.\n   *\n   * @param string $message\n   *   The message body.\n   */\n  public function setMessage($message);\n\n  /**\n   * Returns TRUE if a copy should be sent to the sender.\n   *\n   * @return bool\n   *   TRUE if a copy should be sent, FALSE if not.\n   */\n  public function copySender();\n\n  /**\n   * Sets if the sender should receive a copy of this email or not.\n   *\n   * @param bool $inform\n   *   TRUE if a copy should be sent, FALSE if not.\n   */\n  public function setCopySender($inform);\n\n  /**\n   * Returns TRUE if this is the personal contact form.\n   *\n   * @return bool\n   *   TRUE if the message bundle is personal.\n   */\n  public function isPersonal();\n\n  /**\n   * Returns the user this message is being sent to.\n   *\n   * @return \\Drupal\\user\\UserInterface\n   *   The user entity of the recipient, NULL if this is not a personal message.\n   */\n  public function getPersonalRecipient();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contact/src/MessageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MessageInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Working with languages and translations'\ntop_level: true\nrelated:\n  - block.place\n  - block.configure\n---\n{% set config_overview_topic = render_var(help_topic_link('core.config_overview')) %}\n{% set content_structure_topic = render_var(help_topic_link('core.content_structure')) %}\n<h2>{% trans %}What text can be translated in your site?{% endtrans %}</h2>\n<p>{% trans %}There are three types of text that can be translated:{% endtrans %}</p>\n<ul>\n  <li>{% trans %}Content (blocks, content items, etc.) can be written in English or another language, and can be translated into additional languages. See {{ content_structure_topic }} to learn more about content.{% endtrans %}</li>\n  <li>{% trans %}Many configuration items also include text that can be translated. Default configuration provided by your site's software is provided in English; you can also download community-provided translations. See {{ config_overview_topic }} to learn more about configuration.{% endtrans %}</li>\n  <li>{% trans %}User interface text that is provided by the core software, your install profile, themes, and modules is provided in English, but can be translated into other languages. You can also download translations that community-members have provided.{% endtrans %}</li>\n</ul>\n<h2>{% trans %}Working with languages overview{% endtrans %}</h2>\n<p>{% trans %}The core Language module lets you add new languages to your site, provides the <em>Language switcher</em> block, and provides the ability to configure block visibility by language; the block and block visibility settings are only available if you have multiple languages configured. The core Content Translation, Configuration Translation, and Interface Translation modules let you translate content, configuration, and the built-in user interface, respectively. The core Locale module manages automatic downloads of community-provided translations of default configuration and user-interface text if the core Update Status module is installed. See the related topics listed below for specific tasks.{% endtrans %}</p>\n", "metadata": {"source": "repos/drupal_core/core/modules/help/help_topics/core.translations.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface PluginAwareInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin;\n\n/**\n * Provides an interface for objects that depend on a plugin.\n */\ninterface PluginAwareInterface {\n\n  /**\n   * Sets the plugin for this object.\n   *\n   * @param \\Drupal\\Component\\Plugin\\PluginInspectionInterface $plugin\n   *   The plugin.\n   */\n  public function setPlugin(PluginInspectionInterface $plugin);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/PluginAwareInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PluginAwareInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GetFileSystemStatus in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\FileSystemService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_tools_get_file_system_status',\n  label: new TranslatableMarkup('Get File System Status'),\n  description: new TranslatableMarkup('Get file system status including directory permissions and stream wrappers.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'directories' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Directory Status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'stream_wrappers' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Stream Wrappers'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetFileSystemStatus extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'site_health';\n\n\n  protected FileSystemService $fileSystem;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->fileSystem = $container->get('mcp_tools.file_system');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return [\n      'success' => TRUE,\n      'data' => $this->fileSystem->getFileSystemStatus(),\n    ];\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/src/Plugin/tool/Tool/GetFileSystemStatus.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetFileSystemStatus", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "site_name: Display Builder\nsite_description: >-\n  A display building tool by the UI Suite team.\n\nrepo_name: project/display_builder\nrepo_url: https://git.drupalcode.org/project/display_builder\nedit_uri: /-/edit/main/docs/\n\ntheme:\n  name: material\n  language: en\n  palette:\n    # Palette toggle for automatic mode\n    - media: '(prefers-color-scheme)'\n      primary: blue\n      toggle:\n        icon: material/brightness-auto\n        name: Switch to light mode\n    # Palette toggle for light mode\n    - media: '(prefers-color-scheme: light)'\n      primary: blue\n      scheme: default\n      toggle:\n        icon: material/brightness-7\n        name: Switch to dark mode\n    # Palette toggle for dark mode\n    - media: '(prefers-color-scheme: dark)'\n      primary: blue\n      scheme: slate\n      toggle:\n        icon: material/brightness-4\n        name: Switch to system preference\n\nextra:\n  social:\n    - icon: fontawesome/brands/drupal\n      link: https://www.drupal.org/project/display_builder\n    - icon: fontawesome/brands/gitlab\n      link: https://git.drupalcode.org/project/display_builder\n    - icon: fontawesome/solid/bolt\n      link: https://beyris.eu\n    - icon: fontawesome/solid/blog\n      link: https://developpeur-drupal.com/en\n\nnav:\n  - Introduction: 'index.md'\n  - Installation: 'install.md'\n  - Using Display Builder:\n      - For entity displays: 'entity-displays.md'\n      - For entity displays overrides: 'entity-displays-overrides.md'\n      - For page layout: 'page-layout.md'\n      - With Views: 'with-views.md'\n  - Features:\n      - Available islands: 'islands.md'\n      - Pattern presets: 'pattern-presets.md'\n      - Real-time collaboration: 'realtime-collaboration.md'\n      - Migration from layout builder: 'migration-from-layout-builder.md'\n  - Configuring Display Builder: 'configuration.md'\n  - Extending Display Builder:\n      - With island plugins: 'island-plugins.md'\n      - With source plugins: 'source-plugins.md'\n  - Contributing:\n      - Contributing: 'contributing.md'\n      - Tests e2e: 'tests.md'\n      - Security model: 'security-model.md'\n  - Frequently asked questions: 'faq.md'\n\nplugins:\n  - search\n  - privacy:\n      enabled: !ENV [CI, false]\n\nmarkdown_extensions:\n  - markdown.extensions.admonition\n  - pymdownx.extra\n", "metadata": {"source": "repos/display_builder/mkdocs.yml", "type": "yaml_reference", "topic": "mkdocs"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Lara Translate Provider", "input": "", "output": "# Lara Translate Provider\n\n**Lara Translate Provider** integrates Drupal\u2019s Translation Management Tool (TMGMT) with the Lara translation service, letting site editors send content for high-quality translations and retrieve them without leaving Drupal.\n\n## Features\n- Implements a TMGMT translation provider plugin for Lara.\n- Lets you send content or batches directly from Drupal to Lara\u2019s translation pipeline.\n- Automatically fetches completed translations and imports them into the site.\n- Supports translation status updates (in progress, completed, errors).\n- Leverages Lara\u2019s context-aware translation model: Lara processes full documents (not isolated segments), preserving consistency, style, and meaning. ([laratranslate.com](https://laratranslate.com/about-lara))\n- Offers style options (e.g. \u201cFaithful\u201d, \u201cFluid\u201d, \u201cCreative\u201d) to match the tone of your content. ([laratranslate.com](https://laratranslate.com/about-lara))\n- Suitable for sites that want to centralize translation workflows without manual export/import overhead.\n\n**Use cases include:**\n- A multilingual content site wanting professional-quality translation service integrated into Drupal.\n- Projects where maintaining tone, consistency, and clarity is critical (marketing, legal, technical content).\n- Teams wanting to automate translation submission, tracking, and ingestion.\n\n## Post-Installation\n1. Enable the **Lara Translate Provider** module and ensure **TMGMT** is active.\n2. Go to *Translation Management \u2192 Providers*.\n3. Create a Lara provider instance by entering your Lara API credentials.\n4. Optionally configure defaults (e.g. preferred style, fallback handling).\n5. Use the TMGMT interface (jobs, workflows) to submit content to Lara.\n6. As translations finish, they are pulled back automatically (or manually, depending on settings).\n\nOnce installed, you don\u2019t manage separate content types or fields \u2014 the module works via TMGMT\u2019s existing workflows.\nThe main setup is in the provider configuration.\nUsers should also verify that content types, text formats, and languages are properly enabled for translation in Drupal core before sending to Lara.\n\n## Queue Processing (Asynchronous)\nTranslations are processed asynchronously via Drupal's Queue API. When you submit a TMGMT job:\n- Each job item is queued (queue name: `tmgmt_laratranslate_worker`).\n- The queue worker runs during cron and processes items in the background.\n- Jobs are marked as submitted immediately; translations appear after the next cron runs.\n\n**Benefits**:\n- Avoids request timeouts for large jobs.\n- Smooths load by spreading work across cron runs.\n- Automatically retries transient failures (quota, network).\n\n**Queue Processing Flow**:\n```mermaid\nflowchart TD\n  A[TMGMT job submitted] --> B[LaraTranslator::requestTranslation]\n  B --> C[Queue item created<br/>job_item_id, submitted_time]\n  C --> D[Drupal cron]\n  D --> E[LaraTranslatorWorker::processItem]\n  E --> F[LaraTranslator::processJobItem]\n  F --> G{Success?}\n  G -->|Yes| H[Translated data saved]\n  G -->|No, transient| I[Retry on next cron]\n  G -->|No, permanent| J[Job item message + logs]\n```\n\n## Cron Requirements & Recommendations\n- **Cron must run** for translations to process.\n- The queue worker has a **60 second time budget per cron run**.\n- Recommended schedule: **every 5-15 minutes** (more frequently for large volumes).\n\nSee `doc/CRON_CONFIGURATION.md` for configuration guidance and optimization tips.\n\n## Monitoring & Drush\nUse Drush to check queue depth, run the worker manually, and inspect logs:\n- `drush queue:list`\n- `drush queue:run tmgmt_laratranslate_worker`\n- `drush cron`\n- `drush watchdog:show --type=tmgmt_laratranslate`\n\nSee `doc/DRUSH_COMMANDS.md` for more examples.\n\n## Troubleshooting\nIf translations are not processing or items appear stuck, see:\n- `doc/QUEUE_TROUBLESHOOTING.md`\n\n## Documentation Index\nQuick links to the module documentation in `doc/`:\n- `doc/README.md` - Documentation index\n- `doc/QUICK_START.md` - 5-minute setup guide\n- `doc/QUEUE_IMPLEMENTATION.md` - Queue architecture and implementation notes\n- `doc/CRON_CONFIGURATION.md` - Cron schedule recommendations\n- `doc/DRUSH_COMMANDS.md` - Drush commands for monitoring and manual runs\n- `doc/QUEUE_TROUBLESHOOTING.md` - Common queue issues and fixes\n- `doc/QUOTA_ERROR_HANDLING.md` - Quota error handling behavior\n- `doc/TEXT_CHUNKING.md` - Handling long content safely\n- `doc/LANGUAGE_MAPPING.md` - Language code mapping between Drupal and Lara\n\n## Additional Requirements\n- [TMGMT (Translation Management Tool)](https://www.drupal.org/project/tmgmt) module.\n- A valid **Lara API account** with access credentials.\n- Access from your server to Lara\u2019s API endpoints (network and firewall rules allowing).\n\n## Similar projects\n- [AI Translation Management (TMGMT)](https://www.drupal.org/project/ai_tmgmt), integrates AI-powered translation using the AI module with providers like OpenAI, Ollama, and more.\n\n**Similarities:** Like _AI Translation Management_, _Lara Translate Provider_ uses queue-based processing for translation jobs. Both modules process translation requests asynchronously during cron runs, allowing large jobs to be handled efficiently without blocking content operations or timing out.\n\n**What differentiates Lara Translate Provider:** it\u2019s built specifically for **Lara**, which uses a context-aware translation engine that reads entire documents to preserve consistency and meaning, offers style control (Faithful / Fluid / Creative), and \u201cexplains its translation choices\u201d for transparency. ([laratranslate.com](https://laratranslate.com/about-lara))\n\n## Supporting this Module\nDevelopment support is welcome! You can:\n- Contribute via Git / issues / patches / documentation\n- Share feedback or bug reports\n- Sponsor development through direct funding or organizational support\n\n## Community Documentation\n- Official Lara documentation / API reference: [laratranslate.com](https://laratranslate.com/about-lara)\n", "metadata": {"source": "repos/tmgmt_laratranslate/README.md", "type": "doc_summary", "topic": "Lara Translate Provider"}}
{"instruction": "Show me the implementation of the class CommentTranslationHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\comment;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\content_translation\\ContentTranslationHandler;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Defines the translation handler for comments.\n */\nclass CommentTranslationHandler extends ContentTranslationHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function entityFormAlter(array &$form, FormStateInterface $form_state, EntityInterface $entity) {\n    parent::entityFormAlter($form, $form_state, $entity);\n\n    if (isset($form['content_translation'])) {\n      // We do not need to show these values on comment forms: they inherit the\n      // basic comment property values.\n      $form['content_translation']['status']['#access'] = FALSE;\n      $form['content_translation']['name']['#access'] = FALSE;\n      $form['content_translation']['created']['#access'] = FALSE;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function entityFormTitle(EntityInterface $entity) {\n    return $this->t('Edit comment @subject', ['@subject' => $entity->label()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function entityFormEntityBuild($entity_type, EntityInterface $entity, array $form, FormStateInterface $form_state) {\n    if ($form_state->hasValue('content_translation')) {\n      $translation = &$form_state->getValue('content_translation');\n      /** @var \\Drupal\\comment\\CommentInterface $entity */\n      $translation['status'] = $entity->isPublished();\n      $translation['name'] = $entity->getAuthorName();\n    }\n    parent::entityFormEntityBuild($entity_type, $entity, $form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/CommentTranslationHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CommentTranslationHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Color schemes\"\nslots:\n  brand:\n    - type: html_tag\n      tag: a\n      attributes:\n        href: \"#\"\n      value: \"Navbar\"\n  navigation_collapsible:\n    - type: component\n      component: \"bootstrap_components:navbar_nav\"\n      props:\n        variant: default\n        attributes:\n          class:\n            - me-auto\n            - mb-2\n            - mb-lg-0\n        items:\n          - title: Home\n            url: \"#\"\n            link_attributes:\n              class:\n                - active\n          - title: Features\n            url: \"#\"\n          - title: Pricing\n            url: \"#\"\n          - title: About\n            url: \"#\"\nprops:\n  variant: expand_lg\n  toggler_position: end\nlibrary_wrapper: >\n  {% set colors = [\n    {\n      class: [\n        'bg-dark',\n        'border-bottom',\n        'border-body',\n        'mb-3',\n      ],\n      'data-bs-theme': 'dark',\n    },\n    {\n      class: [\n        'bg-primary',\n        'mb-3',\n      ],\n      'data-bs-theme': 'dark',\n    },\n    {\n      class: [\n        'mb-3',\n      ],\n      'style': 'background-color: #e3f2fd;',\n      'data-bs-theme': 'light',\n    },\n  ] %}\n  {% for color in colors %}\n    {% set color_props = {'#props': _story['#props']|merge({'attributes': create_attribute(color)})} %}\n    {% set color_story = _story %}\n    {{ color_story|merge(color_props) }}\n  {% endfor %}\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/stories/navbar.color.story.yml", "type": "yaml_reference", "topic": "navbar.color.story"}}
{"instruction": "Show me the implementation of the class UrlCacheContext in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Cache\\Context;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\n\n/**\n * Defines the UrlCacheContext service, for \"per page\" caching.\n *\n * Cache context ID: 'url'.\n */\nclass UrlCacheContext extends RequestStackCacheContextBase implements CacheContextInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getLabel() {\n    return t('URL');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getContext() {\n    return $this->requestStack->getCurrentRequest()->getUri();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheableMetadata() {\n    return new CacheableMetadata();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/Context/UrlCacheContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UrlCacheContext", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Entity Builder\ntype: module\ndescription: 'Spreadsheet-driven entity architecture management for Drupal. Design, preview, and deploy entity architectures using YAML.'\npackage: Architecture\ncore_version_requirement: ^11.0\nphp: ^8.3\nconfigure: eb.import\ndependencies:\n  - drupal:field\n  - drupal:field_ui\n  - drupal:user\n", "metadata": {"source": "repos/eb/eb.info.yml", "type": "yaml_reference", "topic": "eb.info"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: FieldConfigInterface.php\nTarget symbol: interface defining\nNamespace: Drupal\\field\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for defining.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityInterface\n  - Drupal\\Core\\Field\\FieldDefinitionInterface\n- Ensure these methods exist where relevant:\n  - isDeleted()", "output": "<?php\n\nnamespace Drupal\\field;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\n\n/**\n * Provides an interface defining a field entity.\n */\ninterface FieldConfigInterface extends ConfigEntityInterface, FieldDefinitionInterface {\n\n  /**\n   * Gets the deleted flag of the field.\n   *\n   * @return bool\n   *   Returns TRUE if the field is deleted.\n   */\n  public function isDeleted();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/field/src/FieldConfigInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FieldConfigInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: TwigPhpStorageCache.php\nTarget symbol: class is\nNamespace: Drupal\\Core\\Template\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for is.\n- Include required imports:\n  - Drupal\\Component\\Utility\\Crypt\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\PhpStorage\\PhpStorageFactory\n  - Twig\\Cache\\CacheInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - generateKey()\n  - getTimestamp()\n  - load()\n  - storage()\n  - write()", "output": "<?php\n\nnamespace Drupal\\Core\\Template;\n\nuse Drupal\\Component\\Utility\\Crypt;\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\PhpStorage\\PhpStorageFactory;\nuse Twig\\Cache\\CacheInterface;\n\n/**\n * Provides an alternate cache storage for Twig using PhpStorage.\n *\n * This class is designed to work on setups with multiple web heads using a\n * local filesystem for the twig cache. When generating the cache key, a hash\n * value depending on the enabled extensions is included. This prevents stale\n * templates from being reused when twig extensions are enabled or disabled.\n *\n * @see \\Drupal\\Core\\DependencyInjection\\Compiler\\TwigExtensionPass\n */\nclass TwigPhpStorageCache implements CacheInterface {\n\n  /**\n   * The maximum length for each part of the cache key suffix.\n   */\n  const SUFFIX_SUBSTRING_LENGTH = 25;\n\n  /**\n   * The cache object used for auto-refresh via mtime.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   */\n  protected $cache;\n\n  /**\n   * The PhpStorage object used for storing the templates.\n   *\n   * @var \\Drupal\\Component\\PhpStorage\\PhpStorageInterface\n   */\n  protected $storage;\n\n  /**\n   * The template cache filename prefix.\n   *\n   * @var string\n   */\n  protected $templateCacheFilenamePrefix;\n\n  /**\n   * Store cache backend and other information internally.\n   *\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache\n   *   The cache bin.\n   * @param string $twig_cache_prefix\n   *   A Twig cache file prefix that changes when Twig extensions change.\n   */\n  public function __construct(CacheBackendInterface $cache, $twig_cache_prefix) {\n    $this->cache = $cache;\n    $this->templateCacheFilenamePrefix = $twig_cache_prefix;\n  }\n\n  /**\n   * Gets the PHP code storage object to use for the compiled Twig files.\n   *\n   * @return \\Drupal\\Component\\PhpStorage\\PhpStorageInterface\n   *   The PhpStorage object used for storing the templates.\n   */\n  protected function storage() {\n    if (!isset($this->storage)) {\n      $this->storage = PhpStorageFactory::get('twig');\n    }\n    return $this->storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function generateKey(string $name, string $className): string {\n    if (str_starts_with($name, '{# inline_template_start #}')) {\n      // $name is an inline template, and can have characters that are not valid\n      // for a filename. $suffix is unique for each inline template so we just\n      // use the generic name 'inline-template' here.\n      $name = 'inline-template';\n    }\n    else {\n      $name = basename($name);\n      // Windows does not allow colons, which are used by Single Directory\n      // Components, in directory or file names.\n      $name = str_replace(':', '_', $name);\n    }\n\n    // Windows (and some encrypted Linux systems) only support 255 characters in\n    // a path. On Windows a requirements error is displayed and installation is\n    // blocked if Drupal's public files path is longer than 120 characters.\n    // Thus, to always be less than 255, file paths may not be more than 135\n    // characters long. Using the default PHP file storage class, the Twig cache\n    // file path will be 124 characters long at most, which provides a margin of\n    // safety.\n    $suffix = substr($name, 0, self::SUFFIX_SUBSTRING_LENGTH) . '_';\n    $suffix .= substr(Crypt::hashBase64($className), 0, self::SUFFIX_SUBSTRING_LENGTH);\n\n    // The cache prefix is what gets invalidated.\n    return $this->templateCacheFilenamePrefix . '_' . $suffix;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function load(string $key): void {\n    $this->storage()->load($key);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function write(string $key, string $content): void {\n    $this->storage()->save($key, $content);\n    // Save the last mtime.\n    $cid = 'twig:' . $key;\n    $this->cache->set($cid, \\Drupal::time()->getRequestTime());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTimestamp(string $key): int {\n    $cid = 'twig:' . $key;\n    if ($cache = $this->cache->get($cid)) {\n      return $cache->data;\n    }\n    else {\n      return 0;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Template/TwigPhpStorageCache.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TwigPhpStorageCache", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Button\nnoUi: true\ngroup: Button\ndescription: Actions that are available to the user.\nlinks:\n  - https://shoelace.style/components/button\nvariants:\n  default:\n    title: Default\n  primary:\n    title: Primary\n  success:\n    title: Success\n  neutral:\n    title: Neutral\n  warning:\n    title: Warning\n  danger:\n    title: Danger\nprops:\n  type: object\n  properties:\n    id:\n      title: Id\n      type: string\n    label:\n      title: Label\n      type: string\n    tooltip:\n      title: Tooltip content, can contain HTML\n      type: string\n    icon:\n      title: Icon name\n      type: string\nlibraryOverrides:\n  dependencies:\n    - display_builder/shoelace\n", "metadata": {"source": "repos/display_builder/components/shoelace/button/button.component.yml", "type": "yaml_reference", "topic": "button.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use cache:\n  title: 'Use MCP cache tools'\n  description: 'Clear and rebuild caches via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_cache/mcp_tools_cache.permissions.yml", "type": "yaml_reference", "topic": "mcp tools cache.permissions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Menu content: headers\"\nslots:\n  title: \"Dropdown with header\"\nprops:\n  variant: dropdown\n  content:\n    - title: \"Dropdown header\"\n      link_attributes:\n        class:\n          - dropdown-header\n    - title: \"Action\"\n      url: \"#\"\n    - title: \"Another action\"\n      url: \"#\"\n  button_variant: secondary\n  heading_level: 6\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/stories/dropdown.menu_content_header.story.yml", "type": "yaml_reference", "topic": "dropdown.menu content header.story"}}
{"instruction": "Show me the implementation of the interface ActionInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Action;\n\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Core\\Executable\\ExecutableInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Provides an interface for an Action plugin.\n *\n * @todo WARNING: The action API is going to receive some additions before\n * release. The following additions are likely to happen:\n *  - The way configuration is handled and configuration forms are built is\n *    likely to change in order for the plugin to be of use for Rules.\n *  - Actions are going to become context-aware in\n *    https://www.drupal.org/node/2011038, what will deprecated the 'type'\n *    annotation.\n *  - Instead of action implementations saving entities, support for marking\n *    required context as to be saved by the execution manager will be added as\n *    part of https://www.drupal.org/node/2347017.\n *  - Actions will receive a data processing API that allows for token\n *    replacements to happen outside of the action plugin implementations,\n *    see https://www.drupal.org/node/2347023.\n *\n * @see \\Drupal\\Core\\Annotation\\Action\n * @see \\Drupal\\Core\\Action\\ActionManager\n * @see \\Drupal\\Core\\Action\\ActionBase\n * @see plugin_api\n */\ninterface ActionInterface extends ExecutableInterface, PluginInspectionInterface {\n\n  /**\n   * Executes the plugin for an array of objects.\n   *\n   * @param array $objects\n   *   An array of entities.\n   */\n  public function executeMultiple(array $objects);\n\n  /**\n   * Checks object access.\n   *\n   * @param mixed $object\n   *   The object to execute the action on.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user for which to check access, or NULL to check access\n   *   for the current user. Defaults to NULL.\n   * @param bool $return_as_object\n   *   (optional) Defaults to FALSE.\n   *\n   * @return ($return_as_object is true ? \\Drupal\\Core\\Access\\AccessResultInterface : bool)\n   *   The access result. Returns a boolean if $return_as_object is FALSE (this\n   *   is the default) and otherwise an AccessResultInterface object.\n   *   When a boolean is returned, the result of AccessInterface::isAllowed() is\n   *   returned, i.e. TRUE means access is explicitly allowed, FALSE means\n   *   access is either explicitly forbidden or \"no opinion\".\n   */\n  public function access($object, ?AccountInterface $account = NULL, $return_as_object = FALSE);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Action/ActionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ActionInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class AiProviderOpenrouter in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the OpenRouter Provider module.\n */\n\n/**\n * Implements hook_install().\n */\nfunction ai_provider_openrouter_install() {\n  // Grant permissions to administrator role if it exists.\n  $role = \\Drupal::entityTypeManager()->getStorage('user_role')->load('administrator');\n  if ($role) {\n    $role->grantPermission('administer ai providers');\n    $role->grantPermission('use ai provider openrouter');\n    $role->save();\n  }\n}\n", "metadata": {"source": "repos/ai_provider_openrouter/ai_provider_openrouter.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AiProviderOpenrouter", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Globals - 10.3.x - drupal", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Globals - 10.3.x - drupal\n\n* [11.x](/api/drupal/globals/11.x)\n* [10.3.x](/api/drupal/globals/10)\n* [9.5.x](/api/drupal/globals/9)\n* [8.9.x](/api/drupal/globals/8.9.x)\n* [7.x](/api/drupal/globals/7.x)\n\nName contains\n\nDescription contains\n\n| Title | Deprecated | File name | Summary | Direct uses | Strings |\n| --- | --- | --- | --- | --- | --- |\n| [$base\\_insecure\\_url](/api/drupal/core%21globals.api.php/global/base_insecure_url/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | The insecure base URL of the Drupal installation. |  |  |\n| [$base\\_path](/api/drupal/core%21globals.api.php/global/base_path/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | The base path of the Drupal installation. | 51 | 2 |\n| [$base\\_root](/api/drupal/core%21globals.api.php/global/base_root/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | The root URL of the host, excluding the path. |  |  |\n| [$base\\_secure\\_url](/api/drupal/core%21globals.api.php/global/base_secure_url/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | The secure base URL of the Drupal installation. |  |  |\n| [$base\\_url](/api/drupal/core%21globals.api.php/global/base_url/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | The base URL of the Drupal installation. |  | 4 |\n| [$conf](/api/drupal/core%21globals.api.php/global/conf/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | Allows defining of site-specific service providers for the Drupal kernel. |  |  |\n| [$config](/api/drupal/core%21globals.api.php/global/config/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | Array of configuration overrides from the settings.php file. |  | 139 |\n| [$install\\_state](/api/drupal/core%21globals.api.php/global/install_state/10) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/10) | Store settings and profile information during installation process. |  |  |\n\n**[Other projects](https://api.drupal.org/api/projects)**\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=10-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/globals/10%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/globals/10.md", "type": "doc_summary", "topic": "Globals - 10.3.x - drupal"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for an individual form element.\n *\n * Available variables for all fields:\n * - multiple: Whether there are multiple instances of the field.\n *\n * Available variables for single cardinality fields:\n * - elements: Form elements to be rendered.\n *\n * Available variables when there are multiple fields.\n * - table: Table of field items.\n * - description: The description element containing the following properties:\n *   - content: The description content of the form element.\n *   - attributes: HTML attributes to apply to the description container.\n * - button: \"Add another item\" button.\n *\n * @see \\Drupal\\Core\\Field\\FieldPreprocess::preprocessFieldMultipleValueForm()\n *\n * @ingroup themeable\n */\n#}\n{% if multiple %}\n  {%\n    set classes = [\n      'js-form-item',\n      'form-item'\n    ]\n  %}\n  {%\n    set description_classes = [\n      'form-item__description',\n      disabled ? 'is-disabled',\n    ]\n  %}\n  <div{{ attributes.addClass(classes) }}>\n    {{ table }}\n    {% if description.content %}\n      <div{{ description.attributes.addClass(description_classes) }}>{{ description.content }}</div>\n    {% endif %}\n    {% if button %}\n      <div class=\"form-actions\">{{ button }}</div>\n    {% endif %}\n  </div>\n{% else %}\n  {% for element in elements %}\n    {{ element }}\n  {% endfor %}\n{% endif %}\n", "metadata": {"source": "repos/drupal_core/core/themes/olivero/templates/form/field-multiple-value-form.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface ServiceProviderInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\DependencyInjection;\n\n/**\n * Interface that all service providers must implement.\n *\n * @ingroup container\n */\ninterface ServiceProviderInterface {\n\n  /**\n   * Registers services to the container.\n   *\n   * @param ContainerBuilder $container\n   *   The ContainerBuilder to register services to.\n   */\n  public function register(ContainerBuilder $container);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/DependencyInjection/ServiceProviderInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ServiceProviderInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nprops:\n  name: Lorem ipsum\n  image: https://images.unsplash.com/photo-1529778873920-4da4926a72c2?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80\n", "metadata": {"source": "repos/display_builder/components/shoelace/avatar/avatar.default.story.yml", "type": "yaml_reference", "topic": "avatar.default.story"}}
{"instruction": "Show me the implementation of the class DefaultExceptionSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\EventSubscriber;\n\nuse Drupal\\jsonapi\\CacheableResourceResponse;\nuse Drupal\\jsonapi\\JsonApiResource\\ErrorCollection;\nuse Drupal\\jsonapi\\JsonApiResource\\JsonApiDocumentTopLevel;\nuse Drupal\\jsonapi\\JsonApiResource\\LinkCollection;\nuse Drupal\\jsonapi\\JsonApiResource\\NullIncludedData;\nuse Drupal\\jsonapi\\ResourceResponse;\nuse Drupal\\jsonapi\\Routing\\Routes;\nuse Drupal\\serialization\\EventSubscriber\\DefaultExceptionSubscriber as SerializationDefaultExceptionSubscriber;\nuse Symfony\\Component\\HttpKernel\\Event\\ExceptionEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\HttpException;\n\n/**\n * Serializes exceptions in compliance with the  JSON:API specification.\n *\n * @internal JSON:API maintains no PHP API. The API is the HTTP API. This class\n *   may change at any time and could break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nclass DefaultExceptionSubscriber extends SerializationDefaultExceptionSubscriber {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static function getPriority() {\n    return parent::getPriority() + 25;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getHandledFormats() {\n    return ['api_json'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onException(ExceptionEvent $event) {\n    if (!$this->isJsonApiExceptionEvent($event)) {\n      return;\n    }\n    if (($exception = $event->getThrowable()) && !$exception instanceof HttpException) {\n      $exception = new HttpException(500, $exception->getMessage(), $exception);\n      $event->setThrowable($exception);\n    }\n\n    $this->setEventResponse($event, $exception->getStatusCode());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function setEventResponse(ExceptionEvent $event, $status) {\n    /** @var \\Symfony\\Component\\HttpKernel\\Exception\\HttpException $exception */\n    $exception = $event->getThrowable();\n    $document = new JsonApiDocumentTopLevel(new ErrorCollection([$exception]), new NullIncludedData(), new LinkCollection([]));\n    if ($event->getRequest()->isMethodCacheable()) {\n      $response = new CacheableResourceResponse($document, $exception->getStatusCode(), $exception->getHeaders());\n      $response->addCacheableDependency($exception);\n    }\n    else {\n      $response = new ResourceResponse($document, $exception->getStatusCode(), $exception->getHeaders());\n    }\n    $event->setResponse($response);\n  }\n\n  /**\n   * Check if the error should be formatted using JSON:API.\n   *\n   * The JSON:API format is supported if the format is explicitly set or the\n   * request is for a known JSON:API route.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\ExceptionEvent $exception_event\n   *   The exception event.\n   *\n   * @return bool\n   *   TRUE if it needs to be formatted using JSON:API. FALSE otherwise.\n   */\n  protected function isJsonApiExceptionEvent(ExceptionEvent $exception_event) {\n    $request = $exception_event->getRequest();\n    $parameters = $request->attributes->all();\n    return $request->getRequestFormat() === 'api_json' || (bool) Routes::getResourceTypeNameFromParameters($parameters);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/EventSubscriber/DefaultExceptionSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DefaultExceptionSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for configuration.\nfield.formatter.settings.supported_image_swiper:\n  type: field.formatter.settings.swiper_formatter_image\n  label: Supported image swiper field display format settings\n  mapping:\n    display_caption:\n      type: boolean\n      label: Display Caption field\n    display_attribution:\n      type: boolean\n      label: Display Attribution field\n", "metadata": {"source": "repos/supported_image_swiper_formatter/config/schema/supported_image_swiper_formatter.schema.yml", "type": "yaml_reference", "topic": "supported image swiper formatter.schema"}}
{"instruction": "Show me the implementation of the class BlocksDataCollector in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\webprofiler\\Entity\\EntityDecorator;\nuse Drupal\\webprofiler\\Entity\\EntityTypeManagerWrapper;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\n\n/**\n * Collects blocks data.\n */\nclass BlocksDataCollector extends DataCollector implements HasPanelInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * BlocksDataCollector constructor.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityManager\n   *   The Entity type manager service.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityManager,\n  ) {\n    $this->data['blocks']['loaded'] = [];\n    $this->data['blocks']['rendered'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'blocks';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n    $storage = $this->entityManager->getStorage('block');\n\n    \\assert($this->entityManager instanceof EntityTypeManagerWrapper);\n    $loaded = $this->entityManager->getLoaded('config', 'block');\n    $rendered = $this->entityManager->getRendered('block');\n\n    if ($loaded != NULL) {\n      $this->data['blocks']['loaded'] = $this->getBlocksData($loaded, $storage);\n    }\n\n    if ($rendered != NULL) {\n      $this->data['blocks']['rendered'] = $this->getBlocksData($rendered, $storage);\n    }\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return a list of rendered blocks.\n   *\n   * @return array\n   *   A list of rendered blocks.\n   */\n  public function getRenderedBlocks(): array {\n    return $this->data['blocks']['rendered'];\n  }\n\n  /**\n   * Return the number of rendered blocks.\n   *\n   * @return int\n   *   The number of rendered blocks.\n   */\n  public function getRenderedBlocksCount(): int {\n    return \\count($this->getRenderedBlocks());\n  }\n\n  /**\n   * Return a list of loaded blocks.\n   *\n   * @return array\n   *   A list of loaded blocks.\n   */\n  public function getLoadedBlocks(): array {\n    return $this->data['blocks']['loaded'];\n  }\n\n  /**\n   * Return the number of loaded blocks.\n   *\n   * @return int\n   *   The number of rendered blocks.\n   */\n  public function getLoadedBlocksCount(): int {\n    return \\count($this->getLoadedBlocks());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    $tabs = [\n      [\n        'label' => 'Loaded',\n        'content' => $this->renderBlocks($this->getLoadedBlocks(), 'Loaded'),\n      ],\n      [\n        'label' => 'Rendered',\n        'content' => $this->renderBlocks($this->getRenderedBlocks(), 'Rendered'),\n      ],\n    ];\n\n    return [\n      '#theme' => 'webprofiler_dashboard_tabs',\n      '#tabs' => $tabs,\n    ];\n  }\n\n  /**\n   * Return the data to store about blocks.\n   *\n   * @param \\Drupal\\webprofiler\\Entity\\EntityDecorator $decorator\n   *   An entity decorator.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $storage\n   *   The block storage service.\n   *\n   * @return array\n   *   The data to store about blocks.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  private function getBlocksData(EntityDecorator $decorator, EntityStorageInterface $storage): array {\n    $blocks = [];\n\n    /** @var \\Drupal\\block\\BlockInterface $block */\n    foreach ($decorator->getEntities() as $block) {\n      if ($block != NULL) {\n        /** @var \\Drupal\\block\\Entity\\Block|null $entity */\n        $entity = $storage->load($block->get('id'));\n\n        if ($entity != NULL) {\n          $route = '';\n          if ($entity->hasLinkTemplate('edit-form')) {\n            $route = $entity->toUrl('edit-form')->toString();\n          }\n\n          $id = $block->get('id');\n          $blocks[$id] = [\n            'id' => $id,\n            'region' => $block->getRegion(),\n            'status' => $block->get('status'),\n            'theme' => $block->getTheme(),\n            'plugin' => $block->get('plugin'),\n            'settings' => $block->get('settings'),\n            'route' => $route,\n          ];\n        }\n      }\n    }\n\n    return $blocks;\n  }\n\n  /**\n   * Render a list of blocks.\n   *\n   * @param array $blocks\n   *   The list of blocks to render.\n   * @param string $label\n   *   The list's label.\n   *\n   * @return array\n   *   The render array of the list of blocks.\n   */\n  private function renderBlocks(array $blocks, string $label): array {\n    if (\\count($blocks) == 0) {\n      return [\n        $label => [\n          '#markup' => '<p>' . $this->t('No @label blocks collected',\n              ['@label' => $label]) . '</p>',\n        ],\n      ];\n    }\n\n    $rows = [];\n    foreach ($blocks as $block) {\n      $rows[] = [\n        $block['id'],\n        $block['settings']['label'],\n        $block['region'] ?? 'No region',\n        $block['settings']['provider'],\n        $block['theme'],\n        $block['status'] ? $this->t('Enabled') : $this->t('Disabled'),\n        $block['plugin'],\n      ];\n    }\n\n    return [\n      $label => [\n        '#theme' => 'webprofiler_dashboard_section',\n        '#data' => [\n          '#type' => 'table',\n          '#header' => [\n            $this->t('ID'),\n            $this->t('Label'),\n            $this->t('Region'),\n            $this->t('Source'),\n            $this->t('Theme'),\n            $this->t('Status'),\n            $this->t('Plugin'),\n          ],\n          '#rows' => $rows,\n          '#attributes' => [\n            'class' => [\n              'webprofiler__table',\n            ],\n          ],\n          '#sticky' => TRUE,\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/BlocksDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlocksDataCollector", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "bootstrap_five_layouts_css_loader.settings:\n  title: 'Bootstrap5 CSS Loader'\n  description: 'Configure Bootstrap5 CSS loading settings'\n  parent: system.admin_config_ui\n  route_name: bootstrap_five_layouts_css_loader.settings\n", "metadata": {"source": "repos/bootstrap_five_layouts/modules/bootstrap_five_layouts_css_loader/bootstrap_five_layouts_css_loader.links.menu.yml", "type": "yaml_reference", "topic": "bootstrap five layouts css loader.links.menu"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ImageEffectAddForm.php\nTarget symbol: class ImageEffectAddForm\nNamespace: Drupal\\image\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ImageEffectAddForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\image\\ImageEffectManager\n  - Drupal\\image\\ImageStyleInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildForm()\n  - create()\n  - prepareImageEffect()", "output": "<?php\n\nnamespace Drupal\\image\\Form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\image\\ImageEffectManager;\nuse Drupal\\image\\ImageStyleInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides an add form for image effects.\n *\n * @internal\n */\nclass ImageEffectAddForm extends ImageEffectFormBase {\n\n  /**\n   * The image effect manager.\n   *\n   * @var \\Drupal\\image\\ImageEffectManager\n   */\n  protected $effectManager;\n\n  /**\n   * Constructs a new ImageEffectAddForm.\n   *\n   * @param \\Drupal\\image\\ImageEffectManager $effect_manager\n   *   The image effect manager.\n   */\n  public function __construct(ImageEffectManager $effect_manager) {\n    $this->effectManager = $effect_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('plugin.manager.image.effect')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?ImageStyleInterface $image_style = NULL, $image_effect = NULL) {\n    $form = parent::buildForm($form, $form_state, $image_style, $image_effect);\n\n    $form['#title'] = $this->t('Add %label effect to style %style', [\n      '%label' => $this->imageEffect->label(),\n      '%style' => $image_style->label(),\n    ]);\n    $form['actions']['submit']['#value'] = $this->t('Add effect');\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function prepareImageEffect($image_effect) {\n    $image_effect = $this->effectManager->createInstance($image_effect);\n    // Set the initial weight so this effect comes last.\n    $image_effect->setWeight(count($this->imageStyle->getEffects()));\n    return $image_effect;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/src/Form/ImageEffectAddForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageEffectAddForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nslots:\n  content:\n    - type: component\n      component: \"bootstrap_components:accordion_item\"\n      slots:\n        title: \"Accordion Item #1\"\n        content:\n          type: html_tag\n          tag: p\n          value: \"Mollis pretium lorem primis senectus habitasse lectus scelerisque donec, ultricies tortor suspendisse adipiscing fusce morbi volutpat pellentesque, consectetur mi risus molestie curae malesuada cum. Dignissim lacus convallis massa mauris enim ad mattis magnis senectus montes, mollis taciti phasellus accumsan bibendum semper blandit suspendisse faucibus nibh est, metus lobortis morbi cras magna vivamus per risus fermentum.\"\n      props:\n        opened: true\n    - type: component\n      component: \"bootstrap_components:accordion_item\"\n      slots:\n        title: \"Accordion Item #2\"\n        content:\n          type: html_tag\n          tag: p\n          value: \"Mollis pretium lorem primis senectus habitasse lectus scelerisque donec, ultricies tortor suspendisse adipiscing fusce morbi volutpat pellentesque, consectetur mi risus molestie curae malesuada cum. Dignissim lacus convallis massa mauris enim ad mattis magnis senectus montes, mollis taciti phasellus accumsan bibendum semper blandit suspendisse faucibus nibh est, metus lobortis morbi cras magna vivamus per risus fermentum.\"\n      props:\n        opened: false\n    - type: component\n      component: \"bootstrap_components:accordion_item\"\n      slots:\n        title: \"Accordion Item #3\"\n        content:\n          type: html_tag\n          tag: p\n          value: \"Mollis pretium lorem primis senectus habitasse lectus scelerisque donec, ultricies tortor suspendisse adipiscing fusce morbi volutpat pellentesque, consectetur mi risus molestie curae malesuada cum. Dignissim lacus convallis massa mauris enim ad mattis magnis senectus montes, mollis taciti phasellus accumsan bibendum semper blandit suspendisse faucibus nibh est, metus lobortis morbi cras magna vivamus per risus fermentum.\"\n      props:\n        opened: false\n    - type: component\n      component: \"bootstrap_components:accordion_item\"\n      slots:\n        title: \"Accordion Item #4\"\n        content:\n          type: html_tag\n          tag: p\n          value: \"Mollis pretium lorem primis senectus habitasse lectus scelerisque donec, ultricies tortor suspendisse adipiscing fusce morbi volutpat pellentesque, consectetur mi risus molestie curae malesuada cum. Dignissim lacus convallis massa mauris enim ad mattis magnis senectus montes, mollis taciti phasellus accumsan bibendum semper blandit suspendisse faucibus nibh est, metus lobortis morbi cras magna vivamus per risus fermentum.\"\n      props:\n        opened: false\nprops:\n  keep_open: false\n", "metadata": {"source": "repos/bootstrap_components/components/accordion/stories/accordion.default.story.yml", "type": "yaml_reference", "topic": "accordion.default.story"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the configuration files of the File module.\n\nfile.settings:\n  type: config_object\n  label: 'File settings'\n  mapping:\n    description:\n      type: mapping\n      label: 'Description'\n      mapping:\n        type:\n          type: string\n          label: 'Type'\n        length:\n          type: integer\n          label: 'Length'\n    icon:\n      type: mapping\n      label: 'Icon'\n      mapping:\n        directory:\n          type: path\n          label: 'Directory'\n    make_unused_managed_files_temporary:\n      type: boolean\n      label: 'Controls if unused files should be marked temporary'\n    filename_sanitization:\n      type: mapping\n      label: 'Uploaded filename sanitization options'\n      mapping:\n        transliterate:\n          type: boolean\n          label: 'Transliterate'\n        replace_whitespace:\n          type: boolean\n          label: 'Replace whitespace'\n        replace_non_alphanumeric:\n          type: boolean\n          label: 'Replace non-alphanumeric characters except dot, underscore and dash'\n        deduplicate_separators:\n          type: boolean\n          label: 'Replace sequences of dots, underscores and/or dashes with the replacement character'\n        lowercase:\n          type: boolean\n          label: 'Convert to lowercase'\n        replacement_character:\n          type: string\n          label: 'Character to use in replacements'\n\nfield.storage_settings.file:\n  type: base_entity_reference_field_settings\n  label: 'File settings'\n  mapping:\n    display_field:\n      type: boolean\n      label: 'Enable Display field'\n    display_default:\n      type: boolean\n      label: 'Files displayed by default'\n    uri_scheme:\n      type: string\n      label: 'Upload destination'\n\nfield.value.file:\n  type: mapping\n  label: 'Default value'\n\nbase_file_field_field_settings:\n  type: mapping\n  mapping:\n    handler:\n      type: string\n      label: 'Reference method'\n    handler_settings:\n      type: entity_reference_selection.[%parent.handler]\n      label: 'File selection handler settings'\n    file_directory:\n      type: string\n      label: 'File directory'\n    file_extensions:\n      type: string\n      label: 'Allowed file extensions'\n    max_filesize:\n      type: string\n      label: 'Maximum upload size'\n\nfield.field_settings.file:\n  type: base_file_field_field_settings\n  label: 'File settings'\n  mapping:\n    description_field:\n      type: boolean\n      label: 'Enable Description field'\n\nfile.formatter.media:\n  type: mapping\n  label: 'Media display format settings'\n  constraints:\n    FullyValidatable: ~\n  mapping:\n    controls:\n      type: boolean\n      label: 'Show playback controls'\n    autoplay:\n      type: boolean\n      label: 'Autoplay'\n    loop:\n      type: boolean\n      label: 'Loop'\n    # @see \\Drupal\\file\\Plugin\\Field\\FieldFormatter\\FileMediaFormatterBase::settingsForm\n    multiple_file_display_type:\n      type: string\n      label: 'Display of multiple files'\n      constraints:\n        # @see \\Drupal\\file\\Plugin\\Field\\FieldFormatter\\FileMediaFormatterBase::settingsSummary()\n        Choice:\n          choices:\n            # Multiple file display: Multiple HTML tags\n            - tags\n            # Multiple file display: One HTML tag with multiple sources\n            - sources\n\nfield.formatter.settings.file_audio:\n  type: file.formatter.media\n  label: 'Audio file display format settings'\n\nfield.formatter.settings.file_video:\n  type: file.formatter.media\n  label: 'Video file display format settings'\n  constraints:\n    FullyValidatable: ~\n  mapping:\n    muted:\n      type: boolean\n      label: 'Muted'\n    playsinline:\n      type: boolean\n      label: 'Plays inline'\n      requiredKey: false\n    width:\n      type: integer\n      label: 'Width'\n      nullable: true\n      constraints:\n        Range:\n          min: 1\n    height:\n      type: integer\n      label: 'Height'\n      nullable: true\n      constraints:\n        Range:\n          min: 1\n\nfield.formatter.settings.file_default:\n  type: mapping\n  label: 'Generic file format settings'\n  mapping:\n    use_description_as_link_text:\n      type: boolean\n      label: 'Replace the file name by its description when available'\n\nfield.formatter.settings.file_rss_enclosure:\n  type: mapping\n  label: 'RSS enclosure format settings'\n\nfield.formatter.settings.file_table:\n  type: field.formatter.settings.file_default\n  label: 'Table of files format settings'\n\nfield.formatter.settings.file_url_plain:\n  type: mapping\n  label: 'URL to file format settings'\n\nfield.widget.settings.file_generic:\n  type: mapping\n  label: 'File format settings'\n  mapping:\n    progress_indicator:\n      type: string\n      label: 'Progress indicator'\n\nfield_formatter_settings_base_file:\n  type: mapping\n  mapping:\n    link_to_file:\n      type: boolean\n      label: 'Link to file'\n\nfield.formatter.settings.file_link:\n  type: field_formatter_settings_base_file\n\nfield.formatter.settings.file_uri:\n  type: field_formatter_settings_base_file\n  mapping:\n    file_download_path:\n      type: boolean\n      label: 'Display download path'\n\nfield.formatter.settings.file_filemime:\n  type: field_formatter_settings_base_file\n  mapping:\n    filemime_image:\n      type: boolean\n      label: 'Display the filemime as icon'\n\nfield.formatter.settings.file_extension:\n  type: field_formatter_settings_base_file\n  mapping:\n    extension_detect_tar:\n      type: boolean\n      label: 'Detect tar'\n", "metadata": {"source": "repos/drupal_core/core/modules/file/config/schema/file.schema.yml", "type": "yaml_reference", "topic": "file.schema"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ExecutionContext.php\nTarget symbol: class ExecutionContext\nNamespace: Drupal\\flowdrop_runtime\\Service\\Runtime\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ExecutionContext.\n- Include required imports:\n  - Psr\\Log\\LoggerInterface\n  - Drupal\\flowdrop\\DTO\\OutputInterface\n  - Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext\n  - Drupal\\Core\\Logger\\LoggerChannelFactoryInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - createContext()\n  - getExecutionSummary()\n  - getNodeInputData()\n  - updateContext()\n  - validateContext()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Runtime;\n\nuse Psr\\Log\\LoggerInterface;\nuse Drupal\\flowdrop\\DTO\\OutputInterface;\nuse Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext;\nuse Drupal\\Core\\Logger\\LoggerChannelFactoryInterface;\n\n/**\n * Manages execution context for workflow runs.\n */\nclass ExecutionContext {\n\n  /**\n   * Logger channel for this service.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  private readonly LoggerInterface $logger;\n\n  public function __construct(LoggerChannelFactoryInterface $loggerFactory) {\n    $this->logger = $loggerFactory->get('flowdrop_runtime');\n  }\n\n  /**\n   * Create a new execution context.\n   */\n  public function createContext(\n    string $workflowId,\n    string $pipelineId,\n    array $initialData = [],\n  ): NodeExecutionContext {\n    return new NodeExecutionContext(\n      workflowId: $workflowId,\n      pipelineId: $pipelineId,\n      initialData: $initialData,\n    );\n  }\n\n  /**\n   * Update context with node output.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext $context\n   *   The execution context.\n   * @param string $nodeId\n   *   The node ID.\n   * @param \\Drupal\\flowdrop\\DTO\\OutputInterface $output\n   *   The node output.\n   *\n   * @return \\Drupal\\flowdrop_runtime\\DTO\\Runtime\\NodeExecutionContext\n   *   The updated context.\n   */\n  public function updateContext(\n    NodeExecutionContext $context,\n    string $nodeId,\n    OutputInterface $output,\n  ): NodeExecutionContext {\n    $context->addNodeOutput($nodeId, $output);\n\n    // Track execution order using an incrementing counter.\n    // This counter is used for conflict resolution when multiple sources\n    // target the same input port (latest execution = higher counter).\n    $metadata = $context->getMetadata();\n    $executionCounter = ($metadata[\"execution_counter\"] ?? 0) + 1;\n    $metadata[\"execution_counter\"] = $executionCounter;\n    $metadata[\"node_execution_order\"][$nodeId] = $executionCounter;\n    $context->setMetadata($metadata);\n\n    $this->logger->debug('Updated execution context for node @node_id (execution order: @order)', [\n      '@node_id' => $nodeId,\n      '@order' => $executionCounter,\n    ]);\n\n    return $context;\n  }\n\n  /**\n   * Get input data for a node based on its dependencies.\n   */\n  public function getNodeInputData(\n    NodeExecutionContext $context,\n    array $nodeDependencies,\n  ): array {\n    $inputData = $context->getInitialData();\n\n    // Add outputs from dependent nodes.\n    foreach ($nodeDependencies as $dependencyNodeId) {\n      $dependencyOutput = $context->getNodeOutput($dependencyNodeId);\n      if ($dependencyOutput) {\n        $inputData = array_merge($inputData, $dependencyOutput->toArray());\n      }\n    }\n\n    return $inputData;\n  }\n\n  /**\n   * Validate execution context.\n   */\n  public function validateContext(NodeExecutionContext $context): bool {\n    if (empty($context->getWorkflowId())) {\n      $this->logger->error('Execution context missing workflow ID');\n      return FALSE;\n    }\n\n    if (empty($context->getPipelineId())) {\n      $this->logger->error('Execution context missing pipeline ID');\n      return FALSE;\n    }\n\n    return TRUE;\n  }\n\n  /**\n   * Get execution summary.\n   */\n  public function getExecutionSummary(NodeExecutionContext $context): array {\n    return [\n      'workflow_id' => $context->getWorkflowId(),\n      'pipeline_id' => $context->getPipelineId(),\n      'node_count' => count($context->getNodeOutputs()),\n      'metadata' => $context->getMetadata(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Runtime/ExecutionContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExecutionContext", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set attributes = attributes.addClass('db-placeholder') %}\n{% set attributes = attributes.setAttribute('tabindex', 0) %}\n{% if preview_url %}\n  {% set attributes = attributes.setAttribute('data-preview-url', preview_url) %}\n{% endif %}\n\n{% if variant == 'button' %}\n  {{ include('display_builder:button', {\n    attributes: attributes,\n    label: content,\n  }, with_context: false) }}\n{% else %}\n  {{ include('display_builder:card', {\n    attributes: attributes,\n    content: content,\n    image: image,\n  }, with_context: false) }}\n{% endif %}\n", "metadata": {"source": "repos/display_builder/components/placeholder/placeholder.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface AccessResultInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Access;\n\n/**\n * Interface for access result value objects.\n *\n * IMPORTANT NOTE: You have to call isAllowed() when you want to know whether\n * someone has access. Just using\n * @code\n * if ($access_result) {\n *   // The user has access!\n * }\n * else {\n *   // The user doesn't have access!\n * }\n * @endcode\n * would never enter the else-statement and hence introduce a critical security\n * issue.\n */\ninterface AccessResultInterface {\n\n  /**\n   * Checks whether this access result indicates access is explicitly allowed.\n   *\n   * Call this method to check whether someone has access, to convert an access\n   * result object to boolean.\n   *\n   * @return bool\n   *   When TRUE then isForbidden() and isNeutral() are FALSE.\n   */\n  public function isAllowed();\n\n  /**\n   * Checks whether this access result indicates access is explicitly forbidden.\n   *\n   * Call this when optimizing an access checker (for hook_entity_access() or a\n   * route requirement): if this is TRUE, the final result will be forbidden and\n   * no further checking is necessary.\n   *\n   * Do not use this method to decide whether someone has access, to convert an\n   * access result to boolean: just because this returns FALSE, the end result\n   * might be neutral which is not allowed. Always use isAllowed() for this.\n   *\n   * @return bool\n   *   When TRUE then isAllowed() and isNeutral() are FALSE.\n   */\n  public function isForbidden();\n\n  /**\n   * Checks whether this access result indicates access is not yet determined.\n   *\n   * @return bool\n   *   When TRUE then isAllowed() and isForbidden() are FALSE.\n   *\n   * @internal\n   */\n  public function isNeutral();\n\n  /**\n   * Combine this access result with another using OR.\n   *\n   * When ORing two access results, the result is:\n   * - isForbidden() in either \u21d2 isForbidden()\n   * - otherwise if isAllowed() in either \u21d2 isAllowed()\n   * - otherwise both must be isNeutral() \u21d2 isNeutral()\n   *\n   * Truth table:\n   * @code\n   *   |A N F\n   * --+-----\n   * A |A A F\n   * N |A N F\n   * F |F F F\n   * @endcode\n   *\n   * @param \\Drupal\\Core\\Access\\AccessResultInterface $other\n   *   The other access result to OR this one with.\n   *\n   * @return static\n   */\n  public function orIf(AccessResultInterface $other);\n\n  /**\n   * Combine this access result with another using AND.\n   *\n   * When AND is performed on two access results, the result is:\n   * - isForbidden() in either \u21d2 isForbidden()\n   * - otherwise, if isAllowed() in both \u21d2 isAllowed()\n   * - otherwise, one of them is isNeutral()  \u21d2 isNeutral()\n   *\n   * Truth table:\n   * @code\n   *   |A N F\n   * --+-----\n   * A |A N F\n   * N |N N F\n   * F |F F F\n   * @endcode\n   *\n   * @param \\Drupal\\Core\\Access\\AccessResultInterface $other\n   *   The other access result to AND this one with.\n   *\n   * @return static\n   */\n  public function andIf(AccessResultInterface $other);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Access/AccessResultInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "AccessResultInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "user_preference_login_redirect.settings:\n  type: config_object\n  label: 'User preference login redirect settings'\n  mapping:\n    available_routes:\n      type: text\n      label: 'Available redirect routes'\n      translatable: true\n    respect_destination_parameter:\n      type: boolean\n      label: 'Respect ?destination URL-parameter'\n    fieldset_weight:\n      type: integer\n      label: 'Fieldset weight'\n    fieldset_title:\n      type: label\n      label: 'Fieldset title'\n    field_title:\n      type: label\n      label: 'Field title'\n    field_description:\n      type: label\n      label: 'Field description'\n", "metadata": {"source": "repos/user_preference_login_redirect/config/schema/user_preference_login_redirect.schema.yml", "type": "yaml_reference", "topic": "user preference login redirect.schema"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Cache API", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal APIs](/docs/develop/drupal-apis)\n\n* [Access Policy API](/docs/develop/drupal-apis/access-policy-api)\n* [AJAX API](/docs/develop/drupal-apis/ajax-api)\n* [Authentication API](/docs/develop/drupal-apis/authentication-api)\n* [Batch API](/docs/drupal-apis/batch-api)\n* [Block API](/docs/drupal-apis/block-api)\n* [Cache API](/docs/develop/drupal-apis/cache-api)\n* [(deprecated) CKEditor 4 API](/docs/drupal-apis/deprecated-ckeditor-4-api-drupal-8-and-9)\n* [CKEditor 5 API](/docs/drupal-apis/ckeditor-5-api)\n* [Configuration API](/docs/drupal-apis/configuration-api)\n* [Database API](/docs/develop/drupal-apis/database-api)\n* [Entity API](/docs/drupal-apis/entity-api)\n* [Filter API](/docs/drupal-apis/filter-api)\n* [Form API](/docs/drupal-apis/form-api)\n* [JavaScript API](/docs/develop/drupal-apis/javascript-api)\n* [Layout API](/docs/drupal-apis/layout-api)\n* [Logging API](/docs/drupal-apis/logging-api)\n* [Menu API](/docs/drupal-apis/menu-api)\n* [Middleware API](/docs/drupal-apis/middleware-api)\n* [Migrate API](/docs/drupal-apis/migrate-api)\n* [Plugin API](/docs/drupal-apis/plugin-api)\n* [RESTful Web Services API](/docs/develop/drupal-apis/restful-web-services-api)\n* [Render API](/docs/drupal-apis/render-api)\n* [Responses](/docs/drupal-apis/responses)\n* [Routing system](/docs/drupal-apis/routing-system)\n* [Runtime Assertions](/docs/develop/drupal-apis/runtime-assertions)\n* [Serialization API](/docs/drupal-apis/serialization-api)\n* [Services and dependency injection](/docs/drupal-apis/services-and-dependency-injection)\n* [State API](/docs/develop/drupal-apis/state-api)\n* [Text Editor API](/docs/drupal-apis/text-editor-api)\n* [Tour API](/docs/drupal-apis/tour-api)\n* [Translation API](/docs/develop/drupal-apis/translation-api-code-text)\n* [Typed Data API](/docs/develop/drupal-apis/typed-data-api)\n* [Update API](/docs/drupal-apis/update-api)\n* [HTMX](/docs/develop/drupal-apis/htmx)\n* [Icon API](/docs/develop/drupal-apis/icon-api)\n* [Token API](/docs/develop/drupal-apis/token-api)\n\n# Cache API\n\nDocumentation for Cache API in Drupal 8.\n\n## [Cache API](/docs/8/api/cache-api/cache-api)\n\nExplore Drupal's Cache API features in-depth\n\n## [Cache tags](/docs/drupal-apis/cache-api/cache-tags)\n\nCache tags = data dependencies\n\n## [Cache contexts](/docs/develop/drupal-apis/cache-api/cache-contexts)\n\nCache contexts provide a declarative way to create context-dependent variations of something that needs to be cached.\n\n## [Cache max-age](/docs/drupal-apis/cache-api/cache-max-age)\n\nCache max-age = time dependencies\n\n## [Cache tags + Varnish](/docs/develop/drupal-apis/cache-api/cache-tags-varnish)\n\nVarnish Cache is a web application accelerator also known as a caching HTTP reverse proxy. Varnish is used on thousands of Drupal sites to\n\n## [CacheableDependencyInterface & friends](/docs/8/api/cache-api/cacheabledependencyinterface-friends)\n\nTo make dealing with cacheability metadata (cache tags, cache contexts and max-age) easier, Drupal 8 has CacheableDependencyInterface.\n\n## [CacheableResponseInterface](/docs/8/api/cache-api/cacheableresponseinterface)\n\nThis interface lives at the intersection of the Cache API and Responses. Since it is first and foremost a response, that's where the\n\n## [Access checkers + cacheability](/docs/8/api/cache-api/access-checkers-cacheability)\n\nRoute access checkers, hook\\_entity\\_access() and anything that needs to return an AccessResultInterface object should add the appropriate\n\n## Tags\n\n[Drupal 8](/taxonomy/term/183361)\n\n## Guide maintainers\n\n[![wim leers's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-99777-1680515999.jpg?itok=qxJ-6D5P)](/user/99777 \"View wim leers's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/drupal-apis/cache-api.md", "type": "doc_summary", "topic": "Cache API"}}
{"instruction": "Show me the implementation of the class Example in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\queue_manager_example\\Plugin\\QueueWorker;\n\nuse Drupal\\Core\\Queue\\Attribute\\QueueWorker;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Executes tasks of the example queue.\n */\n#[QueueWorker(\n  id: 'example',\n  title: new TranslatableMarkup('Example'),\n)]\nfinal class Example extends QueueWorkerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem(mixed $data): void {\n    \\usleep(100_000);\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/modules/queue_manager_example/src/Plugin/QueueWorker/Example.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Example", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer require revision:\n  title: 'Administer Require Revision settings'\n  description: 'Configure which entity types require revisions and revision log messages.'\n  restrict access: true\n", "metadata": {"source": "repos/require_revision/require_revision.permissions.yml", "type": "yaml_reference", "topic": "require revision.permissions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - core.entity_form_mode.media.media_library\n    - field.field.media.audio.field_media_audio_file\n    - media.type.audio\nid: media.audio.media_library\ntargetEntityType: media\nbundle: audio\nmode: media_library\ncontent: {  }\nhidden:\n  created: true\n  field_media_audio_file: true\n  name: true\n  path: true\n  status: true\n  uid: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/standard/config/optional/core.entity_form_display.media.audio.media_library.yml", "type": "yaml_reference", "topic": "core.entity form display.media.audio.media library"}}
{"instruction": "Show me the implementation of the class LightgalleryPluginManager in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\lightgallery_formatter\\Attribute\\LightgalleryPlugin;\n\n/**\n * Manages discovery and instantiation of LightGallery plugins.\n *\n * LightGallery plugins provide feature-specific configuration for the\n * LightGallery JavaScript library, such as thumbnails, zoom, video, etc.\n *\n * @see \\Drupal\\lightgallery_formatter\\Attribute\\LightgalleryPlugin\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginBase\n * @see plugin_api\n */\nclass LightgalleryPluginManager extends DefaultPluginManager {\n\n  /**\n   * Constructs a LightgalleryPluginManager object.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler) {\n    parent::__construct(\n      'Plugin/Lightgallery',\n      $namespaces,\n      $module_handler,\n      LightgalleryPluginInterface::class,\n      LightgalleryPlugin::class\n    );\n\n    $this->alterInfo('lightgallery_plugin_info');\n    $this->setCacheBackend($cache_backend, 'lightgallery_plugins');\n  }\n\n  /**\n   * Gets all plugin definitions sorted by weight.\n   *\n   * @return array\n   *   An array of plugin definitions sorted by weight.\n   */\n  public function getSortedDefinitions(): array {\n    $definitions = $this->getDefinitions();\n\n    uasort($definitions, function ($a, $b) {\n      return ($a['weight'] ?? 0) <=> ($b['weight'] ?? 0);\n    });\n\n    return $definitions;\n  }\n\n  /**\n   * Creates instances of all plugins with given configurations.\n   *\n   * @param array $plugin_settings\n   *   An array of plugin settings keyed by plugin ID.\n   *\n   * @return \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface[]\n   *   An array of plugin instances keyed by plugin ID.\n   */\n  public function createInstances(array $plugin_settings = []): array {\n    $instances = [];\n    foreach ($this->getSortedDefinitions() as $plugin_id => $definition) {\n      $configuration = $plugin_settings[$plugin_id] ?? [];\n      $instances[$plugin_id] = $this->createInstance($plugin_id, $configuration);\n    }\n    return $instances;\n  }\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/LightgalleryPluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryPluginManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DynamicLocalTasks\nSource file: <source_file>\nFile name hint: DynamicLocalTasks.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\content_moderation\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\content_moderation\\ModerationInformationInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Routing\\RouterInterface;\n\n/**\n * Generates moderation-related local tasks.\n */\nclass DynamicLocalTasks extends DeriverBase implements ContainerDeriverInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The base plugin ID.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The moderation information service.\n   *\n   * @var \\Drupal\\content_moderation\\ModerationInformationInterface\n   */\n  protected $moderationInfo;\n\n  /**\n   * The router.\n   *\n   * @var \\Symfony\\Component\\Routing\\RouterInterface\n   */\n  protected $router;\n\n  /**\n   * Creates a FieldUiLocalTask object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The translation manager.\n   * @param \\Drupal\\content_moderation\\ModerationInformationInterface $moderation_information\n   *   The moderation information service.\n   * @param \\Symfony\\Component\\Routing\\RouterInterface $router\n   *   The router.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation, ModerationInformationInterface $moderation_information, RouterInterface $router) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->stringTranslation = $string_translation;\n    $this->basePluginId = $base_plugin_id;\n    $this->moderationInfo = $moderation_information;\n    $this->router = $router;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('string_translation'),\n      $container->get('content_moderation.moderation_information'),\n      $container->get('router')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $this->derivatives = [];\n\n    // Add the moderated content task if the route exists.\n    if ($this->router->getRouteCollection()->get('content_moderation.admin_moderated_content') !== NULL) {\n      $this->derivatives['content_moderation.moderated_content'] = [\n        'route_name' => 'content_moderation.admin_moderated_content',\n        'title' => $this->t('Moderated content'),\n        'parent_id' => 'system.admin_content',\n        'weight' => 1,\n      ];\n    }\n\n    // Add the latest version tab to entities.\n    $latest_version_entities = array_filter($this->entityTypeManager->getDefinitions(), function (EntityTypeInterface $type) {\n      return $this->moderationInfo->canModerateEntitiesOfEntityType($type) && $type->hasLinkTemplate('latest-version');\n    });\n\n    foreach ($latest_version_entities as $entity_type_id => $entity_type) {\n      $this->derivatives[\"$entity_type_id.latest_version_tab\"] = [\n        'route_name' => \"entity.$entity_type_id.latest_version\",\n        'title' => $this->t('Latest version'),\n        'base_route' => \"entity.$entity_type_id.canonical\",\n        'weight' => 1,\n      ] + $base_plugin_definition;\n    }\n\n    return $this->derivatives;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\content_moderation\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\content_moderation\\ModerationInformationInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Routing\\RouterInterface;\n\n/**\n * Generates moderation-related local tasks.\n */\nclass DynamicLocalTasks extends DeriverBase implements ContainerDeriverInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The base plugin ID.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The moderation information service.\n   *\n   * @var \\Drupal\\content_moderation\\ModerationInformationInterface\n   */\n  protected $moderationInfo;\n\n  /**\n   * The router.\n   *\n   * @var \\Symfony\\Component\\Routing\\RouterInterface\n   */\n  protected $router;\n\n  /**\n   * Creates a FieldUiLocalTask object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The translation manager.\n   * @param \\Drupal\\content_moderation\\ModerationInformationInterface $moderation_information\n   *   The moderation information service.\n   * @param \\Symfony\\Component\\Routing\\RouterInterface $router\n   *   The router.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation, ModerationInformationInterface $moderation_information, RouterInterface $router) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->stringTranslation = $string_translation;\n    $this->basePluginId = $base_plugin_id;\n    $this->moderationInfo = $moderation_information;\n    $this->router = $router;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('string_translation'),\n      $container->get('content_moderation.moderation_information'),\n      $container->get('router')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $this->derivatives = [];\n\n    // Add the moderated content task if the route exists.\n    if ($this->router->getRouteCollection()->get('content_moderation.admin_moderated_content') !== NULL) {\n      $this->derivatives['content_moderation.moderated_content'] = [\n        'route_name' => 'content_moderation.admin_moderated_content',\n        'title' => $this->t('Moderated content'),\n        'parent_id' => 'system.admin_content',\n        'weight' => 1,\n      ];\n    }\n\n    // Add the latest version tab to entities.\n    $latest_version_entities = array_filter($this->entityTypeManager->getDefinitions(), function (EntityTypeInterface $type) {\n      return $this->moderationInfo->canModerateEntitiesOfEntityType($type) && $type->hasLinkTemplate('latest-version');\n    });\n\n    foreach ($latest_version_entities as $entity_type_id => $entity_type) {\n      $this->derivatives[\"$entity_type_id.latest_version_tab\"] = [\n        'route_name' => \"entity.$entity_type_id.latest_version\",\n        'title' => $this->t('Latest version'),\n        'base_route' => \"entity.$entity_type_id.canonical\",\n        'weight' => 1,\n      ] + $base_plugin_definition;\n    }\n\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_moderation/src/Plugin/Derivative/DynamicLocalTasks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DynamicLocalTasks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class BookNodePrintAccessCheck in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Determines if a user has access to print.\n */\nclass BookNodePrintAccessCheck implements AccessInterface {\n\n  /**\n   * Constructs a BookNodePrintAccessCheck object.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $currentUser\n   *   The current logged-in user.\n   */\n  public function __construct(protected AccountInterface $currentUser) {\n  }\n\n  /**\n   * Checks if user has permission to access print link.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(): AccessResultInterface {\n    return AccessResult::allowedIfHasPermission($this->currentUser, 'access printer-friendly version');\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Access/BookNodePrintAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookNodePrintAccessCheck", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: RunCron.php\nTarget symbol: class RunCron\nNamespace: Drupal\\mcp_tools_cron\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for RunCron.\n- Include required imports:\n  - Drupal\\mcp_tools\\Service\\AccessManager\n  - Drupal\\mcp_tools\\Service\\AuditLogger\n  - Drupal\\mcp_tools_cron\\Service\\CronService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_cron\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_cron\\Service\\CronService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_cron_run',\n  label: new TranslatableMarkup('Run Cron'),\n  description: new TranslatableMarkup('Execute all cron jobs immediately.'),\n  operation: ToolOperation::Write,\n  input_definitions: [],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'duration_seconds' => new ContextDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Duration in seconds'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass RunCron extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'cron';\n\n\n  protected CronService $cronService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->cronService = $container->get('mcp_tools_cron.cron_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access (running cron is a write operation).\n    $accessCheck = $this->accessManager->checkWriteAccess('run', 'cron');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $result = $this->cronService->runCron();\n\n    if ($result['success']) {\n      $this->auditLogger->log('run', 'cron', 'all', [\n        'duration' => $result['duration_seconds'] ?? 0,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_cron/src/Plugin/tool/Tool/RunCron.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RunCron", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - core.entity_view_mode.node.full\n    - field.field.node.page.field_body\n    - field.field.node.page.layout_builder__layout\n    - node.type.page\n  module:\n    - layout_builder\n    - layout_discovery\n    - text\n    - user\nthird_party_settings:\n  layout_builder:\n    enabled: true\n    allow_custom: true\n    sections:\n      -\n        layout_id: layout_onecol\n        layout_settings:\n          label: ''\n        components:\n          74a08c63-70dc-42e7-89f8-e4c62efb07ce:\n            uuid: 74a08c63-70dc-42e7-89f8-e4c62efb07ce\n            region: content\n            configuration:\n              id: 'field_block:node:page:field_body'\n              label_display: '0'\n              context_mapping:\n                entity: layout_builder.entity\n              formatter:\n                type: text_default\n                label: hidden\n                settings: {  }\n                third_party_settings: {  }\n            weight: 0\n            additional: {  }\n          57ad7b26-a88b-439e-a056-40f2de29a943:\n            uuid: 57ad7b26-a88b-439e-a056-40f2de29a943\n            region: content\n            configuration:\n              id: 'extra_field_block:node:page:links'\n              label_display: '0'\n              context_mapping:\n                entity: layout_builder.entity\n            weight: 1\n            additional: {  }\n          01b94e28-e38c-4849-98d6-ed77bca30afc:\n            uuid: 01b94e28-e38c-4849-98d6-ed77bca30afc\n            region: content\n            configuration:\n              id: 'extra_field_block:node:page:content_moderation_control'\n              label_display: '0'\n              context_mapping:\n                entity: layout_builder.entity\n            weight: 2\n            additional: {  }\n        third_party_settings: {  }\nid: node.page.full\ntargetEntityType: node\nbundle: page\nmode: full\ncontent:\n  content_moderation_control:\n    settings: {  }\n    third_party_settings: {  }\n    weight: 2\n    region: content\n  field_body:\n    type: text_default\n    label: hidden\n    settings: { }\n    third_party_settings: { }\n    weight: 0\n    region: content\n  links:\n    settings: {  }\n    third_party_settings: {  }\n    weight: 1\n    region: content\nhidden:\n  langcode: true\n  layout_builder__layout: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_view_display.node.page.full.yml", "type": "yaml_reference", "topic": "core.entity view display.node.page.full"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use pathauto:\n  title: 'Use MCP Pathauto tools'\n  description: 'Create, update, delete, and generate URL alias patterns via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_pathauto/mcp_tools_pathauto.permissions.yml", "type": "yaml_reference", "topic": "mcp tools pathauto.permissions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "type: module\nname: ECA Entity Import\ndescription: Provides ECA migrate process plugin for entity import.\ncore_version_requirement: ^11.2\npackage: Migration\ndependencies:\n  - drupal:migrate\n  - entity_import:entity_import\n  - eca:eca_migrate (>=3.0.3)\n", "metadata": {"source": "repos/eca_entity_import/eca_entity_import.info.yml", "type": "yaml_reference", "topic": "eca entity import.info"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation to display a one-column layout.\n *\n * Available variables:\n * - in_preview: Whether the plugin is being rendered in preview mode.\n * - content: The content for this layout.\n * - attributes: HTML attributes for the layout <div>.\n *\n * @ingroup themeable\n */\n#}\n{%\n  set classes = [\n    'layout',\n    'layout--onecol',\n  ]\n%}\n{% if content %}\n  <div{{ attributes.addClass(classes) }}>\n    <div {{ region_attributes.content.addClass('layout__region', 'layout__region--content') }}>\n      {{ content.content }}\n    </div>\n  </div>\n{% endif %}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_discovery/layouts/onecol/layout--onecol.html.twig", "type": "twig_reference"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: soap_client.install\nTarget symbol: class soap_client.install\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for soap_client.install.", "output": "<?php\n\ndeclare(strict_types=1);\n\n/**\n * @file\n * Install, update and uninstall functions for the SOAP Client module.\n *\n * INSTALLATION TIMING:\n *\n * Feed Type generation happens in hook_modules_installed() (soap_client.module)\n * after plugin discovery is complete. This prevents \"plugin does not exist\"\n * errors that occur when plugins try to discover entities before cache clearing.\n */\n", "metadata": {"source": "repos/soap_client/soap_client.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapClient", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: html_lang_override.module\nTarget symbol: class html_lang_override.module\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for html_lang_override.module.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Component\\Utility\\Html\n- Ensure these methods exist where relevant:\n  - html_lang_override_entity_delete()\n  - html_lang_override_entity_insert()\n  - html_lang_override_entity_presave()\n  - html_lang_override_form_node_form_alter()", "output": "<?php\n\n/**\n * @file\n * Contains \\Drupal\\html_lang_override\\Form\\HtmlLangOverrideForm.\n */\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Component\\Utility\\Html;\n\n/**\n * Implements hook_form_FORM_ID_alter().\n */\nfunction html_lang_override_form_node_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  $node = NULL;\n  $form_object = $form_state->getFormObject();\n  if (method_exists($form_object, 'getEntity')) {\n    $node = $form_object->getEntity();\n  }\n  $current_user = \\Drupal::currentUser();\n  $language_override_service = \\Drupal::service('html_lang_override.manager');\n  $default_lang = \\Drupal::languageManager()->getDefaultLanguage()->getId();\n  $node_lang = NULL;\n  if ($node && !$node->isNew()) {\n    $node_lang = $language_override_service->getLangForNode($node->id());\n  }\n\n  $form['html_lang_override_wrapper'] = [\n    '#type' => 'details',\n    '#title' => t('Override HTML Lang Attribute'),\n    '#open' => FALSE,\n    '#weight' => 100,\n    '#description' => t('Override the HTML lang attribute for this page.'),\n    '#group' => 'advanced',\n    '#access' => $current_user->hasPermission('Override HTML lang attribute'),\n  ];\n\n  $form['html_lang_override_wrapper']['html_lang_override'] = [\n    '#type' => 'textfield',\n    '#title' => t('Custom HTML Lang Attribute'),\n    '#default_value' => $node_lang,\n    '#placeholder' => $default_lang,\n    '#description' => t('Specify a language code (e.g., en, hi, ja). Leave empty to use global default. Make sure to use a valid language code.'),\n    '#maxlength' => 10,\n    '#access' => $current_user->hasPermission('Override HTML lang attribute'),\n  ];\n}\n\n/**\n * Implements hook_entity_presave().\n */\nfunction html_lang_override_entity_presave(EntityInterface $entity) {\n  if ($entity->getEntityTypeId() === 'node' && !$entity->isNew()) {\n    $value = \\Drupal::request()->request->get('html_lang_override');\n    if ($value !== NULL) {\n      $value = Html::escape(trim($value));\n      if (!empty($value)) {\n        \\Drupal::service('html_lang_override.manager')->saveLangForNode($entity->id(), $value);\n      }\n      if (empty($value)) {\n        \\Drupal::service('html_lang_override.manager')->deleteLangForNode($entity->id());\n      }\n    }\n  }\n}\n\n/**\n * Implements hook_entity_insert().\n */\nfunction html_lang_override_entity_insert(EntityInterface $entity) {\n  if ($entity->getEntityTypeId() === 'node') {\n    $value = \\Drupal::request()->request->get('html_lang_override');\n    if ($value !== NULL) {\n      $value = Html::escape(trim($value));\n      if (!empty($value)) {\n        \\Drupal::service('html_lang_override.manager')->saveLangForNode($entity->id(), $value);\n      }\n    }\n  }\n}\n\n/**\n * Implements hook_entity_delete().\n */\nfunction html_lang_override_entity_delete(EntityInterface $entity) {\n  if ($entity->getEntityTypeId() === 'node') {\n    \\Drupal::service('html_lang_override.manager')->deleteLangForNode($entity->id());\n  }\n}\n", "metadata": {"source": "repos/html_lang_override/html_lang_override.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HtmlLangOverride", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class QueueOverviewController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Controller;\n\nuse Drupal\\Core\\Queue\\QueueWorkerManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup as TM;\nuse Drupal\\queue_manager\\Element\\QueueSize;\n\n/**\n * {@selfdoc}\n */\nfinal readonly class QueueOverviewController {\n\n  /**\n   * {@selfdoc}\n   */\n  public function __construct(\n    private QueueWorkerManagerInterface $workerManager,\n  ) {}\n\n  /**\n   * {@selfdoc}\n   */\n  public function __invoke(): array {\n    $definitions = $this->workerManager->getDefinitions();\n    \\ksort($definitions);\n    return [\n      '#type' => 'table',\n      '#header' => [new TM('Queue'), new TM('Worker'), new TM('Items'), new TM('Operations')],\n      // @phpstan-ignore argument.type\n      '#rows' => \\array_map(self::buildRow(...), $definitions),\n      '#empty' => new TM('No queues were found.'),\n      '#attached' => ['library' => ['queue_manager/queue_overview']],\n      '#attributes' => ['class' => ['qm-queue-overview']],\n    ];\n  }\n\n  /**\n   * {@selfdoc}\n   */\n  private static function buildRow(array $definition): array {\n    $queue_name = $definition['id'];\n    \\assert(\\is_string($queue_name));\n    return [\n      'data' => [\n        $queue_name,\n        $definition['class'],\n        ['data' => [QueueSize::build(NULL, $queue_name, 0.5)]],\n        ['data' => self::buildOperations($queue_name)],\n      ],\n      'data-qm-queue-name' => $queue_name,\n    ];\n  }\n\n  /**\n   * {@selfdoc}\n   */\n  private static function buildOperations(string $queue_name): array {\n    return [\n      [\n        '#type' => 'button',\n        '#value' => new TM('Run'),\n        '#button_type' => 'small',\n        '#attributes' => [\n          'data-qm-queue-name' => $queue_name,\n          'data-qm-queue-overview-run' => TRUE,\n        ],\n      ],\n      [\n        '#type' => 'button',\n        '#value' => new TM('Stop'),\n        '#button_type' => 'small',\n        '#attributes' => [\n          'data-qm-queue-name' => $queue_name,\n          'data-qm-queue-overview-stop' => TRUE,\n        ],\n      ],\n      [\n        '#type' => 'button',\n        '#value' => new TM('Delete'),\n        '#button_type' => 'small',\n        '#attributes' => [\n          'data-qm-queue-name' => $queue_name,\n          'data-qm-queue-overview-delete' => TRUE,\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/src/Controller/QueueOverviewController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "QueueOverviewController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Page in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\n\n/**\n * Provides a render element for the content of an HTML page.\n *\n * This represents the \"main part\" of the HTML page's body; see html.html.twig.\n  */\n#[RenderElement('page')]\nclass Page extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#theme' => 'page',\n      '#title' => '',\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/Page.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Page", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: SitePrivateKeyFileKeyProviderDecorator\nSource file: <source_file>\nFile name hint: SitePrivateKeyFileKeyProviderDecorator.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\easy_encryption\\Plugin\\KeyProvider;\n\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryUsingKeyEntities;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Drupal\\key\\KeyInterface;\nuse Drupal\\key\\Plugin\\KeyProvider\\FileKeyProvider;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Reads content of the site's private key files stored as PHP code.\n *\n * This decorator extends the File key provider to support reading private key\n * files that are stored as PHP code (wrapped in `<?php return 'value';`).\n * This format prevents accidental exposure if the file is accessed via the web,\n * since PHP will execute the code and return nothing visible.\n *\n * For files outside the Easy Encryption private key directory, this falls back\n * to the standard File key provider behavior.\n *\n * @internal\n *   This is an internal part of Easy Encryption and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class SitePrivateKeyFileKeyProviderDecorator extends FileKeyProvider {\n\n  /**\n   * The key pair repository.\n   */\n  protected SodiumKeyPairRepositoryInterface $keyPairRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): self {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->keyPairRepository = $container->get(SodiumKeyPairRepositoryInterface::class);\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getKeyValue(KeyInterface $key): string {\n    $config = $this->getConfiguration();\n\n    // If no file location is configured, delegate to parent.\n    if (empty($config['file_location'])) {\n      return parent::getKeyValue($key);\n    }\n\n    $path = $config['file_location'];\n\n    // If this is an Easy Encryption private key file (stored as PHP code),\n    // use require to execute and return the value.\n    if ($this->keyPairRepository instanceof SodiumKeyPairRepositoryUsingKeyEntities && dirname(realpath($path)) === $this->keyPairRepository->getPrivateKeyDirectory()) {\n\n      if (!file_exists($path) || !is_readable($path)) {\n        return '';\n      }\n\n      $value = require $path;\n      return is_string($value) ? $value : '';\n    }\n\n    // For all other files, use the standard File key provider logic.\n    return parent::getKeyValue($key);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\Plugin\\KeyProvider;\n\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryUsingKeyEntities;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Drupal\\key\\KeyInterface;\nuse Drupal\\key\\Plugin\\KeyProvider\\FileKeyProvider;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Reads content of the site's private key files stored as PHP code.\n *\n * This decorator extends the File key provider to support reading private key\n * files that are stored as PHP code (wrapped in `<?php return 'value';`).\n * This format prevents accidental exposure if the file is accessed via the web,\n * since PHP will execute the code and return nothing visible.\n *\n * For files outside the Easy Encryption private key directory, this falls back\n * to the standard File key provider behavior.\n *\n * @internal\n *   This is an internal part of Easy Encryption and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class SitePrivateKeyFileKeyProviderDecorator extends FileKeyProvider {\n\n  /**\n   * The key pair repository.\n   */\n  protected SodiumKeyPairRepositoryInterface $keyPairRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): self {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->keyPairRepository = $container->get(SodiumKeyPairRepositoryInterface::class);\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getKeyValue(KeyInterface $key): string {\n    $config = $this->getConfiguration();\n\n    // If no file location is configured, delegate to parent.\n    if (empty($config['file_location'])) {\n      return parent::getKeyValue($key);\n    }\n\n    $path = $config['file_location'];\n\n    // If this is an Easy Encryption private key file (stored as PHP code),\n    // use require to execute and return the value.\n    if ($this->keyPairRepository instanceof SodiumKeyPairRepositoryUsingKeyEntities && dirname(realpath($path)) === $this->keyPairRepository->getPrivateKeyDirectory()) {\n\n      if (!file_exists($path) || !is_readable($path)) {\n        return '';\n      }\n\n      $value = require $path;\n      return is_string($value) ? $value : '';\n    }\n\n    // For all other files, use the standard File key provider logic.\n    return parent::getKeyValue($key);\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/Plugin/KeyProvider/SitePrivateKeyFileKeyProviderDecorator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SitePrivateKeyFileKeyProviderDecorator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Card overlay\"\ndescription: \"Turn an image into a card background and overlay your card\u2019s text. Depending on the image, you may or may not need additional styles or utilities.\"\ngroup: Card\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/components/card/#image-overlays\"\nslots:\n  image:\n    title: Image\n    description: \"Card image.\"\n  title:\n    title: Title\n    description: \"Card title. Plain text.\"\n  subtitle:\n    title: Subtitle\n    description: \"Card subtitle. Plain text.\"\n  text:\n    title: Text\n    description: \"Card text. Plain text.\"\n  content:\n    title: Content\n    description: \"Free content outside of any wrapper.\"\n  links:\n    title: Links\n    description: \"Array of link elements\"\nprops:\n  type: object\n  properties:\n    heading_level:\n      title: \"Heading level\"\n      type: integer\n      enum:\n        - 2\n        - 3\n        - 4\n        - 5\n        - 6\n      \"meta:enum\":\n        2: h2\n        3: h3\n        4: h4\n        5: \"h5 (Default)\"\n        6: h6\n    title_attributes:\n      title: \"Title attributes\"\n      description: \"The attributes to customize the card title if present.\"\n      type: string\n    subtitle_attributes:\n      title: \"Subtitle attributes\"\n      description: \"The attributes to customize the card subtitle if present.\"\n      type: string\n    text_attributes:\n      title: \"Text attributes\"\n      description: \"The attributes to customize the card text if present.\"\n      type: string\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/card_overlay/card_overlay.component.yml", "type": "yaml_reference", "topic": "card overlay.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "jsonapi_security.settings:\n  route_name: jsonapi_security.settings\n  base_route: jsonapi.settings\n  title: 'Security Hardening'\n  weight: 20\n", "metadata": {"source": "repos/jsonapi_security/jsonapi_security.links.task.yml", "type": "yaml_reference", "topic": "jsonapi security.links.task"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: GetFileSystemStatus.php\nTarget symbol: class GetFileSystemStatus\nNamespace: Drupal\\mcp_tools\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for GetFileSystemStatus.\n- Include required imports:\n  - Drupal\\mcp_tools\\Service\\FileSystemService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\FileSystemService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_tools_get_file_system_status',\n  label: new TranslatableMarkup('Get File System Status'),\n  description: new TranslatableMarkup('Get file system status including directory permissions and stream wrappers.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'directories' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Directory Status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'stream_wrappers' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Stream Wrappers'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetFileSystemStatus extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'site_health';\n\n\n  protected FileSystemService $fileSystem;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->fileSystem = $container->get('mcp_tools.file_system');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return [\n      'success' => TRUE,\n      'data' => $this->fileSystem->getFileSystemStatus(),\n    ];\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/src/Plugin/tool/Tool/GetFileSystemStatus.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetFileSystemStatus", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ResourceTypeAttribute.php\nTarget symbol: class may\nNamespace: Drupal\\jsonapi\\ResourceType\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for may.", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\jsonapi\\ResourceType;\n\n/**\n * Specialization of a ResourceTypeField to represent a resource type attribute.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n *\n * @see \\Drupal\\jsonapi\\ResourceType\\ResourceTypeRepository\n */\nclass ResourceTypeAttribute extends ResourceTypeField {}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/ResourceType/ResourceTypeAttribute.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ResourceTypeAttribute", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ParamConverterManager\nSource file: <source_file>\nFile name hint: ParamConverterManager.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\ParamConverter;\n\nuse Drupal\\Core\\Routing\\RouteObjectInterface;\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Manages converter services for converting request parameters to full objects.\n *\n * A typical use case for this would be upcasting (converting) a node id to a\n * node entity.\n */\nclass ParamConverterManager implements ParamConverterManagerInterface {\n\n  /**\n   * Array of loaded converter services keyed by their ids.\n   *\n   * @var array\n   */\n  protected $converters = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addConverter(ParamConverterInterface $param_converter, $id) {\n    $this->converters[$id] = $param_converter;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConverter($converter) {\n    if (isset($this->converters[$converter])) {\n      return $this->converters[$converter];\n    }\n    else {\n      throw new \\InvalidArgumentException(sprintf('No converter has been registered for %s', $converter));\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setRouteParameterConverters(RouteCollection $routes) {\n    foreach ($routes->all() as $route) {\n      if (!$parameters = $route->getOption('parameters')) {\n        // Continue with the next route if no parameters have been defined.\n        continue;\n      }\n\n      // Loop over all defined parameters and look up the right converter.\n      foreach ($parameters as $name => &$definition) {\n        if (isset($definition['converter'])) {\n          // Skip parameters that already have a manually set converter.\n          continue;\n        }\n\n        foreach (array_keys($this->converters) as $converter) {\n          if ($this->getConverter($converter)->applies($definition, $name, $route)) {\n            $definition['converter'] = $converter;\n            break;\n          }\n        }\n      }\n\n      // Override the parameters array.\n      $route->setOption('parameters', $parameters);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function convert(array $defaults) {\n    /** @var \\Symfony\\Component\\Routing\\Route $route */\n    $route = $defaults[RouteObjectInterface::ROUTE_OBJECT];\n\n    // Skip this enhancer if there are no parameter definitions.\n    if (!$parameters = $route->getOption('parameters')) {\n      return $defaults;\n    }\n\n    // Invoke the registered converter for each parameter.\n    foreach ($parameters as $name => $definition) {\n      if (!isset($defaults[$name])) {\n        // Do not try to convert anything that is already set to NULL.\n        continue;\n      }\n\n      if (!isset($definition['converter'])) {\n        // Continue if no converter has been specified.\n        continue;\n      }\n\n      // If a converter returns NULL it means that the parameter could not be\n      // converted.\n      $value = $defaults[$name];\n      $defaults[$name] = $this->getConverter($definition['converter'])->convert($value, $definition, $name, $defaults);\n      if (!isset($defaults[$name])) {\n        $message = 'The \"%s\" parameter was not converted for the path \"%s\" (route name: \"%s\")';\n        $route_name = $defaults[RouteObjectInterface::ROUTE_NAME];\n        throw new ParamNotConvertedException(sprintf($message, $name, $route->getPath(), $route_name), 0, NULL, $route_name, [$name => $value]);\n      }\n    }\n\n    return $defaults;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\ParamConverter;\n\nuse Drupal\\Core\\Routing\\RouteObjectInterface;\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Manages converter services for converting request parameters to full objects.\n *\n * A typical use case for this would be upcasting (converting) a node id to a\n * node entity.\n */\nclass ParamConverterManager implements ParamConverterManagerInterface {\n\n  /**\n   * Array of loaded converter services keyed by their ids.\n   *\n   * @var array\n   */\n  protected $converters = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addConverter(ParamConverterInterface $param_converter, $id) {\n    $this->converters[$id] = $param_converter;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConverter($converter) {\n    if (isset($this->converters[$converter])) {\n      return $this->converters[$converter];\n    }\n    else {\n      throw new \\InvalidArgumentException(sprintf('No converter has been registered for %s', $converter));\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setRouteParameterConverters(RouteCollection $routes) {\n    foreach ($routes->all() as $route) {\n      if (!$parameters = $route->getOption('parameters')) {\n        // Continue with the next route if no parameters have been defined.\n        continue;\n      }\n\n      // Loop over all defined parameters and look up the right converter.\n      foreach ($parameters as $name => &$definition) {\n        if (isset($definition['converter'])) {\n          // Skip parameters that already have a manually set converter.\n          continue;\n        }\n\n        foreach (array_keys($this->converters) as $converter) {\n          if ($this->getConverter($converter)->applies($definition, $name, $route)) {\n            $definition['converter'] = $converter;\n            break;\n          }\n        }\n      }\n\n      // Override the parameters array.\n      $route->setOption('parameters', $parameters);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function convert(array $defaults) {\n    /** @var \\Symfony\\Component\\Routing\\Route $route */\n    $route = $defaults[RouteObjectInterface::ROUTE_OBJECT];\n\n    // Skip this enhancer if there are no parameter definitions.\n    if (!$parameters = $route->getOption('parameters')) {\n      return $defaults;\n    }\n\n    // Invoke the registered converter for each parameter.\n    foreach ($parameters as $name => $definition) {\n      if (!isset($defaults[$name])) {\n        // Do not try to convert anything that is already set to NULL.\n        continue;\n      }\n\n      if (!isset($definition['converter'])) {\n        // Continue if no converter has been specified.\n        continue;\n      }\n\n      // If a converter returns NULL it means that the parameter could not be\n      // converted.\n      $value = $defaults[$name];\n      $defaults[$name] = $this->getConverter($definition['converter'])->convert($value, $definition, $name, $defaults);\n      if (!isset($defaults[$name])) {\n        $message = 'The \"%s\" parameter was not converted for the path \"%s\" (route name: \"%s\")';\n        $route_name = $defaults[RouteObjectInterface::ROUTE_NAME];\n        throw new ParamNotConvertedException(sprintf($message, $name, $route->getPath(), $route_name), 0, NULL, $route_name, [$name => $value]);\n      }\n    }\n\n    return $defaults;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/ParamConverter/ParamConverterManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ParamConverterManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: QueueSize.php\nTarget symbol: class QueueSize\nNamespace: Drupal\\queue_manager\\Element\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for QueueSize.\n- Include required imports:\n  - Drupal\\Core\\Render\\Attribute\\RenderElement\n  - Drupal\\Core\\Render\\Element\\RenderElementBase\n  - Drupal\\queue_manager\\Hook\\Theme\n- Ensure these methods exist where relevant:\n  - build()\n  - getInfo()\n  - preRender()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\nuse Drupal\\Core\\Render\\Element\\RenderElementBase;\nuse Drupal\\queue_manager\\Hook\\Theme;\n\n/**\n * Provides a render element to get queue size.\n *\n * Properties:\n * - #title: Element title.\n * - #queue_name: Queue name.\n * - #refresh: Refresh timeout in seconds.\n *\n * Usage Example:\n * @code\n * $build['example'] = [\n *   '#type' => 'queue_size',\n *   '#title' => 'Number of items',\n *   '#queue_name' => 'example',\n *   'refresh' => 1,\n * ];\n * @endcode\n */\n#[RenderElement(self::ID)]\nfinal class QueueSize extends RenderElementBase {\n\n  public const string ID = 'queue_size';\n\n  /**\n   * {@selfdoc}\n   */\n  public static function build(string|\\Stringable|null $title, string $queue_name, int|float $refresh): array {\n    if ($title instanceof \\Stringable) {\n      $title = (string) $title;\n    }\n    return [\n      '#type' => self::ID,\n      '#title' => $title ,\n      '#queue_name' => $queue_name,\n      '#refresh' => $refresh,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo(): array {\n    return [\n      '#theme' => Theme::QUEUE_SIZE,\n      '#attached' => ['library' => ['queue_manager/queue_size']],\n      '#pre_render' => [[self::class, 'preRender']],\n    ];\n  }\n\n  /**\n   * Element pre-sender callback.\n   */\n  public static function preRender(array $element): array {\n    // @phpstan-ignore argument.type\n    $queue = \\Drupal::queue($element['#queue_name']);\n    $element['#size'] = $queue->numberOfItems();\n    return $element;\n  }\n\n}\n\n$build['queue_status'] = [\n  '#type' => 'queue_size',\n  '#title' => 'Number of items',\n  '#queue_name' => 'example',\n  'refresh' => 1,\n];\n", "metadata": {"source": "repos/queue_manager/src/Element/QueueSize.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "QueueSize", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ViewsViewsExecutionHooks.php\nTarget symbol: class ViewsViewsExecutionHooks\nNamespace: Drupal\\views\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ViewsViewsExecutionHooks.\n- Include required imports:\n  - Drupal\\views\\Plugin\\views\\PluginBase\n  - Drupal\\views\\ViewExecutable\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n- Ensure these methods exist where relevant:\n  - viewsFormSubstitutions()\n  - viewsQuerySubstitutions()", "output": "<?php\n\nnamespace Drupal\\views\\Hook;\n\nuse Drupal\\views\\Plugin\\views\\PluginBase;\nuse Drupal\\views\\ViewExecutable;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for views.\n */\nclass ViewsViewsExecutionHooks {\n\n  /**\n   * Implements hook_views_query_substitutions().\n   *\n   * Makes the following substitutions:\n   * - Current time.\n   * - Drupal version.\n   * - Special language codes; see\n   *   \\Drupal\\views\\Plugin\\views\\PluginBase::listLanguages().\n   */\n  #[Hook('views_query_substitutions')]\n  public function viewsQuerySubstitutions(ViewExecutable $view): array {\n    $substitutions = [\n      '***CURRENT_VERSION***' => \\Drupal::VERSION,\n      '***CURRENT_TIME***' => \\Drupal::time()->getRequestTime(),\n    ] + PluginBase::queryLanguageSubstitutions();\n    return $substitutions;\n  }\n\n  /**\n   * Implements hook_views_form_substitutions().\n   */\n  #[Hook('views_form_substitutions')]\n  public function viewsFormSubstitutions(): array {\n    $select_all = [\n      '#type' => 'checkbox',\n      '#default_value' => FALSE,\n      '#attributes' => [\n        'class' => [\n          'action-table-select-all',\n        ],\n      ],\n    ];\n    return [\n      '<!--action-bulk-form-select-all-->' => \\Drupal::service('renderer')->render($select_all),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Hook/ViewsViewsExecutionHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsViewsExecutionHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: NonceGenerator.php\nTarget symbol: class NonceGenerator\nNamespace: Drupal\\webprofiler\\Csp\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for NonceGenerator.\n- Ensure these methods exist where relevant:\n  - generate()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Csp;\n\n/**\n * Generates Content-Security-Policy nonce.\n *\n * @internal\n */\nclass NonceGenerator {\n\n  /**\n   * Generates Content-Security-Policy nonce.\n   *\n   * @return string\n   *   A nonce.\n   *\n   * @throws \\Exception\n   */\n  public function generate(): string {\n    return \\bin2hex(\\random_bytes(16));\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Csp/NonceGenerator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NonceGenerator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class DrupalInstalledTemplate in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold;\n\nuse Composer\\Package\\PackageInterface;\nuse Composer\\Repository\\InstalledRepositoryInterface;\n\n/**\n * Produces code for the DrupalInstalled file.\n *\n * @internal\n */\nclass DrupalInstalledTemplate {\n\n  /**\n   * Gets the code for the DrupalInstalled class.\n   *\n   * @param \\Composer\\Package\\PackageInterface $root_package\n   *   The root package.\n   * @param \\Composer\\Repository\\InstalledRepositoryInterface $repository\n   *   The local installed repository.\n   *\n   * @return string\n   *   The PHP code to write to the DrupalInstalled class.\n   */\n  public static function getCode(PackageInterface $root_package, InstalledRepositoryInterface $repository): string {\n    // Write out a hash of the version information to a file so we can use it.\n    $versions = array_reduce($repository->getPackages(), fn (string $carry, PackageInterface $package) => $carry . $package->getUniqueName() . '-' . $package->getSourceReference() . '|', '');\n    // Add the root_package package version info so custom code changes and\n    // root_package package version changes result in the hash changing.\n    $versions .= $root_package->getUniqueName() . '-' . $root_package->getSourceReference();\n    $version_hash = hash('xxh3', $versions);\n    return <<<EOF\n      <?php\n\n      namespace Drupal;\n\n      /**\n       * A class containing information determined during composer installation.\n       *\n       * This file is generated automatically by the\n       * drupal/core-composer-scaffold Composer plugin, and should not be\n       * edited.\n       *\n       * @see \\Drupal\\Composer\\Plugin\\Scaffold\\Plugin::preAutoloadDump()\n       */\n      class DrupalInstalled {\n\n        /**\n         * A hash of all the installed packages and their versions.\n         */\n        public const string VERSIONS_HASH = '$version_hash';\n\n      }\n\n      EOF;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/DrupalInstalledTemplate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DrupalInstalledTemplate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the class FlowDropJobAccessControlHandler in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_job;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Entity\\EntityAccessControlHandler;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Defines the access control handler for the flowdrop job entity type.\n *\n * phpcs:disable Drupal.Arrays.Array.LongLineDeclaration\n *\n * @see https://www.drupal.org/project/coder/issues/3185082\n */\nfinal class FlowDropJobAccessControlHandler extends EntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account): AccessResult {\n    if ($account->hasPermission($this->entityType->getAdminPermission())) {\n      return AccessResult::allowed()->cachePerPermissions();\n    }\n\n    return match($operation) {\n      'view' => AccessResult::allowedIfHasPermission($account, 'view flowdrop_job'),\n      'update' => AccessResult::allowedIfHasPermission($account, 'edit flowdrop_job'),\n      'delete' => AccessResult::allowedIfHasPermission($account, 'delete flowdrop_job'),\n      default => AccessResult::neutral(),\n    };\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkCreateAccess(AccountInterface $account, array $context, $entity_bundle = NULL): AccessResult {\n    return AccessResult::allowedIfHasPermissions($account, ['create flowdrop_job', 'administer flowdrop_job types'], 'OR');\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_job/src/FlowDropJobAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropJobAccessControlHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "zefix.settings_form:\n  title: Zefix\n  description: Configuration for accessing the Zefix API\n  parent: system.admin_config_services\n  route_name: zefix.settings_form\n  weight: 10\n", "metadata": {"source": "repos/zefix/zefix.links.menu.yml", "type": "yaml_reference", "topic": "zefix.links.menu"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Status Badge\nstatus: stable\ndescription: 'Displays a status indicator badge. Used for workflow status, connection status, execution state, etc.'\ngroup: FlowDrop\n\nprops:\n  type: object\n  required:\n    - label\n  properties:\n    label:\n      type: string\n      title: Label\n      description: 'The badge text (e.g., \"Active\", \"Connected\", \"Running\")'\n    variant:\n      type: string\n      title: Variant\n      description: 'The visual style variant'\n      enum:\n        - success\n        - warning\n        - error\n        - info\n        - neutral\n      default: neutral\n    size:\n      type: string\n      title: Size\n      description: 'Badge size'\n      enum:\n        - sm\n        - md\n      default: md\n    dot:\n      type: boolean\n      title: Show Dot\n      description: 'Show a colored dot indicator'\n      default: false\n\nlibraryOverrides:\n  css:\n    component:\n      status-badge.css: {}\n  dependencies:\n    - flowdrop_ui_components/theme-layer\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/status-badge/status-badge.component.yml", "type": "yaml_reference", "topic": "status-badge.component"}}
{"instruction": "Show me the implementation of the class TransactionStatusUpdater in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Service;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Drupal\\nexi_xpay\\Event\\NexiXpayEvents;\nuse Drupal\\nexi_xpay\\Event\\TransactionStatusChangeEvent;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * Updates the transaction status.\n */\nfinal class TransactionStatusUpdater {\n\n  /**\n   * The logger context.\n   *\n   * @var array{amount?: int, body?: string, correlationId?: string, currentStatus?: string, currency?: string, endpoint?: string, error?: string, eventId?: string, httpStatus?: int, method?: string, mode?: string, newStatus?: string|null, payload?: string, operationResult?: string, orderId?: string, outcome?: string, transaction?: int, url?: string}\n   */\n  protected array $loggerContext;\n\n  /**\n   * The constructor.\n   *\n   * @param \\Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface $dispatcher\n   *   The event dispatcher.\n   * @param \\Drupal\\nexi_xpay\\Service\\Logger $logger\n   *   The logger.\n   */\n  public function __construct(\n    private readonly EventDispatcherInterface $dispatcher,\n    private readonly LoggerInterface $logger,\n  ) {\n    $this->loggerContext = $this->logger->setupContext();\n  }\n\n  /**\n   * Sets the transaction status if it changed.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param string $newStatus\n   *   The new status.\n   * @param array<string, mixed> $context\n   *   Extra context information for callers (debug/logging).\n   *\n   * @return bool\n   *   TRUE if the status changed.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityStorageException\n   */\n  public function setStatusIfChanged(NexiXpayTransactionInterface $transaction, string $newStatus, array $context = []): bool {\n    $currentStatus = $this->loggerContext['currentStatus'] = $transaction->getStatus();\n    $this->loggerContext['newStatus'] = $newStatus;\n    $this->loggerContext['transaction'] = (int) $transaction->id();\n\n    if ($currentStatus === $newStatus) {\n      return FALSE;\n    }\n    $transaction->setStatus($newStatus);\n    $transaction->save();\n\n    $this->dispatcher->dispatch(\n      new TransactionStatusChangeEvent($transaction, $currentStatus, $newStatus, $context),\n      NexiXpayEvents::TRANSACTION_STATUS_CHANGE\n    );\n\n    $this->loggerContext['mode'] =\n      isset($context['mode']) && is_string($context['mode']) ? $context['mode'] : '';\n    $this->loggerContext['orderId'] =\n      isset($context['orderId']) && is_string($context['orderId']) ? $context['orderId'] : '';\n\n    $this->logger->info('Transaction status changed.', $this->loggerContext);\n\n    return TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Service/TransactionStatusUpdater.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TransactionStatusUpdater", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: drupal - 8.9.x", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# drupal - 8.9.x\n\n* [11.x](/api/drupal/11.x)\n* [10.3.x](/api/drupal/10)\n* [9.5.x](/api/drupal/9)\n* [8.9.x](/api/drupal/8.9.x)\n* [7.x](/api/drupal/7.x)\n\nWelcome to the Drupal API Documentation!\n\nThis site is an API reference for Drupal, generated from comments embedded\nin the source code. More in-depth documentation can be found at\n<https://www.drupal.org/developing/api>.\n\nHere are some topics to help you get started developing with Drupal.\n\n### Essential background concepts\n\n* [Object-oriented conventions used in Drupal](/api/drupal/core%21core.api.php/group/oo_conventions/8.9.x \"PSR-4, namespaces, class naming, and other conventions.\")\n* [Extending and altering Drupal](/api/drupal/core%21core.api.php/group/extending/8.9.x \"Overview of extensions and alteration methods for Drupal.\")\n* [Security and best practices](/api/drupal/core%21core.api.php/group/best_practices/8.9.x \"Overview of standards and best practices for developers\")\n* [Types of information in Drupal](/api/drupal/core%21core.api.php/group/info_types/8.9.x \"Types of information in Drupal.\")\n\n### User interface\n\n* [Menu entries, local tasks, and other links](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/group/menu/8.9.x \"Define the navigation menus, local actions and tasks, and contextual links.\")\n* [Routing API and page controllers](/api/drupal/core%21lib%21Drupal%21Core%21Routing%21routing.api.php/group/routing/8.9.x \"Route page requests to code based on URLs.\")\n* [Forms](/api/drupal/core%21core.api.php/group/form_api/8.9.x \"Describes how to generate and manipulate forms and process form submissions.\")\n* [Blocks](/api/drupal/core%21modules%21block%21block.api.php/group/block_api/8.9.x \"Information about the classes and interfaces that make up the Block API.\")\n* [Ajax](/api/drupal/core%21core.api.php/group/ajax/8.9.x \"Overview for Drupal's Ajax API.\")\n\n### Storing and retrieving data\n\n* [Entities](/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/8.9.x \"Describes how to define and manipulate content and configuration entities.\")\n* [Fields](/api/drupal/core%21modules%21field%21field.module/group/field/8.9.x \"Attaches custom data fields to Drupal entities.\")\n* [Configuration API](/api/drupal/core%21core.api.php/group/config_api/8.9.x \"Information about the Configuration API.\")\n* [State API](/api/drupal/core%21core.api.php/group/state_api/8.9.x \"Information about the State API.\")\n* [Views](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/8.9.x \"Overview of the Views module API\")\n* [Database abstraction layer](/api/drupal/core%21lib%21Drupal%21Core%21Database%21database.api.php/group/database/8.9.x \"Allow the use of different database servers using the same code base.\")\n\n### Other essential APIs\n\n* [Plugins](/api/drupal/core%21core.api.php/group/plugin_api/8.9.x \"Using the Plugin API\")\n* [Services and the Dependency Injection Container](/api/drupal/core%21core.api.php/group/container/8.9.x \"Overview of the Dependency Injection Container and Services.\")\n* [Events](/api/drupal/core%21core.api.php/group/events/8.9.x \"Overview of event dispatch and subscribing\")\n* [Internationalization](/api/drupal/core%21lib%21Drupal%21Core%21Language%21language.api.php/group/i18n/8.9.x \"Internationalization and translation\")\n* [Caching](/api/drupal/core%21core.api.php/group/cache/8.9.x \"Information about the Drupal Cache API\")\n* [Utility classes and functions](/api/drupal/core%21core.api.php/group/utility/8.9.x \"Overview of utility classes and functions for developers.\")\n* [User accounts, permissions, and roles](/api/drupal/core%21core.api.php/group/user_api/8.9.x \"API for user accounts, access checking, roles, and permissions.\")\n* [Render API](/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/theme_render/8.9.x \"Overview of the Theme system and Render API.\")\n* [Theme system](/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/themeable/8.9.x \"Functions and templates for the user interface that themes can override.\")\n* [Update API](/api/drupal/core%21lib%21Drupal%21Core%21Extension%21module.api.php/group/update_api/8.9.x \"Updating minor versions of modules\")\n* [Migration](/api/drupal/core%21modules%21migrate%21migrate.api.php/group/migration/8.9.x \"Overview of the Migrate API, which migrates data into Drupal.\")\n\n### Additional topics\n\n* [Batch API](/api/drupal/core%21includes%21form.inc/group/batch/8.9.x \"Creates and processes batch operations.\")\n* [Queue API](/api/drupal/core%21core.api.php/group/queue/8.9.x \"Queue items to allow later processing.\")\n* [Typed Data](/api/drupal/core%21core.api.php/group/typed_data/8.9.x \"API for describing data based on a set of available data types.\")\n* [Automated tests](/api/drupal/core%21core.api.php/group/testing/8.9.x \"Overview of PHPUnit and Nightwatch automated tests.\")\n* [PHP Runtime Assert Statements](/api/drupal/core%21core.api.php/group/php_assert/8.9.x \"Use of the assert() statement in Drupal.\")\n* [Integrating third-party applications](/api/drupal/core%21core.api.php/group/third_party/8.9.x \"Integrating third-party applications using REST and related operations.\")\n\n### Further information\n\n* [Examples project (sample modules)](https://www.drupal.org/project/examples)\n* [API change notices](https://www.drupal.org/list-changes)\n* [Drupal API longer references](https://www.drupal.org/docs/drupal-apis)\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=8.9.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/8.9.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/8.9.x.md", "type": "doc_summary", "topic": "drupal - 8.9.x"}}
{"instruction": "Show me the implementation of the class RestrictionPluginConfigForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder_restrictions\\Form;\n\nuse Drupal\\Core\\Config\\ConfigManager;\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\layout_builder_restrictions\\Plugin\\LayoutBuilderRestrictionManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * The form for the restriction plugin.\n */\nclass RestrictionPluginConfigForm extends ConfigFormBase {\n\n  /**\n   * The UI for managing Layout Builder Restrictions Plugins.\n   *\n   * @var \\Drupal\\layout_builder_restrictions\\Plugin\\LayoutBuilderRestrictionManager\n   */\n  protected $pluginManagerLayoutBuilderRestriction;\n  /**\n   * Drupal\\Core\\Config\\ConfigManager definition.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigManager\n   */\n  protected $configManager;\n\n  /**\n   * Constructs a new RestrictionPluginConfigForm object.\n   */\n  public function __construct(\n    LayoutBuilderRestrictionManager $plugin_manager_layout_builder_restriction,\n    ConfigManager $config_manager,\n  ) {\n    $this->pluginManagerLayoutBuilderRestriction = $plugin_manager_layout_builder_restriction;\n    $this->configManager = $config_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('plugin.manager.layout_builder_restriction'),\n      $container->get('config.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'restriction_plugin_config_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $plugin_list = $this->pluginManagerLayoutBuilderRestriction->getSortedPlugins(TRUE);\n\n    $form['plugin-table'] = [\n      '#type' => 'table',\n      '#header' => [\n        $this->t('Plugin'),\n        $this->t('ID'),\n        $this->t('Enabled'),\n        $this->t('Weight'),\n      ],\n      '#empty' => $this->t('There are no restriction plugins defined.'),\n      // TableDrag: Each array value is a list of callback arguments for\n      // drupal_add_tabledrag().\n      '#tabledrag' => [\n        [\n          'action' => 'order',\n          'relationship' => 'sibling',\n          'group' => 'plugin-table-order-weight',\n        ],\n      ],\n      '#prefix' => '<p>Set the order of Layout Builder Restriction plugin execution, and enable or disable as needed.</p>',\n    ];\n    // Build the table rows and columns.\n    // The first nested level in the render array forms the table row,\n    // on which you likely want to set #attributes and #weight.\n    foreach ($plugin_list as $id => $data) {\n      // TableDrag: Mark the table row as draggable.\n      $form['plugin-table'][$id]['#attributes']['class'][] = 'draggable';\n      // Sort the row according to its existing/configured weight.\n      $form['plugin-table'][$id]['#weight'] = $data['weight'];\n      if ($data['description']) {\n        $form['plugin-table'][$id]['title'] = [\n          '#markup' => '<strong>' . $data['title'] . '</strong><br>' . $data['description'],\n        ];\n      }\n      else {\n        $form['plugin-table'][$id]['title'] = [\n          '#markup' => '<strong>' . $data['title'] . '</strong>',\n        ];\n      }\n      $form['plugin-table'][$id]['id'] = [\n        '#plain_text' => $id,\n      ];\n      $form['plugin-table'][$id]['enabled'] = [\n        '#type' => 'checkbox',\n        '#title' => $this->t('Enabled'),\n        '#title_display' => 'invisible',\n        '#default_value' => $data['enabled'],\n        // Classify the weight element for #tabledrag.\n        '#attributes' => ['class' => ['plugin-table-enabled']],\n      ];\n      // TableDrag: Weight column element.\n      $form['plugin-table'][$id]['weight'] = [\n        '#type' => 'weight',\n        '#title' => $this->t('Weight for @title', ['@title' => $id]),\n        '#title_display' => 'invisible',\n        '#default_value' => $data['weight'],\n        // Classify the weight element for #tabledrag.\n        '#attributes' => ['class' => ['plugin-table-order-weight']],\n      ];\n\n    }\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $data_to_save = [];\n    $restriction_definitions = $this->pluginManagerLayoutBuilderRestriction->getDefinitions();\n    foreach ($form_state->getValue('plugin-table') as $plugin_id => $vals) {\n      // Verify we have a registered plugin key.\n      if (isset($restriction_definitions[$plugin_id])) {\n        $data_to_save[$plugin_id] = [\n          'weight' => (int) $vals['weight'],\n          'enabled' => (bool) $vals['enabled'],\n        ];\n      }\n    }\n    // Save config.\n    $plugin_weighting_config = $this->configFactory()->getEditable('layout_builder_restrictions.plugins');\n    $plugin_weighting_config->set('plugin_config', $data_to_save);\n    $plugin_weighting_config->save();\n  }\n\n}\n", "metadata": {"source": "repos/layout_builder_restrictions/src/Form/RestrictionPluginConfigForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RestrictionPluginConfigForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class HelpTopicPluginController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\help\\Controller;\n\nuse Drupal\\Component\\Utility\\SortArray;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Url;\nuse Drupal\\help\\HelpTopicPluginManagerInterface;\nuse Drupal\\Core\\Render\\RendererInterface;\nuse Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n\n/**\n * Controller for help topic plugins.\n *\n * @internal\n *   Controller classes are internal.\n */\nclass HelpTopicPluginController extends ControllerBase {\n\n  /**\n   * Constructs a HelpTopicPluginController object.\n   *\n   * @param \\Drupal\\help\\HelpTopicPluginManagerInterface $helpTopicPluginManager\n   *   The help topic plugin manager service.\n   * @param \\Drupal\\Core\\Render\\RendererInterface $renderer\n   *   The renderer service.\n   */\n  public function __construct(protected HelpTopicPluginManagerInterface $helpTopicPluginManager, protected RendererInterface $renderer) {\n  }\n\n  /**\n   * Displays a help topic page.\n   *\n   * @param string $id\n   *   The plugin ID. Maps to the {id} placeholder in the\n   *   help.help_topic route.\n   *\n   * @return array\n   *   A render array with the contents of a help topic page.\n   */\n  public function viewHelpTopic($id) {\n    $build = [];\n\n    if (!$this->helpTopicPluginManager->hasDefinition($id)) {\n      throw new NotFoundHttpException();\n    }\n    /** @var \\Drupal\\help\\HelpTopicPluginInterface $help_topic */\n    $help_topic = $this->helpTopicPluginManager->createInstance($id);\n\n    $build['#body'] = $help_topic->getBody();\n\n    $this->renderer->addCacheableDependency($build, $help_topic);\n\n    // Build the related topics section, starting with the list this topic\n    // says are related.\n    $links = [];\n\n    $related = $help_topic->getRelated();\n    foreach ($related as $other_id) {\n      if ($other_id !== $id) {\n        /** @var \\Drupal\\help\\HelpTopicPluginInterface $topic */\n        $topic = $this->helpTopicPluginManager->createInstance($other_id);\n        $links[$other_id] = [\n          'title' => $topic->getLabel(),\n          'url' => Url::fromRoute('help.help_topic', ['id' => $other_id]),\n        ];\n        $this->renderer->addCacheableDependency($build, $topic);\n      }\n    }\n\n    if (count($links)) {\n      uasort($links, [SortArray::class, 'sortByTitleElement']);\n      $build['#related'] = [\n        '#theme' => 'links__related',\n        '#heading' => [\n          'text' => $this->t('Related topics'),\n          'level' => 'h2',\n        ],\n        '#links' => $links,\n      ];\n    }\n\n    $build['#theme'] = 'help_topic';\n    $build['#title'] = $help_topic->getLabel();\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/help/src/Controller/HelpTopicPluginController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpTopicPluginController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer lightgallery_formatter:\n  title: 'Administer LightGallery formatter'\n  description: 'Perform all operations on LightGallery profiles including creating, editing, deleting and viewing.'\n", "metadata": {"source": "repos/lightgallery_formatter/lightgallery_formatter.permissions.yml", "type": "yaml_reference", "topic": "lightgallery formatter.permissions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "flagger_notify.settings_tab:\n  route_name: flagger_notify.settings_form\n  title: 'Settings'\n  base_route: flagger_notify.settings_form\n", "metadata": {"source": "repos/flagger_notify/flagger_notify.links.task.yml", "type": "yaml_reference", "topic": "flagger notify.links.task"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# cspell:ignore localizable\nid: d7_language_content_taxonomy_vocabulary_settings\nlabel: Drupal 7 language taxonomy vocabulary settings\nmigration_tags:\n  - Drupal 7\n  - Configuration\nsource:\n  plugin: d7_language_content_settings_taxonomy_vocabulary\n  constants:\n    target_type: 'taxonomy_term'\n    default_langcode: 'site_default'\nprocess:\n  target_bundle:\n    -\n      plugin: migration_lookup\n      migration: d7_taxonomy_vocabulary\n      source: vid\n    -\n      plugin: skip_on_empty\n      method: row\n  _skip:\n    -\n      plugin: concat\n      source:\n        - 'constants/target_type'\n        - '@target_bundle'\n      delimiter: .\n    -\n      plugin: migration_lookup\n      migration: d7_entity_translation_settings\n    -\n      plugin: callback\n      callable: is_null\n    -\n      plugin: skip_on_empty\n      method: row\n  # State is the value in the i18n_mode column of taxonomy_vocabulary table\n  # 0: No multilingual options.\n  # 1: Localize. Localizable object. Run through the localization system\n  # 2: Fixed Language. Predefined language for this object and all related ones\n  # 4: Translate. Multilingual objects, translatable but not localizable.\n  # 5: Objects are translatable (if they have language or localizable if not)\n  # Note: the Drupal 6 Per-language value (3) changed to 4 in Drupal 7.\n  language_alterable:\n    plugin: static_map\n    source: i18n_mode\n    map:\n      0: false\n      1: true\n      2: false\n      4: true\n      5: true\n  'third_party_settings/content_translation/enabled':\n    plugin: static_map\n    source: i18n_mode\n    map:\n      0: false\n      1: true\n      2: false\n      4: false\n      5: true\n  target_entity_type_id: 'constants/target_type'\n  default_langcode:\n    plugin: default_value\n    default_value: site_default\n    source: language\ndestination:\n  plugin: entity:language_content_settings\nmigration_dependencies:\n  required:\n    - language\n    - d7_taxonomy_vocabulary\n  optional:\n    - d7_language_content_settings\n    - d7_entity_translation_settings\n", "metadata": {"source": "repos/drupal_core/core/modules/language/migrations/d7_language_content_taxonomy_vocabulary_settings.yml", "type": "yaml_reference", "topic": "d7 language content taxonomy vocabulary settings"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: UserLogin.php\nTarget symbol: class UserLogin\nNamespace: Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for UserLogin.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType\n  - Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface\n  - Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase\n  - Drupal\\user\\UserInterface\n- Ensure these methods exist where relevant:\n  - extractTriggerData()\n  - getCategory()\n  - getParameterSchema()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Event type for user login events.\n *\n * Triggers when a user successfully logs into the site.\n * This event fires after authentication is complete.\n */\n#[FlowDropEventType(\n  id: \"user.login\",\n  label: new TranslatableMarkup(\"User Login\"),\n  description: new TranslatableMarkup(\"Triggered when a user logs in\"),\n  category: \"user\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [\"user\"],\n)]\nclass UserLogin extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    return \"user\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for user login events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add user-specific data.\n    $data[\"operation\"] = \"login\";\n\n    if ($entity instanceof UserInterface) {\n      $data[\"username\"] = $entity->getAccountName();\n      $data[\"email\"] = $entity->getEmail();\n      $data[\"roles\"] = $entity->getRoles();\n      $data[\"last_login\"] = $entity->getLastLoginTime();\n      $data[\"is_active\"] = $entity->isActive();\n    }\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"roles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"User Roles\",\n          \"description\" => \"Only trigger for users with these roles (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/UserLogin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserLogin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class SitePrivateKeyFileKeyProviderDecorator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\Plugin\\KeyProvider;\n\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryUsingKeyEntities;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Drupal\\key\\KeyInterface;\nuse Drupal\\key\\Plugin\\KeyProvider\\FileKeyProvider;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Reads content of the site's private key files stored as PHP code.\n *\n * This decorator extends the File key provider to support reading private key\n * files that are stored as PHP code (wrapped in `<?php return 'value';`).\n * This format prevents accidental exposure if the file is accessed via the web,\n * since PHP will execute the code and return nothing visible.\n *\n * For files outside the Easy Encryption private key directory, this falls back\n * to the standard File key provider behavior.\n *\n * @internal\n *   This is an internal part of Easy Encryption and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class SitePrivateKeyFileKeyProviderDecorator extends FileKeyProvider {\n\n  /**\n   * The key pair repository.\n   */\n  protected SodiumKeyPairRepositoryInterface $keyPairRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): self {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->keyPairRepository = $container->get(SodiumKeyPairRepositoryInterface::class);\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getKeyValue(KeyInterface $key): string {\n    $config = $this->getConfiguration();\n\n    // If no file location is configured, delegate to parent.\n    if (empty($config['file_location'])) {\n      return parent::getKeyValue($key);\n    }\n\n    $path = $config['file_location'];\n\n    // If this is an Easy Encryption private key file (stored as PHP code),\n    // use require to execute and return the value.\n    if ($this->keyPairRepository instanceof SodiumKeyPairRepositoryUsingKeyEntities && dirname(realpath($path)) === $this->keyPairRepository->getPrivateKeyDirectory()) {\n\n      if (!file_exists($path) || !is_readable($path)) {\n        return '';\n      }\n\n      $value = require $path;\n      return is_string($value) ? $value : '';\n    }\n\n    // For all other files, use the standard File key provider logic.\n    return parent::getKeyValue($key);\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/Plugin/KeyProvider/SitePrivateKeyFileKeyProviderDecorator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SitePrivateKeyFileKeyProviderDecorator", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: WebProfiler\ntype: module\ndescription: 'Drupal WebProfiler.'\npackage: Development\ncore_version_requirement: ^11\nconfigure: webprofiler.settings\ndependencies:\n  - devel:devel\n  - tracer:tracer\ntags:\n  - developer\n", "metadata": {"source": "repos/webprofiler/webprofiler.info.yml", "type": "yaml_reference", "topic": "webprofiler.info"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ShortcutThemeHooks\nSource file: <source_file>\nFile name hint: ShortcutThemeHooks.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\shortcut\\Hook;\n\nuse Drupal\\Component\\Render\\FormattableMarkup;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Extension\\ThemeSettingsProvider;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for shortcut.\n */\nclass ShortcutThemeHooks {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly ThemeSettingsProvider $themeSettingsProvider,\n  ) {}\n\n  /**\n   * Implements hook_preprocess_HOOK() for block templates.\n   */\n  #[Hook('preprocess_block')]\n  public function preprocessBlock(&$variables): void {\n    if ($variables['configuration']['provider'] == 'shortcut') {\n      $variables['attributes']['role'] = 'navigation';\n    }\n  }\n\n  /**\n   * Implements hook_preprocess_HOOK() for page title templates.\n   */\n  #[Hook('preprocess_page_title')]\n  public function preprocessPageTitle(&$variables): void {\n    // Only display the shortcut link if the user has the ability to edit\n    // shortcuts, the feature is enabled for the current theme and if the\n    // page's actual content is being shown (for example, we do not want to\n    // display it on \"access denied\" or \"page not found\" pages).\n    if (shortcut_set_edit_access()->isAllowed() && $this->themeSettingsProvider->getSetting('third_party_settings.shortcut.module_link') && !\\Drupal::request()->attributes->has('exception')) {\n      $link = Url::fromRouteMatch(\\Drupal::routeMatch())->getInternalPath();\n      $route_match = \\Drupal::routeMatch();\n      // Replicate template_preprocess_html()'s processing to get the title in\n      // string form, so we can set the default name for the shortcut.\n      $name = $variables['title'] ?? '';\n      if (is_array($name)) {\n        $name = \\Drupal::service('renderer')->render($name);\n      }\n      $query = [\n        'link' => $link,\n        'name' => trim(strip_tags($name)),\n      ];\n      $shortcut_set = \\Drupal::entityTypeManager()->getStorage('shortcut_set')->getDisplayedToUser(\\Drupal::currentUser());\n      // Pages with the add or remove shortcut button need cache invalidation\n      // when a shortcut is added, edited, or removed.\n      $cacheability_metadata = CacheableMetadata::createFromRenderArray($variables);\n      $cacheability_metadata->addCacheTags(\\Drupal::entityTypeManager()->getDefinition('shortcut')->getListCacheTags());\n      $cacheability_metadata->applyTo($variables);\n      // Check if $link is already a shortcut and set $link_mode accordingly.\n      $shortcuts = \\Drupal::entityTypeManager()->getStorage('shortcut')->loadByProperties([\n        'shortcut_set' => $shortcut_set->id(),\n      ]);\n      /** @var \\Drupal\\shortcut\\ShortcutInterface $shortcut */\n      foreach ($shortcuts as $shortcut) {\n        if (($shortcut_url = $shortcut->getUrl()) && $shortcut_url->isRouted() && $shortcut_url->getRouteName() == $route_match->getRouteName() && $shortcut_url->getRouteParameters() == $route_match->getRawParameters()->all()) {\n          $shortcut_id = $shortcut->id();\n          break;\n        }\n      }\n      $link_mode = isset($shortcut_id) ? \"remove\" : \"add\";\n      if ($link_mode == \"add\") {\n        $link_text = shortcut_set_switch_access()->isAllowed() ? $this->t('Add to %shortcut_set shortcuts', [\n          '%shortcut_set' => $shortcut_set->label(),\n        ]) : $this->t('Add to shortcuts');\n        $route_name = 'shortcut.link_add_inline';\n        $route_parameters = [\n          'shortcut_set' => $shortcut_set->id(),\n        ];\n      }\n      else {\n        $query['id'] = $shortcut_id;\n        $link_text = shortcut_set_switch_access()->isAllowed() ? $this->t('Remove from %shortcut_set shortcuts', [\n          '%shortcut_set' => $shortcut_set->label(),\n        ]) : $this->t('Remove from shortcuts');\n        $route_name = 'entity.shortcut.link_delete_inline';\n        $route_parameters = [\n          'shortcut' => $shortcut_id,\n        ];\n      }\n      $query += \\Drupal::destination()->getAsArray();\n      $variables['title_suffix']['add_or_remove_shortcut'] = [\n        '#attached' => [\n          'library' => [\n            'shortcut/drupal.shortcut',\n          ],\n        ],\n        '#type' => 'link',\n        '#title' => new FormattableMarkup('<span class=\"shortcut-action__icon\"></span><span class=\"shortcut-action__message\">@text</span>', [\n          '@text' => $link_text,\n        ]),\n        '#url' => Url::fromRoute($route_name, $route_parameters),\n        '#options' => [\n          'query' => $query,\n        ],\n        '#attributes' => [\n          'class' => [\n            'shortcut-action',\n            'shortcut-action--' . $link_mode,\n          ],\n        ],\n      ];\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\shortcut\\Hook;\n\nuse Drupal\\Component\\Render\\FormattableMarkup;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Extension\\ThemeSettingsProvider;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for shortcut.\n */\nclass ShortcutThemeHooks {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly ThemeSettingsProvider $themeSettingsProvider,\n  ) {}\n\n  /**\n   * Implements hook_preprocess_HOOK() for block templates.\n   */\n  #[Hook('preprocess_block')]\n  public function preprocessBlock(&$variables): void {\n    if ($variables['configuration']['provider'] == 'shortcut') {\n      $variables['attributes']['role'] = 'navigation';\n    }\n  }\n\n  /**\n   * Implements hook_preprocess_HOOK() for page title templates.\n   */\n  #[Hook('preprocess_page_title')]\n  public function preprocessPageTitle(&$variables): void {\n    // Only display the shortcut link if the user has the ability to edit\n    // shortcuts, the feature is enabled for the current theme and if the\n    // page's actual content is being shown (for example, we do not want to\n    // display it on \"access denied\" or \"page not found\" pages).\n    if (shortcut_set_edit_access()->isAllowed() && $this->themeSettingsProvider->getSetting('third_party_settings.shortcut.module_link') && !\\Drupal::request()->attributes->has('exception')) {\n      $link = Url::fromRouteMatch(\\Drupal::routeMatch())->getInternalPath();\n      $route_match = \\Drupal::routeMatch();\n      // Replicate template_preprocess_html()'s processing to get the title in\n      // string form, so we can set the default name for the shortcut.\n      $name = $variables['title'] ?? '';\n      if (is_array($name)) {\n        $name = \\Drupal::service('renderer')->render($name);\n      }\n      $query = [\n        'link' => $link,\n        'name' => trim(strip_tags($name)),\n      ];\n      $shortcut_set = \\Drupal::entityTypeManager()->getStorage('shortcut_set')->getDisplayedToUser(\\Drupal::currentUser());\n      // Pages with the add or remove shortcut button need cache invalidation\n      // when a shortcut is added, edited, or removed.\n      $cacheability_metadata = CacheableMetadata::createFromRenderArray($variables);\n      $cacheability_metadata->addCacheTags(\\Drupal::entityTypeManager()->getDefinition('shortcut')->getListCacheTags());\n      $cacheability_metadata->applyTo($variables);\n      // Check if $link is already a shortcut and set $link_mode accordingly.\n      $shortcuts = \\Drupal::entityTypeManager()->getStorage('shortcut')->loadByProperties([\n        'shortcut_set' => $shortcut_set->id(),\n      ]);\n      /** @var \\Drupal\\shortcut\\ShortcutInterface $shortcut */\n      foreach ($shortcuts as $shortcut) {\n        if (($shortcut_url = $shortcut->getUrl()) && $shortcut_url->isRouted() && $shortcut_url->getRouteName() == $route_match->getRouteName() && $shortcut_url->getRouteParameters() == $route_match->getRawParameters()->all()) {\n          $shortcut_id = $shortcut->id();\n          break;\n        }\n      }\n      $link_mode = isset($shortcut_id) ? \"remove\" : \"add\";\n      if ($link_mode == \"add\") {\n        $link_text = shortcut_set_switch_access()->isAllowed() ? $this->t('Add to %shortcut_set shortcuts', [\n          '%shortcut_set' => $shortcut_set->label(),\n        ]) : $this->t('Add to shortcuts');\n        $route_name = 'shortcut.link_add_inline';\n        $route_parameters = [\n          'shortcut_set' => $shortcut_set->id(),\n        ];\n      }\n      else {\n        $query['id'] = $shortcut_id;\n        $link_text = shortcut_set_switch_access()->isAllowed() ? $this->t('Remove from %shortcut_set shortcuts', [\n          '%shortcut_set' => $shortcut_set->label(),\n        ]) : $this->t('Remove from shortcuts');\n        $route_name = 'entity.shortcut.link_delete_inline';\n        $route_parameters = [\n          'shortcut' => $shortcut_id,\n        ];\n      }\n      $query += \\Drupal::destination()->getAsArray();\n      $variables['title_suffix']['add_or_remove_shortcut'] = [\n        '#attached' => [\n          'library' => [\n            'shortcut/drupal.shortcut',\n          ],\n        ],\n        '#type' => 'link',\n        '#title' => new FormattableMarkup('<span class=\"shortcut-action__icon\"></span><span class=\"shortcut-action__message\">@text</span>', [\n          '@text' => $link_text,\n        ]),\n        '#url' => Url::fromRoute($route_name, $route_parameters),\n        '#options' => [\n          'query' => $query,\n        ],\n        '#attributes' => [\n          'class' => [\n            'shortcut-action',\n            'shortcut-action--' . $link_mode,\n          ],\n        ],\n      ];\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/src/Hook/ShortcutThemeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ShortcutThemeHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Role.php\nTarget symbol: class Role\nNamespace: Drupal\\user\\Plugin\\views\\access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Role.\n- Include required imports:\n  - Drupal\\Component\\Utility\\Html\n  - Drupal\\Core\\Cache\\Cache\n  - Drupal\\Core\\Cache\\CacheableDependencyInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\user\\RoleInterface\n  - Drupal\\user\\RoleStorageInterface\n  - Drupal\\views\\Attribute\\ViewsAccess\n- Ensure these methods exist where relevant:\n  - __construct()\n  - access()\n  - alterRouteDefinition()\n  - buildOptionsForm()\n  - calculateDependencies()\n  - create()\n  - defineOptions()\n  - getCacheContexts()\n  - getCacheMaxAge()\n  - getCacheTags()\n  - summaryTitle()\n  - validateOptionsForm()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\user\\Plugin\\views\\access;\n\nuse Drupal\\Component\\Utility\\Html;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\user\\RoleInterface;\nuse Drupal\\user\\RoleStorageInterface;\nuse Drupal\\views\\Attribute\\ViewsAccess;\nuse Drupal\\views\\Plugin\\views\\access\\AccessPluginBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Routing\\Route;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Access plugin that provides role-based access control.\n *\n * @ingroup views_access_plugins\n */\n#[ViewsAccess(\n  id: 'role',\n  title: new TranslatableMarkup('Role'),\n  help: new TranslatableMarkup('Access will be granted to users with any of the specified roles.'),\n)]\nclass Role extends AccessPluginBase implements CacheableDependencyInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesOptions = TRUE;\n\n  /**\n   * The role storage.\n   *\n   * @var \\Drupal\\user\\RoleStorageInterface\n   */\n  protected $roleStorage;\n\n  /**\n   * Constructs a Role object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\user\\RoleStorageInterface $role_storage\n   *   The role storage.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, RoleStorageInterface $role_storage) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->roleStorage = $role_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('entity_type.manager')->getStorage('user_role')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function access(AccountInterface $account) {\n    return !empty(array_intersect(array_filter($this->options['role']), $account->getRoles()));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alterRouteDefinition(Route $route) {\n    if ($this->options['role']) {\n      $route->setRequirement('_role', (string) implode('+', $this->options['role']));\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    $count = count($this->options['role']);\n    if ($count < 1) {\n      return $this->t('No role(s) selected');\n    }\n    elseif ($count > 1) {\n      return $this->t('Multiple roles');\n    }\n    else {\n      $rid = reset($this->options['role']);\n      return $this->roleStorage->load($rid)->label();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['role'] = ['default' => []];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['role'] = [\n      '#type' => 'checkboxes',\n      '#title' => $this->t('Role'),\n      '#default_value' => $this->options['role'],\n      '#options' => array_map(fn(RoleInterface $role) => Html::escape($role->label()), $this->roleStorage->loadMultiple()),\n      '#description' => $this->t('Only the checked roles will be able to access this display.'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateOptionsForm(&$form, FormStateInterface $form_state) {\n    $role = $form_state->getValue(['access_options', 'role']);\n    $role = array_filter($role);\n\n    if (!$role) {\n      $form_state->setError($form['role'], $this->t('You must select at least one role if type is \"by role\"'));\n    }\n\n    $form_state->setValue(['access_options', 'role'], $role);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    $dependencies = parent::calculateDependencies();\n\n    foreach (array_keys($this->options['role']) as $rid) {\n      if ($role = $this->roleStorage->load($rid)) {\n        $dependencies[$role->getConfigDependencyKey()][] = $role->getConfigDependencyName();\n      }\n    }\n\n    return $dependencies;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheMaxAge() {\n    return Cache::PERMANENT;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    return ['user.roles'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheTags() {\n    return [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/views/access/Role.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Role", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface ConditionInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Query;\n\n/**\n * Defines the entity query condition interface.\n */\ninterface ConditionInterface {\n\n  /**\n   * Gets the current conjunction.\n   *\n   * @return string\n   *   Can be AND or OR.\n   */\n  public function getConjunction();\n\n  /**\n   * Implements \\Countable::count().\n   *\n   * Returns the size of this conditional. The size of the conditional is the\n   * size of its conditional array.\n   */\n  public function count();\n\n  /**\n   * Adds a condition.\n   *\n   * @param string|\\Drupal\\Core\\Entity\\Query\\ConditionInterface $field\n   *   The field.\n   * @param mixed $value\n   *   (optional) The value.\n   * @param string $operator\n   *   (optional) The operator.\n   * @param string $langcode\n   *   (optional) For which language the entity should be prepared, defaults to\n   *   the current content language.\n   *\n   * @return $this\n   *\n   * @see \\Drupal\\Core\\Entity\\Query\\QueryInterface::condition()\n   */\n  public function condition($field, $value = NULL, $operator = NULL, $langcode = NULL);\n\n  /**\n   * Queries for the existence of a field.\n   *\n   * @param string $field\n   *   The field to query for existence.\n   * @param string $langcode\n   *   (optional) For which language the entity should be prepared, defaults to\n   *   the current content language.\n   *\n   * @return $this\n   *\n   * @see \\Drupal\\Core\\Entity\\Query\\QueryInterface::exists()\n   */\n  public function exists($field, $langcode = NULL);\n\n  /**\n   * Queries for the nonexistence of a field.\n   *\n   * @param string $field\n   *   The field to query for nonexistence.\n   * @param string $langcode\n   *   (optional) For which language the entity should be prepared, defaults to\n   *   the current content language.\n   *\n   * @return $this\n   *\n   * @see \\Drupal\\Core\\Entity\\Query\\QueryInterface::notExists()\n   */\n  public function notExists($field, $langcode = NULL);\n\n  /**\n   * Gets a complete list of all conditions in this conditional clause.\n   *\n   * This method returns by reference. That allows alter hooks to access the\n   * data structure directly and manipulate it before it gets compiled.\n   *\n   * @return array\n   *   An array of all conditions in this conditional clause.\n   */\n  public function &conditions();\n\n  /**\n   * Compiles this conditional clause.\n   *\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryInterface $query\n   *   The query object this conditional clause belongs to.\n   */\n  public function compile($query);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Query/ConditionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConditionInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: BlockBase.php", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# BlockBase.php\n\nSame filename and directory in other branches\n\n1. [10 core/lib/Drupal/Core/Block/BlockBase.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21BlockBase.php/10)\n2. [9 core/lib/Drupal/Core/Block/BlockBase.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21BlockBase.php/9)\n3. [8.9.x core/lib/Drupal/Core/Block/BlockBase.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21BlockBase.php/8.9.x)\n\n### Namespace\n\n[Drupal\\Core\\Block](/api/drupal/namespace/Drupal%21Core%21Block/11.x)\n\n### File\n\n[View on git.drupalcode.org](https://git.drupalcode.org/project/drupal/-/blob/11.x/core/lib/Drupal/Core/Block/BlockBase.php)\n\ncore/lib/Drupal/Core/Block/[BlockBase.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21BlockBase.php/11.x)\n\nView source\n\n```\n<?php\n\nnamespace Drupal\\Core\\Block;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginAssignmentTrait;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginTrait;\nuse Drupal\\Core\\Plugin\\PluginBase;\nuse Drupal\\Core\\Plugin\\PluginWithFormsInterface;\nuse Drupal\\Core\\Plugin\\PreviewAwarePluginInterface;\nuse Drupal\\Core\\Render\\PreviewFallbackInterface;\n\n/**\n * Defines a base block implementation that most blocks plugins will extend.\n *\n * This abstract class provides the generic block configuration form, default\n * block settings, and handling for general user-defined block visibility\n * settings.\n *\n * @ingroup block_api\n */\nabstract class BlockBase extends PluginBase implements BlockPluginInterface, PluginWithFormsInterface, PreviewAwarePluginInterface, PreviewFallbackInterface, ContextAwarePluginInterface {\n  use BlockPluginTrait {\n    buildConfigurationForm as traitBuildConfigurationForm;\n    submitConfigurationForm as traitSubmitConfigurationForm;\n  }\n  use ContextAwarePluginTrait;\n  use ContextAwarePluginAssignmentTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state) {\n    $form = $this->traitBuildConfigurationForm($form, $form_state);\n    // Add context mapping UI form elements.\n    $contexts = $form_state->getTemporaryValue('gathered_contexts') ?: [];\n    $form['context_mapping'] = $this->addContextAssignmentElement($this, $contexts);\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state) {\n    if (!$form_state->getErrors() && $form_state->getValue('context_mapping')) {\n      $this->configuration['context_mapping'] = $form_state->getValue('context_mapping');\n    }\n    $this->traitSubmitConfigurationForm($form, $form_state);\n  }\n\n}\n```\n\n### Classes\n\n| Title | Deprecated | Summary |\n| --- | --- | --- |\n| [BlockBase](/api/drupal/core%21lib%21Drupal%21Core%21Block%21BlockBase.php/class/BlockBase/11.x) |  | Defines a base block implementation that most blocks plugins will extend. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Block%2521BlockBase.php/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21lib%21Drupal%21Core%21Block%21BlockBase.php/11.x.md", "type": "doc_summary", "topic": "BlockBase.php"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SpecialAttributesRouteSubscriber.php\nTarget symbol: class SpecialAttributesRouteSubscriber\nNamespace: Drupal\\Core\\EventSubscriber\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SpecialAttributesRouteSubscriber.\n- Include required imports:\n  - Drupal\\Core\\Routing\\RouteBuildEvent\n  - Drupal\\Core\\Routing\\RouteSubscriberBase\n  - Drupal\\Core\\Routing\\RouteObjectInterface\n  - Symfony\\Component\\Routing\\RouteCollection\n- Ensure these methods exist where relevant:\n  - alterRoutes()\n  - onAlterRoutes()", "output": "<?php\n\nnamespace Drupal\\Core\\EventSubscriber;\n\nuse Drupal\\Core\\Routing\\RouteBuildEvent;\nuse Drupal\\Core\\Routing\\RouteSubscriberBase;\nuse Drupal\\Core\\Routing\\RouteObjectInterface;\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Provides a route subscriber which checks for invalid pattern variables.\n */\nclass SpecialAttributesRouteSubscriber extends RouteSubscriberBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function alterRoutes(RouteCollection $collection) {\n    $special_variables = [\n      'system_path',\n      '_legacy',\n      '_raw_variables',\n      RouteObjectInterface::ROUTE_OBJECT,\n      RouteObjectInterface::ROUTE_NAME,\n      '_content',\n      RouteObjectInterface::CONTROLLER_NAME,\n      '_form',\n    ];\n    foreach ($collection->all() as $name => $route) {\n      if ($not_allowed_variables = array_intersect($route->compile()->getVariables(), $special_variables)) {\n        $reserved = implode(', ', $not_allowed_variables);\n        throw new \\InvalidArgumentException(sprintf('Route %s uses reserved variable names: %s', $name, $reserved));\n      }\n    }\n  }\n\n  /**\n   * Delegates the route altering to self::alterRoutes().\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteBuildEvent $event\n   *   The route build event.\n   */\n  public function onAlterRoutes(RouteBuildEvent $event) {\n    $collection = $event->getRouteCollection();\n    $this->alterRoutes($collection);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/EventSubscriber/SpecialAttributesRouteSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SpecialAttributesRouteSubscriber", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: CacheContextInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Cache\\Context;\n\n/**\n * Provides an interface for defining a cache context service.\n */\ninterface CacheContextInterface {\n\n  /**\n   * Returns the label of the cache context.\n   *\n   * @return string\n   *   The label of the cache context.\n   */\n  public static function getLabel();\n\n  /**\n   * Returns the string representation of the cache context.\n   *\n   * A cache context service's name is used as a token (placeholder) cache key,\n   * and is then replaced with the string returned by this method.\n   *\n   * @return string\n   *   The string representation of the cache context.\n   */\n  public function getContext();\n\n  /**\n   * Gets the cacheability metadata for the context.\n   *\n   * There are three valid cases for the returned CacheableMetadata object:\n   * - An empty object means this can be optimized away safely.\n   * - A max-age of 0 means that this context can never be optimized away. It\n   *   will never bubble up and cache tags will not be used.\n   * - Any non-zero max-age and cache tags will bubble up into the cache item\n   *   if this is optimized away to allow for invalidation if the context\n   *   value changes.\n   *\n   * @return \\Drupal\\Core\\Cache\\CacheableMetadata\n   *   A cacheable metadata object.\n   */\n  public function getCacheableMetadata();\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Cache\\Context;\n\n/**\n * Provides an interface for defining a cache context service.\n */\ninterface CacheContextInterface {\n\n  /**\n   * Returns the label of the cache context.\n   *\n   * @return string\n   *   The label of the cache context.\n   */\n  public static function getLabel();\n\n  /**\n   * Returns the string representation of the cache context.\n   *\n   * A cache context service's name is used as a token (placeholder) cache key,\n   * and is then replaced with the string returned by this method.\n   *\n   * @return string\n   *   The string representation of the cache context.\n   */\n  public function getContext();\n\n  /**\n   * Gets the cacheability metadata for the context.\n   *\n   * There are three valid cases for the returned CacheableMetadata object:\n   * - An empty object means this can be optimized away safely.\n   * - A max-age of 0 means that this context can never be optimized away. It\n   *   will never bubble up and cache tags will not be used.\n   * - Any non-zero max-age and cache tags will bubble up into the cache item\n   *   if this is optimized away to allow for invalidation if the context\n   *   value changes.\n   *\n   * @return \\Drupal\\Core\\Cache\\CacheableMetadata\n   *   A cacheable metadata object.\n   */\n  public function getCacheableMetadata();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/Context/CacheContextInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CacheContextInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class SodiumKeyPairException in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\Sodium\\Exception;\n\n/**\n * Base exception for sodium key pair repository failures.\n *\n * All exceptions thrown by SodiumKeyPairRepositoryInterface\n * implementations SHOULD extend this class so that callers can\n * catch and handle repository errors in a generic way.\n */\nclass SodiumKeyPairException extends \\RuntimeException {\n\n  /**\n   * Creates an exception for a key pair that was not found.\n   *\n   * @param string $id\n   *   The key pair identifier.\n   *\n   * @return self\n   *   The exception instance.\n   */\n  public static function notFound(string $id): self {\n    return new self(sprintf('Sodium key pair \"%s\" not found.', $id));\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/Sodium/Exception/SodiumKeyPairException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SodiumKeyPairException", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ConfigAnalysisService in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools\\Service;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\StorageInterface;\nuse Drupal\\Core\\Config\\StorageComparer;\n\n/**\n * Service for analyzing configuration.\n */\nclass ConfigAnalysisService {\n\n  public function __construct(\n    protected ConfigFactoryInterface $configFactory,\n    protected StorageInterface $activeStorage,\n    protected StorageInterface $syncStorage,\n  ) {}\n\n  /**\n   * Get configuration sync status.\n   *\n   * @return array\n   *   Configuration sync status data.\n   */\n  public function getConfigStatus(): array {\n    try {\n      $storageComparer = new StorageComparer(\n        $this->syncStorage,\n        $this->activeStorage\n      );\n\n      $hasChanges = $storageComparer->createChangelist()->hasChanges();\n      $changelist = [];\n\n      if ($hasChanges) {\n        foreach ($storageComparer->getAllCollectionNames() as $collection) {\n          foreach (['create', 'update', 'delete', 'rename'] as $op) {\n            $changes = $storageComparer->getChangelist($op, $collection);\n            if (!empty($changes)) {\n              foreach ($changes as $name) {\n                $changelist[] = [\n                  'name' => $name,\n                  'operation' => $op,\n                  'collection' => $collection,\n                ];\n              }\n            }\n          }\n        }\n      }\n\n      return [\n        'has_changes' => $hasChanges,\n        'total_changes' => count($changelist),\n        'changes' => $changelist,\n        'sync_directory_exists' => !empty($this->syncStorage->listAll()),\n      ];\n    }\n    catch (\\Exception $e) {\n      return [\n        'error' => 'Unable to compare configuration: ' . $e->getMessage(),\n        'has_changes' => FALSE,\n      ];\n    }\n  }\n\n  /**\n   * Get a specific configuration object.\n   *\n   * @param string $name\n   *   Configuration name (e.g., 'system.site').\n   *\n   * @return array\n   *   Configuration data.\n   */\n  public function getConfig(string $name): array {\n    $config = $this->configFactory->get($name);\n\n    if ($config->isNew()) {\n      return [\n        'error' => \"Configuration '$name' does not exist.\",\n      ];\n    }\n\n    $data = $config->getRawData();\n\n    // SECURITY: Avoid leaking secrets by default.\n    // Allow full output only when explicitly enabled in settings.\n    $settings = $this->configFactory->get('mcp_tools.settings');\n    $includeSensitive = (bool) ($settings->get('output.include_sensitive') ?? FALSE);\n    if (!$includeSensitive) {\n      $data = $this->sanitizeConfigData($data);\n    }\n\n    return [\n      'name' => $name,\n      'data' => $data,\n    ];\n  }\n\n  /**\n   * Redact sensitive keys from configuration arrays.\n   *\n   * @param array $data\n   *   Raw configuration data.\n   *\n   * @return array\n   *   Sanitized configuration data.\n   */\n  protected function sanitizeConfigData(array $data): array {\n    $sensitiveKeys = [\n      'password',\n      'pass',\n      'secret',\n      'token',\n      'key',\n      'credential',\n      'credentials',\n      'api_key',\n      'apikey',\n      'client_secret',\n      'private',\n    ];\n\n    $sanitized = $data;\n    array_walk_recursive($sanitized, function (&$value, $key) use ($sensitiveKeys) {\n      foreach ($sensitiveKeys as $sensitiveKey) {\n        if (stripos((string) $key, $sensitiveKey) !== FALSE) {\n          $value = '[REDACTED]';\n          return;\n        }\n      }\n    });\n\n    return $sanitized;\n  }\n\n  /**\n   * List all configuration names.\n   *\n   * @param string|null $prefix\n   *   Optional prefix filter (e.g., 'system.' or 'node.type.').\n   *\n   * @return array\n   *   List of configuration names.\n   */\n  public function listConfig(?string $prefix = NULL): array {\n    $names = $this->activeStorage->listAll($prefix ?? '');\n\n    return [\n      'prefix' => $prefix,\n      'total' => count($names),\n      'names' => $names,\n    ];\n  }\n\n  /**\n   * Get configuration overrides.\n   *\n   * @return array\n   *   List of overridden configuration.\n   */\n  public function getOverrides(): array {\n    $overrides = [];\n\n    // Check common configuration that might be overridden.\n    $configsToCheck = [\n      'system.site',\n      'system.performance',\n      'system.logging',\n      'system.mail',\n    ];\n\n    foreach ($configsToCheck as $name) {\n      $config = $this->configFactory->get($name);\n      if ($config->hasOverrides()) {\n        $overrides[] = [\n          'name' => $name,\n          'has_overrides' => TRUE,\n        ];\n      }\n    }\n\n    return [\n      'total_checked' => count($configsToCheck),\n      'overridden_count' => count($overrides),\n      'overridden' => $overrides,\n      'note' => 'Only common configurations are checked. Use $settings or $config overrides in settings.php.',\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/mcp_tools/src/Service/ConfigAnalysisService.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigAnalysisService", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ListLayoutPlugins\nSource file: <source_file>\nFile name hint: ListLayoutPlugins.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_layout_builder\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_layout_builder\\Service\\LayoutBuilderService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_layout_list_plugins',\n  label: new TranslatableMarkup('List Layout Plugins'),\n  description: new TranslatableMarkup('List available layout plugins (one-column, two-column, etc.).'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'layouts' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Available Layouts'),\n      description: new TranslatableMarkup(''),\n    ),\n    'count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Count'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListLayoutPlugins extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'layout_builder';\n\n\n  protected LayoutBuilderService $layoutBuilderService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->layoutBuilderService = $container->get('mcp_tools_layout_builder.layout_builder');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    return $this->layoutBuilderService->listLayoutPlugins();\n  }\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_layout_builder\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_layout_builder\\Service\\LayoutBuilderService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_layout_list_plugins',\n  label: new TranslatableMarkup('List Layout Plugins'),\n  description: new TranslatableMarkup('List available layout plugins (one-column, two-column, etc.).'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'layouts' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Available Layouts'),\n      description: new TranslatableMarkup(''),\n    ),\n    'count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Count'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListLayoutPlugins extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'layout_builder';\n\n\n  protected LayoutBuilderService $layoutBuilderService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->layoutBuilderService = $container->get('mcp_tools_layout_builder.layout_builder');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    return $this->layoutBuilderService->listLayoutPlugins();\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_layout_builder/src/Plugin/tool/Tool/ListLayoutPlugins.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListLayoutPlugins", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "include:\n  - project: $_GITLAB_TEMPLATES_REPO\n    ref: $_GITLAB_TEMPLATES_REF\n    file:\n      - '/includes/include.drupalci.main.yml'\n      - '/includes/include.drupalci.variables.yml'\n      - '/includes/include.drupalci.workflows.yml'\n", "metadata": {"source": "repos/nexi_xpay/.gitlab-ci.yml", "type": "yaml_reference", "topic": ".gitlab-ci"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "jsonapi.settings:\n  title: 'JSON:API'\n  parent: system.admin_config_services\n  description: \"Configure whether to allow only read operations or all operations.\"\n  route_name: jsonapi.settings\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/jsonapi.links.menu.yml", "type": "yaml_reference", "topic": "jsonapi.links.menu"}}
{"instruction": "Show me the implementation of the class LayoutEntityDisplayNormalizer in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Normalizer;\n\nuse Drupal\\layout_builder\\Entity\\LayoutEntityDisplayInterface;\nuse Drupal\\serialization\\Normalizer\\ConfigEntityNormalizer;\n\n/**\n * Normalizes/denormalizes LayoutEntityDisplay objects into an array structure.\n *\n * @internal\n *   Tagged services are internal.\n */\nclass LayoutEntityDisplayNormalizer extends ConfigEntityNormalizer {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static function getDataWithoutInternals(array $data) {\n    $data = parent::getDataWithoutInternals($data);\n    // Do not expose the actual layout sections in normalization.\n    // @todo Determine what to expose here in\n    //   https://www.drupal.org/node/2942975.\n    unset($data['third_party_settings']['layout_builder']['sections']);\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      LayoutEntityDisplayInterface::class => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Normalizer/LayoutEntityDisplayNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutEntityDisplayNormalizer", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: ApiNormalizationServiceInterface\nSource file: <source_file>\nFile name hint: ApiNormalizationServiceInterface.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\api_normalization\\Service;\n\n/**\n * Interface for API normalization service.\n */\ninterface ApiNormalizationServiceInterface {\n\n  /**\n   * Normalizes an API request.\n   *\n   * @param array $request_data\n   *   The request data to normalize.\n   * @param string $provider\n   *   The API provider name.\n   *\n   * @return array\n   *   The normalized request data.\n   */\n  public function normalizeRequest(array $request_data, string $provider): array;\n\n  /**\n   * Normalizes an API response.\n   *\n   * @param array $response_data\n   *   The response data to normalize.\n   * @param string $provider\n   *   The API provider name.\n   *\n   * @return array\n   *   The normalized response data.\n   */\n  public function normalizeResponse(array $response_data, string $provider): array;\n\n  /**\n   * Logs an API request.\n   *\n   * @param array $request_data\n   *   The request data to log.\n   */\n  public function logRequest(array $request_data): void;\n\n  /**\n   * Validates API request against OpenAPI schema.\n   *\n   * @param array $request_data\n   *   The request data to validate.\n   * @param string $schema_id\n   *   The OpenAPI schema identifier.\n   *\n   * @return array\n   *   Validation result with success status and errors.\n   */\n  public function validateRequestSchema(array $request_data, string $schema_id): array;\n\n  /**\n   * Validates API response against OpenAPI schema.\n   *\n   * @param array $response_data\n   *   The response data to validate.\n   * @param string $schema_id\n   *   The OpenAPI schema identifier.\n   *\n   * @return array\n   *   Validation result with success status and errors.\n   */\n  public function validateResponseSchema(array $response_data, string $schema_id): array;\n\n  /**\n   * Gets OpenAPI 3.1 compliant schema for an endpoint.\n   *\n   * @param string $endpoint\n   *   The API endpoint path.\n   * @param string $method\n   *   The HTTP method.\n   *\n   * @return array|null\n   *   The OpenAPI schema or null if not found.\n   */\n  public function getOpenApiSchema(string $endpoint, string $method): ?array;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\n/**\n * Interface for API normalization service.\n */\ninterface ApiNormalizationServiceInterface {\n\n  /**\n   * Normalizes an API request.\n   *\n   * @param array $request_data\n   *   The request data to normalize.\n   * @param string $provider\n   *   The API provider name.\n   *\n   * @return array\n   *   The normalized request data.\n   */\n  public function normalizeRequest(array $request_data, string $provider): array;\n\n  /**\n   * Normalizes an API response.\n   *\n   * @param array $response_data\n   *   The response data to normalize.\n   * @param string $provider\n   *   The API provider name.\n   *\n   * @return array\n   *   The normalized response data.\n   */\n  public function normalizeResponse(array $response_data, string $provider): array;\n\n  /**\n   * Logs an API request.\n   *\n   * @param array $request_data\n   *   The request data to log.\n   */\n  public function logRequest(array $request_data): void;\n\n  /**\n   * Validates API request against OpenAPI schema.\n   *\n   * @param array $request_data\n   *   The request data to validate.\n   * @param string $schema_id\n   *   The OpenAPI schema identifier.\n   *\n   * @return array\n   *   Validation result with success status and errors.\n   */\n  public function validateRequestSchema(array $request_data, string $schema_id): array;\n\n  /**\n   * Validates API response against OpenAPI schema.\n   *\n   * @param array $response_data\n   *   The response data to validate.\n   * @param string $schema_id\n   *   The OpenAPI schema identifier.\n   *\n   * @return array\n   *   Validation result with success status and errors.\n   */\n  public function validateResponseSchema(array $response_data, string $schema_id): array;\n\n  /**\n   * Gets OpenAPI 3.1 compliant schema for an endpoint.\n   *\n   * @param string $endpoint\n   *   The API endpoint path.\n   * @param string $method\n   *   The HTTP method.\n   *\n   * @return array|null\n   *   The OpenAPI schema or null if not found.\n   */\n  public function getOpenApiSchema(string $endpoint, string $method): ?array;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/ApiNormalizationServiceInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ApiNormalizationServiceInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: SampleEntityGeneratorInterface\nSource file: <source_file>\nFile name hint: SampleEntityGeneratorInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\layout_builder\\Entity;\n\n/**\n * Generates a sample entity.\n */\ninterface SampleEntityGeneratorInterface {\n\n  /**\n   * Gets a sample entity for a given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string $bundle_id\n   *   The bundle ID.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityInterface\n   *   An entity.\n   */\n  public function get($entity_type_id, $bundle_id);\n\n  /**\n   * Deletes a sample entity for a given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string $bundle_id\n   *   The bundle ID.\n   *\n   * @return $this\n   */\n  public function delete($entity_type_id, $bundle_id);\n\n}", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Entity;\n\n/**\n * Generates a sample entity.\n */\ninterface SampleEntityGeneratorInterface {\n\n  /**\n   * Gets a sample entity for a given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string $bundle_id\n   *   The bundle ID.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityInterface\n   *   An entity.\n   */\n  public function get($entity_type_id, $bundle_id);\n\n  /**\n   * Deletes a sample entity for a given entity type and bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string $bundle_id\n   *   The bundle ID.\n   *\n   * @return $this\n   */\n  public function delete($entity_type_id, $bundle_id);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Entity/SampleEntityGeneratorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SampleEntityGeneratorInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FlowDropHooks\nSource file: <source_file>\nFile name hint: FlowDropHooks.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Routing\\RouteProviderInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\n\n/**\n * FlowDrop hooks implementation.\n */\nclass FlowDropHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Constructs a new FlowDropHooks object.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteProviderInterface $routeProvider\n   *   The route provider service.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $currentUser\n   *   The current user.\n   */\n  public function __construct(\n    protected readonly RouteProviderInterface $routeProvider,\n    protected readonly AccountProxyInterface $currentUser,\n  ) {}\n\n  /**\n   * Implements hook_flowdrop_node_processor_info_alter().\n   *\n   * @param array<string, mixed> $data\n   *   The processor info data.\n   */\n  #[Hook('flowdrop_node_processor_info_alter')]\n  public function flowdropNodeProcessorInfoAlter(array &$data): void {}\n\n  /**\n   * Implements hook_toolbar().\n   *\n   * Adds a FlowDrop item to the admin toolbar for quick access.\n   *\n   * @return array<string, mixed>\n   *   A render array for the toolbar item.\n   */\n  #[Hook('toolbar')]\n  public function toolbar(): array {\n    $items = [];\n\n    // Check if the dashboard route exists.\n    if (!$this->routeExists(\"flowdrop.dashboard\")) {\n      return $items;\n    }\n\n    $items[\"flowdrop\"] = [\n      \"#type\" => \"toolbar_item\",\n      \"#weight\" => 50,\n      \"#access\" => $this->currentUser->hasPermission('administer flowdrop'),\n      \"#cache\" => [\n        \"contexts\" => [\"user.permissions\"],\n      ],\n      \"tab\" => [\n        \"#type\" => \"link\",\n        \"#title\" => $this->t(\"FlowDrop\"),\n        \"#url\" => Url::fromRoute(\"flowdrop.dashboard\"),\n        \"#attributes\" => [\n          \"title\" => $this->t(\"FlowDrop workflow automation\"),\n          \"class\" => [\"toolbar-icon\", \"toolbar-icon-flowdrop\"],\n        ],\n      ],\n      \"#attached\" => [\n        \"library\" => [\n          \"flowdrop/toolbar\",\n        ],\n      ],\n    ];\n\n    return $items;\n  }\n\n  /**\n   * Checks if a route exists.\n   *\n   * @param string $routeName\n   *   The route name.\n   *\n   * @return bool\n   *   TRUE if the route exists, FALSE otherwise.\n   */\n  protected function routeExists(string $routeName): bool {\n    try {\n      $this->routeProvider->getRouteByName($routeName);\n      return TRUE;\n    }\n    catch (\\Exception $e) {\n      return FALSE;\n    }\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Routing\\RouteProviderInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\n\n/**\n * FlowDrop hooks implementation.\n */\nclass FlowDropHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Constructs a new FlowDropHooks object.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteProviderInterface $routeProvider\n   *   The route provider service.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $currentUser\n   *   The current user.\n   */\n  public function __construct(\n    protected readonly RouteProviderInterface $routeProvider,\n    protected readonly AccountProxyInterface $currentUser,\n  ) {}\n\n  /**\n   * Implements hook_flowdrop_node_processor_info_alter().\n   *\n   * @param array<string, mixed> $data\n   *   The processor info data.\n   */\n  #[Hook('flowdrop_node_processor_info_alter')]\n  public function flowdropNodeProcessorInfoAlter(array &$data): void {}\n\n  /**\n   * Implements hook_toolbar().\n   *\n   * Adds a FlowDrop item to the admin toolbar for quick access.\n   *\n   * @return array<string, mixed>\n   *   A render array for the toolbar item.\n   */\n  #[Hook('toolbar')]\n  public function toolbar(): array {\n    $items = [];\n\n    // Check if the dashboard route exists.\n    if (!$this->routeExists(\"flowdrop.dashboard\")) {\n      return $items;\n    }\n\n    $items[\"flowdrop\"] = [\n      \"#type\" => \"toolbar_item\",\n      \"#weight\" => 50,\n      \"#access\" => $this->currentUser->hasPermission('administer flowdrop'),\n      \"#cache\" => [\n        \"contexts\" => [\"user.permissions\"],\n      ],\n      \"tab\" => [\n        \"#type\" => \"link\",\n        \"#title\" => $this->t(\"FlowDrop\"),\n        \"#url\" => Url::fromRoute(\"flowdrop.dashboard\"),\n        \"#attributes\" => [\n          \"title\" => $this->t(\"FlowDrop workflow automation\"),\n          \"class\" => [\"toolbar-icon\", \"toolbar-icon-flowdrop\"],\n        ],\n      ],\n      \"#attached\" => [\n        \"library\" => [\n          \"flowdrop/toolbar\",\n        ],\n      ],\n    ];\n\n    return $items;\n  }\n\n  /**\n   * Checks if a route exists.\n   *\n   * @param string $routeName\n   *   The route name.\n   *\n   * @return bool\n   *   TRUE if the route exists, FALSE otherwise.\n   */\n  protected function routeExists(string $routeName): bool {\n    try {\n      $this->routeProvider->getRouteByName($routeName);\n      return TRUE;\n    }\n    catch (\\Exception $e) {\n      return FALSE;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/src/Hook/FlowDropHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class DrupalCmsHelperServiceProvider in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderBase;\nuse Drupal\\package_manager\\Validator\\AllowedScaffoldPackagesValidator;\nuse PhpTuf\\ComposerStager\\API\\Process\\Service\\ComposerProcessRunnerInterface;\nuse PhpTuf\\ComposerStager\\API\\Process\\Service\\RsyncProcessRunnerInterface;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * @internal\n *   This is an internal part of Drupal CMS and may be changed or removed at any\n *   time without warning. External code should not interact with this class.\n */\nfinal class DrupalCmsHelperServiceProvider extends ServiceProviderBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function register(ContainerBuilder $container): void {\n    parent::register($container);\n\n    $modules = $container->getParameter('container.modules');\n    if (isset($modules['package_manager'])) {\n      // Decorate the Composer and rsync runners to account for database idle\n      // timeouts.\n      // @todo Remove when drupal.org/i/3541137 is released.\n      $container->register('drupal_cms.composer_runner')\n        ->setClass(ProcessRunner::class)\n        ->setDecoratedService(ComposerProcessRunnerInterface::class)\n        ->setArguments([\n          new Reference('.inner'),\n          new Reference(Connection::class),\n        ]);\n\n      $container->register('drupal_cms.rsync_runner')\n        ->setClass(ProcessRunner::class)\n        ->setDecoratedService(RsyncProcessRunnerInterface::class)\n        ->setArguments([\n          new Reference('.inner'),\n          new Reference(Connection::class),\n        ]);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alter(ContainerBuilder $container): void {\n    parent::alter($container);\n\n    // @todo Remove when https://www.drupal.org/i/3564197 is released.\n    if ($container->hasDefinition(AllowedScaffoldPackagesValidator::class)) {\n      $container->getDefinition(AllowedScaffoldPackagesValidator::class)\n        ->clearTag('event_subscriber');\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/DrupalCmsHelperServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DrupalCmsHelperServiceProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: UseCacheBackendTrait.php\nTarget symbol: trait UseCacheBackendTrait\nNamespace: Drupal\\Core\\Cache\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete trait implementation for UseCacheBackendTrait.\n- Ensure these methods exist where relevant:\n  - cacheGet()\n  - cacheSet()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Cache;\n\n/**\n * Provides methods to use a cache backend while respecting a 'use caches' flag.\n */\ntrait UseCacheBackendTrait {\n\n  /**\n   * Cache backend instance.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   */\n  protected $cacheBackend;\n\n  /**\n   * Flag whether caches should be used or skipped.\n   *\n   * @var bool\n   */\n  protected $useCaches = TRUE;\n\n  /**\n   * Fetches from the cache backend, respecting the use caches flag.\n   *\n   * @param string $cid\n   *   The cache ID of the data to retrieve.\n   *\n   * @return object|false\n   *   The cache item or FALSE on failure.\n   *\n   * @see \\Drupal\\Core\\Cache\\CacheBackendInterface::get()\n   */\n  protected function cacheGet($cid) {\n    if ($this->useCaches && $this->cacheBackend) {\n      return $this->cacheBackend->get($cid);\n    }\n    return FALSE;\n  }\n\n  /**\n   * Stores data in the persistent cache, respecting the use caches flag.\n   *\n   * @param string $cid\n   *   The cache ID of the data to store.\n   * @param mixed $data\n   *   The data to store in the cache.\n   *   Some storage engines only allow objects up to a maximum of 1MB in size to\n   *   be stored by default. When caching large arrays or similar, take care to\n   *   ensure $data does not exceed this size.\n   * @param int $expire\n   *   One of the following values:\n   *   - CacheBackendInterface::CACHE_PERMANENT: Indicates that the item should\n   *     not be removed unless it is deleted explicitly.\n   *   - A Unix timestamp: Indicates that the item will be considered invalid\n   *     after this time, i.e. it will not be returned by get() unless\n   *     $allow_invalid has been set to TRUE. When the item has expired, it may\n   *     be permanently deleted by the garbage collector at any time.\n   * @param array $tags\n   *   An array of tags to be stored with the cache item. These should normally\n   *   identify objects used to build the cache item, which should trigger\n   *   cache invalidation when updated. For example if a cached item represents\n   *   a node, both the node ID and the author's user ID might be passed in as\n   *   tags. For example, ['node' => [123], 'user' => [92]].\n   *\n   * @see \\Drupal\\Core\\Cache\\CacheBackendInterface::set()\n   */\n  protected function cacheSet($cid, $data, $expire = Cache::PERMANENT, array $tags = []) {\n    if ($this->cacheBackend && $this->useCaches) {\n      $this->cacheBackend->set($cid, $data, $expire, $tags);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/UseCacheBackendTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "UseCacheBackendTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class PathLocator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\package_manager;\n\nuse Composer\\Autoload\\ClassLoader;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\File\\FileSystemInterface;\n\n/**\n * Computes file system paths that are needed to stage code changes.\n */\nclass PathLocator {\n\n  public function __construct(\n    protected string $appRoot,\n    protected ConfigFactoryInterface $configFactory,\n    protected FileSystemInterface $fileSystem,\n  ) {}\n\n  /**\n   * Returns the absolute path of the project root.\n   *\n   * This is where the project-level composer.json should normally be found, and\n   * may or may not be the same path as the Drupal code base.\n   *\n   * @return string\n   *   The absolute path of the project root.\n   */\n  public function getProjectRoot(): string {\n    // Assume that the vendor directory is immediately below the project root.\n    return realpath($this->getVendorDirectory() . DIRECTORY_SEPARATOR . '..');\n  }\n\n  /**\n   * Returns the absolute path of the vendor directory.\n   *\n   * @return string\n   *   The absolute path of the vendor directory.\n   */\n  public function getVendorDirectory(): string {\n    // There may be multiple class loaders at work.\n    // ClassLoader::getRegisteredLoaders() keeps track of them all, indexed by\n    // the path of the vendor directory they load classes from.\n    $loaders = ClassLoader::getRegisteredLoaders();\n\n    // If there's only one class loader, we don't need to search for the right\n    // one.\n    if (count($loaders) === 1) {\n      return key($loaders);\n    }\n\n    // To determine which class loader is the one for Drupal's vendor directory,\n    // look for the loader whose vendor path starts the same way as the path to\n    // this file.\n    foreach (array_keys($loaders) as $path) {\n      if (str_starts_with(__FILE__, dirname($path))) {\n        return $path;\n      }\n    }\n    // If we couldn't find a match, assume that the first registered class\n    // loader is the one we want.\n    return key($loaders);\n  }\n\n  /**\n   * Returns the path of the Drupal installation, relative to the project root.\n   *\n   * @return string\n   *   The path of the Drupal installation, relative to the project root and\n   *   without leading or trailing slashes. Will return an empty string if the\n   *   project root and Drupal root are the same.\n   */\n  public function getWebRoot(): string {\n    $web_root = str_replace(trim($this->getProjectRoot(), DIRECTORY_SEPARATOR), '', trim($this->appRoot, DIRECTORY_SEPARATOR));\n    return trim($web_root, DIRECTORY_SEPARATOR);\n  }\n\n  /**\n   * Returns the directory where stage directories will be created.\n   *\n   * The stage root may be affected by site settings, so stages may wish to\n   * cache the value returned by this method, to ensure that they use the same\n   * stage root directory throughout their life cycle.\n   *\n   * @return string\n   *   The absolute path of the directory where stage directories should be\n   *   created.\n   */\n  public function getStagingRoot(): string {\n    $site_id = $this->configFactory->get('system.site')->get('uuid');\n    return $this->fileSystem->getTempDirectory() . DIRECTORY_SEPARATOR . '.package_manager' . $site_id;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/package_manager/src/PathLocator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathLocator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface DynamicallyFieldableEntityStorageInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\Field\\FieldDefinitionListenerInterface;\nuse Drupal\\Core\\Field\\FieldStorageDefinitionListenerInterface;\n\n/**\n * A storage that supports entity types with dynamic field definitions.\n *\n * A storage that implements this interface can react to the entity type's field\n * definitions changing, due to modules being installed or uninstalled, or via\n * field UI, or via code changes to the entity class.\n *\n * For example, configurable fields defined and exposed by field.module.\n */\ninterface DynamicallyFieldableEntityStorageInterface extends FieldableEntityStorageInterface, FieldStorageDefinitionListenerInterface, FieldDefinitionListenerInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/DynamicallyFieldableEntityStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DynamicallyFieldableEntityStorageInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: comment.post_update\nSource file: <source_file>\nFile name hint: comment.post_update.php\nBroken snippet:\n<?php\n\n/**\n * @file\n * Post update functions for the comment module.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction comment_removed_post_updates(): array {\n  return [\n    'comment_post_update_enable_comment_admin_view' => '9.0.0',\n    'comment_post_update_add_ip_address_setting' => '9.0.0',\n  ];\n}\n// BUG: ensure this implementation follows Drupal 11 and PHP 8.3.", "output": "<?php\n\n/**\n * @file\n * Post update functions for the comment module.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction comment_removed_post_updates(): array {\n  return [\n    'comment_post_update_enable_comment_admin_view' => '9.0.0',\n    'comment_post_update_add_ip_address_setting' => '9.0.0',\n  ];\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/comment.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CommentPostUpdate", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class FieldItemDataDefinition in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\TypedData;\n\nuse Drupal\\Core\\Field\\BaseFieldDefinition;\nuse Drupal\\Core\\TypedData\\DataDefinition;\n\n/**\n * A typed data definition class for defining field items.\n *\n * This class is just a small wrapper around field definitions to expose\n * metadata about field item's via the Typed Data API. As the work is done\n * by the field definitions, this class does not benefit and thus does not\n * extend from MapDefinition or ComplexDataDefinitionBase.\n */\nclass FieldItemDataDefinition extends DataDefinition implements FieldItemDataDefinitionInterface {\n\n  /**\n   * The field definition the item definition belongs to.\n   *\n   * @var \\Drupal\\Core\\Field\\FieldDefinitionInterface\n   */\n  protected $fieldDefinition;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createFromDataType($data_type) {\n    // The data type of a field item is in the form of \"field_item:$field_type\".\n    $parts = explode(':', $data_type, 2);\n    if ($parts[0] != 'field_item') {\n      throw new \\InvalidArgumentException('Data type must be in the form of \"field_item:FIELD_TYPE\".');\n    }\n\n    $field_definition = BaseFieldDefinition::create($parts[1]);\n    return $field_definition->getItemDefinition();\n  }\n\n  /**\n   * Creates a new field item definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldDefinitionInterface $field_definition\n   *   The field definition the item definition belongs to.\n   *\n   * @return static\n   */\n  public static function create($field_definition) {\n    $definition['type'] = 'field_item:' . $field_definition->getType();\n    $item_definition = new static($definition);\n    $item_definition->fieldDefinition = $field_definition;\n    return $item_definition;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPropertyDefinition($name) {\n    return $this->fieldDefinition->getFieldStorageDefinition()->getPropertyDefinition($name);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPropertyDefinitions() {\n    return $this->fieldDefinition->getFieldStorageDefinition()->getPropertyDefinitions();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMainPropertyName() {\n    return $this->fieldDefinition->getFieldStorageDefinition()->getMainPropertyName();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFieldDefinition() {\n    return $this->fieldDefinition;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setFieldDefinition($field_definition) {\n    $this->fieldDefinition = $field_definition;\n    return $this;\n  }\n\n  /**\n   * Gets the label of the field type.\n   *\n   * If the label hasn't been set, then fall back to the label of the\n   * typed data definition.\n   *\n   * @return string\n   *   The label of the field type.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   */\n  public function getLabel() {\n    return parent::getLabel() ?: $this->getTypedDataManager()->getDefinition($this->getDataType())['label'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/TypedData/FieldItemDataDefinition.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldItemDataDefinition", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class NullBackend in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Cache;\n\n/**\n * Defines a stub cache implementation.\n *\n * The stub implementation is needed when database access is not yet available.\n * Because Drupal's caching system never requires that cached data be present,\n * these stub functions can short-circuit the process and sidestep the need for\n * any persistent storage. Using this cache implementation during normal\n * operations would have a negative impact on performance.\n *\n * This also can be used for testing purposes.\n *\n * @ingroup cache\n */\nclass NullBackend implements CacheBackendInterface {\n\n  /**\n   * Constructs a NullBackend object.\n   *\n   * @param string $bin\n   *   The cache bin for which the object is created.\n   */\n  public function __construct($bin) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get($cid, $allow_invalid = FALSE) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMultiple(&$cids, $allow_invalid = FALSE) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function set($cid, $data, $expire = Cache::PERMANENT, array $tags = []) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setMultiple(array $items = []) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete($cid) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteMultiple(array $cids) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteAll() {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function invalidate($cid) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function invalidateMultiple(array $cids) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function invalidateAll() {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function garbageCollection() {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function removeBin() {}\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/NullBackend.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NullBackend", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TenantEntityQueryAlterSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\EventSubscriber;\n\nuse Drupal\\api_normalization\\Service\\TenantContext;\nuse Drupal\\Core\\Database\\Query\\AlterableInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Event subscriber for applying tenant filtering to entity queries.\n *\n * This subscriber automatically filters entity queries to only return entities\n * belonging to the current tenant context, unless the user has bypass permission.\n *\n * @ingroup api_normalization\n */\nclass TenantEntityQueryAlterSubscriber implements EventSubscriberInterface {\n\n  /**\n   * The tenant context service.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\TenantContext\n   */\n  protected TenantContext $tenantContext;\n\n  /**\n   * Entity types that should be filtered by tenant.\n   *\n   * @var array\n   */\n  protected array $tenantAwareEntityTypes = [\n    'api_endpoint',\n    'openapi_schema',\n    'gateway_route',\n    'api_normalization_import_draft',\n  ];\n\n  /**\n   * Constructs a TenantEntityQueryAlterSubscriber.\n   *\n   * @param \\Drupal\\api_normalization\\Service\\TenantContext $tenant_context\n   *   The tenant context service.\n   */\n  public function __construct(TenantContext $tenant_context) {\n    $this->tenantContext = $tenant_context;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents() {\n    // This is just a placeholder - actual query altering happens via hook_query_alter.\n    return [];\n  }\n\n  /**\n   * Applies tenant filtering to a query.\n   *\n   * @param \\Drupal\\Core\\Database\\Query\\AlterableInterface $query\n   *   The query to alter.\n   */\n  public function applyTenantFilter(AlterableInterface $query): void {\n    // Get the entity type from query metadata.\n    $entity_type_id = $query->getMetaData('entity_type');\n\n    if (!$entity_type_id || !in_array($entity_type_id, $this->tenantAwareEntityTypes, TRUE)) {\n      return;\n    }\n\n    // Skip if admin bypass is enabled.\n    if ($this->tenantContext->isBypassEnabled()) {\n      return;\n    }\n\n    $current_tenant_id = $this->tenantContext->getCurrentTenantId();\n\n    if ($current_tenant_id) {\n      // Add tenant filter condition.\n      $tables = $query->getTables();\n      $base_table = NULL;\n\n      foreach ($tables as $table_info) {\n        if (isset($table_info['table']) && strpos($table_info['table'], $entity_type_id) !== FALSE) {\n          $base_table = $table_info['alias'] ?? $table_info['table'];\n          break;\n        }\n      }\n\n      if ($base_table) {\n        // For config entities, use id format, for content entities use reference.\n        if (in_array($entity_type_id, ['gateway_route', 'api_normalization_import_draft'], TRUE)) {\n          $query->condition(\"{$base_table}.tenant_id\", $current_tenant_id);\n        }\n        else {\n          // For content entities with entity_reference field.\n          $data_table = $entity_type_id === 'api_endpoint' ? 'api_endpoint_field_data' : \"{$entity_type_id}_field_data\";\n          $query->leftJoin($data_table, 'tenant_filter', \"{$base_table}.id = tenant_filter.id\");\n          $query->condition('tenant_filter.tenant_id', $current_tenant_id);\n        }\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/EventSubscriber/TenantEntityQueryAlterSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TenantEntityQueryAlterSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class JsonApiSecurityDepthCheckEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\jsonapi_security\\Event;\n\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event fired before depth validation on JSON:API requests.\n *\n * Allows custom logic to modify or bypass depth limits for specific requests.\n */\nclass JsonApiSecurityDepthCheckEvent extends Event {\n\n  /**\n   * The maximum allowed depth.\n   *\n   * @var int\n   */\n  protected int $maxDepth;\n\n  /**\n   * Whether to bypass the depth check entirely.\n   *\n   * @var bool\n   */\n  protected bool $bypass = FALSE;\n\n  /**\n   * Constructs a new JsonApiSecurityDepthCheckEvent.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   * @param string $resourceType\n   *   The JSON:API resource type being accessed.\n   * @param int $requestedDepth\n   *   The depth of the include parameter in the request.\n   * @param int $maxDepth\n   *   The configured maximum depth.\n   */\n  public function __construct(\n    protected readonly Request $request,\n    protected readonly string $resourceType,\n    protected readonly int $requestedDepth,\n    int $maxDepth,\n  ) {\n    $this->maxDepth = $maxDepth;\n  }\n\n  /**\n   * Gets the current request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\Request\n   *   The request object.\n   */\n  public function getRequest(): Request {\n    return $this->request;\n  }\n\n  /**\n   * Gets the resource type.\n   *\n   * @return string\n   *   The JSON:API resource type.\n   */\n  public function getResourceType(): string {\n    return $this->resourceType;\n  }\n\n  /**\n   * Gets the requested depth.\n   *\n   * @return int\n   *   The depth of includes in the request.\n   */\n  public function getRequestedDepth(): int {\n    return $this->requestedDepth;\n  }\n\n  /**\n   * Gets the maximum allowed depth.\n   *\n   * @return int\n   *   The max depth.\n   */\n  public function getMaxDepth(): int {\n    return $this->maxDepth;\n  }\n\n  /**\n   * Sets the maximum allowed depth.\n   *\n   * @param int $maxDepth\n   *   The new max depth.\n   */\n  public function setMaxDepth(int $maxDepth): void {\n    $this->maxDepth = $maxDepth;\n  }\n\n  /**\n   * Checks if the depth check should be bypassed.\n   *\n   * @return bool\n   *   TRUE if bypassed.\n   */\n  public function isBypassed(): bool {\n    return $this->bypass;\n  }\n\n  /**\n   * Sets whether to bypass the depth check.\n   *\n   * @param bool $bypass\n   *   Whether to bypass.\n   */\n  public function setBypass(bool $bypass): void {\n    $this->bypass = $bypass;\n  }\n\n}\n", "metadata": {"source": "repos/jsonapi_security/src/Event/JsonApiSecurityDepthCheckEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "JsonApiSecurityDepthCheckEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: EntityViewMode.php\nTarget symbol: class EntityViewMode\nNamespace: Drupal\\Core\\Entity\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for EntityViewMode.\n- Include required imports:\n  - Drupal\\Core\\Entity\\Attribute\\ConfigEntityType\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\Entity\\EntityDisplayModeBase\n  - Drupal\\Core\\Entity\\EntityViewModeInterface", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Entity\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ConfigEntityType;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Entity\\EntityDisplayModeBase;\nuse Drupal\\Core\\Entity\\EntityViewModeInterface;\n\n/**\n * Defines the entity view mode configuration entity class.\n *\n * View modes let entities be displayed differently depending on the context.\n * For instance, a node can be displayed differently on its own page ('full'\n * mode), on the home page or taxonomy listings ('teaser' mode), or in an RSS\n * feed ('rss' mode). Modules taking part in the display of the entity (notably\n * the Field API) can adjust their behavior depending on the requested view\n * mode. An additional 'default' view mode is available for all entity types.\n * This view mode is not intended for actual entity display, but holds default\n * display settings. For each available view mode, administrators can configure\n * whether it should use its own set of field display settings, or just\n * replicate the settings of the 'default' view mode, thus reducing the amount\n * of display configurations to keep track of.\n *\n * @see \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface::getAllViewModes()\n * @see \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface::getViewModes()\n * @see hook_entity_view_mode_info_alter()\n */\n#[ConfigEntityType(\n  id: 'entity_view_mode',\n  label: new TranslatableMarkup('View mode'),\n  entity_keys: [\n    'id' => 'id',\n    'label' => 'label',\n    'description' => 'description',\n  ],\n  constraints: [\n    'ImmutableProperties' => [\n      'properties' => [\n        'id',\n        'targetEntityType',\n      ],\n    ],\n  ],\n  config_export: [\n    'id',\n    'label',\n    'description',\n    'targetEntityType',\n    'cache',\n  ],\n  )]\nclass EntityViewMode extends EntityDisplayModeBase implements EntityViewModeInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Entity/EntityViewMode.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityViewMode", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ShortcutLinkTarget.php\nTarget symbol: class ShortcutLinkTarget\nNamespace: Drupal\\shortcut\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ShortcutLinkTarget.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityLinkTargetInterface\n  - Drupal\\Core\\GeneratedUrl\n  - Drupal\\shortcut\\ShortcutInterface\n- Ensure these methods exist where relevant:\n  - getLinkTarget()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\shortcut\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityLinkTargetInterface;\nuse Drupal\\Core\\GeneratedUrl;\nuse Drupal\\shortcut\\ShortcutInterface;\n\n/**\n * Provides a Shortcut link target handler.\n *\n * Shortcut entities are atypical because they describe a link to elsewhere and\n * don't have a canonical route to view them. So when linking to such an entity,\n * the link target must be their destination.\n *\n * @see \\Drupal\\shortcut\\ShortcutInterface::getUrl()\n */\nclass ShortcutLinkTarget implements EntityLinkTargetInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl {\n    assert($entity instanceof ShortcutInterface);\n    return $entity->getUrl()->toString(TRUE);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/src/Entity/ShortcutLinkTarget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ShortcutLinkTarget", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: function hook\\_block\\_access", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# function hook\\_block\\_access\n\nSame name and namespace in other branches\n\n1. [10 core/modules/block/block.api.php](/api/drupal/core%21modules%21block%21block.api.php/function/hook_block_access/10) \\hook\\_block\\_access()\n2. [9 core/modules/block/block.api.php](/api/drupal/core%21modules%21block%21block.api.php/function/hook_block_access/9) \\hook\\_block\\_access()\n3. [8.9.x core/modules/block/block.api.php](/api/drupal/core%21modules%21block%21block.api.php/function/hook_block_access/8.9.x) \\hook\\_block\\_access()\n\nControl access to a block instance.\n\nModules may implement this hook if they want to have a say in whether or not\na given user has access to perform a given operation on a block instance.\n\n### Parameters\n\n**[\\Drupal\\block\\Entity\\Block](/api/drupal/core%21modules%21block%21src%21Entity%21Block.php/class/Block/11.x \"Defines a Block configuration entity class.\") $block**:\nThe block instance.\n\n**string $operation**:\nThe operation to be performed; for instance, 'view', 'create', 'delete', or\n'update'.\n\n**[\\Drupal\\Core\\Session\\AccountInterface](/api/drupal/core%21lib%21Drupal%21Core%21Session%21AccountInterface.php/interface/AccountInterface/11.x \"Defines an account interface which represents the current user.\") $account**:\nThe user object to perform the access check operation on.\n\n### Return value\n\n[\\Drupal\\Core\\Access\\AccessResultInterface](/api/drupal/core%21lib%21Drupal%21Core%21Access%21AccessResultInterface.php/interface/AccessResultInterface/11.x \"Interface for access result value objects.\")\nThe access result. If all implementations of this hook return\nAccessResultInterface objects whose value is !isAllowed() and\n!isForbidden(), then default access rules from\n[\\Drupal\\block\\BlockAccessControlHandler::checkAccess](/api/drupal/core%21modules%21block%21src%21BlockAccessControlHandler.php/function/BlockAccessControlHandler%3A%3AcheckAccess/11.x \"Performs access checks.\")() are used.\n\n### See also\n\n[\\Drupal\\Core\\Entity\\EntityAccessControlHandler::access](/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityAccessControlHandler.php/function/EntityAccessControlHandler%3A%3Aaccess/11.x \"Checks access to an operation on a given entity or entity translation.\")()\n\n[\\Drupal\\block\\BlockAccessControlHandler::checkAccess](/api/drupal/core%21modules%21block%21src%21BlockAccessControlHandler.php/function/BlockAccessControlHandler%3A%3AcheckAccess/11.x \"Performs access checks.\")()\n\n### Related topics\n\n[Block API](/api/drupal/core%21modules%21block%21block.api.php/group/block_api/11.x)\n:   Information about the classes and interfaces that make up the Block API.\n\n[Hooks](/api/drupal/core%21core.api.php/group/hooks/11.x)\n:   Define functions that alter the behavior of Drupal core.\n\n### File\n\ncore/modules/block/[block.api.php](/api/drupal/core%21modules%21block%21block.api.php/11.x), line 236\n\n### Code\n\n```\nfunction hook_block_access(Block $block, $operation, AccountInterface $account) {\n  // Example code that would prevent displaying the 'Powered by Drupal' block in\n  // a region different than the footer.\n  if ($operation == 'view' && $block->getPluginId() == 'system_powered_by_block') {\n    return AccessResult::forbiddenIf($block->getRegion() != 'footer')\n      ->addCacheableDependency($block);\n  }\n  // No opinion.\n  return AccessResult::neutral();\n}\n```\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521modules%2521block%2521block.api.php/function/hook_block_access/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21modules%21block%21block.api.php/function/hook_block_access/11.x.md", "type": "doc_summary", "topic": "function hook\\_block\\_access"}}
{"instruction": "Show me the implementation of the class MenuLinkEditForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\menu_ui\\Form;\n\nuse Drupal\\Core\\DependencyInjection\\ClassResolverInterface;\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Menu\\MenuLinkInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Defines a generic edit form for all menu link plugin types.\n *\n * The menu link plugin defines which class defines the corresponding form.\n *\n * @internal\n *\n * @see \\Drupal\\Core\\Menu\\MenuLinkInterface::getFormClass()\n */\nclass MenuLinkEditForm extends FormBase {\n\n  /**\n   * The class resolver.\n   *\n   * @var \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface\n   */\n  protected $classResolver;\n\n  /**\n   * Constructs a MenuLinkEditForm object.\n   *\n   * @param \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface $class_resolver\n   *   The class resolver.\n   */\n  public function __construct(ClassResolverInterface $class_resolver) {\n    $this->classResolver = $class_resolver;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('class_resolver')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'menu_link_edit';\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   * @param \\Drupal\\Core\\Menu\\MenuLinkInterface $menu_link_plugin\n   *   The plugin instance to use for this form.\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?MenuLinkInterface $menu_link_plugin = NULL) {\n    $form['menu_link_id'] = [\n      '#type' => 'value',\n      '#value' => $menu_link_plugin->getPluginId(),\n    ];\n    $class_name = $menu_link_plugin->getFormClass();\n    $form['#plugin_form'] = $this->classResolver->getInstanceFromDefinition($class_name);\n    $form['#plugin_form']->setMenuLinkInstance($menu_link_plugin);\n\n    $form += $form['#plugin_form']->buildConfigurationForm($form, $form_state);\n\n    $form['actions'] = ['#type' => 'actions'];\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Save'),\n      '#button_type' => 'primary',\n    ];\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state) {\n    $form['#plugin_form']->validateConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $link = $form['#plugin_form']->submitConfigurationForm($form, $form_state);\n\n    $this->messenger()->addStatus($this->t('The menu link has been saved.'));\n    $form_state->setRedirect(\n      'entity.menu.edit_form',\n      ['menu' => $link->getMenuName()]\n    );\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/menu_ui/src/Form/MenuLinkEditForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MenuLinkEditForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Quantifying Emissions", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Sustainability](/docs/getting-started/sustainability)\n\n* [Contributing to Sustainability in Drupal](/docs/getting-started/sustainability/contributing-to-sustainability-in-drupal)\n* [Getting Started with Sustainability](/docs/getting-started/sustainability/getting-started-with-sustainability)\n* [Module & Theme Considerations](/docs/getting-started/sustainability/module-theme-considerations)\n* [Quantifying Emissions](/docs/getting-started/sustainability/quantifying-emissions)\n* [Sustainable contribution](/docs/getting-started/sustainability/sustainable-contribution)\n\n# Quantifying Emissions\n\nLast [updated](/node/3499652/discuss) on\n\n14 January 2025\n\nThis documentation **needs review**. See \"Help improve this page\" in the sidebar.\n\nThe Drupal Association is currently not set up to do carbon accounting for Drupal.org and associated sites. Drupal.org is an unusually large and complex site, as it is where much of the development of Drupal takes place. This guide the following is some guidance for the hundreds of thousands of sites which use Drupal and may need to start doing carbon accounting.\n\nFor the web, sustainability inherently involves both the server, client, and all the computers in between. There has been a lot of work done on looking at evaluating the environmental impact of data centers, and the sites within it.\n\nSome servers offer tools like Platform.sh that allow you to see a r[eport of the CO2 for your server](https://support.platform.sh/hc/en-us/articles/11960042078994-How-to-check-region-environmental-impact). AWS has a [Customer Carbon Footprint Tool](https://aws.amazon.com/aws-cost-management/aws-customer-carbon-footprint-tool/) as do [Google](https://cloud.google.com/carbon-footprint) and [Azure](https://learn.microsoft.com/en-us/azure/carbon-optimization/view-emissions). [The Green Software Foundation](https://greensoftware.foundation) is a good place to look for more server-side tools.\n\nTo understand the CO2 of the front-end of your own website, we recommend looking at an open source tool like [Sitespeed.io](https://www.sitespeed.io/documentation/sitespeed.io/sustainable/) which incorporates the results from [CO2.js](https://developers.thegreenwebfoundation.org/co2js/overview/). \u00a0There is still a lot of debate about best practices around your site, but if you are able to reduce the processing time to render your site, this generally lowers CO2. So even using a tool like [Unlighthouse.dev](https://Unlighthouse.dev) to get a sense of where you can improve is good.\n\nThere are great proprietary tools like [WebsiteCarbon.com](http://WebsiteCarbon.com) and [Ecograder](https://ecograder.com/). Each tool may use their own unique approach to calculate CO2 and provide guidance about how to reduce your environmental footprint. With any of these tools what matters is that you use them to reduce your CO2 emissions. There will always be advantages/disadvantages to different models.\n\n## Tags\n\n[Sustainability](/taxonomy/term/203615)\n\n## Help improve this page\n\n**Page status:**  Needs review\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3499652/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283499652%29%20Quantifying%20Emissions) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/sustainability/quantifying-emissions.md", "type": "doc_summary", "topic": "Quantifying Emissions"}}
{"instruction": "Show me the implementation of the class UserSearch in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\Search;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Database\\Query\\PagerSelectExtender;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\Access\\AccessibleInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\search\\Attribute\\Search;\nuse Drupal\\search\\Plugin\\SearchPluginBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Executes a keyword search for users against the {users} database table.\n */\n#[Search(\n  id: 'user_search',\n  title: new TranslatableMarkup('Users'),\n)]\nclass UserSearch extends SearchPluginBase implements AccessibleInterface {\n\n  /**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $database;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   */\n  protected $moduleHandler;\n\n  /**\n   * The current user.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $currentUser;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $container->get('database'),\n      $container->get('entity_type.manager'),\n      $container->get('module_handler'),\n      $container->get('current_user'),\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n  }\n\n  /**\n   * Creates a UserSearch object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $database\n   *   The database connection.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $current_user\n   *   The current user.\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   */\n  public function __construct(Connection $database, EntityTypeManagerInterface $entity_type_manager, ModuleHandlerInterface $module_handler, AccountInterface $current_user, array $configuration, $plugin_id, $plugin_definition) {\n    $this->database = $database;\n    $this->entityTypeManager = $entity_type_manager;\n    $this->moduleHandler = $module_handler;\n    $this->currentUser = $current_user;\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->addCacheTags(['user_list']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function access($operation = 'view', ?AccountInterface $account = NULL, $return_as_object = FALSE) {\n    $result = AccessResult::allowedIf(!empty($account) && $account->hasPermission('access user profiles'))->cachePerPermissions();\n    return $return_as_object ? $result : $result->isAllowed();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    $results = [];\n    if (!$this->isSearchExecutable()) {\n      return $results;\n    }\n\n    // Process the keywords.\n    $keys = $this->keywords;\n    // Escape for LIKE matching.\n    $keys = $this->database->escapeLike($keys);\n    // Replace wildcards with MySQL/PostgreSQL wildcards.\n    $keys = preg_replace('!\\*+!', '%', $keys);\n\n    // Run the query to find matching users.\n    $query = $this->database\n      ->select('users_field_data', 'users')\n      ->extend(PagerSelectExtender::class);\n    $query->fields('users', ['uid']);\n    $query->condition('default_langcode', 1);\n    if ($this->currentUser->hasPermission('administer users')) {\n      // Administrators can also search in the otherwise private email field,\n      // and they don't need to be restricted to only active users.\n      $query->fields('users', ['mail']);\n      $query->condition($query->orConditionGroup()\n        ->condition('name', '%' . $keys . '%', 'LIKE')\n        ->condition('mail', '%' . $keys . '%', 'LIKE')\n      );\n    }\n    else {\n      // Regular users can only search via usernames, and we do not show them\n      // blocked accounts.\n      $query->condition('name', '%' . $keys . '%', 'LIKE')\n        ->condition('status', 1);\n    }\n    $uids = $query\n      ->limit(15)\n      ->execute()\n      ->fetchCol();\n    $accounts = $this->entityTypeManager->getStorage('user')->loadMultiple($uids);\n\n    foreach ($accounts as $account) {\n      $result = [\n        'title' => $account->getDisplayName(),\n        'link' => $account->toUrl('canonical', ['absolute' => TRUE])->toString(),\n      ];\n      if ($this->currentUser->hasPermission('administer users')) {\n        $result['title'] .= ' (' . $account->getEmail() . ')';\n      }\n      $this->addCacheableDependency($account);\n      $results[] = $result;\n    }\n\n    return $results;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getHelp() {\n    $help = [\n      'list' => [\n        '#theme' => 'item_list',\n        '#items' => [\n          $this->t('User search looks for user names and partial user names. Example: mar would match usernames mar, delmar, and maryjane.'),\n          $this->t('You can use * as a wildcard within your keyword. Example: m*r would match user names mar, delmar, and elementary.'),\n        ],\n      ],\n    ];\n\n    return $help;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/Search/UserSearch.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserSearch", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PathSetTranslated in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\path\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * A process plugin to update the path of a translated node.\n *\n * Available configuration keys:\n * - source: An array of two values, the first being the original path, and the\n *   second being an array of the format [nid, langcode] if a translated node\n *   exists (likely from a migration lookup). Paths not of the format\n *   '/node/<nid>' will pass through unchanged, as will any inputs with invalid\n *   or missing translated nodes.\n *\n * This plugin will return the correct path for the translated node if the above\n * conditions are met, and will return the original path otherwise.\n *\n * Example:\n *   node_translation:\n *   -\n *     plugin: explode\n *     source: source\n *     delimiter: /\n *   -\n *     # If the source path has no slashes return a dummy default value.\n *     plugin: extract\n *     default: 'INVALID_NID'\n *     index:\n *       - 1\n *   -\n *     plugin: migration_lookup\n *     migration: d7_node_translation\n *   _path:\n *     plugin: concat\n *     source:\n *       - constants/slash\n *       - source\n *   path:\n *     plugin: path_set_translated\n *     source:\n *       - '@_path'\n *       - '@node_translation'\n *\n * In the example above, if the node_translation lookup succeeds and the\n * original path is of the format '/node/<original node nid>', then the new path\n * will be set to '/node/<translated node nid>'\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess('path_set_translated')]\nclass PathSetTranslated extends ProcessPluginBase {\n\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (!is_array($value)) {\n      throw new MigrateException(\"The input value should be an array.\");\n    }\n\n    $path = $value[0] ?? '';\n    $nid = (is_array($value[1]) && isset($value[1][0])) ? $value[1][0] : FALSE;\n    if (preg_match('/^\\/node\\/\\d+$/', $path) && $nid) {\n      return '/node/' . $nid;\n    }\n    return $path;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path/src/Plugin/migrate/process/PathSetTranslated.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathSetTranslated", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{# Row Block Component #}\n{# This component creates a row layout with customizable columns that can accept child components #}\n\n{% set safe_widths = widths is iterable and widths is not empty ? widths : [] %}\n\n<div {{ sdc_component_attributes(component_name) }}\n     class=\"row-block row-layout-{{ layout|default('2-col') }}\"\n     data-nested-container=\"true\"\n     data-custom-widths=\"{{ safe_widths|json_encode }}\">\n\n  {% if editable %}\n  {# Layout selector - sidebar editor #}\n  <div data-sdc-field=\"layout\"\n       data-sdc-sidebar=\"true\"\n       data-sdc-type=\"select-dropdown\"\n       data-sdc-options='[\n         {\"value\": \"1-col\", \"label\": \"1 Column\"},\n         {\"value\": \"2-col\", \"label\": \"2 Columns\"},\n         {\"value\": \"3-col\", \"label\": \"3 Columns\"},\n         {\"value\": \"4-col\", \"label\": \"4 Columns\"}\n       ]'\n       data-sdc-prop-select-dropdown=\"{{ layout|default('2-col') }}\">\n  </div>\n  {% endif %}\n\n  <div class=\"row-container\">\n    {% set column_count = {\n      '1-col': 1,\n      '2-col': 2,\n      '3-col': 3,\n      '4-col': 4\n    } %}\n\n    {% set num_columns = column_count[layout|default('2-col')] %}\n\n    {% set saved_children = children|default([]) %}\n\n    {% for i in 1..num_columns %}\n      <div class=\"row-column row-column-{{ i }}\"\n           data-column-index=\"{{ i }}\"\n           data-drop-container=\"true\"\n           {% if safe_widths[i-1] %}style=\"flex: 0 0 {{ safe_widths[i-1] }}%; width: {{ safe_widths[i-1] }}%;\"{% endif %}>\n\n        {# Render child components in this column #}\n        {% if saved_children[i-1] and saved_children[i-1].components %}\n          {% for child_component in saved_children[i-1].components %}\n            {{ render_child_component(child_component, editable|default(false)) }}\n          {% endfor %}\n        {% endif %}\n\n        {# Placeholder for empty columns #}\n        {% if not editable and (not saved_children[i-1] or not saved_children[i-1].components or saved_children[i-1].components|length == 0) %}\n          <div class=\"nestable-placeholder\">\n            Drop components here\n          </div>\n        {% endif %}\n      </div>\n    {% endfor %}\n  </div>\n</div>\n", "metadata": {"source": "repos/sdc_inline_editor/components/row-block/row-block.twig", "type": "twig_reference"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: CreateRole\nSource file: <source_file>\nFile name hint: CreateRole.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\RoleService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_create_role',\n  label: new TranslatableMarkup('Create Role'),\n  description: new TranslatableMarkup('Create a new user role with optional initial permissions.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Machine Name'),\n      description: new TranslatableMarkup('Lowercase, underscores (e.g., \"content_editor\")'),\n      required: TRUE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label'),\n      description: new TranslatableMarkup('Human-readable name (e.g., \"Content Editor\")'),\n      required: TRUE,\n    ),\n    'permissions' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Permissions'),\n      description: new TranslatableMarkup('Initial permissions to grant'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Role ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Role Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'permissions_granted' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Permissions Granted'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateRole extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected RoleService $roleService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->roleService = $container->get('mcp_tools_structure.role');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $id = $input['id'] ?? '';\n    $label = $input['label'] ?? '';\n\n    if (empty($id) || empty($label)) {\n      return ['success' => FALSE, 'error' => 'Both id and label are required.'];\n    }\n\n    return $this->roleService->createRole($id, $label, $input['permissions'] ?? []);\n  }\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_structure\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_structure\\Service\\RoleService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_structure_create_role',\n  label: new TranslatableMarkup('Create Role'),\n  description: new TranslatableMarkup('Create a new user role with optional initial permissions.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Machine Name'),\n      description: new TranslatableMarkup('Lowercase, underscores (e.g., \"content_editor\")'),\n      required: TRUE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label'),\n      description: new TranslatableMarkup('Human-readable name (e.g., \"Content Editor\")'),\n      required: TRUE,\n    ),\n    'permissions' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Permissions'),\n      description: new TranslatableMarkup('Initial permissions to grant'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Role ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Role Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'permissions_granted' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Permissions Granted'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateRole extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'structure';\n\n\n  protected RoleService $roleService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->roleService = $container->get('mcp_tools_structure.role');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $id = $input['id'] ?? '';\n    $label = $input['label'] ?? '';\n\n    if (empty($id) || empty($label)) {\n      return ['success' => FALSE, 'error' => 'Both id and label are required.'];\n    }\n\n    return $this->roleService->createRole($id, $label, $input['permissions'] ?? []);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_structure/src/Plugin/tool/Tool/CreateRole.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateRole", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: MCP Tools - Views", "input": "", "output": "# MCP Tools - Views\n\nViews creation and management for MCP Tools.\n\n## Tools (6)\n\n| Tool | Description |\n|------|-------------|\n| `mcp_views_create_view` | Create custom views |\n| `mcp_views_create_content_list` | Quick content listing view |\n| `mcp_views_delete_view` | Remove custom views |\n| `mcp_views_add_display` | Add display to existing view |\n| `mcp_views_enable` | Enable a view |\n| `mcp_views_disable` | Disable a view |\n\n## Requirements\n\n- mcp_tools (base module)\n- drupal:views\n\n## Installation\n\n```bash\ndrush en mcp_tools_views\n```\n\n## Example Usage\n\n### Quick Content List\n\n```\nUser: \"Create a view showing recent articles\"\n\nAI calls: mcp_views_create_content_list(\n  id: \"recent_articles\",\n  label: \"Recent Articles\",\n  content_type: \"article\",\n  display_type: \"page\",\n  path: \"/articles\",\n  items_per_page: 10\n)\n```\n\n### Custom View with Filters\n\n```\nUser: \"Create a view of published events sorted by date\"\n\nAI calls: mcp_views_create_view(\n  id: \"upcoming_events\",\n  label: \"Upcoming Events\",\n  base_table: \"node_field_data\",\n  displays: {\n    page_1: {\n      display_plugin: \"page\",\n      display_options: {\n        path: \"events\",\n        filters: {\n          type: {value: \"event\"},\n          status: {value: 1}\n        },\n        sorts: {\n          field_event_date: {order: \"ASC\"}\n        }\n      }\n    }\n  }\n)\n```\n\n### Add Block Display\n\n```\nUser: \"Add a block display to the articles view\"\n\nAI calls: mcp_views_add_display(\n  view_id: \"recent_articles\",\n  display_type: \"block\",\n  display_id: \"sidebar_block\",\n  options: {\n    items_per_page: 5\n  }\n)\n```\n\n## Safety Features\n\n- **Core views protected:** Cannot delete views provided by Drupal core\n- **Validation:** View configuration validated before save\n- **Audit logging:** All view operations logged\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_views/README.md", "type": "doc_summary", "topic": "MCP Tools - Views"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'MCP Client'\ntype: module\ndescription: 'Unlocks connection to external MCP servers'\npackage: AI Tools\ncore_version_requirement: ^10.3 || ^11\ndependencies:\n  - ai:ai\n  - ai_agents:ai_agents\n  - key:key\n  - tool:tool\n", "metadata": {"source": "repos/mcp_client/mcp_client.info.yml", "type": "yaml_reference", "topic": "mcp client.info"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: RouteMatchValueResolver\nSource file: <source_file>\nFile name hint: RouteMatchValueResolver.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Controller\\ArgumentResolver;\n\nuse Drupal\\Core\\Routing\\RouteMatch;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ValueResolverInterface;\nuse Symfony\\Component\\HttpKernel\\ControllerMetadata\\ArgumentMetadata;\n\n/**\n * Yields a RouteMatch object based on the request object passed along.\n */\nfinal class RouteMatchValueResolver implements ValueResolverInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  function resolve(Request $request, ArgumentMetadata $argument): array {\n    return $argument->getType() === RouteMatchInterface::class || is_subclass_of($argument->getType(), RouteMatchInterface::class) ? [RouteMatch::createFromRequest($request)] : [];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Controller\\ArgumentResolver;\n\nuse Drupal\\Core\\Routing\\RouteMatch;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ValueResolverInterface;\nuse Symfony\\Component\\HttpKernel\\ControllerMetadata\\ArgumentMetadata;\n\n/**\n * Yields a RouteMatch object based on the request object passed along.\n */\nfinal class RouteMatchValueResolver implements ValueResolverInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolve(Request $request, ArgumentMetadata $argument): array {\n    return $argument->getType() === RouteMatchInterface::class || is_subclass_of($argument->getType(), RouteMatchInterface::class) ? [RouteMatch::createFromRequest($request)] : [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/ArgumentResolver/RouteMatchValueResolver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RouteMatchValueResolver", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: file.install\nTarget symbol: class file.install\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for file.install.\n- Ensure these methods exist where relevant:\n  - file_schema()\n  - file_update_last_removed()", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for File module.\n */\n\n/**\n * Implements hook_schema().\n */\nfunction file_schema(): array {\n  $schema['file_usage'] = [\n    'description' => 'Track where a file is used.',\n    'fields' => [\n      'fid' => [\n        'description' => 'File ID.',\n        'type' => 'int',\n        'unsigned' => TRUE,\n        'not null' => TRUE,\n      ],\n      'module' => [\n        'description' => 'The name of the module that is using the file.',\n        'type' => 'varchar_ascii',\n        'length' => DRUPAL_EXTENSION_NAME_MAX_LENGTH,\n        'not null' => TRUE,\n        'default' => '',\n      ],\n      'type' => [\n        'description' => 'The name of the object type in which the file is used.',\n        'type' => 'varchar_ascii',\n        'length' => 64,\n        'not null' => TRUE,\n        'default' => '',\n      ],\n      'id' => [\n        'description' => 'The primary key of the object using the file.',\n        'type' => 'varchar_ascii',\n        'length' => 64,\n        'not null' => TRUE,\n        'default' => 0,\n      ],\n      'count' => [\n        'description' => 'The number of times this file is used by this object.',\n        'type' => 'int',\n        'unsigned' => TRUE,\n        'not null' => TRUE,\n        'default' => 0,\n      ],\n    ],\n    'primary key' => ['fid', 'type', 'id', 'module'],\n    'indexes' => [\n      'type_id' => ['type', 'id'],\n      'fid_count' => ['fid', 'count'],\n      'fid_module' => ['fid', 'module'],\n    ],\n  ];\n  return $schema;\n}\n\n/**\n * Implements hook_update_last_removed().\n */\nfunction file_update_last_removed(): int {\n  return 8700;\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/file.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "File", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class ProfileForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form handler for the profile forms.\n *\n * @internal\n */\nclass ProfileForm extends AccountForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    $element = parent::actions($form, $form_state);\n\n    if (!$this->entity->isNew() && $this->entity->hasLinkTemplate('cancel-form')) {\n      $route_info = $this->entity->toUrl('cancel-form');\n      if ($this->getRequest()->query->has('destination')) {\n        $query = $route_info->getOption('query');\n        $query['destination'] = $this->getRequest()->query->get('destination');\n        $route_info->setOption('query', $query);\n      }\n      $element['delete'] = [\n        '#type' => 'link',\n        '#title' => $this->t('Cancel account'),\n        '#access' => $this->entity->id() > 1 && $this->entity->access('delete'),\n        '#attributes' => [\n          'class' => ['button', 'button--danger'],\n        ],\n      ];\n      $element['delete']['#url'] = $route_info;\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    $account = $this->entity;\n    $account->save();\n    $form_state->setValue('uid', $account->id());\n\n    $this->messenger()->addStatus($this->t('The changes have been saved.'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/ProfileForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProfileForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ViewsExposedFilterBlock\nSource file: <source_file>\nFile name hint: ViewsExposedFilterBlock.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\views\\Plugin\\Block;\n\nuse Drupal\\Core\\Block\\Attribute\\Block;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Component\\Utility\\Xss;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Plugin\\Derivative\\ViewsExposedFilterBlock as ViewsExposedFilterBlockDeriver;\n\n/**\n * Provides a 'Views Exposed Filter' block.\n */\n#[Block(\n  id: \"views_exposed_filter_block\",\n  admin_label: new TranslatableMarkup(\"Views Exposed Filter Block\"),\n  deriver: ViewsExposedFilterBlockDeriver::class\n)]\nclass ViewsExposedFilterBlock extends ViewsBlockBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function getCacheContexts() {\n    $contexts = $this->view->display_handler->getCacheMetadata()->getCacheContexts();\n    return Cache::mergeContexts(parent::getCacheContexts(), $contexts);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array\n   *   A renderable array representing the content of the block with additional\n   *   context of current view and display ID.\n   */\n  public function build() : array {\n    $output = $this->view->display_handler->viewExposedFormBlocks() ?? [];\n    // Provide the context for block build and block view alter hooks.\n    // \\Drupal\\views\\Plugin\\Block\\ViewsBlock::build() adds the same context in\n    // \\Drupal\\views\\ViewExecutable::buildRenderable() using\n    // \\Drupal\\views\\Plugin\\views\\display\\DisplayPluginBase::buildRenderable().\n    if (!empty($output)) {\n      $output += [\n        '#view' => $this->view,\n        '#display_id' => $this->displayID,\n      ];\n    }\n\n    // Before returning the block output, convert it to a renderable array with\n    // contextual links.\n    $this->addContextualLinks($output, 'exposed_filter');\n\n    // Set the blocks title.\n    if (!empty($this->configuration['label_display']) && ($this->view->getTitle() || !empty($this->configuration['views_label']))) {\n      $output['#title'] = [\n        '#markup' => empty($this->configuration['views_label']) ? $this->view->getTitle() : $this->configuration['views_label'],\n        '#allowed_tags' => Xss::getHtmlTagList(),\n      ];\n    }\n\n    return $output;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\Block;\n\nuse Drupal\\Core\\Block\\Attribute\\Block;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Component\\Utility\\Xss;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Plugin\\Derivative\\ViewsExposedFilterBlock as ViewsExposedFilterBlockDeriver;\n\n/**\n * Provides a 'Views Exposed Filter' block.\n */\n#[Block(\n  id: \"views_exposed_filter_block\",\n  admin_label: new TranslatableMarkup(\"Views Exposed Filter Block\"),\n  deriver: ViewsExposedFilterBlockDeriver::class\n)]\nclass ViewsExposedFilterBlock extends ViewsBlockBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    $contexts = $this->view->display_handler->getCacheMetadata()->getCacheContexts();\n    return Cache::mergeContexts(parent::getCacheContexts(), $contexts);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array\n   *   A renderable array representing the content of the block with additional\n   *   context of current view and display ID.\n   */\n  public function build() : array {\n    $output = $this->view->display_handler->viewExposedFormBlocks() ?? [];\n    // Provide the context for block build and block view alter hooks.\n    // \\Drupal\\views\\Plugin\\Block\\ViewsBlock::build() adds the same context in\n    // \\Drupal\\views\\ViewExecutable::buildRenderable() using\n    // \\Drupal\\views\\Plugin\\views\\display\\DisplayPluginBase::buildRenderable().\n    if (!empty($output)) {\n      $output += [\n        '#view' => $this->view,\n        '#display_id' => $this->displayID,\n      ];\n    }\n\n    // Before returning the block output, convert it to a renderable array with\n    // contextual links.\n    $this->addContextualLinks($output, 'exposed_filter');\n\n    // Set the blocks title.\n    if (!empty($this->configuration['label_display']) && ($this->view->getTitle() || !empty($this->configuration['views_label']))) {\n      $output['#title'] = [\n        '#markup' => empty($this->configuration['views_label']) ? $this->view->getTitle() : $this->configuration['views_label'],\n        '#allowed_tags' => Xss::getHtmlTagList(),\n      ];\n    }\n\n    return $output;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/Block/ViewsExposedFilterBlock.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsExposedFilterBlock", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Message\nSource file: <source_file>\nFile name hint: Message.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\DTO;\n\n/**\n * Represents a chat message in the state graph.\n *\n * Messages are the primary data structure for conversational workflows,\n * including ReAct-style agent loops and multi-turn chat systems.\n *\n * Supported roles:\n * - \"system\": System/instruction messages.\n * - \"user\": User input messages.\n * - \"assistant\": AI/assistant responses.\n * - \"tool\": Tool/function call results.\n *\n * Example usage:\n * @code\n * $systemMsg = new Message(\"system\", \"You are a helpful assistant.\");\n * $userMsg = new Message(\"user\", \"What is the weather?\");\n * $assistantMsg = new Message(\"assistant\", \"Let me check...\", [\n *   \"tool_calls\" => [[\"name\" => \"get_weather\", \"args\" => [\"location\" => \"NYC\"]]],\n * ]);\n * $toolMsg = new Message(\"tool\", \"72\u00b0F, sunny\", [\n *   \"tool_call_id\" => \"call_123\",\n * ]);\n * @endcode\n */\nfinal class Message implements \\JsonSerializable {\n\n  /**\n   * Constructs a new Message.\n   *\n   * @param string $role\n   *   The message role (system, user, assistant, tool).\n   * @param string $content\n   *   The message content.\n   * @param array<string, mixed> $metadata\n   *   Additional metadata (tool calls, tool_call_id, etc.).\n   * @param int|null $timestamp\n   *   Unix timestamp when the message was created.\n   */\n  public function __construct(\n    public readonly string $role,\n    public readonly string $content,\n    public readonly array $metadata = [],\n    public readonly ?int $timestamp = NULL,\n  ) {}\n\n  /**\n   * Creates a system message.\n   *\n   * @param string $content\n   *   The system instruction content.\n   *\n   * @return self\n   *   A new Message with role \"system\".\n   */\n  public static function system(string $content): self {\n    return new self(\"system\", $content, [], time());\n  }\n\n  /**\n   * Creates a user message.\n   *\n   * @param string $content\n   *   The user message content.\n   *\n   * @return self\n   *   A new Message with role \"user\".\n   */\n  public static function user(string $content): self {\n    return new self(\"user\", $content, [], time());\n  }\n\n  /**\n   * Creates an assistant message.\n   *\n   * @param string $content\n   *   The assistant response content.\n   * @param array<string, mixed> $metadata\n   *   Optional metadata (e.g., tool_calls).\n   *\n   * @return self\n   *   A new Message with role \"assistant\".\n   */\n  public static function assistant(string $content, array $metadata = []): self {\n    return new self(\"assistant\", $content, $metadata, time());\n  }\n\n  /**\n   * Creates a tool result message.\n   *\n   * @param string $content\n   *   The tool result content.\n   * @param string $toolCallId\n   *   The ID of the tool call this is a response to.\n   *\n   * @return self\n   *   A new Message with role \"tool\".\n   */\n  public static function tool(string $content, string $toolCallId): self {\n    return new self(\"tool\", $content, [\"tool_call_id\" => $toolCallId], time());\n  }\n\n  /**\n   * Gets the tool calls from this message (if any).\n   *\n   * @return array<array{name: string, args: array<string, mixed>}>\n   *   Array of tool calls or empty array.\n   */\n  public function getToolCalls(): array {\n    return $this->metadata[\"tool_calls\"] ?? [];\n  }\n\n  /**\n   * Checks if this message has tool calls.\n   *", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\DTO;\n\n/**\n * Represents a chat message in the state graph.\n *\n * Messages are the primary data structure for conversational workflows,\n * including ReAct-style agent loops and multi-turn chat systems.\n *\n * Supported roles:\n * - \"system\": System/instruction messages.\n * - \"user\": User input messages.\n * - \"assistant\": AI/assistant responses.\n * - \"tool\": Tool/function call results.\n *\n * Example usage:\n * @code\n * $systemMsg = new Message(\"system\", \"You are a helpful assistant.\");\n * $userMsg = new Message(\"user\", \"What is the weather?\");\n * $assistantMsg = new Message(\"assistant\", \"Let me check...\", [\n *   \"tool_calls\" => [[\"name\" => \"get_weather\", \"args\" => [\"location\" => \"NYC\"]]],\n * ]);\n * $toolMsg = new Message(\"tool\", \"72\u00b0F, sunny\", [\n *   \"tool_call_id\" => \"call_123\",\n * ]);\n * @endcode\n */\nfinal class Message implements \\JsonSerializable {\n\n  /**\n   * Constructs a new Message.\n   *\n   * @param string $role\n   *   The message role (system, user, assistant, tool).\n   * @param string $content\n   *   The message content.\n   * @param array<string, mixed> $metadata\n   *   Additional metadata (tool calls, tool_call_id, etc.).\n   * @param int|null $timestamp\n   *   Unix timestamp when the message was created.\n   */\n  public function __construct(\n    public readonly string $role,\n    public readonly string $content,\n    public readonly array $metadata = [],\n    public readonly ?int $timestamp = NULL,\n  ) {}\n\n  /**\n   * Creates a system message.\n   *\n   * @param string $content\n   *   The system instruction content.\n   *\n   * @return self\n   *   A new Message with role \"system\".\n   */\n  public static function system(string $content): self {\n    return new self(\"system\", $content, [], time());\n  }\n\n  /**\n   * Creates a user message.\n   *\n   * @param string $content\n   *   The user message content.\n   *\n   * @return self\n   *   A new Message with role \"user\".\n   */\n  public static function user(string $content): self {\n    return new self(\"user\", $content, [], time());\n  }\n\n  /**\n   * Creates an assistant message.\n   *\n   * @param string $content\n   *   The assistant response content.\n   * @param array<string, mixed> $metadata\n   *   Optional metadata (e.g., tool_calls).\n   *\n   * @return self\n   *   A new Message with role \"assistant\".\n   */\n  public static function assistant(string $content, array $metadata = []): self {\n    return new self(\"assistant\", $content, $metadata, time());\n  }\n\n  /**\n   * Creates a tool result message.\n   *\n   * @param string $content\n   *   The tool result content.\n   * @param string $toolCallId\n   *   The ID of the tool call this is a response to.\n   *\n   * @return self\n   *   A new Message with role \"tool\".\n   */\n  public static function tool(string $content, string $toolCallId): self {\n    return new self(\"tool\", $content, [\"tool_call_id\" => $toolCallId], time());\n  }\n\n  /**\n   * Gets the tool calls from this message (if any).\n   *\n   * @return array<array{name: string, args: array<string, mixed>}>\n   *   Array of tool calls or empty array.\n   */\n  public function getToolCalls(): array {\n    return $this->metadata[\"tool_calls\"] ?? [];\n  }\n\n  /**\n   * Checks if this message has tool calls.\n   *\n   * @return bool\n   *   TRUE if message has tool calls.\n   */\n  public function hasToolCalls(): bool {\n    return !empty($this->metadata[\"tool_calls\"]);\n  }\n\n  /**\n   * Gets the tool call ID (for tool role messages).\n   *\n   * @return string|null\n   *   The tool call ID or NULL.\n   */\n  public function getToolCallId(): ?string {\n    $toolCallId = $this->metadata[\"tool_call_id\"] ?? NULL;\n    return $toolCallId !== NULL ? (string) $toolCallId : NULL;\n  }\n\n  /**\n   * Creates a Message from an array.\n   *\n   * @param array<string, mixed> $data\n   *   The message data.\n   *\n   * @return self\n   *   A new Message instance.\n   */\n  public static function fromArray(array $data): self {\n    return new self(\n      role: (string) ($data[\"role\"] ?? \"user\"),\n      content: (string) ($data[\"content\"] ?? \"\"),\n      metadata: $data[\"metadata\"] ?? [],\n      timestamp: isset($data[\"timestamp\"]) ? (int) $data[\"timestamp\"] : NULL,\n    );\n  }\n\n  /**\n   * Converts the message to an array.\n   *\n   * @return array<string, mixed>\n   *   The message as an array.\n   */\n  public function toArray(): array {\n    return [\n      \"role\" => $this->role,\n      \"content\" => $this->content,\n      \"metadata\" => $this->metadata,\n      \"timestamp\" => $this->timestamp,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function jsonSerialize(): mixed {\n    return $this->toArray();\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_stategraph/src/DTO/Message.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Message", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Multilingual Tokens\ntype: module\ndescription: 'Provides tokens with multilingual support.'\ncore_version_requirement: ^10.2 || ^11\npackage: Multilingual\nphp: 8.1\ndependencies:\n  - drupal:language\n  - drupal:content_translation\n  - drupal:token\n", "metadata": {"source": "repos/multilingual_tokens/multilingual_tokens.info.yml", "type": "yaml_reference", "topic": "multilingual tokens.info"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: LinkOptions\nSource file: <source_file>\nFile name hint: LinkOptions.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\menu_link_content\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Converts links options.\n *\n * Examples:\n *\n * @code\n * process:\n *   link/options:\n *     plugin: link_options\n *     source: options\n * @endcode\n *\n * This will convert the query options of the link.\n */\n#[MigrateProcess(\n  id: \"link_options\",\n  handle_multiples: TRUE,\n)]\nclass LinkOptions extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (isset($value['query'])) {\n      // If the query parameters are stored as a string (as in D6), convert it\n      // into an array.\n      if (is_string($value['query'])) {\n        parse_str($value['query'], $old_query);\n      }\n      else {\n        $old_query = $value['query'];\n      }\n      $value['query'] = $old_query;\n    }\n    return $value;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\menu_link_content\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Converts links options.\n *\n * Examples:\n *\n * @code\n * process:\n *   link/options:\n *     plugin: link_options\n *     source: options\n * @endcode\n *\n * This will convert the query options of the link.\n */\n#[MigrateProcess(\n  id: \"link_options\",\n  handle_multiples: TRUE,\n)]\nclass LinkOptions extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (isset($value['query'])) {\n      // If the query parameters are stored as a string (as in D6), convert it\n      // into an array.\n      if (is_string($value['query'])) {\n        parse_str($value['query'], $old_query);\n      }\n      else {\n        $old_query = $value['query'];\n      }\n      $value['query'] = $old_query;\n    }\n    return $value;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/menu_link_content/src/Plugin/migrate/process/LinkOptions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LinkOptions", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_views.views:\n    class: Drupal\\mcp_tools_views\\Service\\ViewsService\n    arguments:\n      - '@entity_type.manager'\n      - '@mcp_tools.access_manager'\n      - '@mcp_tools.audit_logger'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_views/mcp_tools_views.services.yml", "type": "yaml_reference", "topic": "mcp tools views.services"}}
{"instruction": "Show me the implementation of the class LayoutDefinition in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\Attribute;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n#[\\Attribute(flags: \\Attribute::TARGET_CLASS)]\nclass LayoutDefinition {\n\n  /**\n   * A name of a static public method can be provided to override automatic behavior.\n   *\n   * @phpstan-param non-empty-string|null $factoryMethod\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   */\n  public function __construct(\n    public ?string $id = NULL,\n    public TranslatableMarkup|string|null $label = NULL,\n    public ?Regions $regions = NULL,\n    public ?string $factoryMethod = NULL,\n    public array $forms = [],\n  ) {\n  }\n\n}\n", "metadata": {"source": "repos/pinto_layout/src/Attribute/LayoutDefinition.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutDefinition", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LayoutBuilderEntityViewDisplayForm.php\nTarget symbol: class LayoutBuilderEntityViewDisplayForm\nNamespace: Drupal\\display_builder_entity_view\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LayoutBuilderEntityViewDisplayForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Menu\\LocalTaskManager\n  - Drupal\\Core\\Routing\\RouteBuilderInterface\n  - Drupal\\display_builder\\ConfigFormBuilderInterface\n  - Drupal\\layout_builder\\Form\\LayoutBuilderEntityViewDisplayForm as CoreLayoutBuilderEntityViewDisplayForm\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - create()\n  - form()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder_entity_view\\Form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Menu\\LocalTaskManager;\nuse Drupal\\Core\\Routing\\RouteBuilderInterface;\nuse Drupal\\display_builder\\ConfigFormBuilderInterface;\nuse Drupal\\layout_builder\\Form\\LayoutBuilderEntityViewDisplayForm as CoreLayoutBuilderEntityViewDisplayForm;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Edit form for the entity view display entity type.\n *\n * @internal\n *   Form classes are internal.\n */\nfinal class LayoutBuilderEntityViewDisplayForm extends CoreLayoutBuilderEntityViewDisplayForm {\n\n  use EntityViewDisplayFormTrait;\n\n  /**\n   * The entity being used by this form.\n   *\n   * @var \\Drupal\\display_builder_entity_view\\Entity\\LayoutBuilderEntityViewDisplay\n   */\n  protected $entity;\n\n  /**\n   * The config form builder for Display Builder.\n   */\n  protected ConfigFormBuilderInterface $configFormBuilder;\n\n  /**\n   * The local task manager.\n   */\n  protected LocalTaskManager $localTaskManager;\n\n  /**\n   * The router builder.\n   */\n  protected RouteBuilderInterface $routeBuilder;\n\n  /**\n   * {@inheritDoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->configFormBuilder = $container->get('display_builder.config_form_builder');\n    $instance->entityTypeManager = $container->get('entity_type.manager');\n    $instance->localTaskManager = $container->get('plugin.manager.menu.local_task');\n    $instance->routeBuilder = $container->get('router.builder');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state): array {\n    $form = parent::form($form, $form_state);\n    $form = $this->entityViewDisplayForm($form);\n\n    if (isset($form['layout'])) {\n      $form['layout']['#weight'] = 2;\n      $form['layout']['#open'] = $this->entity->isLayoutBuilderEnabled();\n    }\n\n    return $form;\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/modules/display_builder_entity_view/src/Form/LayoutBuilderEntityViewDisplayForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderEntityViewDisplayForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class FlowDropJobTypeListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_job;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Defines a class to build a listing of flowdrop job type entities.\n *\n * Features sortable table headers with default sorting by label alphabetically.\n * Supports pagination for large datasets.\n *\n * @see \\Drupal\\flowdrop_job\\Entity\\FlowDropJobType\n */\nfinal class FlowDropJobTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The number of entities to list per page.\n   *\n   * @var int\n   */\n  protected $limit = 50;\n\n  /**\n   * The current sort field.\n   *\n   * @var string\n   */\n  protected string $sortField = \"label\";\n\n  /**\n   * The current sort direction.\n   *\n   * @var string\n   */\n  protected string $sortDirection = \"asc\";\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<\\Drupal\\Core\\Entity\\EntityInterface>\n   *   An array of entities sorted according to the current tablesort.\n   */\n  public function load(): array {\n    $entities = parent::load();\n\n    // Get sort parameters from request.\n    $request = \\Drupal::request();\n    $order = $request->query->get(\"order\");\n    $sort = $request->query->get(\"sort\", \"asc\");\n\n    // Determine the field to sort by based on header label.\n    if ($order !== NULL) {\n      $fieldMap = [\n        \"Label\" => \"label\",\n      ];\n      if (isset($fieldMap[$order])) {\n        $this->sortField = $fieldMap[$order];\n        $this->sortDirection = $sort;\n      }\n    }\n\n    // Sort entities in memory.\n    usort($entities, function ($a, $b) {\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $a */\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $b */\n      $valueA = strtolower($a->label() ?? \"\");\n      $valueB = strtolower($b->label() ?? \"\");\n\n      // Compare values.\n      if ($valueA === $valueB) {\n        return 0;\n      }\n\n      $result = $valueA < $valueB ? -1 : 1;\n\n      // Reverse for descending order.\n      if ($this->sortDirection === \"desc\") {\n        $result = -$result;\n      }\n\n      return $result;\n    });\n\n    // Apply pagination.\n    return $this->getEntityListForPager($entities);\n  }\n\n  /**\n   * Gets a paginated slice of entities.\n   *\n   * @param array<\\Drupal\\Core\\Entity\\EntityInterface> $entities\n   *   All sorted entities.\n   *\n   * @return array<\\Drupal\\Core\\Entity\\EntityInterface>\n   *   Entities for the current page.\n   */\n  protected function getEntityListForPager(array $entities): array {\n    // Get current page from request.\n    $page = \\Drupal::request()->query->getInt(\"page\", 0);\n\n    // Calculate offset.\n    $offset = $page * $this->limit;\n\n    // Initialize pager.\n    \\Drupal::service(\"pager.manager\")->createPager(count($entities), $this->limit);\n\n    // Return slice of entities for current page.\n    return array_slice($entities, $offset, $this->limit);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<string, array<string, mixed>>\n   *   An array of sortable header definitions.\n   */\n  public function buildHeader(): array {\n    $header = [\n      \"label\" => [\n        \"data\" => $this->t(\"Label\"),\n        \"field\" => \"label\",\n        \"specifier\" => \"label\",\n        \"sort\" => \"asc\",\n      ],\n    ];\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    $row[\"label\"] = $entity->label();\n    return $row + parent::buildRow($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<string, mixed>\n   *   The render array for the list.\n   */\n  public function render(): array {\n    $build = parent::render();\n\n    // Add tablesort to the table.\n    $build[\"table\"][\"#header\"] = $this->buildHeader();\n    $build[\"table\"][\"#attributes\"][\"class\"][] = \"sortable-table\";\n    $build[\"table\"][\"#empty\"] = $this->t(\n      'No flowdrop job types available. <a href=\":link\">Add flowdrop job type</a>.',\n      [\":link\" => Url::fromRoute(\"flowdrop.structure.job_type.add\")->toString()],\n    );\n\n    // Add pager for pagination.\n    $build[\"pager\"] = [\n      \"#type\" => \"pager\",\n    ];\n\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_job/src/FlowDropJobTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropJobTypeListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: ContextAwareVariantInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Display;\n\n/**\n * Provides an interface for variant plugins that are context-aware.\n */\ninterface ContextAwareVariantInterface extends VariantInterface {\n\n  /**\n   * Gets the values for all defined contexts.\n   *\n   * @return \\Drupal\\Component\\Plugin\\Context\\ContextInterface[]\n   *   An array of set contexts, keyed by context name.\n   */\n  function getContexts();\n\n  /**\n   * Sets the context values for this display variant.\n   *\n   * @param \\Drupal\\Component\\Plugin\\Context\\ContextInterface[] $contexts\n   *   An array of contexts, keyed by context name.\n   *\n   * @return $this\n   */\n  public function setContexts(array $contexts);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Display;\n\n/**\n * Provides an interface for variant plugins that are context-aware.\n */\ninterface ContextAwareVariantInterface extends VariantInterface {\n\n  /**\n   * Gets the values for all defined contexts.\n   *\n   * @return \\Drupal\\Component\\Plugin\\Context\\ContextInterface[]\n   *   An array of set contexts, keyed by context name.\n   */\n  public function getContexts();\n\n  /**\n   * Sets the context values for this display variant.\n   *\n   * @param \\Drupal\\Component\\Plugin\\Context\\ContextInterface[] $contexts\n   *   An array of contexts, keyed by context name.\n   *\n   * @return $this\n   */\n  public function setContexts(array $contexts);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Display/ContextAwareVariantInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ContextAwareVariantInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Configure menu settings for a content type'\nrelated:\n  - menu_ui.menu_item_add\n  - menu_ui.menu_operations\n  - core.menus\n---\n{% set content_types_text %}{% trans %}Content types{% endtrans %}{% endset %}\n{% set content_types_link = render_var(help_route_link(content_types_text, 'entity.node_type.collection')) %}\n<h2>{% trans %}Goal{% endtrans %}</h2>\n<p>{% trans %}For an existing content type, configure the available menus that will be shown as options on content editing screens; links to content items of this type can be added to these menus during editing.{% endtrans %}</p>\n<h2>{% trans %}Steps{% endtrans %}</h2>\n<ol>\n  <li>{% trans %}In the <em>Manage</em> administrative menu, navigate to <em>Structure</em> &gt; {{ content_types_link }}.{% endtrans %}</li>\n  <li>{% trans %}Locate the content type you want to configure, and click <em>Edit</em> in the <em>Operations</em> list.{% endtrans %}</li>\n  <li>{% trans %}Under <em>Menu settings</em>, check the menus that you want to be available when editing a content item of this type.{% endtrans %}</li>\n  <li>{% trans %}Optionally, select the <em>Default parent item</em>, to put links to content items under a default location in the menu structure.{% endtrans %}</li>\n  <li>{% trans %}Click <em>Save</em>.{% endtrans %}</li>\n</ol>\n", "metadata": {"source": "repos/drupal_core/core/modules/menu_ui/help_topics/menu_ui.content_type_configuration.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class TaxonomyTermHierarchyConstraintValidator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\taxonomy\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\taxonomy\\TermStorageInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * Constraint validator for changing term parents in pending revisions.\n */\nclass TaxonomyTermHierarchyConstraintValidator extends ConstraintValidator implements ContainerInjectionInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  private $entityTypeManager;\n\n  /**\n   * Creates a new TaxonomyTermHierarchyConstraintValidator instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager) {\n    $this->entityTypeManager = $entity_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($entity, Constraint $constraint): void {\n    $term_storage = $this->entityTypeManager->getStorage($entity->getEntityTypeId());\n    assert($term_storage instanceof TermStorageInterface);\n\n    // Newly created entities should be able to specify a parent.\n    if ($entity && $entity->isNew()) {\n      return;\n    }\n\n    $is_pending_revision = !$entity->isDefaultRevision();\n    $pending_term_ids = $term_storage->getTermIdsWithPendingRevisions();\n    $ancestors = $term_storage->loadAllParents($entity->id());\n    $ancestor_is_pending_revision = (bool) array_intersect_key($ancestors, array_flip($pending_term_ids));\n\n    $new_parents = array_column($entity->parent->getValue(), 'target_id');\n    $original_parents = array_keys($term_storage->loadParents($entity->id())) ?: [0];\n    if (($is_pending_revision || $ancestor_is_pending_revision) && $new_parents != $original_parents) {\n      $this->context->buildViolation($constraint->message)\n        ->atPath('parent')\n        ->addViolation();\n    }\n\n    $original = $term_storage->loadUnchanged($entity->id());\n    if (($is_pending_revision || $ancestor_is_pending_revision) && !$entity->weight->equals($original->weight)) {\n      $this->context->buildViolation($constraint->message)\n        ->atPath('weight')\n        ->addViolation();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/src/Plugin/Validation/Constraint/TaxonomyTermHierarchyConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TaxonomyTermHierarchyConstraintValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SoapClient in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\n/**\n * @file\n * Install, update and uninstall functions for the SOAP Client module.\n *\n * INSTALLATION TIMING:\n *\n * Feed Type generation happens in hook_modules_installed() (soap_client.module)\n * after plugin discovery is complete. This prevents \"plugin does not exist\"\n * errors that occur when plugins try to discover entities before cache clearing.\n */\n", "metadata": {"source": "repos/soap_client/soap_client.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapClient", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the interface TokenBrowserTreeBuilderInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\token_browser;\n\nuse Drupal\\token\\TreeBuilderInterface;\n\n/**\n * Defines an interface for token browser tree builder.\n */\ninterface TokenBrowserTreeBuilderInterface extends TreeBuilderInterface {\n}\n", "metadata": {"source": "repos/token_browser/src/TokenBrowserTreeBuilderInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "TokenBrowserTreeBuilderInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Close button\"\ndescription: \"A generic close button for dismissing content like modals and alerts.\"\ngroup: Button\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/components/close-button\"\nvariants:\n  dark:\n    title: Dark\nprops:\n  type: object\n  properties:\n    disabled:\n      title: \"Disabled?\"\n      description: \"Is the button disabled?\"\n      type: boolean\n    aria_label:\n      title: \"Aria label\"\n      description: \"Name of the close button for assistive technology.\"\n      type: string\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/close_button/close_button.component.yml", "type": "yaml_reference", "topic": "close button.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - api_normalization\n    - eca\nid: api_entity_generation_workflow\nlabel: 'API Entity Generation Workflow'\ndescription: 'Automated workflow for generating Drupal entities from validated API schemas'\nversion: 1\nevents:\n  schema_generated:\n    plugin: api_normalization_schema_processing:api_normalization_schema_generated\n    label: 'Schema Generated'\n    description: 'Triggered when a new schema is generated'\n    configuration:\n      event_name: api_normalization.schema_generated\n  field_mapped:\n    plugin: api_normalization_schema_processing:api_normalization_field_mapped\n    label: 'Field Mapped'\n    description: 'Triggered when a field is mapped to Schema.org'\n    configuration:\n      event_name: api_normalization.field_mapped\nconditions:\n  entity_creation_allowed:\n    plugin: eca_entity_field_value\n    label: 'Entity Creation Allowed'\n    description: 'Check if automatic entity creation is enabled'\n    configuration:\n      field_name: field_auto_create_entities\n      field_value: 1\n      comparison: equals\n  mapping_confidence_sufficient:\n    plugin: api_normalization_schema_quality\n    label: 'Mapping Confidence Sufficient'\n    description: 'Verify field mapping confidence is adequate'\n    configuration:\n      schema_source: token\n      quality_metric: mapping_accuracy\n      threshold_operator: gte\n      threshold_value: 75\n      check_mapping_confidence: true\n      min_mapping_confidence: 70\nactions:\n  create_content_type:\n    plugin: eca_entity_save\n    label: 'Create Content Type'\n    description: 'Create a new content type based on schema'\n    configuration:\n      type: node_type\n      values:\n        type: '[schema:machine_name]'\n        name: '[schema:human_name]'\n        description: '[schema:description]'\n        help: 'Content type generated from API schema: [schema:title]'\n  create_fields:\n    plugin: eca_entity_save\n    label: 'Create Entity Fields'\n    description: 'Create fields based on schema properties'\n    configuration:\n      type: field_config\n      values:\n        field_name: '[field:machine_name]'\n        entity_type: node\n        bundle: '[schema:machine_name]'\n        label: '[field:label]'\n        description: '[field:description]'\n        required: '[field:required]'\n        field_type: '[field:drupal_type]'\n  configure_display:\n    plugin: eca_entity_save\n    label: 'Configure Entity Display'\n    description: 'Set up form and view displays for the new entity type'\n    configuration:\n      type: entity_form_display\n      values:\n        targetEntityType: node\n        bundle: '[schema:machine_name]'\n        mode: default\n        content: '[display:form_config]'\n  configure_view_display:\n    plugin: eca_entity_save\n    label: 'Configure View Display'\n    description: 'Configure the view display for the entity'\n    configuration:\n      type: entity_view_display\n      values:\n        targetEntityType: node\n        bundle: '[schema:machine_name]'\n        mode: default\n        content: '[display:view_config]'\n  log_entity_creation:\n    plugin: eca_log\n    label: 'Log Entity Creation'\n    description: 'Log successful entity type creation'\n    configuration:\n      message: 'Created entity type [schema:machine_name] with [field:count] fields'\n      severity: info\n  clear_cache:\n    plugin: eca_misc_cache_clear\n    label: 'Clear Entity Cache'\n    description: 'Clear entity and field caches after creation'\n    configuration:\n      tags:\n        - entity_types\n        - entity_field_info\n        - rendered\ngateways:\n  entity_creation_gate:\n    label: 'Entity Creation Gate'\n    description: 'Check if entities should be automatically created'\n    plugin: condition\n    configuration:\n      condition: entity_creation_allowed\n      negate: false\n  mapping_quality_gate:\n    label: 'Mapping Quality Gate'\n    description: 'Ensure mapping quality meets standards'\n    plugin: condition\n    configuration:\n      condition: mapping_confidence_sufficient\n      negate: false\nmodeller: []\n", "metadata": {"source": "repos/api_normalization/config/optional.disabled/eca.model.api_entity_generation_workflow.yml", "type": "yaml_reference", "topic": "eca.model.api entity generation workflow"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.storage.node.layout_builder__layout\n    - node.type.article\n  module:\n    - layout_builder\nid: node.article.layout_builder__layout\nfield_name: layout_builder__layout\nentity_type: node\nbundle: article\nlabel: Layout\ndescription: ''\nrequired: false\ntranslatable: false\ndefault_value: {  }\ndefault_value_callback: ''\nsettings: {  }\nfield_type: layout_section\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/field.field.node.article.layout_builder__layout.yml", "type": "yaml_reference", "topic": "field.field.node.article.layout builder  layout"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LightgalleryPluginManager.php\nTarget symbol: class LightgalleryPluginManager\nNamespace: Drupal\\lightgallery_formatter\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LightgalleryPluginManager.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\Extension\\ModuleHandlerInterface\n  - Drupal\\Core\\Plugin\\DefaultPluginManager\n  - Drupal\\lightgallery_formatter\\Attribute\\LightgalleryPlugin\n- Ensure these methods exist where relevant:\n  - __construct()\n  - createInstances()\n  - getSortedDefinitions()", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\lightgallery_formatter\\Attribute\\LightgalleryPlugin;\n\n/**\n * Manages discovery and instantiation of LightGallery plugins.\n *\n * LightGallery plugins provide feature-specific configuration for the\n * LightGallery JavaScript library, such as thumbnails, zoom, video, etc.\n *\n * @see \\Drupal\\lightgallery_formatter\\Attribute\\LightgalleryPlugin\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginBase\n * @see plugin_api\n */\nclass LightgalleryPluginManager extends DefaultPluginManager {\n\n  /**\n   * Constructs a LightgalleryPluginManager object.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler) {\n    parent::__construct(\n      'Plugin/Lightgallery',\n      $namespaces,\n      $module_handler,\n      LightgalleryPluginInterface::class,\n      LightgalleryPlugin::class\n    );\n\n    $this->alterInfo('lightgallery_plugin_info');\n    $this->setCacheBackend($cache_backend, 'lightgallery_plugins');\n  }\n\n  /**\n   * Gets all plugin definitions sorted by weight.\n   *\n   * @return array\n   *   An array of plugin definitions sorted by weight.\n   */\n  public function getSortedDefinitions(): array {\n    $definitions = $this->getDefinitions();\n\n    uasort($definitions, function ($a, $b) {\n      return ($a['weight'] ?? 0) <=> ($b['weight'] ?? 0);\n    });\n\n    return $definitions;\n  }\n\n  /**\n   * Creates instances of all plugins with given configurations.\n   *\n   * @param array $plugin_settings\n   *   An array of plugin settings keyed by plugin ID.\n   *\n   * @return \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface[]\n   *   An array of plugin instances keyed by plugin ID.\n   */\n  public function createInstances(array $plugin_settings = []): array {\n    $instances = [];\n    foreach ($this->getSortedDefinitions() as $plugin_id => $definition) {\n      $configuration = $plugin_settings[$plugin_id] ?? [];\n      $instances[$plugin_id] = $this->createInstance($plugin_id, $configuration);\n    }\n    return $instances;\n  }\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/LightgalleryPluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryPluginManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.field.node.lightgallery_demo.field_lightgallery_media\n    - node.type.lightgallery_demo\n  module:\n    - media_library\n  enforced:\n    module:\n      - lightgallery_formatter_demo\nid: node.lightgallery_demo.default\ntargetEntityType: node\nbundle: lightgallery_demo\nmode: default\ncontent:\n  created:\n    type: datetime_timestamp\n    weight: 10\n    region: content\n    settings: {}\n    third_party_settings: {}\n  field_lightgallery_media:\n    type: media_library_widget\n    weight: 5\n    region: content\n    settings:\n      media_types: {}\n    third_party_settings: {}\n  promote:\n    type: boolean_checkbox\n    weight: 15\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {}\n  status:\n    type: boolean_checkbox\n    weight: 120\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {}\n  sticky:\n    type: boolean_checkbox\n    weight: 16\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {}\n  title:\n    type: string_textfield\n    weight: -5\n    region: content\n    settings:\n      size: 60\n      placeholder: ''\n    third_party_settings: {}\n  uid:\n    type: entity_reference_autocomplete\n    weight: 5\n    region: content\n    settings:\n      match_operator: CONTAINS\n      match_limit: 10\n      size: 60\n      placeholder: ''\n    third_party_settings: {}\nhidden: {}\n", "metadata": {"source": "repos/lightgallery_formatter/modules/lightgallery_formatter_demo/config/install/core.entity_form_display.node.lightgallery_demo.default.yml", "type": "yaml_reference", "topic": "core.entity form display.node.lightgallery demo.default"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: pantheon_si_tokens.module\nSource file: <source_file>\nFile name hint: pantheon_si_tokens.module\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\n/**\n * @file\n * Exposes Pantheon Secure Integration PHP constants as Drupal tokens.\n */\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\n\n/**\n * Implements hook_token_info().\n */\nfunction pantheon_si_tokens_token_info(): array\n{\n  $config = \\Drupal::config('pantheon_si_tokens.settings');\n  $constants = $config->get('constants') ?? [];\n\n  $info = [\n    'types' => [\n      'pantheon_si_tunnel' => [\n        'name' => t('Pantheon SI Tunnel'),\n        'description' => t(\n          'Tokens for Pantheon Secure Integration tunnel constants.',\n        ),\n      ],\n    ],\n    'tokens' => ['pantheon_si_tunnel' => []],\n  ];\n\n  foreach ($constants as $constant) {\n    $token_name = strtolower($constant);\n    $info['tokens']['pantheon_si_tunnel'][$token_name] = [\n      'name' => $constant,\n      'description' => t(\n        'Value of the @constant PHP constant.',\n        ['@constant' => $constant],\n      ),\n    ];\n  }\n\n  return $info;\n}\n\n/**\n * Implements hook_tokens().\n */\nfunction pantheon_si_tokens_tokens(\n  string $type,\n  array $tokens,\n  array $data = [],\n  array $options = [],\n  BubbleableMetadata $bubbleable_metadata = NULL,\n): array {\n  $replacements = [];\n\n  if ($type !== 'pantheon_si_tunnel') {\n    return $replacements;\n  }\n\n  $config = \\Drupal::config('pantheon_si_tokens.settings');\n  $constants = $config->get('constants') ?? [];\n\n  foreach ($tokens as $name => $original) {\n    $constant_name = strtoupper($name);\n\n    if (!in_array($constant_name, $constants, TRUE)) {\n      continue;\n    }\n\n    if (defined($constant_name)) {\n      $replacements[$original] = constant($constant_name);\n    }\n    else {\n      $replacements[$original] = '';\n    }\n  }\n\n  return $replacements;\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\n/**\n * @file\n * Exposes Pantheon Secure Integration PHP constants as Drupal tokens.\n */\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\n\n/**\n * Implements hook_token_info().\n */\nfunction pantheon_si_tokens_token_info(): array\n{\n  $config = \\Drupal::config('pantheon_si_tokens.settings');\n  $constants = $config->get('constants') ?? [];\n\n  $info = [\n    'types' => [\n      'pantheon_si_tunnel' => [\n        'name' => t('Pantheon SI Tunnel'),\n        'description' => t(\n          'Tokens for Pantheon Secure Integration tunnel constants.',\n        ),\n      ],\n    ],\n    'tokens' => ['pantheon_si_tunnel' => []],\n  ];\n\n  foreach ($constants as $constant) {\n    $token_name = strtolower($constant);\n    $info['tokens']['pantheon_si_tunnel'][$token_name] = [\n      'name' => $constant,\n      'description' => t(\n        'Value of the @constant PHP constant.',\n        ['@constant' => $constant],\n      ),\n    ];\n  }\n\n  return $info;\n}\n\n/**\n * Implements hook_tokens().\n */\nfunction pantheon_si_tokens_tokens(\n  string $type,\n  array $tokens,\n  array $data = [],\n  array $options = [],\n  BubbleableMetadata $bubbleable_metadata = NULL,\n): array {\n  $replacements = [];\n\n  if ($type !== 'pantheon_si_tunnel') {\n    return $replacements;\n  }\n\n  $config = \\Drupal::config('pantheon_si_tokens.settings');\n  $constants = $config->get('constants') ?? [];\n\n  foreach ($tokens as $name => $original) {\n    $constant_name = strtoupper($name);\n\n    if (!in_array($constant_name, $constants, TRUE)) {\n      continue;\n    }\n\n    if (defined($constant_name)) {\n      $replacements[$original] = constant($constant_name);\n    }\n    else {\n      $replacements[$original] = '';\n    }\n  }\n\n  return $replacements;\n}\n", "metadata": {"source": "repos/pantheon_si_tokens/pantheon_si_tokens.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PantheonSiTokens", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: user_profile_entity_form_display\nlabel: User profile form display configuration\nmigration_tags:\n  - Drupal 6\n  - Drupal 7\n  - Configuration\nsource:\n  plugin: profile_field\n  constants:\n    empty: {}\n    entity_type: user\n    bundle: user\n    form_mode: default\nprocess:\n  entity_type: 'constants/entity_type'\n  bundle: 'constants/bundle'\n  field_name:\n    -\n      plugin: migration_lookup\n      migration: user_profile_field\n      source: fid\n    -\n      plugin: skip_on_empty\n      method: row\n    -\n      plugin: extract\n      index:\n        - 1\n  form_mode: 'constants/form_mode'\n  type:\n    plugin: static_map\n    source: type\n    map:\n      checkbox: boolean_checkbox\n      date: datetime_default\n      list: text_textfield\n      selection: options_select\n      textfield: text_textfield\n      textarea: text_textarea\n      url: link_default\n  options: 'constants/options'\n  'options/type': '@type'\n  'options/settings':\n    plugin: field_instance_widget_settings\n    source:\n      - '@type'\n      - 'constants/empty' # we don't have any settings.\n  'options/settings/display_label':  # Single on/off checkboxes need to have display_label = true otherwise their label doesn't show.\n    plugin: static_map\n    default_value: false\n    source: type\n    map:\n      checkbox: true\n  hidden:\n    plugin: static_map\n    source: visibility\n    default_value: false\n    map:\n      1: true # PROFILE_PRIVATE\n      4: true # PROFILE_HIDDEN\ndestination:\n  plugin: component_entity_form_display\nmigration_dependencies:\n  required:\n    - user_profile_field_instance\n", "metadata": {"source": "repos/drupal_core/core/modules/user/migrations/user_profile_entity_form_display.yml", "type": "yaml_reference", "topic": "user profile entity form display"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: IncrementalForm\nSource file: <source_file>\nFile name hint: IncrementalForm.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\migrate_drupal_ui\\Form;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\Core\\TempStore\\PrivateTempStoreFactory;\nuse Drupal\\migrate\\Plugin\\MigrationPluginManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Migrate Upgrade Incremental form.\n *\n * @internal\n */\nclass IncrementalForm extends MigrateUpgradeFormBase {\n\n  /**\n   * The date formatter service.\n   *\n   * @var \\Drupal\\Core\\Datetime\\DateFormatterInterface\n   */\n  protected $dateFormatter;\n\n  /**\n   * IncrementalForm constructor.\n   *\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state service.\n   * @param \\Drupal\\Core\\Datetime\\DateFormatterInterface $date_formatter\n   *   The date formatter service.\n   * @param \\Drupal\\Core\\TempStore\\PrivateTempStoreFactory $tempstore_private\n   *   The private tempstore factory service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory service.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationPluginManagerInterface $migration_plugin_manager\n   *   The migration plugin manager service.\n   */\n  public function __construct(StateInterface $state, DateFormatterInterface $date_formatter, PrivateTempStoreFactory $tempstore_private, ConfigFactoryInterface $config_factory, MigrationPluginManagerInterface $migration_plugin_manager) {\n    parent::__construct($config_factory, $migration_plugin_manager, $state, $tempstore_private);\n    $this->dateFormatter = $date_formatter;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('state'),\n      $container->get('date.formatter'),\n      $container->get('tempstore.private'),\n      $container->get('config.factory'),\n      $container->get('plugin.manager.migration')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'migrate_drupal_ui_incremental_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    // Get all the data needed for this form.\n    $date_performed = $this->state->get('migrate_drupal_ui.performed');\n\n    // If data is missing or this is the wrong step, start over.\n    if (!$date_performed || $this->store->get('step') != 'incremental') {\n      return $this->restartUpgradeForm();\n    }\n\n    $form = parent::buildForm($form, $form_state);\n    $form['#title'] = $this->t('Upgrade');\n\n    // @todo Add back support for rollbacks.\n    //   https://www.drupal.org/node/2687849\n    $form['upgrade_option_item'] = [\n      '#type' => 'item',\n      '#prefix' => $this->t('An upgrade has already been performed on this site. To perform a new migration, create a clean and empty new install of Drupal @version. Rollbacks are not yet supported through the user interface. For more information, see the <a href=\":url\">upgrading handbook</a>.', [\n        '@version' => $this->destinationSiteVersion,\n        ':url' => 'https://www.drupal.org/upgrade/migrate',\n      ]),\n      '#description' => $this->t('Last upgrade: @date', ['@date' => $this->dateFormatter->format($date_performed)]),\n    ];\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->store->set('step', 'credential');\n    $form_state->setRedirect('migrate_drupal_ui.upgrade_credential');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText() {\n    return $this->t('Import new configuration and content from old site');\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\migrate_drupal_ui\\Form;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\Core\\TempStore\\PrivateTempStoreFactory;\nuse Drupal\\migrate\\Plugin\\MigrationPluginManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Migrate Upgrade Incremental form.\n *\n * @internal\n */\nclass IncrementalForm extends MigrateUpgradeFormBase {\n\n  /**\n   * The date formatter service.\n   *\n   * @var \\Drupal\\Core\\Datetime\\DateFormatterInterface\n   */\n  protected $dateFormatter;\n\n  /**\n   * IncrementalForm constructor.\n   *\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state service.\n   * @param \\Drupal\\Core\\Datetime\\DateFormatterInterface $date_formatter\n   *   The date formatter service.\n   * @param \\Drupal\\Core\\TempStore\\PrivateTempStoreFactory $tempstore_private\n   *   The private tempstore factory service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory service.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationPluginManagerInterface $migration_plugin_manager\n   *   The migration plugin manager service.\n   */\n  public function __construct(StateInterface $state, DateFormatterInterface $date_formatter, PrivateTempStoreFactory $tempstore_private, ConfigFactoryInterface $config_factory, MigrationPluginManagerInterface $migration_plugin_manager) {\n    parent::__construct($config_factory, $migration_plugin_manager, $state, $tempstore_private);\n    $this->dateFormatter = $date_formatter;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('state'),\n      $container->get('date.formatter'),\n      $container->get('tempstore.private'),\n      $container->get('config.factory'),\n      $container->get('plugin.manager.migration')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'migrate_drupal_ui_incremental_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    // Get all the data needed for this form.\n    $date_performed = $this->state->get('migrate_drupal_ui.performed');\n\n    // If data is missing or this is the wrong step, start over.\n    if (!$date_performed || $this->store->get('step') != 'incremental') {\n      return $this->restartUpgradeForm();\n    }\n\n    $form = parent::buildForm($form, $form_state);\n    $form['#title'] = $this->t('Upgrade');\n\n    // @todo Add back support for rollbacks.\n    //   https://www.drupal.org/node/2687849\n    $form['upgrade_option_item'] = [\n      '#type' => 'item',\n      '#prefix' => $this->t('An upgrade has already been performed on this site. To perform a new migration, create a clean and empty new install of Drupal @version. Rollbacks are not yet supported through the user interface. For more information, see the <a href=\":url\">upgrading handbook</a>.', [\n        '@version' => $this->destinationSiteVersion,\n        ':url' => 'https://www.drupal.org/upgrade/migrate',\n      ]),\n      '#description' => $this->t('Last upgrade: @date', ['@date' => $this->dateFormatter->format($date_performed)]),\n    ];\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->store->set('step', 'credential');\n    $form_state->setRedirect('migrate_drupal_ui.upgrade_credential');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText() {\n    return $this->t('Import new configuration and content from old site');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate_drupal_ui/src/Form/IncrementalForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "IncrementalForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the interface ConfigImportModuleUninstallValidatorInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Extension;\n\nuse Drupal\\Core\\Config\\StorageInterface;\n\n/**\n * Special interface for module uninstall validators for configuration import.\n *\n * A module uninstall validator that needs different functionality prior to a\n * configuration import should implement this interface and be defined in\n * a Drupal @link container service @endlink that is tagged\n * module_install.uninstall_validator. If autoconfiguration is enabled, the\n * service will be automatically tagged.\n */\ninterface ConfigImportModuleUninstallValidatorInterface extends ModuleUninstallValidatorInterface {\n\n  /**\n   * Determines reasons a module can not be uninstalled prior to config import.\n   *\n   * @param string $module\n   *   A module name.\n   * @param \\Drupal\\Core\\Config\\StorageInterface $source_storage\n   *   Storage object used to read configuration that is about to be imported.\n   *\n   * @return string[]\n   *   An array of reasons the module can not be uninstalled, empty if it can.\n   *   Each reason should not end with any punctuation since multiple reasons\n   *   can be displayed together.\n   *\n   * @see \\Drupal\\Core\\EventSubscriber\\ConfigImportSubscriber::validateModules()\n   */\n  public function validateConfigImport(string $module, StorageInterface $source_storage): array;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Extension/ConfigImportModuleUninstallValidatorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfigImportModuleUninstallValidatorInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "nexi_xpay.transactions:\n  title: 'Nexi XPay transactions'\n  description: 'Manage Nexi XPay transactions'\n  route_name: entity.nexi_xpay_transaction.collection\n  parent: system.admin_content\n  weight: 30\n\nnexi_xpay.settings:\n  title: 'Nexi XPay Settings'\n  description: 'Configure Nexi XPay integration.'\n  parent: system.admin_config_services\n  route_name: nexi_xpay.settings\n  weight: 100\n", "metadata": {"source": "repos/nexi_xpay/nexi_xpay.links.menu.yml", "type": "yaml_reference", "topic": "nexi xpay.links.menu"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Managing site performance and scalability", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Administering a Drupal site](/docs/administering-a-drupal-site)\n\n* [Getting started with Drupal administration](/docs/administering-a-drupal-site/getting-started-with-drupal-administration)\n* [Managing content](/docs/administering-a-drupal-site/managing-content)\n* [Multilingual guide](/docs/administering-a-drupal-site/multilingual-guide)\n* [Checklist for launching a site](/docs/administering-a-drupal-site/checklist-for-launching-a-site)\n* [Configuration management](/docs/administering-a-drupal-site/configuration-management)\n* [Creating a static archive of a Drupal site](/docs/administering-a-drupal-site/creating-a-static-archive-of-a-drupal-site)\n* [Cron automated tasks](/docs/administering-a-drupal-site/cron-automated-tasks)\n* [Managing site performance and scalability](/docs/administering-a-drupal-site/managing-site-performance-and-scalability)\n* [Node Revisions](/docs/administering-a-drupal-site/node-revisions)\n* [Security in Drupal](/docs/administering-a-drupal-site/security-in-drupal)\n* [Uploaded file management](/docs/administering-a-drupal-site/uploaded-file-management \"Explain how files are managed and clean by Drupal\")\n* [Internal Page Cache](/docs/administering-a-drupal-site/internal-page-cache)\n* [Troubleshooting Drupal](/docs/administering-a-drupal-site/troubleshooting-drupal)\n\n# Managing site performance and scalability\n\nDrupal 8 and later versions, like most modern web frameworks, can scale well to millions of users if it's optimised well. Conversely, a poorly optimised site can be slow to load for a single user. These pages will discuss ways to plan for, and\u00a0improve, site performance in a variety of ways in both the front end and backend.\n\n## [Blazy](/docs/managing-site-performance-and-scalability/blazy)\n\nBlazy module provides integration with bLazy to lazy load and multi-serve images\n\n## [Block bad bots and crawlers](/docs/administering-a-drupal-site/managing-site-performance-and-scalability/block-bad-bots-and-crawlers)\n\nHow to stop your server from being overloaded by aggressive bots and crawlers\n\n## [Content Delivery Network (CDN)](/docs/administering-a-drupal-site/managing-site-performance-and-scalability/content-delivery-network-cdn)\n\nA CDN offloads much of your site delivery to a network of dedicated edge caches.\n\n## [Server Scaling](/docs/administering-a-drupal-site/managing-site-performance-and-scalability/server-scaling)\n\nBenefits and differences of scaling the server hardware vertically & horizontally\n\n## [Site monitoring tools](/docs/managing-site-performance-and-scalability/site-monitoring-tools)\n\nModules and services that that can help you monitor your site's health and performance.\n\n* [Drupal Modules](/docs/managing-site-performance-and-scalability/site-monitoring-tools/drupal-modules)\n* [Drupal Services](/docs/managing-site-performance-and-scalability/site-monitoring-tools/drupal-services)\n* [Self-hosted monitoring tools](/docs/managing-site-performance-and-scalability/site-monitoring-tools/self-hosted-monitoring-tools)\n* [Drupal Sentry (7.x)](/docs/managing-site-performance-and-scalability/site-monitoring-tools/drupal-sentry-7x)\n* [Nagios Drupal Plugin](/docs/managing-site-performance-and-scalability/site-monitoring-tools/nagios-drupal-plugin)\n\n## [Varnish](/docs/administering-a-drupal-site/managing-site-performance-and-scalability/varnish)\n\nVarnish is a reverse proxy caching solution and is frequently used with Drupal.\n\n## [Varnish](/docs/administering-a-drupal-site/managing-site-performance-and-scalability/varnish-0)\n\nVarnish is a reverse proxy caching solution and is frequently used with Drupal.\n\n## Guide maintainers\n\n[![ressa's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-102134-1591606088.png?itok=pQfmx6Sg)](/user/102134 \"View ressa's profile\")\n\n[![naveenvalecha's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-2665733-1663956749.jpg?itok=tSbJLAU3)](/user/2665733 \"View naveenvalecha's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/administering-a-drupal-site/managing-site-performance-and-scalability.md", "type": "doc_summary", "topic": "Managing site performance and scalability"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: AiContextItemListBuilder\nSource file: <source_file>\nFile name hint: AiContextItemListBuilder.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\ai_context;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\n\n/**\n * List builder for AI Context Item content entities.\n */\nfinal class AiContextItemListBuilder extends EntityListBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader(): array {\n    $header['label'] = $this->t('Label');\n    $header['description'] = $this->t('Description');\n    $header['status'] = $this->t('Status');\n    $header['tags'] = $this->t('Tags');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    /** @var \\Drupal\\ai_context\\Entity\\AiContextItem $entity */\n    $row['label'] = $entity->label();\n    $description = $entity->getDescription();\n    // Strip HTML tags from description before truncating.\n    $description = strip_tags($description);\n    $row['description'] = Unicode::truncate($description, 200);\n\n    $row['status'] = $entity->isPublished() ? $this->t('published') : $this->t('not published');\n\n    // Load tag labels instead of showing IDs.\n    $tag_ids = $entity->getTagIds();\n    $tag_labels = [];\n    if (!empty($tag_ids)) {\n      $terms = \\Drupal::entityTypeManager()->getStorage('taxonomy_term')->loadMultiple($tag_ids);\n      foreach ($terms as $term) {\n        $tag_labels[] = $term->label();\n      }\n    }\n    $row['tags'] = implode(', ', $tag_labels);\n\n    // Explicitly build operations to ensure they're included.\n    $row['operations']['data'] = $this->buildOperations($entity);\n\n    return $row;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultOperations(EntityInterface $entity): array {\n    $operations = parent::getDefaultOperations($entity);\n\n    // Add revisions link if user has permission.\n    if ($entity->access('view all revisions')) {\n      $operations['revisions'] = [\n        'title' => $this->t('Revisions'),\n        'weight' => 20,\n        'url' => $entity->toUrl('version-history'),\n      ];\n    }\n\n    return $operations;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(): array {\n    $build = parent::render();\n    $build['#empty'] = $this->t('There are no AI Context Items yet. <a href=\":url\">Add one</a>.', [\n      ':url' => $this->entityType->getLinkTemplate('add-form'),\n    ]);\n    return $build;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\ai_context;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\n\n/**\n * List builder for AI Context Item content entities.\n */\nfinal class AiContextItemListBuilder extends EntityListBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader(): array {\n    $header['label'] = $this->t('Label');\n    $header['description'] = $this->t('Description');\n    $header['status'] = $this->t('Status');\n    $header['tags'] = $this->t('Tags');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    /** @var \\Drupal\\ai_context\\Entity\\AiContextItem $entity */\n    $row['label'] = $entity->label();\n    $description = $entity->getDescription();\n    // Strip HTML tags from description before truncating.\n    $description = strip_tags($description);\n    $row['description'] = Unicode::truncate($description, 200);\n\n    $row['status'] = $entity->isPublished() ? $this->t('published') : $this->t('not published');\n\n    // Load tag labels instead of showing IDs.\n    $tag_ids = $entity->getTagIds();\n    $tag_labels = [];\n    if (!empty($tag_ids)) {\n      $terms = \\Drupal::entityTypeManager()->getStorage('taxonomy_term')->loadMultiple($tag_ids);\n      foreach ($terms as $term) {\n        $tag_labels[] = $term->label();\n      }\n    }\n    $row['tags'] = implode(', ', $tag_labels);\n\n    // Explicitly build operations to ensure they're included.\n    $row['operations']['data'] = $this->buildOperations($entity);\n\n    return $row;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultOperations(EntityInterface $entity): array {\n    $operations = parent::getDefaultOperations($entity);\n\n    // Add revisions link if user has permission.\n    if ($entity->access('view all revisions')) {\n      $operations['revisions'] = [\n        'title' => $this->t('Revisions'),\n        'weight' => 20,\n        'url' => $entity->toUrl('version-history'),\n      ];\n    }\n\n    return $operations;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(): array {\n    $build = parent::render();\n    $build['#empty'] = $this->t('There are no AI Context Items yet. <a href=\":url\">Add one</a>.', [\n      ':url' => $this->entityType->getLinkTemplate('add-form'),\n    ]);\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/ai_context/src/AiContextItemListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AiContextItemListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CacheableHttpException.php\nTarget symbol: class CacheableHttpException\nNamespace: Drupal\\Core\\Http\\Exception\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CacheableHttpException.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheableDependencyInterface\n  - Drupal\\Core\\Cache\\CacheableDependencyTrait\n  - Symfony\\Component\\HttpKernel\\Exception\\HttpException\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "<?php\n\nnamespace Drupal\\Core\\Http\\Exception;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\CacheableDependencyTrait;\nuse Symfony\\Component\\HttpKernel\\Exception\\HttpException;\n\n/**\n * A cacheable HttpException.\n */\nclass CacheableHttpException extends HttpException implements CacheableDependencyInterface {\n\n  use CacheableDependencyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(CacheableDependencyInterface $cacheability, $statusCode = 0, $message = '', ?\\Throwable $previous = NULL, array $headers = [], $code = 0) {\n    $this->setCacheability($cacheability);\n    parent::__construct($statusCode, $message, $previous, $headers, $code);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Http/Exception/CacheableHttpException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CacheableHttpException", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class RunCron in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_cron\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_cron\\Service\\CronService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_cron_run',\n  label: new TranslatableMarkup('Run Cron'),\n  description: new TranslatableMarkup('Execute all cron jobs immediately.'),\n  operation: ToolOperation::Write,\n  input_definitions: [],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'duration_seconds' => new ContextDefinition(\n      data_type: 'float',\n      label: new TranslatableMarkup('Duration in seconds'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass RunCron extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'cron';\n\n\n  protected CronService $cronService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->cronService = $container->get('mcp_tools_cron.cron_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access (running cron is a write operation).\n    $accessCheck = $this->accessManager->checkWriteAccess('run', 'cron');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $result = $this->cronService->runCron();\n\n    if ($result['success']) {\n      $this->auditLogger->log('run', 'cron', 'all', [\n        'duration' => $result['duration_seconds'] ?? 0,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_cron/src/Plugin/tool/Tool/RunCron.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RunCron", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.mcp_server.add_form:\n  route_name: 'entity.mcp_server.add_form'\n  title: 'Add MCP Server'\n  appears_on:\n    - entity.mcp_server.collection\n", "metadata": {"source": "repos/mcp_client/mcp_client.links.action.yml", "type": "yaml_reference", "topic": "mcp client.links.action"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'API Normalizer Core'\ntype: module\ndescription: 'Core API response normalization for multi-provider AI services - submodule of API Normalizer'\ncore_version_requirement: \"^10 || ^11\"\npackage: \"API Normalization\"\nconfigure: api_normalization_core.settings\nhidden: true\n\ndependencies:\n  - api_normalization:api_normalization\n\n# Optional dependencies that enhance functionality\nsuggests:\n  - drupal:ai\n  - llm:llm\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_core/api_normalization_core.info.yml", "type": "yaml_reference", "topic": "api normalization core.info"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BookUninstallValidator.php\nTarget symbol: class for\nNamespace: Drupal\\book\\ProxyClass {\n\n    /**\n     * Provides a proxy class for \\Drupal\\book\\BookUninstallValidator.\n     *\n     * @see \\Drupal\\Component\\ProxyBuilder\n     */\n    class BookUninstallValidator implements \\Drupal\\Core\\Extension\\ModuleUninstallValidatorInterface\n    {\n\n        use \\Drupal\\Core\\DependencyInjection\\DependencySerializationTrait\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Ensure these methods exist where relevant:\n  - __construct()\n  - lazyLoadItself()\n  - setStringTranslation()\n  - validate()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n// phpcs:ignoreFile\n\n/**\n * This file was generated via php core/scripts/generate-proxy-class.php 'Drupal\\book\\BookUninstallValidator' \"core/modules/book/src\".\n */\n\nnamespace Drupal\\book\\ProxyClass {\n\n    /**\n     * Provides a proxy class for \\Drupal\\book\\BookUninstallValidator.\n     *\n     * @see \\Drupal\\Component\\ProxyBuilder\n     */\n    class BookUninstallValidator implements \\Drupal\\Core\\Extension\\ModuleUninstallValidatorInterface\n    {\n\n        use \\Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\n\n        /**\n         * The id of the original proxied service.\n         *\n         * @var string\n         */\n        protected $drupalProxyOriginalServiceId;\n\n        /**\n         * The real proxied service, after it was lazy loaded.\n         *\n         * @var \\Drupal\\book\\BookUninstallValidator\n         */\n        protected $service;\n\n        /**\n         * The service container.\n         *\n         * @var \\Symfony\\Component\\DependencyInjection\\ContainerInterface\n         */\n        protected $container;\n\n        /**\n         * Constructs a ProxyClass Drupal proxy object.\n         *\n         * @param \\Symfony\\Component\\DependencyInjection\\ContainerInterface $container\n         *   The container.\n         * @param string $drupal_proxy_original_service_id\n         *   The service ID of the original service.\n         */\n        public function __construct(\\Symfony\\Component\\DependencyInjection\\ContainerInterface $container, $drupal_proxy_original_service_id)\n        {\n            $this->container = $container;\n            $this->drupalProxyOriginalServiceId = $drupal_proxy_original_service_id;\n        }\n\n        /**\n         * Lazy loads the real service from the container.\n         *\n         * @return object\n         *   Returns the constructed real service.\n         */\n        protected function lazyLoadItself()\n        {\n            if (!isset($this->service)) {\n                $this->service = $this->container->get($this->drupalProxyOriginalServiceId);\n            }\n\n            return $this->service;\n        }\n\n        /**\n         * {@inheritdoc}\n         */\n        public function validate($module)\n        {\n            return $this->lazyLoadItself()->validate($module);\n        }\n\n        /**\n         * {@inheritdoc}\n         */\n        public function setStringTranslation(\\Drupal\\Core\\StringTranslation\\TranslationInterface $translation)\n        {\n            return $this->lazyLoadItself()->setStringTranslation($translation);\n        }\n\n    }\n\n}\n", "metadata": {"source": "repos/livre/book/src/ProxyClass/BookUninstallValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookUninstallValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ConfigurableLanguageRenderer\nSource file: <source_file>\nFile name hint: ConfigurableLanguageRenderer.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views\\Entity\\Render;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\views\\ResultRow;\nuse Drupal\\views\\ViewExecutable;\n\n/**\n * Renders entities in a configured language.\n */\nclass ConfigurableLanguageRenderer extends EntityTranslationRendererBase {\n\n  /**\n   * A specific language code for rendering if available.\n   *\n   * @var string|null\n   */\n  protected $langcode;\n\n  /**\n   * Constructs a renderer object.\n   *\n   * @param \\Drupal\\views\\ViewExecutable $view\n   *   The entity row being rendered.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string|null $langcode\n   *   A specific language code to set, if available.\n   */\n  public function __construct(ViewExecutable $view, LanguageManagerInterface $language_manager, EntityTypeInterface $entity_type, $langcode) {\n    parent::__construct($view, $language_manager, $entity_type);\n    $this->langcode = $langcode;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLangcode(ResultRow $row) {\n    return $this->langcode;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Entity\\Render;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\views\\ResultRow;\nuse Drupal\\views\\ViewExecutable;\n\n/**\n * Renders entities in a configured language.\n */\nclass ConfigurableLanguageRenderer extends EntityTranslationRendererBase {\n\n  /**\n   * A specific language code for rendering if available.\n   *\n   * @var string|null\n   */\n  protected $langcode;\n\n  /**\n   * Constructs a renderer object.\n   *\n   * @param \\Drupal\\views\\ViewExecutable $view\n   *   The entity row being rendered.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string|null $langcode\n   *   A specific language code to set, if available.\n   */\n  public function __construct(ViewExecutable $view, LanguageManagerInterface $language_manager, EntityTypeInterface $entity_type, $langcode) {\n    parent::__construct($view, $language_manager, $entity_type);\n    $this->langcode = $langcode;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLangcode(ResultRow $row) {\n    return $this->langcode;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Entity/Render/ConfigurableLanguageRenderer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigurableLanguageRenderer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class NodeTypeListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\node;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Entity\\EntityInterface;\n\n/**\n * Defines a class to build a listing of node type entities.\n *\n * @see \\Drupal\\node\\Entity\\NodeType\n */\nclass NodeTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    $header['title'] = $this->t('Name');\n    $header['description'] = [\n      'data' => $this->t('Description'),\n      'class' => [RESPONSIVE_PRIORITY_MEDIUM],\n    ];\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    $row['title'] = [\n      'data' => $entity->label(),\n      'class' => ['menu-label'],\n    ];\n    $row['description']['data'] = ['#markup' => $entity->getDescription()];\n    return $row + parent::buildRow($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultOperations(EntityInterface $entity/* , ?CacheableMetadata $cacheability = NULL */) {\n    $operations = parent::getDefaultOperations($entity);\n    // Place the edit operation after the operations added by field_ui.module\n    // which have the weights 15, 20, 25.\n    if (isset($operations['edit'])) {\n      $operations['edit']['weight'] = 30;\n    }\n    return $operations;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    $build = parent::render();\n    $build['table']['#empty'] = $this->t('No content types available. <a href=\":link\">Add content type</a>.', [\n      ':link' => Url::fromRoute('node.type_add')->toString(),\n    ]);\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/node/src/NodeTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeTypeListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DepthLimitSubscriber\nSource file: <source_file>\nFile name hint: DepthLimitSubscriber.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\jsonapi_security\\EventSubscriber;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\jsonapi_security\\Service\\JsonApiHelper;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\HttpKernel\\Event\\RequestEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\BadRequestHttpException;\nuse Symfony\\Component\\HttpKernel\\KernelEvents;\n\n/**\n * Enforces a maximum depth for JSON:API include queries.\n */\nclass DepthLimitSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new DepthLimitSubscriber.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory.\n   * @param \\Symfony\\Component\\EventDispatcher\\EventDispatcherInterface $eventDispatcher\n   *   The event dispatcher.\n   * @param \\Drupal\\jsonapi_security\\Service\\JsonApiHelper $helper\n   *   The JSON:API helper.\n   */\n  public function __construct(\n    protected readonly ConfigFactoryInterface $configFactory,\n    protected readonly EventDispatcherInterface $eventDispatcher,\n    protected readonly JsonApiHelper $helper,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      KernelEvents::REQUEST => ['onRequest', 0],\n    ];\n  }\n\n  /**\n   * Limits the depth of include queries.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\RequestEvent $event\n   *   The request event.\n   */\n  public function onRequest(RequestEvent $event): void {\n    $request = $event->getRequest();\n\n    // Only process JSON:API requests.\n    if (!$this->helper->isJsonApiRequest($request->getPathInfo())) {\n      return;\n    }\n\n    $config = $this->configFactory->get('jsonapi_security.settings');\n\n    if (!$config->get('limit_query_depth')) {\n      return;\n    }\n\n    $include = $request->query->get('include');\n    if (empty($include)) {\n      return;\n    }\n\n    $maxDepth = $config->get('max_depth') ?? 2;\n\n    // Check for overrides.\n    $overrides = $config->get('depth_overrides') ?? [];\n    if (!empty($overrides)) {\n      $resourceType = $this->helper->extractResourceType($request->getPathInfo());\n      $maxDepth = $this->getMaxDepthInitial($resourceType, $overrides, $maxDepth);\n    }\n\n    $includes = explode(',', $include);\n    foreach ($includes as $fieldPath) {\n      $depth = substr_count($fieldPath, '.');\n      if ($depth > ($maxDepth - 1)) {\n        throw new BadRequestHttpException(sprintf(\n          'The include parameter exceeds the maximum allowed depth of %d.',\n          $maxDepth\n        ));\n      }\n    }\n  }\n\n  /**\n   * Gets the maximum depth for a resource type.\n   *\n   * @param string $resourceType\n   *   The resource type.\n   * @param array $overrides\n   *   The depth overrides.\n   * @param int $default\n   *   The default max depth.\n   *\n   * @return int\n   *   The max depth.\n   */\n  protected function getMaxDepthInitial(string $resourceType, array $overrides, int $default): int {\n    foreach ($overrides as $override) {\n      [$type, $depth] = explode(':', $override);\n      if ($type === $resourceType) {\n        return (int) $depth;\n      }\n    }\n    return $default;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\jsonapi_security\\EventSubscriber;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\jsonapi_security\\Service\\JsonApiHelper;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\HttpKernel\\Event\\RequestEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\BadRequestHttpException;\nuse Symfony\\Component\\HttpKernel\\KernelEvents;\n\n/**\n * Enforces a maximum depth for JSON:API include queries.\n */\nclass DepthLimitSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new DepthLimitSubscriber.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory.\n   * @param \\Symfony\\Component\\EventDispatcher\\EventDispatcherInterface $eventDispatcher\n   *   The event dispatcher.\n   * @param \\Drupal\\jsonapi_security\\Service\\JsonApiHelper $helper\n   *   The JSON:API helper.\n   */\n  public function __construct(\n    protected readonly ConfigFactoryInterface $configFactory,\n    protected readonly EventDispatcherInterface $eventDispatcher,\n    protected readonly JsonApiHelper $helper,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      KernelEvents::REQUEST => ['onRequest', 0],\n    ];\n  }\n\n  /**\n   * Limits the depth of include queries.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\RequestEvent $event\n   *   The request event.\n   */\n  public function onRequest(RequestEvent $event): void {\n    $request = $event->getRequest();\n\n    // Only process JSON:API requests.\n    if (!$this->helper->isJsonApiRequest($request->getPathInfo())) {\n      return;\n    }\n\n    $config = $this->configFactory->get('jsonapi_security.settings');\n\n    if (!$config->get('limit_query_depth')) {\n      return;\n    }\n\n    $include = $request->query->get('include');\n    if (empty($include)) {\n      return;\n    }\n\n    $maxDepth = $config->get('max_depth') ?? 2;\n\n    // Check for overrides.\n    $overrides = $config->get('depth_overrides') ?? [];\n    if (!empty($overrides)) {\n      $resourceType = $this->helper->extractResourceType($request->getPathInfo());\n      $maxDepth = $this->getMaxDepthInitial($resourceType, $overrides, $maxDepth);\n    }\n\n    $includes = explode(',', $include);\n    foreach ($includes as $fieldPath) {\n      $depth = substr_count($fieldPath, '.');\n      if ($depth > ($maxDepth - 1)) {\n        throw new BadRequestHttpException(sprintf(\n          'The include parameter exceeds the maximum allowed depth of %d.',\n          $maxDepth\n        ));\n      }\n    }\n  }\n\n  /**\n   * Gets the maximum depth for a resource type.\n   *\n   * @param string $resourceType\n   *   The resource type.\n   * @param array $overrides\n   *   The depth overrides.\n   * @param int $default\n   *   The default max depth.\n   *\n   * @return int\n   *   The max depth.\n   */\n  protected function getMaxDepthInitial(string $resourceType, array $overrides, int $default): int {\n    foreach ($overrides as $override) {\n      [$type, $depth] = explode(':', $override);\n      if ($type === $resourceType) {\n        return (int) $depth;\n      }\n    }\n    return $default;\n  }\n\n}\n", "metadata": {"source": "repos/jsonapi_security/src/EventSubscriber/DepthLimitSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DepthLimitSubscriber", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Telephone\ntype: module\ndescription: 'Defines a field type for telephone numbers.'\npackage: Field types\nversion: VERSION\ndependencies:\n  - drupal:field\n", "metadata": {"source": "repos/drupal_core/core/modules/telephone/telephone.info.yml", "type": "yaml_reference", "topic": "telephone.info"}}
{"instruction": "Show me the implementation of the class EventBroadcaster in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\RealTime;\n\nuse Psr\\Log\\LoggerInterface;\nuse Drupal\\flowdrop_runtime\\DTO\\RealTime\\RealTimeEvent;\nuse Drupal\\Core\\Logger\\LoggerChannelFactoryInterface;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Symfony\\Component\\EventDispatcher\\GenericEvent;\n\n/**\n * Broadcasts real-time events to connected clients.\n */\nclass EventBroadcaster {\n\n  /**\n   * Logger channel for this service.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  private readonly LoggerInterface $logger;\n\n  public function __construct(\n    LoggerChannelFactoryInterface $loggerFactory,\n    private readonly EventDispatcherInterface $eventDispatcher,\n  ) {\n    $this->logger = $loggerFactory->get('flowdrop_runtime');\n  }\n\n  /**\n   * Broadcast a real-time event.\n   */\n  public function broadcast(RealTimeEvent $event): void {\n    // Ensure all log values are strings to prevent Html::escape() errors.\n    // Convert to string to handle any edge cases where values might be null.\n    $type = (string) $event->getType();\n    $eventName = (string) $event->getEvent();\n    $executionId = (string) $event->getExecutionId();\n    $nodeId = $event->getNodeId() !== NULL ? (string) $event->getNodeId() : \"\";\n\n    $this->logger->debug('Broadcasting real-time event: @type:@event for @execution_id', [\n      '@type' => $type,\n      '@event' => $eventName,\n      '@execution_id' => $executionId,\n    ]);\n\n    // Dispatch Drupal event for other modules to listen to.\n    $drupalEvent = new GenericEvent($event, [\n      'type' => $event->getType(),\n      'execution_id' => $event->getExecutionId(),\n      'event' => $event->getEvent(),\n      'data' => $event->getData(),\n      'timestamp' => $event->getTimestamp(),\n      'node_id' => $event->getNodeId(),\n    ]);\n\n    $this->eventDispatcher->dispatch($drupalEvent, 'flowdrop_runtime.real_time_event');\n\n    // Log the event for debugging.\n    $this->logger->info('Real-time event broadcasted: @type:@event', [\n      '@type' => $type,\n      '@event' => $eventName,\n      '@execution_id' => $executionId,\n      '@node_id' => $nodeId,\n    ]);\n  }\n\n  /**\n   * Broadcast execution started event.\n   */\n  public function broadcastExecutionStarted(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'started',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast execution completed event.\n   */\n  public function broadcastExecutionCompleted(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'completed',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast execution failed event.\n   */\n  public function broadcastExecutionFailed(string $executionId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'execution',\n      executionId: $executionId,\n      event: 'failed',\n      data: $data,\n      timestamp: time(),\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node started event.\n   */\n  public function broadcastNodeStarted(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',\n      executionId: $executionId,\n      event: 'started',\n      data: $data,\n      timestamp: time(),\n      nodeId: $nodeId,\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node completed event.\n   */\n  public function broadcastNodeCompleted(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',\n      executionId: $executionId,\n      event: 'completed',\n      data: $data,\n      timestamp: time(),\n      nodeId: $nodeId,\n    );\n\n    $this->broadcast($event);\n  }\n\n  /**\n   * Broadcast node failed event.\n   */\n  public function broadcastNodeFailed(string $executionId, string $nodeId, array $data = []): void {\n    $event = new RealTimeEvent(\n      type: 'node',\n      executionId: $executionId,\n      event: 'failed',\n      data: $data,\n      timestamp: time(),\n      nodeId: $nodeId,\n    );\n\n    $this->broadcast($event);\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/RealTime/EventBroadcaster.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EventBroadcaster", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RegisterEntityResolversCompilerPass in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\serialization;\n\nuse Symfony\\Component\\DependencyInjection\\Reference;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\n\n/**\n * Adds services tagged 'entity_resolver' to the Serializer.\n */\nclass RegisterEntityResolversCompilerPass implements CompilerPassInterface {\n\n  /**\n   * Adds services to the Serializer.\n   *\n   * @param \\Symfony\\Component\\DependencyInjection\\ContainerBuilder $container\n   *   The container to process.\n   */\n  public function process(ContainerBuilder $container): void {\n    $definition = $container->getDefinition('serializer.entity_resolver');\n    $resolvers = [];\n\n    // Retrieve registered Normalizers and Encoders from the container.\n    foreach ($container->findTaggedServiceIds('entity_resolver') as $id => $attributes) {\n      $priority = $attributes[0]['priority'] ?? 0;\n      $resolvers[$priority][] = new Reference($id);\n    }\n\n    // Add the registered concrete EntityResolvers to the ChainEntityResolver.\n    foreach ($this->sort($resolvers) as $resolver) {\n      $definition->addMethodCall('addResolver', [$resolver]);\n    }\n  }\n\n  /**\n   * Sorts by priority.\n   *\n   * Order services from highest priority number to lowest (reverse sorting).\n   *\n   * @param array $services\n   *   A nested array keyed on priority number. For each priority number, the\n   *   value is an array of Symfony\\Component\\DependencyInjection\\Reference\n   *   objects, each a reference to a normalizer or encoder service.\n   *\n   * @return array\n   *   A flattened array of Reference objects from $services, ordered from high\n   *   to low priority.\n   */\n  protected function sort($services) {\n    krsort($services);\n    return array_merge(...$services);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/RegisterEntityResolversCompilerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegisterEntityResolversCompilerPass", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 trait implementation and return corrected PHP code.", "input": "Symbol: ModulesEnabledTrait\nSource file: <source_file>\nFile name hint: ModulesEnabledTrait.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\PreExistingConfigException;\nuse Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\n\n/**\n * Provides helpers for enabling modules.\n *\n * @internal\n */\ntrait ModulesEnabledTrait {\n\n  use StringTranslationTrait;\n\n  /**\n   * Gets the current user.\n   *\n   * @return \\Drupal\\Core\\Session\\AccountInterface\n   *   The current user.\n   */\n  abstract function currentUser();\n\n  /**\n   * Provides a confirmation message after modules have been enabled.\n   *\n   * @param string[] $modules\n   *   Enabled module names, keyed by machine names.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup\n   *   A confirmation message. If any of the enabled modules have permissions\n   *   that the current user can manage, then include a link to the permissions\n   *   page for those modules.\n   */\n  protected function modulesEnabledConfirmationMessage(array $modules): PluralTranslatableMarkup {\n    $machine_names = implode(',', array_keys($modules));\n    $url = Url::fromRoute('user.admin_permissions.module', ['modules' => $machine_names]);\n    $module_names = implode(', ', array_values($modules));\n    $t_args = ['%name' => $module_names, '%names' => $module_names];\n\n    if ($url->access($this->currentUser())) {\n      return $this->formatPlural(\n        count($modules),\n        'Module %name has been installed. Configure <a href=\":link\">related permissions</a>.',\n        '@count modules have been installed: %names. Configure <a href=\":link\">related permissions</a>.',\n        $t_args + [':link' => $url->toString()]\n      );\n    }\n\n    return $this->formatPlural(\n      count($modules),\n      'Module %name has been installed.',\n      '@count modules have been installed: %names.',\n      $t_args\n    );\n  }\n\n  /**\n   * Provides a fail message after attempt to install a module.\n   *\n   * @param string[] $modules\n   *   Enabled module names, keyed by machine names.\n   * @param \\Drupal\\Core\\Config\\PreExistingConfigException $exception\n   *   Exception thrown if configuration with the same name already exists.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup\n   *   A confirmation message. If any of the enabled modules have permissions\n   *   that the current user can manage, then include a link to the permissions\n   *   page for those modules.\n   */\n  protected function modulesFailToEnableMessage(array $modules, PreExistingConfigException $exception): PluralTranslatableMarkup {\n    $config_objects = $exception->flattenConfigObjects($exception->getConfigObjects());\n    return $this->formatPlural(\n      count($config_objects),\n      'Unable to install @extension, %config_names already exists in active configuration.',\n      'Unable to install @extension, %config_names already exist in active configuration.',\n      [\n        '%config_names' => implode(', ', $config_objects),\n        '@extension' => $modules['install'][$exception->getExtension()],\n      ]);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\PreExistingConfigException;\nuse Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\n\n/**\n * Provides helpers for enabling modules.\n *\n * @internal\n */\ntrait ModulesEnabledTrait {\n\n  use StringTranslationTrait;\n\n  /**\n   * Gets the current user.\n   *\n   * @return \\Drupal\\Core\\Session\\AccountInterface\n   *   The current user.\n   */\n  abstract protected function currentUser();\n\n  /**\n   * Provides a confirmation message after modules have been enabled.\n   *\n   * @param string[] $modules\n   *   Enabled module names, keyed by machine names.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup\n   *   A confirmation message. If any of the enabled modules have permissions\n   *   that the current user can manage, then include a link to the permissions\n   *   page for those modules.\n   */\n  protected function modulesEnabledConfirmationMessage(array $modules): PluralTranslatableMarkup {\n    $machine_names = implode(',', array_keys($modules));\n    $url = Url::fromRoute('user.admin_permissions.module', ['modules' => $machine_names]);\n    $module_names = implode(', ', array_values($modules));\n    $t_args = ['%name' => $module_names, '%names' => $module_names];\n\n    if ($url->access($this->currentUser())) {\n      return $this->formatPlural(\n        count($modules),\n        'Module %name has been installed. Configure <a href=\":link\">related permissions</a>.',\n        '@count modules have been installed: %names. Configure <a href=\":link\">related permissions</a>.',\n        $t_args + [':link' => $url->toString()]\n      );\n    }\n\n    return $this->formatPlural(\n      count($modules),\n      'Module %name has been installed.',\n      '@count modules have been installed: %names.',\n      $t_args\n    );\n  }\n\n  /**\n   * Provides a fail message after attempt to install a module.\n   *\n   * @param string[] $modules\n   *   Enabled module names, keyed by machine names.\n   * @param \\Drupal\\Core\\Config\\PreExistingConfigException $exception\n   *   Exception thrown if configuration with the same name already exists.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\PluralTranslatableMarkup\n   *   A confirmation message. If any of the enabled modules have permissions\n   *   that the current user can manage, then include a link to the permissions\n   *   page for those modules.\n   */\n  protected function modulesFailToEnableMessage(array $modules, PreExistingConfigException $exception): PluralTranslatableMarkup {\n    $config_objects = $exception->flattenConfigObjects($exception->getConfigObjects());\n    return $this->formatPlural(\n      count($config_objects),\n      'Unable to install @extension, %config_names already exists in active configuration.',\n      'Unable to install @extension, %config_names already exist in active configuration.',\n      [\n        '%config_names' => implode(', ', $config_objects),\n        '@extension' => $modules['install'][$exception->getExtension()],\n      ]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/ModulesEnabledTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "ModulesEnabledTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the trait AssertMailTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Test;\n\nuse Drupal\\Component\\Render\\FormattableMarkup;\n\n/**\n * Provides methods for testing emails sent during test runs.\n */\ntrait AssertMailTrait {\n\n  /**\n   * Gets an array containing all emails sent during this test case.\n   *\n   * @param array $filter\n   *   An array containing key/value pairs used to filter the emails that are\n   *   returned.\n   *\n   * @return array\n   *   An array containing email messages captured during the current test.\n   */\n  protected function getMails(array $filter = []) {\n    $captured_emails = $this->container->get('state')->get('system.test_mail_collector', []);\n    $filtered_emails = [];\n\n    foreach ($captured_emails as $message) {\n      foreach ($filter as $key => $value) {\n        if (!isset($message[$key]) || $message[$key] != $value) {\n          continue 2;\n        }\n      }\n      $filtered_emails[] = $message;\n    }\n\n    return $filtered_emails;\n  }\n\n  /**\n   * Asserts that the most recently sent email message has the given value.\n   *\n   * The field in $name must have the content described in $value.\n   *\n   * @param string $name\n   *   Name of field or message property to assert. Examples: subject, body,\n   *   id, ...\n   * @param string $value\n   *   Value of the field to assert.\n   * @param string $message\n   *   (optional) A message to display with the assertion. Do not translate\n   *   messages with t(). Use double quotes and embed variables directly in\n   *   message text, or use sprintf() if necessary. Avoid the use of\n   *   \\Drupal\\Component\\Render\\FormattableMarkup unless you cast the object to\n   *   a string. If left blank, a default message will be displayed.\n   *\n   * @return bool\n   *   TRUE on pass.\n   */\n  protected function assertMail($name, $value = '', $message = '') {\n    $captured_emails = $this->container->get('state')->get('system.test_mail_collector') ?: [];\n    $email = end($captured_emails);\n    $this->assertIsArray($email, $message);\n    $this->assertArrayHasKey($name, $email, $message);\n    $this->assertEquals($value, $email[$name], $message);\n    return TRUE;\n  }\n\n  /**\n   * Asserts that the most recently sent email message has the string in it.\n   *\n   * @param string $field_name\n   *   Name of field or message property to assert: subject, body, id, ...\n   * @param string $string\n   *   String to search for.\n   * @param int $email_depth\n   *   Number of emails to search for string, starting with most recent.\n   * @param string $message\n   *   (optional) A message to display with the assertion. Do not translate\n   *   messages with t(). Use double quotes and embed variables directly in\n   *   message text, or use sprintf() if necessary. Avoid the use of\n   *   \\Drupal\\Component\\Render\\FormattableMarkup unless you cast the object to\n   *   a string. If left blank, a default message will be displayed.\n   */\n  protected function assertMailString($field_name, $string, $email_depth, $message = '') {\n    $mails = $this->getMails();\n    $string_found = FALSE;\n    // Cast MarkupInterface objects to string.\n    $string = (string) $string;\n    for ($i = count($mails) - 1; $i >= count($mails) - $email_depth && $i >= 0; $i--) {\n      $mail = $mails[$i];\n      // Normalize whitespace, as we don't know what the mail system might have\n      // done. Any run of whitespace becomes a single space.\n      $normalized_mail = preg_replace('/\\s+/', ' ', $mail[$field_name]);\n      $normalized_string = preg_replace('/\\s+/', ' ', $string);\n      $string_found = str_contains($normalized_mail, $normalized_string);\n      if ($string_found) {\n        break;\n      }\n    }\n    if (!$message) {\n      $message = new FormattableMarkup('Expected text found in @field of email message: \"@expected\".', [\n        '@field' => $field_name,\n        '@expected' => $string,\n      ]);\n    }\n    $this->assertTrue($string_found, $message);\n  }\n\n  /**\n   * Asserts that the most recently sent email message has the pattern in it.\n   *\n   * @param string $field_name\n   *   Name of field or message property to assert: subject, body, id, ...\n   * @param string $regex\n   *   Pattern to search for.\n   * @param string $message\n   *   (optional) A message to display with the assertion. Do not translate\n   *   messages with t(). Use double quotes and embed variables directly in\n   *   message text, or use sprintf() if necessary. Avoid the use of\n   *   \\Drupal\\Component\\Render\\FormattableMarkup unless you cast the object to\n   *   a string. If left blank, a default message will be displayed.\n   */\n  protected function assertMailPattern($field_name, $regex, $message = '') {\n    $mails = $this->getMails();\n    $mail = end($mails);\n    $regex_found = preg_match(\"/$regex/\", $mail[$field_name]);\n    if (!$message) {\n      $message = new FormattableMarkup('Expected text found in @field of email message: \"@expected\".', [\n        '@field' => $field_name,\n        '@expected' => $regex,\n      ]);\n    }\n    $this->assertTrue((bool) $regex_found, $message);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Test/AssertMailTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "AssertMailTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class IslandFormBase in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Form;\n\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\display_builder\\IslandWithFormInterface;\n\n/**\n * Provides a display builder form for island plugin.\n */\nfinal class IslandFormBase extends FormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'display_builder_island';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $island_args = $form_state->getBuildInfo()['args'][0];\n    $plugin = IslandFormBase::getPlugin($island_args);\n\n    if (!$plugin instanceof IslandWithFormInterface) {\n      return $form;\n    }\n    $plugin->setBuilderId($island_args['builder_id']);\n    $plugin->buildForm($form, $form_state);\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state): void {\n    $island_args = $form_state->getBuildInfo()['args'][0];\n    $plugin = IslandFormBase::getPlugin($island_args);\n\n    if (!$plugin instanceof IslandWithFormInterface) {\n      return;\n    }\n    $plugin->validateForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $island_args = $form_state->getBuildInfo()['args'][0];\n    $plugin = IslandFormBase::getPlugin($island_args);\n\n    if (!$plugin instanceof IslandWithFormInterface) {\n      return;\n    }\n    $plugin->submitForm($form, $form_state);\n  }\n\n  /**\n   * Get Island plugin.\n   *\n   * @param array $args\n   *   Arguments from form_state which allow to load plugin.\n   *\n   * @return object|\\Drupal\\display_builder\\IslandInterface\n   *   The Island plugin.\n   */\n  protected static function getPlugin(array $args) {\n    return \\Drupal::service('plugin.manager.db_island')->createInstance($args['island_id'], $args['instance']);\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Form/IslandFormBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "IslandFormBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "################\n# GitLabCI template for Drupal projects.\n#\n# This template is designed to give any Contrib maintainer everything\n# they need to test, without requiring modification. It is also\n# designed to keep up to date with Core Development automatically\n# through the use of include files that can be centrally maintained.\n#\n# For full documentation, see:\n# https://project.pages.drupalcode.org/gitlab_templates/\n################\n\ninclude:\n  - project: $_GITLAB_TEMPLATES_REPO\n    ref: $_GITLAB_TEMPLATES_REF\n    file:\n      - \"/includes/include.drupalci.main.yml\"\n      - \"/includes/include.drupalci.variables.yml\"\n      - \"/includes/include.drupalci.workflows.yml\"\n\n################\n# Pipeline configuration variables\n#\n# Default values and descriptions can be found at:\n# https://git.drupalcode.org/project/gitlab_templates/-/blob/main/\n#   includes/include.drupalci.variables.yml\n################\nvariables:\n  # Test against previous/next major and minor versions\n  OPT_IN_TEST_PREVIOUS_MAJOR: 1\n  OPT_IN_TEST_PREVIOUS_MINOR: 1\n  OPT_IN_TEST_NEXT_MINOR: 1\n  OPT_IN_TEST_NEXT_MAJOR: 1\n  OPT_IN_TEST_MAX_PHP: 1\n", "metadata": {"source": "repos/pantheon_si_tokens/.gitlab-ci.yml", "type": "yaml_reference", "topic": ".gitlab-ci"}}
{"instruction": "Show me the implementation of the class UserLogoutConfirm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\user\\Form;\n\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Form\\WorkspaceSafeFormInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\n\n/**\n * Provides a confirmation form for user logout.\n */\nclass UserLogoutConfirm extends ConfirmFormBase implements WorkspaceSafeFormInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText(): TranslatableMarkup {\n    return $this->t('Log out');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription() {\n    // phpcs:ignore Drupal.Semantics.FunctionT.EmptyString\n    return $this->t('');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion(): TranslatableMarkup {\n    return $this->t('Are you sure you want to log out?');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl(): Url {\n    return new Url('<front>');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'user_logout_confirm';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    user_logout();\n    $form_state->setRedirect('<front>');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Form/UserLogoutConfirm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserLogoutConfirm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class UploadedFileConstraint in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint;\n\n/**\n * A constraint for UploadedFile objects.\n */\nclass UploadedFileConstraint extends Constraint {\n\n  /**\n   * The upload max size. Defaults to checking the environment.\n   */\n  public ?int $maxSize = NULL;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?int $maxSize = NULL,\n    public string $uploadIniSizeErrorMessage = 'The file %file could not be saved because it exceeds %maxsize, the maximum allowed size for uploads.',\n    public string $uploadFormSizeErrorMessage = 'The file %file could not be saved because it exceeds %maxsize, the maximum allowed size for uploads.',\n    public string $uploadPartialErrorMessage = 'The file %file could not be saved because the upload did not complete.',\n    public string $uploadNoFileErrorMessage = 'The file %file could not be saved because the upload did not complete.',\n    public string $uploadErrorMessage = 'The file %file could not be saved. An unknown error has occurred.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->maxSize = $maxSize ?? $this->maxSize;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Validation/Constraint/UploadedFileConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UploadedFileConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: HelpController.php\nTarget symbol: class HelpController\nNamespace: Drupal\\help\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for HelpController.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheableMetadata\n  - Drupal\\Core\\Controller\\ControllerBase\n  - Drupal\\Core\\Extension\\ExtensionLifecycle\n  - Drupal\\Core\\Extension\\ModuleExtensionList\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\help\\HelpSectionManager\n  - Drupal\\system\\ModuleAdminLinksHelper\n  - Drupal\\user\\ModulePermissionsLinkHelper\n- Ensure these methods exist where relevant:\n  - __construct()\n  - helpMain()\n  - helpPage()", "output": "<?php\n\nnamespace Drupal\\help\\Controller;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Extension\\ExtensionLifecycle;\nuse Drupal\\Core\\Extension\\ModuleExtensionList;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\help\\HelpSectionManager;\nuse Drupal\\system\\ModuleAdminLinksHelper;\nuse Drupal\\user\\ModulePermissionsLinkHelper;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\Autowire;\nuse Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n\n/**\n * Controller routines for help routes.\n */\nclass HelpController extends ControllerBase {\n\n  /**\n   * Creates a new HelpController.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $routeMatch\n   *   The current route match.\n   * @param \\Drupal\\help\\HelpSectionManager $helpManager\n   *   The help section manager.\n   * @param \\Drupal\\Core\\Extension\\ModuleExtensionList $moduleExtensionList\n   *   The module extension list.\n   * @param \\Drupal\\system\\ModuleAdminLinksHelper $moduleAdminLinks\n   *   The module admin links.\n   * @param \\Drupal\\user\\ModulePermissionsLinkHelper $modulePermissionsLinks\n   *   The module permissions link.\n   */\n  public function __construct(\n    protected RouteMatchInterface $routeMatch,\n    #[Autowire(service: 'plugin.manager.help_section')]\n    protected HelpSectionManager $helpManager,\n    protected ModuleExtensionList $moduleExtensionList,\n    protected ModuleAdminLinksHelper $moduleAdminLinks,\n    protected ModulePermissionsLinkHelper $modulePermissionsLinks,\n  ) {\n  }\n\n  /**\n   * Prints a page listing various types of help.\n   *\n   * The page has sections defined by \\Drupal\\help\\HelpSectionPluginInterface\n   * plugins.\n   *\n   * @return array\n   *   A render array for the help page.\n   */\n  public function helpMain() {\n    $output = [];\n\n    // We are checking permissions, so add the user.permissions cache context.\n    $cacheability = new CacheableMetadata();\n    $cacheability->addCacheContexts(['user.permissions']);\n\n    $plugins = $this->helpManager->getDefinitions();\n    $cacheability->addCacheableDependency($this->helpManager);\n\n    foreach ($plugins as $plugin_id => $plugin_definition) {\n      // Check the provided permission.\n      if (!empty($plugin_definition['permission']) && !$this->currentUser()->hasPermission($plugin_definition['permission'])) {\n        continue;\n      }\n\n      // Add the section to the page.\n      /** @var \\Drupal\\help\\HelpSectionPluginInterface $plugin */\n      $plugin = $this->helpManager->createInstance($plugin_id);\n      $this_output = [\n        '#theme' => 'help_section',\n        '#title' => $plugin->getTitle(),\n        '#description' => $plugin->getDescription(),\n        '#empty' => $this->t('There is currently nothing in this section.'),\n        '#links' => [],\n        '#weight' => $plugin_definition['weight'],\n      ];\n\n      $links = $plugin->listTopics();\n      if (is_array($links) && count($links)) {\n        $this_output['#links'] = $links;\n      }\n\n      $cacheability->addCacheableDependency($plugin);\n      $output[$plugin_id] = $this_output;\n    }\n\n    $cacheability->applyTo($output);\n    return $output;\n  }\n\n  /**\n   * Prints a page listing general help for a module.\n   *\n   * @param string $name\n   *   A module name to display a help page for.\n   *\n   * @return array\n   *   A render array as expected by\n   *   \\Drupal\\Core\\Render\\RendererInterface::render().\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException\n   */\n  public function helpPage($name) {\n    $build = [];\n    if ($this->moduleHandler()->hasImplementations('help', $name)) {\n      $module_name = $this->moduleExtensionList->getName($name);\n      $build['#title'] = $module_name;\n\n      $info = $this->moduleExtensionList->getExtensionInfo($name);\n      if ($info[ExtensionLifecycle::LIFECYCLE_IDENTIFIER] === ExtensionLifecycle::EXPERIMENTAL) {\n        $this->messenger()->addWarning($this->t('This module is experimental. <a href=\":url\">Experimental modules</a> are provided for testing purposes only. Use at your own risk.', [':url' => 'https://www.drupal.org/core/experimental']));\n      }\n\n      $temp = $this->moduleHandler()->invoke($name, 'help', [\"help.page.$name\", $this->routeMatch]);\n      if (empty($temp)) {\n        $build['top'] = ['#markup' => $this->t('No help is available for module %module.', ['%module' => $module_name])];\n      }\n      else {\n        if (!is_array($temp)) {\n          $temp = ['#markup' => $temp];\n        }\n        $build['top'] = $temp;\n      }\n\n      // Only print list of administration pages if the module in question has\n      // any such pages associated with it.\n      $admin_tasks = $this->moduleAdminLinks->getModuleAdminLinks($name);\n      if ($module_permissions_link = $this->modulePermissionsLinks->getModulePermissionsLink($name, $info['name'])) {\n        $admin_tasks[\"user.admin_permissions.{$name}\"] = $module_permissions_link;\n      }\n      if (!empty($admin_tasks)) {\n        $links = [];\n        foreach ($admin_tasks as $task) {\n          $link['url'] = $task['url'];\n          $link['title'] = $task['title'];\n          $links[] = $link;\n        }\n        $build['links'] = [\n          '#theme' => 'links__help',\n          '#heading' => [\n            'level' => 'h3',\n            'text' => $this->t('@module administration pages', ['@module' => $module_name]),\n          ],\n          '#links' => $links,\n        ];\n      }\n      return $build;\n    }\n    else {\n      throw new NotFoundHttpException();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/help/src/Controller/HelpController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class BeforeCommand in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * An AJAX command for calling the jQuery before() method.\n *\n * The 'insert/before' command instructs the client to use jQuery's before()\n * method to insert the given render array or HTML content before each of\n * elements matched by the given selector.\n *\n * This command is implemented by Drupal.AjaxCommands.prototype.insert()\n * defined in misc/ajax.js.\n *\n * @see http://docs.jquery.com/Manipulation/before#content\n *\n * @ingroup ajax\n */\nclass BeforeCommand extends InsertCommand {\n\n  /**\n   * Implements Drupal\\Core\\Ajax\\CommandInterface:render().\n   */\n  public function render() {\n\n    return [\n      'command' => 'insert',\n      'method' => 'before',\n      'selector' => $this->selector,\n      'data' => $this->getRenderedContent(),\n      'settings' => $this->settings,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Ajax/BeforeCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BeforeCommand", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: user_picture_field_instance\nlabel: User picture field instance configuration\nmigration_tags:\n  - Drupal 6\n  - Drupal 7\n  - Configuration\nsource:\n  plugin: user_picture_instance\n  constants:\n    entity_type: user\n    bundle: user\n    name: user_picture\n    settings:\n      file_extensions: 'png gif jpg jpeg webp'\n      alt_field: false\n      title_field: false\n      min_resolution: ''\n      alt_field_required: false\n      title_field_required: false\nprocess:\n  entity_type: 'constants/entity_type'\n  bundle: 'constants/bundle'\n  field_name: 'constants/name'\n  settings: 'constants/settings'\n  'settings/file_directory': file_directory\n  'settings/max_filesize': max_filesize\n  'settings/max_resolution': max_resolution\ndestination:\n  plugin: entity:field_config\nmigration_dependencies:\n  required:\n    - user_picture_field\n", "metadata": {"source": "repos/drupal_core/core/modules/user/migrations/user_picture_field_instance.yml", "type": "yaml_reference", "topic": "user picture field instance"}}
{"instruction": "Show me the implementation of the class File in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for File module.\n */\n\n/**\n * Implements hook_schema().\n */\nfunction file_schema(): array {\n  $schema['file_usage'] = [\n    'description' => 'Track where a file is used.',\n    'fields' => [\n      'fid' => [\n        'description' => 'File ID.',\n        'type' => 'int',\n        'unsigned' => TRUE,\n        'not null' => TRUE,\n      ],\n      'module' => [\n        'description' => 'The name of the module that is using the file.',\n        'type' => 'varchar_ascii',\n        'length' => DRUPAL_EXTENSION_NAME_MAX_LENGTH,\n        'not null' => TRUE,\n        'default' => '',\n      ],\n      'type' => [\n        'description' => 'The name of the object type in which the file is used.',\n        'type' => 'varchar_ascii',\n        'length' => 64,\n        'not null' => TRUE,\n        'default' => '',\n      ],\n      'id' => [\n        'description' => 'The primary key of the object using the file.',\n        'type' => 'varchar_ascii',\n        'length' => 64,\n        'not null' => TRUE,\n        'default' => 0,\n      ],\n      'count' => [\n        'description' => 'The number of times this file is used by this object.',\n        'type' => 'int',\n        'unsigned' => TRUE,\n        'not null' => TRUE,\n        'default' => 0,\n      ],\n    ],\n    'primary key' => ['fid', 'type', 'id', 'module'],\n    'indexes' => [\n      'type_id' => ['type', 'id'],\n      'fid_count' => ['fid', 'count'],\n      'fid_module' => ['fid', 'module'],\n    ],\n  ];\n  return $schema;\n}\n\n/**\n * Implements hook_update_last_removed().\n */\nfunction file_update_last_removed(): int {\n  return 8700;\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/file.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "File", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Token Browser\ntype: module\ndescription: A highly performant token browser element for the Token module.\ncore_version_requirement: ^11.3\ndependencies:\n  - token:token\n", "metadata": {"source": "repos/token_browser/token_browser.info.yml", "type": "yaml_reference", "topic": "token browser.info"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer permissions:\n  title: 'Administer roles and permissions'\n  restrict access: true\nadminister account settings:\n  title: 'Administer account settings'\n  description: 'Configure site-wide settings and behavior for user accounts and registration. This includes account cancellation methods, the content of user emails and fields attached to users.'\n  restrict access: true\nadminister users:\n  title: 'Administer users'\n  description: 'Manage all user accounts. This includes editing all user information, changes of email addresses and passwords, issuing emails to users and blocking and deleting user accounts.'\n  restrict access: true\naccess user profiles:\n  title: 'View user information'\nview user email addresses:\n  title: 'View user email addresses'\n  description: 'Users without this permission will not have access to email addresses on user pages or other places where they might be shown, such as Views and JSON:API responses.'\nchange own username:\n  title: 'Change own username'\nselect account cancellation method:\n  title: 'Select method for cancelling account'\n  restrict access: true\ncancel account:\n  title: 'Cancel own user account'\n  description: 'Note: content may be kept, unpublished, deleted or transferred to the anonymous user depending on the configured user settings.'\n", "metadata": {"source": "repos/drupal_core/core/modules/user/user.permissions.yml", "type": "yaml_reference", "topic": "user.permissions"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Book module", "input": "", "output": "# Book module\n\nA book is a set of nodes tied together in a hierarchical structure, with\nchapters, sections, and subsections. You can use books for manuals, site\nresource guides, Frequently Asked Questions (FAQ), novel, or curricula.\nAny content type can be added to a book, and a book can contain nodes of more\nthan one content type.\n\nFor a full description of the module, visit the\n[project page](https://drupal.org/project/book).\n\nSubmit bug reports and feature suggestions, or track changes in the\n[issue queue](https://drupal.org/project/issues/book).\n\n## Table of contents\n\n- Installation\n- Configuration\n- Enhancements\n- Alternatives\n- Maintainers\n\n## Installation\n\nInstall as you would normally install a contributed Drupal module. For further\ninformation, see\n[Installing Drupal Modules](https://www.drupal.org/docs/extending-drupal/installing-drupal-modules).\n\n## Configuration\n\nRecommend reading https://www.drupal.org/docs/contributed-modules/book/overview\n\n## Enhancements/Alternatives\n\nModules that provide additional support for book:\n\n* [Book PDF](https://www.drupal.org/project/book_pdf) - This module provides a means to print books and relies on a third party library for pdf generation.\n* [Book Access Code](https://www.drupal.org/project/book_access_code) - Provide arbitrary access to books by exposing them to those that have a book code.\n  This could be used in many ways.\n* [Custom book block](https://www.drupal.org/project/custom_book_block) - A more configurable version of the navigation block\n* [Book tree menu](https://www.drupal.org/project/book_tree_menu) - Book Tree Menu enhances the default book navigation\n* [Booktree](https://www.drupal.org/project/booktree) - Booktree module - take as input a series of Book nodes and create a tree-like structure using Book node\n  relationships. Similar to booktree_menu.\n* [Sync book index to Drupal core menu](https://www.drupal.org/project/book_menu_sync) - module provides an easy-to-use solution for converting a Drupal\n  book structure into a standard Drupal menu.\n* [Book Organizer](https://www.drupal.org/project/book_organizer) - Book Organizer delivers a clean, Views-powered administration experience for Drupal book module.\n\n## Alternatives\n\n- [Entity Reference Hierarchy](https://www.drupal.org/project/entity_hierarchy)\n\n## Maintainers\n\n- Peter Wolanin [pwolanin](https://www.drupal.org/u/pwolanin)\n- Stephen Mustgrave - [smustgrave](https://www.drupal.org/u/smustgrave)\n", "metadata": {"source": "repos/livre/README.md", "type": "doc_summary", "topic": "Book module"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.field.node.recipe.field_cooking_time\n    - field.field.node.recipe.field_difficulty\n    - field.field.node.recipe.field_ingredients\n    - field.field.node.recipe.field_media_image\n    - field.field.node.recipe.field_number_of_servings\n    - field.field.node.recipe.field_preparation_time\n    - field.field.node.recipe.field_recipe_category\n    - field.field.node.recipe.field_recipe_instruction\n    - field.field.node.recipe.field_summary\n    - field.field.node.recipe.field_tags\n    - field.field.node.recipe.layout_builder__layout\n    - node.type.recipe\n    - workflows.workflow.editorial\n  module:\n    - content_moderation\n    - media_library\n    - path\n    - text\nid: node.recipe.default\ntargetEntityType: node\nbundle: recipe\nmode: default\ncontent:\n  created:\n    type: datetime_timestamp\n    weight: 15\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  field_cooking_time:\n    type: number\n    weight: 3\n    region: content\n    settings:\n      placeholder: ''\n    third_party_settings: {  }\n  field_difficulty:\n    type: options_select\n    weight: 5\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  field_ingredients:\n    type: string_textfield\n    weight: 11\n    region: content\n    settings:\n      size: 60\n      placeholder: ''\n    third_party_settings: {  }\n  field_media_image:\n    type: media_library_widget\n    weight: 9\n    region: content\n    settings:\n      media_types: {  }\n    third_party_settings: {  }\n  field_number_of_servings:\n    type: number\n    weight: 4\n    region: content\n    settings:\n      placeholder: ''\n    third_party_settings: {  }\n  field_preparation_time:\n    type: number\n    weight: 2\n    region: content\n    settings:\n      placeholder: ''\n    third_party_settings: {  }\n  field_recipe_category:\n    type: options_buttons\n    weight: 6\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  field_recipe_instruction:\n    type: text_textarea\n    weight: 13\n    region: content\n    settings:\n      rows: 5\n      placeholder: ''\n    third_party_settings: {  }\n  field_summary:\n    type: text_textarea\n    weight: 10\n    region: content\n    settings:\n      rows: 5\n      placeholder: ''\n    third_party_settings: {  }\n  field_tags:\n    type: entity_reference_autocomplete_tags\n    weight: 7\n    region: content\n    settings:\n      match_operator: CONTAINS\n      match_limit: 10\n      size: 60\n      placeholder: ''\n    third_party_settings: {  }\n  langcode:\n    type: language_select\n    weight: 1\n    region: content\n    settings:\n      include_locked: true\n    third_party_settings: {  }\n  moderation_state:\n    type: moderation_state_default\n    weight: 20\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  path:\n    type: path\n    weight: 18\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  promote:\n    type: boolean_checkbox\n    weight: 16\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {  }\n  status:\n    type: boolean_checkbox\n    weight: 19\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {  }\n  sticky:\n    type: boolean_checkbox\n    weight: 17\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {  }\n  title:\n    type: string_textfield\n    weight: 0\n    region: content\n    settings:\n      size: 60\n      placeholder: ''\n    third_party_settings: {  }\n  translation:\n    weight: 12\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  uid:\n    type: entity_reference_autocomplete\n    weight: 14\n    region: content\n    settings:\n      match_operator: CONTAINS\n      match_limit: 10\n      size: 60\n      placeholder: ''\n    third_party_settings: {  }\nhidden:\n  layout_builder__layout: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_form_display.node.recipe.default.yml", "type": "yaml_reference", "topic": "core.entity form display.node.recipe.default"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nid: und\nlabel: 'Not specified'\ndirection: ltr\nweight: 2\nlocked: true\n", "metadata": {"source": "repos/drupal_core/core/modules/language/config/install/language.entity.und.yml", "type": "yaml_reference", "topic": "language.entity.und"}}
{"instruction": "Show me the implementation of the class AtLeastOneOfConstraint in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Drupal\\Core\\Validation\\CompositeConstraintInterface;\nuse Symfony\\Component\\Validator\\Constraints\\AtLeastOneOf;\nuse Symfony\\Component\\Validator\\Constraints\\AtLeastOneOfValidator;\n\n/**\n * Checks that at least one of the given constraint is satisfied.\n *\n * Overrides the symfony constraint to convert the array of constraints to array\n * of constraint objects and use them.\n */\n#[Constraint(\n  id: 'AtLeastOneOf',\n  label: new TranslatableMarkup('At least one of', [], ['context' => 'Validation'])\n)]\nclass AtLeastOneOfConstraint extends AtLeastOneOf implements CompositeConstraintInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getCompositeOptionStatic(): string {\n    return 'constraints';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validatedBy(): string {\n    return AtLeastOneOfValidator::class;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Validation/Plugin/Validation/Constraint/AtLeastOneOfConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AtLeastOneOfConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use metatag:\n  title: 'Use MCP metatag tools'\n  description: 'View and update Metatag defaults and entity metatags via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_metatag/mcp_tools_metatag.permissions.yml", "type": "yaml_reference", "topic": "mcp tools metatag.permissions"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Managing the fields of contact forms'\nrelated:\n  - contact.overview\n---\n{% set contact_link_text %}{% trans %}Contact forms{% endtrans %}{% endset %}\n{% set contact_link = render_var(help_route_link(contact_link_text, 'entity.contact_form.collection')) %}\n<h2>{% trans %}Goal{% endtrans %}</h2>\n<p>{% trans %}Add, remove, or rearrange the fields on personal and site-wide contact forms.{% endtrans %}</p>\n<h2>{% trans %}What are the fields on contact forms?{% endtrans %}</h2>\n<p>{% trans %}Both personal and site-wide contact forms will always have <em>Subject</em> and <em>Message</em> fields. You can add additional fields for users to fill out if desired. Note that if you want to display other content on a form page, such as text or images, you can use a content block.{% endtrans %}</p>\n<h2>{% trans %}Steps{% endtrans %}</h2>\n<ol>\n  <li>{% trans %}In the <em>Manage</em> administrative menu, navigate to <em>Structure</em> &gt; <em>{{ contact_link }}</em>.{% endtrans %}</li>\n  <li>{% trans %}Click <em>Manage fields</em> for the form you want to change the fields of, and add or remove one or more fields on the form.{% endtrans %}</li>\n  <li>{% trans %}Click <em>Manage form display</em> to change the order or configuration of the fields on the form.{% endtrans %}</li>\n</ol>\n", "metadata": {"source": "repos/drupal_core/core/modules/contact/help_topics/contact.adding_fields.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class Role in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\views\\access;\n\nuse Drupal\\Component\\Utility\\Html;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\user\\RoleInterface;\nuse Drupal\\user\\RoleStorageInterface;\nuse Drupal\\views\\Attribute\\ViewsAccess;\nuse Drupal\\views\\Plugin\\views\\access\\AccessPluginBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Routing\\Route;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Access plugin that provides role-based access control.\n *\n * @ingroup views_access_plugins\n */\n#[ViewsAccess(\n  id: 'role',\n  title: new TranslatableMarkup('Role'),\n  help: new TranslatableMarkup('Access will be granted to users with any of the specified roles.'),\n)]\nclass Role extends AccessPluginBase implements CacheableDependencyInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesOptions = TRUE;\n\n  /**\n   * The role storage.\n   *\n   * @var \\Drupal\\user\\RoleStorageInterface\n   */\n  protected $roleStorage;\n\n  /**\n   * Constructs a Role object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\user\\RoleStorageInterface $role_storage\n   *   The role storage.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, RoleStorageInterface $role_storage) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->roleStorage = $role_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('entity_type.manager')->getStorage('user_role')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function access(AccountInterface $account) {\n    return !empty(array_intersect(array_filter($this->options['role']), $account->getRoles()));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alterRouteDefinition(Route $route) {\n    if ($this->options['role']) {\n      $route->setRequirement('_role', (string) implode('+', $this->options['role']));\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    $count = count($this->options['role']);\n    if ($count < 1) {\n      return $this->t('No role(s) selected');\n    }\n    elseif ($count > 1) {\n      return $this->t('Multiple roles');\n    }\n    else {\n      $rid = reset($this->options['role']);\n      return $this->roleStorage->load($rid)->label();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['role'] = ['default' => []];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['role'] = [\n      '#type' => 'checkboxes',\n      '#title' => $this->t('Role'),\n      '#default_value' => $this->options['role'],\n      '#options' => array_map(fn(RoleInterface $role) => Html::escape($role->label()), $this->roleStorage->loadMultiple()),\n      '#description' => $this->t('Only the checked roles will be able to access this display.'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateOptionsForm(&$form, FormStateInterface $form_state) {\n    $role = $form_state->getValue(['access_options', 'role']);\n    $role = array_filter($role);\n\n    if (!$role) {\n      $form_state->setError($form['role'], $this->t('You must select at least one role if type is \"by role\"'));\n    }\n\n    $form_state->setValue(['access_options', 'role'], $role);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    $dependencies = parent::calculateDependencies();\n\n    foreach (array_keys($this->options['role']) as $rid) {\n      if ($role = $this->roleStorage->load($rid)) {\n        $dependencies[$role->getConfigDependencyKey()][] = $role->getConfigDependencyName();\n      }\n    }\n\n    return $dependencies;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheMaxAge() {\n    return Cache::PERMANENT;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    return ['user.roles'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheTags() {\n    return [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/views/access/Role.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Role", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "enabled: true\nlimit_10min: 3\nlimit_24h: 10\nmessage_10min: 'You have exceeded the maximum number of submissions allowed per 10 minutes. Please try again later.'\nmessage_24h: 'You have exceeded the maximum number of submissions allowed per day. Please try again later.'\n", "metadata": {"source": "repos/webform_rate_limit/config/install/webform_rate_limit.settings.yml", "type": "yaml_reference", "topic": "webform rate limit.settings"}}
{"instruction": "Show me the implementation of the class LayoutBuilderThemeHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Hook;\n\nuse Drupal\\layout_builder\\Plugin\\SectionStorage\\OverridesSectionStorage;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for layout_builder.\n */\nclass LayoutBuilderThemeHooks {\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_preprocess_HOOK() for language-content-settings-table.html.twig.\n   */\n  #[Hook('preprocess_language_content_settings_table')]\n  public function preprocessLanguageContentSettingsTable(&$variables): void {\n    foreach ($variables['build']['#rows'] as &$row) {\n      if (isset($row['#field_name']) && $row['#field_name'] === OverridesSectionStorage::FIELD_NAME) {\n        // Rebuild the label to include a warning about using translations with\n        // layouts.\n        $row['data'][1]['data']['field'] = [\n          'label' => $row['data'][1]['data']['field'],\n          'description' => [\n            '#type' => 'container',\n            '#markup' => $this->t('<strong>Warning</strong>: Layout Builder does not support translating layouts. (<a href=\"https://www.drupal.org/docs/8/core/modules/layout-builder/layout-builder-and-content-translation\">online documentation</a>)'),\n            '#attributes' => [\n              'class' => [\n                'layout-builder-translation-warning',\n              ],\n            ],\n          ],\n        ];\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Hook/LayoutBuilderThemeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderThemeHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DataController.php\nTarget symbol: class DataController\nNamespace: Drupal\\data_count\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DataController.\n- Include required imports:\n  - Drupal\\Core\\Controller\\ControllerBase\n- Ensure these methods exist where relevant:\n  - dataCount()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\data_count\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\n\n/**\n * Return renderable array response for template.\n */\nclass DataController extends ControllerBase {\n\n  /**\n   * Render array for the content.\n   */\n  public function dataCount() {\n    $items = [\n      'nodes' => data_count_node(),\n      'users' => data_count_user(),\n    ];\n    $data['#attached']['library'] = ['data_count/count-style'];\n    $data['#theme'] = 'data_count';\n    $data['#data'] = $items;\n    return $data;\n  }\n\n}\n", "metadata": {"source": "repos/data_count/src/Controller/DataController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DataController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: SdkController\nSource file: <source_file>\nFile name hint: SdkController.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * SDK Controller for API Normalizer.\n */\nclass SdkController extends ControllerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static();\n  }\n\n  /**\n   * Generate SDK for API.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The JSON response.\n   */\n  public function generator(Request $request): JsonResponse {\n    $content = json_decode($request->getContent(), TRUE);\n\n    if (!$content || !isset($content['api_spec'])) {\n      return new JsonResponse(['error' => 'API specification is required'], 400);\n    }\n\n    $language = $content['language'] ?? 'javascript';\n    $framework = $content['framework'] ?? 'axios';\n\n    $sdk = [\n      'language' => $language,\n      'framework' => $framework,\n      'generated_at' => time(),\n      'endpoints' => count($content['api_spec']['paths'] ?? []),\n      'models' => count($content['api_spec']['components']['schemas'] ?? []),\n      'download_url' => '/api/sdk/download/' . uniqid(),\n    ];\n\n    return new JsonResponse([\n      'success' => TRUE,\n      'sdk' => $sdk,\n    ]);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * SDK Controller for API Normalizer.\n */\nclass SdkController extends ControllerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static();\n  }\n\n  /**\n   * Generate SDK for API.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The JSON response.\n   */\n  public function generator(Request $request): JsonResponse {\n    $content = json_decode($request->getContent(), TRUE);\n\n    if (!$content || !isset($content['api_spec'])) {\n      return new JsonResponse(['error' => 'API specification is required'], 400);\n    }\n\n    $language = $content['language'] ?? 'javascript';\n    $framework = $content['framework'] ?? 'axios';\n\n    $sdk = [\n      'language' => $language,\n      'framework' => $framework,\n      'generated_at' => time(),\n      'endpoints' => count($content['api_spec']['paths'] ?? []),\n      'models' => count($content['api_spec']['components']['schemas'] ?? []),\n      'download_url' => '/api/sdk/download/' . uniqid(),\n    ];\n\n    return new JsonResponse([\n      'success' => TRUE,\n      'sdk' => $sdk,\n    ]);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Controller/SdkController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SdkController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ScaleAndCrop\nSource file: <source_file>\nFile name hint: ScaleAndCrop.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\system\\Plugin\\ImageToolkit\\Operation\\gd;\n\nuse Drupal\\Core\\ImageToolkit\\Attribute\\ImageToolkitOperation;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines GD2 Scale and crop operation.\n */\n#[ImageToolkitOperation(\n  id: \"gd_scale_and_crop\",\n  toolkit: \"gd\",\n  operation: \"scale_and_crop\",\n  label: new TranslatableMarkup(\"Scale and crop\"),\n  description: new TranslatableMarkup(\"Scales an image to the exact width and height given. This plugin achieves the target aspect ratio by cropping the original image equally on both sides, or equally on the top and bottom. This function is useful to create uniform sized avatars from larger images.\")\n)]\nclass ScaleAndCrop extends GDImageToolkitOperationBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function arguments() {\n    return [\n      'x' => [\n        'description' => 'The horizontal offset for the start of the crop, in pixels',\n        'required' => FALSE,\n        'default' => NULL,\n      ],\n      'y' => [\n        'description' => 'The vertical offset for the start the crop, in pixels',\n        'required' => FALSE,\n        'default' => NULL,\n      ],\n      'width' => [\n        'description' => 'The target width, in pixels',\n      ],\n      'height' => [\n        'description' => 'The target height, in pixels',\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function validateArguments(array $arguments) {\n    $actualWidth = $this->getToolkit()->getWidth();\n    $actualHeight = $this->getToolkit()->getHeight();\n\n    $scaleFactor = max($arguments['width'] / $actualWidth, $arguments['height'] / $actualHeight);\n\n    $arguments['x'] = isset($arguments['x']) ?\n      (int) round($arguments['x']) :\n      (int) round(($actualWidth * $scaleFactor - $arguments['width']) / 2);\n    $arguments['y'] = isset($arguments['y']) ?\n      (int) round($arguments['y']) :\n      (int) round(($actualHeight * $scaleFactor - $arguments['height']) / 2);\n    $arguments['resize'] = [\n      'width' => (int) round($actualWidth * $scaleFactor),\n      'height' => (int) round($actualHeight * $scaleFactor),\n    ];\n\n    // Fail when width or height are 0 or negative.\n    if ($arguments['width'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid width ('{$arguments['width']}') specified for the image 'scale_and_crop' operation\");\n    }\n    if ($arguments['height'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid height ('{$arguments['height']}') specified for the image 'scale_and_crop' operation\");\n    }\n\n    return $arguments;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function execute(array $arguments = []) {\n    return $this->getToolkit()->apply('resize', $arguments['resize'])\n        && $this->getToolkit()->apply('crop', $arguments);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\system\\Plugin\\ImageToolkit\\Operation\\gd;\n\nuse Drupal\\Core\\ImageToolkit\\Attribute\\ImageToolkitOperation;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines GD2 Scale and crop operation.\n */\n#[ImageToolkitOperation(\n  id: \"gd_scale_and_crop\",\n  toolkit: \"gd\",\n  operation: \"scale_and_crop\",\n  label: new TranslatableMarkup(\"Scale and crop\"),\n  description: new TranslatableMarkup(\"Scales an image to the exact width and height given. This plugin achieves the target aspect ratio by cropping the original image equally on both sides, or equally on the top and bottom. This function is useful to create uniform sized avatars from larger images.\")\n)]\nclass ScaleAndCrop extends GDImageToolkitOperationBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function arguments() {\n    return [\n      'x' => [\n        'description' => 'The horizontal offset for the start of the crop, in pixels',\n        'required' => FALSE,\n        'default' => NULL,\n      ],\n      'y' => [\n        'description' => 'The vertical offset for the start the crop, in pixels',\n        'required' => FALSE,\n        'default' => NULL,\n      ],\n      'width' => [\n        'description' => 'The target width, in pixels',\n      ],\n      'height' => [\n        'description' => 'The target height, in pixels',\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function validateArguments(array $arguments) {\n    $actualWidth = $this->getToolkit()->getWidth();\n    $actualHeight = $this->getToolkit()->getHeight();\n\n    $scaleFactor = max($arguments['width'] / $actualWidth, $arguments['height'] / $actualHeight);\n\n    $arguments['x'] = isset($arguments['x']) ?\n      (int) round($arguments['x']) :\n      (int) round(($actualWidth * $scaleFactor - $arguments['width']) / 2);\n    $arguments['y'] = isset($arguments['y']) ?\n      (int) round($arguments['y']) :\n      (int) round(($actualHeight * $scaleFactor - $arguments['height']) / 2);\n    $arguments['resize'] = [\n      'width' => (int) round($actualWidth * $scaleFactor),\n      'height' => (int) round($actualHeight * $scaleFactor),\n    ];\n\n    // Fail when width or height are 0 or negative.\n    if ($arguments['width'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid width ('{$arguments['width']}') specified for the image 'scale_and_crop' operation\");\n    }\n    if ($arguments['height'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid height ('{$arguments['height']}') specified for the image 'scale_and_crop' operation\");\n    }\n\n    return $arguments;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function execute(array $arguments = []) {\n    return $this->getToolkit()->apply('resize', $arguments['resize'])\n        && $this->getToolkit()->apply('crop', $arguments);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/ImageToolkit/Operation/gd/ScaleAndCrop.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ScaleAndCrop", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class LaborTimeTrackerEntityHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\labor_time_tracker\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\labor_time_tracker\\Entity\\TimeLog;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Hook implementations for Labor Time Tracker.\n */\nclass LaborTimeTrackerEntityHooks {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    protected EntityTypeManagerInterface $entityTypeManager,\n    protected Connection $database,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('database')\n    );\n  }\n\n  /**\n   * Calculates duration when an 'exit' punch is saved.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The TimeLog entity.\n   */\n  #[Hook('entity_update')]\n  public function timeLogPresave(EntityInterface $entity): void {\n    if (!$entity instanceof TimeLog) {\n      return;\n    }\n\n    $start = (int) $entity->get('enter_time')->value;\n    $exit = (int) $entity->get('exit_time')->value;\n\n    if ($start > 0 && $exit > 0) {\n      $duration = $exit - $start;\n      $this->sqlFlush($entity->id(), $duration);\n    }\n  }\n\n  /**\n   * Helper to perform direct SQL update and clear cache.\n   */\n  protected function sqlFlush($id, $duration): void {\n    $this->database->update('time_log')\n      ->fields(['duration' => (int) $duration])\n      ->condition('id', $id)\n      ->execute();\n\n    $this->entityTypeManager->getStorage('time_log')->resetCache([$id]);\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/Hook/LaborTimeTrackerEntityHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LaborTimeTrackerEntityHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: WebprofilerRequestMatcher\nSource file: <source_file>\nFile name hint: WebprofilerRequestMatcher.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\RequestMatcher;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\ImmutableConfig;\nuse Drupal\\Core\\Path\\PathMatcherInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\RequestMatcherInterface;\n\n/**\n * Exclude some path to be profiled.\n */\nclass WebprofilerRequestMatcher implements RequestMatcherInterface {\n\n  /**\n   * An immutable config object.\n   *\n   * @var \\Drupal\\Core\\Config\\ImmutableConfig\n   */\n  private ImmutableConfig $config;\n\n  /**\n   * The patterns to exclude.\n   *\n   * @var string\n   */\n  private string $patterns;\n\n  /**\n   * WebprofilerRequestMatcher constructor.\n   *\n   * @param \\Drupal\\Core\\Path\\PathMatcherInterface $pathMatcher\n   *   The path matcher service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config\n   *   The config factory service.\n   * @param string $configuration\n   *   The configuration name that contains the exclude paths.\n   */\n  public function __construct(\n    protected readonly PathMatcherInterface $pathMatcher,\n    ConfigFactoryInterface $config,\n    string $configuration,\n  ) {\n    $this->config = $config->get('webprofiler.settings');\n\n    $patterns = $this->config->get($configuration);\n\n    // Never add Webprofiler to phpinfo page.\n    $patterns .= \"\\r\\n/admin/reports/status/php\";\n\n    // Never add Webprofiler to uninstall confirm page.\n    $patterns .= \"\\r\\n/admin/modules/uninstall/*\";\n\n    $this->patterns = $patterns;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function matches(Request $request): bool {\n    $path = $request->getPathInfo();\n\n    return !$this->pathMatcher->matchPath($path, $this->patterns);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\RequestMatcher;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\ImmutableConfig;\nuse Drupal\\Core\\Path\\PathMatcherInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\RequestMatcherInterface;\n\n/**\n * Exclude some path to be profiled.\n */\nclass WebprofilerRequestMatcher implements RequestMatcherInterface {\n\n  /**\n   * An immutable config object.\n   *\n   * @var \\Drupal\\Core\\Config\\ImmutableConfig\n   */\n  private ImmutableConfig $config;\n\n  /**\n   * The patterns to exclude.\n   *\n   * @var string\n   */\n  private string $patterns;\n\n  /**\n   * WebprofilerRequestMatcher constructor.\n   *\n   * @param \\Drupal\\Core\\Path\\PathMatcherInterface $pathMatcher\n   *   The path matcher service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config\n   *   The config factory service.\n   * @param string $configuration\n   *   The configuration name that contains the exclude paths.\n   */\n  public function __construct(\n    protected readonly PathMatcherInterface $pathMatcher,\n    ConfigFactoryInterface $config,\n    string $configuration,\n  ) {\n    $this->config = $config->get('webprofiler.settings');\n\n    $patterns = $this->config->get($configuration);\n\n    // Never add Webprofiler to phpinfo page.\n    $patterns .= \"\\r\\n/admin/reports/status/php\";\n\n    // Never add Webprofiler to uninstall confirm page.\n    $patterns .= \"\\r\\n/admin/modules/uninstall/*\";\n\n    $this->patterns = $patterns;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function matches(Request $request): bool {\n    $path = $request->getPathInfo();\n\n    return !$this->pathMatcher->matchPath($path, $this->patterns);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/RequestMatcher/WebprofilerRequestMatcher.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WebprofilerRequestMatcher", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class ChangeDefaultLanguageForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_change_default_language\\Form;\n\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\node_change_default_language\\NodeChangeDefaultLanguageInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Form for changing the default language of a node.\n */\nclass ChangeDefaultLanguageForm extends FormBase {\n\n  /**\n   * The node being edited.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   */\n  protected NodeInterface $node;\n\n  /**\n   * Constructs the form.\n   *\n   * @param \\Drupal\\node_change_default_language\\NodeChangeDefaultLanguageInterface $changeDefaultLanguage\n   *   The change default language service.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $languageManager\n   *   The language manager.\n   */\n  public function __construct(\n    protected NodeChangeDefaultLanguageInterface $changeDefaultLanguage,\n    protected LanguageManagerInterface $languageManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('node_change_default_language.service'),\n      $container->get('language_manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'node_change_default_language_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?NodeInterface $node = NULL): array {\n    if (!$node) {\n      return $form;\n    }\n\n    $this->node = $node;\n    $currentLangcode = $node->language()->getId();\n    $languages = $this->languageManager->getLanguages();\n    $currentLangName = $languages[$currentLangcode]->getName() ?? $currentLangcode;\n\n    // Get available translations.\n    $translationLanguages = $node->getTranslationLanguages();\n    $options = [];\n    foreach ($translationLanguages as $langcode => $language) {\n      if ($langcode !== $currentLangcode) {\n        $options[$langcode] = $language->getName();\n      }\n    }\n\n    if (empty($options)) {\n      $form['message'] = [\n        '#markup' => $this->t('This node has no translations. Add translations first before changing the default language.'),\n      ];\n      return $form;\n    }\n\n    $form['current_language'] = [\n      '#type' => 'item',\n      '#title' => $this->t('Current default language'),\n      '#markup' => $currentLangName,\n    ];\n\n    $form['new_langcode'] = [\n      '#type' => 'select',\n      '#title' => $this->t('New default language'),\n      '#options' => $options,\n      '#required' => TRUE,\n      '#description' => $this->t('Select the new default language for this node.'),\n    ];\n\n    $form['warning'] = [\n      '#type' => 'markup',\n      '#markup' => '<p><strong>' . $this->t('Warning:') . '</strong> ' .\n      $this->t('This will change the source language of this node. A new revision will be created.') . '</p>',\n    ];\n\n    $form['actions'] = [\n      '#type' => 'actions',\n    ];\n\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Change default language'),\n      '#button_type' => 'primary',\n    ];\n\n    $form['actions']['cancel'] = [\n      '#type' => 'link',\n      '#title' => $this->t('Cancel'),\n      '#url' => $node->toUrl(),\n      '#attributes' => [\n        'class' => ['button'],\n      ],\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $newLangcode = $form_state->getValue('new_langcode');\n\n    try {\n      $result = $this->changeDefaultLanguage->changeDefaultLanguage($this->node, $newLangcode);\n\n      if ($result) {\n        $languages = $this->languageManager->getLanguages();\n        $newLangName = $languages[$newLangcode]->getName() ?? $newLangcode;\n        $this->messenger()->addStatus(\n          $this->t('The default language has been changed to @language.', ['@language' => $newLangName])\n        );\n      }\n      else {\n        $this->messenger()->addWarning($this->t('The default language was not changed.'));\n      }\n    }\n    catch (\\Exception $e) {\n      $this->messenger()->addError(\n        $this->t('Failed to change the default language: @message', ['@message' => $e->getMessage()])\n      );\n    }\n\n    $form_state->setRedirectUrl(Url::fromRoute('entity.node.canonical', ['node' => $this->node->id()]));\n  }\n\n}\n", "metadata": {"source": "repos/node_change_default_language/src/Form/ChangeDefaultLanguageForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ChangeDefaultLanguageForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: tools\nenabled: true\nlabel: Tools\ndescription: 'Extend your workflow capabilities with external tools, APIs, calculators, web scrapers, and other specialized utilities.'\nicon: 'mdi:wrench'\ncolor: '#f59e0b'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_category/config/install/flowdrop_node_category.flowdrop_node_category.tools.yml", "type": "yaml_reference", "topic": "flowdrop node category.flowdrop node category.tools"}}
{"instruction": "Show me the implementation of the class ImageGalleryFormatter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\slider_gallery\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Field\\FormatterBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\file\\FileInterface;\nuse Drupal\\image\\Entity\\ImageStyle;\nuse Drupal\\media\\Entity\\Media;\nuse Drupal\\file\\Entity\\File;\n\n/**\n * Plugin implementation of the 'image_gallery_formatter'.\n *\n * @FieldFormatter(\n *   id = \"image_gallery_formatter\",\n *   label = @Translation(\"Galer\u00eda de im\u00e1genes (Fancybox)\"),\n *   field_types = {\n *     \"image\",\n *     \"entity_reference\"\n *   }\n * )\n */\nclass ImageGalleryFormatter extends FormatterBase\n{\n\n  public static function defaultSettings(): array\n  {\n    return array_merge(parent::defaultSettings(), [\n      'max_images' => 5,\n      'image_style' => '',\n    ]);\n  }\n\n  public function settingsForm(array $form, FormStateInterface $form_state): array\n  {\n    $elements = parent::settingsForm($form, $form_state);\n\n    $styles = ImageStyle::loadMultiple();\n    $options = ['' => $this->t('- Sin estilo -')];\n    foreach ($styles as $id => $style) {\n      $options[$id] = $style->label();\n    }\n\n    $elements['max_images'] = [\n      '#type' => 'number',\n      '#title' => $this->t('M\u00e1ximo de im\u00e1genes visibles'),\n      '#default_value' => $this->getSetting('max_images'),\n      '#min' => 1,\n    ];\n\n    $elements['image_style'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Estilo de imagen'),\n      '#options' => $options,\n      '#default_value' => $this->getSetting('image_style'),\n    ];\n\n    return $elements;\n  }\n\n  public function viewElements(FieldItemListInterface $items, $langcode): array\n  {\n    $max = (int)$this->getSetting('max_images');\n    $style = $this->getSetting('image_style');\n    $gallery_id = 'gallery-' . uniqid();\n\n    $images = [];\n    $hidden = [];\n    $index = 0;\n\n    foreach ($items as $item) {\n      $file = NULL;\n      $alt = '';\n      $title = '';\n\n      if ($item->entity instanceof FileInterface) {\n        $file = $item->entity;\n        $alt = $item->alt ?? '';\n        $title = $item->title ?? '';\n      } elseif ($item->entity instanceof Media && $item->entity->bundle() === 'image') {\n        $media_image = $item->entity->get('field_media_image')->first();\n        if ($media_image) {\n          $file = File::load($media_image->target_id);\n          $alt = $media_image->alt;\n          $title = $media_image->title;\n        }\n      }\n\n      if (!$file) {\n        continue;\n      }\n\n      $url = $style && ImageStyle::load($style)\n        ? ImageStyle::load($style)->buildUrl($file->getFileUri())\n        : \\Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());\n\n      $data = [\n        'url' => $url,\n        'alt' => $alt,\n        'title' => $title,\n        'gallery_id' => $gallery_id,\n      ];\n\n      if ($index < $max) {\n        $images[] = $data;\n      } else {\n        $hidden[] = $data;\n      }\n\n      $index++;\n    }\n\n    return [[\n      '#theme' => 'image_gallery',\n      '#images' => $images,\n      '#hidden_images' => $hidden,\n      '#gallery_id' => $gallery_id,\n      '#attached' => [\n        'library' => [\n          'slider_gallery/fancybox',\n        ],\n      ],\n    ]];\n  }\n\n}\n", "metadata": {"source": "repos/slider_gallery/src/Plugin/Field/FieldFormatter/ImageGalleryFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageGalleryFormatter", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ListWebforms\nSource file: <source_file>\nFile name hint: ListWebforms.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_list_webforms',\n  label: new TranslatableMarkup('List Webforms'),\n  description: new TranslatableMarkup('List all webforms with submission counts.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Webforms'),\n      description: new TranslatableMarkup(''),\n    ),\n    'webforms' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Webforms'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListWebforms extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->webformService->listWebforms();\n  }\n\n\n\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_list_webforms',\n  label: new TranslatableMarkup('List Webforms'),\n  description: new TranslatableMarkup('List all webforms with submission counts.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Webforms'),\n      description: new TranslatableMarkup(''),\n    ),\n    'webforms' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Webforms'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListWebforms extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->webformService->listWebforms();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/src/Plugin/tool/Tool/ListWebforms.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListWebforms", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class ContactSettings in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\contact\\Plugin\\migrate\\source;\n\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\Variable;\n\n/**\n * Drupal 6/7 contact settings source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"contact_settings\",\n *   source_module = \"contact\"\n * )\n */\nclass ContactSettings extends Variable {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function initializeIterator() {\n    $default_category = $this->select('contact', 'c')\n      ->fields('c', ['cid'])\n      ->condition('c.selected', 1)\n      ->execute()\n      ->fetchField();\n    return new \\ArrayIterator([$this->values() + ['default_category' => $default_category]]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contact/src/Plugin/migrate/source/ContactSettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContactSettings", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'D2: Declarative Diagramming'\ntype: module\ndescription: 'Provides methods to generate SVGs using D2 diagram syntax.'\npackage: Custom\ncore_version_requirement: ^11\n", "metadata": {"source": "repos/d2/d2.info.yml", "type": "yaml_reference", "topic": "d2.info"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Term\nSource file: <source_file>\nFile name hint: Term.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\taxonomy\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\d7\\FieldableEntity;\n\n/**\n * Drupal 7 taxonomy term source from database.\n *\n * Available configuration keys:\n * - bundle: (optional) The taxonomy vocabulary (machine name) to filter terms\n *   retrieved from the source - can be a string or an array. If omitted, all\n *   terms are retrieved.\n *\n * Examples:\n *\n * @code\n * source:\n *   plugin: d7_taxonomy_term\n *   bundle: tags\n * @endcode\n *\n * In this example terms of 'tags' vocabulary are retrieved from the source\n * database.\n *\n * @code\n * source:\n *   plugin: d7_taxonomy_term\n *   bundle: [tags, forums]\n * @endcode\n *\n * In this example terms of 'tags' and 'forums' vocabularies are retrieved\n * from the source database.\n *\n * For additional configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @todo Support term_relation, term_synonym table if possible.\n *\n * @MigrateSource(\n *   id = \"d7_taxonomy_term\",\n *   source_module = \"taxonomy\"\n * )\n */\nclass Term extends FieldableEntity {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $query = $this->select('taxonomy_term_data', 'td')\n      ->fields('td')\n      ->distinct()\n      ->orderBy('tid');\n    $query->leftJoin('taxonomy_vocabulary', 'tv', '[td].[vid] = [tv].[vid]');\n    $query->addField('tv', 'machine_name');\n\n    if ($this->getDatabase()\n      ->schema()\n      ->fieldExists('taxonomy_vocabulary', 'i18n_mode')) {\n      $query->addField('tv', 'i18n_mode');\n    }\n\n    if (isset($this->configuration['bundle'])) {\n      $query->condition('tv.machine_name', (array) $this->configuration['bundle'], 'IN');\n    }\n\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = [\n      'tid' => $this->t('The term ID.'),\n      'vid' => $this->t('Existing term VID'),\n      'machine_name' => $this->t('Vocabulary machine name'),\n      'name' => $this->t('The name of the term.'),\n      'description' => $this->t('The term description.'),\n      'weight' => $this->t('Weight'),\n      'parent' => $this->t(\"The Drupal term IDs of the term's parents.\"),\n      'format' => $this->t(\"Format of the term description.\"),\n    ];\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    $tid = $row->getSourceProperty('tid');\n    $vocabulary = $row->getSourceProperty('machine_name');\n    $default_language = (array) $this->variableGet('language_default', ['language' => 'en']);\n\n    // If this entity was translated using Entity Translation, we need to get\n    // its source language to get the field values in the right language.\n    // The translations will be migrated by the d7_node_entity_translation\n    // migration.\n    $translatable_vocabularies = array_keys(array_filter($this->variableGet('entity_translation_taxonomy', [])));\n    $entity_translatable = $this->isEntityTranslatable('taxonomy_term') && in_array($vocabulary, $translatable_vocabularies, TRUE);\n\n    if ($entity_translatable) {\n      $source_language = $this->getEntityTranslationSourceLanguage('taxonomy_term', $tid);\n      $language = $entity_translatable && $source_language ? $source_language : $default_language['language'];\n    }\n    // If this is an i18n translation use the default language when i18n_mode\n    // is localized.\n    if ($row->get('i18n_mode')) {\n      $language = ($row->get('i18n_mode') === '1') ? $default_language['language'] : $row->get('language');\n    }\n\n    $language = $language ?? $default_language['language'];\n    $row->setSourceProperty('language', $language);\n\n    // Get Field API field values.\n    foreach ($this->getFields('taxonomy_term', $vocabulary) as $field_name => $field) {", "output": "<?php\n\nnamespace Drupal\\taxonomy\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\d7\\FieldableEntity;\n\n/**\n * Drupal 7 taxonomy term source from database.\n *\n * Available configuration keys:\n * - bundle: (optional) The taxonomy vocabulary (machine name) to filter terms\n *   retrieved from the source - can be a string or an array. If omitted, all\n *   terms are retrieved.\n *\n * Examples:\n *\n * @code\n * source:\n *   plugin: d7_taxonomy_term\n *   bundle: tags\n * @endcode\n *\n * In this example terms of 'tags' vocabulary are retrieved from the source\n * database.\n *\n * @code\n * source:\n *   plugin: d7_taxonomy_term\n *   bundle: [tags, forums]\n * @endcode\n *\n * In this example terms of 'tags' and 'forums' vocabularies are retrieved\n * from the source database.\n *\n * For additional configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @todo Support term_relation, term_synonym table if possible.\n *\n * @MigrateSource(\n *   id = \"d7_taxonomy_term\",\n *   source_module = \"taxonomy\"\n * )\n */\nclass Term extends FieldableEntity {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $query = $this->select('taxonomy_term_data', 'td')\n      ->fields('td')\n      ->distinct()\n      ->orderBy('tid');\n    $query->leftJoin('taxonomy_vocabulary', 'tv', '[td].[vid] = [tv].[vid]');\n    $query->addField('tv', 'machine_name');\n\n    if ($this->getDatabase()\n      ->schema()\n      ->fieldExists('taxonomy_vocabulary', 'i18n_mode')) {\n      $query->addField('tv', 'i18n_mode');\n    }\n\n    if (isset($this->configuration['bundle'])) {\n      $query->condition('tv.machine_name', (array) $this->configuration['bundle'], 'IN');\n    }\n\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = [\n      'tid' => $this->t('The term ID.'),\n      'vid' => $this->t('Existing term VID'),\n      'machine_name' => $this->t('Vocabulary machine name'),\n      'name' => $this->t('The name of the term.'),\n      'description' => $this->t('The term description.'),\n      'weight' => $this->t('Weight'),\n      'parent' => $this->t(\"The Drupal term IDs of the term's parents.\"),\n      'format' => $this->t(\"Format of the term description.\"),\n    ];\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    $tid = $row->getSourceProperty('tid');\n    $vocabulary = $row->getSourceProperty('machine_name');\n    $default_language = (array) $this->variableGet('language_default', ['language' => 'en']);\n\n    // If this entity was translated using Entity Translation, we need to get\n    // its source language to get the field values in the right language.\n    // The translations will be migrated by the d7_node_entity_translation\n    // migration.\n    $translatable_vocabularies = array_keys(array_filter($this->variableGet('entity_translation_taxonomy', [])));\n    $entity_translatable = $this->isEntityTranslatable('taxonomy_term') && in_array($vocabulary, $translatable_vocabularies, TRUE);\n\n    if ($entity_translatable) {\n      $source_language = $this->getEntityTranslationSourceLanguage('taxonomy_term', $tid);\n      $language = $entity_translatable && $source_language ? $source_language : $default_language['language'];\n    }\n    // If this is an i18n translation use the default language when i18n_mode\n    // is localized.\n    if ($row->get('i18n_mode')) {\n      $language = ($row->get('i18n_mode') === '1') ? $default_language['language'] : $row->get('language');\n    }\n\n    $language = $language ?? $default_language['language'];\n    $row->setSourceProperty('language', $language);\n\n    // Get Field API field values.\n    foreach ($this->getFields('taxonomy_term', $vocabulary) as $field_name => $field) {\n      // Ensure we're using the right language if the entity and the field are\n      // translatable.\n      $field_language = $entity_translatable && $field['translatable'] ? $language : NULL;\n      $row->setSourceProperty($field_name, $this->getFieldValues('taxonomy_term', $field_name, $tid, NULL, $field_language));\n    }\n\n    // Find parents for this row.\n    $parents = $this->select('taxonomy_term_hierarchy', 'th')\n      ->fields('th', ['parent', 'tid'])\n      ->condition('tid', $row->getSourceProperty('tid'))\n      ->execute()\n      ->fetchCol();\n    $row->setSourceProperty('parent', $parents);\n\n    // If the term name or term description were replaced by real fields using\n    // the Drupal 7 Title module, use the fields value instead of the term name\n    // or term description.\n    if ($this->moduleExists('title')) {\n      $name_field = $row->getSourceProperty('name_field');\n      if (isset($name_field[0]['value'])) {\n        $row->setSourceProperty('name', $name_field[0]['value']);\n      }\n      $description_field = $row->getSourceProperty('description_field');\n      if (isset($description_field[0]['value'])) {\n        $row->setSourceProperty('description', $description_field[0]['value']);\n      }\n      if (isset($description_field[0]['format'])) {\n        $row->setSourceProperty('format', $description_field[0]['format']);\n      }\n    }\n\n    return parent::prepareRow($row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['tid']['type'] = 'integer';\n    return $ids;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/src/Plugin/migrate/source/d7/Term.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Term", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Menu\nnoUi: true\ngroup: Navigation\ndescription: A list of options for the user to choose from.\nlinks:\n  - https://shoelace.style/components/menu\nslots:\n  label:\n    title: Label\nprops:\n  type: object\n  properties:\n    items:\n      title: Items\n      $ref: ui-patterns://links\nlibraryOverrides:\n  dependencies:\n    - display_builder/shoelace\n", "metadata": {"source": "repos/display_builder/components/shoelace/menu/menu.component.yml", "type": "yaml_reference", "topic": "menu.component"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: GatewayRouteInterface.php\nTarget symbol: interface GatewayRouteInterface\nNamespace: Drupal\\api_normalization\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for GatewayRouteInterface.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityInterface\n- Ensure these methods exist where relevant:\n  - getAuth()\n  - getCacheTtl()\n  - getCircuitBreaker()\n  - getCors()\n  - getDescription()\n  - getMethods()\n  - getRateLimit()\n  - getRequestTransforms()\n  - getResponseTransforms()\n  - getSourcePath()\n  - getTargetUrl()\n  - getTimeout()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\n\n/**\n * Interface for Gateway Route entities.\n */\ninterface GatewayRouteInterface extends ConfigEntityInterface {\n\n  /**\n   * Gets the description.\n   *\n   * @return string\n   *   The description.\n   */\n  public function getDescription(): string;\n\n  /**\n   * Sets the description.\n   *\n   * @param string $description\n   *   The description.\n   *\n   * @return $this\n   */\n  public function setDescription(string $description): GatewayRouteInterface;\n\n  /**\n   * Gets the weight.\n   *\n   * @return int\n   *   The weight.\n   */\n  public function getWeight(): int;\n\n  /**\n   * Sets the weight.\n   *\n   * @param int $weight\n   *   The weight.\n   *\n   * @return $this\n   */\n  public function setWeight(int $weight): GatewayRouteInterface;\n\n  /**\n   * Gets the source path pattern.\n   *\n   * @return string\n   *   The source path.\n   */\n  public function getSourcePath(): string;\n\n  /**\n   * Sets the source path pattern.\n   *\n   * @param string $path\n   *   The source path.\n   *\n   * @return $this\n   */\n  public function setSourcePath(string $path): GatewayRouteInterface;\n\n  /**\n   * Gets the target URL.\n   *\n   * @return string\n   *   The target URL.\n   */\n  public function getTargetUrl(): string;\n\n  /**\n   * Sets the target URL.\n   *\n   * @param string $url\n   *   The target URL.\n   *\n   * @return $this\n   */\n  public function setTargetUrl(string $url): GatewayRouteInterface;\n\n  /**\n   * Gets the allowed HTTP methods.\n   *\n   * @return array\n   *   Array of HTTP methods.\n   */\n  public function getMethods(): array;\n\n  /**\n   * Sets the allowed HTTP methods.\n   *\n   * @param array $methods\n   *   Array of HTTP methods.\n   *\n   * @return $this\n   */\n  public function setMethods(array $methods): GatewayRouteInterface;\n\n  /**\n   * Gets the authentication configuration.\n   *\n   * @return array\n   *   The auth config.\n   */\n  public function getAuth(): array;\n\n  /**\n   * Sets the authentication configuration.\n   *\n   * @param array $auth\n   *   The auth config.\n   *\n   * @return $this\n   */\n  public function setAuth(array $auth): GatewayRouteInterface;\n\n  /**\n   * Gets request transformations.\n   *\n   * @return array\n   *   Array of transforms.\n   */\n  public function getRequestTransforms(): array;\n\n  /**\n   * Sets request transformations.\n   *\n   * @param array $transforms\n   *   Array of transforms.\n   *\n   * @return $this\n   */\n  public function setRequestTransforms(array $transforms): GatewayRouteInterface;\n\n  /**\n   * Gets response transformations.\n   *\n   * @return array\n   *   Array of transforms.\n   */\n  public function getResponseTransforms(): array;\n\n  /**\n   * Sets response transformations.\n   *\n   * @param array $transforms\n   *   Array of transforms.\n   *\n   * @return $this\n   */\n  public function setResponseTransforms(array $transforms): GatewayRouteInterface;\n\n  /**\n   * Gets cache TTL.\n   *\n   * @return int\n   *   Cache TTL in seconds.\n   */\n  public function getCacheTtl(): int;\n\n  /**\n   * Sets cache TTL.\n   *\n   * @param int $ttl\n   *   Cache TTL in seconds.\n   *\n   * @return $this\n   */\n  public function setCacheTtl(int $ttl): GatewayRouteInterface;\n\n  /**\n   * Gets rate limit configuration.\n   *\n   * @return array\n   *   Rate limit config.\n   */\n  public function getRateLimit(): array;\n\n  /**\n   * Sets rate limit configuration.\n   *\n   * @param array $config\n   *   Rate limit config.\n   *\n   * @return $this\n   */\n  public function setRateLimit(array $config): GatewayRouteInterface;\n\n  /**\n   * Gets circuit breaker configuration.\n   *\n   * @return array\n   *   Circuit breaker config.\n   */\n  public function getCircuitBreaker(): array;\n\n  /**\n   * Sets circuit breaker configuration.\n   *\n   * @param array $config\n   *   Circuit breaker config.\n   *\n   * @return $this\n   */\n  public function setCircuitBreaker(array $config): GatewayRouteInterface;\n\n  /**\n   * Gets CORS configuration.\n   *\n   * @return array\n   *   CORS config.\n   */\n  public function getCors(): array;\n\n  /**\n   * Sets CORS configuration.\n   *\n   * @param array $config\n   *   CORS config.\n   *\n   * @return $this\n   */\n  public function setCors(array $config): GatewayRouteInterface;\n\n  /**\n   * Gets request timeout.\n   *\n   * @return int\n   *   Timeout in seconds.\n   */\n  public function getTimeout(): int;\n\n  /**\n   * Sets request timeout.\n   *\n   * @param int $timeout\n   *   Timeout in seconds.\n   *\n   * @return $this\n   */\n  public function setTimeout(int $timeout): GatewayRouteInterface;\n\n  /**\n   * Converts entity to route configuration array.\n   *\n   * @return array\n   *   Route configuration for ApiGatewayManager.\n   */\n  public function toRouteConfig(): array;\n\n  /**\n   * Matches a request path against this route.\n   *\n   * @param string $path\n   *   The request path.\n   * @param string $method\n   *   The HTTP method.\n   *\n   * @return array|null\n   *   Path parameters if matched, NULL otherwise.\n   */\n  public function matchPath(string $path, string $method): ?array;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Entity/GatewayRouteInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "GatewayRouteInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface DateTimeInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Type;\n\nuse Drupal\\Core\\Datetime\\DrupalDateTime;\n\n/**\n * Interface for dates, optionally including a time.\n *\n * @ingroup typed_data\n */\ninterface DateTimeInterface {\n\n  /**\n   * Returns the date time object.\n   *\n   * @return \\Drupal\\Core\\Datetime\\DrupalDateTime|null\n   *   A date object or NULL if there is no date.\n   */\n  public function getDateTime();\n\n  /**\n   * Sets the date time object.\n   *\n   * @param \\Drupal\\Core\\Datetime\\DrupalDateTime $dateTime\n   *   An instance of a date time object.\n   */\n  public function setDateTime(DrupalDateTime $dateTime);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Type/DateTimeInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DateTimeInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FieldWidget in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a FieldWidget annotation object.\n *\n * Widgets handle how fields are displayed in edit forms.\n *\n * Additional annotation keys for widgets can be defined in\n * hook_field_widget_info_alter().\n *\n * @Annotation\n *\n * @see \\Drupal\\Core\\Field\\WidgetPluginManager\n * @see \\Drupal\\Core\\Field\\WidgetInterface\n *\n * @ingroup field_widget\n */\nclass FieldWidget extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The human-readable name of the widget type.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * A short description of the widget type.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $description;\n\n  /**\n   * The name of the widget class.\n   *\n   * This is not provided manually, it will be added by the discovery mechanism.\n   *\n   * @var string\n   */\n  public $class;\n\n  /**\n   * An array of field types the widget supports.\n   *\n   * @var array\n   */\n  public $field_types = [];\n\n  /**\n   * Does the field widget handles multiple values at once.\n   *\n   * @var bool\n   */\n  public $multiple_values = FALSE;\n\n  /**\n   * An integer to determine weight of this widget relative to other widgets.\n   *\n   * Other widgets are in the Field UI when selecting a widget for a given\n   * field.\n   *\n   * This property is optional and it does not need to be declared.\n   *\n   * @var int\n   */\n  public $weight = NULL;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Annotation/FieldWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldWidget", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Mautic Content Provider'\ntype: module\ndescription: 'Exposes nodes and views as clean HTML for Mautic emails.'\ncore_version_requirement: ^10 | ^11\nconfigure: mautic_content_provider.settings\npackage: Mautic\n", "metadata": {"source": "repos/mautic_content_provider/mautic_content_provider.info.yml", "type": "yaml_reference", "topic": "mautic content provider.info"}}
{"instruction": "Show me the implementation of the class HttpExceptionNormalizerValue in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\Normalizer\\Value;\n\n/**\n * Helps normalize exceptions in compliance with the JSON:API spec.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nclass HttpExceptionNormalizerValue extends CacheableNormalization {}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/Normalizer/Value/HttpExceptionNormalizerValue.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HttpExceptionNormalizerValue", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Bootstrap5 Layouts \u00bb Upper Half'\ntype: module\ndescription: 'Layouts with Bootstrap5 Grid system. Columns 7 to 12 | Upper Half.'\ncore_version_requirement: ^10.3 || ^11\npackage: 'Bootstrap5 Layouts'\ndependencies:\n  - drupal:layout_builder\n  - drupal:layout_discovery\n  - bootstrap_five_layouts:bootstrap_five_layouts\n#   - layout_builder_reorder:layout_builder_reorder\n#   - layoutbuilder_extras:layoutbuilder_extras\n", "metadata": {"source": "repos/bootstrap_five_layouts/modules/bootstrap_five_layouts_upper_half/bootstrap_five_layouts_upper_half.info.yml", "type": "yaml_reference", "topic": "bootstrap five layouts upper half.info"}}
{"instruction": "Show me the implementation of the class NullStorage in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Config;\n\n/**\n * Defines a stub storage.\n *\n * This storage is always empty; the controller reads and writes nothing.\n *\n * The stub implementation is needed for synchronizing configuration during\n * installation of a module, in which case all configuration being shipped with\n * the module is known to be new. Therefore, the module installation process is\n * able to short-circuit the full diff against the active configuration; the\n * diff would yield all currently available configuration as items to remove,\n * since they do not exist in the module's default configuration directory.\n *\n * This also can be used for testing purposes.\n */\nclass NullStorage implements StorageInterface {\n\n  /**\n   * The storage collection.\n   *\n   * @var string\n   */\n  protected $collection;\n\n  /**\n   * Constructs a new NullStorage.\n   *\n   * @param string $collection\n   *   (optional) The collection to store configuration in. Defaults to the\n   *   default collection.\n   */\n  public function __construct($collection = StorageInterface::DEFAULT_COLLECTION) {\n    $this->collection = $collection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function exists($name) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function read($name) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function readMultiple(array $names) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function write($name, array $data) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete($name) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function rename($name, $new_name) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function encode($data) {\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function decode($raw) {\n    return $raw;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function listAll($prefix = '') {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteAll($prefix = '') {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createCollection($collection) {\n    return new static($collection);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAllCollectionNames() {\n    // Returns only non empty collections.\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCollectionName() {\n    return $this->collection;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/NullStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NullStorage", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Sustainable contribution", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Sustainability](/docs/getting-started/sustainability)\n\n* [Contributing to Sustainability in Drupal](/docs/getting-started/sustainability/contributing-to-sustainability-in-drupal)\n* [Getting Started with Sustainability](/docs/getting-started/sustainability/getting-started-with-sustainability)\n* [Module & Theme Considerations](/docs/getting-started/sustainability/module-theme-considerations)\n* [Quantifying Emissions](/docs/getting-started/sustainability/quantifying-emissions)\n* [Sustainable contribution](/docs/getting-started/sustainability/sustainable-contribution)\n\n# Sustainable contribution\n\nContributing to Drupal is fun. If you do contribution right, you will enjoy it for years and form lasting connections in the Drupal community.\n\n* Do not over-commit yourself.\n* Do not over-extend yourself.\n* Make sure you get more out of Drupal than you contribute.\n* If you are contributing to benefit someone else, ask to be paid fairly for your time and expertise.\n\n## [Drupal Forge](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge)\n\nVolunteer-driven model marketplace for ready-made Drupal sites designed to sustain open contribution and collaboration.\n\n* [Drupal Forge user guide](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge/drupal-forge-user-guide)\n* [Drupal Forge volunteer guide](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge/drupal-forge-volunteer-guide)\n* [Drupal Forge partner guide](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge/drupal-forge-partner-guide)\n* [Drupal Forge sponsor guide](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge/drupal-forge-sponsor-guide)\n* [Drupal Forge governance](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge/drupal-forge-governance)\n* [Drupal Forge road map](/docs/getting-started/sustainability/sustainable-contribution/drupal-forge/drupal-forge-road-map)\n\n## Guide maintainers\n\n[![darren oh's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-30772-1566962783.jpg?itok=bpLsKYrK)](/user/30772 \"View darren oh's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/sustainability/sustainable-contribution.md", "type": "doc_summary", "topic": "Sustainable contribution"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: View.php\nTarget symbol: class View\nNamespace: Drupal\\views\\Plugin\\views\\area\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for View.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityStorageInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\views\\Attribute\\ViewsArea\n  - Drupal\\views\\Views\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildOptionsForm()\n  - calculateDependencies()\n  - create()\n  - defineOptions()\n  - isEmpty()\n  - render()", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\area;\n\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsArea;\nuse Drupal\\views\\Views;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Views area handlers. Insert a view inside of an area.\n *\n * @ingroup views_area_handlers\n */\n#[ViewsArea(\"view\")]\nclass View extends AreaPluginBase {\n\n  /**\n   * Stores whether the embedded view is actually empty.\n   *\n   * @var bool\n   */\n  protected $isEmpty;\n\n  /**\n   * The view storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected $viewStorage;\n\n  /**\n   * Constructs a View object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $view_storage\n   *   The view storage.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, EntityStorageInterface $view_storage) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->viewStorage = $view_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('entity_type.manager')->getStorage('view')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n\n    $options['view_to_insert'] = ['default' => ''];\n    $options['inherit_arguments'] = ['default' => FALSE];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n\n    $view_display = $this->view->storage->id() . ':' . $this->view->current_display;\n\n    $options = ['' => $this->t('-Select-')];\n    $options += Views::getViewsAsOptions(FALSE, 'all', $view_display, FALSE, TRUE);\n    $form['view_to_insert'] = [\n      '#type' => 'select',\n      '#title' => $this->t('View to insert'),\n      '#default_value' => $this->options['view_to_insert'],\n      '#description' => $this->t('The view to insert into this area.'),\n      '#options' => $options,\n    ];\n\n    $form['inherit_arguments'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Inherit contextual filters'),\n      '#default_value' => $this->options['inherit_arguments'],\n      '#description' => $this->t('If checked, this view will receive the same contextual filters as its parent.'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($empty = FALSE) {\n    if (!empty($this->options['view_to_insert'])) {\n      [$view_name, $display_id] = explode(':', $this->options['view_to_insert']);\n\n      $view = $this->viewStorage->load($view_name)->getExecutable();\n\n      if (empty($view) || !$view->access($display_id)) {\n        return [];\n      }\n      $view->setDisplay($display_id);\n\n      // Avoid recursion.\n      $view->parent_views += $this->view->parent_views;\n      $view->parent_views[] = \"$view_name:$display_id\";\n\n      // Check if the view is part of the parent views of this view.\n      $search = \"$view_name:$display_id\";\n      if (in_array($search, $this->view->parent_views)) {\n        \\Drupal::messenger()\n          ->addError($this->t(\"Recursion detected in view @view display @display.\", [\n            '@view' => $view_name,\n            '@display' => $display_id,\n          ]));\n      }\n      else {\n        if (!empty($this->options['inherit_arguments']) && !empty($this->view->args)) {\n          $output = $view->preview($display_id, $this->view->args);\n        }\n        else {\n          $output = $view->preview($display_id);\n        }\n        $this->isEmpty = $view->display_handler->outputIsEmpty();\n        return $output;\n      }\n    }\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isEmpty() {\n    if (isset($this->isEmpty)) {\n      return $this->isEmpty;\n    }\n    else {\n      return parent::isEmpty();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    $dependencies = parent::calculateDependencies();\n\n    [$view_id] = explode(':', $this->options['view_to_insert'], 2);\n    // Don't call the current view, as it would result into an infinite\n    // recursion.\n    if ($view_id && $this->view->storage->id() != $view_id) {\n      $view = $this->viewStorage->load($view_id);\n      $dependencies[$view->getConfigDependencyKey()][] = $view->getConfigDependencyName();\n    }\n\n    return $dependencies;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/area/View.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "View", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "drupal.options-icon:\n  version: VERSION\n  css:\n    theme:\n      css/options.icon.theme.css: {}\n  dependencies:\n    - field_ui/drupal.field_ui.manage_fields\n", "metadata": {"source": "repos/drupal_core/core/modules/options/options.libraries.yml", "type": "yaml_reference", "topic": "options.libraries"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: CheckpointStorageInterface.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Config\\Checkpoint;\n\nuse Drupal\\Core\\Config\\StorageInterface;\n\n/**\n * Provides an interface for checkpoint storages.\n *\n * @internal\n *   This API is experimental.\n */\ninterface CheckpointStorageInterface extends StorageInterface {\n\n  /**\n   * Creates a checkpoint, if required, and returns the active checkpoint.\n   *\n   * If the storage determines that the current active checkpoint would contain\n   * the same information, it does not have to create a new checkpoint.\n   *\n   * @param string|\\Stringable $label\n   *   The checkpoint label to use if a new checkpoint is created.\n   *\n   * @return \\Drupal\\Core\\Config\\Checkpoint\\Checkpoint\n   *   The currently active checkpoint.\n   */\n  public function checkpoint(string|\\Stringable $label): Checkpoint;\n\n  /**\n   * Sets the checkpoint to read from.\n   *\n   * Calling read() or readMultiple() will return the configuration data at the\n   * time of the checkpoint that was set here. If none is set, then the\n   * configuration from the initial checkpoint will be returned.\n   *\n   * @param string|\\Drupal\\Core\\Config\\Checkpoint\\Checkpoint $checkpoint_id\n   *   The checkpoint ID to read from.\n   *\n   * @return $this\n   *\n   * @throws \\Drupal\\Core\\Config\\Checkpoint\\UnknownCheckpointException\n   *   Thrown when the provided checkpoint does not exist.\n   */\n  public function setCheckpointToReadFrom(string|Checkpoint $checkpoint_id): static;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Config\\Checkpoint;\n\nuse Drupal\\Core\\Config\\StorageInterface;\n\n/**\n * Provides an interface for checkpoint storages.\n *\n * @internal\n *   This API is experimental.\n */\ninterface CheckpointStorageInterface extends StorageInterface {\n\n  /**\n   * Creates a checkpoint, if required, and returns the active checkpoint.\n   *\n   * If the storage determines that the current active checkpoint would contain\n   * the same information, it does not have to create a new checkpoint.\n   *\n   * @param string|\\Stringable $label\n   *   The checkpoint label to use if a new checkpoint is created.\n   *\n   * @return \\Drupal\\Core\\Config\\Checkpoint\\Checkpoint\n   *   The currently active checkpoint.\n   */\n  public function checkpoint(string|\\Stringable $label): Checkpoint;\n\n  /**\n   * Sets the checkpoint to read from.\n   *\n   * Calling read() or readMultiple() will return the configuration data at the\n   * time of the checkpoint that was set here. If none is set, then the\n   * configuration from the initial checkpoint will be returned.\n   *\n   * @param string|\\Drupal\\Core\\Config\\Checkpoint\\Checkpoint $checkpoint_id\n   *   The checkpoint ID to read from.\n   *\n   * @return $this\n   *\n   * @throws \\Drupal\\Core\\Config\\Checkpoint\\UnknownCheckpointException\n   *   Thrown when the provided checkpoint does not exist.\n   */\n  public function setCheckpointToReadFrom(string|Checkpoint $checkpoint_id): static;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/Checkpoint/CheckpointStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CheckpointStorageInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'FlowDrop AI Provider'\ntype: module\ndescription: 'FlowDrop Integration with Drupal AI'\npackage: FlowDrop\ncore_version_requirement: ^11\ndependencies:\n  - ai:ai\n  - ai_agents:ai_agents\n  - flowdrop:flowdrop\n  - flowdrop:flowdrop_node_type\n", "metadata": {"source": "repos/flowdrop_ai_provider/flowdrop_ai_provider.info.yml", "type": "yaml_reference", "topic": "flowdrop ai provider.info"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: decorative_images.module\nTarget symbol: class decorative_images.module\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for decorative_images.module.\n- Include required imports:\n  - Drupal\\node\\NodeInterface\n  - Drupal\\media\\MediaInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\image\\Plugin\\Field\\FieldType\\ImageItem\n  - Drupal\\decorative_images\\Hook\\DecorativeConfigFormAlter\n  - Drupal\\decorative_images\\Hook\\DecorativeWidgetFormAlter\n- Ensure these methods exist where relevant:\n  - decorative_images_entity_presave()\n  - decorative_images_field_widget_single_element_form_alter()\n  - decorative_images_form_alter()\n  - decorative_images_preprocess_field()\n  - decorative_images_preprocess_image()", "output": "<?php\n\n/**\n * @file\n * Hook implementations for the decorative_images module.\n */\n\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\media\\MediaInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\image\\Plugin\\Field\\FieldType\\ImageItem;\nuse Drupal\\decorative_images\\Hook\\DecorativeConfigFormAlter;\nuse Drupal\\decorative_images\\Hook\\DecorativeWidgetFormAlter;\n\n/**\n * Implements hook_form_alter().\n *\n * Alters field configuration forms to add decorative image option.\n */\nfunction decorative_images_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  DecorativeConfigFormAlter::alterForm($form, $form_state, $form_id);\n}\n\n/**\n * Implements hook_field_widget_single_element_form_alter().\n *\n * Adds the decorative option if the field is configured to support it.\n */\nfunction decorative_images_field_widget_single_element_form_alter(array &$element, FormStateInterface $form_state, array $context) {\n  DecorativeWidgetFormAlter::alterForm($element, $form_state, $context);\n}\n\n/**\n * Implements hook_entity_presave().\n *\n * Saves 'Decorative' entity field value.\n */\nfunction decorative_images_entity_presave(EntityInterface $entity) {\n  if (!$entity instanceof NodeInterface && !$entity instanceof MediaInterface) {\n    return;\n  }\n\n  foreach ($entity->getFieldDefinitions() as $field_name => $field_definition) {\n    if ($field_definition->getType() !== 'image') {\n      continue;\n    }\n\n    foreach ($entity->get($field_name) as &$item) {\n      $is_decorative = (int) $item->is_decorative ?? 0;\n      \\Drupal::service('keyvalue')->get('decorative_images')->set($item->target_id, $is_decorative);\n    }\n  }\n}\n\n/**\n * Implements hook_preprocess_hook().\n *\n * Adds `role=\"presentation\"` to decorative images.\n */\nfunction decorative_images_preprocess_field(array &$variables, string $hook): void {\n  if ($variables['field_type'] !== 'image') {\n    return;\n  }\n  foreach ($variables['items'] as &$item) {\n    $image = $item['content']['#item'] ?? NULL;\n    if (!$image instanceof ImageItem) {\n      continue;\n    }\n    $is_decorative = (int) \\Drupal::service('keyvalue')->get('decorative_images')->get($image->target_id) ?? 0;\n    if ($is_decorative) {\n      $item['content']['#item_attributes']['role'] = 'presentation';\n    }\n  }\n}\n\n/**\n * Implements template_preprocess_image().\n *\n * If the image is for presentation only, remove the `role` attribute\n * and set the alternative text to an empty string.\n */\nfunction decorative_images_preprocess_image(&$variables) {\n  $role = $variables['attributes']['role'] ?? NULL;\n  if ($role === 'presentation') {\n    unset($variables['attributes']['role']);\n    $variables['attributes']['alt'] = '';\n  }\n}\n", "metadata": {"source": "repos/decorative_images/decorative_images.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DecorativeImages", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: FullyValidatableConstraintValidator\nSource file: <source_file>\nFile name hint: FullyValidatableConstraintValidator.php\nBroken snippet:\n<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * FullyValidatable constraint.\n *\n * @internal\n */\nfinal class FullyValidatableConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  function validate(mixed $value, Constraint $constraint): void {\n    // No-op.\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\n\n/**\n * FullyValidatable constraint.\n *\n * @internal\n */\nfinal class FullyValidatableConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $value, Constraint $constraint): void {\n    // No-op.\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Validation/Plugin/Validation/Constraint/FullyValidatableConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FullyValidatableConstraintValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class PathWidget in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\path\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldWidget;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Field\\WidgetBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Symfony\\Component\\Validator\\ConstraintViolationInterface;\n\n/**\n * Plugin implementation of the 'path' widget.\n */\n#[FieldWidget(\n  id: 'path',\n  label: new TranslatableMarkup('URL alias'),\n  field_types: ['path']\n)]\nclass PathWidget extends WidgetBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $entity = $items->getEntity();\n\n    $element += [\n      '#element_validate' => [[static::class, 'validateFormElement']],\n    ];\n    $element['alias'] = [\n      '#type' => 'textfield',\n      '#title' => $element['#title'],\n      '#default_value' => $items[$delta]->alias,\n      '#required' => $element['#required'],\n      '#maxlength' => 255,\n      '#description' => $this->t('Specify an alternative path by which this data can be accessed. For example, type \"/about\" when writing an about page.'),\n    ];\n    $element['pid'] = [\n      '#type' => 'value',\n      '#value' => $items[$delta]->pid,\n    ];\n    $element['source'] = [\n      '#type' => 'value',\n      '#value' => !$entity->isNew() ? '/' . $entity->toUrl()->getInternalPath() : NULL,\n    ];\n    $element['langcode'] = [\n      '#type' => 'value',\n      '#value' => $items[$delta]->langcode,\n    ];\n\n    // If the advanced settings tabs-set is available (normally rendered in the\n    // second column on wide-resolutions), place the field as a details element\n    // in this tab-set.\n    if (isset($form['advanced'])) {\n      $element += [\n        '#type' => 'details',\n        '#title' => $this->t('URL path settings'),\n        '#open' => !empty($items[$delta]->alias),\n        '#group' => 'advanced',\n        '#access' => $entity->get('path')->access('edit'),\n        '#attributes' => [\n          'class' => ['path-form'],\n        ],\n        '#attached' => [\n          'library' => ['path/drupal.path'],\n        ],\n      ];\n      $element['#weight'] = 30;\n    }\n\n    return $element;\n  }\n\n  /**\n   * Form element validation handler for URL alias form element.\n   *\n   * @param array $element\n   *   The form element.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   */\n  public static function validateFormElement(array &$element, FormStateInterface $form_state) {\n    // Trim the submitted value of whitespace and slashes.\n    $alias = rtrim(trim($element['alias']['#value']), \" \\\\/\");\n    if ($alias !== '') {\n      $form_state->setValueForElement($element['alias'], $alias);\n\n      /** @var \\Drupal\\path_alias\\PathAliasInterface $path_alias */\n      $path_alias = \\Drupal::entityTypeManager()->getStorage('path_alias')->create([\n        'path' => $element['source']['#value'],\n        'alias' => $alias,\n        'langcode' => $element['langcode']['#value'],\n      ]);\n      $violations = $path_alias->validate();\n\n      foreach ($violations as $violation) {\n        // Newly created entities do not have a system path yet, so we need to\n        // disregard some violations.\n        if (!$path_alias->getPath() && $violation->getPropertyPath() === 'path') {\n          continue;\n        }\n        $form_state->setError($element['alias'], $violation->getMessage());\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function errorElement(array $element, ConstraintViolationInterface $violation, array $form, FormStateInterface $form_state) {\n    return $element['alias'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path/src/Plugin/Field/FieldWidget/PathWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathWidget", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Dummy content and common gotchas", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Profiling Drupal](/docs/develop/profiling-drupal)\n\n* [Benchmarking and profiling Drupal](/docs/develop/profiling-drupal/benchmarking-and-profiling-drupal)\n* [Apache Bench (ab)](/docs/develop/profiling-drupal/apache-bench-ab)\n* [Dummy content and common gotchas](/docs/develop/profiling-drupal/dummy-content-and-common-gotchas)\n* [Profiling memory usage](/docs/develop/profiling-drupal/profiling-memory-usage)\n\n# Dummy content and common gotchas\n\nLast [updated](/node/659982/discuss) on\n\n14 October 2016\n\nSetting up a performance testing environment\n\nBenchmarking is best done on your local computer or in a dedicated testing environment so that you can eliminate the possibility of network traffic and other factors that might bias the results.\n\nFollowing Dries's recommendations, we're going to setup an environment with:\n\n\\* 2,000 users\n\\* 5,000 nodes\n\\* 5,000 path aliases\n\\* 10,000 comments\n\\* 250 terms\n\\* 15 vocabularies\n\nDownload a copy of Devel module to get its handy devel\\_generate.module. Note that since HEAD can be volatile, always check the issue queue for updated patches.\n\nBrowse your site to /admin and use the 'Generate content' links to generate the sample data outlined above.\n\nNotes\n\n\\* You should disable MySQL query caching. Run this query:\nSET GLOBAL query\\_cache\\_size = 0;\n\\* You should also disable PHP debugger plugins.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/659982/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%28659982%29%20Dummy%20content%20and%20common%20gotchas) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/profiling-drupal/dummy-content-and-common-gotchas.md", "type": "doc_summary", "topic": "Dummy content and common gotchas"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation to display a table.\n *\n * Available variables:\n * - attributes: HTML attributes to apply to the <table> tag.\n * - caption: A localized string for the <caption> tag.\n * - colgroups: Column groups. Each group contains the following properties:\n *   - attributes: HTML attributes to apply to the <col> tag.\n *     Note: Drupal currently supports only one table header row, see\n *     https://www.drupal.org/node/893530 and\n *     http://api.drupal.org/api/drupal/includes!theme.inc/function/theme_table/7#comment-5109.\n * - header: Table header cells. Each cell contains the following properties:\n *   - tag: The HTML tag name to use; either 'th' or 'td'.\n *   - attributes: HTML attributes to apply to the tag.\n *   - content: A localized string for the title of the column.\n *   - field: Field name (required for column sorting).\n *   - sort: Default sort order for this column (\"asc\" or \"desc\").\n * - sticky: A flag indicating whether to use a \"sticky\" table header.\n * - rows: Table rows. Each row contains the following properties:\n *   - attributes: HTML attributes to apply to the <tr> tag.\n *   - data: Table cells.\n *   - no_striping: A flag indicating that the row should receive no\n *     'even / odd' styling. Defaults to FALSE.\n *   - cells: Table cells of the row. Each cell contains the following keys:\n *     - tag: The HTML tag name to use; either 'th' or 'td'.\n *     - attributes: Any HTML attributes, such as \"colspan\", to apply to the\n *       table cell.\n *     - content: The string to display in the table cell.\n *     - active_table_sort: A boolean indicating whether the cell is the active\n         table sort.\n *     - header: Boolean indicating whether the cell should be rendered as a\n *       header (<th>) or not (<td>).\n * - footer: Table footer rows, in the same format as the rows variable.\n * - empty: The message to display in an extra row if table does not have\n *   any rows.\n * - no_striping: A boolean indicating that the row should receive no striping.\n * - header_columns: The number of columns in the header.\n *\n * @see \\Drupal\\Core\\Theme\\ThemePreprocess::preprocessTable()\n *\n * @ingroup themeable\n */\n#}\n<table{{ attributes }}>\n  {% if caption %}\n    <caption>{{ caption }}</caption>\n  {% endif %}\n\n  {% for colgroup in colgroups %}\n    {% if colgroup.cols %}\n      <colgroup{{ colgroup.attributes }}>\n        {% for col in colgroup.cols %}\n          <col{{ col.attributes }} />\n        {% endfor %}\n      </colgroup>\n    {% else %}\n      <colgroup{{ colgroup.attributes }} />\n    {% endif %}\n  {% endfor %}\n\n  {% if header %}\n    <thead>\n      <tr>\n        {% for cell in header %}\n          <{{ cell.tag }}{{ cell.attributes }}>\n            {{- cell.content -}}\n          </{{ cell.tag }}>\n        {% endfor %}\n      </tr>\n    </thead>\n  {% endif %}\n\n  {% if rows %}\n    <tbody>\n      {% for row in rows %}\n        <tr{{ row.attributes }}>\n          {% for cell in row.cells %}\n            <{{ cell.tag }}{{ cell.attributes }}>\n              {{- cell.content -}}\n            </{{ cell.tag }}>\n          {% endfor %}\n        </tr>\n      {% endfor %}\n    </tbody>\n  {% elseif empty %}\n    <tbody>\n      <tr>\n        <td colspan=\"{{ header_columns }}\">{{ empty }}</td>\n      </tr>\n    </tbody>\n  {% endif %}\n  {% if footer %}\n    <tfoot>\n      {% for row in footer %}\n        <tr{{ row.attributes }}>\n          {% for cell in row.cells %}\n            <{{ cell.tag }}{{ cell.attributes }}>\n              {{- cell.content -}}\n            </{{ cell.tag }}>\n          {% endfor %}\n        </tr>\n      {% endfor %}\n    </tfoot>\n  {% endif %}\n</table>\n", "metadata": {"source": "repos/drupal_core/core/modules/system/templates/table.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ReindexIndex\nSource file: <source_file>\nFile name hint: ReindexIndex.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_search_api\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_search_api\\Service\\SearchApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_search_api_reindex',\n  label: new TranslatableMarkup('Reindex Search Index'),\n  description: new TranslatableMarkup('Mark all items in a search index for reindexing.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Index ID'),\n      description: new TranslatableMarkup('The machine name of the search index to reindex.'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result message'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_items' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total items to reindex'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ReindexIndex extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'search_api';\n\n\n  protected SearchApiService $searchApiService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->searchApiService = $container->get('mcp_tools_search_api.search_api_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access.\n    $accessCheck = $this->accessManager->checkWriteAccess('reindex', 'search_api_index');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $id = $input['id'] ?? '';\n    if (empty($id)) {\n      return [\n        'success' => FALSE,\n        'error' => 'id is required.',\n        'code' => 'VALIDATION_ERROR',\n      ];\n    }\n\n    $result = $this->searchApiService->reindexIndex($id);\n\n    if ($result['success']) {\n      $this->auditLogger->log('reindex', 'search_api_index', $id, [\n        'total_items' => $result['total_items'] ?? 0,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_search_api\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools\\Service\\AccessManager;\nuse Drupal\\mcp_tools\\Service\\AuditLogger;\nuse Drupal\\mcp_tools_search_api\\Service\\SearchApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_search_api_reindex',\n  label: new TranslatableMarkup('Reindex Search Index'),\n  description: new TranslatableMarkup('Mark all items in a search index for reindexing.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Index ID'),\n      description: new TranslatableMarkup('The machine name of the search index to reindex.'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'success' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Success status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result message'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_items' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total items to reindex'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ReindexIndex extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'search_api';\n\n\n  protected SearchApiService $searchApiService;\n  protected AccessManager $accessManager;\n  protected AuditLogger $auditLogger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->searchApiService = $container->get('mcp_tools_search_api.search_api_service');\n    $instance->accessManager = $container->get('mcp_tools.access_manager');\n    $instance->auditLogger = $container->get('mcp_tools.audit_logger');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    // Check write access.\n    $accessCheck = $this->accessManager->checkWriteAccess('reindex', 'search_api_index');\n    if (!$accessCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $accessCheck['reason'],\n        'code' => $accessCheck['code'] ?? 'ACCESS_DENIED',\n      ];\n    }\n\n    $id = $input['id'] ?? '';\n    if (empty($id)) {\n      return [\n        'success' => FALSE,\n        'error' => 'id is required.',\n        'code' => 'VALIDATION_ERROR',\n      ];\n    }\n\n    $result = $this->searchApiService->reindexIndex($id);\n\n    if ($result['success']) {\n      $this->auditLogger->log('reindex', 'search_api_index', $id, [\n        'total_items' => $result['total_items'] ?? 0,\n      ]);\n    }\n\n    return $result;\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_search_api/src/Plugin/tool/Tool/ReindexIndex.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ReindexIndex", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class Island in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\AttributeBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\IslandType;\n\n/**\n * The island attribute.\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nfinal class Island extends AttributeBase {\n\n  /**\n   * Constructs a new Island instance.\n   *\n   * @param string $id\n   *   The plugin ID. There are some implementation bugs that make the plugin\n   *   available only if the ID follows a specific pattern. It must be either\n   *   identical to group or prefixed with the group. E.g. if the group is \"foo\"\n   *   the ID must be either \"foo\" or \"foo:bar\".\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $label\n   *   (Optional) The human-readable name of the plugin.\n   * @param bool $enabled_by_default\n   *   Island is enabled by default on new configuration. Default: False.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $description\n   *   (Optional) A brief description of the plugin.\n   * @param class-string|null $deriver\n   *   (Optional) The deriver class.\n   * @param \\Drupal\\display_builder\\IslandType|null $type\n   *   (Optional) The island type from enumeration.\n   * @param string|null $default_region\n   *   (Optional) The island default region, if applicable.\n   * @param string|null $icon\n   *   (Optional) Icon for this island.\n   * @param string $theme\n   *   (Optional) Set 'admin' to load the island with the admin theme.\n   * @param array $modules\n   *   (Optional) List of other modules required for this Island.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $label,\n    public readonly bool $enabled_by_default = FALSE,\n    public readonly ?TranslatableMarkup $description = NULL,\n    public readonly ?string $deriver = NULL,\n    public readonly ?IslandType $type = NULL,\n    public readonly ?string $default_region = NULL,\n    public readonly ?string $icon = NULL,\n    public readonly string $theme = 'default',\n    public readonly array $modules = [],\n  ) {}\n\n}\n", "metadata": {"source": "repos/display_builder/src/Attribute/Island.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Island", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: EntityDeriver\nSource file: <source_file>\nFile name hint: EntityDeriver.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Entity\\Plugin\\DataType\\Deriver;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface;\nuse Drupal\\Core\\Entity\\Plugin\\DataType\\ConfigEntityAdapter;\nuse Drupal\\Core\\Entity\\Plugin\\DataType\\EntityAdapter;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides data type plugins for each existing entity type and bundle.\n */\nclass EntityDeriver implements ContainerDeriverInterface {\n\n  /**\n   * List of derivative definitions.\n   *\n   * @var array\n   */\n  protected $derivatives = [];\n\n  /**\n   * The base plugin ID this derivative is for.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The bundle info service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface\n   */\n  protected $bundleInfoService;\n\n  /**\n   * Constructs an EntityDeriver object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface $bundle_info_service\n   *   The bundle info service.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, EntityTypeBundleInfoInterface $bundle_info_service) {\n    $this->basePluginId = $base_plugin_id;\n    $this->entityTypeManager = $entity_type_manager;\n    $this->bundleInfoService = $bundle_info_service;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('entity_type.bundle.info')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinition($derivative_id, $base_plugin_definition) {\n    if (!empty($this->derivatives) && !empty($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n    $this->getDerivativeDefinitions($base_plugin_definition);\n    if (isset($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    // Also keep the 'entity' defined as is.\n    $this->derivatives[''] = $base_plugin_definition;\n    // Add definitions for each entity type and bundle.\n    foreach ($this->entityTypeManager->getDefinitions() as $entity_type_id => $entity_type) {\n      $class = $entity_type->entityClassImplements(ConfigEntityInterface::class) ? ConfigEntityAdapter::class : EntityAdapter::class;\n      $this->derivatives[$entity_type_id] = [\n        'class' => $class,\n        'label' => $entity_type->getLabel(),\n        'constraints' => $entity_type->getConstraints(),\n        'internal' => $entity_type->isInternal(),\n      ] + $base_plugin_definition;\n\n      // Incorporate the bundles as entity:$entity_type:$bundle, if any.\n      $bundle_info = $this->bundleInfoService->getBundleInfo($entity_type_id);\n      if (count($bundle_info) > 1 || $entity_type->getKey('bundle')) {\n        foreach ($bundle_info as $bundle => $info) {\n          $this->derivatives[$entity_type_id . ':' . $bundle] = [\n            'class' => $class,\n            'label' => $info['label'],\n            'constraints' => $this->derivatives[$entity_type_id]['constraints'],\n          ] + $base_plugin_definition;\n        }\n      }\n    }\n    return $this->derivatives;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Plugin\\DataType\\Deriver;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface;\nuse Drupal\\Core\\Entity\\Plugin\\DataType\\ConfigEntityAdapter;\nuse Drupal\\Core\\Entity\\Plugin\\DataType\\EntityAdapter;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides data type plugins for each existing entity type and bundle.\n */\nclass EntityDeriver implements ContainerDeriverInterface {\n\n  /**\n   * List of derivative definitions.\n   *\n   * @var array\n   */\n  protected $derivatives = [];\n\n  /**\n   * The base plugin ID this derivative is for.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The bundle info service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface\n   */\n  protected $bundleInfoService;\n\n  /**\n   * Constructs an EntityDeriver object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface $bundle_info_service\n   *   The bundle info service.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, EntityTypeBundleInfoInterface $bundle_info_service) {\n    $this->basePluginId = $base_plugin_id;\n    $this->entityTypeManager = $entity_type_manager;\n    $this->bundleInfoService = $bundle_info_service;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('entity_type.bundle.info')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinition($derivative_id, $base_plugin_definition) {\n    if (!empty($this->derivatives) && !empty($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n    $this->getDerivativeDefinitions($base_plugin_definition);\n    if (isset($this->derivatives[$derivative_id])) {\n      return $this->derivatives[$derivative_id];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    // Also keep the 'entity' defined as is.\n    $this->derivatives[''] = $base_plugin_definition;\n    // Add definitions for each entity type and bundle.\n    foreach ($this->entityTypeManager->getDefinitions() as $entity_type_id => $entity_type) {\n      $class = $entity_type->entityClassImplements(ConfigEntityInterface::class) ? ConfigEntityAdapter::class : EntityAdapter::class;\n      $this->derivatives[$entity_type_id] = [\n        'class' => $class,\n        'label' => $entity_type->getLabel(),\n        'constraints' => $entity_type->getConstraints(),\n        'internal' => $entity_type->isInternal(),\n      ] + $base_plugin_definition;\n\n      // Incorporate the bundles as entity:$entity_type:$bundle, if any.\n      $bundle_info = $this->bundleInfoService->getBundleInfo($entity_type_id);\n      if (count($bundle_info) > 1 || $entity_type->getKey('bundle')) {\n        foreach ($bundle_info as $bundle => $info) {\n          $this->derivatives[$entity_type_id . ':' . $bundle] = [\n            'class' => $class,\n            'label' => $info['label'],\n            'constraints' => $this->derivatives[$entity_type_id]['constraints'],\n          ] + $base_plugin_definition;\n        }\n      }\n    }\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Plugin/DataType/Deriver/EntityDeriver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityDeriver", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "session:\n  parameter: language\nurl:\n  source: path_prefix\n  prefixes:\n    en: ''\n  domains:\n    en: ''\nselected_langcode: site_default\n", "metadata": {"source": "repos/drupal_core/core/modules/language/config/install/language.negotiation.yml", "type": "yaml_reference", "topic": "language.negotiation"}}
{"instruction": "Show me the implementation of the class ThemeNegotiatorWrapper in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Theme;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Theme\\ThemeNegotiator;\nuse Drupal\\Core\\Theme\\ThemeNegotiatorInterface;\n\n/**\n * Extends the ThemeNegotiatorWrapper to collect the current theme negotiator.\n */\nclass ThemeNegotiatorWrapper extends ThemeNegotiator {\n\n  /**\n   * The current theme negotiator.\n   *\n   * @var \\Drupal\\Core\\Theme\\ThemeNegotiatorInterface\n   */\n  private ThemeNegotiatorInterface $negotiator;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function determineActiveTheme(RouteMatchInterface $route_match) {\n    foreach ($this->negotiators as $negotiator_id) {\n      $negotiator = $this->classResolver->getInstanceFromDefinition($negotiator_id);\n      \\assert($negotiator instanceof ThemeNegotiatorInterface);\n\n      if ($negotiator->applies($route_match)) {\n        $theme = $negotiator->determineActiveTheme($route_match);\n        if ($theme !== NULL && $this->themeAccess->checkAccess($theme)) {\n          $this->negotiator = $negotiator;\n\n          return $theme;\n        }\n      }\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Return the current theme negotiator.\n   *\n   * @return \\Drupal\\Core\\Theme\\ThemeNegotiatorInterface|null\n   *   The current theme negotiator.\n   */\n  public function getNegotiator(): ?ThemeNegotiatorInterface {\n    return $this->negotiator ?? NULL;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Theme/ThemeNegotiatorWrapper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ThemeNegotiatorWrapper", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DataController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\data_count\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\n\n/**\n * Return renderable array response for template.\n */\nclass DataController extends ControllerBase {\n\n  /**\n   * Render array for the content.\n   */\n  public function dataCount() {\n    $items = [\n      'nodes' => data_count_node(),\n      'users' => data_count_user(),\n    ];\n    $data['#attached']['library'] = ['data_count/count-style'];\n    $data['#theme'] = 'data_count';\n    $data['#data'] = $items;\n    return $data;\n  }\n\n}\n", "metadata": {"source": "repos/data_count/src/Controller/DataController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DataController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ResourceTypeAttribute in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\ResourceType;\n\n/**\n * Specialization of a ResourceTypeField to represent a resource type attribute.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n *\n * @see \\Drupal\\jsonapi\\ResourceType\\ResourceTypeRepository\n */\nclass ResourceTypeAttribute extends ResourceTypeField {}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/ResourceType/ResourceTypeAttribute.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ResourceTypeAttribute", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: PHPUnit in Drupal", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Automated testing](/docs/develop/automated-testing)\n\n* [PHPUnit in Drupal](/docs/develop/automated-testing/phpunit-in-drupal)\n* [Browser testing using Cypress](/docs/develop/automated-testing/browser-testing-using-cypress)\n* [Converting SimpleTests to PHPUnit tests](/docs/automated-testing/converting-simpletests-to-phpunit-tests)\n* [JavaScript testing using Nightwatch](/docs/develop/automated-testing/javascript-testing-using-nightwatch)\n* [Performance tests](/docs/develop/automated-testing/performance-tests)\n* [Run core development checks](/docs/develop/automated-testing/run-core-development-checks)\n* [Types of tests](/docs/develop/automated-testing/types-of-tests)\n* [Test failures](/docs/develop/automated-testing/test-failures)\n\n# PHPUnit in Drupal\n\nPHPUnit was [added to Drupal 8](/node/2012184)\u00a0and is the standard for testing Drupal 8+.\n\nIt is highly recommended to read the [official PHPUnit documentation](https://phpunit.readthedocs.io/). In particular, the [list of assertions](https://docs.phpunit.de/en/12.0/assertions.html) to learn what assertion to use.\n\nIt is recommended to write new tests using the PHPUnit base classes `UnitTestCase`, `KernelTestBase`, `BrowserTestBase` (web tests) or `WebDriverTestBase` (JavaScript-enabled web tests using WebDriver).\n\nWe use multiple versions of PHPUnit in DrupalCI on drupal.org. It is discouraged to use end-of-life PHP versions in production ([documentation on supported PHP versions](https://www.php.net/supported-versions.php)).\n\n## [Creating Functional tests (simulated browser)](/docs/develop/automated-testing/phpunit-in-drupal/creating-functional-tests-simulated-browser)\n\nThis tutorial explains how to test functionality by simulating a browser, foregoing actual Javascript/AJAX interactions.\n\n## [Creating FunctionalJavascript tests (real browser)](/docs/develop/automated-testing/phpunit-in-drupal/creating-functionaljavascript-tests-real-browser)\n\nThis tutorial explains how to test functionality in a real browser, including Javascript/AJAX interactions.\n\n## [PHPUnit file structure, namespace, and required metadata](/docs/develop/automated-testing/phpunit-in-drupal/phpunit-file-structure-namespace-and-required-metadata)\n\nFile structure and namespace\n\n## [Running PHPUnit tests](/docs/develop/automated-testing/phpunit-in-drupal/running-phpunit-tests)\n\nExecute PHPUnit tests from the command line.\n\n## [Running PHPUnit JavaScript tests](/docs/develop/automated-testing/phpunit-in-drupal/running-phpunit-javascript-tests)\n\nLearn about how to run PHPUnit JavaScript tests Drupal 8.\n\n## [Running PHPUnit tests within PhpStorm](/docs/develop/automated-testing/phpunit-in-drupal/running-phpunit-tests-within-phpstorm)\n\nConfigure PhpStorm to run Drupal's PHPUnit tests.\n\n## [Understanding PHPunit expectations](/docs/testing/phpunit-in-drupal/understanding-phpunit-expectations)\n\nA mock object most of the time will contain an expectation like\n\n## [Unit testing more complicated Drupal classes](/docs/automated-testing/phpunit-in-drupal/unit-testing-more-complicated-drupal-classes)\n\nDealing with function calls\n\n## [Using Prophecy](/docs/automated-testing/phpunit-in-drupal/using-prophecy)\n\nMocking with Prophecy in PHPUnit\n\n## [Comparison with PHPUnit mocks](/docs/develop/automated-testing/phpunit-in-drupal/comparison-with-phpunit-mocks)\n\nNow that we saw how you can use prophecy as a start, let's compare it with the other frequently used PHPUnit mocking framework\n\n## [Agile Unit Testing](/docs/develop/automated-testing/phpunit-in-drupal/agile-unit-testing)\n\nWhat You Should Know\n\n## [Drupal Test coding standards](/docs/develop/automated-testing/phpunit-in-drupal/drupal-test-coding-standards)\n\nStandards for tests\n\n## [Mocking Entities and Services with PHPUnit and Mocks](/docs/develop/automated-testing/phpunit-in-drupal/mocking-entities-and-services-with-phpunit-and-mocks)\n\nMocking complex entities and services in Unit Tests using PHPUnit mocking framework\n\n## [Setup tasks in Kernel tests](/docs/develop/automated-testing/phpunit-in-drupal/setup-tasks-in-kernel-tests)\n\nSetup tasks in Kernel tests\n\n## [Working with user sessions in tests](/docs/automated-testing/phpunit-in-drupal/working-with-user-sessions-in-tests)\n\nHow to manipulate and examine user sessions in kernel and functional tests\n\n## [Making HTTP requests programmatically in Kernel tests](/docs/develop/automated-testing/phpunit-in-drupal/making-http-requests-programmatically-in-kernel-tests)\n\nHow to use Kernel tests for tests that make simple HTTP requests\n\n## Related Content\n\n## [Automated testing](/docs/develop/automated-testing)\n\nThe testing framework in Drupal (Testing module, previously SimpleTest).\n\n## Tags\n\n[PHPUnit Drupal 8](/taxonomy/term/191427)\n\n[Unit testing Drupal 8](/taxonomy/term/191428)\n\n[Prophecy Drupal 8](/taxonomy/term/191429)\n\n## Guide maintainers\n\n[![dww's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-46549-1402088724.png?itok=2VduV7Zj)](/user/46549 \"View dww's profile\")\n\n[![alexpott's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/default-avatar.png?itok=ZYxnS__Q)](/user/157725 \"View alexpott's profile\")\n\n[![francewhoa's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-204003-1755990926.jpg?itok=RU2g8daa)](/user/204003 \"View francewhoa's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/automated-testing/phpunit-in-drupal.md", "type": "doc_summary", "topic": "PHPUnit in Drupal"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "generation_pattern: '[username_suggester:mail_local]'\ntrigger_event: 'blur'\nvalidate_email: FALSE\n", "metadata": {"source": "repos/username_suggester/config/install/username_suggester.settings.yml", "type": "yaml_reference", "topic": "username suggester.settings"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set variant = variant|default('dropdown')|replace({'_': '-'}) %}\n{% set dropdown_id = dropdown_id|default('dropdown-' ~ random()) %}\n{% set auto_close = auto_close|default('true') %}\n{% set button_variant = button_variant|default('primary') %}\n{% set button_url = button_url|default('') %}\n{% set heading_level = heading_level|default(6) %}\n{# Some changes when used in navbar. #}\n{% set dropdown_tag = dropdown_navbar ? 'li' : 'div' %}\n{% set button_variant = dropdown_navbar ? 'default' : button_variant %}\n{# Some changes when split. #}\n{% set attributes = button_split ? attributes.addClass('btn-group') : attributes %}\n{% set dropdown_menu_start = dropdown_menu_start ? 'dropdown-menu-' ~ dropdown_menu_start : '' %}\n{% set dropdown_menu_end = dropdown_menu_end ? 'dropdown-menu-' ~ dropdown_menu_end : '' %}\n\n{% set button_attributes = create_attribute(button_attributes|default({})) %}\n{% set button_attributes = dropdown_navbar ? button_attributes.addClass('nav-link') : button_attributes %}\n{% if content %}\n  {% set button_attributes = button_attributes.addClass('dropdown-toggle') %}\n  {% set button_attributes = button_attributes.setAttribute('data-bs-toggle', 'dropdown') %}\n  {% set button_attributes = button_attributes.setAttribute('data-bs-auto-close', auto_close) %}\n  {% set button_attributes = button_attributes.setAttribute('aria-expanded', 'false') %}\n  {% set button_attributes = (dropdown_menu_start or dropdown_menu_end) ? button_attributes.setAttribute('data-bs-display', 'static') : button_attributes %}\n{% endif %}\n\n{% set dropdown_menu_attributes = create_attribute() %}\n{% set dropdown_menu_attributes = dropdown_menu_attributes.addClass('dropdown-menu') %}\n{% set dropdown_menu_attributes = dark ? dropdown_menu_attributes.setAttribute('data-bs-theme', 'dark') : dropdown_menu_attributes %}\n{% set dropdown_menu_attributes = dropdown_menu_attributes.addClass([dropdown_menu_start, dropdown_menu_end]) %}\n{% set dropdown_menu_attributes = dropdown_menu_attributes.setAttribute('aria-labelledby', dropdown_id) %}\n\n<{{ dropdown_tag }}{{ attributes.addClass(variant) }}>\n\n{% if button_split and variant == 'dropstart' %}\n  {{ include('bootstrap_components:button', {\n    label: 'Toggle dropdown'|t,\n    attributes: button_attributes.addClass('dropdown-toggle-split'),\n    variant: button_variant,\n    label_visually_hidden: true,\n  }, with_context = false) }}\n{% elseif button_split %}\n  {{ include('bootstrap_components:button', {\n    label: title,\n    attributes: {\n      id: dropdown_id,\n    }|to_attributes,\n    variant: button_variant,\n    url: button_url,\n  }, with_context = false) }}\n  {{ include('bootstrap_components:button', {\n    label: 'Toggle dropdown'|t,\n    attributes: button_attributes.addClass('dropdown-toggle-split'),\n    variant: button_variant,\n    label_visually_hidden: true,\n  }, with_context = false) }}\n{% else %}\n  {{ include('bootstrap_components:button', {\n    label: title,\n    attributes: button_attributes.setAttribute('id', dropdown_id),\n    variant: button_variant,\n    url: button_url,\n  }, with_context = false) }}\n{% endif %}\n\n  {% if content %}\n    <ul{{ dropdown_menu_attributes }}>\n      {% for item in content %}\n        {% set item_attributes = create_attribute(item.attributes|default({})) %}\n        <li{{ item_attributes }}>\n          {% set link_attributes = create_attribute(item.link_attributes|default({})) %}\n          {% if item.title and item.url %}\n            <a{{ link_attributes.setAttribute('href', item.url).addClass('dropdown-item') }}>{{ item.title }}</a>\n          {% elseif (not item.title and not item.url) or link_attributes.hasClass('dropdown-divider') %}\n            <hr{{ link_attributes.addClass('dropdown-divider') }}>\n          {% elseif item.title and not item.url %}\n            {% if link_attributes.hasClass('dropdown-header') %}\n              <h{{ heading_level }}{{ link_attributes }}>{{ item.title }}</h{{ heading_level }}>\n            {% elseif link_attributes.hasClass('dropdown-item') %}\n              <button{{ link_attributes.setAttribute('type', 'button') }}>{{ item.title }}</button>\n            {% else %}\n              <span{{ link_attributes.addClass('dropdown-item-text') }}>{{ item.title }}</span>\n            {% endif %}\n          {% endif %}\n        </li>\n      {% endfor %}\n    </ul>\n  {% endif %}\n\n{% if button_split and variant == 'dropstart' %}\n  {{ include('bootstrap_components:button', {\n    label: title,\n    attributes: {\n      id: dropdown_id,\n    }|to_attributes,\n    variant: button_variant,\n    url: button_url,\n  }, with_context = false) }}\n{% endif %}\n\n</{{ dropdown_tag }}>\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/dropdown.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class ReferralTypeListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\commerce_referral\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Link;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Defines the list builder for Referral types.\n */\nclass ReferralTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(\n    ContainerInterface $container,\n    EntityTypeInterface $entity_type,\n  ): ReferralTypeListBuilder {\n    $instance = parent::createInstance($container, $entity_type);\n    $instance->entityTypeManager = $container->get('entity_type.manager');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return mixed[]\n   *   The header.\n   */\n  public function buildHeader(): array {\n    $header['label'] = $this->t('Referral type');\n    $header['referral_promotion'] = $this->t('Referral promotion');\n    $header['kickback_promotion'] = $this->t('Kickback promotion');\n\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity.\n   *\n   * @return mixed[]\n   *   The row.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function buildRow(EntityInterface $entity): array {\n    /** @var \\Drupal\\commerce_referral\\Entity\\ReferralType $entity */\n    // Name/label linking directly to the bundle edit form (no canonical link).\n    $row['label'] = $entity->label();\n\n    // Referral promotion label linking to the promotion edit form.\n    $referral_promotion_label = $this->t('Not set');\n    if ($promotion_id = $entity->getReferralPromotionId()) {\n      $promotion = $this->entityTypeManager->getStorage('commerce_promotion')->load($promotion_id);\n      if ($promotion) {\n        $referral_promotion_label = Link::fromTextAndUrl($promotion->label() ?? \"\", $promotion->toUrl('edit-form'));\n      }\n    }\n    $row['referral_promotion'] = $referral_promotion_label;\n\n    // Kickback promotion label linking to the promotion edit form.\n    $kickback_promotion_label = $this->t('Not set');\n    if ($promotion_id = $entity->getKickbackPromotionId()) {\n      $promotion = $this->entityTypeManager->getStorage('commerce_promotion')->load($promotion_id);\n      if ($promotion) {\n        $kickback_promotion_label = Link::fromTextAndUrl($promotion->label() ?? \"\", $promotion->toUrl('edit-form'));\n      }\n    }\n    $row['kickback_promotion'] = $kickback_promotion_label;\n\n    // Ensure operations appear as the last column.\n    $row['operations'] = [\n      'data' => [\n        '#type' => 'operations',\n        '#links' => $this->getOperations($entity),\n      ],\n    ];\n\n    return $row;\n  }\n\n}\n", "metadata": {"source": "repos/commerce_referral/src/Entity/ReferralTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ReferralTypeListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Display Builder for entity view'\ndescription: 'Provide integration of Display Builder to entity view.'\ntype: module\ncore_version_requirement: ^11.3\npackage: 'User interface'\ndependencies:\n  - drupal:field_ui\n  - display_builder:display_builder\n  - ui_patterns:ui_patterns_field\n  - ui_patterns:ui_patterns_field_formatters\n", "metadata": {"source": "repos/display_builder/modules/display_builder_entity_view/display_builder_entity_view.info.yml", "type": "yaml_reference", "topic": "display builder entity view.info"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.storage.media.field_media_audio_file\n    - media.type.audio\n  module:\n    - file\nid: media.audio.field_media_audio_file\nfield_name: field_media_audio_file\nentity_type: media\nbundle: audio\nlabel: 'Audio file'\ndescription: ''\nrequired: true\ntranslatable: true\ndefault_value: {  }\ndefault_value_callback: ''\nsettings:\n  handler: 'default:file'\n  handler_settings: {  }\n  file_directory: '[date:custom:Y]-[date:custom:m]'\n  file_extensions: 'mp3 wav aac'\n  max_filesize: ''\n  description_field: false\nfield_type: file\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/field.field.media.audio.field_media_audio_file.yml", "type": "yaml_reference", "topic": "field.field.media.audio.field media audio file"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the views style plugins.\n\nviews.style.*:\n  type: views_style\n  label: 'Default style'\n\nviews.style.default:\n  type: views_style\n  label: 'Unformatted list'\n\nviews.style.html_list:\n  type: views_style\n  label: 'HTML List'\n  mapping:\n    type:\n      type:  string\n      label: 'List type'\n    wrapper_class:\n      type: string\n      label: 'Wrapper class'\n    class:\n      type: string\n      label: 'List class'\n\nviews.style.grid:\n  type: views_style\n  label: 'Grid'\n  mapping:\n    columns:\n      type:  integer\n      label: 'Number of columns'\n    automatic_width:\n      type: boolean\n      label: 'Automatic width'\n    alignment:\n      type: string\n      label: 'Alignment'\n    row_class_custom:\n      type: string\n      label: 'Custom row classes'\n    row_class_default:\n      type: boolean\n      label: 'Default views row classes'\n    col_class_custom:\n      type: string\n      label: 'Custom column classes'\n    col_class_default:\n      type: boolean\n      label: 'Default views column classes'\n\nviews.style.grid_responsive:\n  type: views_style\n  label: 'Grid - Responsive'\n  mapping:\n    columns:\n      type:  integer\n      label: 'Maximum number of columns'\n    cell_min_width:\n      type:  integer\n      label: 'Minimum cell width'\n    grid_gutter:\n      type:  integer\n      label: 'Grid gutter'\n    alignment:\n      type: string\n      label: 'Alignment'\n\nviews.style.table:\n  type: views_style\n  label: 'Table'\n  mapping:\n    columns:\n      type: sequence\n      label: 'Columns'\n      sequence:\n        type: string\n        label: 'Columns name'\n    default:\n      type: string\n      label: 'Default sort'\n    info:\n      type: sequence\n      label: 'Columns info'\n      sequence:\n        type: mapping\n        label:  'Column info'\n        mapping:\n          sortable:\n            type: boolean\n            label: 'Sortable'\n          default_sort_order:\n            type: string\n            label: 'Default order'\n          align:\n            type: string\n            label: 'Align'\n          separator:\n            type: string\n            label: 'Separator'\n          empty_column:\n            type: boolean\n            label: 'Hide empty columns'\n          responsive:\n            type: string\n            label: 'Responsive'\n    override:\n      type: boolean\n      label: 'Override normal sorting if click sorting is used'\n    sticky:\n      type: boolean\n      label: 'Enable Drupal style \"sticky\" table headers'\n    summary:\n      type: label\n      label: 'Summary title'\n    order:\n      type: string\n      label: 'Default order'\n    empty_table:\n      type: boolean\n      label: 'Show the empty text in the table'\n    caption:\n      type: label\n      label: 'Caption for the table'\n    description:\n      type: text\n      label: 'Table description'\n    class:\n      type: string\n      label: 'Table class'\n\nviews.style.default_summary:\n  type: views_style\n  label: 'Summary options'\n  mapping:\n    base_path:\n      type: string\n      label: 'Base path'\n    count:\n      type: boolean\n      label: 'Display record count with link'\n    override:\n      type: boolean\n      label: 'Override number of items to display'\n    items_per_page:\n      type: integer\n      label: 'Items to display'\n\nviews.style.rss:\n  type: views_style\n  label: 'RSS Feed'\n  mapping:\n    description:\n      type: label\n      label: 'RSS description'\n\nviews.style.unformatted_summary:\n  type: views.style.default_summary\n  label: 'Unformatted'\n  mapping:\n    inline:\n      type: boolean\n      label: 'Display items inline'\n    separator:\n      type: string\n      label: 'Separator'\n\nviews.style.entity_reference:\n  type: views_style\n  label: 'Entity Reference list'\n  mapping:\n    search_fields:\n      type: sequence\n      label: 'Search fields'\n      sequence:\n        type: string\n        label: 'Search field'\n", "metadata": {"source": "repos/drupal_core/core/modules/views/config/schema/views.style.schema.yml", "type": "yaml_reference", "topic": "views.style.schema"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: BaseFieldFileFormatterBase.php\nTarget symbol: class for\nNamespace: Drupal\\file\\Plugin\\Field\\FieldFormatter\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Field\\FieldDefinitionInterface\n  - Drupal\\Core\\Field\\FieldItemInterface\n  - Drupal\\Core\\Field\\FieldItemListInterface\n  - Drupal\\Core\\Field\\FormatterBase\n  - Drupal\\Core\\File\\FileUrlGeneratorInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - defaultSettings()\n  - isApplicable()\n  - settingsForm()\n  - viewElements()\n  - viewValue()", "output": "<?php\n\nnamespace Drupal\\file\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldItemInterface;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Field\\FormatterBase;\nuse Drupal\\Core\\File\\FileUrlGeneratorInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Base class for file formatters, which allow to link to the file download URL.\n */\nabstract class BaseFieldFileFormatterBase extends FormatterBase {\n\n  /**\n   * The file URL generator.\n   *\n   * @var \\Drupal\\Core\\File\\FileUrlGeneratorInterface\n   */\n  protected $fileUrlGenerator;\n\n  /**\n   * Constructs a BaseFieldFileFormatterBase object.\n   *\n   * @param string $plugin_id\n   *   The plugin ID for the formatter.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Field\\FieldDefinitionInterface $field_definition\n   *   The definition of the field to which the formatter is associated.\n   * @param array $settings\n   *   The formatter settings.\n   * @param string $label\n   *   The formatter label display setting.\n   * @param string $view_mode\n   *   The view mode.\n   * @param array $third_party_settings\n   *   Any third party settings.\n   * @param \\Drupal\\Core\\File\\FileUrlGeneratorInterface $file_url_generator\n   *   The file URL generator.\n   */\n  public function __construct($plugin_id, $plugin_definition, FieldDefinitionInterface $field_definition, array $settings, $label, $view_mode, array $third_party_settings, FileUrlGeneratorInterface $file_url_generator) {\n    parent::__construct($plugin_id, $plugin_definition, $field_definition, $settings, $label, $view_mode, $third_party_settings);\n    $this->fileUrlGenerator = $file_url_generator;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    $settings['link_to_file'] = FALSE;\n\n    return $settings;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $form = parent::settingsForm($form, $form_state);\n\n    $form['link_to_file'] = [\n      '#title' => $this->t('Link this field to the file download URL'),\n      '#type' => 'checkbox',\n      '#default_value' => $this->getSetting('link_to_file'),\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewElements(FieldItemListInterface $items, $langcode) {\n    $elements = [];\n\n    $url = NULL;\n    // Add support to link to the entity itself.\n    if ($this->getSetting('link_to_file')) {\n      $url = $this->fileUrlGenerator->generate($items->getEntity()->getFileUri());\n    }\n\n    foreach ($items as $delta => $item) {\n      $view_value = $this->viewValue($item);\n\n      if ($url) {\n        $elements[$delta] = [\n          '#type' => 'link',\n          '#title' => $view_value,\n          '#url' => $url,\n        ];\n      }\n      else {\n        $elements[$delta] = is_array($view_value) ? $view_value : ['#markup' => $view_value];\n      }\n    }\n\n    return $elements;\n  }\n\n  /**\n   * Generate the output appropriate for one field item.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldItemInterface $item\n   *   One field item.\n   *\n   * @return mixed\n   *   The textual output generated.\n   */\n  abstract protected function viewValue(FieldItemInterface $item);\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function isApplicable(FieldDefinitionInterface $field_definition) {\n    return $field_definition->getTargetEntityTypeId() === 'file';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Field/FieldFormatter/BaseFieldFileFormatterBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BaseFieldFileFormatterBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class Datetime in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Holds datetime views field data helper for deprecation.\n */\n\nuse Drupal\\field\\FieldStorageConfigInterface;\n\n/**\n * Provides Views integration for any datetime-based fields.\n *\n * Overrides the default Views data for datetime-based fields, adding datetime\n * views plugins. Modules defining new datetime-based fields may use this\n * function to simplify Views integration.\n *\n * @param \\Drupal\\field\\FieldStorageConfigInterface $field_storage\n *   The field storage config entity.\n * @param array $data\n *   Field view data or\n *   FieldViewsDataProvider::defaultFieldImplementation($field_storage) if\n *   empty.\n * @param string $column_name\n *   The schema column name with the datetime value.\n *\n * @return array\n *   The array of field views data with the datetime plugin.\n *\n * @see datetime_field_views_data()\n * @see datetime_range_field_views_data()\n *\n * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use\n * \\Drupal::service('datetime.views_helper')\n * ->buildViewsData($field_storage, $data, $column_name); instead.\n * @see https://www.drupal.org/node/3489502\n */\nfunction datetime_type_field_views_data_helper(FieldStorageConfigInterface $field_storage, array $data, $column_name) {\n  @trigger_error('datetime_type_field_views_data_helper() is deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use \\Drupal::service(\\'datetime.views_helper\\')->buildViewsData($field_storage, $data, $column_name). See https://www.drupal.org/node/3489502', E_USER_DEPRECATED);\n  return \\Drupal::service('datetime.views_helper')->buildViewsData($field_storage, $data, $column_name);\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/datetime.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Datetime", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: LayoutSectionStorageParamConverter.php\nTarget symbol: class LayoutSectionStorageParamConverter\nNamespace: Drupal\\layout_builder\\Routing\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LayoutSectionStorageParamConverter.\n- Include required imports:\n  - Drupal\\Core\\ParamConverter\\ParamConverterInterface\n  - Drupal\\layout_builder\\SectionStorage\\SectionStorageManagerInterface\n  - Symfony\\Component\\Routing\\Route\n- Ensure these methods exist where relevant:\n  - __construct()\n  - applies()\n  - convert()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\layout_builder\\Routing;\n\nuse Drupal\\Core\\ParamConverter\\ParamConverterInterface;\nuse Drupal\\layout_builder\\SectionStorage\\SectionStorageManagerInterface;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Loads the section storage from the routing defaults.\n *\n * @internal\n *   Tagged services are internal.\n */\nclass LayoutSectionStorageParamConverter implements ParamConverterInterface {\n\n  /**\n   * The section storage manager.\n   *\n   * @var \\Drupal\\layout_builder\\SectionStorage\\SectionStorageManagerInterface\n   */\n  protected $sectionStorageManager;\n\n  /**\n   * Constructs a new LayoutSectionStorageParamConverter.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorage\\SectionStorageManagerInterface $section_storage_manager\n   *   The section storage manager.\n   */\n  public function __construct(SectionStorageManagerInterface $section_storage_manager) {\n    $this->sectionStorageManager = $section_storage_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function convert($value, $definition, $name, array $defaults) {\n    // If no section storage type is specified or if it is invalid, return.\n    if (!isset($defaults['section_storage_type']) || !$this->sectionStorageManager->hasDefinition($defaults['section_storage_type'])) {\n      return NULL;\n    }\n\n    $type = $defaults['section_storage_type'];\n    // Load an empty instance and derive the available contexts.\n    $contexts = $this->sectionStorageManager->loadEmpty($type)->deriveContextsFromRoute($value, $definition, $name, $defaults);\n    // Attempt to load a full instance based on the context.\n    return $this->sectionStorageManager->load($type, $contexts);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies($definition, $name, Route $route) {\n    return !empty($definition['layout_builder_section_storage']) || !empty($definition['layout_builder_tempstore']);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Routing/LayoutSectionStorageParamConverter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutSectionStorageParamConverter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class Rss in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\node\\Plugin\\views\\row;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Plugin\\views\\row\\RssPluginBase;\n\n/**\n * Performs a node_view on the resulting object and formats it as an RSS item.\n */\n#[ViewsRow(\n  id: \"node_rss\",\n  title: new TranslatableMarkup(\"Content\"),\n  help: new TranslatableMarkup(\"Display the content with standard node view.\"),\n  theme: \"views_view_row_rss\",\n  register_theme: FALSE,\n  base: [\"node_field_data\"],\n  display_types: [\"feed\"]\n)]\nclass Rss extends RssPluginBase {\n\n  /**\n   * The base table for this row plugin.\n   *\n   * @var string\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  public $base_table = 'node_field_data';\n\n  /**\n   * The base field for this row plugin.\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  public string $base_field = 'nid';\n\n  /**\n   * Stores the nodes loaded with preRender.\n   *\n   * @var array\n   */\n  public $nodes = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $entityTypeId = 'node';\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm_summary_options() {\n    $options = parent::buildOptionsForm_summary_options();\n    $options[$this::TITLE_VIEW_MODE] = $this->t('Title only');\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    $options = $this->buildOptionsForm_summary_options();\n    return $options[$this->options['view_mode']];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender($values) {\n    $nids = [];\n    foreach ($values as $row) {\n      $nids[] = $row->{$this->field_alias};\n    }\n    if (!empty($nids)) {\n      $this->nodes = $this->entityTypeManager->getStorage('node')->loadMultiple($nids);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($row) {\n    global $base_url;\n\n    $nid = $row->{$this->field_alias};\n    if (!is_numeric($nid)) {\n      return;\n    }\n\n    $display_mode = $this->options['view_mode'];\n\n    // Load the specified node:\n    /** @var \\Drupal\\node\\NodeInterface $node */\n    $node = $this->nodes[$nid];\n    if (empty($node)) {\n      return;\n    }\n\n    $node->rss_namespaces = [];\n    $node->rss_elements = [\n      [\n        'key' => 'pubDate',\n        'value' => gmdate('r', $node->getCreatedTime()),\n      ],\n      [\n        'key' => 'dc:creator',\n        'value' => $node->getOwner()->getDisplayName(),\n      ],\n      [\n        'key' => 'guid',\n        'value' => $node->id() . ' at ' . $base_url,\n        'attributes' => ['isPermaLink' => 'false'],\n      ],\n    ];\n\n    // The node gets built and modules add to or modify $node->rss_elements\n    // and $node->rss_namespaces.\n\n    $build = \\Drupal::entityTypeManager()\n      ->getViewBuilder('node')\n      ->view($node, $display_mode);\n    // Add rss key to cache to differentiate this from other caches.\n    $build['#cache']['keys'][] = 'view_rss';\n\n    unset($build['#theme']);\n\n    if (!empty($node->rss_namespaces)) {\n      $this->view->style_plugin->namespaces = array_merge($this->view->style_plugin->namespaces, $node->rss_namespaces);\n    }\n\n    $item = new \\stdClass();\n    if ($display_mode != $this::TITLE_VIEW_MODE) {\n      // We render node contents.\n      $item->description = $build;\n    }\n    $item->title = $node->label();\n    $item->link = $node->toUrl('canonical', ['absolute' => TRUE])->toString();\n    // Provide a reference so that the render call in\n    // template_preprocess_views_view_row_rss() can still access it.\n    $item->elements = &$node->rss_elements;\n    $item->nid = $node->id();\n    $build = [\n      '#theme' => $this->themeFunctions(),\n      '#view' => $this->view,\n      '#options' => $this->options,\n      '#row' => $item,\n    ];\n\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/node/src/Plugin/views/row/Rss.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Rss", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EntityActionBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Action\\Plugin\\Action;\n\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Action\\ActionBase;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\n\n/**\n * Base class for entity-based actions.\n */\nabstract class EntityActionBase extends ActionBase implements DependentPluginInterface, ContainerFactoryPluginInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * Constructs an EntityActionBase object.\n   *\n   * @param mixed[] $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, EntityTypeManagerInterface $entity_type_manager) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->entityTypeManager = $entity_type_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    $module_name = $this->entityTypeManager\n      ->getDefinition($this->getPluginDefinition()['type'])\n      ->getProvider();\n    return ['module' => [$module_name]];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Action/Plugin/Action/EntityActionBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityActionBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: With preview\nslots:\n  title: 'Lorem ipsum'\nprops:\n  thumbnail: https://img.daisyui.com/images/components/calendar.webp\n", "metadata": {"source": "repos/display_builder/components/placeholder/stories/placeholder.with_preview.story.yml", "type": "yaml_reference", "topic": "placeholder.with preview.story"}}
{"instruction": "Show me the implementation of the class AllowListConfigStorage in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Recipe;\n\nuse Drupal\\Core\\Config\\StorageInterface;\n\n/**\n * A read-only storage wrapper that only allows access to certain config names.\n *\n * @internal\n *   This API is experimental.\n */\nfinal class AllowListConfigStorage implements StorageInterface {\n\n  /**\n   * @param \\Drupal\\Core\\Config\\StorageInterface $decorated\n   *   A config storage backend to wrap around.\n   * @param string[] $allowList\n   *   A list of config names. Only these names will be visible, or readable,\n   *   by this storage. Cannot be empty.\n   */\n  public function __construct(\n    private readonly StorageInterface $decorated,\n    private readonly array $allowList,\n  ) {\n    if (empty($allowList)) {\n      throw new \\LogicException('AllowListConfigStorage cannot be constructed with an empty allow list.');\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function exists($name): bool {\n    if (in_array($name, $this->allowList, TRUE)) {\n      return $this->decorated->exists($name);\n    }\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function read($name): array|false {\n    return $this->exists($name) ? $this->decorated->read($name) : FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function readMultiple(array $names): array {\n    $names = array_intersect($names, $this->allowList);\n    return $this->decorated->readMultiple($names);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function write($name, array $data): never {\n    throw new \\BadMethodCallException('This storage is read-only.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete($name): never {\n    throw new \\BadMethodCallException('This storage is read-only.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function rename($name, $new_name): never {\n    throw new \\BadMethodCallException('This storage is read-only.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function encode($data): string {\n    return $this->decorated->encode($data);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function decode($raw): array {\n    return $this->decorated->decode($raw);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function listAll($prefix = ''): array {\n    return array_intersect($this->decorated->listAll($prefix), $this->allowList);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteAll($prefix = ''): never {\n    throw new \\BadMethodCallException('This storage is read-only.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createCollection($collection): static {\n    return new static(\n      $this->decorated->createCollection($collection),\n      $this->allowList,\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAllCollectionNames(): array {\n    return $this->decorated->getAllCollectionNames();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCollectionName(): string {\n    return $this->decorated->getCollectionName();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Recipe/AllowListConfigStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AllowListConfigStorage", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Alignment: center\"\ndescription: \"Change the alignment of pagination components with flexbox utilities. For example, with .justify-content-center:\"\nprops:\n  items:\n    - url: \"#\"\n      title: \"Previous\"\n      attributes:\n        class:\n          - disabled\n    - url: \"#\"\n      title: \"1\"\n    - url: \"#\"\n      title: \"2\"\n    - url: \"#\"\n      title: \"2\"\n    - url: \"#\"\n      title: \"Next\"\n  variant: default\n  attributes:\n    class:\n      - justify-content-center\n", "metadata": {"source": "repos/bootstrap_components/components/pagination/stories/pagination.alignment_center.story.yml", "type": "yaml_reference", "topic": "pagination.alignment center.story"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nid: html_time\nlabel: 'HTML Time'\nlocked: true\npattern: 'H:i:s'\n", "metadata": {"source": "repos/drupal_core/core/modules/system/config/install/core.date_format.html_time.yml", "type": "yaml_reference", "topic": "core.date format.html time"}}
{"instruction": "Show me the implementation of the interface MessengerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Messenger;\n\n/**\n * Stores runtime messages sent out to individual users on the page.\n *\n * An example for these messages is for example: \"Content X got saved\".\n */\ninterface MessengerInterface {\n\n  /**\n   * A status message.\n   */\n  const TYPE_STATUS = 'status';\n\n  /**\n   * A warning.\n   */\n  const TYPE_WARNING = 'warning';\n\n  /**\n   * An error.\n   */\n  const TYPE_ERROR = 'error';\n\n  /**\n   * Adds a new message to the queue.\n   *\n   * The messages will be displayed in the order they got added later.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param string $type\n   *   (optional) The message's type. Either self::TYPE_STATUS,\n   *   self::TYPE_WARNING, or self::TYPE_ERROR.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addMessage($message, $type = self::TYPE_STATUS, $repeat = FALSE);\n\n  /**\n   * Adds a new status message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addStatus($message, $repeat = FALSE);\n\n  /**\n   * Adds a new error message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addError($message, $repeat = FALSE);\n\n  /**\n   * Adds a new warning message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addWarning($message, $repeat = FALSE);\n\n  /**\n   * Gets all messages.\n   *\n   * @return string[][]|\\Drupal\\Component\\Render\\MarkupInterface[][]\n   *   Keys are message types and values are indexed arrays of messages. Message\n   *   types are either self::TYPE_STATUS, self::TYPE_WARNING, or\n   *   self::TYPE_ERROR.\n   */\n  public function all();\n\n  /**\n   * Gets all messages of a certain type.\n   *\n   * @param string $type\n   *   The messages' type. Either self::TYPE_STATUS, self::TYPE_WARNING,\n   *   or self::TYPE_ERROR.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The messages of given type.\n   */\n  public function messagesByType($type);\n\n  /**\n   * Deletes all messages.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The deleted messages.\n   */\n  public function deleteAll();\n\n  /**\n   * Deletes all messages of a certain type.\n   *\n   * @param string $type\n   *   The messages' type. Either self::TYPE_STATUS, self::TYPE_WARNING, or\n   *   self::TYPE_ERROR.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The deleted messages of given type.\n   */\n  public function deleteByType($type);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Messenger/MessengerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MessengerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Contextual Menu\ndescription: A list of menu item for the user to choose from.\nnoUi: true\ngroup: Display builder\nslots:\n  label:\n    title: Label\n  items:\n    title: Items\nprops:\n  type: object\n  properties: {}\n", "metadata": {"source": "repos/display_builder/components/contextual_menu/contextual_menu.component.yml", "type": "yaml_reference", "topic": "contextual menu.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# cspell:ignore tnid\nid: d6_node_revision\nlabel: Node revisions\naudit: true\nmigration_tags:\n  - Drupal 6\n  - Content\nderiver: Drupal\\node\\Plugin\\migrate\\D6NodeDeriver\nsource:\n  plugin: d6_node_revision\nprocess:\n  # If you are using this file to build a custom migration consider removing\n  # the nid and vid fields to allow incremental migrations.\n  nid: nid\n  vid: vid\n  langcode:\n    plugin: default_value\n    source: language\n    default_value: \"und\"\n  title: title\n  uid: node_uid\n  status: status\n  created: created\n  changed: changed\n  promote: promote\n  sticky: sticky\n  'body/format':\n    plugin: migration_lookup\n    migration: d6_filter_format\n    source: format\n  'body/value': body\n  'body/summary': teaser\n  revision_uid: revision_uid\n  revision_log: log\n  revision_timestamp: timestamp\n\n#  unmapped d6 fields.\n#  tnid\n#  translate\n#  moderate\n#  comment\n\ndestination:\n  plugin: entity_revision:node\n", "metadata": {"source": "repos/drupal_core/core/modules/node/migrations/d6_node_revision.yml", "type": "yaml_reference", "topic": "d6 node revision"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: MCP Tools - Cache", "input": "", "output": "# MCP Tools - Cache\n\nManage Drupal caches via MCP.\n\n## Tools (6)\n\n| Tool | Description |\n|------|-------------|\n| `mcp_cache_get_status` | Get cache status overview (bins, backends, sizes) |\n| `mcp_cache_clear_all` | Clear all caches (equivalent to `drush cr`) |\n| `mcp_cache_clear_bin` | Clear a specific cache bin |\n| `mcp_cache_invalidate_tags` | Invalidate specific cache tags |\n| `mcp_cache_clear_entity` | Clear render cache for a specific entity |\n| `mcp_cache_rebuild` | Rebuild specific caches (router, theme, container, menu) |\n\n## Requirements\n\n- mcp_tools (base module)\n\n## Usage Examples\n\n### Clear all caches\n\n```\nmcp_cache_clear_all()\n```\n\n### Clear specific cache bin\n\n```\nmcp_cache_clear_bin(bin: \"render\")\nmcp_cache_clear_bin(bin: \"page\")\nmcp_cache_clear_bin(bin: \"entity\")\n```\n\n### Invalidate cache tags for content\n\n```\n# Clear cache for node 123\nmcp_cache_invalidate_tags(tags: [\"node:123\"])\n\n# Clear all node listings\nmcp_cache_invalidate_tags(tags: [\"node_list\"])\n\n# Clear multiple tags\nmcp_cache_invalidate_tags(tags: [\"node:123\", \"user:5\", \"config:system.site\"])\n```\n\n### Clear entity cache\n\n```\n# Clear cache for node 123\nmcp_cache_clear_entity(entity_type: \"node\", entity_id: \"123\")\n\n# Clear cache for user 5\nmcp_cache_clear_entity(entity_type: \"user\", entity_id: \"5\")\n```\n\n### Rebuild specific caches\n\n```\n# Rebuild router (after adding routes)\nmcp_cache_rebuild(type: \"router\")\n\n# Rebuild theme registry\nmcp_cache_rebuild(type: \"theme\")\n\n# Rebuild menu links\nmcp_cache_rebuild(type: \"menu\")\n```\n\n## Common Cache Bins\n\n| Bin | Description |\n|-----|-------------|\n| `render` | Rendered entities and blocks |\n| `page` | Full page cache |\n| `entity` | Entity data |\n| `menu` | Menu structures |\n| `config` | Configuration |\n| `discovery` | Plugin discovery |\n| `dynamic_page_cache` | Dynamic page responses |\n\n## Security\n\n- All write operations require appropriate scope\n- All changes are audit logged\n- Cache operations are rate-limited\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_cache/README.md", "type": "doc_summary", "topic": "MCP Tools - Cache"}}
{"instruction": "Show me the implementation of the class Reflection in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Utility;\n\n/**\n * Provides helper methods for reflection.\n */\nfinal class Reflection {\n\n  /**\n   * Gets the parameter's class name.\n   *\n   * @param \\ReflectionParameter $parameter\n   *   The parameter.\n   *\n   * @return string|null\n   *   The parameter's class name or NULL if the parameter is not a class.\n   */\n  public static function getParameterClassName(\\ReflectionParameter $parameter) : ?string {\n    $name = NULL;\n    $parameterType = $parameter->getType();\n    if ($parameterType instanceof \\ReflectionNamedType && !$parameterType->isBuiltin()) {\n      $name = $parameterType->getName();\n      $lc_name = strtolower($name);\n      switch ($lc_name) {\n        case 'self':\n          return $parameter->getDeclaringClass()->getName();\n\n        case 'parent':\n          return ($parent = $parameter->getDeclaringClass()->getParentClass()) ? $parent->name : NULL;\n      }\n    }\n    return $name;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Utility/Reflection.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Reflection", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface FlowDropWorkflowInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_workflow;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\n\n/**\n * Provides an interface defining a FlowDrop workflow entity type.\n */\ninterface FlowDropWorkflowInterface extends ConfigEntityInterface {\n\n  /**\n   * Gets the workflow label.\n   *\n   * @return string\n   *   The workflow label.\n   */\n  public function getLabel(): string;\n\n  /**\n   * Sets the workflow label.\n   *\n   * @param string $label\n   *   The workflow label.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setLabel(string $label): static;\n\n  /**\n   * Gets the workflow description.\n   *\n   * @return string\n   *   The workflow description.\n   */\n  public function getDescription(): string;\n\n  /**\n   * Sets the workflow description.\n   *\n   * @param string $description\n   *   The workflow description.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setDescription(string $description): static;\n\n  /**\n   * Gets the workflow nodes.\n   *\n   * @return array\n   *   The workflow nodes.\n   */\n  public function getNodes(): array;\n\n  /**\n   * Sets the workflow nodes.\n   *\n   * @param array $nodes\n   *   The workflow nodes.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setNodes(array $nodes): static;\n\n  /**\n   * Gets the workflow edges.\n   *\n   * @return array\n   *   The workflow edges.\n   */\n  public function getEdges(): array;\n\n  /**\n   * Sets the workflow edges.\n   *\n   * @param array $edges\n   *   The workflow edges.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setEdges(array $edges): static;\n\n  /**\n   * Gets the workflow metadata.\n   *\n   * @return array\n   *   The workflow metadata.\n   */\n  public function getMetadata(): array;\n\n  /**\n   * Sets the workflow metadata.\n   *\n   * @param array $metadata\n   *   The workflow metadata.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setMetadata(array $metadata): static;\n\n  /**\n   * Gets the creation timestamp.\n   *\n   * @return int\n   *   The creation timestamp.\n   */\n  public function getCreated(): int;\n\n  /**\n   * Sets the creation timestamp.\n   *\n   * @param int $created\n   *   The creation timestamp.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setCreated(int $created): static;\n\n  /**\n   * Gets the last modified timestamp.\n   *\n   * @return int\n   *   The last modified timestamp.\n   */\n  public function getChanged(): int;\n\n  /**\n   * Sets the last modified timestamp.\n   *\n   * @param int $changed\n   *   The last modified timestamp.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setChanged(int $changed): static;\n\n  /**\n   * Gets the user ID who created the workflow.\n   *\n   * @return int\n   *   The user ID.\n   */\n  public function getUid(): int;\n\n  /**\n   * Sets the user ID who created the workflow.\n   *\n   * @param int $uid\n   *   The user ID.\n   *\n   * @return static\n   *   The workflow entity.\n   */\n  public function setUid(int $uid): static;\n\n  /**\n   * Gets the complete graph data including nodes and edges.\n   *\n   * This provides a unified accessor for the workflow graph structure,\n   * combining nodes and edges into a single array for graph processing.\n   *\n   * @return array{nodes: array<mixed>, edges: array<mixed>}\n   *   An array containing:\n   *   - 'nodes': The workflow nodes array.\n   *   - 'edges': The workflow edges array.\n   */\n  public function getGraphData(): array;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_workflow/src/FlowDropWorkflowInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FlowDropWorkflowInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SynchronousOrchestratorPlugin.php\nTarget symbol: class SynchronousOrchestratorPlugin\nNamespace: Drupal\\flowdrop_runtime\\Plugin\\Orchestrator\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SynchronousOrchestratorPlugin.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\flowdrop_runtime\\Attribute\\Orchestrator\n  - Drupal\\flowdrop_runtime\\DTO\\Orchestrator\\OrchestrationRequest\n  - Drupal\\flowdrop_runtime\\DTO\\Orchestrator\\OrchestrationResponse\n  - Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildConfigurationForm()\n  - create()\n  - getCapabilities()\n  - getDefaultConfiguration()\n  - orchestrate()\n  - submitConfigurationForm()\n  - supportsWorkflow()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Plugin\\Orchestrator;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_runtime\\Attribute\\Orchestrator;\nuse Drupal\\flowdrop_runtime\\DTO\\Orchestrator\\OrchestrationRequest;\nuse Drupal\\flowdrop_runtime\\DTO\\Orchestrator\\OrchestrationResponse;\nuse Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Synchronous workflow orchestrator plugin.\n *\n * Executes workflows directly without requiring pipeline entities. Uses the\n * ExecutionGraph for determining execution order and the DependencyGraph for\n * data resolution at runtime.\n *\n * This plugin delegates to the SynchronousOrchestrator service which is\n * configured with all required dependencies including the WorkflowStateManager\n * for snapshot generation.\n */\n#[Orchestrator(\n  id: \"synchronous\",\n  label: new TranslatableMarkup(\"Synchronous Orchestrator\"),\n  description: \"Executes workflows synchronously with real-time updates\",\n)]\nclass SynchronousOrchestratorPlugin extends OrchestratorPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The underlying synchronous orchestrator service.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator\n   */\n  protected SynchronousOrchestrator $orchestratorService;\n\n  /**\n   * Constructs a new SynchronousOrchestratorPlugin.\n   *\n   * @param array<string, mixed> $configuration\n   *   A configuration array.\n   * @param string $plugin_id\n   *   The plugin ID.\n   * @param mixed $plugin_definition\n   *   The plugin definition.\n   * @param \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\SynchronousOrchestrator $orchestratorService\n   *   The synchronous orchestrator service (fully configured with all deps).\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    SynchronousOrchestrator $orchestratorService,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->orchestratorService = $orchestratorService;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get(\"flowdrop_runtime.synchronous_orchestrator\"),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function orchestrate(OrchestrationRequest $request): OrchestrationResponse {\n    return $this->orchestratorService->orchestrate($request);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsWorkflow(array $workflow): bool {\n    return $this->orchestratorService->supportsWorkflow($workflow);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCapabilities(): array {\n    return $this->orchestratorService->getCapabilities();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state, array $settings): array {\n    // Merge with defaults to ensure all settings have values.\n    $settings = array_merge($this->getDefaultConfiguration(), $settings);\n\n    // Synchronous orchestrator has minimal configuration.\n    // Just use the common fields (priority, timeout) from parent.\n    $form[\"info\"] = [\n      \"#type\" => \"markup\",\n      \"#markup\" => \"<p>\" . $this->t(\"The synchronous orchestrator executes workflows immediately in the current request. It provides real-time updates and is best suited for short-running workflows.\") . \"</p>\",\n    ];\n\n    $form[\"realtime\"] = [\n      \"#type\" => \"fieldset\",\n      \"#title\" => $this->t(\"Real-Time Settings\"),\n      \"#description\" => $this->t(\"Configure real-time execution behavior.\"),\n    ];\n\n    $form[\"realtime\"][\"enable_realtime_updates\"] = [\n      \"#type\" => \"checkbox\",\n      \"#title\" => $this->t(\"Enable Real-Time Updates\"),\n      \"#description\" => $this->t(\"Send real-time status updates during execution. Requires WebSocket or SSE support.\"),\n      \"#default_value\" => $settings[\"enable_realtime_updates\"] ?? TRUE,\n    ];\n\n    $form[\"realtime\"][\"log_level\"] = [\n      \"#type\" => \"select\",\n      \"#title\" => $this->t(\"Logging Level\"),\n      \"#description\" => $this->t(\"Detail level for execution logging.\"),\n      \"#options\" => [\n        \"minimal\" => $this->t(\"Minimal - Only errors\"),\n        \"normal\" => $this->t(\"Normal - Start/end and errors\"),\n        \"verbose\" => $this->t(\"Verbose - All node executions\"),\n        \"debug\" => $this->t(\"Debug - Everything including data\"),\n      ],\n      \"#default_value\" => $settings[\"log_level\"] ?? \"normal\",\n    ];\n\n    // Add common fields from parent (priority, timeout).\n    $form = parent::buildConfigurationForm($form, $form_state, $settings);\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array $form, FormStateInterface $form_state): array {\n    // Get base configuration from parent.\n    $config = parent::submitConfigurationForm($form, $form_state);\n\n    // Extract synchronous-specific values.\n    $values = $form_state->getValue(\"orchestrator_settings\") ?? [];\n\n    $realtimeSettings = $values[\"realtime\"] ?? [];\n    $config[\"enable_realtime_updates\"] = (bool) ($realtimeSettings[\"enable_realtime_updates\"] ?? TRUE);\n    $config[\"log_level\"] = $realtimeSettings[\"log_level\"] ?? \"normal\";\n\n    return $config;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultConfiguration(): array {\n    return [\n      \"type\" => $this->getPluginId(),\n      \"priority\" => \"normal\",\n      \"timeout\" => 300,\n      \"enable_realtime_updates\" => TRUE,\n      \"log_level\" => \"normal\",\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Plugin/Orchestrator/SynchronousOrchestratorPlugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SynchronousOrchestratorPlugin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class User in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\d7\\FieldableEntity;\n\n/**\n * Drupal 7 user source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d7_user\",\n *   source_module = \"user\"\n * )\n */\nclass User extends FieldableEntity {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    return $this->select('users', 'u')\n      ->fields('u')\n      ->condition('u.uid', 0, '>');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = [\n      'uid' => $this->t('User ID'),\n      'name' => $this->t('Username'),\n      'pass' => $this->t('Password'),\n      'mail' => $this->t('Email address'),\n      'signature' => $this->t('Signature'),\n      'signature_format' => $this->t('Signature format'),\n      'created' => $this->t('Registered timestamp'),\n      'access' => $this->t('Last access timestamp'),\n      'login' => $this->t('Last login timestamp'),\n      'status' => $this->t('Status'),\n      'timezone' => $this->t('Timezone'),\n      'language' => $this->t('Language'),\n      'picture' => $this->t('Picture'),\n      'init' => $this->t('Init'),\n      'data' => $this->t('User data'),\n      'roles' => $this->t('Roles'),\n    ];\n\n    // Profile fields.\n    if ($this->moduleExists('profile')) {\n      $fields += $this->select('profile_fields', 'pf')\n        ->fields('pf', ['name', 'title'])\n        ->execute()\n        ->fetchAllKeyed();\n    }\n\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    $uid = $row->getSourceProperty('uid');\n\n    $roles = $this->select('users_roles', 'ur')\n      ->fields('ur', ['rid'])\n      ->condition('ur.uid', $uid)\n      ->execute()\n      ->fetchCol();\n    $row->setSourceProperty('roles', $roles);\n\n    $row->setSourceProperty('data', unserialize($row->getSourceProperty('data') ?? ''));\n\n    // If this entity was translated using Entity Translation, we need to get\n    // its source language to get the field values in the right language.\n    // The translations will be migrated by the d7_user_entity_translation\n    // migration.\n    $entity_translatable = $this->isEntityTranslatable('user');\n    $source_language = $this->getEntityTranslationSourceLanguage('user', $uid);\n    $language = $entity_translatable && $source_language ? $source_language : $row->getSourceProperty('language');\n    $row->setSourceProperty('entity_language', $language);\n\n    // Get Field API field values.\n    foreach ($this->getFields('user') as $field_name => $field) {\n      // Ensure we're using the right language if the entity and the field are\n      // translatable.\n      $field_language = $entity_translatable && $field['translatable'] ? $language : NULL;\n      $row->setSourceProperty($field_name, $this->getFieldValues('user', $field_name, $uid, NULL, $field_language));\n    }\n\n    // Get profile field values. This code is lifted directly from the D6\n    // ProfileFieldValues plugin.\n    if ($this->getDatabase()->schema()->tableExists('profile_value')) {\n      $query = $this->select('profile_value', 'pv')\n        ->fields('pv', ['fid', 'value']);\n      $query->leftJoin('profile_field', 'pf', '[pf].[fid] = [pv].[fid]');\n      $query->fields('pf', ['name', 'type']);\n      $query->condition('uid', $row->getSourceProperty('uid'));\n      $results = $query->execute();\n\n      foreach ($results as $profile_value) {\n        if ($profile_value['type'] == 'date') {\n          $date = unserialize($profile_value['value']);\n          $date = date('Y-m-d', mktime(0, 0, 0, $date['month'], $date['day'], $date['year']));\n          $row->setSourceProperty($profile_value['name'], ['value' => $date]);\n        }\n        elseif ($profile_value['type'] == 'list') {\n          // Explode by newline and comma.\n          $row->setSourceProperty($profile_value['name'], preg_split(\"/[\\r\\n,]+/\", $profile_value['value']));\n        }\n        else {\n          $row->setSourceProperty($profile_value['name'], [$profile_value['value']]);\n        }\n      }\n    }\n\n    return parent::prepareRow($row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    return [\n      'uid' => [\n        'type' => 'integer',\n        'alias' => 'u',\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/migrate/source/d7/User.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "User", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: DynamicallyFieldableEntityStorageInterface.php\nTarget symbol: interface can\nNamespace: Drupal\\Core\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for can.\n- Include required imports:\n  - Drupal\\Core\\Field\\FieldDefinitionListenerInterface\n  - Drupal\\Core\\Field\\FieldStorageDefinitionListenerInterface", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\Field\\FieldDefinitionListenerInterface;\nuse Drupal\\Core\\Field\\FieldStorageDefinitionListenerInterface;\n\n/**\n * A storage that supports entity types with dynamic field definitions.\n *\n * A storage that implements this interface can react to the entity type's field\n * definitions changing, due to modules being installed or uninstalled, or via\n * field UI, or via code changes to the entity class.\n *\n * For example, configurable fields defined and exposed by field.module.\n */\ninterface DynamicallyFieldableEntityStorageInterface extends FieldableEntityStorageInterface, FieldStorageDefinitionListenerInterface, FieldDefinitionListenerInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/DynamicallyFieldableEntityStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DynamicallyFieldableEntityStorageInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class ConfirmViewsBuilderDeleteForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder_views\\Form;\n\nuse Drupal\\Core\\DependencyInjection\\AutowireTrait;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\display_builder_views\\Plugin\\views\\display_extender\\DisplayExtender;\n\n/**\n * Confirmation form to confirm deletion of display builder instance.\n */\nclass ConfirmViewsBuilderDeleteForm extends ConfirmFormBase {\n\n  use AutowireTrait;\n\n  /**\n   * Display builder id to delete.\n   */\n  private ?string $builderId;\n\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?string $builder_id = NULL): array {\n    $this->builderId = $builder_id;\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl(): Url {\n    return new Url('display_builder_views.views.collection');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'confirm_display_builder_views_delete_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion(): TranslatableMarkup {\n    return $this->t('Do you want to delete %id?', ['%id' => $this->builderId]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $storage = $this->entityTypeManager->getStorage('display_builder_instance');\n    $instance = $storage->load($this->builderId);\n    $storage->delete([$instance]);\n    $this->unsetDisplayBuilder();\n    $form_state->setRedirectUrl(new Url('display_builder_views.views.collection'));\n  }\n\n  /**\n   * Unset display builder.\n   */\n  protected function unsetDisplayBuilder(): void {\n    $view_id = DisplayExtender::checkInstanceId($this->builderId)['view'];\n    $display_id = DisplayExtender::checkInstanceId($this->builderId)['display'];\n    $view = $this->entityTypeManager->getStorage('view')->load($view_id);\n    // It is risky to alter a View like that. We need to be careful to not\n    // break the storage integrity, but we didn't find a better way.\n    $displays = $view->get('display');\n    $displays[$display_id]['display_options']['display_extenders']['display_builder']['display_builder'] = '';\n    $view->set('display', $displays);\n    $view->save();\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/src/Form/ConfirmViewsBuilderDeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfirmViewsBuilderDeleteForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_migration.migration:\n    class: Drupal\\mcp_tools_migration\\Service\\MigrationService\n    arguments:\n      - '@entity_type.manager'\n      - '@entity_field.manager'\n      - '@current_user'\n      - '@mcp_tools.access_manager'\n      - '@mcp_tools.audit_logger'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_migration/mcp_tools_migration.services.yml", "type": "yaml_reference", "topic": "mcp tools migration.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "tmgmt_laratranslate.settings:\n  type: config_object\n  label: 'Lara Translate settings'\n  mapping:\n    excluded_field_types:\n      type: sequence\n      label: 'Excluded field types'\n      sequence:\n        type: string\n        label: 'Field type'\n\ntmgmt_laratranslate.translator.*:\n  type: tmgmt_translator\n  mapping:\n    lara_access_key_id:\n      type: string\n      label: 'Lara Access Key ID'\n    lara_access_key_secret:\n      type: string\n      label: 'Lara Access Key Secret'\n    adaptTo:\n      type: sequence\n      label: 'Translation Memories (adaptTo)'\n      sequence:\n        type: string\n    glossaries:\n      type: sequence\n      label: 'Glossaries'\n      sequence:\n        type: string\n    instructions:\n      type: sequence\n      label: 'Translation Instructions'\n      sequence:\n        type: string\n    style:\n      type: string\n      label: 'Translation Style'\n    language_mappings:\n      type: sequence\n      label: 'Custom Language Code Mappings'\n      sequence:\n        type: mapping\n        mapping:\n          drupal_code:\n            type: string\n            label: 'Drupal Language Code'\n          lara_code:\n            type: string\n            label: 'Lara Language Code'\n", "metadata": {"source": "repos/tmgmt_laratranslate/config/schema/tmgmt_laratranslate.schema.yml", "type": "yaml_reference", "topic": "tmgmt laratranslate.schema"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Page\nSource file: <source_file>\nFile name hint: Page.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\n\n/**\n * Provides a render element for the content of an HTML page.\n *\n * This represents the \"main part\" of the HTML page's body; see html.html.twig.\n  */\n#[RenderElement('page')]\nclass Page extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function getInfo() {\n    return [\n      '#theme' => 'page',\n      '#title' => '',\n    ];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\n\n/**\n * Provides a render element for the content of an HTML page.\n *\n * This represents the \"main part\" of the HTML page's body; see html.html.twig.\n  */\n#[RenderElement('page')]\nclass Page extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#theme' => 'page',\n      '#title' => '',\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/Page.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Page", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: AttributeInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Component\\Plugin\\Attribute;\n\n/**\n * Defines a common interface for classed attributes.\n */\ninterface AttributeInterface {\n\n  /**\n   * Gets the value of an attribute.\n   */\n  function get(): mixed;\n\n  /**\n   * Gets the name of the provider of the attribute class.\n   *\n   * @return string|null\n   *   The provider of the attribute class.\n   */\n  public function getProvider(): ?string;\n\n  /**\n   * Sets the name of the provider of the attribute class.\n   *\n   * @param string $provider\n   *   The provider of the annotated class.\n   */\n  public function setProvider(string $provider): void;\n\n  /**\n   * Gets the unique ID for this attribute class.\n   *\n   * @return string\n   *   The attribute class ID.\n   */\n  public function getId(): string;\n\n  /**\n   * Gets the class of the attribute class.\n   *\n   * @return class-string|null\n   *   The attribute class.\n   */\n  public function getClass(): ?string;\n\n  /**\n   * Sets the class of the attributed class.\n   *\n   * @param class-string $class\n   *   The class of the attributed class.\n   */\n  public function setClass(string $class): void;\n\n  /**\n   * Gets the dependencies for this attribute class.\n   *\n   * @return array{\"class\"?: list<class-string>, \"interface\"?: list<class-string>, \"trait\"?: list<class-string>, \"provider\"?: list<string>}|null\n   *   The list of dependencies, keyed by type. If the type is 'class', 'trait',\n   *   or 'interface', the values for the type are class names. If the type is\n   *   'provider', the values for the type are provider names.\n   */\n  public function getDependencies(): ?array;\n\n  /**\n   * Sets the dependencies for this attribute class.\n   *\n   * @param array{\"class\"?: list<class-string>, \"interface\"?: list<class-string>, \"trait\"?: list<class-string>, \"provider\"?: list<string>}|null $dependencies\n   *   The list of dependencies, keyed by type. If the type is 'class', 'trait',\n   *   or 'interface', the values for the type are class names. If the type is\n   *   'provider', the values for the type are provider names.\n   */\n  public function setDependencies(?array $dependencies): void;\n\n}", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin\\Attribute;\n\n/**\n * Defines a common interface for classed attributes.\n */\ninterface AttributeInterface {\n\n  /**\n   * Gets the value of an attribute.\n   */\n  public function get(): mixed;\n\n  /**\n   * Gets the name of the provider of the attribute class.\n   *\n   * @return string|null\n   *   The provider of the attribute class.\n   */\n  public function getProvider(): ?string;\n\n  /**\n   * Sets the name of the provider of the attribute class.\n   *\n   * @param string $provider\n   *   The provider of the annotated class.\n   */\n  public function setProvider(string $provider): void;\n\n  /**\n   * Gets the unique ID for this attribute class.\n   *\n   * @return string\n   *   The attribute class ID.\n   */\n  public function getId(): string;\n\n  /**\n   * Gets the class of the attribute class.\n   *\n   * @return class-string|null\n   *   The attribute class.\n   */\n  public function getClass(): ?string;\n\n  /**\n   * Sets the class of the attributed class.\n   *\n   * @param class-string $class\n   *   The class of the attributed class.\n   */\n  public function setClass(string $class): void;\n\n  /**\n   * Gets the dependencies for this attribute class.\n   *\n   * @return array{\"class\"?: list<class-string>, \"interface\"?: list<class-string>, \"trait\"?: list<class-string>, \"provider\"?: list<string>}|null\n   *   The list of dependencies, keyed by type. If the type is 'class', 'trait',\n   *   or 'interface', the values for the type are class names. If the type is\n   *   'provider', the values for the type are provider names.\n   */\n  public function getDependencies(): ?array;\n\n  /**\n   * Sets the dependencies for this attribute class.\n   *\n   * @param array{\"class\"?: list<class-string>, \"interface\"?: list<class-string>, \"trait\"?: list<class-string>, \"provider\"?: list<string>}|null $dependencies\n   *   The list of dependencies, keyed by type. If the type is 'class', 'trait',\n   *   or 'interface', the values for the type are class names. If the type is\n   *   'provider', the values for the type are provider names.\n   */\n  public function setDependencies(?array $dependencies): void;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/Attribute/AttributeInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "AttributeInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ReferralTypeListBuilder.php\nTarget symbol: class ReferralTypeListBuilder\nNamespace: Drupal\\commerce_referral\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ReferralTypeListBuilder.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Link\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - buildHeader()\n  - buildRow()\n  - createInstance()", "output": "<?php\n\nnamespace Drupal\\commerce_referral\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Link;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Defines the list builder for Referral types.\n */\nclass ReferralTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(\n    ContainerInterface $container,\n    EntityTypeInterface $entity_type,\n  ): ReferralTypeListBuilder {\n    $instance = parent::createInstance($container, $entity_type);\n    $instance->entityTypeManager = $container->get('entity_type.manager');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return mixed[]\n   *   The header.\n   */\n  public function buildHeader(): array {\n    $header['label'] = $this->t('Referral type');\n    $header['referral_promotion'] = $this->t('Referral promotion');\n    $header['kickback_promotion'] = $this->t('Kickback promotion');\n\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity.\n   *\n   * @return mixed[]\n   *   The row.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function buildRow(EntityInterface $entity): array {\n    /** @var \\Drupal\\commerce_referral\\Entity\\ReferralType $entity */\n    // Name/label linking directly to the bundle edit form (no canonical link).\n    $row['label'] = $entity->label();\n\n    // Referral promotion label linking to the promotion edit form.\n    $referral_promotion_label = $this->t('Not set');\n    if ($promotion_id = $entity->getReferralPromotionId()) {\n      $promotion = $this->entityTypeManager->getStorage('commerce_promotion')->load($promotion_id);\n      if ($promotion) {\n        $referral_promotion_label = Link::fromTextAndUrl($promotion->label() ?? \"\", $promotion->toUrl('edit-form'));\n      }\n    }\n    $row['referral_promotion'] = $referral_promotion_label;\n\n    // Kickback promotion label linking to the promotion edit form.\n    $kickback_promotion_label = $this->t('Not set');\n    if ($promotion_id = $entity->getKickbackPromotionId()) {\n      $promotion = $this->entityTypeManager->getStorage('commerce_promotion')->load($promotion_id);\n      if ($promotion) {\n        $kickback_promotion_label = Link::fromTextAndUrl($promotion->label() ?? \"\", $promotion->toUrl('edit-form'));\n      }\n    }\n    $row['kickback_promotion'] = $kickback_promotion_label;\n\n    // Ensure operations appear as the last column.\n    $row['operations'] = [\n      'data' => [\n        '#type' => 'operations',\n        '#links' => $this->getOperations($entity),\n      ],\n    ];\n\n    return $row;\n  }\n\n}\n", "metadata": {"source": "repos/commerce_referral/src/Entity/ReferralTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ReferralTypeListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class DecorativeImages in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update, and uninstall functions for the decorative_images module.\n */\n\n/**\n * Implements hook_uninstall().\n *\n * Delete decorative_images entries from keyvalue storage.\n */\nfunction decorative_images_uninstall() {\n  \\Drupal::service('keyvalue')->get('decorative_images')->deleteAll();\n}\n", "metadata": {"source": "repos/decorative_images/decorative_images.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DecorativeImages", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Configuring comments'\nrelated:\n  - comment.overview\n  - comment.creating_type\n  - comment.disabling\n  - field_ui.add_field\n---\n{% set comment_permissions_link_text %}\n{% trans %}Administer comments and comment settings{% endtrans %}\n{% endset %}\n{% set comment_permissions_link = render_var(help_route_link(comment_permissions_link_text, 'user.admin_permissions.module', {'modules': 'comment'})) %}\n{% set content_structure_topic = render_var(help_topic_link('core.content_structure')) %}\n{% set comment_type_topic = render_var(help_topic_link('comment.creating_type')) %}\n<h2>{% trans %}Goal{% endtrans %}</h2>\n<p>{% trans %}Configure a content entity type/subtype to allow commenting, using a comment type that you have configured. See {{ content_structure_topic }} for more about content entities and fields, and {{ comment_type_topic }} to configure a comment type.{% endtrans %}</p>\n<h2>{% trans %}Who can configure comments?{% endtrans %}</h2>\n<p>{% trans %}In order to follow these steps, the Field UI module must be installed. You'll need the Comment module's <em>{{ comment_permissions_link }}</em> permission, in order to change comment settings for a comment field. You'll also need to have the appropriate permission for adding fields to the entity type or subtype that the comments are attached to. For example, to add a comment field to content items provided by the Node module, you would need the Node module's <em>Administer content types</em> permission.{% endtrans %}</p>\n<h2>{% trans %}Steps{% endtrans %}</h2>\n<ol>\n  <li>{% trans %}Follow the steps in the related <em>Adding a field to an entity sub-type</em> topic to add a field of type <em>Comments</em> to the desired entity type or sub-type.{% endtrans %}</li>\n  <li>{% trans %}On the first field settings page, choose the <em>Comment type</em> to use for this entity type or sub-type. You'll also notice that the <em>Allowed number of values</em> field cannot be changed for comment fields.{% endtrans %}</li>\n  <li>{% trans %}On the next field settings page, enter the desired settings for the comment field:{% endtrans %}\n    <ul>\n      <li>{% trans %}<em>Threading</em>: whether or not the comments are collected by threads, with people able to reply to particular comments instead of to the content entity itself.{% endtrans %}</li>\n      <li>{% trans %}<em>Comments per page</em>: the maximum number of comments displayed on one page (a pager will be added if you exceed this limit).{% endtrans %}</li>\n      <li>{% trans %}<em>Anonymous commenting</em>: whether or not anonymous commenters are allowed or required to leave contact information with their comments (only applies if anonymous users have permission to post comments).{% endtrans %}</li>\n      <li>{% trans %}<em>Show reply form on the same page as comments</em>: whether the comment reply form is displayed on the same page as the comments. If this is not selected, clicking <em>Reply</em> will open a new page with the reply form.{% endtrans %}</li>\n      <li>{% trans %}<em>Preview comments</em>: whether previewing comments before submission is <em>Required</em>, <em>Optional</em>, or <em>Disabled</em>.{% endtrans %}</li>\n      <li>{% trans %}<em>Default value</em>: each individual entity has its own comment settings, but here you can set defaults for the comment settings for this entity type or subtype. The comment settings values are:{% endtrans %}\n        <ul>\n          <li>{% trans %}<em>Open</em>: comments are allowed.{% endtrans %}</li>\n          <li>{% trans %}<em>Closed</em>: past comments remain visible, but no new comments are allowed.{% endtrans %}</li>\n          <li>{% trans %}<em>Hidden</em>: past comments are hidden, and no new comments are allowed.{% endtrans %}</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ol>\n<h2>{% trans %}Additional resources{% endtrans %}</h2>\n<ul>\n  <li><a href=\"https://www.drupal.org/docs/8/core/modules/comment/administering-a-content-types-comment-settings\">{% trans %}Online documentation for content comment settings{% endtrans %}</a></li>\n</ul>\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/help_topics/comment.configuring.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class ContextualViewsHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\contextual\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for contextual.\n */\nclass ContextualViewsHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_views_data_alter().\n   */\n  #[Hook('views_data_alter')]\n  public function viewsDataAlter(&$data): void {\n    $data['views']['contextual_links'] = [\n      'title' => $this->t('Contextual Links'),\n      'help' => $this->t('Display fields in a contextual links menu.'),\n      'field' => [\n        'id' => 'contextual_links',\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contextual/src/Hook/ContextualViewsHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContextualViewsHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Chapter 6. Setting Up Content Structure", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal User Guide](/docs/user_guide/en/index.html)\n\n* [Preface](/docs/user_guide/en/preface.html)\n* [Chapter 1. Understanding Drupal](/docs/user_guide/en/understanding-chapter.html)\n* [Chapter 2. Planning Your Site](/docs/user_guide/en/planning-chapter.html)\n* [Chapter 3. Installation](/docs/user_guide/en/installation-chapter.html)\n* [Chapter 4. Basic Site Configuration](/docs/user_guide/en/config-chapter.html)\n* [Chapter 5. Basic Page Management](/docs/user_guide/en/content-chapter.html)\n* [Chapter 6. Setting Up Content Structure](/docs/user_guide/en/content-structure-chapter.html)\n* [Chapter 7. Managing User Accounts](/docs/user_guide/en/user-chapter.html)\n* [Chapter 8. Blocks](/docs/user_guide/en/blocks-chapter.html)\n* [Chapter 9. Creating Listings with Views](/docs/user_guide/en/views-chapter.html)\n* [Chapter 10. Making Your Site Multilingual](/docs/user_guide/en/multilingual-chapter.html)\n* [Chapter 11. Extending and Customizing Your Site](/docs/user_guide/en/extend-chapter.html)\n* [Chapter 12. Preventing and Fixing Problems](/docs/user_guide/en/prevent-chapter.html)\n* [Chapter 13. Security and Maintenance](/docs/user_guide/en/security-chapter.html)\n* [Chapter 14. Final Thoughts](/docs/user_guide/en/thoughts-chapter.html)\n* [Glossary](/docs/user_guide/en/glossary.html)\n* [Index](/docs/user_guide/en/_index.html)\n* [Appendix A. Appendix](/docs/user_guide/en/appendix.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/content-structure-chapter.html \"Cap\u00edtol 6. Configuraci\u00f3 de l\u2019estructura del contingut\")\n* [Magyar](/hu/docs/user_guide/hu/content-structure-chapter.html \"6. fejezet - Tartalomszerkezet\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/content-structure-chapter.html \"Cap\u00edtulo 6. Configuraci\u00f3n de la estructura de contenido\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/content-structure-chapter.html \"\u0420\u043e\u0437\u0434\u0456\u043b 6. \u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0438 \u043c\u0430\u0442\u0435\u0440\u0456\u0430\u043b\u0456\u0432\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/content-structure-chapter.html \"\u7b2c 6 \u7ae0 \u5185\u5bb9\u7ed3\u6784\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/content-structure-chapter.html \"Chapitre 6. Mise en place de la structure du contenu\")\n* [Deutsch](/de/docs/user_guide/de/content-structure-chapter.html \"Kapitel 6. Inhaltsstruktur der Website einrichten\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/content-structure-chapter.html \"\u0641\u0635\u0644 6. \u062a\u0646\u0638\u06cc\u0645 \u0633\u0627\u062e\u062a\u0627\u0631 \u0645\u062d\u062a\u0648\u0627\u06cc\u06cc\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/content-structure-chapter.html \"Bab 6. Menyiapkan Struktur Konten\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/content-structure-chapter.html \"\u7b2c6\u7ae0 \u30b3\u30f3\u30c6\u30f3\u30c4\u69cb\u9020\u306e\u8a2d\u5b9a\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/content-structure-chapter.html \"Cap\u00edtulo 6. Setting Up Content Structure\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/content-structure-chapter.html \"\u0413\u043b\u0430\u0432\u0430 6. \u041d\u0430\u0441\u0442\u0440\u043e\u043a\u0430 \u0442\u0438\u043f\u043e\u0432 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u043e\u0432\")\n\n# Chapter 6. Setting Up Content Structure\n\n## [6.1. Adding a Content Type](/docs/user_guide/en/structure-content-type.html)\n\nHow to add and configure a new content type.\n\n## [6.2. Deleting a Content Type](/docs/user_guide/en/structure-content-type-delete.html)\n\nHow to delete a content type that is not required for the site.\n\n## [6.3. Adding Basic Fields to a Content Type](/docs/user_guide/en/structure-fields.html)\n\nHow to add fields to a content type.\n\n## [6.4. Concept: Reference Fields](/docs/user_guide/en/structure-reference-fields.html)\n\nOverview of reference fields and their commonly-used types.\n\n## [6.5. Concept: Taxonomy](/docs/user_guide/en/structure-taxonomy.html)\n\nOverview of taxonomy and how it can be used to categorize content in a website.\n\n## [6.6. Setting Up a Taxonomy](/docs/user_guide/en/structure-taxonomy-setup.html)\n\nHow to create a taxonomy vocabulary and add it as a field to a content type.\n\n## [6.7. Adding a Reference Field](/docs/user_guide/en/structure-adding-reference.html)\n\nHow to add a reference field that connects two content types.\n\n## [6.8. Concept: Forms and Widgets](/docs/user_guide/en/structure-widgets.html)\n\nOverview of forms and widgets.\n\n## [6.9. Changing Content Entry Forms](/docs/user_guide/en/structure-form-editing.html)\n\nHow to edit a content entry form.\n\n## [6.10. Concept: View Modes and Formatters](/docs/user_guide/en/structure-view-modes.html)\n\nOverview of view modes and field formatters.\n\n## [6.11. Changing Content Display](/docs/user_guide/en/structure-content-display.html)\n\nHow to make content items more presentable.\n\n## [6.12. Concept: Image Styles](/docs/user_guide/en/structure-image-styles.html)\n\nOverview of image styles and how they are used to display a single image in\nseveral variations.\n\n## [6.13. Setting Up an Image Style](/docs/user_guide/en/structure-image-style-create.html)\n\nHow to add an image style to reformat an image.\n\n## [6.14. Concept: Responsive Image Styles](/docs/user_guide/en/structure-image-responsive.html)\n\nOverview of responsive image styles, which allow you to provide different images\nfor different screen sizes.\n\n## [6.15. Concept: Text Formats and Editors](/docs/user_guide/en/structure-text-formats.html)\n\nOverview of text formats, filters, editors, and cross-site scripting.\n\n## [6.16. Configuring Text Formats and Editors](/docs/user_guide/en/structure-text-format-config.html)\n\nHow to make a change to a text format and its editor configuration.\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: guide.asciidoc\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/content-structure-chapter.md", "type": "doc_summary", "topic": "Chapter 6. Setting Up Content Structure"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SnapshotCleanupForm.php\nTarget symbol: class SnapshotCleanupForm\nNamespace: Drupal\\flowdrop_runtime\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SnapshotCleanupForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildForm()\n  - create()\n  - getFormId()\n  - previewCleanup()\n  - submitForm()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Form;\n\nuse Drupal\\Core\\Form\\FormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Form for cleaning up old workflow snapshots.\n */\nclass SnapshotCleanupForm extends FormBase {\n\n  /**\n   * The entity snapshot storage service.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage\n   */\n  protected EntitySnapshotStorage $snapshotStorage;\n\n  /**\n   * Constructs a new SnapshotCleanupForm.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\Service\\WorkflowState\\EntitySnapshotStorage $snapshot_storage\n   *   The entity snapshot storage service.\n   */\n  public function __construct(EntitySnapshotStorage $snapshot_storage) {\n    $this->snapshotStorage = $snapshot_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('flowdrop_runtime.entity_snapshot_storage'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'flowdrop_runtime_snapshot_cleanup';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $form['description'] = [\n      '#type' => 'markup',\n      '#markup' => '<p>' . $this->t('Use this form to clean up old workflow snapshots. This action is irreversible.') . '</p>',\n    ];\n\n    $form['age'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Delete snapshots older than'),\n      '#options' => [\n        '3600' => $this->t('1 hour'),\n        '86400' => $this->t('1 day'),\n        '604800' => $this->t('1 week'),\n        '2592000' => $this->t('30 days'),\n        '7776000' => $this->t('90 days'),\n      ],\n      '#default_value' => '604800',\n      '#required' => TRUE,\n    ];\n\n    $form['statuses'] = [\n      '#type' => 'checkboxes',\n      '#title' => $this->t('Only delete snapshots with status'),\n      '#options' => [\n        'completed' => $this->t('Completed'),\n        'failed' => $this->t('Failed'),\n        'pending' => $this->t('Pending'),\n        'running' => $this->t('Running'),\n        'paused' => $this->t('Paused'),\n      ],\n      '#default_value' => ['completed', 'failed'],\n      '#description' => $this->t('Leave all unchecked to delete all snapshots regardless of status.'),\n    ];\n\n    $form['actions'] = [\n      '#type' => 'actions',\n    ];\n\n    $form['actions']['preview'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Preview'),\n      '#submit' => ['::previewCleanup'],\n    ];\n\n    $form['actions']['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Delete snapshots'),\n      '#button_type' => 'danger',\n    ];\n\n    return $form;\n  }\n\n  /**\n   * Preview cleanup handler.\n   */\n  public function previewCleanup(array &$form, FormStateInterface $form_state): void {\n    $age = (int) $form_state->getValue('age');\n    $statuses = array_filter($form_state->getValue('statuses') ?? []);\n    $olderThan = time() - $age;\n\n    // Count snapshots that would be deleted.\n    $query = \\Drupal::entityTypeManager()\n      ->getStorage('flowdrop_workflow_snapshot')\n      ->getQuery()\n      ->condition('created', $olderThan, '<')\n      ->accessCheck(FALSE);\n\n    if (!empty($statuses)) {\n      $query->condition('snapshot_status', array_keys($statuses), 'IN');\n    }\n\n    $count = $query->count()->execute();\n\n    $this->messenger()->addStatus($this->t('@count snapshots would be deleted.', [\n      '@count' => $count,\n    ]));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $age = (int) $form_state->getValue('age');\n    $statuses = array_filter($form_state->getValue('statuses') ?? []);\n    $olderThan = time() - $age;\n\n    $statusList = !empty($statuses) ? array_keys($statuses) : [];\n    $deleted = $this->snapshotStorage->cleanup($olderThan, $statusList);\n\n    $this->messenger()->addStatus($this->t('Deleted @count workflow snapshots.', [\n      '@count' => $deleted,\n    ]));\n\n    $form_state->setRedirect('entity.flowdrop_workflow_snapshot.collection');\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Form/SnapshotCleanupForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SnapshotCleanupForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class SiteHealthService in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools\\Service;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Extension\\ModuleExtensionList;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\State\\StateInterface;\n\n/**\n * Service for gathering site health information.\n */\nclass SiteHealthService {\n\n  public function __construct(\n    protected ModuleExtensionList $moduleExtensionList,\n    protected StateInterface $state,\n    protected Connection $database,\n    protected ConfigFactoryInterface $configFactory,\n    protected ModuleHandlerInterface $moduleHandler,\n  ) {}\n\n  /**\n   * Get comprehensive site status information.\n   *\n   * @return array\n   *   Array containing site status data.\n   */\n  public function getSiteStatus(): array {\n    return [\n      'drupal_version' => \\Drupal::VERSION,\n      'php_version' => PHP_VERSION,\n      'database' => $this->getDatabaseInfo(),\n      'site_name' => $this->configFactory->get('system.site')->get('name'),\n      'site_uuid' => $this->configFactory->get('system.site')->get('uuid'),\n      'install_profile' => $this->configFactory->get('core.extension')->get('profile'),\n      'modules' => $this->getModuleSummary(),\n      'cron' => $this->getCronStatus(),\n      'maintenance_mode' => $this->state->get('system.maintenance_mode', FALSE),\n    ];\n  }\n\n  /**\n   * Get database information.\n   *\n   * @return array\n   *   Database driver and version info.\n   */\n  protected function getDatabaseInfo(): array {\n    $connection = $this->database;\n    return [\n      'driver' => $connection->driver(),\n      'version' => $connection->version(),\n    ];\n  }\n\n  /**\n   * Get summary of installed modules.\n   *\n   * @return array\n   *   Module counts and lists.\n   */\n  protected function getModuleSummary(): array {\n    $modules = $this->moduleExtensionList->getAllInstalledInfo();\n    $enabled = array_filter($modules, fn($m) => $m['status'] ?? FALSE);\n\n    return [\n      'total_installed' => count($enabled),\n      'core_count' => count(array_filter($enabled, fn($m) => ($m['package'] ?? '') === 'Core')),\n      'contrib_count' => count(array_filter($enabled, fn($m) =>\n        ($m['package'] ?? '') !== 'Core' && !str_starts_with($m['package'] ?? '', 'Custom')\n      )),\n      'custom_count' => count(array_filter($enabled, fn($m) =>\n        str_starts_with($m['package'] ?? '', 'Custom')\n      )),\n    ];\n  }\n\n  /**\n   * Get cron status information.\n   *\n   * @return array\n   *   Cron timing and status.\n   */\n  public function getCronStatus(): array {\n    $lastRun = $this->state->get('system.cron_last', 0);\n    $lastRunFormatted = $lastRun\n      ? date('Y-m-d H:i:s', $lastRun)\n      : 'Never';\n\n    $timeSinceLastRun = $lastRun\n      ? time() - $lastRun\n      : NULL;\n\n    return [\n      'last_run' => $lastRunFormatted,\n      'last_run_timestamp' => $lastRun,\n      'seconds_since_last_run' => $timeSinceLastRun,\n      'status' => $this->evaluateCronHealth($timeSinceLastRun),\n    ];\n  }\n\n  /**\n   * Evaluate cron health based on time since last run.\n   *\n   * @param int|null $seconds\n   *   Seconds since last cron run.\n   *\n   * @return string\n   *   Health status: 'healthy', 'warning', 'critical', or 'unknown'.\n   */\n  protected function evaluateCronHealth(?int $seconds): string {\n    if ($seconds === NULL) {\n      return 'unknown';\n    }\n    // Warning if over 3 hours, critical if over 24 hours.\n    if ($seconds > 86400) {\n      return 'critical';\n    }\n    if ($seconds > 10800) {\n      return 'warning';\n    }\n    return 'healthy';\n  }\n\n  /**\n   * Get list of installed modules with details.\n   *\n   * @param bool $includeCore\n   *   Whether to include core modules.\n   *\n   * @return array\n   *   List of modules with version and package info.\n   */\n  public function getInstalledModules(bool $includeCore = FALSE): array {\n    $modules = $this->moduleExtensionList->getAllInstalledInfo();\n    $result = [];\n\n    foreach ($modules as $name => $info) {\n      if (!$includeCore && ($info['package'] ?? '') === 'Core') {\n        continue;\n      }\n\n      $result[] = [\n        'name' => $name,\n        'label' => $info['name'] ?? $name,\n        'version' => $info['version'] ?? 'Unknown',\n        'package' => $info['package'] ?? 'Other',\n        'description' => $info['description'] ?? '',\n      ];\n    }\n\n    usort($result, fn($a, $b) => strcmp($a['name'], $b['name']));\n\n    return $result;\n  }\n\n}\n", "metadata": {"source": "repos/mcp_tools/src/Service/SiteHealthService.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SiteHealthService", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "db_wipe_entity.settings:\n  type: config_object\n  label: 'DB Wipe Entity settings'\n  mapping:\n    deletion_mode:\n      type: mapping\n      label: 'Deletion mode settings'\n      mapping:\n        default_method:\n          type: string\n          label: 'Default deletion method'\n          constraints:\n            Choice: ['entity_api', 'sql_direct', 'auto']\n        allow_sql_mode:\n          type: boolean\n          label: 'Allow direct SQL deletion mode'\n        sql_mode_requires_permission:\n          type: boolean\n          label: 'Require special permission for SQL mode'\n        auto_mode_threshold:\n          type: integer\n          label: 'Entity count threshold for auto mode to use SQL'\n        sql_batch_size:\n          type: integer\n          label: 'Batch size for SQL deletion'\n        disable_foreign_keys_on_truncate:\n          type: boolean\n          label: 'Temporarily disable foreign key checks during truncate'\n    logging:\n      type: mapping\n      label: 'Logging settings'\n      mapping:\n        enabled:\n          type: boolean\n          label: 'Enable logging of wipe operations'\n        log_protected_attempts:\n          type: boolean\n          label: 'Log attempts to delete protected entities'\n        log_batch_progress:\n          type: boolean\n          label: 'Log batch processing progress'\n        log_sql_queries:\n          type: boolean\n          label: 'Log SQL queries for debugging'\n    batch:\n      type: mapping\n      label: 'Batch processing settings'\n      mapping:\n        batch_size:\n          type: integer\n          label: 'Number of entities to process per batch'\n        memory_limit:\n          type: string\n          label: 'PHP memory limit for batch operations'\n\ndb_wipe_entity.protection_rule.*:\n  type: config_entity\n  label: 'Protection rule'\n  mapping:\n    id:\n      type: string\n      label: 'Machine name'\n    label:\n      type: label\n      label: 'Label'\n    description:\n      type: text\n      label: 'Description'\n    status:\n      type: boolean\n      label: 'Enabled'\n    weight:\n      type: integer\n      label: 'Weight'\n    plugin:\n      type: string\n      label: 'Plugin ID'\n    configuration:\n      type: sequence\n      label: 'Plugin configuration'\n      sequence:\n        type: ignore\n        label: 'Configuration value'\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/config/schema/db_wipe_entity.schema.yml", "type": "yaml_reference", "topic": "db wipe entity.schema"}}
{"instruction": "Show me the implementation of the trait ExtensionListTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Installer;\n\n/**\n * Provides common functionality for the extension list classes.\n */\ntrait ExtensionListTrait {\n\n  /**\n   * Static version of the added file names during the installer.\n   *\n   * @var string[]\n   *\n   * @internal\n   */\n  protected static $staticAddedPathNames;\n\n  /**\n   * @see \\Drupal\\Core\\Extension\\ExtensionList::setPathname()\n   */\n  public function setPathname($extension_name, $pathname) {\n    parent::setPathname($extension_name, $pathname);\n\n    // In the early installer the container is rebuilt multiple times. Therefore\n    // we have to keep the added filenames across those rebuilds. This is not a\n    // final design, but rather just a workaround resolved at some point,\n    // hopefully.\n    // @todo Remove as part of https://drupal.org/project/drupal/issues/2934063\n    static::$staticAddedPathNames[$extension_name] = $pathname;\n  }\n\n  /**\n   * @see \\Drupal\\Core\\Extension\\ExtensionList::getPathname()\n   */\n  public function getPathname($extension_name) {\n    if (isset($this->addedPathNames[$extension_name])) {\n      return $this->addedPathNames[$extension_name];\n    }\n    elseif (isset($this->pathNames[$extension_name])) {\n      return $this->pathNames[$extension_name];\n    }\n    elseif (isset(static::$staticAddedPathNames[$extension_name])) {\n      return static::$staticAddedPathNames[$extension_name];\n    }\n    elseif (($path_names = $this->getPathNames()) && isset($path_names[$extension_name])) {\n      // Ensure we don't have to do path scanning more than really needed.\n      foreach ($path_names as $extension => $path_name) {\n        static::$staticAddedPathNames[$extension] = $path_name;\n      }\n      return $path_names[$extension_name];\n    }\n    throw new \\InvalidArgumentException(\"The {$this->type} $extension_name does not exist.\");\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Installer/ExtensionListTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "ExtensionListTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "bootstrap_five_layouts_multiselect_test.page:\n  path: '/admin/bootstrap5-layouts/layout-default'\n  defaults:\n    _controller: '\\Drupal\\bootstrap_five_layouts_multiselect_test\\Controller\\MultiselectTestController::testPage'\n    _title: 'Bootstrap5 Layouts \u00bb Layout Test'\n  requirements:\n    _permission: 'administer site configuration'\n\nbootstrap_five_layouts_pillbox_test.page:\n  path: '/admin/bootstrap5-layouts/pillbox-test'\n  defaults:\n    _controller: '\\Drupal\\bootstrap_five_layouts_multiselect_test\\Controller\\MultiselectTestController::pillBoxTest'\n    _title: 'Bootstrap5 Layouts \u00bb Pill Box Test'\n  requirements:\n    _permission: 'administer site configuration'\n", "metadata": {"source": "repos/bootstrap_five_layouts/modules/bootstrap_five_layouts_multiselect_test/bootstrap_five_layouts_multiselect_test.routing.yml", "type": "yaml_reference", "topic": "bootstrap five layouts multiselect test.routing"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: CurrentUser\nSource file: <source_file>\nFile name hint: CurrentUser.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\user\\Plugin\\views\\argument_default;\n\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsArgumentDefault;\nuse Drupal\\views\\Plugin\\views\\argument_default\\ArgumentDefaultPluginBase;\n\n/**\n * Default argument plugin to extract the current user.\n *\n * This plugin actually has no options so it does not need to do a great deal.\n */\n#[ViewsArgumentDefault(\n  id: 'current_user',\n  title: new TranslatableMarkup('User ID from logged in user'),\n)]\nclass CurrentUser extends ArgumentDefaultPluginBase implements CacheableDependencyInterface {\n\n  /**\n   * CurrentUser constructor.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Session\\AccountInterface|null $currentUser\n   *   The current user.\n   */\n  function __construct(array $configuration, $plugin_id, $plugin_definition, protected ?AccountInterface $currentUser = NULL) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    if ($this->currentUser === NULL) {\n      @trigger_error('Calling ' . __CLASS__ . '::__construct() without the $currentUser argument is deprecated in drupal:11.2.0 and is required in drupal:12.0.0. See https://www.drupal.org/node/3347878', E_USER_DEPRECATED);\n      $this->currentUser = \\Drupal::currentUser();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getArgument() {\n    return $this->currentUser->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheMaxAge() {\n    return Cache::PERMANENT;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    return ['user'];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\views\\argument_default;\n\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsArgumentDefault;\nuse Drupal\\views\\Plugin\\views\\argument_default\\ArgumentDefaultPluginBase;\n\n/**\n * Default argument plugin to extract the current user.\n *\n * This plugin actually has no options so it does not need to do a great deal.\n */\n#[ViewsArgumentDefault(\n  id: 'current_user',\n  title: new TranslatableMarkup('User ID from logged in user'),\n)]\nclass CurrentUser extends ArgumentDefaultPluginBase implements CacheableDependencyInterface {\n\n  /**\n   * CurrentUser constructor.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Session\\AccountInterface|null $currentUser\n   *   The current user.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, protected ?AccountInterface $currentUser = NULL) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    if ($this->currentUser === NULL) {\n      @trigger_error('Calling ' . __CLASS__ . '::__construct() without the $currentUser argument is deprecated in drupal:11.2.0 and is required in drupal:12.0.0. See https://www.drupal.org/node/3347878', E_USER_DEPRECATED);\n      $this->currentUser = \\Drupal::currentUser();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getArgument() {\n    return $this->currentUser->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheMaxAge() {\n    return Cache::PERMANENT;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    return ['user'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/views/argument_default/CurrentUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CurrentUser", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DocumentLoaderSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\document_loader\\DocumentLoaderPluginManager;\nuse Drupal\\document_loader\\DocumentLoaderTypePluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configuration form for document loader settings.\n */\nclass DocumentLoaderSettingsForm extends ConfigFormBase {\n\n  /**\n   * The document loader plugin manager.\n   *\n   * @var \\Drupal\\document_loader\\DocumentLoaderPluginManager\n   */\n  protected DocumentLoaderPluginManager $loaderManager;\n\n  /**\n   * The document loader type plugin manager.\n   *\n   * @var \\Drupal\\document_loader\\DocumentLoaderTypePluginManager\n   */\n  protected DocumentLoaderTypePluginManager $typeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->loaderManager = $container->get('plugin.manager.document_loader');\n    $instance->typeManager = $container->get('plugin.manager.document_loader_type');\n    return $instance;\n  }\n\n  /**\n   * Gets the names of editable configuration objects.\n   *\n   * @return string[]\n   *   An array of editable configuration object names.\n   */\n  protected function getEditableConfigNames(): array {\n    return ['document_loader.settings'];\n  }\n\n  /**\n   * Gets the unique string identifying the form.\n   *\n   * @return string\n   *   The unique string identifying the form.\n   */\n  public function getFormId(): string {\n    return 'document_loader_settings_form';\n  }\n\n  /**\n   * Builds the document loader settings form.\n   *\n   * @param array<string, mixed> $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return array<mixed>\n   *   The form array.\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('document_loader.settings');\n    $default_loaders = $config->get('default_loaders') ?? [];\n\n    $form['#tree'] = TRUE;\n    $form['default_loaders'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Default Document Loaders'),\n      '#description' => $this->t('Set default document loader plugins for each document loader type.'),\n    ];\n\n    // Get all document loader types.\n    $loader_types = $this->typeManager->getDefinitions();\n    $loader_definitions = $this->loaderManager->getDefinitions();\n\n    foreach ($loader_types as $type_id => $type_definition) {\n      // Build options for loaders that support this type.\n      $options = [];\n      foreach ($loader_definitions as $loader_id => $loader_definition) {\n        if (in_array($type_id, $loader_definition['document_loader_types'] ?? [])) {\n          $options[$loader_id] = $loader_definition['label'];\n        }\n      }\n\n      if (empty($options)) {\n        continue;\n      }\n\n      $form['default_loaders'][$type_id] = [\n        '#type' => 'select',\n        '#title' => $type_definition['label'],\n        '#options' => $options,\n        '#default_value' => $default_loaders[$type_id] ?? '',\n        '#empty_option' => $this->t('- None -'),\n        '#description' => $type_definition['description'] ?? '',\n      ];\n    }\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * Submits the document loader settings form.\n   *\n   * @param array<mixed> $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $config = $this->configFactory->getEditable('document_loader.settings');\n\n    $default_loaders = $form_state->getValue('default_loaders', []);\n    // Remove empty values.\n    $default_loaders = array_filter($default_loaders);\n\n    $config->set('default_loaders', $default_loaders)->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/document_loader/src/Form/DocumentLoaderSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DocumentLoaderSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface DecimalInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Type;\n\nuse Drupal\\Core\\TypedData\\PrimitiveInterface;\n\n/**\n * Interface for decimal numbers.\n *\n * The plain value of a decimal is a PHP string. For setting the value\n * any PHP variable that casts to an numeric string may be passed.\n *\n * @ingroup typed_data\n */\ninterface DecimalInterface extends PrimitiveInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Type/DecimalInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DecimalInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SectionComponentBuildRenderArrayEvent in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Event;\n\nuse Drupal\\Core\\Cache\\CacheableResponseTrait;\nuse Drupal\\Core\\Plugin\\PreviewAwarePluginInterface;\nuse Drupal\\layout_builder\\SectionComponent;\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Event fired when a section component's render array is being built.\n *\n * Subscribers to this event should manipulate the cacheability object and the\n * build array in this event.\n *\n * @see \\Drupal\\layout_builder\\LayoutBuilderEvents::SECTION_COMPONENT_BUILD_RENDER_ARRAY\n */\nclass SectionComponentBuildRenderArrayEvent extends Event {\n\n  use CacheableResponseTrait;\n\n  /**\n   * The section component whose render array is being built.\n   *\n   * @var \\Drupal\\layout_builder\\SectionComponent\n   */\n  protected $component;\n\n  /**\n   * The available contexts.\n   *\n   * @var \\Drupal\\Core\\Plugin\\Context\\ContextInterface[]\n   */\n  protected $contexts;\n\n  /**\n   * The plugin for the section component being built.\n   *\n   * @var \\Drupal\\Component\\Plugin\\PluginInspectionInterface\n   */\n  protected $plugin;\n\n  /**\n   * Whether the component is in preview mode or not.\n   *\n   * @var bool\n   */\n  protected $inPreview;\n\n  /**\n   * The render array built by the event subscribers.\n   *\n   * @var array\n   */\n  protected $build = [];\n\n  /**\n   * Creates a new SectionComponentBuildRenderArrayEvent object.\n   *\n   * @param \\Drupal\\layout_builder\\SectionComponent $component\n   *   The section component whose render array is being built.\n   * @param \\Drupal\\Core\\Plugin\\Context\\ContextInterface[] $contexts\n   *   The available contexts.\n   * @param bool $in_preview\n   *   (optional) Whether the component is in preview mode or not.\n   */\n  public function __construct(SectionComponent $component, array $contexts, $in_preview = FALSE) {\n    $this->component = $component;\n    $this->contexts = $contexts;\n    $this->plugin = $component->getPlugin($contexts);\n    $this->inPreview = $in_preview;\n\n    if ($this->plugin instanceof PreviewAwarePluginInterface) {\n      $this->plugin->setInPreview($in_preview);\n    }\n  }\n\n  /**\n   * Get the section component whose render array is being built.\n   *\n   * @return \\Drupal\\layout_builder\\SectionComponent\n   *   The section component whose render array is being built.\n   */\n  public function getComponent() {\n    return $this->component;\n  }\n\n  /**\n   * Get the available contexts.\n   *\n   * @return array|\\Drupal\\Core\\Plugin\\Context\\ContextInterface[]\n   *   The available contexts.\n   */\n  public function getContexts() {\n    return $this->contexts;\n  }\n\n  /**\n   * Get the plugin for the section component being built.\n   *\n   * @return \\Drupal\\Component\\Plugin\\PluginInspectionInterface\n   *   The plugin for the section component being built.\n   */\n  public function getPlugin() {\n    return $this->plugin;\n  }\n\n  /**\n   * Determine if the component is in preview mode.\n   *\n   * @return bool\n   *   Whether the component is in preview mode or not.\n   */\n  public function inPreview() {\n    return $this->inPreview;\n  }\n\n  /**\n   * Get the render array in its current state.\n   *\n   * @return array\n   *   The render array built by the event subscribers.\n   */\n  public function getBuild() {\n    return $this->build;\n  }\n\n  /**\n   * Set the render array.\n   *\n   * @param array $build\n   *   A render array.\n   */\n  public function setBuild(array $build) {\n    $this->build = $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Event/SectionComponentBuildRenderArrayEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SectionComponentBuildRenderArrayEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Extending and modifying your site functionality'\ntop_level: true\n---\n<h2>{% trans %}What is a module?{% endtrans %}</h2>\n<p>{% trans %}A <em>module</em> is a set of PHP, JavaScript, and/or CSS files that extends site features and adds functionality. A set of <em>Core modules</em> is distributed as part of the core software download. Additional <em>Contributed modules</em> can be downloaded separately from the <a href=\"https://www.drupal.org/project/project_module\">Download &amp; Extend page on drupal.org</a>.{% endtrans %}</p>\n<h2>{% trans %}What is an Experimental module?{% endtrans %}</h2>\n<p>{% trans %}An <em>Experimental</em> module is a module that is still in development and is not yet stable. Using Experimental modules on production sites is not recommended.{% endtrans %}</p>\n<h2>{% trans %}What are installing and uninstalling?{% endtrans %}</h2>\n<p>{% trans %}Installing a core or downloaded contributed module means turning it on, so that you can use its features and functionality. Uninstalling means turning it off and removing all of its configuration. A module cannot be uninstalled if another installed module depends on it, or if you have created content on your site using the module -- you would need to delete the content and uninstall dependent modules first.{% endtrans %}</p>\n<h2>{% trans %}Extending overview{% endtrans %}</h2>\n<p>{% trans %}See the related topics listed below for help performing tasks related to extending the functionality of your site.{% endtrans %}</p>\n<h2>{% trans %}Additional resources{% endtrans %}</h2>\n<ul>\n    <li>{% trans %}<a href=\"https://www.drupal.org/docs/user_guide/en/understanding-modules.html\">Concept: Modules (Drupal User Guide)</a>{% endtrans %}</li>\n    <li>{% trans %}<a href=\"https://www.drupal.org/docs/user_guide/en/extend-chapter.html\">Extending and Customizing Your Site (Drupal User Guide)</a>{% endtrans %}</li>\n</ul>\n", "metadata": {"source": "repos/drupal_core/core/modules/help/help_topics/core.extending.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - block_content.type.basic\n    - field.field.block_content.basic.field_body\n  module:\n    - text\nid: block_content.basic.default\ntargetEntityType: block_content\nbundle: basic\nmode: default\ncontent:\n  field_body:\n    type: text_default\n    label: hidden\n    settings: {  }\n    third_party_settings: {  }\n    weight: 0\n    region: content\nhidden:\n  langcode: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_view_display.block_content.basic.default.yml", "type": "yaml_reference", "topic": "core.entity view display.block content.basic.default"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Truncate\nSource file: <source_file>\nFile name hint: Truncate.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\pgsql\\Driver\\Database\\pgsql;\n\nuse Drupal\\Core\\Database\\Query\\Truncate as QueryTruncate;\n\n/**\n * PostgreSQL implementation of \\Drupal\\Core\\Database\\Query\\Truncate.\n */\nclass Truncate extends QueryTruncate {\n\n  /**\n   * {@inheritdoc}\n   */\n  function execute() {\n    $this->connection->addSavepoint();\n    try {\n      $result = parent::execute();\n    }\n    catch (\\Exception $e) {\n      $this->connection->rollbackSavepoint();\n      throw $e;\n    }\n    $this->connection->releaseSavepoint();\n\n    return $result;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\pgsql\\Driver\\Database\\pgsql;\n\nuse Drupal\\Core\\Database\\Query\\Truncate as QueryTruncate;\n\n/**\n * PostgreSQL implementation of \\Drupal\\Core\\Database\\Query\\Truncate.\n */\nclass Truncate extends QueryTruncate {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    $this->connection->addSavepoint();\n    try {\n      $result = parent::execute();\n    }\n    catch (\\Exception $e) {\n      $this->connection->rollbackSavepoint();\n      throw $e;\n    }\n    $this->connection->releaseSavepoint();\n\n    return $result;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/pgsql/src/Driver/Database/pgsql/Truncate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Truncate", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the interface ActionConfigEntityInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\n\n/**\n * Provides an interface defining an action entity.\n */\ninterface ActionConfigEntityInterface extends ConfigEntityInterface {\n\n  /**\n   * Returns whether or not this action is configurable.\n   *\n   * @return bool\n   *   TRUE if the action is configurable, FALSE otherwise.\n   */\n  public function isConfigurable();\n\n  /**\n   * Returns the operation type.\n   *\n   * The operation type can be NULL if no type is specified.\n   *\n   * @return string|null\n   *   The operation type, or NULL if no type is specified.\n   */\n  public function getType();\n\n  /**\n   * Returns the operation plugin.\n   *\n   * @return \\Drupal\\Core\\Action\\ActionInterface\n   *   The action plugin instance.\n   */\n  public function getPlugin();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/ActionConfigEntityInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ActionConfigEntityInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% for name,component in components %}\n  <div class=\"webprofiler__card_large\">\n    <div class=\"webprofiler__card__title\">{{ name }}</div>\n    <div class=\"webprofiler__card_content\">\n      <div><b>{{ 'Status'|t }}</b>: {{ component.status }}</div>\n      <div><b>{{ 'Path'|t }}</b>: {{ component.path }}</div>\n      <div><b>{{ 'Documentation'|t }}</b>: <pre style=\"height: 200px;overflow: scroll;border: 1px solid #ccc;\">{{ component.documentation|raw }}</pre></div>\n      <div><b>{{ 'Group'|t }}</b>: {{ component.group }}</div>\n      <div><b>{{ 'Thumbnail'|t }}</b>: {{ component.thumbnail|default('none'|t) }}</div>\n      <div><b>{{ 'Provider'|t }}</b>: {{ component.provider }}</div>\n      <div>\n        <b>{{ 'Props'|t }}</b>:\n        {% if component.props.properties|length %}\n          <ul>\n            {% for prop_name,prop in component.props.properties %}\n              <li>{{ prop_name }}</li>\n            {% endfor %}\n          </ul>\n        {% else %}\n          {{ 'none'|t }}\n        {% endif %}\n      </div>\n      <div>\n        <b>{{ 'Slots'|t }}</b>:\n        {% if component.slots|length %}\n          <ul>\n            {% for slot_name,slot in component.slots %}\n              <li>{{ slot_name }}: {{ slot.title }}</li>\n            {% endfor %}\n          </ul>\n        {% else %}\n          {{ 'none'|t }}\n        {% endif %}\n      </div>\n      <div>\n        <b> {{ 'Assets'|t }}</b>:\n        {% if component.library %}\n          <ul>\n            {% for css in component.library.css %}\n              {% for css_group,css_data in css %}\n                <li>{{ css_group }}</li>\n              {% endfor %}\n            {% endfor %}\n            {% for js_name,js in component.library.js %}\n              <li>{{ js_name }}</li>\n            {% endfor %}\n          </ul>\n        {% else %}\n          {{ 'none'|t }}\n        {% endif %}\n      </div>\n    </div>\n  </div>\n{% endfor %}\n", "metadata": {"source": "repos/webprofiler/templates/Profiler/components.html.twig", "type": "twig_reference"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ApiResponseEvent.php\nTarget symbol: class ApiResponseEvent\nNamespace: Drupal\\api_normalization\\Event\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ApiResponseEvent.\n- Include required imports:\n  - Drupal\\Component\\EventDispatcher\\Event\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getEndpoint()\n  - getProvider()\n  - getRequestData()\n  - getResponseData()\n  - getResponseTime()\n  - getStatusCode()\n  - isSuccessful()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Event;\n\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Event fired when an API response is received.\n */\nclass ApiResponseEvent extends Event {\n\n  /**\n   * Event name for successful API response.\n   */\n  const RESPONSE_RECEIVED = 'api_normalization.response_received';\n\n  /**\n   * Event name for API request failure.\n   */\n  const REQUEST_FAILED = 'api_normalization.request_failed';\n\n  /**\n   * Constructs an ApiResponseEvent object.\n   */\n  public function __construct(\n    protected string $provider,\n    protected int $statusCode,\n    protected array $responseData,\n    protected string $endpoint,\n    protected ?array $requestData = NULL,\n    protected ?float $responseTime = NULL,\n  ) {}\n\n  /**\n   * Gets the API provider name.\n   */\n  public function getProvider(): string {\n    return $this->provider;\n  }\n\n  /**\n   * Gets the HTTP status code.\n   */\n  public function getStatusCode(): int {\n    return $this->statusCode;\n  }\n\n  /**\n   * Gets the response data.\n   */\n  public function getResponseData(): array {\n    return $this->responseData;\n  }\n\n  /**\n   * Gets the API endpoint.\n   */\n  public function getEndpoint(): string {\n    return $this->endpoint;\n  }\n\n  /**\n   * Gets the request data.\n   */\n  public function getRequestData(): ?array {\n    return $this->requestData;\n  }\n\n  /**\n   * Gets the response time in seconds.\n   */\n  public function getResponseTime(): ?float {\n    return $this->responseTime;\n  }\n\n  /**\n   * Checks if the response was successful.\n   */\n  public function isSuccessful(): bool {\n    return $this->statusCode >= 200 && $this->statusCode < 300;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Event/ApiResponseEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiResponseEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: FlowDrop Node Type Module", "input": "", "output": "# FlowDrop Node Type Module\n\nThe `flowdrop_node_type` module is a core component of the FlowDrop system that provides configurable node type definitions for workflow nodes. It serves as the foundation for creating, managing, and organizing different types of nodes that can be used in FlowDrop workflows.\n\n## Goals\n\n| Goal ID | Description |\n|---------|-------------|\n| FNT_G1 | Provide configurable node type definitions for workflow nodes |\n| FNT_G2 | Enable site builders to create custom node types without coding |\n| FNT_G3 | Provide categorization and organization of node types |\n\n## Overview\n\nThe FlowDrop Node Type module provides:\n\n- **Node Type Entity Management**: Config entity for storing node type definitions\n- **Dynamic Configuration**: Schema-driven configuration forms for node types\n- **Category Organization**: Categorization system for organizing node types\n- **Plugin Integration**: Integration with node processor plugins\n\n## Dependencies\n\nThe module depends on:\n\n- `flowdrop` (main module)\n- `flowdrop_node_category` (for node categorization)\n\n## Entity Structure\n\n### FlowDrop Node Type Entity\n\nThe node type entity is a configuration entity that stores node type definitions with the following properties:\n\n#### **Core Properties**\n\n- **`id`**: Unique identifier for the node type\n- **`label`**: Human-readable name for the node type\n- **`description`**: Detailed description of the node type functionality\n- **`enabled`**: Whether the node type is enabled/disabled\n\n#### **Visual Properties**\n\n- **`category`**: Category for organizing node types (e.g., \"processing\", \"input\", \"output\")\n- **`icon`**: Icon identifier for visual representation (e.g., \"mdi:cog\", \"mdi:database\")\n- **`color`**: Color code for visual styling (e.g., \"#007cba\", \"#ff6b6b\")\n\n## Choosing Icons\n\nFlowDrop uses **[Material Design Icons (MDI)](https://pictogrammers.com/library/mdi/)** for node type icons. Icons are specified using the `mdi:` prefix followed by the icon name.\n\n### Icon Format\n\n```\nmdi:<icon-name>\n```\n\n**Examples:**\n\n- `mdi:cog` - Settings/configuration\n- `mdi:database` - Data storage\n- `mdi:robot` - AI/automation\n- `mdi:code-tags` - Code/programming\n\n### Finding Icons\n\n1. **Browse the library**: Visit [pictogrammers.com/library/mdi](https://pictogrammers.com/library/mdi/)\n2. **Search by keyword**: Use the search box to find icons by name or concept\n3. **Copy the name**: Click an icon to see its name (e.g., \"account-circle\")\n4. **Use in FlowDrop**: Prefix with `mdi:` (e.g., `mdi:account-circle`)\n\n### Recommended Icons by Category\n\n| Category | Recommended Icons |\n|----------|-------------------|\n| **Input/Output** | `mdi:import`, `mdi:export`, `mdi:keyboard`, `mdi:monitor`, `mdi:file-document` |\n| **AI/Models** | `mdi:robot`, `mdi:brain`, `mdi:creation`, `mdi:head-cog`, `mdi:chat` |\n| **Data Processing** | `mdi:cog`, `mdi:filter`, `mdi:swap-horizontal`, `mdi:merge`, `mdi:source-branch` |\n| **Storage** | `mdi:database`, `mdi:folder`, `mdi:content-save`, `mdi:archive` |\n| **Network/API** | `mdi:web`, `mdi:api`, `mdi:cloud`, `mdi:webhook`, `mdi:connection` |\n| **Logic/Flow** | `mdi:call-split`, `mdi:source-fork`, `mdi:repeat`, `mdi:ray-start-arrow` |\n| **Text** | `mdi:text`, `mdi:format-text`, `mdi:script-text`, `mdi:regex` |\n| **Math** | `mdi:calculator`, `mdi:function`, `mdi:sigma`, `mdi:percent` |\n| **Time** | `mdi:clock`, `mdi:timer`, `mdi:calendar`, `mdi:history` |\n| **Utilities** | `mdi:tools`, `mdi:wrench`, `mdi:hammer`, `mdi:lightning-bolt` |\n\n### Tips for Choosing Icons\n\n1. **Be descriptive**: Choose icons that clearly represent the node's function\n2. **Stay consistent**: Use similar icons for related node types\n3. **Check visibility**: Ensure the icon is recognizable at small sizes (16-24px)\n4. **Avoid confusion**: Don't use the same icon for different purposes\n\n#### **Configuration Properties**\n\n- **`version`**: Version string for the node type\n- **`config`**: Configuration schema and default values\n- **`tags`**: Array of tags for search and filtering\n- **`executor_plugin`**: Plugin ID that handles node execution\n\n## Admin Interface\n\n### **Node Type Management Pages**\n\nThe module provides standard Drupal admin pages:\n\n- **List**: `/admin/structure/flowdrop-node-type` - View all node types\n- **Add**: `/admin/structure/flowdrop-node-type/add` - Create new node type\n- **Edit**: `/admin/structure/flowdrop-node-type/{id}` - Edit node type\n- **Delete**: `/admin/structure/flowdrop-node-type/{id}/delete` - Delete node type\n\n### **Dynamic Configuration Forms**\n\nThe module provides dynamic configuration forms based on plugin schemas:\n\n- **Schema-driven forms**: Automatically generated based on plugin configuration schemas\n- **Validation**: Real-time validation of configuration values\n- **AJAX updates**: Dynamic form updates based on configuration changes\n\n\n## Services\n\n### **FlowDropNodeTypeManager**\n\nThe main service for managing node types:\n", "metadata": {"source": "repos/flowdrop/docs/modules/flowdrop_node_type.md", "type": "doc_summary", "topic": "FlowDrop Node Type Module"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Chapter 2. Planning Your Site", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal User Guide](/docs/user_guide/en/index.html)\n\n* [Preface](/docs/user_guide/en/preface.html)\n* [Chapter 1. Understanding Drupal](/docs/user_guide/en/understanding-chapter.html)\n* [Chapter 2. Planning Your Site](/docs/user_guide/en/planning-chapter.html)\n* [Chapter 3. Installation](/docs/user_guide/en/installation-chapter.html)\n* [Chapter 4. Basic Site Configuration](/docs/user_guide/en/config-chapter.html)\n* [Chapter 5. Basic Page Management](/docs/user_guide/en/content-chapter.html)\n* [Chapter 6. Setting Up Content Structure](/docs/user_guide/en/content-structure-chapter.html)\n* [Chapter 7. Managing User Accounts](/docs/user_guide/en/user-chapter.html)\n* [Chapter 8. Blocks](/docs/user_guide/en/blocks-chapter.html)\n* [Chapter 9. Creating Listings with Views](/docs/user_guide/en/views-chapter.html)\n* [Chapter 10. Making Your Site Multilingual](/docs/user_guide/en/multilingual-chapter.html)\n* [Chapter 11. Extending and Customizing Your Site](/docs/user_guide/en/extend-chapter.html)\n* [Chapter 12. Preventing and Fixing Problems](/docs/user_guide/en/prevent-chapter.html)\n* [Chapter 13. Security and Maintenance](/docs/user_guide/en/security-chapter.html)\n* [Chapter 14. Final Thoughts](/docs/user_guide/en/thoughts-chapter.html)\n* [Glossary](/docs/user_guide/en/glossary.html)\n* [Index](/docs/user_guide/en/_index.html)\n* [Appendix A. Appendix](/docs/user_guide/en/appendix.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/planning-chapter.html \"Cap\u00edtol 2. Planificaci\u00f3 del vostre lloc\")\n* [Magyar](/hu/docs/user_guide/hu/planning-chapter.html \"2. fejezet - Tervez\u00e9s\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/planning-chapter.html \"Cap\u00edtulo 2. Planificaci\u00f3n de un sitio web\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/planning-chapter.html \"\u0420\u043e\u0437\u0434\u0456\u043b 2. \u041f\u043b\u0430\u043d\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0430\u0439\u0442\u0443\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/planning-chapter.html \"\u7b2c 2 \u7ae0 \u89c4\u5212\u60a8\u7684\u7ad9\u70b9\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/planning-chapter.html \"Chapitre 2. Pr\u00e9parer votre site\")\n* [Deutsch](/de/docs/user_guide/de/planning-chapter.html \"Kapitel 2. Planen Sie Ihre Website\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/planning-chapter.html \"\u0641\u0635\u0644 2. \u0637\u0631\u0627\u062d\u06cc \u0633\u0627\u06cc\u062a\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/planning-chapter.html \"Bab 2. Merencanakan Situs Anda\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/planning-chapter.html \"\u7b2c2\u7ae0 \u3042\u306a\u305f\u306e\u30b5\u30a4\u30c8\u3092\u8a08\u753b\u3059\u308b\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/planning-chapter.html \"Cap\u00edtulo 2. Planning Your Site\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/planning-chapter.html \"\u0413\u043b\u0430\u0432\u0430 2. \u041f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0430\u0439\u0442\u0430\")\n\n# Chapter 2. Planning Your Site\n\n## [2.1. Concept: Regions in a Theme](/docs/user_guide/en/block-regions.html)\n\nOverview of regions from a theming perspective.\n\n## [2.2. Planning Your Site Layout](/docs/user_guide/en/planning-layout.html)\n\nHow to plan the navigation and layout of a website (mobile and desktop\nbrowsers).\n\n## [2.3. Concept: Content Entities and Fields](/docs/user_guide/en/planning-data-types.html)\n\nOverview of content entities and fields.\n\n## [2.4. Concept: Modular Content](/docs/user_guide/en/planning-modular.html)\n\nOverview of modular content and how content in a page can be sourced from other\ncontent items.\n\n## [2.5. Planning your Content Structure](/docs/user_guide/en/planning-structure.html)\n\nHow to plan a content structure that assigns content entity types to specific\ncontent on the website.\n\n## [2.6. Concept: Editorial Workflow](/docs/user_guide/en/planning-workflow.html)\n\nOverview of the editorial workflow to manage content on a website.\n\n## [2.7. Concept: User Interface, Configuration, and Content translation](/docs/user_guide/en/language-concept.html)\n\nOverview of languages and translation on a site.\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: guide.asciidoc\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/planning-chapter.md", "type": "doc_summary", "topic": "Chapter 2. Planning Your Site"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  _defaults:\n    autoconfigure: true\n\n  # Grid Provider Manager\n  eb_ui.grid_provider_manager:\n    class: Drupal\\eb_ui\\Service\\GridProviderManager\n    arguments:\n      - '@module_handler'\n      - '@config.factory'\n\n  # Interface alias for autowiring\n  Drupal\\eb_ui\\Service\\GridProviderManagerInterface: '@eb_ui.grid_provider_manager'\n\n  # Access checker for definition edit routes (Tier 1 permissions)\n  eb_ui.definition_edit_access:\n    class: Drupal\\eb_ui\\Access\\DefinitionEditAccess\n    arguments:\n      - '@entity_type.manager'\n    tags:\n      - { name: access_check, applies_to: _eb_definition_edit_access }\n", "metadata": {"source": "repos/eb/modules/eb_ui/eb_ui.services.yml", "type": "yaml_reference", "topic": "eb ui.services"}}
{"instruction": "Show me the implementation of the class ScaleAndCrop in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Plugin\\ImageToolkit\\Operation\\gd;\n\nuse Drupal\\Core\\ImageToolkit\\Attribute\\ImageToolkitOperation;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines GD2 Scale and crop operation.\n */\n#[ImageToolkitOperation(\n  id: \"gd_scale_and_crop\",\n  toolkit: \"gd\",\n  operation: \"scale_and_crop\",\n  label: new TranslatableMarkup(\"Scale and crop\"),\n  description: new TranslatableMarkup(\"Scales an image to the exact width and height given. This plugin achieves the target aspect ratio by cropping the original image equally on both sides, or equally on the top and bottom. This function is useful to create uniform sized avatars from larger images.\")\n)]\nclass ScaleAndCrop extends GDImageToolkitOperationBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function arguments() {\n    return [\n      'x' => [\n        'description' => 'The horizontal offset for the start of the crop, in pixels',\n        'required' => FALSE,\n        'default' => NULL,\n      ],\n      'y' => [\n        'description' => 'The vertical offset for the start the crop, in pixels',\n        'required' => FALSE,\n        'default' => NULL,\n      ],\n      'width' => [\n        'description' => 'The target width, in pixels',\n      ],\n      'height' => [\n        'description' => 'The target height, in pixels',\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function validateArguments(array $arguments) {\n    $actualWidth = $this->getToolkit()->getWidth();\n    $actualHeight = $this->getToolkit()->getHeight();\n\n    $scaleFactor = max($arguments['width'] / $actualWidth, $arguments['height'] / $actualHeight);\n\n    $arguments['x'] = isset($arguments['x']) ?\n      (int) round($arguments['x']) :\n      (int) round(($actualWidth * $scaleFactor - $arguments['width']) / 2);\n    $arguments['y'] = isset($arguments['y']) ?\n      (int) round($arguments['y']) :\n      (int) round(($actualHeight * $scaleFactor - $arguments['height']) / 2);\n    $arguments['resize'] = [\n      'width' => (int) round($actualWidth * $scaleFactor),\n      'height' => (int) round($actualHeight * $scaleFactor),\n    ];\n\n    // Fail when width or height are 0 or negative.\n    if ($arguments['width'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid width ('{$arguments['width']}') specified for the image 'scale_and_crop' operation\");\n    }\n    if ($arguments['height'] <= 0) {\n      throw new \\InvalidArgumentException(\"Invalid height ('{$arguments['height']}') specified for the image 'scale_and_crop' operation\");\n    }\n\n    return $arguments;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function execute(array $arguments = []) {\n    return $this->getToolkit()->apply('resize', $arguments['resize'])\n        && $this->getToolkit()->apply('crop', $arguments);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/ImageToolkit/Operation/gd/ScaleAndCrop.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ScaleAndCrop", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: CreateUser.php\nTarget symbol: class CreateUser\nNamespace: Drupal\\mcp_tools_users\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CreateUser.\n- Include required imports:\n  - Drupal\\mcp_tools_users\\Service\\UserService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_users\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_users\\Service\\UserService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_create_user',\n  label: new TranslatableMarkup('Create User'),\n  description: new TranslatableMarkup('Create a new user account with optional roles and auto-generated password.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'username' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Username'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'email' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Email'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'password' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Password'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'roles' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Roles'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'status' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Active'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'uid' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('User ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'uuid' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('UUID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'username' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Username'),\n      description: new TranslatableMarkup(''),\n    ),\n    'email' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Email'),\n      description: new TranslatableMarkup(''),\n    ),\n    'status' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'roles' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Roles'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateUser extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'users';\n\n\n  protected UserService $userService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->userService = $container->get('mcp_tools_users.user');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $username = $input['username'] ?? '';\n    $email = $input['email'] ?? '';\n\n    if (empty($username) || empty($email)) {\n      return ['success' => FALSE, 'error' => 'Both username and email are required.'];\n    }\n\n    $options = [];\n    if (isset($input['password'])) {\n      $options['password'] = $input['password'];\n    }\n    if (isset($input['roles'])) {\n      $options['roles'] = $input['roles'];\n    }\n    if (isset($input['status'])) {\n      $options['status'] = (bool) $input['status'];\n    }\n\n    return $this->userService->createUser($username, $email, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_users/src/Plugin/tool/Tool/CreateUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateUser", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: wp_posts\nlabel: 'WordPress Posts'\nmigration_tags:\n  - WordPress\n  - 'WordPress Content'\nsource:\n  plugin: wp_posts\n  post_type: post\n  constants:\n    slug_prefix: '/article/'\nprocess:\n  type:\n    plugin: default_value\n    default_value: article\n  title: post_title\n  body/value:\n    plugin: wp_content_filter\n    source: post_content\n  body/summary: post_excerpt\n  body/format:\n    plugin: default_value\n    default_value: full_html\n  uid:\n    plugin: migration_lookup\n    migration: wp_users\n    source: post_author\n    no_stub: true\n    default_value: 1\n  created:\n    plugin: format_date\n    source: post_date\n    from_format: 'Y-m-d H:i:s'\n    to_format: 'U'\n  changed:\n    plugin: format_date\n    source: post_modified\n    from_format: 'Y-m-d H:i:s'\n    to_format: 'U'\n  status:\n    plugin: static_map\n    source: post_status\n    map:\n      publish: 1\n      draft: 0\n      pending: 0\n      private: 0\n    default_value: 0\n  # Map categories to taxonomy terms.\n  field_categories:\n    plugin: sub_process\n    source: categories\n    process:\n      target_id:\n        plugin: migration_lookup\n        migration: wp_categories\n        source: '0'\n  # Map tags to taxonomy terms.\n  field_tags:\n    plugin: sub_process\n    source: tags\n    process:\n      target_id:\n        plugin: migration_lookup\n        migration: wp_tags\n        source: '0'\n  # Map featured image (optional - skipped if no media or media migration skipped).\n  field_image:\n    -\n      plugin: skip_on_empty\n      source: featured_image_id\n      method: process\n    -\n      plugin: migration_lookup\n      migration: wp_media\n      no_stub: true\n  # Map WordPress slug to path alias.\n  path/alias:\n    -\n      plugin: skip_on_empty\n      source: post_name\n      method: process\n    -\n      plugin: concat\n      source:\n        - constants/slug_prefix\n        - post_name\n  path/pathauto:\n    plugin: default_value\n    default_value: 0\ndestination:\n  plugin: entity:node\nmigration_dependencies:\n  required:\n    - wp_users\n    - wp_categories\n    - wp_tags\n  optional:\n    - wp_media\n", "metadata": {"source": "repos/wp_drupal_migrate/migrations/wp_posts.yml", "type": "yaml_reference", "topic": "wp posts"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Appendix A. Appendix", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal User Guide](/docs/user_guide/en/index.html)\n\n* [Preface](/docs/user_guide/en/preface.html)\n* [Chapter 1. Understanding Drupal](/docs/user_guide/en/understanding-chapter.html)\n* [Chapter 2. Planning Your Site](/docs/user_guide/en/planning-chapter.html)\n* [Chapter 3. Installation](/docs/user_guide/en/installation-chapter.html)\n* [Chapter 4. Basic Site Configuration](/docs/user_guide/en/config-chapter.html)\n* [Chapter 5. Basic Page Management](/docs/user_guide/en/content-chapter.html)\n* [Chapter 6. Setting Up Content Structure](/docs/user_guide/en/content-structure-chapter.html)\n* [Chapter 7. Managing User Accounts](/docs/user_guide/en/user-chapter.html)\n* [Chapter 8. Blocks](/docs/user_guide/en/blocks-chapter.html)\n* [Chapter 9. Creating Listings with Views](/docs/user_guide/en/views-chapter.html)\n* [Chapter 10. Making Your Site Multilingual](/docs/user_guide/en/multilingual-chapter.html)\n* [Chapter 11. Extending and Customizing Your Site](/docs/user_guide/en/extend-chapter.html)\n* [Chapter 12. Preventing and Fixing Problems](/docs/user_guide/en/prevent-chapter.html)\n* [Chapter 13. Security and Maintenance](/docs/user_guide/en/security-chapter.html)\n* [Chapter 14. Final Thoughts](/docs/user_guide/en/thoughts-chapter.html)\n* [Glossary](/docs/user_guide/en/glossary.html)\n* [Index](/docs/user_guide/en/_index.html)\n* [Appendix A. Appendix](/docs/user_guide/en/appendix.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/appendix.html \"Ap\u00e8ndix A. Ap\u00e8ndix\")\n* [Magyar](/hu/docs/user_guide/hu/appendix.html \"A. f\u00fcggel\u00e9k - K\u00f6zrem\u0171k\u00f6d\u0151k\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/appendix.html \"Ap\u00e9ndice A. Ap\u00e9ndice\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/appendix.html \"\u0414\u043e\u0434\u0430\u0442\u043e\u043a A. \u0414\u043e\u0434\u0430\u0442\u043e\u043a\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/appendix.html \"\u9644\u5f55 A. Appendix\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/appendix.html \"Annexe A. Annexe\")\n* [Deutsch](/de/docs/user_guide/de/appendix.html \"Anhang A. Anhang\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/appendix.html \"\u067e\u064a\u0648\u0633\u062a A. \u0636\u0645\u06cc\u0645\u0647\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/appendix.html \"Lampiran A. Lampiran\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/appendix.html \"\u4ed8\u9332A \u4ed8\u9332\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/appendix.html \"Ap\u00eandice A. Appendix\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/appendix.html \"\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 A. \u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f\")\n\n# Appendix A. Appendix\n\n## [A.1. Guide-Wide Attributions](/docs/user_guide/en/attributions.html)\n\nList of contributors involved in project management and guide-wide\nwriting/editing tasks.\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: guide.asciidoc\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/appendix.md", "type": "doc_summary", "topic": "Appendix A. Appendix"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - core.entity_view_mode.media.scale_crop_7_3_large\n    - field.field.media.image.field_media_image\n    - media.type.image\n    - responsive_image.styles.hero\n  module:\n    - layout_builder\n    - responsive_image\nthird_party_settings:\n  layout_builder:\n    enabled: false\n    allow_custom: false\nid: media.image.scale_crop_7_3_large\ntargetEntityType: media\nbundle: image\nmode: scale_crop_7_3_large\ncontent:\n  field_media_image:\n    type: responsive_image\n    label: hidden\n    settings:\n      responsive_image_style: hero\n      image_link: ''\n      image_loading:\n        attribute: eager\n    third_party_settings: {  }\n    weight: 1\n    region: content\nhidden:\n  created: true\n  langcode: true\n  name: true\n  thumbnail: true\n  uid: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_view_display.media.image.scale_crop_7_3_large.yml", "type": "yaml_reference", "topic": "core.entity view display.media.image.scale crop 7 3 large"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: FlowDropEventTypeBase.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\n\n/**\n * Base class for FlowDrop Event Type plugins.\n *\n * Provides default implementations for common functionality.\n * Concrete event type plugins should extend this class.\n */\nabstract class FlowDropEventTypeBase extends PluginBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEventId(): string {\n    return $this->getPluginId();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLabel(): string {\n    $definition = $this->getPluginDefinition();\n    $label = $definition[\"label\"] ?? $this->getPluginId();\n    return (string) $label;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    $definition = $this->getPluginDefinition();\n    $description = $definition[\"description\"] ?? \"\";\n    return (string) $description;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"category\"] ?? \"entity\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultOrchestrator(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"defaultOrchestrator\"] ?? \"flowdrop_runtime:asynchronous\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultExecutionMode(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"defaultExecutionMode\"] ?? \"async\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedEntityTypes(): array {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"supportedEntityTypes\"] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsEntityType(string $entityType): bool {\n    $supportedTypes = $this->getSupportedEntityTypes();\n\n    // Empty array means all entity types are supported.\n    if (empty($supportedTypes)) {\n      return TRUE;\n    }\n\n    return in_array($entityType, $supportedTypes, TRUE);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"entity_types\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Entity Types\",\n          \"description\" => \"Entity types to trigger on (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n        \"bundles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Bundles\",\n          \"description\" => \"Bundles to trigger on (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Get base trigger data common to all event types.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity involved in the event.\n   *", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\n\n/**\n * Base class for FlowDrop Event Type plugins.\n *\n * Provides default implementations for common functionality.\n * Concrete event type plugins should extend this class.\n */\nabstract class FlowDropEventTypeBase extends PluginBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEventId(): string {\n    return $this->getPluginId();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLabel(): string {\n    $definition = $this->getPluginDefinition();\n    $label = $definition[\"label\"] ?? $this->getPluginId();\n    return (string) $label;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    $definition = $this->getPluginDefinition();\n    $description = $definition[\"description\"] ?? \"\";\n    return (string) $description;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"category\"] ?? \"entity\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultOrchestrator(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"defaultOrchestrator\"] ?? \"flowdrop_runtime:asynchronous\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefaultExecutionMode(): string {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"defaultExecutionMode\"] ?? \"async\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedEntityTypes(): array {\n    $definition = $this->getPluginDefinition();\n    return $definition[\"supportedEntityTypes\"] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsEntityType(string $entityType): bool {\n    $supportedTypes = $this->getSupportedEntityTypes();\n\n    // Empty array means all entity types are supported.\n    if (empty($supportedTypes)) {\n      return TRUE;\n    }\n\n    return in_array($entityType, $supportedTypes, TRUE);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"entity_types\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Entity Types\",\n          \"description\" => \"Entity types to trigger on (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n        \"bundles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Bundles\",\n          \"description\" => \"Bundles to trigger on (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Get base trigger data common to all event types.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity involved in the event.\n   *\n   * @return array\n   *   Base trigger data.\n   */\n  protected function getBaseTriggerData(EntityInterface $entity): array {\n    return [\n      \"event_type\" => $this->getEventId(),\n      \"entity_type\" => $entity->getEntityTypeId(),\n      \"entity_id\" => $entity->id(),\n      \"bundle\" => $entity->bundle(),\n      \"label\" => $entity->label(),\n      \"uuid\" => $entity->uuid(),\n      \"langcode\" => $entity->language()->getId(),\n      \"timestamp\" => time(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventTypeBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropEventTypeBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class EntityViewMode in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ConfigEntityType;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Entity\\EntityDisplayModeBase;\nuse Drupal\\Core\\Entity\\EntityViewModeInterface;\n\n/**\n * Defines the entity view mode configuration entity class.\n *\n * View modes let entities be displayed differently depending on the context.\n * For instance, a node can be displayed differently on its own page ('full'\n * mode), on the home page or taxonomy listings ('teaser' mode), or in an RSS\n * feed ('rss' mode). Modules taking part in the display of the entity (notably\n * the Field API) can adjust their behavior depending on the requested view\n * mode. An additional 'default' view mode is available for all entity types.\n * This view mode is not intended for actual entity display, but holds default\n * display settings. For each available view mode, administrators can configure\n * whether it should use its own set of field display settings, or just\n * replicate the settings of the 'default' view mode, thus reducing the amount\n * of display configurations to keep track of.\n *\n * @see \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface::getAllViewModes()\n * @see \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface::getViewModes()\n * @see hook_entity_view_mode_info_alter()\n */\n#[ConfigEntityType(\n  id: 'entity_view_mode',\n  label: new TranslatableMarkup('View mode'),\n  entity_keys: [\n    'id' => 'id',\n    'label' => 'label',\n    'description' => 'description',\n  ],\n  constraints: [\n    'ImmutableProperties' => [\n      'properties' => [\n        'id',\n        'targetEntityType',\n      ],\n    ],\n  ],\n  config_export: [\n    'id',\n    'label',\n    'description',\n    'targetEntityType',\n    'cache',\n  ],\n  )]\nclass EntityViewMode extends EntityDisplayModeBase implements EntityViewModeInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Entity/EntityViewMode.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityViewMode", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ListThemes in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_theme\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_theme\\Service\\ThemeService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_theme_list',\n  label: new TranslatableMarkup('List Themes'),\n  description: new TranslatableMarkup('List all installed themes. Optionally include uninstalled themes.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'include_uninstalled' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Include Uninstalled'),\n      description: new TranslatableMarkup('Include themes that are available but not installed'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'themes' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Themes'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Themes'),\n      description: new TranslatableMarkup(''),\n    ),\n    'default_theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Default Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'admin_theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Admin Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListThemes extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'theme';\n\n\n  protected ThemeService $themeService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->themeService = $container->get('mcp_tools_theme.theme');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $includeUninstalled = (bool) ($input['include_uninstalled'] ?? FALSE);\n    return $this->themeService->listThemes($includeUninstalled);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_theme/src/Plugin/tool/Tool/ListThemes.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListThemes", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LayoutBuilderEntityViewDisplayForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder_entity_view\\Form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Menu\\LocalTaskManager;\nuse Drupal\\Core\\Routing\\RouteBuilderInterface;\nuse Drupal\\display_builder\\ConfigFormBuilderInterface;\nuse Drupal\\layout_builder\\Form\\LayoutBuilderEntityViewDisplayForm as CoreLayoutBuilderEntityViewDisplayForm;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Edit form for the entity view display entity type.\n *\n * @internal\n *   Form classes are internal.\n */\nfinal class LayoutBuilderEntityViewDisplayForm extends CoreLayoutBuilderEntityViewDisplayForm {\n\n  use EntityViewDisplayFormTrait;\n\n  /**\n   * The entity being used by this form.\n   *\n   * @var \\Drupal\\display_builder_entity_view\\Entity\\LayoutBuilderEntityViewDisplay\n   */\n  protected $entity;\n\n  /**\n   * The config form builder for Display Builder.\n   */\n  protected ConfigFormBuilderInterface $configFormBuilder;\n\n  /**\n   * The local task manager.\n   */\n  protected LocalTaskManager $localTaskManager;\n\n  /**\n   * The router builder.\n   */\n  protected RouteBuilderInterface $routeBuilder;\n\n  /**\n   * {@inheritDoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->configFormBuilder = $container->get('display_builder.config_form_builder');\n    $instance->entityTypeManager = $container->get('entity_type.manager');\n    $instance->localTaskManager = $container->get('plugin.manager.menu.local_task');\n    $instance->routeBuilder = $container->get('router.builder');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state): array {\n    $form = parent::form($form, $form_state);\n    $form = $this->entityViewDisplayForm($form);\n\n    if (isset($form['layout'])) {\n      $form['layout']['#weight'] = 2;\n      $form['layout']['#open'] = $this->entity->isLayoutBuilderEnabled();\n    }\n\n    return $form;\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/modules/display_builder_entity_view/src/Form/LayoutBuilderEntityViewDisplayForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderEntityViewDisplayForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ConfirmViewsBuilderDeleteForm.php\nTarget symbol: class ConfirmViewsBuilderDeleteForm\nNamespace: Drupal\\display_builder_views\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ConfirmViewsBuilderDeleteForm.\n- Include required imports:\n  - Drupal\\Core\\DependencyInjection\\AutowireTrait\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Form\\ConfirmFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\Url\n  - Drupal\\display_builder_views\\Plugin\\views\\display_extender\\DisplayExtender\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildForm()\n  - getCancelUrl()\n  - getFormId()\n  - getQuestion()\n  - submitForm()\n  - unsetDisplayBuilder()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder_views\\Form;\n\nuse Drupal\\Core\\DependencyInjection\\AutowireTrait;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\display_builder_views\\Plugin\\views\\display_extender\\DisplayExtender;\n\n/**\n * Confirmation form to confirm deletion of display builder instance.\n */\nclass ConfirmViewsBuilderDeleteForm extends ConfirmFormBase {\n\n  use AutowireTrait;\n\n  /**\n   * Display builder id to delete.\n   */\n  private ?string $builderId;\n\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?string $builder_id = NULL): array {\n    $this->builderId = $builder_id;\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl(): Url {\n    return new Url('display_builder_views.views.collection');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'confirm_display_builder_views_delete_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion(): TranslatableMarkup {\n    return $this->t('Do you want to delete %id?', ['%id' => $this->builderId]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $storage = $this->entityTypeManager->getStorage('display_builder_instance');\n    $instance = $storage->load($this->builderId);\n    $storage->delete([$instance]);\n    $this->unsetDisplayBuilder();\n    $form_state->setRedirectUrl(new Url('display_builder_views.views.collection'));\n  }\n\n  /**\n   * Unset display builder.\n   */\n  protected function unsetDisplayBuilder(): void {\n    $view_id = DisplayExtender::checkInstanceId($this->builderId)['view'];\n    $display_id = DisplayExtender::checkInstanceId($this->builderId)['display'];\n    $view = $this->entityTypeManager->getStorage('view')->load($view_id);\n    // It is risky to alter a View like that. We need to be careful to not\n    // break the storage integrity, but we didn't find a better way.\n    $displays = $view->get('display');\n    $displays[$display_id]['display_options']['display_extenders']['display_builder']['display_builder'] = '';\n    $view->set('display', $displays);\n    $view->save();\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/src/Form/ConfirmViewsBuilderDeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfirmViewsBuilderDeleteForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  display_builder.htmx_events:\n    class: Drupal\\display_builder\\HtmxEvents\n    arguments: []\n\n  plugin.manager.db_island:\n    class: Drupal\\display_builder\\IslandPluginManager\n    parent: default_plugin_manager\n  Drupal\\display_builder\\IslandPluginManagerInterface: '@plugin.manager.db_island'\n\n  display_builder.slot_sources_proxy:\n    class: Drupal\\display_builder\\SlotSourceProxy\n    arguments:\n      - '@plugin.manager.ui_patterns_source'\n\n  display_builder.config_form_builder:\n    class: Drupal\\display_builder\\ConfigFormBuilder\n    arguments:\n      - '@entity_type.manager'\n      - '@current_user'\n      - '@module_handler'\n  Drupal\\display_builder\\ConfigFormBuilderInterface: '@display_builder.config_form_builder'\n\n  display_builder.event_subscriber:\n    class: '\\Drupal\\display_builder\\Event\\DisplayBuilderEventsSubscriber'\n    arguments:\n      - '@plugin.manager.db_island'\n      - '@entity_type.manager'\n    tags:\n      - { name: 'event_subscriber' }\n", "metadata": {"source": "repos/display_builder/display_builder.services.yml", "type": "yaml_reference", "topic": "display builder.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Mautic Personalisation\ntype: module\ndescription: 'Integrates with Mautic tracking script to capture segment data and provides conditions based on Mautic segments.'\npackage: Custom\ncore_version_requirement: ^11\nconfigure: mautic_personalisation.settings\ndependencies:\n  - drupal:block\n  - drupal:system\n", "metadata": {"source": "repos/mautic_personalisation/mautic_personalisation.info.yml", "type": "yaml_reference", "topic": "mautic personalisation.info"}}
{"instruction": "Show me the implementation of the class SearchPluginBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\search\\Plugin;\n\nuse Drupal\\Core\\Cache\\RefinableCacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\RefinableCacheableDependencyTrait;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\PluginBase;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Component\\Utility\\Unicode;\n\n/**\n * Defines a base class for plugins wishing to support search.\n */\nabstract class SearchPluginBase extends PluginBase implements ContainerFactoryPluginInterface, SearchInterface, RefinableCacheableDependencyInterface {\n\n  use RefinableCacheableDependencyTrait;\n\n  /**\n   * The keywords to use in a search.\n   *\n   * @var string\n   */\n  protected $keywords;\n\n  /**\n   * Array of parameters from the query string from the request.\n   *\n   * @var array\n   */\n  protected $searchParameters;\n\n  /**\n   * Array of attributes - usually from the request object.\n   *\n   * @var array\n   */\n  protected $searchAttributes;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setSearch($keywords, array $parameters, array $attributes) {\n    $this->keywords = (string) $keywords;\n    $this->searchParameters = $parameters;\n    $this->searchAttributes = $attributes;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getKeywords() {\n    return $this->keywords;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameters() {\n    return $this->searchParameters;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAttributes() {\n    return $this->searchAttributes;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isSearchExecutable() {\n    // Default implementation suitable for plugins that only use keywords.\n    return !empty($this->keywords);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getType() {\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildResults() {\n    $results = $this->execute();\n\n    $built = [];\n    foreach ($results as $result) {\n      $built[] = [\n        '#theme' => 'search_result',\n        '#result' => $result,\n        '#plugin_id' => $this->getPluginId(),\n      ];\n    }\n\n    return $built;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function searchFormAlter(array &$form, FormStateInterface $form_state) {\n    // Empty default implementation.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function suggestedTitle() {\n    // If the user entered a search string, truncate it and append it to the\n    // title.\n    if (!empty($this->keywords)) {\n      return $this->t('Search for @keywords', ['@keywords' => Unicode::truncate($this->keywords, 60, TRUE, TRUE)]);\n    }\n    // Use the default 'Search' title.\n    return $this->t('Search');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildSearchUrlQuery(FormStateInterface $form_state) {\n    // Grab the keywords entered in the form and put them as 'keys' in the GET.\n    $keys = trim($form_state->getValue('keys'));\n    $query = ['keys' => $keys];\n\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getHelp() {\n    // This default search help is appropriate for plugins like NodeSearch\n    // that use the SearchQuery class.\n    $help = [\n      'list' => [\n        '#theme' => 'item_list',\n        '#items' => [\n          $this->t('Search looks for exact, case-insensitive keywords; keywords shorter than a minimum length are ignored.'),\n          $this->t('Use upper-case OR to get more results. Example: cat OR dog (content contains either \"cat\" or \"dog\").'),\n          $this->t('You can use upper-case AND to require all words, but this is the same as the default behavior. Example: cat AND dog (same as cat dog, content must contain both \"cat\" and \"dog\").'),\n          $this->t('Use quotes to search for a phrase. Example: \"the cat eats mice\".'),\n          $this->t('You can precede keywords by - to exclude them; you must still have at least one \"positive\" keyword. Example: cat -dog (content must contain cat and cannot contain dog).'),\n        ],\n      ],\n    ];\n\n    return $help;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesAdminTheme() {\n    return $this->pluginDefinition['use_admin_theme'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/src/Plugin/SearchPluginBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SearchPluginBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Basic\nslots:\n  image:\n    theme: image\n    uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAxLjEyNXJlbTsgdGV4dC1hbmNob3I6IG1pZGRsZTsgdXNlci1zZWxlY3Q6IG5vbmU7IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIyNTQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IEltYWdlIGNhcCI+PHRpdGxlPlBsYWNlaG9sZGVyPC90aXRsZT48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjODY4ZTk2Ij48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiNkZWUyZTYiIGR5PSIuM2VtIj5JbWFnZSBjYXA8L3RleHQ+PC9zdmc+Cg==\"\n    alt: \"&copy; 2017 John Smith photography\"\n  content:\n    - type: component\n      component: \"bootstrap_components:card_body\"\n      slots:\n        title: \"Card title\"\n        text: \"Some quick example text to build on the card title and make up the bulk of the card's content.\"\n        content:\n          type: component\n          component: \"bootstrap_components:button\"\n          slots:\n            label: \"Go somewhere\"\n          props:\n            variant: primary\n            url: \"#\"\nprops:\n  attributes:\n    style: \"width: 18rem;\"\n  variant: default\n  image_position: top\n", "metadata": {"source": "repos/bootstrap_components/components/card/stories/card.basic.story.yml", "type": "yaml_reference", "topic": "card.basic.story"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SemVer.php\nTarget symbol: class to\nNamespace: Drupal\\Composer\\Plugin\\RecipeUnpack\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for to.\n- Include required imports:\n  - Composer\\Semver\\Constraint\\MatchNoneConstraint\n  - Composer\\Semver\\Constraint\\MultiConstraint\n  - Composer\\Semver\\Intervals\n  - Composer\\Semver\\VersionParser\n- Ensure these methods exist where relevant:\n  - __construct()\n  - minimizeConstraints()", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\RecipeUnpack;\n\nuse Composer\\Semver\\Constraint\\MatchNoneConstraint;\nuse Composer\\Semver\\Constraint\\MultiConstraint;\nuse Composer\\Semver\\Intervals;\nuse Composer\\Semver\\VersionParser;\n\n/**\n * Helper class to manipulate semantic versioning constraints.\n *\n * @internal\n */\nfinal class SemVer {\n\n  private function __construct() {}\n\n  /**\n   * Minimizes two constraints.\n   *\n   * Compares two constraints and determines if one is a subset of the other. If\n   * this is the case, the constraint that is a subset is returned. For example,\n   * if called with '^6.2' and '^6.3' the function will return '^6.3'. If\n   * neither constraint is a subset then the constraints are compacted and the\n   * intersection is returned. For example, if called with \">=10.3\" and\n   * \"^10.4 || ^11\" the function will return \">=10.4.0.0-dev, <12.0.0.0-dev\".\n   *\n   * @param \\Composer\\Semver\\VersionParser $version_parser\n   *   A version parser.\n   * @param string $constraint_a\n   *   A constraint to compact.\n   * @param string $constraint_b\n   *   A constraint to compact.\n   *\n   * @return string\n   *   The compacted constraint.\n   *\n   * @throws \\LogicException\n   *   Thrown when the provided constraints have no intersection.\n   */\n  public static function minimizeConstraints(VersionParser $version_parser, string $constraint_a, string $constraint_b): string {\n    $constraint_object_a = $version_parser->parseConstraints($constraint_a);\n    $constraint_object_b = $version_parser->parseConstraints($constraint_b);\n    if (Intervals::isSubsetOf($constraint_object_a, $constraint_object_b)) {\n      return $constraint_a;\n    }\n    if (Intervals::isSubsetOf($constraint_object_b, $constraint_object_a)) {\n      return $constraint_b;\n    }\n    $constraint = Intervals::compactConstraint(new MultiConstraint([$constraint_object_a, $constraint_object_b]));\n    if ($constraint instanceof MatchNoneConstraint) {\n      throw new \\LogicException(sprintf('The constraints \"%s\" and \"%s\" do not intersect and cannot be minimized.', $constraint_a, $constraint_b));\n    }\n    return sprintf(\n      '%s%s, %s%s',\n      $constraint->getLowerBound()->isInclusive() ? '>=' : '>',\n      $constraint->getLowerBound()->getVersion(),\n      $constraint->getUpperBound()->isInclusive() ? '<=' : '<',\n      $constraint->getUpperBound()->getVersion()\n    );\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/RecipeUnpack/SemVer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SemVer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - node\n    - text\nid: node.field_body\nfield_name: field_body\nentity_type: node\ntype: text_long\nsettings: {  }\nmodule: text\nlocked: false\ncardinality: 1\ntranslatable: true\nindexes: {  }\npersist_with_no_fields: false\ncustom_storage: false\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/field.storage.node.field_body.yml", "type": "yaml_reference", "topic": "field.storage.node.field body"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ApiMappingConfigHtmlRouteProvider\nSource file: <source_file>\nFile name hint: ApiMappingConfigHtmlRouteProvider.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Provides routes for API Mapping config entities.\n */\nclass ApiMappingConfigHtmlRouteProvider extends AdminHtmlRouteProvider {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoutes(EntityTypeInterface $entity_type) {\n    $collection = parent::getRoutes($entity_type);\n\n    // Add custom routes.\n    if ($test_route = $this->getTestRoute($entity_type)) {\n      $collection->add(\"api_normalization.mapping_test\", $test_route);\n    }\n\n    if ($preview_route = $this->getPreviewRoute($entity_type)) {\n      $collection->add(\"api_normalization.mapping_preview\", $preview_route);\n    }\n\n    return $collection;\n  }\n\n  /**\n   * Gets the test route.\n   */\n  protected function getTestRoute(EntityTypeInterface $entity_type) {\n    $route = new Route('/admin/config/services/api-normalizer/mappings/{api_mapping_config}/test');\n    $route\n      ->setDefaults([\n        '_controller' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::testMapping',\n        '_title_callback' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::testTitle',\n      ])\n      ->setRequirement('_permission', 'administer api normalizer')\n      ->setOption('_admin_route', TRUE)\n      ->setOption('parameters', [\n        'api_mapping_config' => ['type' => 'entity:api_mapping_config'],\n      ]);\n\n    return $route;\n  }\n\n  /**\n   * Gets the preview route.\n   */\n  protected function getPreviewRoute(EntityTypeInterface $entity_type) {\n    $route = new Route('/admin/config/services/api-normalizer/mappings/{api_mapping_config}/preview');\n    $route\n      ->setDefaults([\n        '_controller' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::previewMapping',\n        '_title_callback' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::previewTitle',\n      ])\n      ->setRequirement('_permission', 'administer api normalizer')\n      ->setOption('_admin_route', TRUE)\n      ->setOption('parameters', [\n        'api_mapping_config' => ['type' => 'entity:api_mapping_config'],\n      ]);\n\n    return $route;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Provides routes for API Mapping config entities.\n */\nclass ApiMappingConfigHtmlRouteProvider extends AdminHtmlRouteProvider {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRoutes(EntityTypeInterface $entity_type) {\n    $collection = parent::getRoutes($entity_type);\n\n    // Add custom routes.\n    if ($test_route = $this->getTestRoute($entity_type)) {\n      $collection->add(\"api_normalization.mapping_test\", $test_route);\n    }\n\n    if ($preview_route = $this->getPreviewRoute($entity_type)) {\n      $collection->add(\"api_normalization.mapping_preview\", $preview_route);\n    }\n\n    return $collection;\n  }\n\n  /**\n   * Gets the test route.\n   */\n  protected function getTestRoute(EntityTypeInterface $entity_type) {\n    $route = new Route('/admin/config/services/api-normalizer/mappings/{api_mapping_config}/test');\n    $route\n      ->setDefaults([\n        '_controller' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::testMapping',\n        '_title_callback' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::testTitle',\n      ])\n      ->setRequirement('_permission', 'administer api normalizer')\n      ->setOption('_admin_route', TRUE)\n      ->setOption('parameters', [\n        'api_mapping_config' => ['type' => 'entity:api_mapping_config'],\n      ]);\n\n    return $route;\n  }\n\n  /**\n   * Gets the preview route.\n   */\n  protected function getPreviewRoute(EntityTypeInterface $entity_type) {\n    $route = new Route('/admin/config/services/api-normalizer/mappings/{api_mapping_config}/preview');\n    $route\n      ->setDefaults([\n        '_controller' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::previewMapping',\n        '_title_callback' => '\\Drupal\\api_normalization\\Controller\\ApiMappingController::previewTitle',\n      ])\n      ->setRequirement('_permission', 'administer api normalizer')\n      ->setOption('_admin_route', TRUE)\n      ->setOption('parameters', [\n        'api_mapping_config' => ['type' => 'entity:api_mapping_config'],\n      ]);\n\n    return $route;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Entity/ApiMappingConfigHtmlRouteProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiMappingConfigHtmlRouteProvider", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class FieldDefinitionListener in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface;\n\n/**\n * Reacts to field definition CRUD on behalf of the Entity system.\n */\nclass FieldDefinitionListener implements FieldDefinitionListenerInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The key-value factory.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface\n   */\n  protected $keyValueFactory;\n\n  /**\n   * Cache backend instance.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   */\n  protected $cacheBackend;\n\n  /**\n   * The entity field manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityFieldManagerInterface\n   */\n  protected $entityFieldManager;\n\n  /**\n   * Constructs a new FieldDefinitionListener.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $entity_field_manager\n   *   The entity field manager.\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface $key_value_factory\n   *   The key-value factory.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   The cache backend.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager, EntityFieldManagerInterface $entity_field_manager, KeyValueFactoryInterface $key_value_factory, CacheBackendInterface $cache_backend) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->entityFieldManager = $entity_field_manager;\n    $this->keyValueFactory = $key_value_factory;\n    $this->cacheBackend = $cache_backend;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onFieldDefinitionCreate(FieldDefinitionInterface $field_definition) {\n    $entity_type_id = $field_definition->getTargetEntityTypeId();\n    $bundle = $field_definition->getTargetBundle();\n    $field_name = $field_definition->getName();\n\n    // Notify the storage about the new field.\n    $this->entityTypeManager->getStorage($entity_type_id)->onFieldDefinitionCreate($field_definition);\n\n    // Update the bundle field map key value collection, add the new field.\n    $bundle_field_map = $this->keyValueFactory->get('entity.definitions.bundle_field_map')->get($entity_type_id);\n    if (!isset($bundle_field_map[$field_name])) {\n      // This field did not exist yet, initialize it with the type and empty\n      // bundle list.\n      $bundle_field_map[$field_name] = [\n        'type' => $field_definition->getType(),\n        'bundles' => [],\n      ];\n    }\n    $bundle_field_map[$field_name]['bundles'][$bundle] = $bundle;\n    $this->keyValueFactory->get('entity.definitions.bundle_field_map')->set($entity_type_id, $bundle_field_map);\n\n    // Delete the cache entry.\n    $this->cacheBackend->delete('entity_field_map');\n\n    // If the field map is initialized, update it as well, so that calls to it\n    // do not have to rebuild it again.\n    if ($field_map = $this->entityFieldManager->getFieldMap()) {\n      if (!isset($field_map[$entity_type_id][$field_name])) {\n        // This field did not exist yet, initialize it with the type and empty\n        // bundle list.\n        $field_map[$entity_type_id][$field_name] = [\n          'type' => $field_definition->getType(),\n          'bundles' => [],\n        ];\n      }\n      $field_map[$entity_type_id][$field_name]['bundles'][$bundle] = $bundle;\n      $this->entityFieldManager->setFieldMap($field_map);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onFieldDefinitionUpdate(FieldDefinitionInterface $field_definition, FieldDefinitionInterface $original) {\n    // Notify the storage about the updated field.\n    $this->entityTypeManager->getStorage($field_definition->getTargetEntityTypeId())->onFieldDefinitionUpdate($field_definition, $original);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onFieldDefinitionDelete(FieldDefinitionInterface $field_definition) {\n    $entity_type_id = $field_definition->getTargetEntityTypeId();\n    $bundle = $field_definition->getTargetBundle();\n    $field_name = $field_definition->getName();\n\n    // Notify the storage about the field deletion.\n    $this->entityTypeManager->getStorage($entity_type_id)->onFieldDefinitionDelete($field_definition);\n\n    // Unset the bundle from the bundle field map key value collection.\n    $bundle_field_map = $this->keyValueFactory->get('entity.definitions.bundle_field_map')->get($entity_type_id);\n    unset($bundle_field_map[$field_name]['bundles'][$bundle]);\n    if (empty($bundle_field_map[$field_name]['bundles'])) {\n      // If there are no bundles left, remove the field from the map.\n      unset($bundle_field_map[$field_name]);\n    }\n    $this->keyValueFactory->get('entity.definitions.bundle_field_map')->set($entity_type_id, $bundle_field_map);\n\n    // Delete the cache entry.\n    $this->cacheBackend->delete('entity_field_map');\n\n    // If the field map is initialized, update it as well, so that calls to it\n    // do not have to rebuild it again.\n    if ($field_map = $this->entityFieldManager->getFieldMap()) {\n      unset($field_map[$entity_type_id][$field_name]['bundles'][$bundle]);\n      if (empty($field_map[$entity_type_id][$field_name]['bundles'])) {\n        unset($field_map[$entity_type_id][$field_name]);\n      }\n      $this->entityFieldManager->setFieldMap($field_map);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/FieldDefinitionListener.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldDefinitionListener", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: GetModerationHistory.php\nTarget symbol: class GetModerationHistory\nNamespace: Drupal\\mcp_tools_moderation\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for GetModerationHistory.\n- Include required imports:\n  - Drupal\\mcp_tools_moderation\\Service\\ModerationService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_moderation\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_moderation\\Service\\ModerationService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_moderation_get_history',\n  label: new TranslatableMarkup('Get Moderation History'),\n  description: new TranslatableMarkup('Get revision history of an entity with moderation state changes.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: 'node',\n    ),\n    'entity_id' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Entity ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: 50,\n    ),\n  ],\n  output_definitions: [\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'entity_id' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Entity ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'workflow_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Workflow ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_revisions' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Revisions'),\n      description: new TranslatableMarkup(''),\n    ),\n    'revisions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Revisions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetModerationHistory extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'moderation';\n\n\n  protected ModerationService $moderationService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->moderationService = $container->get('mcp_tools_moderation.moderation');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? 'node';\n    $entityId = $input['entity_id'] ?? 0;\n    $limit = $input['limit'] ?? 50;\n\n    if (empty($entityId)) {\n      return ['success' => FALSE, 'error' => 'Entity ID is required.'];\n    }\n\n    return $this->moderationService->getModerationHistory($entityType, (int) $entityId, (int) $limit);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_moderation/src/Plugin/tool/Tool/GetModerationHistory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetModerationHistory", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a menu link form.\n *\n * Two-column template for the menu link add/edit form.\n *\n * This template will be used when a menu link form specifies\n * 'menu_link_form' as its #theme callback. Otherwise, by default,\n * menu_link add/edit forms will be themed by form.html.twig.\n *\n * Available variables:\n * - form: The menu link add/edit form.\n *\n * @see claro_form_menu_link_content_form_alter()\n */\n#}\n{% extends '@claro/form/form-two-columns.html.twig' %}\n{% block main %}\n  {{ form|without('advanced', 'menu_parent', 'actions') }}\n{% endblock %}\n\n{% block secondary %}\n<div class=\"entity-meta\">\n  {{ form.menu_parent }}\n  {{ form.advanced }}\n</div>\n{% endblock %}\n\n{% block footer %}\n  {{ form.actions }}\n{% endblock %}\n", "metadata": {"source": "repos/drupal_core/core/themes/claro/templates/menu-link-form.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - core.entity_view_mode.media.responsive_3x2\n  module:\n    - editor\n    - media\nname: 'Full HTML'\nformat: full_html\nweight: 2\nfilters:\n  editor_file_reference:\n    id: editor_file_reference\n    provider: editor\n    status: true\n    weight: 11\n    settings: {  }\n  filter_align:\n    id: filter_align\n    provider: filter\n    status: true\n    weight: 8\n    settings: {  }\n  filter_caption:\n    id: filter_caption\n    provider: filter\n    status: true\n    weight: 9\n    settings: {  }\n  filter_html:\n    id: filter_html\n    provider: filter\n    status: false\n    weight: -10\n    settings:\n      allowed_html: '<a href hreflang> <em> <strong> <cite> <blockquote cite> <code> <ul type> <ol start type> <li> <dl> <dt> <dd> <h2 id> <h3 id> <h4 id> <h5 id> <h6 id> <s> <sup> <sub> <table> <caption> <tbody> <thead> <tfoot> <th> <td> <tr> <hr> <p> <h1> <pre> <drupal-media data-entity-type data-entity-uuid data-view-mode data-align data-caption alt title>'\n      filter_html_help: true\n      filter_html_nofollow: false\n  filter_htmlcorrector:\n    id: filter_htmlcorrector\n    provider: filter\n    status: true\n    weight: 10\n    settings: {  }\n  filter_image_lazy_load:\n    id: filter_image_lazy_load\n    provider: filter\n    status: true\n    weight: 15\n    settings: {  }\n  media_embed:\n    id: media_embed\n    provider: media\n    status: true\n    weight: 100\n    settings:\n      default_view_mode: responsive_3x2\n      allowed_view_modes:\n        responsive_3x2: responsive_3x2\n      allowed_media_types:\n        audio: audio\n        document: document\n        image: image\n        remote_video: remote_video\n        video: video\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/filter.format.full_html.yml", "type": "yaml_reference", "topic": "filter.format.full html"}}
{"instruction": "Show me the implementation of the class KeyPrunerException in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\n/**\n * Thrown when pruning unused encryption keys cannot be planned or started.\n */\nfinal class KeyPrunerException extends \\RuntimeException {\n\n  /**\n   * Creates an exception for failures while building a prune plan.\n   *\n   * @param \\Throwable|null $previous\n   *   (optional) The underlying exception.\n   */\n  public static function planFailed(?\\Throwable $previous = NULL): self {\n    return new self('Planning unused encryption keys pruning failed.', 0, $previous);\n  }\n\n  /**\n   * Creates an exception for failures that prevent pruning from running at all.\n   *\n   * @param \\Throwable|null $previous\n   *   (optional) The underlying exception.\n   */\n  public static function pruneFailed(?\\Throwable $previous = NULL): self {\n    return new self('Pruning unused encryption keys failed.', 0, $previous);\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyPrunerException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyPrunerException", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for each \"box\" on the display query edit screen.\n *\n * Available variables:\n * - attributes: HTML attributes to apply to the container element.\n * - actions: Action links such as \"Add\", \"And/Or, Rearrange\" for the content.\n * - title: The title of the bucket, e.g. \"Fields\", \"Filter Criteria\", etc.\n * - content: Content items such as fields or settings in this container.\n * - name: The name of the bucket, e.g. \"Fields\", \"Filter Criteria\", etc.\n * - overridden: A boolean indicating the setting has been overridden from the\n *   default.\n *\n * @see template_preprocess_views_ui_display_tab_bucket()\n *\n * @ingroup themeable\n */\n#}\n{%\n  set classes = [\n    'views-ui-display-tab-bucket',\n    name ? name|clean_class,\n    overridden ? 'overridden',\n  ]\n%}\n<div{{ attributes.addClass(classes) }}>\n  {% if title or actions %}\n    <div class=\"views-ui-display-tab-bucket__header{% if actions %} views-ui-display-tab-bucket__header--actions{% endif %}\">\n    {% if title -%}\n      <h3 class=\"views-ui-display-tab-bucket__title\">{{ title }}</h3>\n    {%- endif %}\n    {% if actions -%}\n      <div class=\"views-ui-display-tab-bucket__actions\">{{ actions }}</div>\n    {%- endif %}\n    </div>\n  {% endif %}\n  {{ content }}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/themes/claro/templates/views/views-ui-display-tab-bucket.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class VocabularyPerType in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\taxonomy\\Plugin\\migrate\\source\\d6;\n\nuse Drupal\\migrate\\Row;\n\n// cspell:ignore localizable\n\n/**\n * Drupal 6 vocabularies with associated node types source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d6_taxonomy_vocabulary_per_type\",\n *   source_module = \"taxonomy\"\n * )\n */\nclass VocabularyPerType extends Vocabulary {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $query = parent::query();\n    $query->join('vocabulary_node_types', 'nt', '[v].[vid] = [nt].[vid]');\n    $query->fields('nt', ['type']);\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    // Get the i18n taxonomy translation setting for this vocabulary.\n    // 0 - No multilingual options\n    // 1 - Localizable terms. Run through the localization system.\n    // 2 - Predefined language for a vocabulary and its terms.\n    // 3 - Per-language terms, translatable (referencing terms with different\n    // languages) but not localizable.\n    $i18ntaxonomy_vocab = $this->variableGet('i18ntaxonomy_vocabulary', []);\n    $vid = $row->getSourceProperty('vid');\n    $i18ntaxonomy_vocabulary = FALSE;\n    if (array_key_exists($vid, $i18ntaxonomy_vocab)) {\n      $i18ntaxonomy_vocabulary = $i18ntaxonomy_vocab[$vid];\n    }\n    $row->setSourceProperty('i18ntaxonomy_vocabulary', $i18ntaxonomy_vocabulary);\n    return parent::prepareRow($row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['vid']['type'] = 'integer';\n    $ids['vid']['alias'] = 'nt';\n    $ids['type']['type'] = 'string';\n    return $ids;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/src/Plugin/migrate/source/d6/VocabularyPerType.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "VocabularyPerType", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: prompts\nenabled: true\nlabel: Prompts\ndescription: 'Create and manage text prompts, templates, and instructions that guide AI models to produce better results.'\nicon: 'mdi:message-text'\ncolor: '#f59e0b'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_category/config/install/flowdrop_node_category.flowdrop_node_category.prompts.yml", "type": "yaml_reference", "topic": "flowdrop node category.flowdrop node category.prompts"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: TransformationInterface\nSource file: <source_file>\nFile name hint: TransformationInterface.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\Transformation;\n\n/**\n * Interface for transformation plugins.\n */\ninterface TransformationInterface {\n\n  /**\n   * Applies transformation to a value.\n   *\n   * @param mixed $value\n   *   The value to transform.\n   * @param array $options\n   *   Transformation options.\n   *\n   * @return mixed\n   *   The transformed value.\n   */\n  public function transform($value, array $options = []): mixed;\n\n  /**\n   * Gets the plugin definition.\n   *\n   * @return array\n   *   The plugin definition.\n   */\n  public function getDefinition(): array;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\Transformation;\n\n/**\n * Interface for transformation plugins.\n */\ninterface TransformationInterface {\n\n  /**\n   * Applies transformation to a value.\n   *\n   * @param mixed $value\n   *   The value to transform.\n   * @param array $options\n   *   Transformation options.\n   *\n   * @return mixed\n   *   The transformed value.\n   */\n  public function transform($value, array $options = []): mixed;\n\n  /**\n   * Gets the plugin definition.\n   *\n   * @return array\n   *   The plugin definition.\n   */\n  public function getDefinition(): array;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/Transformation/TransformationInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "TransformationInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: BeforeCommand\nSource file: <source_file>\nFile name hint: BeforeCommand.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * An AJAX command for calling the jQuery before() method.\n *\n * The 'insert/before' command instructs the client to use jQuery's before()\n * method to insert the given render array or HTML content before each of\n * elements matched by the given selector.\n *\n * This command is implemented by Drupal.AjaxCommands.prototype.insert()\n * defined in misc/ajax.js.\n *\n * @see http://docs.jquery.com/Manipulation/before#content\n *\n * @ingroup ajax\n */\nclass BeforeCommand extends InsertCommand {\n\n  /**\n   * Implements Drupal\\Core\\Ajax\\CommandInterface:render().\n   */\n  function render() {\n\n    return [\n      'command' => 'insert',\n      'method' => 'before',\n      'selector' => $this->selector,\n      'data' => $this->getRenderedContent(),\n      'settings' => $this->settings,\n    ];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * An AJAX command for calling the jQuery before() method.\n *\n * The 'insert/before' command instructs the client to use jQuery's before()\n * method to insert the given render array or HTML content before each of\n * elements matched by the given selector.\n *\n * This command is implemented by Drupal.AjaxCommands.prototype.insert()\n * defined in misc/ajax.js.\n *\n * @see http://docs.jquery.com/Manipulation/before#content\n *\n * @ingroup ajax\n */\nclass BeforeCommand extends InsertCommand {\n\n  /**\n   * Implements Drupal\\Core\\Ajax\\CommandInterface:render().\n   */\n  public function render() {\n\n    return [\n      'command' => 'insert',\n      'method' => 'before',\n      'selector' => $this->selector,\n      'data' => $this->getRenderedContent(),\n      'settings' => $this->settings,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Ajax/BeforeCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BeforeCommand", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class UnpackCommand in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\RecipeUnpack;\n\nuse Composer\\Command\\BaseCommand;\nuse Composer\\Package\\PackageInterface;\nuse Composer\\Repository\\PlatformRepository;\nuse Symfony\\Component\\Console\\Input\\InputArgument;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\n/**\n * The \"drupal:recipe-unpack\" command class.\n *\n * Manually run the unpack operation that normally happens after\n * 'composer require'.\n *\n * @internal\n */\nfinal class UnpackCommand extends BaseCommand {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function configure(): void {\n    $name = 'drupal:recipe-unpack';\n    $this\n      ->setName($name)\n      ->setDescription('Unpack Drupal recipes.')\n      ->addArgument('recipes', InputArgument::IS_ARRAY, \"A list of recipe package names separated by a space, e.g. drupal/recipe_one drupal/recipe_two. If not provided, all recipes listed in the require section of the root composer are unpacked.\")\n      ->setHelp(\n        <<<EOT\nThe <info>$name</info> command unpacks dependencies from the specified recipe\npackages into the composer.json file.\n\n<info>php composer.phar $name drupal/my-recipe [...]</info>\n\nIt is usually not necessary to call <info>$name</info> manually,\nbecause by default it is called automatically as needed, after a\n<info>require</info> command.\nEOT\n            );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function execute(InputInterface $input, OutputInterface $output): int {\n    $composer = $this->requireComposer();\n    $io = $this->getIO();\n    $local_repo = $composer->getRepositoryManager()->getLocalRepository();\n    $package_names = $input->getArgument('recipes') ?? [];\n\n    // If no recipes are provided unpack all recipes that are required by the\n    // root package.\n    if (empty($package_names)) {\n      foreach ($composer->getPackage()->getRequires() as $link) {\n        $target = $link->getTarget();\n        // Skip platform requirements, since those don't resolve to a real\n        // package.\n        // @see https://getcomposer.org/doc/articles/composer-platform-dependencies.md\n        if (PlatformRepository::isPlatformPackage($target)) {\n          continue;\n        }\n        $package = $local_repo->findPackage($target, $link->getConstraint());\n        if ($package->getType() === Plugin::RECIPE_PACKAGE_TYPE) {\n          $package_names[] = $package->getName();\n        }\n      }\n      if (empty($package_names)) {\n        $io->write('<info>No recipes to unpack.</info>');\n        return 0;\n      }\n    }\n\n    $manager = new UnpackManager($composer, $io);\n    $unpack_collection = new UnpackCollection();\n    foreach ($package_names as $package_name) {\n      if (!$manager->isRootDependency($package_name)) {\n        $io->error(sprintf('<info>%s</info> not found in the root composer.json.', $package_name));\n        return 1;\n      }\n      $packages = $local_repo->findPackages($package_name);\n      $package = reset($packages);\n\n      if (!$package instanceof PackageInterface) {\n        $io->error(sprintf('<info>%s</info> does not resolve to a package.', $package_name));\n        return 1;\n      }\n\n      if ($package->getType() !== Plugin::RECIPE_PACKAGE_TYPE) {\n        $io->error(sprintf('<info>%s</info> is not a recipe.', $package->getPrettyName()));\n        return 1;\n      }\n\n      if ($manager->unpackOptions->isIgnored($package)) {\n        $io->error(sprintf('<info>%s</info> is in the extra.drupal-recipe-unpack.ignore list.', $package->getName()));\n        return 1;\n      }\n\n      if (UnpackManager::isDevRequirement($package)) {\n        $io->warning(sprintf('<info>%s</info> is present in the require-dev key. Unpacking will move the recipe\\'s dependencies to the require key.', $package->getName()));\n        if ($io->isInteractive() && !$io->askConfirmation('<info>Do you want to continue</info> [<comment>yes</comment>]?')) {\n          return 0;\n        }\n      }\n      $unpack_collection->add($package);\n    }\n    $manager->unpack($unpack_collection);\n    return 0;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/RecipeUnpack/UnpackCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UnpackCommand", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BookNodeIsRemovableAccessCheck in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Determines whether the requested node can be removed from its book.\n */\nclass BookNodeIsRemovableAccessCheck implements AccessInterface {\n\n  /**\n   * Constructs a BookNodeIsRemovableAccessCheck object.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   Book Manager Service.\n   */\n  public function __construct(protected BookManagerInterface $bookManager) {\n  }\n\n  /**\n   * Checks access for removing the node from its book.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The node requested to be removed from its book.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(NodeInterface $node): AccessResultInterface {\n    return AccessResult::allowedIf($this->bookManager->checkNodeIsRemovable($node))->addCacheableDependency($node);\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Access/BookNodeIsRemovableAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookNodeIsRemovableAccessCheck", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface InterruptExceptionInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Exception;\n\n/**\n * Interface for interrupt exceptions that pause workflow execution.\n *\n * Interrupt exceptions are special exceptions that indicate a workflow node\n * needs to pause execution and wait for external input (typically user input\n * in a human-in-loop scenario).\n *\n * Unlike regular exceptions, interrupt exceptions should NOT be treated as\n * failures. Instead, they signal that:\n * - The workflow should be paused (not failed).\n * - The interrupt details should be returned to the caller.\n * - The workflow can be resumed once the interrupt is resolved.\n *\n * @see \\Drupal\\flowdrop_interrupt\\Exception\\InterruptRequiredException\n */\ninterface InterruptExceptionInterface extends \\Throwable {\n\n  /**\n   * Gets the unique identifier of the interrupt.\n   *\n   * @return string\n   *   The interrupt UUID.\n   */\n  public function getInterruptId(): string;\n\n  /**\n   * Gets the type of interrupt.\n   *\n   * @return string\n   *   The interrupt type (e.g., 'confirmation', 'choice', 'text', 'form').\n   */\n  public function getInterruptType(): string;\n\n  /**\n   * Gets the execution context for resuming the workflow.\n   *\n   * @return array<string, mixed>\n   *   The execution context.\n   */\n  public function getExecutionContext(): array;\n\n  /**\n   * Converts the exception to an array for API responses.\n   *\n   * @return array<string, mixed>\n   *   The exception data as an array.\n   */\n  public function toArray(): array;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Exception/InterruptExceptionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "InterruptExceptionInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: TopLevelBook\nSource file: <source_file>\nFile name hint: TopLevelBook.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\book\\Plugin\\views\\argument_default;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\node\\NodeStorageInterface;\nuse Drupal\\node\\Plugin\\views\\argument_default\\Node;\nuse Drupal\\views\\Attribute\\ViewsArgumentDefault;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Default argument plugin to get the current node's top level book.\n */\n#[ViewsArgumentDefault(\n  id: 'top_level_book',\n  title: new TranslatableMarkup('Top Level Book from current node\"'),\n)]\nclass TopLevelBook extends Node {\n\n  /**\n   * Constructs a Drupal\\book\\Plugin\\views\\argument_default\\TopLevelBook object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   * @param \\Drupal\\node\\NodeStorageInterface $nodeStorage\n   *   The node storage controller.\n   */\n  function __construct(array $configuration, $plugin_id, array $plugin_definition, RouteMatchInterface $route_match, protected NodeStorageInterface $nodeStorage) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $route_match);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('current_route_match'),\n      $container->get('entity_type.manager')->getStorage('node')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getArgument() {\n    // Use the argument_default_node plugin to get the nid argument.\n    $nid = parent::getArgument();\n    if (!empty($nid)) {\n      $node = $this->nodeStorage->load($nid);\n      $book = $node->getBook();\n      if (isset($book['bid'])) {\n        return $book['bid'];\n      }\n    }\n    return NULL;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\book\\Plugin\\views\\argument_default;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\node\\NodeStorageInterface;\nuse Drupal\\node\\Plugin\\views\\argument_default\\Node;\nuse Drupal\\views\\Attribute\\ViewsArgumentDefault;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Default argument plugin to get the current node's top level book.\n */\n#[ViewsArgumentDefault(\n  id: 'top_level_book',\n  title: new TranslatableMarkup('Top Level Book from current node\"'),\n)]\nclass TopLevelBook extends Node {\n\n  /**\n   * Constructs a Drupal\\book\\Plugin\\views\\argument_default\\TopLevelBook object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin_id for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   * @param \\Drupal\\node\\NodeStorageInterface $nodeStorage\n   *   The node storage controller.\n   */\n  public function __construct(array $configuration, $plugin_id, array $plugin_definition, RouteMatchInterface $route_match, protected NodeStorageInterface $nodeStorage) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $route_match);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('current_route_match'),\n      $container->get('entity_type.manager')->getStorage('node')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getArgument() {\n    // Use the argument_default_node plugin to get the nid argument.\n    $nid = parent::getArgument();\n    if (!empty($nid)) {\n      $node = $this->nodeStorage->load($nid);\n      $book = $node->getBook();\n      if (isset($book['bid'])) {\n        return $book['bid'];\n      }\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Plugin/views/argument_default/TopLevelBook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TopLevelBook", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DateTimeIso8601 in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Plugin\\DataType;\n\nuse Drupal\\Core\\Datetime\\DrupalDateTime;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\TypedData\\Attribute\\DataType;\nuse Drupal\\Core\\TypedData\\Type\\DateTimeInterface;\n\n/**\n * A data type for ISO 8601 date strings.\n *\n * The plain value of this data type is a date string in ISO 8601 format.\n */\n#[DataType(\n  id: \"datetime_iso8601\",\n  label: new TranslatableMarkup(\"Date\")\n)]\nclass DateTimeIso8601 extends StringData implements DateTimeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDateTime() {\n    if ($this->value) {\n      if (is_array($this->value)) {\n        // Data of this type must always be stored in UTC.\n        $datetime = DrupalDateTime::createFromArray($this->value, 'UTC');\n      }\n      else {\n        // Data of this type must always be stored in UTC.\n        $datetime = new DrupalDateTime($this->value, 'UTC');\n      }\n      return $datetime;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setDateTime(DrupalDateTime $dateTime, $notify = TRUE) {\n    $this->value = $dateTime->format('c');\n    // Notify the parent of any changes.\n    if ($notify && isset($this->parent)) {\n      $this->parent->onChange($this->name);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Plugin/DataType/DateTimeIso8601.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateTimeIso8601", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: NexiXpayHppThemeHooks\nSource file: <source_file>\nFile name hint: NexiXpayHppThemeHooks.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hooks for the NexiXpay HPP theme.\n */\nfinal class NexiXpayHppThemeHooks {\n\n  /**\n   * Implements hook_theme().\n   *\n   * @return array<string, mixed>\n   *   The theme return array.\n   */\n  #[Hook('theme')]\n  public function theme(): array {\n    return [\n      'nexi_xpay_hpp_pay' => [\n        'variables' => [\n          'tx' => [],\n          'start_url' => '',\n        ],\n        'template' => 'nexi-xpay-hpp-pay',\n      ],\n      'nexi_xpay_hpp_return' => [\n        'variables' => [\n          'tx' => [],\n          'message' => '',\n        ],\n        'template' => 'nexi-xpay-hpp-return',\n      ],\n    ];\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hooks for the NexiXpay HPP theme.\n */\nfinal class NexiXpayHppThemeHooks {\n\n  /**\n   * Implements hook_theme().\n   *\n   * @return array<string, mixed>\n   *   The theme return array.\n   */\n  #[Hook('theme')]\n  public function theme(): array {\n    return [\n      'nexi_xpay_hpp_pay' => [\n        'variables' => [\n          'tx' => [],\n          'start_url' => '',\n        ],\n        'template' => 'nexi-xpay-hpp-pay',\n      ],\n      'nexi_xpay_hpp_return' => [\n        'variables' => [\n          'tx' => [],\n          'message' => '',\n        ],\n        'template' => 'nexi-xpay-hpp-return',\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Hook/NexiXpayHppThemeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NexiXpayHppThemeHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SoapOperationListBuilder.php\nTarget symbol: class SoapOperationListBuilder\nNamespace: Drupal\\soap_client\\Entity\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SoapOperationListBuilder.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder\n  - Drupal\\Core\\Entity\\EntityInterface\n- Ensure these methods exist where relevant:\n  - buildHeader()\n  - buildRow()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Entity\\Controller;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\n\n/**\n * List builder for SOAP Operation entities.\n */\nclass SoapOperationListBuilder extends ConfigEntityListBuilder\n{\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader(): array {\n    return [\n      ...parent::buildHeader(),\n      'label' => $this->t('Label'),\n      'id' => $this->t('Machine name'),\n      'operation_name' => $this->t('Operation'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    return [\n      ...parent::buildRow($entity),\n      'label' => $entity->label(),\n      'id' => $entity->id(),\n      'operation_name' => $entity->operationName(),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/src/Entity/Controller/SoapOperationListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapOperationListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: AccessResultForbidden.php\nTarget symbol: class AccessResultForbidden\nNamespace: Drupal\\Core\\Access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for AccessResultForbidden.\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getReason()\n  - isForbidden()\n  - setReason()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Access;\n\n/**\n * Value object for a forbidden access result, with cacheability metadata.\n */\nclass AccessResultForbidden extends AccessResult implements AccessResultReasonInterface {\n\n  /**\n   * The reason why access is forbidden. For use in error messages.\n   *\n   * @var string\n   */\n  protected $reason;\n\n  /**\n   * Constructs a new AccessResultForbidden instance.\n   *\n   * @param null|string $reason\n   *   (optional) A message to provide details about this access result.\n   */\n  public function __construct($reason = NULL) {\n    $this->reason = $reason;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isForbidden() {\n    return TRUE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getReason() {\n    return (string) $this->reason;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setReason($reason) {\n    $this->reason = $reason;\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Access/AccessResultForbidden.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AccessResultForbidden", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<div class=\"agui-chat\"\n  data-endpoint=\"{{ endpoint }}\"\n  {% if agentId %} data-agent-id=\"{{ agentId }}\"{% endif %}\n  {% if tokenEndpoint %} data-token-endpoint=\"{{ tokenEndpoint }}\"{% endif %}\n  {% if config %} data-config=\"{{ config|json_encode|e('html_attr') }}\"{% endif %}\n>\n  <div class=\"agui-chat__messages\">\n    {# Messages will be inserted here by JS #}\n    <div class=\"agui-chat__message agui-chat__message--system\">\n      Ready to chat.\n    </div>\n  </div>\n  {% if suggestions %}\n    <div class=\"agui-chat__suggestions\">\n      {% for suggestion in suggestions %}\n        <button\n          type=\"button\"\n          class=\"agui-chat__suggestion-pill\"\n          data-message=\"{{ suggestion.message|e }}\"\n        >{{ suggestion.title }}</button>\n      {% endfor %}\n    </div>\n  {% endif %}\n  <form class=\"agui-chat__input-form\" name=\"agui_chat_form\">\n    <input type=\"text\" class=\"agui-chat__input\" placeholder=\"Type a message...\" aria-label=\"Type a message\">\n    <button type=\"submit\" class=\"agui-chat__submit\">Send</button>\n  </form>\n</div>\n\n{# Tool renderer components - SDCs render their <template> elements here #}\n{% block tools %}\n  {{ tools }}\n{% endblock %}\n", "metadata": {"source": "repos/agui/components/chat/chat.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class LightgalleryProfileController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\lightgallery_formatter\\Entity\\LightgalleryProfile;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Link;\n\n/**\n * Controller for listing LightGallery profile entities.\n */\nclass LightgalleryProfileController extends ControllerBase {\n\n  /**\n   * List all LightGallery profile entities.\n   *\n   * @return array\n   *   A render array containing the profiles table.\n   */\n  public function listProfiles() {\n    $build = [];\n\n    $build['description'] = [\n      '#markup' => $this->t('Manage reusable gallery configurations.'),\n      '#prefix' => '<p>',\n      '#suffix' => '</p>',\n    ];\n\n    $build['add_link'] = [\n      '#type' => 'link',\n      '#title' => $this->t('Add LightGallery profile'),\n      '#url' => Url::fromRoute('entity.lightgallery_profile.add_form'),\n      '#attributes' => [\n        'class' => ['button', 'button--primary', 'button--action'],\n      ],\n      '#prefix' => '<p>',\n      '#suffix' => '</p>',\n    ];\n\n    $headers = [\n      $this->t('Label'),\n      $this->t('Machine name'),\n      $this->t('Enabled'),\n      $this->t('Operations'),\n    ];\n\n    $rows = [];\n    $profiles = LightgalleryProfile::loadMultiple();\n\n    foreach ($profiles as $profile) {\n      $rows[] = [\n        'data' => [\n          Link::fromTextAndUrl($profile->label(), Url::fromRoute('entity.lightgallery_profile.edit_form', ['lightgallery_profile' => $profile->id()])),\n          $profile->id(),\n          $profile->status() ? $this->t('Yes') : $this->t('No'),\n          [\n            'data' => [\n              '#type' => 'operations',\n              '#links' => [\n                'edit' => [\n                  'title' => $this->t('Edit'),\n                  'url' => Url::fromRoute('entity.lightgallery_profile.edit_form', ['lightgallery_profile' => $profile->id()]),\n                ],\n                'delete' => [\n                  'title' => $this->t('Delete'),\n                  'url' => Url::fromRoute('entity.lightgallery_profile.delete_form', ['lightgallery_profile' => $profile->id()]),\n                ],\n              ],\n            ],\n          ],\n        ],\n      ];\n    }\n\n    $build['profiles_table'] = [\n      '#type' => 'table',\n      '#header' => $headers,\n      '#rows' => $rows,\n      '#empty' => $this->t('No LightGallery profiles available. <a href=\":add\">Add one</a>.', [\n        ':add' => Url::fromRoute('entity.lightgallery_profile.add_form')->toString(),\n      ]),\n    ];\n\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/Controller/LightgalleryProfileController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryProfileController", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class UnmetDependenciesException in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Config;\n\nuse Drupal\\Component\\Render\\FormattableMarkup;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\n\n/**\n * An exception thrown if configuration has unmet dependencies.\n */\nclass UnmetDependenciesException extends ConfigException {\n\n  /**\n   * A list of configuration objects that have unmet dependencies.\n   *\n   * @var array\n   * The list is keyed by the config object name, and the value is an array of\n   * the missing dependencies:\n   * @code\n   *\n   * self::configObjects = [\n   *   config_object_name => [\n   *     'missing_dependency_1',\n   *     'missing_dependency_2',\n   *   ]\n   * ];\n   *\n   * @endcode\n   */\n  protected $configObjects = [];\n\n  /**\n   * The name of the extension that is being installed.\n   *\n   * @var string\n   */\n  protected $extension;\n\n  /**\n   * Gets the list of configuration objects that have unmet dependencies.\n   *\n   * @return array\n   *   A list of configuration objects that have unmet dependencies, keyed by\n   *   object name, with the value being a list of the unmet dependencies.\n   */\n  public function getConfigObjects() {\n    return $this->configObjects;\n  }\n\n  /**\n   * Gets the name of the extension that is being installed.\n   *\n   * @return string\n   *   The name of the extension that is being installed.\n   */\n  public function getExtension() {\n    return $this->extension;\n  }\n\n  /**\n   * Gets a translated message from the exception.\n   *\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The string translation service.\n   * @param string $extension\n   *   The name of the extension that is being installed.\n   *\n   * @return string\n   *   The translated exception message.\n   */\n  public function getTranslatedMessage(TranslationInterface $string_translation, $extension) {\n    return $string_translation->translate(\n      'Unable to install %extension due to unmet dependencies: %config_names',\n      [\n        '%config_names' => static::formatConfigObjectList($this->configObjects),\n        '%extension' => $extension,\n      ]\n    );\n  }\n\n  /**\n   * Creates an exception for an extension and a list of configuration objects.\n   *\n   * @param string $extension\n   *   The name of the extension that is being installed.\n   * @param array $config_objects\n   *   A list of configuration keyed by configuration name, with unmet\n   *   dependencies as the value.\n   *\n   * @return \\Drupal\\Core\\Config\\PreExistingConfigException\n   *   An exception for the extension with a list of configuration objects.\n   */\n  public static function create($extension, array $config_objects) {\n    $message = new FormattableMarkup('Configuration objects provided by %extension have unmet dependencies: %config_names',\n      [\n        '%config_names' => static::formatConfigObjectList($config_objects),\n        '%extension' => $extension,\n      ]\n    );\n    $e = new static($message);\n    $e->configObjects = $config_objects;\n    $e->extension = $extension;\n    return $e;\n  }\n\n  /**\n   * Formats a list of configuration objects.\n   *\n   * @param array $config_objects\n   *   A list of configuration object names that have unmet dependencies.\n   *\n   * @return string\n   *   The imploded config_objects, formatted in an easy to read string.\n   */\n  protected static function formatConfigObjectList(array $config_objects) {\n    $list = [];\n    foreach ($config_objects as $config_object => $missing_dependencies) {\n      $list[] = $config_object . ' (' . implode(', ', $missing_dependencies) . ')';\n    }\n    return implode(', ', $list);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/UnmetDependenciesException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UnmetDependenciesException", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Purge Tag Mapper", "input": "", "output": "# Purge Tag Mapper\n\n## Description\n\nPurge Tag Mapper is a Drupal module that provides additional cache\ninvalidation rules for the Purge module. It allows the user to map specific\ncontent type updates to specific cache tags and queue invalidations.\nVery useful for sites that use Purge and a CDN (Cloudflare/Fastly).\n\n## Features\n\n- Configurable content type and cache tag mappings through the Drupal admin UI\n- Automatically invalidates given cache tags when configured content types are\n  created/updated\n- Integrates with the Purge module's queueing system to handle cache invalidation\n- Support for multiple content types and multiple cache tags per content type\n\n## Requirements\n\n- [Purge](https://www.drupal.org/project/purge) module\n\n## Optional Requirements\n\n- [Views Custom Cache Tag](https://www.drupal.org/project/views_custom_cache_tag) module\n\n## Installation\n\n1. Install the required dependencies using Composer:\n   ```bash\n   composer require drupal/purge\n   ```\n\n   Optional:\n   ```bash\n   composer require drupal/views_custom_cache_tag\n   ```\n\n2. Enable the module and its dependencies:\n   ```bash\n   drush en purge_tag_mapper\n   ```\n\n3. Configure the module at `/admin/config/development/purge-tag-mapper`\n\n4. Optional: Configure your views as described below.\n\n## Configuration\n\n### Configuring Content Types and Cache Tags\n\n1. Navigate to `/admin/config/development/purge-tag-mapper`\n2. For each content type you want to track:\n   - Enter the content type machine name (e.g., `localgov_job_vacancy`, `article`)\n   - Enter cache tags to invalidate (one per line, e.g. `loclagov_view_job_vacancies`)\n3. Click \"Add another set\" to add more content type/tag mappings\n4. Click \"Remove\" to delete a mapping set\n5. Click \"Save configuration\" when done\n\n### Adding Custom Cache Tags to Views\n\nTo use this functionality with your views:\n\n1. Install and enable the Views Custom Cache Tag module\n2. Edit the view you want to cache (e.g., job vacancies view)\n3. Navigate to \"Advanced\" \u2192 \"Other\" \u2192 \"Caching\" \u2192 \"Custom Cache Based\"\n4. Add the custom cache tag (e.g., `custom_view_job_vacancies`)\n5. Save the view\n6. Update this module's configuration to include the custom cache tag\n\nNow when entities are created or modified, the module will invalidate the\nappropriate view caches.\n\n## How It Works\n\nThe module leverages the Purge module's queueing system to handle cache invalidation.\nFor more information about how queueing works in the Purge module, see:\n\nhttps://git.drupalcode.org/project/purge/-/blob/8.x-3.x/README.md?ref_type=heads#queueing\n\n### Configuration Example\n\nTo invalidate the job vacancies view when job vacancy nodes are updated:\n\n1. Configuration at `/admin/config/development/purge-tag-mapper`:\n   - Content Type: `localgov_job_vacancy`\n   - Cache Tags: `custom_view_job_vacancies`\n\n2. View configuration:\n   - Add custom cache tag `custom_view_job_vacancies` to your view\n\nTo invalidate multiple views/pages for a content type:\n\n1. Configuration at `/admin/config/development/purge-tag-mapper`:\n   - Content Type: `article`\n   - Cache Tags:\n     ```\n     custom_view_articles\n     custom_view_news_listing\n     custom_tag_homepage_news\n     ```\n\n## How the Module Works\n\nThe module implements `hook_entity_presave()` to watch for node updates. When a node of a configured content type is saved with a new revision:\n\n1. The module loads the configuration from `purge_tag_mapper.settings`\n2. It checks if the node's content type matches any configured content type\n3. If a match is found, it parses the associated cache tags (split by newline)\n4. Each cache tag is queued for invalidation using the Purge module's queueing system\n5. The Purge module then processes these invalidations according to its configuration\n\n## Maintainers\n\n- [Bill Seremetis](https://www.drupal.org/u/bserem)\n- [Annertech](https://www.annertech.com)\n\n## Related Resources\n\n- [Render cache debug output](https://www.drupal.org/node/3162480)\n- [Purge Module](https://www.drupal.org/project/purge)\n- [Views Custom Cache Tag Module](https://www.drupal.org/project/views_custom_cache_tag)\n- [Drupal Cache API](https://www.drupal.org/docs/8/api/cache-api/cache-api)\n", "metadata": {"source": "repos/purge_tag_mapper/README.md", "type": "doc_summary", "topic": "Purge Tag Mapper"}}
{"instruction": "Show me the implementation of the interface EbExtensionInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\eb\\PluginInterfaces;\n\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\n\n/**\n * Interface for Entity Builder Extension plugins.\n *\n * Extensions integrate contrib modules (field_group, pathauto, etc.) with\n * Entity Builder's definition-centric workflow:\n *\n * 1. YAML/UI \u2192 EbDefinition (stores extension's definitions)\n * 2. On Apply \u2192 buildOperations() converts definitions \u2192 operations\n * 3. Operations \u2192 Validate \u2192 Execute\n *\n * Required method: buildOperations()\n * Optional methods: getOperationDependencies(), detectChanges(),\n *                   checkDependencies(), extractConfig()\n *\n * @see \\Drupal\\eb\\Attribute\\EbExtension\n * @see \\Drupal\\eb\\PluginBase\\EbExtensionBase\n */\ninterface EbExtensionInterface extends PluginInspectionInterface {\n\n  /**\n   * Builds operations from definition data.\n   *\n   * This is the PRIMARY method extensions must implement. It converts\n   * definition data (from EbDefinition entity) into operation\n   * arrays for validation and execution.\n   *\n   * @param array<string, mixed> $data\n   *   Full definition data array containing all definition keys such as\n   *   bundle_definitions, field_definitions, field_group_definitions, etc.\n   *\n   * @return array<int, array<string, mixed>>\n   *   Array of operation data arrays for this extension's domain.\n   *   Each operation must contain 'operation' key with operation ID.\n   *   Return empty array if no operations to contribute.\n   */\n  public function buildOperations(array $data): array;\n\n  /**\n   * Gets dependencies for an operation.\n   *\n   * Override to declare what entities an operation depends on.\n   * Dependencies determine operation execution order via topological sort.\n   *\n   * @param array $operation\n   *   Operation data array with 'operation' key and operation-specific data.\n   * @param array $context\n   *   Context with 'all_operations' containing all operations for reference.\n   *\n   * @return array\n   *   Dependency keys (e.g., ['bundle:node:article', 'field:...']).\n   */\n  public function getOperationDependencies(array $operation, array $context): array;\n\n  /**\n   * Detects whether operation should create, update, or skip.\n   *\n   * Override to implement change detection for sync mode. Compares operation\n   * data against current Drupal state to determine appropriate action.\n   *\n   * @param array $operation\n   *   Operation data array.\n   * @param array $context\n   *   Context with metadata.\n   *\n   * @return string|null\n   *   One of:\n   *   - 'create_*': Create operation (e.g., 'create_field_group').\n   *   - 'update_*': Update operation (e.g., 'update_field_group').\n   *   - 'skip': Already exists and unchanged.\n   *   - NULL: Defer to core change detection.\n   */\n  public function detectChanges(array $operation, array $context): ?string;\n\n  /**\n   * Checks if custom dependency types exist in Drupal.\n   *\n   * Override to verify extension-specific entities exist during dependency\n   * resolution. Only needed if extension declares custom dependency types.\n   *\n   * @param array $dependencyKeys\n   *   Dependency keys to check (e.g., ['field_group:node:...:group_content']).\n   *\n   * @return array\n   *   Keyed array: dependency_key => exists (bool).\n   *   Return empty array for keys this extension doesn't handle.\n   */\n  public function checkDependencies(array $dependencyKeys): array;\n\n  /**\n   * Checks if this extension applies to an operation.\n   *\n   * Used to route operations to the correct extension for dependency\n   * resolution and change detection.\n   *\n   * @param array $operation\n   *   Operation data array with 'operation' key.\n   *\n   * @return bool\n   *   TRUE if this extension handles this operation type.\n   */\n  public function appliesTo(array $operation): bool;\n\n  /**\n   * Gets the YAML definition keys this extension handles.\n   *\n   * These keys are stored in EbDefinition and passed to\n   * buildOperations(). Defined in the plugin attribute.\n   *\n   * @return array\n   *   Array of YAML keys (e.g., ['field_group_definitions']).\n   */\n  public function getYamlKeys(): array;\n\n  /**\n   * Gets the operation types this extension provides.\n   *\n   * Used by appliesTo() to match operations. Defined in the plugin attribute.\n   *\n   * @return array\n   *   Array of operation IDs (e.g., ['create_field_group', '...']).\n   */\n  public function getOperations(): array;\n\n  /**\n   * Extracts configuration from an existing Drupal bundle.\n   *\n   * Used by export/generate features to extract extension-specific\n   * configuration from Drupal into definition format.\n   *\n   * @param string $entityTypeId\n   *   The entity type ID (e.g., 'node', 'taxonomy_term').\n   * @param string $bundle\n   *   The bundle machine name (e.g., 'article', 'tags').\n   *\n   * @return array<string, mixed>\n   *   Configuration data keyed by definition type (e.g.,\n   *   ['field_group_definitions' => [...]]).\n   *   Return empty array if no configuration to extract.\n   */\n  public function extractConfig(string $entityTypeId, string $bundle): array;\n\n}\n", "metadata": {"source": "repos/eb/src/PluginInterfaces/EbExtensionInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EbExtensionInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: UserLogout\nSource file: <source_file>\nFile name hint: UserLogout.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Event type for user logout events.\n *\n * Triggers when a user logs out of the site.\n * This event fires after the session is destroyed.\n */\n#[FlowDropEventType(\n  id: \"user.logout\",\n  label: new TranslatableMarkup(\"User Logout\"),\n  description: new TranslatableMarkup(\"Triggered when a user logs out\"),\n  category: \"user\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [\"user\"],\n)]\nclass UserLogout extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    return \"user\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for user logout events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add user-specific data.\n    $data[\"operation\"] = \"logout\";\n\n    if ($entity instanceof UserInterface) {\n      $data[\"username\"] = $entity->getAccountName();\n      $data[\"email\"] = $entity->getEmail();\n      $data[\"roles\"] = $entity->getRoles();\n    }\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"roles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"User Roles\",\n          \"description\" => \"Only trigger for users with these roles (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Event type for user logout events.\n *\n * Triggers when a user logs out of the site.\n * This event fires after the session is destroyed.\n */\n#[FlowDropEventType(\n  id: \"user.logout\",\n  label: new TranslatableMarkup(\"User Logout\"),\n  description: new TranslatableMarkup(\"Triggered when a user logs out\"),\n  category: \"user\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [\"user\"],\n)]\nclass UserLogout extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    return \"user\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for user logout events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add user-specific data.\n    $data[\"operation\"] = \"logout\";\n\n    if ($entity instanceof UserInterface) {\n      $data[\"username\"] = $entity->getAccountName();\n      $data[\"email\"] = $entity->getEmail();\n      $data[\"roles\"] = $entity->getRoles();\n    }\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"roles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"User Roles\",\n          \"description\" => \"Only trigger for users with these roles (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/UserLogout.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserLogout", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: TimeLogListBuilder.php\nTarget symbol: class TimeLogListBuilder\nNamespace: Drupal\\labor_time_tracker\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TimeLogListBuilder.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityListBuilder\n  - Drupal\\Core\\Entity\\EntityStorageInterface\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\Core\\Datetime\\DateFormatter\n  - Drupal\\Core\\Form\\FormBuilderInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Symfony\\Component\\HttpFoundation\\Request\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildHeader()\n  - buildRow()\n  - createInstance()\n  - getEntityIds()\n  - render()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\labor_time_tracker;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Datetime\\DateFormatter;\nuse Drupal\\Core\\Form\\FormBuilderInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * List all time logs.\n */\nclass TimeLogListBuilder extends EntityListBuilder {\n\n  /**\n   * The current request.\n   */\n  protected ?Request $currentRequest;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    EntityTypeInterface $entityType,\n    EntityStorageInterface $storage,\n    RequestStack $requestStack,\n    protected DateFormatter $dateFormatter,\n    protected FormBuilderInterface $formBuilder,\n  ) {\n    parent::__construct($entityType, $storage);\n    $this->currentRequest = $requestStack->getCurrentRequest();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(\n    ContainerInterface $container,\n    EntityTypeInterface $entity_type,\n  ) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager')->getStorage($entity_type->id()),\n      $container->get('request_stack'),\n      $container->get('date.formatter'),\n      $container->get('form_builder'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    $build['filter_form'] = $this->formBuilder->getForm('\\Drupal\\labor_time_tracker\\Form\\TimeLogFilterForm');\n    $build['table'] = parent::render();\n    return $build;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityIds() {\n    $query = $this->getStorage()->getQuery()->accessCheck(TRUE);\n\n    $uid = $this->currentRequest->query->get('uid');\n    $date = $this->currentRequest->query->get('date');\n\n    if ($uid) {\n      $query->condition('user_id', $uid);\n    }\n\n    if ($date) {\n      $start_of_day = strtotime($date . ' 00:00:00');\n      $end_of_day = strtotime($date . ' 23:59:59');\n      $query->condition('enter_time', [$start_of_day, $end_of_day], 'BETWEEN');\n    }\n\n    $query->pager($this->limit);\n    $query->sort('enter_time', 'DESC');\n    return $query->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    $header['user']       = $this->t('User');\n    $header['day']        = $this->t('Day');\n    $header['enter_time'] = $this->t('Punch In');\n    $header['exit_time']  = $this->t('Punch Out');\n    $header['duration']   = $this->t('Duration');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    /** @var \\Drupal\\labor_time_tracker\\Entity\\TimeLog $entity */\n    $start_ts = (int) $entity->get('enter_time')->value;\n    $exit_ts = (int) $entity->get('exit_time')->value;\n\n    $row['user'] = $entity->get('user_id')->entity ? $entity->get('user_id')->entity->label() : $this->t('Unknown');\n    $row['day'] = $this->dateFormatter->format($start_ts, 'olivero_medium');\n    $row['enter_time'] = $this->dateFormatter->format($start_ts, 'html_time');\n    $row['exit_time'] = ($exit_ts > 0)\n      ? $this->dateFormatter->format($exit_ts, 'html_time')\n      : ['data' => ['#markup' => '<em>' . $this->t('Active') . '</em>']];\n\n    $duration_sec = (int) $entity->get('duration')->value;\n    $d_h = (int) ($duration_sec / 3600);\n    $d_m = (int) (($duration_sec % 3600) / 60);\n    $row['duration'] = ($exit_ts > 0) ? \"{$d_h}h {$d_m}m\" : '--';\n\n    return $row + parent::buildRow($entity);\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/TimeLogListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TimeLogListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "eb.admin:\n  title: 'Entity Builder'\n  description: 'Manage entity architecture through spreadsheet-driven operations.'\n  route_name: eb.import\n  parent: system.admin_config_development\n  weight: 10\n", "metadata": {"source": "repos/eb/eb.links.menu.yml", "type": "yaml_reference", "topic": "eb.links.menu"}}
{"instruction": "Show me the implementation of the class BooleanFormatter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Field\\FormatterBase;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'boolean' formatter.\n */\n#[FieldFormatter(\n  id: 'boolean',\n  label: new TranslatableMarkup('Boolean'),\n  field_types: [\n    'boolean',\n  ],\n)]\nclass BooleanFormatter extends FormatterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    $settings = [];\n\n    // Fall back to field settings by default.\n    $settings['format'] = 'default';\n    $settings['format_custom_false'] = '';\n    $settings['format_custom_true'] = '';\n\n    return $settings;\n  }\n\n  /**\n   * Gets the available format options.\n   *\n   * @return array|string\n   *   A list of output formats. Each entry is keyed by the machine name of the\n   *   format. The value is an array, of which the first item is the result for\n   *   boolean TRUE, the second is for boolean FALSE. The value can be also an\n   *   array, but this is just the case for the custom format.\n   */\n  protected function getOutputFormats() {\n    $formats = [\n      'default' => [$this->getFieldSetting('on_label'), $this->getFieldSetting('off_label')],\n      'yes-no' => [$this->t('Yes'), $this->t('No')],\n      'true-false' => [$this->t('True'), $this->t('False')],\n      'on-off' => [$this->t('On'), $this->t('Off')],\n      'enabled-disabled' => [$this->t('Enabled'), $this->t('Disabled')],\n      'boolean' => [1, 0],\n      'unicode-yes-no' => ['\u2714', '\u2716'],\n      'custom' => $this->t('Custom'),\n    ];\n\n    return $formats;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $form = parent::settingsForm($form, $form_state);\n\n    $formats = [];\n    foreach ($this->getOutputFormats() as $format_name => $format) {\n      if (is_array($format)) {\n        if ($format_name == 'default') {\n          $formats[$format_name] = $this->t('Field settings (@on_label / @off_label)', [\n            '@on_label' => $format[0],\n            '@off_label' => $format[1],\n          ]);\n        }\n        else {\n          $formats[$format_name] = $this->t('@on_label / @off_label', [\n            '@on_label' => $format[0],\n            '@off_label' => $format[1],\n          ]);\n        }\n      }\n      else {\n        $formats[$format_name] = $format;\n      }\n    }\n\n    $field_name = $this->fieldDefinition->getName();\n    $form['format'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Output format'),\n      '#default_value' => $this->getSetting('format'),\n      '#options' => $formats,\n    ];\n    $form['format_custom_true'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Custom output for TRUE'),\n      '#default_value' => $this->getSetting('format_custom_true'),\n      '#states' => [\n        'visible' => [\n          'select[name=\"fields[' . $field_name . '][settings_edit_form][settings][format]\"]' => ['value' => 'custom'],\n        ],\n      ],\n    ];\n    $form['format_custom_false'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Custom output for FALSE'),\n      '#default_value' => $this->getSetting('format_custom_false'),\n      '#states' => [\n        'visible' => [\n          'select[name=\"fields[' . $field_name . '][settings_edit_form][settings][format]\"]' => ['value' => 'custom'],\n        ],\n      ],\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsSummary() {\n    $summary = [];\n    $setting = $this->getSetting('format');\n\n    if ($setting == 'custom') {\n      $summary[] = $this->t('Custom text: @true_label / @false_label', [\n        '@true_label' => $this->getSetting('format_custom_true'),\n        '@false_label' => $this->getSetting('format_custom_false'),\n      ]);\n    }\n    else {\n      $formats = $this->getOutputFormats();\n      $summary[] = $this->t('Display: @true_label / @false_label', [\n        '@true_label' => $formats[$setting][0],\n        '@false_label' => $formats[$setting][1],\n      ]);\n    }\n\n    return $summary;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewElements(FieldItemListInterface $items, $langcode) {\n    $elements = [];\n\n    $formats = $this->getOutputFormats();\n\n    foreach ($items as $delta => $item) {\n      $format = $this->getSetting('format');\n\n      if ($format == 'custom') {\n        $elements[$delta] = ['#markup' => $item->value ? $this->getSetting('format_custom_true') : $this->getSetting('format_custom_false')];\n      }\n      else {\n        $elements[$delta] = ['#markup' => $item->value ? $formats[$format][0] : $formats[$format][1]];\n      }\n    }\n\n    return $elements;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldFormatter/BooleanFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BooleanFormatter", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ConfirmFormInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Form;\n\n/**\n * Defines the behavior a confirmation form.\n */\ninterface ConfirmFormInterface extends FormInterface {\n\n  /**\n   * Returns the question to ask the user.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n   *   The form question. The page title will be set to this value.\n   */\n  public function getQuestion();\n\n  /**\n   * Returns the route to go to if the user cancels the action.\n   *\n   * @return \\Drupal\\Core\\Url\n   *   A URL object.\n   */\n  public function getCancelUrl();\n\n  /**\n   * Returns additional text to display as a description.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n   *   The form description.\n   */\n  public function getDescription();\n\n  /**\n   * Returns a caption for the button that confirms the action.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n   *   The form confirmation text.\n   */\n  public function getConfirmText();\n\n  /**\n   * Returns a caption for the link which cancels the action.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n   *   The form cancellation text.\n   */\n  public function getCancelText();\n\n  /**\n   * Returns the internal name used to refer to the confirmation item.\n   *\n   * @return string\n   *   The internal form name.\n   */\n  public function getFormName();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Form/ConfirmFormInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfirmFormInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Override of paragraph.html.twig for preview mode\n * Renders the paragraph inside an iframe using the frontend theme for accurate preview.\n *\n * Available variables:\n * - paragraph_bundle: the machine name of the paragraph bundle\n * - paragraph_uuid: the paragraph uuid\n *\n * @see template_preprocess()\n * @see template_preprocess_paragraph__preview()\n *\n * @ingroup themeable\n */\n#}\n{{ attach_library('paragraphs_iframe_preview/paragraph_iframe_preview') }}\n\n<div class=\"paragraph-iframe-preview {{ paragraph_bundle }}\">\n  <iframe src=\"{{ path('paragraphs_iframe_preview.paragraph_iframe_preview', {'paragraph_uuid' : paragraph_uuid }) }}\"\n          title=\"Preview of {{ paragraph_bundle }} paragraph\"></iframe>\n</div>\n", "metadata": {"source": "repos/paragraphs_iframe_preview/templates/paragraph--preview.html.twig", "type": "twig_reference"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override to display a book tree.\n *\n * Returns HTML for a wrapper for a book sub-tree.\n *\n * Available variables:\n * - items: A nested list of book items. Each book item contains:\n *   - attributes: HTML attributes for the book item.\n *   - below: The book item child items.\n *   - title: The book link title.\n *   - url: The book link URL, instance of \\Drupal\\Core\\Url.\n *   - is_expanded: TRUE if the link has visible children within the current\n *     book tree.\n *   - is_collapsed: TRUE if the link has children within the current book tree\n *     that are not currently visible.\n *   - in_active_trail: TRUE if the link is in the active trail.\n */\n#}\n{% import _self as book_tree %}\n\n{#\n  We call a macro which calls itself to render the full tree.\n  @see https://twig.symfony.com/doc/3.x/tags/macro.html\n#}\n{{ book_tree.book_links(items, attributes, 0) }}\n\n{% macro book_links(items, attributes, menu_level) %}\n  {% import _self as book_tree %}\n  {% if items %}\n    {% if menu_level == 0 %}\n      <ul{{ attributes.addClass('book-navigation__menu menu', 'menu--level-' ~ (menu_level + 1)) }}>\n    {% else %}\n      <ul class='menu menu--level-{{ menu_level + 1 }}'>\n    {% endif %}\n    {% for item in items %}\n      {%\n        set item_classes = [\n          'book-navigation__item',\n          'menu__item--level-' ~ (menu_level + 1),\n          item.is_expanded ? 'menu__item--expanded',\n          item.is_collapsed ? 'menu__item--collapsed',\n          item.in_active_trail ? 'menu__item--active-trail',\n        ]\n      %}\n      {% set link_classes = [\n          'book-navigation__link',\n          'menu__link',\n          'menu__link--link',\n          'menu__link--level-' ~ (menu_level + 1),\n          item.in_active_trail ? 'menu__link--active-trail',\n          item.below ? 'menu__link--has-children',\n        ]\n      %}\n      <li{{ item.attributes.addClass(item_classes) }}>\n        {{ link(item.title, item.url, {\n          'class': link_classes\n          })\n        }}\n        {% if item.below %}\n          {{ book_tree.book_links(item.below, attributes, menu_level + 1) }}\n        {% endif %}\n      </li>\n    {% endfor %}\n    </ul>\n  {% endif %}\n{% endmacro %}\n", "metadata": {"source": "repos/livre/book/modules/book_olivero/templates/book-tree.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class Pecl in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Uuid;\n\n/**\n * Generates a UUID using the PECL extension.\n */\nclass Pecl implements UuidInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function generate() {\n    return strtolower(uuid_create(UUID_TYPE_DEFAULT));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Uuid/Pecl.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Pecl", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the configuration files of the Editor module.\n\neditor.editor.*:\n  type: config_entity\n  label: 'Text editor'\n  mapping:\n    format:\n      type: string\n      label: 'Name'\n      constraints:\n        # @see \\Drupal\\editor\\Entity\\Editor::getFilterFormat()\n        # @see \\Drupal\\editor\\Entity\\Editor::calculateDependencies()\n        ConfigExists:\n          prefix: 'filter.format.'\n    editor:\n      type: string\n      label: 'Text editor'\n      constraints:\n        PluginExists:\n          manager: plugin.manager.editor\n          interface: Drupal\\editor\\Plugin\\EditorPluginInterface\n    settings:\n      type: editor.settings.[%parent.editor]\n    image_upload:\n      type: editor.image_upload_settings.[status]\n  constraints:\n    FullyValidatable: ~\n\neditor.image_upload_settings.*:\n  type: mapping\n  label: 'Image uploads'\n  constraints:\n    FullyValidatable: ~\n  mapping:\n    status:\n      type: boolean\n      label: 'Status'\n\neditor.image_upload_settings.1:\n  type: editor.image_upload_settings.*\n  label: 'Image upload settings'\n  constraints:\n    FullyValidatable: ~\n  mapping:\n    scheme:\n      type: string\n      label: 'File storage'\n      constraints:\n        Choice:\n          callback: \\Drupal\\editor\\Entity\\Editor::getValidStreamWrappers\n          message: 'The file storage you selected is not a visible, readable and writable stream wrapper. Possible choices: %choices.'\n    directory:\n      type: string\n      label: 'Upload directory'\n      nullable: true\n      constraints:\n        # `\"\"` is not allowed, but `null` is.\n        NotBlank:\n          allowNull: true\n        Regex:\n          # Forbid any kind of control character.\n          # @see https://stackoverflow.com/a/66587087\n          pattern: '/([^\\PC])/u'\n          match: false\n          message: 'The image upload directory is not allowed to span multiple lines or contain control characters.'\n    max_size:\n      # @see \\Drupal\\file\\Plugin\\Validation\\Constraint\\FileSizeLimitConstraintValidator\n      type: bytes\n      label: 'Maximum file size'\n      nullable: true\n    max_dimensions:\n      type: mapping\n      label: 'Maximum dimensions'\n      mapping:\n        width:\n          type: integer\n          nullable: true\n          label: 'Maximum width'\n          constraints:\n            Range:\n              # @see editor_image_upload_settings_form()\n              min: 1\n              max: 99999\n        height:\n          type: integer\n          nullable: true\n          label: 'Maximum height'\n          constraints:\n            Range:\n              # @see editor_image_upload_settings_form()\n              min: 1\n              max: 99999\n", "metadata": {"source": "repos/drupal_core/core/modules/editor/config/schema/editor.schema.yml", "type": "yaml_reference", "topic": "editor.schema"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Mautic Personalisation", "input": "", "output": "# Mautic Personalisation\n\nIntegrates with Mautic tracking script to capture segment data and provides conditions based on Mautic segments.\n\n## Prerequisites\n\n### Mautic Plugin Installation\n\nThis module requires the [segment-tracking](https://gitlab.internal.dropsolid.com/dropsolid-experience-cloud/marketing-automation/plugins/segment-tracking) plugin to be installed on your Mautic instance. This plugin is responsible for firing the `mauticPageEventDelivered` event that the Drupal module listens for to capture segment data.\n\n### Mautic Tracking Script\n\nThe Mautic tracking script (`mtc.js`) must be loaded on your Drupal site. The placement of the script tag should be before the closing `</body>` tag in order for it to work correctly.\n\n## CORS Configuration\n\n**Note**: CORS (Cross-Origin Resource Sharing) may need to be configured on the **Mautic side** if your Mautic instance is on a different domain than your Drupal site. This is required for the Mautic tracking script (`mtc.js`) to function properly, not specifically for this module's functionality.\n\n## Tracking Script Verification\n\n### Verify Mautic Tracking Script is Loaded\n\n1. **Browser Console Check**:\n   - Open browser developer tools.\n   - Go to the Console tab\n   - Type `MauticJS` or `window.MauticJS` and press Enter\n   - You should see the Mautic tracking object with properties like:\n     - `contactIdUrl`: The URL of your Mautic instance's tracking endpoint\n     - `CORSRequestsAllowed`: Boolean indicating CORS configuration\n     - Various tracking functions (`deliverPageEvent`, `dispatchEvent`, etc.)\n   - Alternatively, you can check `window.mt` or `mt` for the Mautic tracking function object\n\n2. **HTML Source Check**:\n   - View page source.\n   - Search for `mtc.js` in the HTML\n   - Verify the script tag is present before `</body>`\n   - The script should load from your Mautic instance URL\n\n3. **Network Tab Check**:\n   - Open browser developer tools \u2192 Network tab\n   - Reload the page\n   - Look for requests to `/mtc.js` and `/mtc/event` endpoints\n   - Verify these requests are successful (status 200)\n\n## How It Works\n\n1. **Event Listener**: The module listens for the `mauticPageEventDelivered` custom event fired by Mautic's segment-tracking plugin when tracking responses are received.\n2. **Cookie Storage**: Segment aliases are extracted from the event data and stored in a configurable cookie (default: `MAUTIC_SEGMENT`) for server-side access. The cookie name can be customized via the module's settings form.\n3. **Condition Usage**: Content can be configured to show/hide based on specific Mautic segment aliases using the Mautic Segment condition plugin.\n\n### Technical Implementation\n\nThe module uses a class-based JavaScript implementation (`MauticSegmentCookie`) that:\n- Listens for the `mauticPageEventDelivered` event from Mautic's segment-tracking plugin\n- Normalizes segment data (handles arrays, objects, or null values)\n- Sets a cookie with the segment aliases for server-side condition evaluation\n- Uses the cookie name from Drupal settings (configured via the settings form and passed via `drupalSettings`)\n\nThe cookie name is managed through the module's configuration system (`mautic_personalisation.settings`) and can be accessed server-side via the `MauticCookieManager` service.\n\n## Configuration\n\n### Cookie Name Settings\n\nThe cookie name used for storing Mautic segment data can be configured through the module's settings form:\n\n1. Navigate to **Configuration > Web services > Mautic Personalisation** (`/admin/config/services/mautic-personalisation`)\n2. Enter your desired cookie name in the \"Cookie name\" field\n3. Click \"Save configuration\"\n\n**Note**: If the cookie name field is left empty, the module will use the default value `MAUTIC_SEGMENT`. The cookie name can be up to 255 characters long.\n\nAlternatively, you can access the settings form directly from the module's page on the Extend page (`/admin/modules`) by clicking the \"Configure\" link next to the module name.\n\n## Usage\n\n### Using the Condition\n\n1. Edit a block and go to the \"Visibility\" section.\n2. Select \"Mautic Segment\" condition.\n3. Enter segment aliases (one per line) for which the block should be visible.\n4. Leave empty to show for everyone, or use `_unknown` to show only until a segment is determined.\n\n### Cookie Behavior\n\n- Cookie name: Configurable via the settings form (default: `MAUTIC_SEGMENT`)\n- Value format: Comma-separated segment aliases (e.g., `segment1, segment2`)\n- Default value: `_unknown` (when no segments are detected or segments are removed)\n- Expiration: 1 year\n", "metadata": {"source": "repos/mautic_personalisation/README.md", "type": "doc_summary", "topic": "Mautic Personalisation"}}
{"instruction": "Show me the implementation of the class BookOutlineStorage in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Database\\Statement\\FetchAs;\nuse Drupal\\Core\\Database\\StatementInterface;\n\n/**\n * Defines a storage class for books outline.\n */\nclass BookOutlineStorage implements BookOutlineStorageInterface {\n\n  /**\n   * Constructs a BookOutlineStorage object.\n   */\n  public function __construct(protected Connection $connection) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getBooks(): array {\n    return $this->connection->select('book', 'b')->fields('b', ['bid'])->distinct()->execute()->fetchCol();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasBooks(): bool {\n    return (bool) $this->connection->select('book', 'b')->fields('b', ['bid'])->execute()->fetchField();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadMultiple(array $nids, bool $access = TRUE): array {\n    if (class_exists(FetchAs::class)) {\n      $query = $this->connection->select('book', 'b', ['fetch' => FetchAs::Associative]);\n    }\n    else {\n      $query = $this->connection->select('book', 'b', ['fetch' => \\PDO::FETCH_ASSOC]);\n    }\n    $query->fields('b');\n    $query->condition('b.nid', $nids, 'IN');\n\n    if ($access) {\n      $query->addTag('node_access');\n      $query->addMetaData('base_table', 'book');\n    }\n\n    return $query->execute()->fetchAll();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getChildRelativeDepth(array $book_link, int $max_depth): int {\n    $query = $this->connection->select('book');\n    $query->addField('book', 'depth');\n    $query->condition('bid', $book_link['bid']);\n    $query->orderBy('depth', 'DESC');\n    $query->range(0, 1);\n\n    $i = 1;\n    $p = 'p1';\n    while ($i <= $max_depth && $book_link[$p]) {\n      $query->condition($p, $book_link[$p]);\n      $p = 'p' . ++$i;\n    }\n\n    return $query->execute()->fetchField();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete(int $nid): int {\n    return $this->connection->delete('book')\n      ->condition('nid', $nid)\n      ->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadBookChildren(int $pid): array {\n    if (class_exists(FetchAs::class)) {\n      return $this->connection->select('book', 'b')\n        ->fields('b')\n        ->condition('b.pid', $pid)\n        ->execute()->fetchAllAssoc('nid', FetchAs::Associative);\n    }\n    else {\n      return $this->connection->select('book', 'b')\n        ->fields('b')\n        ->condition('b.pid', $pid)\n        ->execute()->fetchAllAssoc('nid', \\PDO::FETCH_ASSOC);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getBookMenuTree(int $bid, array $parameters, int $min_depth, int $max_depth): StatementInterface {\n    $query = $this->connection->select('book');\n    $query->fields('book');\n    for ($i = 1; $i <= $max_depth; $i++) {\n      $query->orderBy('p' . $i);\n    }\n    $query->condition('bid', $bid);\n    if (!empty($parameters['expanded'])) {\n      $query->condition('pid', $parameters['expanded'], 'IN');\n    }\n    if ($min_depth != 1) {\n      $query->condition('depth', $min_depth, '>=');\n    }\n    if (isset($parameters['max_depth'])) {\n      $query->condition('depth', $parameters['max_depth'], '<=');\n    }\n    // Add custom query conditions, if any were passed.\n    if (isset($parameters['conditions'])) {\n      foreach ($parameters['conditions'] as $column => $value) {\n        $query->condition($column, $value);\n      }\n    }\n\n    return $query->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function insert(array $link, array $parents): string|int|null {\n    return $this->connection\n      ->insert('book')\n      ->fields([\n        'nid' => $link['nid'],\n        'bid' => $link['bid'],\n        'pid' => $link['pid'],\n        'weight' => $link['weight'],\n      ] + $parents)\n      ->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function update(int $nid, array $fields): ?int {\n    return $this->connection\n      ->update('book')\n      ->fields($fields)\n      ->condition('nid', $nid)\n      ->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function updateMovedChildren(int $bid, array $original, array $expressions, int $shift): ?int {\n    $query = $this->connection->update('book');\n    $query->fields(['bid' => $bid]);\n\n    foreach ($expressions as $expression) {\n      $query->expression($expression[0], $expression[1], $expression[2]);\n    }\n\n    $query->expression('depth', '[depth] + :depth', [':depth' => $shift]);\n    $query->condition('bid', $original['bid']);\n    $p = 'p1';\n    for ($i = 1; !empty($original[$p]); $p = 'p' . ++$i) {\n      $query->condition($p, $original[$p]);\n    }\n\n    return $query->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function countOriginalLinkChildren(array $original): int {\n    return $this->connection->select('book', 'b')\n      ->condition('bid', $original['bid'])\n      ->condition('pid', $original['pid'])\n      ->condition('nid', $original['nid'], '<>')\n      ->countQuery()\n      ->execute()->fetchField();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getBookSubtree($link, $max_depth): array {\n    if (class_exists(FetchAs::class)) {\n      $query = $this->connection->select('book', 'b', ['fetch' => FetchAs::Associative]);\n    }\n    else {\n      $query = $this->connection->select('book', 'b', ['fetch' => \\PDO::FETCH_ASSOC]);\n    }\n    $query->fields('b');\n    $query->condition('b.bid', $link['bid']);\n\n    for ($i = 1; $i <= $max_depth && $link[\"p$i\"]; ++$i) {\n      $query->condition(\"p$i\", $link[\"p$i\"]);\n    }\n    for ($i = 1; $i <= $max_depth; ++$i) {\n      $query->orderBy(\"p$i\");\n    }\n    return $query->execute()->fetchAll();\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/BookOutlineStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookOutlineStorage", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: CancelUser.php\nTarget symbol: class CancelUser\nNamespace: Drupal\\user\\Plugin\\Action\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CancelUser.\n- Include required imports:\n  - Drupal\\Core\\Action\\ActionBase\n  - Drupal\\Core\\Action\\Attribute\\Action\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\TempStore\\PrivateTempStoreFactory\n- Ensure these methods exist where relevant:\n  - __construct()\n  - access()\n  - execute()\n  - executeMultiple()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\user\\Plugin\\Action;\n\nuse Drupal\\Core\\Action\\ActionBase;\nuse Drupal\\Core\\Action\\Attribute\\Action;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\TempStore\\PrivateTempStoreFactory;\n\n/**\n * Cancels a user account.\n */\n#[Action(\n  id: 'user_cancel_user_action',\n  label: new TranslatableMarkup('Cancel the selected user accounts'),\n  type: 'user',\n  confirm_form_route_name: 'user.multiple_cancel_confirm'\n)]\nclass CancelUser extends ActionBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The tempstore factory.\n   *\n   * @var \\Drupal\\Core\\TempStore\\PrivateTempStoreFactory\n   */\n  protected $tempStoreFactory;\n\n  /**\n   * The current user.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $currentUser;\n\n  /**\n   * Constructs a CancelUser object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\TempStore\\PrivateTempStoreFactory $temp_store_factory\n   *   The tempstore factory.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $current_user\n   *   Current user.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, PrivateTempStoreFactory $temp_store_factory, AccountInterface $current_user) {\n    $this->currentUser = $current_user;\n    $this->tempStoreFactory = $temp_store_factory;\n\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function executeMultiple(array $entities) {\n    $this->tempStoreFactory->get('user_user_operations_cancel')->set($this->currentUser->id(), $entities);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute($object = NULL) {\n    $this->executeMultiple([$object]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function access($object, ?AccountInterface $account = NULL, $return_as_object = FALSE) {\n    /** @var \\Drupal\\user\\UserInterface $object */\n    return $object->access('delete', $account, $return_as_object);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/Action/CancelUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CancelUser", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: RangeConstraintValidator\nSource file: <source_file>\nFile name hint: RangeConstraintValidator.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\Constraints\\Range;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validator for the Drupal 'range' constraint.\n */\nclass RangeConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  function validate($value, Constraint $constraint): void {\n    if (!$constraint instanceof Range) {\n      throw new UnexpectedTypeException($constraint, __NAMESPACE__ . '\\Range');\n    }\n\n    if (NULL === $value) {\n      return;\n    }\n\n    if (!is_numeric($value) && !$value instanceof \\DateTimeInterface) {\n      $this->context->buildViolation($constraint->invalidMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setCode(Range::INVALID_CHARACTERS_ERROR)\n        ->addViolation();\n\n      return;\n    }\n\n    $min = $constraint->min;\n    $max = $constraint->max;\n\n    // Convert strings to DateTimes if comparing another DateTime.\n    // This allows to compare with any date/time value supported by\n    // the DateTime constructor.\n    // @see http://php.net/manual/en/datetime.formats.php\n    if ($value instanceof \\DateTimeInterface) {\n      if (\\is_string($min)) {\n        $min = new \\DateTime($min);\n      }\n\n      if (\\is_string($max)) {\n        $max = new \\DateTime($max);\n      }\n    }\n\n    $hasLowerLimit = NULL !== $constraint->min;\n    $hasUpperLimit = NULL !== $constraint->max;\n\n    if ($hasLowerLimit && $hasUpperLimit && ($value < $min || $value > $max)) {\n      $this->context->buildViolation($constraint->notInRangeMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setParameter('{{ min }}', $this->formatValue($min, self::PRETTY_DATE))\n        ->setParameter('{{ max }}', $this->formatValue($max, self::PRETTY_DATE))\n        ->setCode(Range::NOT_IN_RANGE_ERROR)\n        ->addViolation();\n\n      return;\n    }\n\n    if ($hasUpperLimit && $value > $max) {\n      $this->context->buildViolation($constraint->maxMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setParameter('{{ limit }}', $this->formatValue($max, self::PRETTY_DATE))\n        ->setCode(Range::TOO_HIGH_ERROR)\n        ->addViolation();\n\n      return;\n    }\n\n    if ($hasLowerLimit && $value < $min) {\n      $this->context->buildViolation($constraint->minMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setParameter('{{ limit }}', $this->formatValue($min, self::PRETTY_DATE))\n        ->setCode(Range::TOO_LOW_ERROR)\n        ->addViolation();\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint;\n\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\Constraints\\Range;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validator for the Drupal 'range' constraint.\n */\nclass RangeConstraintValidator extends ConstraintValidator {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate($value, Constraint $constraint): void {\n    if (!$constraint instanceof Range) {\n      throw new UnexpectedTypeException($constraint, __NAMESPACE__ . '\\Range');\n    }\n\n    if (NULL === $value) {\n      return;\n    }\n\n    if (!is_numeric($value) && !$value instanceof \\DateTimeInterface) {\n      $this->context->buildViolation($constraint->invalidMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setCode(Range::INVALID_CHARACTERS_ERROR)\n        ->addViolation();\n\n      return;\n    }\n\n    $min = $constraint->min;\n    $max = $constraint->max;\n\n    // Convert strings to DateTimes if comparing another DateTime.\n    // This allows to compare with any date/time value supported by\n    // the DateTime constructor.\n    // @see http://php.net/manual/en/datetime.formats.php\n    if ($value instanceof \\DateTimeInterface) {\n      if (\\is_string($min)) {\n        $min = new \\DateTime($min);\n      }\n\n      if (\\is_string($max)) {\n        $max = new \\DateTime($max);\n      }\n    }\n\n    $hasLowerLimit = NULL !== $constraint->min;\n    $hasUpperLimit = NULL !== $constraint->max;\n\n    if ($hasLowerLimit && $hasUpperLimit && ($value < $min || $value > $max)) {\n      $this->context->buildViolation($constraint->notInRangeMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setParameter('{{ min }}', $this->formatValue($min, self::PRETTY_DATE))\n        ->setParameter('{{ max }}', $this->formatValue($max, self::PRETTY_DATE))\n        ->setCode(Range::NOT_IN_RANGE_ERROR)\n        ->addViolation();\n\n      return;\n    }\n\n    if ($hasUpperLimit && $value > $max) {\n      $this->context->buildViolation($constraint->maxMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setParameter('{{ limit }}', $this->formatValue($max, self::PRETTY_DATE))\n        ->setCode(Range::TOO_HIGH_ERROR)\n        ->addViolation();\n\n      return;\n    }\n\n    if ($hasLowerLimit && $value < $min) {\n      $this->context->buildViolation($constraint->minMessage)\n        ->setParameter('{{ value }}', $this->formatValue($value, self::PRETTY_DATE))\n        ->setParameter('{{ limit }}', $this->formatValue($min, self::PRETTY_DATE))\n        ->setCode(Range::TOO_LOW_ERROR)\n        ->addViolation();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Validation/Plugin/Validation/Constraint/RangeConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RangeConstraintValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: PluginBase.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Component\\Plugin;\n\n/**\n * Base class for plugins wishing to support metadata inspection.\n */\nabstract class PluginBase implements PluginInspectionInterface, DerivativeInspectionInterface {\n\n  /**\n   * A string which is used to separate base plugin IDs from the derivative ID.\n   */\n  const DERIVATIVE_SEPARATOR = ':';\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  protected $pluginId;\n\n  /**\n   * The plugin implementation definition.\n   *\n   * @var \\Drupal\\Component\\Plugin\\Definition\\PluginDefinitionInterface|array\n   */\n  protected $pluginDefinition;\n\n  /**\n   * Configuration information passed into the plugin.\n   *\n   * When using an interface like\n   * \\Drupal\\Component\\Plugin\\ConfigurableInterface, this is where the\n   * configuration should be stored.\n   *\n   * Plugin configuration is optional, so plugin implementations must provide\n   * their own setters and getters.\n   *\n   * @var array\n   */\n  protected $configuration;\n\n  /**\n   * Constructs a \\Drupal\\Component\\Plugin\\PluginBase object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    $this->configuration = $configuration;\n    $this->pluginId = $plugin_id;\n    $this->pluginDefinition = $plugin_definition;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginId() {\n    return $this->pluginId;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getBaseId() {\n    $plugin_id = $this->getPluginId();\n    if (strpos($plugin_id, static::DERIVATIVE_SEPARATOR)) {\n      [$plugin_id] = explode(static::DERIVATIVE_SEPARATOR, $plugin_id, 2);\n    }\n    return $plugin_id;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeId() {\n    $plugin_id = $this->getPluginId();\n    $derivative_id = NULL;\n    if (strpos($plugin_id, static::DERIVATIVE_SEPARATOR)) {\n      [, $derivative_id] = explode(static::DERIVATIVE_SEPARATOR, $plugin_id, 2);\n    }\n    return $derivative_id;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginDefinition() {\n    return $this->pluginDefinition;\n  }\n\n  /**\n   * Determines if the plugin is configurable.\n   *\n   * @return bool\n   *   A boolean indicating whether the plugin is configurable.\n   *\n   * @deprecated in drupal:11.1.0 and is removed from drupal:12.0.0. Use\n   * instanceof to check if the plugin implements\n   * \\Drupal\\Component\\Plugin\\ConfigurableInterface instead.\n   *\n   * @see https://www.drupal.org/node/3198285\n   */\n  public function isConfigurable() {\n    @trigger_error(__CLASS__ . \"::\" . __FUNCTION__ . \" is deprecated in drupal:11.1.0 and is removed from drupal:12.0.0. Use instanceof to check if the plugin implements \\Drupal\\Component\\Plugin\\ConfigurableInterface instead. See https://www.drupal.org/node/3198285\", E_USER_DEPRECATED);\n    return $this instanceof ConfigurableInterface;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin;\n\n/**\n * Base class for plugins wishing to support metadata inspection.\n */\nabstract class PluginBase implements PluginInspectionInterface, DerivativeInspectionInterface {\n\n  /**\n   * A string which is used to separate base plugin IDs from the derivative ID.\n   */\n  const DERIVATIVE_SEPARATOR = ':';\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  protected $pluginId;\n\n  /**\n   * The plugin implementation definition.\n   *\n   * @var \\Drupal\\Component\\Plugin\\Definition\\PluginDefinitionInterface|array\n   */\n  protected $pluginDefinition;\n\n  /**\n   * Configuration information passed into the plugin.\n   *\n   * When using an interface like\n   * \\Drupal\\Component\\Plugin\\ConfigurableInterface, this is where the\n   * configuration should be stored.\n   *\n   * Plugin configuration is optional, so plugin implementations must provide\n   * their own setters and getters.\n   *\n   * @var array\n   */\n  protected $configuration;\n\n  /**\n   * Constructs a \\Drupal\\Component\\Plugin\\PluginBase object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    $this->configuration = $configuration;\n    $this->pluginId = $plugin_id;\n    $this->pluginDefinition = $plugin_definition;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginId() {\n    return $this->pluginId;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getBaseId() {\n    $plugin_id = $this->getPluginId();\n    if (strpos($plugin_id, static::DERIVATIVE_SEPARATOR)) {\n      [$plugin_id] = explode(static::DERIVATIVE_SEPARATOR, $plugin_id, 2);\n    }\n    return $plugin_id;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeId() {\n    $plugin_id = $this->getPluginId();\n    $derivative_id = NULL;\n    if (strpos($plugin_id, static::DERIVATIVE_SEPARATOR)) {\n      [, $derivative_id] = explode(static::DERIVATIVE_SEPARATOR, $plugin_id, 2);\n    }\n    return $derivative_id;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginDefinition() {\n    return $this->pluginDefinition;\n  }\n\n  /**\n   * Determines if the plugin is configurable.\n   *\n   * @return bool\n   *   A boolean indicating whether the plugin is configurable.\n   *\n   * @deprecated in drupal:11.1.0 and is removed from drupal:12.0.0. Use\n   * instanceof to check if the plugin implements\n   * \\Drupal\\Component\\Plugin\\ConfigurableInterface instead.\n   *\n   * @see https://www.drupal.org/node/3198285\n   */\n  public function isConfigurable() {\n    @trigger_error(__CLASS__ . \"::\" . __FUNCTION__ . \" is deprecated in drupal:11.1.0 and is removed from drupal:12.0.0. Use instanceof to check if the plugin implements \\Drupal\\Component\\Plugin\\ConfigurableInterface instead. See https://www.drupal.org/node/3198285\", E_USER_DEPRECATED);\n    return $this instanceof ConfigurableInterface;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/PluginBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PluginBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: MCP Tools - Recipes", "input": "", "output": "# MCP Tools - Recipes\n\nDrupal Recipes integration for MCP Tools.\n\n## Tools (6)\n\n| Tool | Description |\n|------|-------------|\n| `mcp_recipes_list` | List available recipes |\n| `mcp_recipes_get` | Get recipe details |\n| `mcp_recipes_validate` | Validate recipe before applying |\n| `mcp_recipes_apply` | Apply a recipe to the site |\n| `mcp_recipes_applied` | List applied recipes |\n| `mcp_recipes_create` | Create a new recipe |\n\n## Requirements\n\n- mcp_tools (base module)\n- Drupal 10.3+ (for full recipe support)\n- `admin` scope required for apply operations\n\n## Installation\n\n```bash\ndrush en mcp_tools_recipes\n```\n\n## Example Usage\n\n### List Available Recipes\n\n```\nUser: \"What recipes are available?\"\n\nAI calls: mcp_recipes_list()\n\nReturns: [\n  {id: \"core/recipes/article\", name: \"Article\", description: \"...\"},\n  {id: \"core/recipes/blog\", name: \"Blog\", description: \"...\"},\n  {id: \"core/recipes/image_media_type\", name: \"Image Media Type\", ...},\n  ...\n]\n```\n\n### Apply a Recipe\n\n```\nUser: \"Set up a blog using the blog recipe\"\n\nAI calls:\n1. mcp_recipes_validate(recipe: \"core/recipes/blog\")\n2. mcp_recipes_apply(recipe: \"core/recipes/blog\")\n```\n\n### Get Recipe Details\n\n```\nUser: \"What does the article recipe include?\"\n\nAI calls: mcp_recipes_get(recipe: \"core/recipes/article\")\n\nReturns: {\n  name: \"Article\",\n  description: \"Creates an Article content type...\",\n  config: [...],\n  dependencies: [...]\n}\n```\n\n### Check Applied Recipes\n\n```\nUser: \"What recipes have been applied?\"\n\nAI calls: mcp_recipes_applied()\n\nReturns: [\n  {recipe: \"core/recipes/blog\", applied_at: \"2024-01-15T10:30:00\"},\n  ...\n]\n```\n\n## Core Recipes (Drupal 10.3+)\n\n- `core/recipes/article` - Article content type\n- `core/recipes/blog` - Blog setup with articles\n- `core/recipes/image_media_type` - Image media type\n- `core/recipes/document_media_type` - Document media type\n- `core/recipes/audio_media_type` - Audio media type\n- `core/recipes/video_media_type` - Video media type\n- `core/recipes/remote_video_media_type` - Remote video (YouTube, Vimeo)\n\n## Safety Features\n\n- **Admin scope required:** Apply operations need `admin` scope\n- **Validation first:** Always validate before applying\n- **Non-destructive:** Recipes add configuration, don't overwrite\n- **Audit logging:** All recipe operations logged\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_recipes/README.md", "type": "doc_summary", "topic": "MCP Tools - Recipes"}}
{"instruction": "Show me the implementation of the class ReorderDisplays in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views_ui\\Form\\Ajax;\n\nuse Drupal\\Component\\Render\\FormattableMarkup;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Displays the display reorder form.\n *\n * @internal\n */\nclass ReorderDisplays extends ViewsFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormKey() {\n    return 'reorder-displays';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'views_ui_reorder_displays_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    /** @var \\Drupal\\views\\ViewEntityInterface $view */\n    $view = $form_state->get('view');\n    $display_id = $form_state->get('display_id');\n\n    $form['#title'] = $this->t('Reorder displays');\n    $form['#section'] = 'reorder';\n    $form['#action'] = Url::fromRoute('views_ui.form_reorder_displays', [\n      'js' => 'nojs',\n      'view' => $view->id(),\n      'display_id' => $display_id,\n    ])->toString();\n    $form['view'] = [\n      '#type' => 'value',\n      '#value' => $view,\n    ];\n\n    $displays = $view->get('display');\n    $count = count($displays);\n\n    // Sort the displays.\n    uasort($displays, function ($display1, $display2) {\n      return $display1['position'] <=> $display2['position'];\n    });\n\n    $form['displays'] = [\n      '#type' => 'table',\n      '#id' => 'reorder-displays',\n      '#header' => [$this->t('Display'), $this->t('Weight'), $this->t('Remove')],\n      '#empty' => $this->t('No displays available.'),\n      '#tabledrag' => [\n        [\n          'action' => 'order',\n          'relationship' => 'sibling',\n          'group' => 'weight',\n        ],\n      ],\n      '#tree' => TRUE,\n      '#prefix' => '<div class=\"scroll\" data-drupal-views-scroll>',\n      '#suffix' => '</div>',\n    ];\n\n    foreach ($displays as $id => $display) {\n      $form['displays'][$id] = [\n        '#display' => $display,\n        '#attributes' => [\n          'id' => 'display-row-' . $id,\n        ],\n        '#weight' => $display['position'],\n      ];\n\n      // Only make row draggable if it's not the default display.\n      if ($id !== 'default') {\n        $form['displays'][$id]['#attributes']['class'][] = 'draggable';\n      }\n\n      $form['displays'][$id]['title'] = [\n        '#markup' => $display['display_title'],\n      ];\n\n      $form['displays'][$id]['weight'] = [\n        '#type' => 'weight',\n        '#value' => $display['position'],\n        '#delta' => $count,\n        '#title' => $this->t('Weight for @display', ['@display' => $display['display_title']]),\n        '#title_display' => 'invisible',\n        '#attributes' => [\n          'class' => ['weight'],\n        ],\n      ];\n\n      $form['displays'][$id]['removed'] = [\n        'checkbox' => [\n          '#title' => $this->t('Remove @id', ['@id' => $id]),\n          '#title_display' => 'invisible',\n          '#type' => 'checkbox',\n          '#id' => 'display-removed-' . $id,\n          '#attributes' => [\n            'class' => ['views-remove-checkbox'],\n          ],\n          '#default_value' => !empty($display['deleted']),\n        ],\n        'link' => [\n          '#type' => 'link',\n          '#title' => new FormattableMarkup('<span>@text</span>', ['@text' => $this->t('Remove')]),\n          '#url' => Url::fromRoute('<none>'),\n          '#attributes' => [\n            'id' => 'display-remove-link-' . $id,\n            'class' => ['views-button-remove', 'display-remove-link'],\n            'alt' => $this->t('Remove this display'),\n            'title' => $this->t('Remove this display'),\n          ],\n        ],\n        '#access' => ($id !== 'default'),\n      ];\n\n      if (!empty($display['deleted'])) {\n        $form['displays'][$id]['deleted'] = [\n          '#type' => 'value',\n          '#value' => TRUE,\n        ];\n\n        $form['displays'][$id]['#attributes']['class'][] = 'hidden';\n      }\n\n    }\n\n    $view->getStandardButtons($form, $form_state, 'views_ui_reorder_displays_form');\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    /** @var \\Drupal\\views_ui\\ViewUI $view */\n    $view = $form_state->get('view');\n    $order = [];\n\n    $user_input = $form_state->getUserInput();\n    foreach ($user_input['displays'] as $display => $info) {\n      // Add each value that is a field with a weight to our list, but only if\n      // it has had its 'removed' checkbox checked.\n      if (is_array($info) && isset($info['weight']) && empty($info['removed']['checkbox'])) {\n        $order[$display] = $info['weight'];\n      }\n    }\n\n    // Sort the order array.\n    asort($order);\n\n    // Remove the default display from ordering.\n    unset($order['default']);\n    // Increment up positions.\n    $position = 1;\n\n    foreach (array_keys($order) as $display) {\n      $order[$display] = $position++;\n    }\n\n    // Setting up position and removing deleted displays.\n    $displays = $view->get('display');\n    foreach ($displays as $display_id => &$display) {\n      // Don't touch the default.\n      if ($display_id === 'default') {\n        $display['position'] = 0;\n        continue;\n      }\n      if (isset($order[$display_id])) {\n        $display['position'] = $order[$display_id];\n      }\n      else {\n        $display['deleted'] = TRUE;\n      }\n    }\n    $view->set('display', $displays);\n\n    // Store in cache.\n    $view->cacheSet();\n    $url = $view->toUrl('edit-form')\n      ->setOption('fragment', 'views-tab-default');\n    $form_state->setRedirectUrl($url);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views_ui/src/Form/Ajax/ReorderDisplays.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ReorderDisplays", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PantheonSiTokens in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\n/**\n * @file\n * Exposes Pantheon Secure Integration PHP constants as Drupal tokens.\n */\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\n\n/**\n * Implements hook_token_info().\n */\nfunction pantheon_si_tokens_token_info(): array\n{\n  $config = \\Drupal::config('pantheon_si_tokens.settings');\n  $constants = $config->get('constants') ?? [];\n\n  $info = [\n    'types' => [\n      'pantheon_si_tunnel' => [\n        'name' => t('Pantheon SI Tunnel'),\n        'description' => t(\n          'Tokens for Pantheon Secure Integration tunnel constants.',\n        ),\n      ],\n    ],\n    'tokens' => ['pantheon_si_tunnel' => []],\n  ];\n\n  foreach ($constants as $constant) {\n    $token_name = strtolower($constant);\n    $info['tokens']['pantheon_si_tunnel'][$token_name] = [\n      'name' => $constant,\n      'description' => t(\n        'Value of the @constant PHP constant.',\n        ['@constant' => $constant],\n      ),\n    ];\n  }\n\n  return $info;\n}\n\n/**\n * Implements hook_tokens().\n */\nfunction pantheon_si_tokens_tokens(\n  string $type,\n  array $tokens,\n  array $data = [],\n  array $options = [],\n  BubbleableMetadata $bubbleable_metadata = NULL,\n): array {\n  $replacements = [];\n\n  if ($type !== 'pantheon_si_tunnel') {\n    return $replacements;\n  }\n\n  $config = \\Drupal::config('pantheon_si_tokens.settings');\n  $constants = $config->get('constants') ?? [];\n\n  foreach ($tokens as $name => $original) {\n    $constant_name = strtoupper($name);\n\n    if (!in_array($constant_name, $constants, TRUE)) {\n      continue;\n    }\n\n    if (defined($constant_name)) {\n      $replacements[$original] = constant($constant_name);\n    }\n    else {\n      $replacements[$original] = '';\n    }\n  }\n\n  return $replacements;\n}\n", "metadata": {"source": "repos/pantheon_si_tokens/pantheon_si_tokens.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PantheonSiTokens", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Workspaces\ntype: module\ndescription: 'Provides an API for staging and previewing content in a full site context.'\nversion: VERSION\npackage: Core\ndependencies:\n  - drupal:user\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces/workspaces.info.yml", "type": "yaml_reference", "topic": "workspaces.info"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: LayoutDefinition\nSource file: <source_file>\nFile name hint: LayoutDefinition.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\pinto_layout\\Attribute;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n#[\\Attribute(flags: \\Attribute::TARGET_CLASS)]\nclass LayoutDefinition {\n\n  /**\n   * A name of a static public method can be provided to override automatic behavior.\n   *\n   * @phpstan-param non-empty-string|null $factoryMethod\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   */\n  public function __construct(\n    public ?string $id = NULL,\n    public TranslatableMarkup|string|null $label = NULL,\n    public ?Regions $regions = NULL,\n    public ?string $factoryMethod = NULL,\n    public array $forms = [],\n  ) {\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\Attribute;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n#[\\Attribute(flags: \\Attribute::TARGET_CLASS)]\nclass LayoutDefinition {\n\n  /**\n   * A name of a static public method can be provided to override automatic behavior.\n   *\n   * @phpstan-param non-empty-string|null $factoryMethod\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   */\n  public function __construct(\n    public ?string $id = NULL,\n    public TranslatableMarkup|string|null $label = NULL,\n    public ?Regions $regions = NULL,\n    public ?string $factoryMethod = NULL,\n    public array $forms = [],\n  ) {\n  }\n\n}\n", "metadata": {"source": "repos/pinto_layout/src/Attribute/LayoutDefinition.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutDefinition", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  enforced:\n    module:\n      - ai_image_crop\nid: ai_image_crop_final_focal_point\nlabel: 'AI Image Crop: Final Focal Point Sub-Cell Selection'\nvariables:\n  -\n    name: focus_target\n    help_text: 'Description of what the AI should focus on'\n    required: true\ntokens: {  }\n", "metadata": {"source": "repos/ai_image_crop/config/install/ai.ai_prompt_type.ai_image_crop_final_focal_point.yml", "type": "yaml_reference", "topic": "ai.ai prompt type.ai image crop final focal point"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: PrecedingConstraintAwareValidatorTrait.php\nTarget symbol: trait PrecedingConstraintAwareValidatorTrait\nNamespace: Drupal\\ckeditor5\\Plugin\\Validation\\Constraint\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete trait implementation for PrecedingConstraintAwareValidatorTrait.\n- Include required imports:\n  - Drupal\\Core\\Validation\\ExecutionContext\n  - Symfony\\Component\\Validator\\Constraint\n  - Symfony\\Component\\Validator\\ConstraintViolationInterface\n- Ensure these methods exist where relevant:\n  - getPrecedingConstraints()\n  - hasViolationsForPrecedingConstraints()", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\Validation\\ExecutionContext;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintViolationInterface;\n\n/**\n * A constraint may need preceding constraints to not have been violated.\n *\n * @internal\n */\ntrait PrecedingConstraintAwareValidatorTrait {\n\n  /**\n   * Checks whether any preceding constraints have been violated.\n   *\n   * @param \\Symfony\\Component\\Validator\\Constraint $current_constraint\n   *   The constraint currently being validated.\n   *\n   * @return bool\n   *   TRUE if any preceding constraints have been violated, FALSE otherwise.\n   */\n  protected function hasViolationsForPrecedingConstraints(Constraint $current_constraint): bool {\n    assert($this->context instanceof ExecutionContext);\n    $earlier_constraints = iterator_to_array($this->getPrecedingConstraints($current_constraint));\n    $earlier_violations = array_filter(\n      iterator_to_array($this->context->getViolations()),\n      function (ConstraintViolationInterface $violation) use ($earlier_constraints) {\n        return in_array($violation->getConstraint(), $earlier_constraints);\n      }\n    );\n    return !empty($earlier_violations);\n  }\n\n  /**\n   * Gets the constraints preceding the given constraint in the current context.\n   *\n   * @param \\Symfony\\Component\\Validator\\Constraint $needle\n   *   The constraint to find the preceding constraints for.\n   *\n   * @return iterable\n   *   The preceding constraints.\n   */\n  private function getPrecedingConstraints(Constraint $needle): iterable {\n    assert($this->context instanceof ExecutionContext);\n    $constraints = $this->context->getMetadata()->getConstraints();\n    if (!in_array($needle, $constraints)) {\n      throw new \\OutOfBoundsException();\n    }\n    foreach ($constraints as $constraint) {\n      if ($constraint != $needle) {\n        yield $constraint;\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Plugin/Validation/Constraint/PrecedingConstraintAwareValidatorTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "PrecedingConstraintAwareValidatorTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for views listing table.\n *\n * Available variables:\n * - headers: Contains table headers.\n * - rows: Contains multiple rows. Each row contains:\n *   - view_name: The human-readable name of the view.\n *   - machine_name: Machine name of the view.\n *   - description: The description of the view.\n *   - displays: List of displays attached to the view.\n *   - operations: List of available operations.\n *\n * @see template_preprocess_views_ui_views_listing_table()\n *\n * @ingroup themeable\n */\n#}\n<table{{ attributes.addClass('responsive-enabled') }}>\n  <thead>\n    <tr>\n      {% for header in headers %}\n        <th{{ header.attributes }}>{{ header.data }}</th>\n      {% endfor %}\n    </tr>\n  </thead>\n  <tbody>\n    {% for row in rows %}\n      <tr{{ row.attributes }}>\n        <td class=\"views-ui-view-name\">\n          <strong data-drupal-selector=\"views-table-filter-text-source\">{{ row.data.view_name.data }}</strong>\n        </td>\n        <td class=\"views-ui-view-machine-name\" data-drupal-selector=\"views-table-filter-text-source\">\n          {{ row.data.machine_name.data }}\n        </td>\n        <td class=\"views-ui-view-description\" data-drupal-selector=\"views-table-filter-text-source\">\n          {{ row.data.description.data }}\n        </td>\n        <td class=\"views-ui-view-displays\">\n          {{ row.data.displays.data }}\n        </td>\n        <td class=\"views-ui-view-operations\">\n          {{ row.data.operations.data }}\n        </td>\n      </tr>\n    {% endfor %}\n  </tbody>\n</table>\n", "metadata": {"source": "repos/drupal_core/core/modules/views_ui/templates/views-ui-views-listing-table.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class BookRemoveForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Form;\n\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\node\\NodeInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Remove form for book module.\n *\n * @internal\n */\nclass BookRemoveForm extends ConfirmFormBase {\n\n  /**\n   * The node representing the book.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   */\n  protected NodeInterface $node;\n\n  /**\n   * Constructs a BookRemoveForm object.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The book manager.\n   */\n  public function __construct(protected BookManagerInterface $bookManager) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'book_remove_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state, ?NodeInterface $node = NULL): array {\n    $this->node = $node;\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): TranslatableMarkup {\n    $title = ['%title' => $this->node->label()];\n    $book = $this->node->getBook();\n    if (isset($book['has_children']) && $book['has_children']) {\n      return $this->t('%title has associated child pages, which will be relocated automatically to maintain their connection to the book. To recreate the hierarchy (as it was before removing this page), %title may be added again using the Outline tab, and each of its former child pages will need to be relocated manually.', $title);\n    }\n    else {\n      return $this->t('%title may be added to hierarchy again using the Outline tab.', $title);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText(): TranslatableMarkup {\n    return $this->t('Remove');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion(): TranslatableMarkup {\n    return $this->t('Are you sure you want to remove %title from the book hierarchy?', ['%title' => $this->node->label()]);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function getCancelUrl(): Url {\n    return $this->node->toUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    if ($this->bookManager->checkNodeIsRemovable($this->node)) {\n      $this->bookManager->deleteFromBook($this->node->id());\n      $this->messenger()->addStatus($this->t('The post has been removed from the book.'));\n    }\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Form/BookRemoveForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookRemoveForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Insert in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\sqlite\\Driver\\Database\\sqlite;\n\nuse Drupal\\Core\\Database\\DatabaseExceptionWrapper;\nuse Drupal\\Core\\Database\\Query\\Insert as QueryInsert;\n\n/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Query\\Insert.\n *\n * We ignore all the default fields and use the clever SQLite syntax:\n *   INSERT INTO table DEFAULT VALUES\n * for degenerated \"default only\" queries.\n */\nclass Insert extends QueryInsert {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    if (!$this->preExecute()) {\n      return NULL;\n    }\n\n    // If we're selecting from a SelectQuery, finish building the query and\n    // pass it back, as any remaining options are irrelevant.\n    if (!empty($this->fromQuery)) {\n      // The SelectQuery may contain arguments, load and pass them through.\n      return $this->connection->query((string) $this, $this->fromQuery->getArguments(), $this->queryOptions);\n    }\n\n    // If there are any fields in the query, execute normal INSERT statements.\n    if (count($this->insertFields)) {\n      $stmt = $this->connection->prepareStatement((string) $this, $this->queryOptions);\n\n      if (count($this->insertValues) === 1) {\n        // Inserting a single row does not require a transaction to be atomic,\n        // and executes faster without a transaction wrapper.\n        $insert_values = $this->insertValues[0];\n        try {\n          $stmt->execute($insert_values, $this->queryOptions);\n        }\n        catch (\\Exception $e) {\n          $this->connection->exceptionHandler()->handleExecutionException($e, $stmt, $insert_values, $this->queryOptions);\n        }\n      }\n      else {\n        // Inserting multiple rows requires a transaction to be atomic, and\n        // executes faster as a single transaction.\n        try {\n          $transaction = $this->connection->startTransaction();\n        }\n        catch (\\PDOException $e) {\n          // $this->connection->exceptionHandler()->handleExecutionException()\n          // requires a $statement argument, so we cannot use that.\n          throw new DatabaseExceptionWrapper($e->getMessage(), 0, $e);\n        }\n        foreach ($this->insertValues as $insert_values) {\n          try {\n            $stmt->execute($insert_values, $this->queryOptions);\n          }\n          catch (\\Exception $e) {\n            // One of the INSERTs failed, rollback the whole batch.\n            $transaction->rollBack();\n            $this->connection->exceptionHandler()->handleExecutionException($e, $stmt, $insert_values, $this->queryOptions);\n          }\n        }\n      }\n      // Re-initialize the values array so that we can re-use this query.\n      $this->insertValues = [];\n    }\n    // If there are no fields in the query, execute an INSERT statement that\n    // only populates default values.\n    else {\n      $stmt = $this->connection->prepareStatement(\"INSERT INTO {{$this->table}} DEFAULT VALUES\", $this->queryOptions);\n      try {\n        $stmt->execute(NULL, $this->queryOptions);\n      }\n      catch (\\Exception $e) {\n        $this->connection->exceptionHandler()->handleExecutionException($e, $stmt, [], $this->queryOptions);\n      }\n    }\n\n    return $this->connection->lastInsertId();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __toString() {\n    // Create a sanitized comment string to prepend to the query.\n    $comments = $this->connection->makeComment($this->comments);\n\n    // Produce as many generic placeholders as necessary.\n    $placeholders = [];\n    if (!empty($this->insertFields)) {\n      $placeholders = array_fill(0, count($this->insertFields), '?');\n    }\n\n    $insert_fields = array_map(function ($field) {\n      return $this->connection->escapeField($field);\n    }, $this->insertFields);\n\n    // If we're selecting from a SelectQuery, finish building the query and\n    // pass it back, as any remaining options are irrelevant.\n    if (!empty($this->fromQuery)) {\n      $insert_fields_string = $insert_fields ? ' (' . implode(', ', $insert_fields) . ') ' : ' ';\n      return $comments . 'INSERT INTO {' . $this->table . '}' . $insert_fields_string . $this->fromQuery;\n    }\n\n    return $comments . 'INSERT INTO {' . $this->table . '} (' . implode(', ', $insert_fields) . ') VALUES (' . implode(', ', $placeholders) . ')';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/sqlite/src/Driver/Database/sqlite/Insert.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Insert", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ContentTranslationHandlerInterface.php\nTarget symbol: interface ContentTranslationHandlerInterface\nNamespace: Drupal\\content_translation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for ContentTranslationHandlerInterface.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - entityFormAlter()\n  - getFieldDefinitions()\n  - getSourceLangcode()\n  - getTranslationAccess()\n  - retranslate()", "output": "<?php\n\nnamespace Drupal\\content_translation;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Interface for providing content translation.\n *\n * Defines a set of methods to allow any entity to be processed by the entity\n * translation UI.\n */\ninterface ContentTranslationHandlerInterface {\n\n  /**\n   * Returns a set of field definitions to be used to store metadata items.\n   *\n   * @return \\Drupal\\Core\\Field\\FieldDefinitionInterface[]\n   *   The field definitions.\n   */\n  public function getFieldDefinitions();\n\n  /**\n   * Checks that the user can perform the operation on the entity translation.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity whose translation has to be accessed.\n   * @param string $op\n   *   The operation to be performed on the translation. Possible values are:\n   *   - \"create\".\n   *   - \"update\".\n   *   - \"delete\".\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function getTranslationAccess(EntityInterface $entity, $op);\n\n  /**\n   * Retrieves the source language for the translation being created.\n   *\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return string\n   *   The source language code.\n   */\n  public function getSourceLangcode(FormStateInterface $form_state);\n\n  /**\n   * Marks translations as outdated.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity being translated.\n   * @param string $langcode\n   *   (optional) The language code of the updated language: all the other\n   *   translations will be marked as outdated. Defaults to the entity language.\n   */\n  public function retranslate(EntityInterface $entity, $langcode = NULL);\n\n  /**\n   * Performs the needed alterations to the entity form.\n   *\n   * @param array $form\n   *   The entity form to be altered to provide the translation workflow.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity being created or edited.\n   */\n  public function entityFormAlter(array &$form, FormStateInterface $form_state, EntityInterface $entity);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/src/ContentTranslationHandlerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ContentTranslationHandlerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "apidog_integration.settings:\n  type: config_object\n  label: 'Apidog Integration Settings'\n  mapping:\n    instance_url:\n      type: string\n      label: 'Apidog Instance URL'\n      nullable: true\n    api_token_key:\n      type: string\n      label: 'API Token Key'\n      nullable: true\n    default_project_id:\n      type: string\n      label: 'Default Project ID'\n      nullable: true\n    import_method:\n      type: string\n      label: 'Import Method'\n    auto_import_enabled:\n      type: boolean\n      label: 'Auto Import Enabled'\n    import_interval:\n      type: integer\n      label: 'Import Interval (minutes)'\n", "metadata": {"source": "repos/api_normalization/modules/apidog_integration/config/schema/apidog_integration.schema.yml", "type": "yaml_reference", "topic": "apidog integration.schema"}}
{"instruction": "Show me the implementation of the interface McpServerInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_client;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\mcp_client\\ValueObject\\ToolInterface;\nuse Drupal\\mcp_client\\ValueObject\\ToolCollectionInterface;\n\n/**\n * Provides an interface defining a MCP Server entity type.\n */\ninterface McpServerInterface extends ConfigEntityInterface {\n\n  /**\n   * Gets the server description.\n   *\n   * @return string\n   *   The description.\n   */\n  public function getDescription(): string;\n\n  /**\n   * Sets the server description.\n   *\n   * @param string $description\n   *   The description.\n   *\n   * @return $this\n   */\n  public function setDescription(string $description): self;\n\n  /**\n   * Gets the server endpoint URL.\n   *\n   * @return string\n   *   The endpoint URL.\n   */\n  public function getEndpoint(): string;\n\n  /**\n   * Sets the server endpoint URL.\n   *\n   * @param string $endpoint\n   *   The endpoint URL.\n   *\n   * @return $this\n   */\n  public function setEndpoint(string $endpoint): self;\n\n  /**\n   * Gets the transport type.\n   *\n   * @return string\n   *   The transport type (http|stdio).\n   */\n  public function getTransportType(): string;\n\n  /**\n   * Sets the transport type.\n   *\n   * @param string $transport_type\n   *   The transport type (http|stdio).\n   *\n   * @return $this\n   */\n  public function setTransportType(string $transport_type): self;\n\n  /**\n   * Gets the STDIO command.\n   *\n   * @return string|null\n   *   The STDIO command or null.\n   */\n  public function getStdioCommand(): ?string;\n\n  /**\n   * Sets the STDIO command.\n   *\n   * @param string|null $stdio_command\n   *   The STDIO command.\n   *\n   * @return $this\n   */\n  public function setStdioCommand(?string $stdio_command): self;\n\n  /**\n   * Gets the STDIO environment variables.\n   *\n   * @return array<string, string>\n   *   Array of environment variables.\n   */\n  public function getStdioEnv(): array;\n\n  /**\n   * Sets the STDIO environment variables.\n   *\n   * @param array<string, string> $stdio_env\n   *   Array of environment variables.\n   *\n   * @return self\n   *   The MCP Server instance.\n   */\n  public function setStdioEnv(array $stdio_env): self;\n\n  /**\n   * Gets the STDIO working directory.\n   *\n   * @return string|null\n   *   The working directory or null.\n   */\n  public function getStdioCwd(): ?string;\n\n  /**\n   * Sets the STDIO working directory.\n   *\n   * @param string|null $stdio_cwd\n   *   The working directory.\n   *\n   * @return self\n   *   The MCP Server instance.\n   */\n  public function setStdioCwd(?string $stdio_cwd): self;\n\n  /**\n   * Gets the HTTP timeout in seconds.\n   *\n   * @return int\n   *   The timeout in seconds.\n   */\n  public function getTimeout(): int;\n\n  /**\n   * Sets the HTTP timeout in seconds.\n   *\n   * @param int $timeout\n   *   The timeout in seconds.\n   *\n   * @return self\n   *   The MCP Server instance.\n   */\n  public function setTimeout(int $timeout): self;\n\n  /**\n   * Gets the HTTP headers.\n   *\n   * @return array<string, string>\n   *   Array of HTTP headers.\n   */\n  public function getHttpHeaders(): array;\n\n  /**\n   * Sets the HTTP headers.\n   *\n   * @param array<string, string> $http_headers\n   *   Array of HTTP headers.\n   *\n   * @return self\n   *   The MCP Server instance.\n   */\n  public function setHttpHeaders(array $http_headers): self;\n\n  /**\n   * Gets the tool collection.\n   *\n   * @return \\Drupal\\mcp_client\\ValueObject\\ToolCollectionInterface\n   *   The tool collection.\n   */\n  public function getTools(): ToolCollectionInterface;\n\n  /**\n   * Sets the tool collection.\n   *\n   * @param \\Drupal\\mcp_client\\ValueObject\\ToolCollectionInterface $tools\n   *   The tool collection.\n   *\n   * @return self\n   *   The MCP Server instance.\n   */\n  public function setTools(ToolCollectionInterface $tools): self;\n\n  /**\n   * Gets a specific tool by name.\n   *\n   * @param string $name\n   *   The tool name.\n   *\n   * @return \\Drupal\\mcp_client\\ValueObject\\ToolInterface|null\n   *   The tool or null if not found.\n   */\n  public function getTool(string $name): ?ToolInterface;\n\n  /**\n   * Checks if a tool exists.\n   *\n   * @param string $name\n   *   The tool name.\n   *\n   * @return bool\n   *   True if the tool exists.\n   */\n  public function hasTool(string $name): bool;\n\n}\n", "metadata": {"source": "repos/mcp_client/src/McpServerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "McpServerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: MediaStorage.php\nTarget symbol: class for\nNamespace: Drupal\\media\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage\n- Ensure these methods exist where relevant:\n  - save()", "output": "<?php\n\nnamespace Drupal\\media;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage;\n\n/**\n * Defines the storage handler class for media.\n *\n * The default storage is overridden to handle metadata fetching outside of the\n * database transaction.\n */\nclass MediaStorage extends SqlContentEntityStorage {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(EntityInterface $media) {\n    // For backwards compatibility, modules that override the Media entity\n    // class, are not required to implement the prepareSave() method.\n    // @todo For Drupal 8.7, consider throwing a deprecation notice if the\n    //   method doesn't exist. See\n    //   https://www.drupal.org/project/drupal/issues/2992426 for further\n    //   discussion.\n    if (method_exists($media, 'prepareSave')) {\n      $media->prepareSave();\n    }\n    return parent::save($media);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/MediaStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaStorage", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class MapApiFieldsTool in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\AiAgents\\Tool;\n\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\ai_agents\\Attribute\\Tool;\nuse Drupal\\ai_agents\\Tool\\ToolPluginBase;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\api_normalization\\Service\\AiSchemaMapper;\n\n/**\n * Tool for mapping API fields to schema.org properties.\n */\n#[Tool(\n  id: 'api_normalization.map_fields',\n  label: new TranslatableMarkup('Map API Fields'),\n  description: new TranslatableMarkup('Map API endpoint fields to schema.org properties using AI.'),\n)]\nclass MapApiFieldsTool extends ToolPluginBase {\n\n  /**\n   * The AI schema mapper service.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\AiSchemaMapper\n   */\n  protected AiSchemaMapper $schemaMapper;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    AiSchemaMapper $schema_mapper,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->schemaMapper = $schema_mapper;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('api_normalization.ai_schema_mapper'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getToolDefinition(): array {\n    return [\n      'type' => 'object',\n      'properties' => [\n        'fields' => [\n          'type' => 'array',\n          'description' => 'Array of field definitions with name, type, and description',\n          'items' => [\n            'type' => 'object',\n            'properties' => [\n              'name' => ['type' => 'string'],\n              'type' => ['type' => 'string'],\n              'description' => ['type' => 'string'],\n            ],\n          ],\n          'required' => TRUE,\n        ],\n        'schema_type' => [\n          'type' => 'string',\n          'description' => 'Target schema.org type (e.g., \"Article\", \"Person\", \"Product\")',\n          'default' => 'Thing',\n        ],\n      ],\n      'required' => ['fields'],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(array $parameters = []): array {\n    $fields = $parameters['fields'] ?? [];\n    $schema_type = $parameters['schema_type'] ?? 'Thing';\n\n    if (empty($fields)) {\n      return [\n        'success' => FALSE,\n        'error' => 'Fields array is required',\n      ];\n    }\n\n    try {\n      // Build field analysis structure.\n      $field_analysis = [];\n      foreach ($fields as $field) {\n        $field_analysis[$field['name']] = [\n          'type' => $field['type'] ?? 'string',\n          'label' => $field['name'],\n          'description' => $field['description'] ?? '',\n          'value' => '',\n        ];\n      }\n\n      // Generate mappings.\n      $mappings = [];\n      foreach ($field_analysis as $field_name => $field_data) {\n        $mapping = $this->schemaMapper->getAiFieldMapping(\n          $field_data,\n          $schema_type\n        );\n        if ($mapping && isset($mapping['schema_property'])) {\n          $mappings[$field_name] = $mapping;\n        }\n      }\n\n      return [\n        'success' => TRUE,\n        'mappings' => $mappings,\n        'schema_type' => $schema_type,\n      ];\n    }\n    catch (\\Exception $e) {\n      return [\n        'success' => FALSE,\n        'error' => $e->getMessage(),\n      ];\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/AiAgents/Tool/MapApiFieldsTool.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MapApiFieldsTool", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class NodeExecutionContext in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\DTO\\Runtime;\n\nuse Drupal\\flowdrop\\DTO\\OutputInterface;\n\n/**\n * Execution context for a workflow run.\n */\nclass NodeExecutionContext {\n\n  public function __construct(\n    private readonly string $workflowId,\n    private readonly string $pipelineId,\n    private readonly array $initialData,\n    private array $nodeOutputs = [],\n    private array $metadata = [],\n  ) {}\n\n  /**\n   * Get the workflow ID.\n   *\n   * @return string\n   *   The workflow ID.\n   */\n  public function getWorkflowId(): string {\n    return $this->workflowId;\n  }\n\n  /**\n   * Get the pipeline ID.\n   *\n   * @return string\n   *   The pipeline ID.\n   */\n  public function getPipelineId(): string {\n    return $this->pipelineId;\n  }\n\n  /**\n   * Get the initial data.\n   *\n   * @return array\n   *   The initial data array.\n   */\n  public function getInitialData(): array {\n    return $this->initialData;\n  }\n\n  /**\n   * Get all node outputs.\n   *\n   * @return array\n   *   Array of node outputs keyed by node ID.\n   */\n  public function getNodeOutputs(): array {\n    return $this->nodeOutputs;\n  }\n\n  /**\n   * Get output for a specific node.\n   *\n   * @param string $nodeId\n   *   The node ID.\n   *\n   * @return \\Drupal\\flowdrop\\DTO\\OutputInterface|null\n   *   The node output or NULL if not found.\n   */\n  public function getNodeOutput(string $nodeId): ?OutputInterface {\n    return $this->nodeOutputs[$nodeId] ?? NULL;\n  }\n\n  /**\n   * Add output for a node.\n   *\n   * @param string $nodeId\n   *   The node ID.\n   * @param \\Drupal\\flowdrop\\DTO\\OutputInterface $output\n   *   The node output.\n   */\n  public function addNodeOutput(string $nodeId, OutputInterface $output): void {\n    $this->nodeOutputs[$nodeId] = $output;\n  }\n\n  /**\n   * Get metadata.\n   *\n   * @return array\n   *   The metadata array.\n   */\n  public function getMetadata(): array {\n    return $this->metadata;\n  }\n\n  /**\n   * Set metadata.\n   *\n   * @param array $metadata\n   *   The metadata array.\n   */\n  public function setMetadata(array $metadata): void {\n    $this->metadata = $metadata;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/DTO/Runtime/NodeExecutionContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeExecutionContext", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface OutboundPathProcessorInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\PathProcessor;\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Defines an interface for classes that process the outbound path.\n */\ninterface OutboundPathProcessorInterface {\n\n  /**\n   * Processes the outbound path.\n   *\n   * @param string $path\n   *   The path to process, with a leading slash.\n   * @param array $options\n   *   (optional) An associative array of additional options, with the following\n   *   elements:\n   *   - 'query': An array of query key/value-pairs (without any URL-encoding)\n   *     to append to the URL.\n   *   - 'fragment': A fragment identifier (named anchor) to append to the URL.\n   *     Do not include the leading '#' character.\n   *   - 'absolute': Defaults to FALSE. Whether to force the output to be an\n   *     absolute link (beginning with http:). Useful for links that will be\n   *     displayed outside the site, such as in an RSS feed.\n   *   - 'language': An optional language object used to look up the alias\n   *     for the URL. If $options['language'] is omitted, it defaults to the\n   *     current language for the language type LanguageInterface::TYPE_URL.\n   *   - 'https': Whether this URL should point to a secure location. If not\n   *     defined, the current scheme is used, so the user stays on HTTP or HTTPS\n   *     respectively. TRUE enforces HTTPS and FALSE enforces HTTP.\n   *   - 'base_url': Only used internally by a path processor, for example, to\n   *     modify the base URL when a language dependent URL requires so.\n   *   - 'prefix': Only used internally, to modify the path when a language\n   *     dependent URL requires so.\n   *   - 'route': The route object for the given path. It will be set by\n   *     \\Drupal\\Core\\Routing\\UrlGenerator::generateFromRoute().\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The HttpRequest object representing the current request.\n   * @param \\Drupal\\Core\\Render\\BubbleableMetadata $bubbleable_metadata\n   *   (optional) Object to collect path processors' bubbleable metadata.\n   *\n   * @return string\n   *   The processed path.\n   */\n  public function processOutbound($path, &$options = [], ?Request $request = NULL, ?BubbleableMetadata $bubbleable_metadata = NULL);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/PathProcessor/OutboundPathProcessorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "OutboundPathProcessorInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ConfigurableImageEffectInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\image;\n\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Defines the interface for configurable image effects.\n *\n * @see \\Drupal\\image\\Annotation\\ImageEffect\n * @see \\Drupal\\image\\ConfigurableImageEffectBase\n * @see \\Drupal\\image\\ImageEffectInterface\n * @see \\Drupal\\image\\ImageEffectBase\n * @see \\Drupal\\image\\ImageEffectManager\n * @see plugin_api\n */\ninterface ConfigurableImageEffectInterface extends ImageEffectInterface, PluginFormInterface {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/src/ConfigurableImageEffectInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfigurableImageEffectInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ContextualLinksPlaceholder\nSource file: <source_file>\nFile name hint: ContextualLinksPlaceholder.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\contextual\\Element;\n\nuse Drupal\\Component\\Utility\\Crypt;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Site\\Settings;\nuse Drupal\\Core\\Template\\Attribute;\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\nuse Drupal\\Core\\Render\\Element\\RenderElementBase;\nuse Drupal\\Component\\Render\\FormattableMarkup;\n\n/**\n * Provides a contextual_links_placeholder element.\n */\n#[RenderElement('contextual_links_placeholder')]\nclass ContextualLinksPlaceholder extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#pre_render' => [\n        [static::class, 'preRenderPlaceholder'],\n      ],\n      '#id' => NULL,\n    ];\n  }\n\n  /**\n   * Pre-render callback: Renders a contextual links placeholder into #markup.\n   *\n   * Renders an empty (hence invisible) placeholder div with a data-attribute\n   * that contains an identifier (\"contextual id\"), which allows the JavaScript\n   * of the drupal.contextual-links library to dynamically render contextual\n   * links.\n   *\n   * @param array $element\n   *   A structured array with #id containing a \"contextual id\".\n   *\n   * @return array\n   *   The passed-in element with a contextual link placeholder in '#markup'.\n   *\n   * @see \\Drupal\\contextual\\ContextualLinksSerializer::linksToId()\n   */\n  public static function preRenderPlaceholder(array $element) {\n    $token = Crypt::hmacBase64($element['#id'], Settings::getHashSalt() . \\Drupal::service('private_key')->get());\n    $attribute = new Attribute([\n      'data-contextual-id' => $element['#id'],\n      'data-contextual-token' => $token,\n      'data-drupal-ajax-container' => '',\n    ]);\n    $element['#markup'] = new FormattableMarkup('<div@attributes></div>', ['@attributes' => $attribute]);\n    $element['#attached']['drupalSettings']['contextual']['theme'] = \\Drupal::service('theme.manager')->getActiveTheme()->getName();\n    $cache = CacheableMetadata::createFromRenderArray($element);\n    $cache->addCacheContexts(['theme']);\n    $cache->applyTo($element);\n\n    return $element;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\contextual\\Element;\n\nuse Drupal\\Component\\Utility\\Crypt;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Site\\Settings;\nuse Drupal\\Core\\Template\\Attribute;\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\nuse Drupal\\Core\\Render\\Element\\RenderElementBase;\nuse Drupal\\Component\\Render\\FormattableMarkup;\n\n/**\n * Provides a contextual_links_placeholder element.\n */\n#[RenderElement('contextual_links_placeholder')]\nclass ContextualLinksPlaceholder extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#pre_render' => [\n        [static::class, 'preRenderPlaceholder'],\n      ],\n      '#id' => NULL,\n    ];\n  }\n\n  /**\n   * Pre-render callback: Renders a contextual links placeholder into #markup.\n   *\n   * Renders an empty (hence invisible) placeholder div with a data-attribute\n   * that contains an identifier (\"contextual id\"), which allows the JavaScript\n   * of the drupal.contextual-links library to dynamically render contextual\n   * links.\n   *\n   * @param array $element\n   *   A structured array with #id containing a \"contextual id\".\n   *\n   * @return array\n   *   The passed-in element with a contextual link placeholder in '#markup'.\n   *\n   * @see \\Drupal\\contextual\\ContextualLinksSerializer::linksToId()\n   */\n  public static function preRenderPlaceholder(array $element) {\n    $token = Crypt::hmacBase64($element['#id'], Settings::getHashSalt() . \\Drupal::service('private_key')->get());\n    $attribute = new Attribute([\n      'data-contextual-id' => $element['#id'],\n      'data-contextual-token' => $token,\n      'data-drupal-ajax-container' => '',\n    ]);\n    $element['#markup'] = new FormattableMarkup('<div@attributes></div>', ['@attributes' => $attribute]);\n    $element['#attached']['drupalSettings']['contextual']['theme'] = \\Drupal::service('theme.manager')->getActiveTheme()->getName();\n    $cache = CacheableMetadata::createFromRenderArray($element);\n    $cache->addCacheContexts(['theme']);\n    $cache->applyTo($element);\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contextual/src/Element/ContextualLinksPlaceholder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContextualLinksPlaceholder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class Tag in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\cache;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsCache;\n\n/**\n * Simple caching of query results for Views displays.\n *\n * @ingroup views_cache_plugins\n */\n#[ViewsCache(\n  id: 'tag',\n  title: new TranslatableMarkup('Tag based'),\n  help: new TranslatableMarkup('Tag based caching of data. Caches will persist until any related cache tags are invalidated.'),\n)]\nclass Tag extends CachePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summaryTitle() {\n    return $this->t('Tag');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function cacheExpire($type) {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultCacheMaxAge() {\n    return CacheBackendInterface::CACHE_PERMANENT;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/cache/Tag.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Tag", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Merge in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\pgsql\\Driver\\Database\\pgsql;\n\nuse Drupal\\Core\\Database\\Query\\Merge as QueryMerge;\n\n@trigger_error('Extending from \\Drupal\\pgsql\\Driver\\Database\\pgsql\\Merge is deprecated in drupal:11.0.0 and is removed from drupal:12.0.0. Extend from the base class instead. See https://www.drupal.org/node/3256524', E_USER_DEPRECATED);\n\n/**\n * PostgreSQL implementation of \\Drupal\\Core\\Database\\Query\\Merge.\n */\nclass Merge extends QueryMerge {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/pgsql/src/Driver/Database/pgsql/Merge.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Merge", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Value.php\nTarget symbol: class Value\nNamespace: Drupal\\Core\\Render\\Element\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Value.\n- Include required imports:\n  - Drupal\\Core\\Render\\Attribute\\FormElement\n- Ensure these methods exist where relevant:\n  - getInfo()", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\FormElement;\n\n/**\n * Provides a form element for storage of internal information.\n *\n * Unlike \\Drupal\\Core\\Render\\Element\\Hidden, this information is not sent to\n * the browser in a hidden form field, but only stored in the form array for use\n * in validation and submit processing.\n *\n * Properties:\n * - #value: The value of the form element that cannot be edited by the user.\n *\n * Usage Example:\n * @code\n * $form['entity_id'] = ['#type' => 'value', '#value' => $entity_id];\n * @endcode\n */\n#[FormElement('value')]\nclass Value extends FormElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#input' => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/Value.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Value", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Content editor role'\ndescription: 'Provides the Content editor role.'\ntype: 'User role'\ninstall:\n  # Node provides the `view own unpublished content` permission.\n  - node\nconfig:\n  # If the content_editor role already exists, we don't really care what it looks like.\n  strict: false\n  actions:\n    user.role.content_editor:\n      grantPermissions:\n        - 'access administration pages'\n        - 'view own unpublished content'\n", "metadata": {"source": "repos/drupal_core/core/recipes/content_editor_role/recipe.yml", "type": "yaml_reference", "topic": "recipe"}}
{"instruction": "Show me the implementation of the class CreateWebform in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_create_webform',\n  label: new TranslatableMarkup('Create Webform'),\n  description: new TranslatableMarkup('Create a new webform with elements.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform machine name'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'title' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'elements' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Elements definition'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'status' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateWebform extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $id = $input['id'] ?? '';\n    $title = $input['title'] ?? '';\n\n    if (empty($id) || empty($title)) {\n      return ['success' => FALSE, 'error' => 'Both id and title are required.'];\n    }\n\n    $elements = $input['elements'] ?? [];\n\n    return $this->webformService->createWebform($id, $title, $elements);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/src/Plugin/tool/Tool/CreateWebform.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateWebform", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Add meta description and title programmatically", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Theming Drupal](/docs/develop/theming-drupal)\n\n* [Defining a theme with an .info.yml file](/docs/develop/theming-drupal/defining-a-theme-with-an-infoyml-file)\n* [Drupal theme folder structure](/docs/develop/theming-drupal/drupal-theme-folder-structure)\n* [Adding Regions to a Theme](/docs/develop/theming-drupal/adding-regions-to-a-theme)\n* [Adding stylesheets (CSS) and JavaScript (JS) to a Drupal theme](/docs/develop/theming-drupal/adding-assets-css-js-to-a-drupal-theme-via-librariesyml)\n* [Twig in Drupal](/docs/develop/theming-drupal/twig-in-drupal)\n* [Creating sub-themes](/docs/develop/theming-drupal/creating-sub-themes)\n* [Using Stable/Stable 9 as a base theme](/docs/develop/theming-drupal/sub-theming-using-stablestable-9-as-a-base-theme)\n* [Classy themes css selectors](/docs/8/theming-drupal-8/classy-themes-css-selectors)\n* [Using Single-Directory Components](/docs/develop/theming-drupal/using-single-directory-components)\n* [Including Default Image Styles With Your Theme](/docs/8/theming-drupal-8/including-default-image-styles-with-your-theme)\n* [Including Part Template](/docs/8/theming-drupal-8/including-part-template)\n* [Using attributes in templates](/docs/8/theming-drupal-8/using-attributes-in-templates)\n* [Modifying attributes in a .theme file](/docs/8/theming-drupal-8/modifying-attributes-in-a-theme-file)\n* [Working with breakpoints in Drupal](/docs/develop/theming-drupal/working-with-breakpoints-in-drupal)\n* [Creating advanced theme settings](/docs/8/theming-drupal-8/creating-advanced-theme-settings)\n* [Theming differences between Drupal 6, 7 & 8](/docs/8/theming-drupal-8/theming-differences-between-drupal-6-7-8)\n* [Upgrading 7.x themes to 8.x](/docs/theming-drupal/upgrading-classes-on-7x-themes-to-drupal-8-or-later)\n* [Drupal Twig conversion instructions (tpl.php to html.twig)](/docs/theming-drupal/drupal-twig-conversion-instructions-tplphp-to-htmltwig)\n* [Creating automation tools for custom themes (Gulpjs)](/docs/develop/theming-drupal/creating-automation-tools-for-custom-themes-gulpjs)\n* [Sub-Theme inheritance](/docs/develop/theming-drupal/sub-theme-inheritance)\n* [Update the throbber](/docs/develop/theming-drupal/update-the-throbber)\n* [Z-indexes in Drupal 8](/docs/develop/theming-drupal/z-indexes-in-drupal-8)\n* [Add meta description and title programmatically](/docs/develop/theming-drupal/add-meta-description-and-title-programmatically)\n\n# Add meta description and title programmatically\n\nLast [updated](/node/3357348/discuss) on\n\n29 July 2024\n\nThis documentation **needs review**. See \"Help improve this page\" in the sidebar.\n\nThe following example code will override the meta title and description for the Basic Page content type with custom values. Substitute `mythemename` in the function name with the machine name of your theme. The existing fields `title` and\u00a0 `body` are used which you should replace with the values you desire.\n\nAdd this code in your theme *mythemename.theme* file, and clear the caches.\n\n```\n/**\n * Implements hook_preprocess_html() for html templates.\n */\nfunction mythemename_preprocess_html(array &$variables) {\n  // Add META tag title + description for Basic Page node fields.\n  // This assumes the 'body' field is present and populated.\n  // Load the node entity from current route.\n  $node = \\Drupal::routeMatch()->getParameter('node');\n  if ($node) {\n    // Check if node type is basic page.\n    if ($node->getType() === 'page') {\n      $variables['page']['#attached']['html_head'][] = [\n        [\n          '#tag' => 'meta',\n          '#attributes' => [\n            'name' => 'title',\n            'content' => $node->get('title')->value,\n          ],\n        ],\n        'title',\n      ];\n      $variables['page']['#attached']['html_head'][] = [\n        [\n          '#tag' => 'meta',\n          '#attributes' => [\n            'name' => 'description',\n            // Get 160 characters from Body field, strip tags\n            'content' => strip_tags(substr($node->get('body')->value, 0, 160)) . '...',\n          ],\n        ],\n        'description',\n      ];\n    }\n  }\n}\n```\n\nThe Summary field is empty by default, so the first 160 characters from the Body field are extracted, and tags stripped. For better control, fill out and use the `summary` value instead, where tags are stripped by default.\n\nTo use Summary instead, replace this line:\n\n```\n// Get 160 characters of the body, strip HTML tags\n'content' => strip_tags(substr($node->get('body')->value, 0, 160)) . '...',\n```\n\n... with this:\n\n```\n// Get the summary, without HTML by default\n'content' => $node->get('body')->summary\n```\n\nFound in [Add meta tag to <head>](https://stackoverflow.com/questions/35913739/add-meta-tag-to-head), thanks to all users who shared their solutions there.\n\n## Help improve this page\n\n**Page status:**  Needs review\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3357348/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283357348%29%20Add%20meta%20description%20and%20title%20programmatically) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/theming-drupal/add-meta-description-and-title-programmatically.md", "type": "doc_summary", "topic": "Add meta description and title programmatically"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "laposta_subscribe.settings:\n  title: 'Laposta Subscribe'\n  description: 'Configure Laposta Subscribe Settings'\n  parent: system.admin_config_services\n  route_name: laposta_subscribe.api_key_settings\n", "metadata": {"source": "repos/laposta_subscribe/laposta_subscribe.links.menu.yml", "type": "yaml_reference", "topic": "laposta subscribe.links.menu"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: TranslatableInterface.php\nTarget symbol: interface TranslatableInterface\nNamespace: Drupal\\Core\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for TranslatableInterface.\n- Include required imports:\n  - Drupal\\Core\\TypedData\\TranslatableInterface as TranslatableDataInterface\n- Ensure these methods exist where relevant:\n  - hasTranslationChanges()", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\TypedData\\TranslatableInterface as TranslatableDataInterface;\n\n/**\n * Provides methods for an entity to support translation.\n *\n * @ingroup entity_type_characteristics\n */\ninterface TranslatableInterface extends TranslatableDataInterface, EntityInterface {\n\n  /**\n   * Determines if the current translation of the entity has unsaved changes.\n   *\n   * @return bool\n   *   TRUE if the current translation of the entity has changes.\n   */\n  public function hasTranslationChanges();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/TranslatableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "TranslatableInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "db_wipe_entity.admin:\n  title: 'DB Wipe Entity'\n  description: 'Entity deletion via Drupal Entity API with protection rules.'\n  parent: db_wipe.admin\n  route_name: db_wipe_entity.admin\n  weight: 10\n\ndb_wipe_entity.settings:\n  title: 'General Settings'\n  description: 'Configure deletion mode and batch processing settings.'\n  parent: db_wipe_entity.admin\n  route_name: db_wipe_entity.settings\n  weight: 0\n\ndb_wipe_entity.protection:\n  title: 'Protection Rules'\n  description: 'Manage entity protection rules for database wipe operations.'\n  parent: db_wipe_entity.admin\n  route_name: entity.protection_rule.collection\n  weight: 10\n\ndb_wipe_entity.logging:\n  title: 'Logging'\n  description: 'Configure logging settings for wipe operations.'\n  parent: db_wipe_entity.admin\n  route_name: db_wipe_entity.logging\n  weight: 20\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/db_wipe_entity.links.menu.yml", "type": "yaml_reference", "topic": "db wipe entity.links.menu"}}
{"instruction": "Show me the implementation of the interface DataInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\DTO;\n\n/**\n * Interface for data transfer objects.\n *\n * This interface provides a standardized way to handle data\n * in the FlowDrop system, ensuring proper serialization and\n * type safety.\n */\ninterface DataInterface {\n\n  /**\n   * Get a value from the data object.\n   *\n   * @param string $key\n   *   The key to retrieve.\n   * @param mixed $default\n   *   The default value if key doesn't exist.\n   *\n   * @return mixed\n   *   The value for the key or default.\n   */\n  public function get(string $key, mixed $default = NULL): mixed;\n\n  /**\n   * Set a value in the data object.\n   *\n   * @param string $key\n   *   The key to set.\n   * @param mixed $value\n   *   The value to set.\n   *\n   * @return static\n   *   The data object for method chaining.\n   */\n  public function set(string $key, mixed $value): static;\n\n  /**\n   * Check if a key exists in the data object.\n   *\n   * @param string $key\n   *   The key to check.\n   *\n   * @return bool\n   *   TRUE if the key exists.\n   */\n  public function has(string $key): bool;\n\n  /**\n   * Remove a key from the data object.\n   *\n   * @param string $key\n   *   The key to remove.\n   *\n   * @return static\n   *   The data object for method chaining.\n   */\n  public function remove(string $key): static;\n\n  /**\n   * Get all data as an array.\n   *\n   * @return array\n   *   The data as an array.\n   */\n  public function toArray(): array;\n\n  /**\n   * Set data from an array.\n   *\n   * @param array $data\n   *   The data array.\n   *\n   * @return static\n   *   The data object for method chaining.\n   */\n  public function fromArray(array $data): static;\n\n  /**\n   * Get all keys in the data object.\n   *\n   * @return array\n   *   Array of keys.\n   */\n  public function keys(): array;\n\n  /**\n   * Check if the data object is empty.\n   *\n   * @return bool\n   *   TRUE if the data object is empty.\n   */\n  public function isEmpty(): bool;\n\n  /**\n   * Clear all data from the object.\n   *\n   * @return static\n   *   The data object for method chaining.\n   */\n  public function clear(): static;\n\n  /**\n   * Merge data from another DataInterface object.\n   *\n   * @param \\Drupal\\flowdrop\\DTO\\DataInterface $other\n   *   The other data object to merge from.\n   *\n   * @return static\n   *   The data object for method chaining.\n   */\n  public function merge(DataInterface $other): static;\n\n}\n", "metadata": {"source": "repos/flowdrop/src/DTO/DataInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DataInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Overview", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Modules](/docs/extending-drupal/overview#s-modules)\n* [Themes](/docs/extending-drupal/overview#s-themes)\n* ['Custom' projects](/docs/extending-drupal/overview#s-custom-projects)\n* [Warning](/docs/extending-drupal/overview#s-warning)\n\n## [Extending Drupal](/docs/extending-drupal)\n\n* [Overview](/docs/extending-drupal/overview)\n* [Themes](/docs/extending-drupal/themes)\n* [Contributed modules](/docs/extending-drupal/contributed-modules)\n* [Drupal Recipes](/docs/extending-drupal/drupal-recipes)\n* [Installing Modules](/docs/extending-drupal/installing-modules)\n* [Installing modules' Composer dependencies](/docs/extending-drupal/installing-modules-composer-dependencies)\n* [Updating Modules](/docs/extending-drupal/updating-modules)\n* [Module Configuration](/docs/extending-drupal/module-configuration)\n* [Module Documentation and Help](/docs/extending-drupal/module-documentation-and-help)\n* [Uninstalling Modules](/docs/extending-drupal/uninstalling-modules)\n* [Installing Sandbox Modules](/docs/extending-drupal/installing-sandbox-modules)\n\n# Overview\n\nLast [updated](/node/2804899/discuss) on\n\n5 December 2021\n\nNow that you are done [Installing Drupal](https://www.drupal.org/node/2743413 \"Installing Drupal | Drupal guide on Drupal.org\") you can add additional functionality to your site by [Installing contributed modules](https://www.drupal.org/node/1897420 \"Installing Modules | Drupal guide on Drupal.org\"), or you can customize the look and style of your site by [Installing contributed themes](https://www.drupal.org/node/2804903 \"Installing Themes | Drupal guide on Drupal.org\").\n\nThe standard installation of Drupal core is both limited in functionality and is rather plain-looking. Drupal has been designed, however, to be modular so that it is easily extensible with additional modules and themes.\n\nEach of the multitudes of additional modules and themes available at Drupal.org is referred to as a 'project', and all of them are free of charge. They are often called 'contrib' because they were contributed by Drupal community members just like you.\n\nIn many cases, you will discover that someone has already written, and uploaded to Drupal.org, a project that provides exactly what you are looking for.\n\nThe process of finding a module or theme to use, and the process of importing it into your site, is essentially the same for both modules and themes.\n\n### Modules\n\nModules provide the functionality to your site and the 'core modules', which are included in a standard installation, provide all of the basic functions that most sites need.\n\nSome of the core modules, however, are not enabled (turned on) by default. Therefore, you might want to examine the module list on the 'Extend' page of your site to see whether or not some functionality you seek is available from a core module that is not enabled before you spend time investigating contrib modules.\n\nThe page [Installing Modules](https://www.drupal.org/node/1897420 \"Installing Modules | Drupal guide on Drupal.org\") is a fairly complete guide for absolute beginners. It includes helpful information, not only for contrib modules but Drupal core modules as well.\n\n### Themes\n\nIf your primary interest is installing a new theme, the [Installing contributed modules](https://www.drupal.org/node/1897420 \"Installing Modules | Drupal guide on Drupal.org\") page provides detailed instructions on finding and importing a project, whether that be a module or theme. Currently, the [Installing contributed themes](https://www.drupal.org/node/2804903 \"Installing Themes | Drupal guide on Drupal.org\") page is incomplete but is where you can then continue after you have your theme imported into your site.\n\n### 'Custom' projects\n\nYou should not directly alter core modules or core themes because those changes would be over-written every time you apply a security/ bug-fix update for Drupal, which is released every month or so. Instead, you should either find a contrib project that provides what you need or create your own custom project.\n\nFor more advanced 'development' information about customizing existing projects, or creating your own, visit:\n\n* Modules: [Module Development with Drupal](https://www.drupal.org/docs/develop \"Developer documentation | Drupal.org\")\n* Themes: [Theming and Front End Development with Drupal](https://www.drupal.org/docs/theming-drupal \"Theming Drupal | Drupal guide on Drupal.org\")\n\n## Warning\n\n**[Backup your site, and test your backup](https://www.drupal.org/docs/contributed-modules/backup-and-migrate/how-to-for-backup-and-migrate \"How to for Backup and Migrate | Drupal guide on Drupal.org\")** to see that it works before you use a module that you have not used before, especially if it is an 'Other releases' or 'Development releases' version that has not yet been released as being suitable for a live website.\n\nBefore using a contrib module that you have not used before, you should always back up your site first, in particular, your database with a record of which version of Drupal core that was used with that database.\n\nAlso, critically, you should always test the contrib module on a test site (also known as a 'development' site), not on a live site (also known as a 'production' site), just in case the module breaks your site.\n\n## Tags\n\n[modules overview](/taxonomy/term/188808)\n\n[themes overview](/taxonomy/term/188809)\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2804899/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282804899%29%20Overview) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/extending-drupal/overview.md", "type": "doc_summary", "topic": "Overview"}}
{"instruction": "Show me the implementation of the class ProtectionRuleToggleStatusForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\db_wipe_entity\\Form;\n\nuse Drupal\\Core\\Entity\\EntityConfirmFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\CloseModalDialogCommand;\nuse Drupal\\Core\\Ajax\\RedirectCommand;\n\n/**\n * Provides a confirmation form for toggling protection rule status.\n */\nclass ProtectionRuleToggleStatusForm extends EntityConfirmFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion() {\n    $action = $this->entity->status() ? $this->t('disable') : $this->t('enable');\n    return $this->t('Are you sure you want to @action the protection rule %label?', [\n      '@action' => $action,\n      '%label' => $this->entity->label(),\n    ]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription() {\n    if ($this->entity->status()) {\n      return $this->t('Disabling this rule will allow matching entities to be deleted.');\n    }\n    return $this->t('Enabling this rule will protect matching entities from deletion.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfirmText() {\n    return $this->entity->status() ? $this->t('Disable') : $this->t('Enable');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl() {\n    return new Url('entity.protection_rule.collection');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form = parent::buildForm($form, $form_state);\n\n    // Add AJAX support for modal dialog.\n    $form['actions']['submit']['#ajax'] = [\n      'callback' => '::ajaxSubmit',\n      'event' => 'click',\n    ];\n\n    $form['actions']['cancel']['#attributes']['class'][] = 'dialog-cancel';\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $new_status = !$this->entity->status();\n    $this->entity->setStatus($new_status);\n    $this->entity->save();\n\n    $action = $new_status ? $this->t('enabled') : $this->t('disabled');\n    $this->messenger()->addStatus($this->t('Protection rule %label has been @action.', [\n      '%label' => $this->entity->label(),\n      '@action' => $action,\n    ]));\n\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n  /**\n   * AJAX callback for form submission.\n   */\n  public function ajaxSubmit(array &$form, FormStateInterface $form_state): AjaxResponse {\n    $response = new AjaxResponse();\n    $response->addCommand(new CloseModalDialogCommand());\n    $response->addCommand(new RedirectCommand($this->getCancelUrl()->toString()));\n    return $response;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Form/ProtectionRuleToggleStatusForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProtectionRuleToggleStatusForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: HtmlList\nSource file: <source_file>\nFile name hint: HtmlList.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\style;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsStyle;\n\n/**\n * Style plugin to render each item in an ordered or unordered list.\n *\n * @ingroup views_style_plugins\n */\n#[ViewsStyle(\n  id: \"html_list\",\n  title: new TranslatableMarkup(\"HTML List\"),\n  help: new TranslatableMarkup(\"Displays rows as HTML list.\"),\n  theme: \"views_view_list\",\n  display_types: [\"normal\"],\n)]\nclass HtmlList extends StylePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesRowPlugin = TRUE;\n\n  /**\n   * Does the style plugin support custom css class for the rows.\n   *\n   * @var bool\n   */\n  protected $usesRowClass = TRUE;\n\n  /**\n   * Set default options.\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n\n    $options['type'] = ['default' => 'ul'];\n    $options['class'] = ['default' => ''];\n    $options['wrapper_class'] = ['default' => 'item-list'];\n\n    return $options;\n  }\n\n  /**\n   * Render the given style.\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['type'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('List type'),\n      '#options' => ['ul' => $this->t('Unordered list'), 'ol' => $this->t('Ordered list')],\n      '#default_value' => $this->options['type'],\n    ];\n    $form['wrapper_class'] = [\n      '#title' => $this->t('Wrapper class'),\n      '#description' => $this->t('The class to provide on the wrapper, outside the list.'),\n      '#type' => 'textfield',\n      '#size' => '30',\n      '#default_value' => $this->options['wrapper_class'],\n    ];\n    $form['class'] = [\n      '#title' => $this->t('List class'),\n      '#description' => $this->t('The class to provide on the list element itself.'),\n      '#type' => 'textfield',\n      '#size' => '30',\n      '#default_value' => $this->options['class'],\n    ];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\style;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsStyle;\n\n/**\n * Style plugin to render each item in an ordered or unordered list.\n *\n * @ingroup views_style_plugins\n */\n#[ViewsStyle(\n  id: \"html_list\",\n  title: new TranslatableMarkup(\"HTML List\"),\n  help: new TranslatableMarkup(\"Displays rows as HTML list.\"),\n  theme: \"views_view_list\",\n  display_types: [\"normal\"],\n)]\nclass HtmlList extends StylePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesRowPlugin = TRUE;\n\n  /**\n   * Does the style plugin support custom css class for the rows.\n   *\n   * @var bool\n   */\n  protected $usesRowClass = TRUE;\n\n  /**\n   * Set default options.\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n\n    $options['type'] = ['default' => 'ul'];\n    $options['class'] = ['default' => ''];\n    $options['wrapper_class'] = ['default' => 'item-list'];\n\n    return $options;\n  }\n\n  /**\n   * Render the given style.\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['type'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('List type'),\n      '#options' => ['ul' => $this->t('Unordered list'), 'ol' => $this->t('Ordered list')],\n      '#default_value' => $this->options['type'],\n    ];\n    $form['wrapper_class'] = [\n      '#title' => $this->t('Wrapper class'),\n      '#description' => $this->t('The class to provide on the wrapper, outside the list.'),\n      '#type' => 'textfield',\n      '#size' => '30',\n      '#default_value' => $this->options['wrapper_class'],\n    ];\n    $form['class'] = [\n      '#title' => $this->t('List class'),\n      '#description' => $this->t('The class to provide on the list element itself.'),\n      '#type' => 'textfield',\n      '#size' => '30',\n      '#default_value' => $this->options['class'],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/style/HtmlList.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HtmlList", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: HelpHook\nSource file: <source_file>\nFile name hint: HelpHook.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\layout_builder_formatter\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Implements hook_help().\n */\nclass HelpHook {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help(string $route_name, RouteMatchInterface $route_match): ?string {\n    return match ($route_name) {\n      'help.page.layout_builder_formatter' => $this->buildHelpPage(),\n      default => NULL,\n    };\n  }\n\n  /**\n   * Builds the help page content.\n   *\n   * @return string\n   *   The help page HTML.\n   */\n  protected function buildHelpPage(): string {\n    $output = '<h2>' . $this->t('About') . '</h2>';\n    $output .= '<p>' . $this->t('Layout Builder Formatter enables the Layout Builder field to be displayed using a standard field formatter, allowing you to configure field display settings when Layout Builder is enabled.') . '</p>';\n\n    $output .= '<h2>' . $this->t('Uses') . '</h2>';\n    $output .= '<dl>';\n\n    $output .= '<dt>' . $this->t('Displaying layouts via formatter') . '</dt>';\n    $output .= '<dd>' . $this->t('When enabled, the <code>layout_builder__layout</code> field can be configured like any other field on the \"Manage display\" page. The Layout Builder formatter renders the sections stored in the field.') . '</dd>';\n\n    $output .= '<dt>' . $this->t('Keeping fields visible') . '</dt>';\n    $output .= '<dd>' . $this->t('Unlike core Layout Builder which hides all fields when enabled, this module keeps the fields table visible so you can configure field formatters alongside the layout field.') . '</dd>';\n\n    $output .= '</dl>';\n\n    return $output;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\layout_builder_formatter\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Implements hook_help().\n */\nclass HelpHook {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help(string $route_name, RouteMatchInterface $route_match): ?string {\n    return match ($route_name) {\n      'help.page.layout_builder_formatter' => $this->buildHelpPage(),\n      default => NULL,\n    };\n  }\n\n  /**\n   * Builds the help page content.\n   *\n   * @return string\n   *   The help page HTML.\n   */\n  protected function buildHelpPage(): string {\n    $output = '<h2>' . $this->t('About') . '</h2>';\n    $output .= '<p>' . $this->t('Layout Builder Formatter enables the Layout Builder field to be displayed using a standard field formatter, allowing you to configure field display settings when Layout Builder is enabled.') . '</p>';\n\n    $output .= '<h2>' . $this->t('Uses') . '</h2>';\n    $output .= '<dl>';\n\n    $output .= '<dt>' . $this->t('Displaying layouts via formatter') . '</dt>';\n    $output .= '<dd>' . $this->t('When enabled, the <code>layout_builder__layout</code> field can be configured like any other field on the \"Manage display\" page. The Layout Builder formatter renders the sections stored in the field.') . '</dd>';\n\n    $output .= '<dt>' . $this->t('Keeping fields visible') . '</dt>';\n    $output .= '<dd>' . $this->t('Unlike core Layout Builder which hides all fields when enabled, this module keeps the fields table visible so you can configure field formatters alongside the layout field.') . '</dd>';\n\n    $output .= '</dl>';\n\n    return $output;\n  }\n\n}\n", "metadata": {"source": "repos/layout_builder_formatter/src/Hook/HelpHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpHook", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class TimeLogListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\labor_time_tracker;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Datetime\\DateFormatter;\nuse Drupal\\Core\\Form\\FormBuilderInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * List all time logs.\n */\nclass TimeLogListBuilder extends EntityListBuilder {\n\n  /**\n   * The current request.\n   */\n  protected ?Request $currentRequest;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    EntityTypeInterface $entityType,\n    EntityStorageInterface $storage,\n    RequestStack $requestStack,\n    protected DateFormatter $dateFormatter,\n    protected FormBuilderInterface $formBuilder,\n  ) {\n    parent::__construct($entityType, $storage);\n    $this->currentRequest = $requestStack->getCurrentRequest();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(\n    ContainerInterface $container,\n    EntityTypeInterface $entity_type,\n  ) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager')->getStorage($entity_type->id()),\n      $container->get('request_stack'),\n      $container->get('date.formatter'),\n      $container->get('form_builder'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    $build['filter_form'] = $this->formBuilder->getForm('\\Drupal\\labor_time_tracker\\Form\\TimeLogFilterForm');\n    $build['table'] = parent::render();\n    return $build;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityIds() {\n    $query = $this->getStorage()->getQuery()->accessCheck(TRUE);\n\n    $uid = $this->currentRequest->query->get('uid');\n    $date = $this->currentRequest->query->get('date');\n\n    if ($uid) {\n      $query->condition('user_id', $uid);\n    }\n\n    if ($date) {\n      $start_of_day = strtotime($date . ' 00:00:00');\n      $end_of_day = strtotime($date . ' 23:59:59');\n      $query->condition('enter_time', [$start_of_day, $end_of_day], 'BETWEEN');\n    }\n\n    $query->pager($this->limit);\n    $query->sort('enter_time', 'DESC');\n    return $query->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    $header['user']       = $this->t('User');\n    $header['day']        = $this->t('Day');\n    $header['enter_time'] = $this->t('Punch In');\n    $header['exit_time']  = $this->t('Punch Out');\n    $header['duration']   = $this->t('Duration');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    /** @var \\Drupal\\labor_time_tracker\\Entity\\TimeLog $entity */\n    $start_ts = (int) $entity->get('enter_time')->value;\n    $exit_ts = (int) $entity->get('exit_time')->value;\n\n    $row['user'] = $entity->get('user_id')->entity ? $entity->get('user_id')->entity->label() : $this->t('Unknown');\n    $row['day'] = $this->dateFormatter->format($start_ts, 'olivero_medium');\n    $row['enter_time'] = $this->dateFormatter->format($start_ts, 'html_time');\n    $row['exit_time'] = ($exit_ts > 0)\n      ? $this->dateFormatter->format($exit_ts, 'html_time')\n      : ['data' => ['#markup' => '<em>' . $this->t('Active') . '</em>']];\n\n    $duration_sec = (int) $entity->get('duration')->value;\n    $d_h = (int) ($duration_sec / 3600);\n    $d_m = (int) (($duration_sec % 3600) / 60);\n    $row['duration'] = ($exit_ts > 0) ? \"{$d_h}h {$d_m}m\" : '--';\n\n    return $row + parent::buildRow($entity);\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/TimeLogListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TimeLogListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - media.type.image\n  module:\n    - content_translation\nthird_party_settings:\n  content_translation:\n    enabled: true\nid: media.image\ntarget_entity_type_id: media\ntarget_bundle: image\ndefault_langcode: site_default\nlanguage_alterable: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/language.content_settings.media.image.yml", "type": "yaml_reference", "topic": "language.content settings.media.image"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DisableTheme\nSource file: <source_file>\nFile name hint: DisableTheme.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_theme\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_theme\\Service\\ThemeService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_theme_disable',\n  label: new TranslatableMarkup('Disable Theme'),\n  description: new TranslatableMarkup('Disable/uninstall a theme. Cannot disable the default or admin theme.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'theme' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup('Machine name of the theme to disable'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n    'changed' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Changed'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DisableTheme extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'theme';\n\n\n  protected ThemeService $themeService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->themeService = $container->get('mcp_tools_theme.theme');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $theme = $input['theme'] ?? '';\n\n    if (empty($theme)) {\n      return ['success' => FALSE, 'error' => 'Theme name is required.'];\n    }\n\n    return $this->themeService->disableTheme($theme);\n  }\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_theme\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_theme\\Service\\ThemeService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_theme_disable',\n  label: new TranslatableMarkup('Disable Theme'),\n  description: new TranslatableMarkup('Disable/uninstall a theme. Cannot disable the default or admin theme.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'theme' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup('Machine name of the theme to disable'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n    'changed' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Changed'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass DisableTheme extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'theme';\n\n\n  protected ThemeService $themeService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->themeService = $container->get('mcp_tools_theme.theme');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $theme = $input['theme'] ?? '';\n\n    if (empty($theme)) {\n      return ['success' => FALSE, 'error' => 'Theme name is required.'];\n    }\n\n    return $this->themeService->disableTheme($theme);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_theme/src/Plugin/tool/Tool/DisableTheme.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DisableTheme", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class EntityComment in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\comment\\Plugin\\migrate\\destination;\n\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface;\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\Session\\AccountSwitcherInterface;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\migrate\\Attribute\\MigrateDestination;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\Plugin\\migrate\\destination\\EntityContentBase;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Comment entity destination.\n */\n#[MigrateDestination('entity:comment')]\nclass EntityComment extends EntityContentBase {\n\n  /**\n   * The state storage object.\n   *\n   * @var \\Drupal\\Core\\State\\StateInterface\n   */\n  protected $state;\n\n  /**\n   * An array of entity IDs for the 'commented entity' keyed by entity type.\n   *\n   * @var array\n   */\n  protected $stubCommentedEntityIds;\n\n  /**\n   * Builds a comment entity destination.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationInterface $migration\n   *   The migration.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $storage\n   *   The storage for this entity type.\n   * @param array $bundles\n   *   The list of bundles this entity type has.\n   * @param \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $entity_field_manager\n   *   The entity field manager.\n   * @param \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface $field_type_manager\n   *   The field type plugin manager service.\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state storage object.\n   * @param \\Drupal\\Core\\Session\\AccountSwitcherInterface|null $account_switcher\n   *   The account switcher service.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface|null $entity_type_bundle_info\n   *   The entity type bundle info service.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, MigrationInterface $migration, EntityStorageInterface $storage, array $bundles, EntityFieldManagerInterface $entity_field_manager, FieldTypePluginManagerInterface $field_type_manager, StateInterface $state, ?AccountSwitcherInterface $account_switcher = NULL, ?EntityTypeBundleInfoInterface $entity_type_bundle_info = NULL) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $migration, $storage, $bundles, $entity_field_manager, $field_type_manager, $account_switcher, $entity_type_bundle_info);\n    $this->state = $state;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition, ?MigrationInterface $migration = NULL) {\n    $entity_type = static::getEntityTypeId($plugin_id);\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $migration,\n      $container->get('entity_type.manager')->getStorage($entity_type),\n      array_keys($container->get('entity_type.bundle.info')->getBundleInfo($entity_type)),\n      $container->get('entity_field.manager'),\n      $container->get('plugin.manager.field.field_type'),\n      $container->get('state'),\n      $container->get('account_switcher'),\n      $container->get('entity_type.bundle.info'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n   *   replacement.\n   *\n   * @see https://www.drupal.org/node/3533565\n   */\n  public function import(Row $row, array $old_destination_id_values = []) {\n    @trigger_error(__METHOD__ . '() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533565', E_USER_DEPRECATED);\n    if ($row->isStub() && ($state = $this->state->get('comment.maintain_entity_statistics', 0))) {\n      $this->state->set('comment.maintain_entity_statistics', 0);\n    }\n    $return = parent::import($row, $old_destination_id_values);\n    if ($row->isStub() && $state) {\n      $this->state->set('comment.maintain_entity_statistics', $state);\n    }\n    return $return;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function processStubRow(Row $row) {\n    parent::processStubRow($row);\n    // Neither uid nor name is required in itself, but it is required to set one\n    // of them.\n    $row->setDestinationProperty('name', 'anonymous_stub');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/Plugin/migrate/destination/EntityComment.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityComment", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class NexiXpayHppThemeHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hooks for the NexiXpay HPP theme.\n */\nfinal class NexiXpayHppThemeHooks {\n\n  /**\n   * Implements hook_theme().\n   *\n   * @return array<string, mixed>\n   *   The theme return array.\n   */\n  #[Hook('theme')]\n  public function theme(): array {\n    return [\n      'nexi_xpay_hpp_pay' => [\n        'variables' => [\n          'tx' => [],\n          'start_url' => '',\n        ],\n        'template' => 'nexi-xpay-hpp-pay',\n      ],\n      'nexi_xpay_hpp_return' => [\n        'variables' => [\n          'tx' => [],\n          'message' => '',\n        ],\n        'template' => 'nexi-xpay-hpp-return',\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Hook/NexiXpayHppThemeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NexiXpayHppThemeHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: PluralTranslatableMarkup.php\nTarget symbol: class to\nNamespace: Drupal\\Core\\StringTranslation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for to.\n- Include required imports:\n  - Drupal\\Component\\Gettext\\PoItem\n- Ensure these methods exist where relevant:\n  - __construct()\n  - __sleep()\n  - createFromTranslatedString()\n  - getPluralIndex()\n  - render()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\StringTranslation;\n\nuse Drupal\\Component\\Gettext\\PoItem;\n\n/**\n * A class to hold plural translatable markup.\n */\nclass PluralTranslatableMarkup extends TranslatableMarkup {\n\n  /**\n   * The item count to display.\n   *\n   * @var numeric\n   */\n  protected $count;\n\n  /**\n   * The already translated string.\n   *\n   * @var string\n   */\n  protected $translatedString;\n\n  /**\n   * Constructs a new PluralTranslatableMarkup object.\n   *\n   * Parses values passed into this class through the format_plural() function\n   * in Drupal and handles an optional context for the string.\n   *\n   * @param numeric $count\n   *   The item count to display.\n   * @param string $singular\n   *   The string for the singular case. Make sure it is clear this is singular,\n   *   to ease translation (e.g. use \"1 new comment\" instead of \"1 new\"). Do not\n   *   use @count in the singular string.\n   * @param string $plural\n   *   The string for the plural case. Make sure it is clear this is plural, to\n   *   ease translation. Use @count in place of the item count, as in\n   *   \"@count new comments\".\n   * @param array $args\n   *   (optional) An array with placeholder replacements, keyed by placeholder.\n   *   See \\Drupal\\Component\\Render\\FormattableMarkup::placeholderFormat() for\n   *   additional information about placeholders. Note that you do not need to\n   *   include @count in this array; this replacement is done automatically\n   *   for the plural cases.\n   * @param array $options\n   *   (optional) An associative array of additional options. See t() for\n   *   allowed keys.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   (optional) The string translation service.\n   *\n   * @see \\Drupal\\Component\\Render\\FormattableMarkup::placeholderFormat()\n   */\n  public function __construct($count, $singular, $plural, array $args = [], array $options = [], ?TranslationInterface $string_translation = NULL) {\n    $this->count = $count;\n    $translatable_string = implode(PoItem::DELIMITER, [$singular, $plural]);\n    parent::__construct($translatable_string, $args, $options, $string_translation);\n  }\n\n  /**\n   * Constructs a new class instance from already translated markup.\n   *\n   * This method ensures that the string is pluralized correctly. As opposed\n   * to the __construct() method, this method is designed to be invoked with\n   * a string already translated (such as with configuration translation).\n   *\n   * @param numeric $count\n   *   The item count to display.\n   * @param string $translated_string\n   *   The already translated string.\n   * @param array $args\n   *   An associative array of replacements to make after translation. Instances\n   *   of any key in this array are replaced with the corresponding value.\n   *   Based on the first character of the key, the value is escaped and/or\n   *   themed. See \\Drupal\\Component\\Render\\FormattableMarkup. Note that you\n   *   do not need to include @count in this array; this replacement is done\n   *   automatically for the plural cases.\n   * @param array $options\n   *   An associative array of additional options. See t() for allowed keys.\n   *\n   * @return static\n   *   A PluralTranslatableMarkup object.\n   */\n  public static function createFromTranslatedString($count, $translated_string, array $args = [], array $options = []) {\n    $plural = new static($count, '', '', $args, $options);\n    $plural->translatedString = $translated_string;\n    return $plural;\n  }\n\n  /**\n   * Renders the object as a string.\n   *\n   * @return string\n   *   The translated string.\n   */\n  public function render() {\n    if (!$this->translatedString) {\n      $this->translatedString = $this->getStringTranslation()->translateString($this);\n    }\n    if ($this->translatedString === '') {\n      return '';\n    }\n\n    $arguments = $this->getArguments();\n    $arguments['@count'] = $this->count;\n    $translated_array = explode(PoItem::DELIMITER, $this->translatedString);\n\n    $index = $this->getPluralIndex();\n    if ($this->count == 1 || $index == 0 || count($translated_array) == 1) {\n      // Singular form.\n      $return = $translated_array[0];\n    }\n    else {\n      // Nth plural form, fallback to second plural form.\n      $return = $translated_array[$index] ?? $translated_array[1];\n    }\n    return $this->placeholderFormat($return, $arguments);\n  }\n\n  /**\n   * Gets the plural index through the gettext formula.\n   *\n   * @return int\n   *   The numeric index of the plural variant to use for this language and\n   *   count combination. Defaults to -1 when the language was not found or does\n   *   not have a plural formula.\n   */\n  protected function getPluralIndex() {\n    // We have to test both if the function and the service exist since in\n    // certain situations it is possible that locale code might be loaded but\n    // the service does not exist. For example, where the parent test site has\n    // locale installed but the child site does not.\n    // @todo Refactor in https://www.drupal.org/node/2660338 so this code does\n    // not depend on knowing that the Locale module exists.\n    if (function_exists('locale_get_plural') && \\Drupal::hasService('locale.plural.formula')) {\n      return locale_get_plural($this->count, $this->getOption('langcode'));\n    }\n    return -1;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __sleep(): array {\n    return array_merge(parent::__sleep(), ['count']);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/StringTranslation/PluralTranslatableMarkup.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PluralTranslatableMarkup", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface TransformationInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\Transformation;\n\n/**\n * Interface for transformation plugins.\n */\ninterface TransformationInterface {\n\n  /**\n   * Applies transformation to a value.\n   *\n   * @param mixed $value\n   *   The value to transform.\n   * @param array $options\n   *   Transformation options.\n   *\n   * @return mixed\n   *   The transformed value.\n   */\n  public function transform($value, array $options = []): mixed;\n\n  /**\n   * Gets the plugin definition.\n   *\n   * @return array\n   *   The plugin definition.\n   */\n  public function getDefinition(): array;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/Transformation/TransformationInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "TransformationInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LanguageAccessControlHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\language;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Entity\\EntityAccessControlHandler;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Defines the access control handler for the language entity type.\n *\n * @see \\Drupal\\language\\Entity\\ConfigurableLanguage\n */\nclass LanguageAccessControlHandler extends EntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account) {\n    switch ($operation) {\n      case 'view':\n        return parent::checkAccess($entity, $operation, $account);\n\n      case 'update':\n        /** @var \\Drupal\\Core\\Language\\LanguageInterface $entity */\n        return AccessResult::allowedIf(!$entity->isLocked())->addCacheableDependency($entity)\n          ->andIf(parent::checkAccess($entity, $operation, $account));\n\n      case 'delete':\n        /** @var \\Drupal\\Core\\Language\\LanguageInterface $entity */\n        return AccessResult::allowedIf(!$entity->isLocked())->addCacheableDependency($entity)\n          ->andIf(AccessResult::allowedIf(!$entity->isDefault())->addCacheableDependency($entity))\n          ->andIf(parent::checkAccess($entity, $operation, $account));\n\n      default:\n        // No opinion.\n        return AccessResult::neutral();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/language/src/LanguageAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageAccessControlHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the configuration files of the Link module.\n\nfield.formatter.settings.link:\n  type: mapping\n  label: 'Link format settings'\n  mapping:\n    trim_length:\n      type: integer\n      label: 'Trim link text length'\n    url_only:\n      type: boolean\n      label: 'URL only'\n    url_plain:\n      type: boolean\n      label: 'Show URL as plain text'\n    rel:\n      type: string\n      label: 'Add rel=\"nofollow\" to links'\n    target:\n      type: string\n      label: 'Open link in new window'\n\nfield.formatter.settings.link_separate:\n  type: field.formatter.settings.link\n  label: 'Link format settings'\n\nfield.widget.settings.link_default:\n  type: mapping\n  label: 'Link format settings'\n  mapping:\n    placeholder_url:\n      type: label\n      label: 'Placeholder for URL'\n    placeholder_title:\n      type: label\n      label: 'Placeholder for link text'\n\n# This field type has no field storage settings, so no specific config schema type.\n# @see `type: field.storage_settings.*`\nfield.field_settings.link:\n  type: mapping\n  label: 'Link settings'\n  mapping:\n    title:\n      type: integer\n      label: 'Allow link text'\n    link_type:\n      type: integer\n      label: 'Allowed link type'\n\nfield.value.link:\n  type: mapping\n  label: 'Default value'\n  mapping:\n    attributes:\n      type: mapping\n      label: 'Link attributes'\n      mapping:\n        title:\n          type: label\n          label: 'Link text'\n    uri:\n      type: string\n      label: 'URL'\n    title:\n      type: label\n      label: 'Link text'\n    options:\n      type: mapping\n      label: 'Link options'\n      mapping:\n        query:\n          type: sequence\n          label: 'URL query key value pairs'\n          sequence:\n            type: string\n        fragment:\n          type: string\n          label: 'URL fragment'\n        absolute:\n          type: boolean\n          label: 'Whether to force the output to be an absolute link (beginning with http: or https:)'\n        https:\n          type: boolean\n          label: 'Whether to force this URL to point to a secure location (beginning with https:)'\n        attributes:\n          type: sequence\n          label: 'Link attributes'\n          sequence:\n            type: string\n", "metadata": {"source": "repos/drupal_core/core/modules/link/config/schema/link.schema.yml", "type": "yaml_reference", "topic": "link.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Entity management routes\nentity.rag_search_summary.collection:\n  path: '/admin/config/ai/rag-search-summary'\n  defaults:\n    _entity_list: 'rag_search_summary'\n    _title: 'RAG Search Summary Configurations'\n  requirements:\n    _permission: 'administer rag search summaries'\n\nentity.rag_search_summary.add_form:\n  path: '/admin/config/ai/rag-search-summary/add'\n  defaults:\n    _entity_form: 'rag_search_summary.add'\n    _title: 'Add RAG Search Summary Configuration'\n  requirements:\n    _permission: 'administer rag search summaries'\n\nentity.rag_search_summary.edit_form:\n  path: '/admin/config/ai/rag-search-summary/{rag_search_summary}/edit'\n  defaults:\n    _entity_form: 'rag_search_summary.edit'\n    _title: 'Edit RAG Search Summary Configuration'\n  requirements:\n    _permission: 'administer rag search summaries'\n\nentity.rag_search_summary.delete_form:\n  path: '/admin/config/ai/rag-search-summary/{rag_search_summary}/delete'\n  defaults:\n    _entity_form: 'rag_search_summary.delete'\n    _title: 'Delete RAG Search Summary Configuration'\n  requirements:\n    _permission: 'administer rag search summaries'\n\n# API routes\nai_rag_search_summary.query:\n  path: '/api/rag-search-summary/query'\n  defaults:\n    _controller: '\\Drupal\\ai_rag_search_summary\\Controller\\RagSearchSummaryController::query'\n  requirements:\n    _permission: 'access content'\n  methods: [POST]\n  options:\n    _csrf_request_header_name: 'X-CSRF-Token'\n", "metadata": {"source": "repos/ai_rag_search_summary/ai_rag_search_summary.routing.yml", "type": "yaml_reference", "topic": "ai rag search summary.routing"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Substr.php\nTarget symbol: class Substr\nNamespace: Drupal\\migrate\\Plugin\\migrate\\process\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Substr.\n- Include required imports:\n  - Drupal\\migrate\\Attribute\\MigrateProcess\n  - Drupal\\migrate\\ProcessPluginBase\n  - Drupal\\migrate\\MigrateExecutableInterface\n  - Drupal\\migrate\\Row\n  - Drupal\\migrate\\MigrateException\n- Ensure these methods exist where relevant:\n  - transform()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate\\MigrateException;\n\n// cspell:ignore sk\u0142odowska\n\n/**\n * Returns a substring of the input value.\n *\n * The substr process plugin returns the portion of the input value specified by\n * the start and length parameters. This is a wrapper around mb_substr().\n *\n * Available configuration keys:\n * - start: (optional) The returned string will start this many characters after\n *   the beginning of the string, defaults to 0.\n * - length: (optional) The maximum number of characters in the returned\n *   string, defaults to NULL.\n *\n * If start is 0 and length is an integer, the start position is the\n * beginning of the string. If start is an integer and length is NULL, the\n * substring starting from the start position until the end of the string will\n * be returned. If start is 0 and length is NULL the entire string is returned.\n *\n * Example:\n *\n * @code\n * process:\n *   new_text_field:\n *     plugin: substr\n *     source: some_text_field\n *     start: 6\n *     length: 10\n * @endcode\n * If some_text_field was 'Marie Sk\u0142odowska Curie' then\n * $destination['new_text_field'] would be 'Sk\u0142odowska'.\n *\n * The PHP equivalent of this is:\n * @code\n * $destination['new_text_field'] = substr($source['some_text_field'], 6, 10);\n * @endcode\n *\n * The substr plugin requires that the source value is not empty. If empty\n * values are expected, combine skip_on_empty process plugin to the pipeline:\n * @code\n * process:\n *   new_text_field:\n *    -\n *      plugin: skip_on_empty\n *      method: process\n *      source: some_text_field\n *    -\n *      plugin: substr\n *      start: 6\n *      length: 10\n * @endcode\n *\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('substr')]\nclass Substr extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    $start = $this->configuration['start'] ?? 0;\n    if (!is_int($start)) {\n      throw new MigrateException('The start position configuration value should be an integer. Omit this key to capture from the beginning of the string.');\n    }\n    $length = $this->configuration['length'] ?? NULL;\n    if ($length !== NULL && !is_int($length)) {\n      throw new MigrateException('The character length configuration value should be an integer. Omit this key to capture from the start position to the end of the string.');\n    }\n    if (!is_string($value)) {\n      throw new MigrateException('The input value must be a string.');\n    }\n\n    // Use optional start or length to return a portion of $value.\n    return mb_substr($value, $start, $length);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/Substr.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Substr", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class MauticSegment in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mautic_personalisation\\Plugin\\Condition;\n\nuse Drupal\\Core\\Condition\\Attribute\\Condition;\nuse Drupal\\Core\\Condition\\ConditionPluginBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mautic_personalisation\\MauticCookieManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a 'Mautic Segment' condition.\n */\n#[Condition(\n  id: \"mautic_segment\",\n  label: new TranslatableMarkup(\"Mautic Segment\")\n)]\nfinal class MauticSegment extends ConditionPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The cookie manager service.\n   *\n   * @var \\Drupal\\mautic_personalisation\\MauticCookieManager\n   */\n  protected MauticCookieManager $cookieManager;\n\n  /**\n   * The current user account.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountProxyInterface\n   */\n  protected AccountProxyInterface $currentUser;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition\n    );\n    $instance->cookieManager = $container->get('mautic_personalisation.cookie_manager');\n    $instance->currentUser = $container->get('current_user');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state) {\n    $selectedSegments = $this->getSelectedSegments();\n    $defaultValue = implode(\"\\n\", $selectedSegments);\n\n    $form['mautic_segment'] = [\n      '#title'       => $this->t('Mautic Segment'),\n      '#type'        => 'textarea',\n      '#description' => $this->t('Enter one segment alias per line. For which segment(s) this content should be visible. Leaving empty (default) will show the content for everyone. You can also use \"_unknown\" to show content only until a segment has been determined for the visitor.'),\n      '#default_value' => $defaultValue,\n      '#rows'        => 5,\n    ];\n\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state) {\n    $value = $form_state->getValue('mautic_segment', '');\n    // Convert textarea input (one per line) to array.\n    $segments = [];\n    if (!empty($value)) {\n      $lines = explode(\"\\n\", $value);\n      foreach ($lines as $line) {\n        $line = trim($line);\n        if (!empty($line)) {\n          $segments[] = $line;\n        }\n      }\n    }\n\n    $this->configuration['mautic_segment'] = $segments;\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    $contexts = parent::getCacheContexts();\n    if ($this->configuration['mautic_segment']) {\n      $contexts[] = 'cookies:' . $this->cookieManager->getCookieName();\n    }\n    return $contexts;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summary() {\n    $segments = $this->configuration['mautic_segment'] ?? [];\n    if (!$segments) {\n      return $this->t('No Mautic Segments selected');\n    }\n    $segment_string = implode(', ', $segments);\n    return $this->t('The Mautic Segment(s) selected is @segment', ['@segment' => $segment_string]);\n  }\n\n  /**\n   * Gets the selected segments from configuration.\n   *\n   * @return array\n   *   Array of selected segment aliases.\n   */\n  protected function getSelectedSegments(): array {\n    return $this->configuration['mautic_segment'] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function evaluate() {\n    $segments = $this->getSelectedSegments();\n\n    if (empty($segments) && !$this->isNegated()) {\n      return TRUE;\n    }\n\n    $cookieValues = $this->cookieManager->getSegmentCookieValues();\n    $cookieValuesMap = array_flip($cookieValues);\n\n    foreach ($segments as $segment) {\n      if (isset($cookieValuesMap[(string) $segment])) {\n        return TRUE;\n      }\n    }\n\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration() {\n    return ['mautic_segment' => []] + parent::defaultConfiguration();\n  }\n\n}\n", "metadata": {"source": "repos/mautic_personalisation/src/Plugin/Condition/MauticSegment.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MauticSegment", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TimeDataCollector in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\tracer\\TracerFactory;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\DataCollector\\LateDataCollectorInterface;\n\n/**\n * Collects timed events data.\n */\nclass TimeDataCollector extends DataCollector implements LateDataCollectorInterface {\n\n  /**\n   * TimeDataCollector constructor.\n   *\n   * @param \\Drupal\\tracer\\TracerFactory $tracerFactory\n   *   The tracer factory.\n   */\n  public function __construct(private readonly TracerFactory $tracerFactory) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n    $startTime = $request->server->get('REQUEST_TIME_FLOAT');\n\n    $this->data = [\n      'start_time' => $startTime * 1000,\n      'events' => [],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'time';\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function lateCollect() {\n    $this->setEvents($this->tracerFactory->getEvents());\n  }\n\n  /**\n   * Set collected events to data.\n   *\n   * @param \\Symfony\\Component\\Stopwatch\\StopwatchEvent[] $events\n   *   The request events.\n   */\n  public function setEvents(array $events): void {\n    foreach ($events as $event) {\n      $event->ensureStopped();\n    }\n\n    $this->data['events'] = $events;\n  }\n\n  /**\n   * Retrieve collected events from data.\n   *\n   * @return \\Symfony\\Component\\Stopwatch\\StopwatchEvent[]\n   *   The collected events from data.\n   */\n  public function getEvents(): array {\n    return $this->data['events'];\n  }\n\n  /**\n   * Gets the request elapsed time.\n   *\n   * @return float\n   *   The request elapsed time.\n   */\n  public function getDuration(): float {\n    if (!isset($this->data['events']['__section__'])) {\n      return 0;\n    }\n\n    $lastEvent = $this->data['events']['__section__'];\n\n    return $lastEvent->getOrigin() + $lastEvent->getDuration() - $this->getStartTime();\n  }\n\n  /**\n   * Gets the initialization time.\n   *\n   * This is the time spent until the beginning of the request handling.\n   *\n   * @return float\n   *   The initialization time.\n   */\n  public function getInitTime(): float {\n    if (!isset($this->data['events']['__section__'])) {\n      return 0;\n    }\n\n    return $this->data['events']['__section__']->getOrigin() - $this->getStartTime();\n  }\n\n  /**\n   * Gets the start time.\n   *\n   * @return float\n   *   The start time.\n   */\n  public function getStartTime(): float {\n    return $this->data['start_time'];\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/TimeDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TimeDataCollector", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Formula\nSource file: <source_file>\nFile name hint: Formula.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\nuse Drupal\\views\\Plugin\\views\\display\\DisplayPluginBase;\nuse Drupal\\views\\ViewExecutable;\n\n/**\n * Argument handler for simple formulae.\n *\n * Child classes of this object should implement summaryArgument, at least.\n *\n * Definition terms:\n * - formula: The formula to use for this handler.\n *\n * @ingroup views_argument_handlers\n  */\n#[ViewsArgument(\n  id: 'formula',\n)]\nclass Formula extends ArgumentPluginBase {\n\n  /**\n   * An appropriate SQL string for the DB type and field type.\n   *\n   * @var string|null\n   */\n  public $formula = NULL;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function init(ViewExecutable $view, DisplayPluginBase $display, ?array &$options = NULL) {\n    parent::init($view, $display, $options);\n\n    if (!empty($this->definition['formula'])) {\n      $this->formula = $this->definition['formula'];\n    }\n  }\n\n  /**\n   * Gets the prepared formula.\n   */\n  public function getFormula() {\n    return str_replace('***table***', $this->tableAlias, $this->formula);\n  }\n\n  /**\n   * Build the summary query based on a formula.\n   */\n  protected function summaryQuery() {\n    $this->ensureMyTable();\n    // Now that our table is secure, get our formula.\n    $formula = $this->getFormula();\n\n    // Add the field.\n    $this->base_alias = $this->name_alias = $this->query->addField(NULL, $formula, $this->field);\n    $this->query->setCountField(NULL, $formula, $this->field);\n\n    return $this->summaryBasics(FALSE);\n  }\n\n  /**\n   * Build the query based upon the formula.\n   */\n  public function query($group_by = FALSE) {\n    $this->ensureMyTable();\n    // Now that our table is secure, get our formula.\n    $placeholder = $this->placeholder();\n    $formula = $this->getFormula() . ' = ' . $placeholder;\n    $placeholders = [\n      $placeholder => $this->argument,\n    ];\n    $this->query->addWhere(0, $formula, $placeholders, 'formula');\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\nuse Drupal\\views\\Plugin\\views\\display\\DisplayPluginBase;\nuse Drupal\\views\\ViewExecutable;\n\n/**\n * Argument handler for simple formulae.\n *\n * Child classes of this object should implement summaryArgument, at least.\n *\n * Definition terms:\n * - formula: The formula to use for this handler.\n *\n * @ingroup views_argument_handlers\n  */\n#[ViewsArgument(\n  id: 'formula',\n)]\nclass Formula extends ArgumentPluginBase {\n\n  /**\n   * An appropriate SQL string for the DB type and field type.\n   *\n   * @var string|null\n   */\n  public $formula = NULL;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function init(ViewExecutable $view, DisplayPluginBase $display, ?array &$options = NULL) {\n    parent::init($view, $display, $options);\n\n    if (!empty($this->definition['formula'])) {\n      $this->formula = $this->definition['formula'];\n    }\n  }\n\n  /**\n   * Gets the prepared formula.\n   */\n  public function getFormula() {\n    return str_replace('***table***', $this->tableAlias, $this->formula);\n  }\n\n  /**\n   * Build the summary query based on a formula.\n   */\n  protected function summaryQuery() {\n    $this->ensureMyTable();\n    // Now that our table is secure, get our formula.\n    $formula = $this->getFormula();\n\n    // Add the field.\n    $this->base_alias = $this->name_alias = $this->query->addField(NULL, $formula, $this->field);\n    $this->query->setCountField(NULL, $formula, $this->field);\n\n    return $this->summaryBasics(FALSE);\n  }\n\n  /**\n   * Build the query based upon the formula.\n   */\n  public function query($group_by = FALSE) {\n    $this->ensureMyTable();\n    // Now that our table is secure, get our formula.\n    $placeholder = $this->placeholder();\n    $formula = $this->getFormula() . ' = ' . $placeholder;\n    $placeholders = [\n      $placeholder => $this->argument,\n    ];\n    $this->query->addWhere(0, $formula, $placeholders, 'formula');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/argument/Formula.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Formula", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class Editor in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\editor\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines an Editor annotation object.\n *\n * Plugin Namespace: Plugin\\Editor\n *\n * Text editor plugin implementations need to define a plugin definition array\n * through annotation. These definition arrays may be altered through\n * hook_editor_info_alter(). The definition includes the following keys:\n *\n * - id: The unique, system-wide identifier of the text editor. Typically named\n *   the same as the editor library.\n * - label: The human-readable name of the text editor, translated.\n * - supports_content_filtering: Whether the editor supports \"allowed content\n *   only\" filtering.\n * - supports_inline_editing: Whether the editor supports the inline editing\n *   provided by the Edit module.\n * - is_xss_safe: Whether this text editor is not vulnerable to XSS attacks.\n * - supported_element_types: On which form element #types this text editor is\n *   capable of working.\n *\n * A complete sample plugin definition should be defined as in this example:\n *\n * @code\n * @Editor(\n *   id = \"my_editor\",\n *   label = @Translation(\"My Editor\"),\n *   supports_content_filtering = FALSE,\n *   supports_inline_editing = FALSE,\n *   is_xss_safe = FALSE,\n *   supported_element_types = {\n *     \"textarea\",\n *     \"textfield\",\n *   }\n * )\n * @endcode\n *\n * For a working example, see \\Drupal\\ckeditor5\\Plugin\\Editor\\CKEditor5\n *\n * @see \\Drupal\\editor\\Plugin\\EditorPluginInterface\n * @see \\Drupal\\editor\\Plugin\\EditorBase\n * @see \\Drupal\\editor\\Plugin\\EditorManager\n * @see hook_editor_info_alter()\n * @see plugin_api\n *\n * @Annotation\n */\nclass Editor extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The human-readable name of the editor plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * Whether the editor supports \"allowed content only\" filtering.\n   *\n   * @var bool\n   */\n  public $supports_content_filtering;\n\n  /**\n   * Whether the editor supports the inline editing provided by the Edit module.\n   *\n   * @var bool\n   */\n  public $supports_inline_editing;\n\n  /**\n   * Whether this text editor is not vulnerable to XSS attacks.\n   *\n   * @var bool\n   */\n  public $is_xss_safe;\n\n  /**\n   * A list of element types this text editor supports.\n   *\n   * @var string[]\n   */\n  public $supported_element_types;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/editor/src/Annotation/Editor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Editor", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FilterThemeHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\filter\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Template\\Attribute;\n\n/**\n * Theme hooks for filter.\n */\nclass FilterThemeHooks {\n\n  /**\n   * Implements hook_theme().\n   */\n  #[Hook('theme')]\n  public function theme() : array {\n    return [\n      'filter_tips' => [\n        'variables' => [\n          'tips' => NULL,\n          'long' => FALSE,\n        ],\n        'initial preprocess' => static::class . ':preprocessFilterTips',\n      ],\n      'text_format_wrapper' => [\n        'variables' => [\n          'children' => NULL,\n          'description' => NULL,\n          'attributes' => [],\n        ],\n        'initial preprocess' => static::class . ':preprocessTextFormatWrapper',\n      ],\n      'filter_guidelines' => [\n        'variables' => [\n          'format' => NULL,\n        ],\n        'initial preprocess' => static::class . ':preprocessFilterGuidelines',\n      ],\n      'filter_caption' => [\n        'variables' => [\n          'node' => NULL,\n          'tag' => NULL,\n          'caption' => NULL,\n          'classes' => NULL,\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Prepares variables for text format guideline templates.\n   *\n   * Default template: filter-guidelines.html.twig.\n   *\n   * @param array $variables\n   *   An associative array containing:\n   *   - format: An object representing a text format.\n   */\n  public function preprocessFilterGuidelines(array &$variables): void {\n    $format = $variables['format'];\n    $variables['tips'] = [\n      '#theme' => 'filter_tips',\n      '#tips' => _filter_tips($format->id()),\n    ];\n\n    // Add format id for filter.js.\n    $variables['attributes']['data-drupal-format-id'] = $format->id();\n  }\n\n  /**\n   * Prepares variables for text format wrapper templates.\n   *\n   * Default template: text-format-wrapper.html.twig.\n   *\n   * @param array $variables\n   *   An associative array containing:\n   *   - attributes: An associative array containing properties of the element.\n   */\n  public function preprocessTextFormatWrapper(array &$variables): void {\n    $variables['aria_description'] = FALSE;\n    // Add element class and id for screen readers.\n    if (isset($variables['attributes']['aria-describedby'])) {\n      $variables['aria_description'] = TRUE;\n      $variables['attributes']['id'] = $variables['attributes']['aria-describedby'];\n      // Remove aria-describedby attribute as it shouldn't be visible here.\n      unset($variables['attributes']['aria-describedby']);\n    }\n  }\n\n  /**\n   * Prepares variables for filter tips templates.\n   *\n   * Default template: filter-tips.html.twig.\n   *\n   * @param array $variables\n   *   An associative array containing:\n   *   - tips: An array containing descriptions and a CSS ID in the form of\n   *     'module-name/filter-id' (only used when $long is TRUE) for each\n   *     filter in one or more text formats. Example:\n   *     @code\n   *       [\n   *         'Full HTML' => [\n   *           0 => [\n   *             'tip' => 'Web page addresses and email addresses turn into links automatically.',\n   *             'id' => 'filter/2',\n   *           ],\n   *         ],\n   *       ];\n   *     @endcode\n   *   - long: (optional) Whether the passed-in filter tips contain extended\n   *     explanations, i.e. intended to be output on the path 'filter/tips'\n   *     (TRUE), or are in a short format, i.e. suitable to be displayed below a\n   *     form element. Defaults to FALSE.\n   *\n   * @deprecated in drupal:11.4.0 and is removed from drupal:12.0.0. There is\n   *   no replacement.\n   *\n   * @see https://www.drupal.org/node/3567879\n   */\n  public function preprocessFilterTips(array &$variables): void {\n    $tips = $variables['tips'];\n\n    foreach ($variables['tips'] as $name => $tip_list) {\n      foreach ($tip_list as $tip_key => $tip) {\n        $tip_list[$tip_key]['attributes'] = new Attribute();\n      }\n\n      $variables['tips'][$name] = [\n        'attributes' => new Attribute(),\n        'name' => $name,\n        'list' => $tip_list,\n      ];\n    }\n\n    $variables['multiple'] = count($tips) > 1;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/filter/src/Hook/FilterThemeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FilterThemeHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface DefaultsSectionStorageInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder;\n\nuse Drupal\\Core\\Config\\Entity\\ThirdPartySettingsInterface;\n\n/**\n * Defines an interface for an object that stores layout sections for defaults.\n */\ninterface DefaultsSectionStorageInterface extends SupportAwareSectionStorageInterface, ThirdPartySettingsInterface, LayoutBuilderEnabledInterface, LayoutBuilderOverridableInterface {}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/DefaultsSectionStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DefaultsSectionStorageInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GetModerationHistory in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_moderation\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_moderation\\Service\\ModerationService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_moderation_get_history',\n  label: new TranslatableMarkup('Get Moderation History'),\n  description: new TranslatableMarkup('Get revision history of an entity with moderation state changes.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: 'node',\n    ),\n    'entity_id' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Entity ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n      default_value: 50,\n    ),\n  ],\n  output_definitions: [\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'entity_id' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Entity ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'workflow_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Workflow ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_revisions' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Revisions'),\n      description: new TranslatableMarkup(''),\n    ),\n    'revisions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Revisions'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetModerationHistory extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'moderation';\n\n\n  protected ModerationService $moderationService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->moderationService = $container->get('mcp_tools_moderation.moderation');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? 'node';\n    $entityId = $input['entity_id'] ?? 0;\n    $limit = $input['limit'] ?? 50;\n\n    if (empty($entityId)) {\n      return ['success' => FALSE, 'error' => 'Entity ID is required.'];\n    }\n\n    return $this->moderationService->getModerationHistory($entityType, (int) $entityId, (int) $limit);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_moderation/src/Plugin/tool/Tool/GetModerationHistory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetModerationHistory", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class NonceGenerator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Csp;\n\n/**\n * Generates Content-Security-Policy nonce.\n *\n * @internal\n */\nclass NonceGenerator {\n\n  /**\n   * Generates Content-Security-Policy nonce.\n   *\n   * @return string\n   *   A nonce.\n   *\n   * @throws \\Exception\n   */\n  public function generate(): string {\n    return \\bin2hex(\\random_bytes(16));\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Csp/NonceGenerator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NonceGenerator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface PasswordInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Password;\n\n/**\n * Secure password hashing functions for user authentication.\n */\ninterface PasswordInterface {\n\n  /**\n   * Maximum password length.\n   */\n  const PASSWORD_MAX_LENGTH = 512;\n\n  /**\n   * Hash a password using a secure hash.\n   *\n   * @param string $password\n   *   A plain-text password.\n   *\n   * @return string\n   *   A string containing the hashed password, or FALSE on failure.\n   */\n  public function hash(#[\\SensitiveParameter] $password);\n\n  /**\n   * Check whether a plain text password matches a hashed password.\n   *\n   * @param string $password\n   *   A plain-text password.\n   * @param string|null $hash\n   *   A hashed password.\n   *\n   * @return bool\n   *   TRUE if the password is valid, FALSE if not.\n   */\n  public function check(#[\\SensitiveParameter] $password, #[\\SensitiveParameter] $hash);\n\n  /**\n   * Check whether a hashed password needs to be replaced with a new hash.\n   *\n   * This is typically called during the login process in order to trigger the\n   * rehashing of the password, as in that stage, the plain text password is\n   * available.\n   *\n   * This method returns TRUE if the password was hashed with an older\n   * algorithm.\n   *\n   * @param string|null $hash\n   *   The hash to be checked.\n   *\n   * @return bool\n   *   TRUE if the hash is outdated and needs rehash.\n   */\n  public function needsRehash(#[\\SensitiveParameter] $hash);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Password/PasswordInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PasswordInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TimeLogRequestListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\labor_time_tracker;\n\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * List all time log requests.\n */\nclass TimeLogRequestListBuilder extends EntityListBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    EntityTypeInterface $entityType,\n    EntityStorageInterface $storage,\n    protected DateFormatterInterface $dateFormatter,\n  ) {\n    parent::__construct($entityType, $storage);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager')->getStorage($entity_type->id()),\n      $container->get('date.formatter')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityIds() {\n    $query = $this->getStorage()->getQuery()\n      ->accessCheck(TRUE);\n\n    // Sort by status.\n    // Since \"pending\" is alphabetically between \"approved\" and \"rejected\",\n    // we sort by status DESC to likely get \"pending\" near the top,\n    // or use multiple conditions.\n    $query->sort('status', 'DESC');\n    $query->sort('id', 'DESC');\n\n    if ($this->limit) {\n      $query->pager($this->limit);\n    }\n\n    return $query->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    // $header['id']        = $this->t('ID');\n    $header['user']      = $this->t('User');\n    $header['original']  = $this->t('Original Log');\n    $header['new_start'] = $this->t('Proposed Start');\n    $header['new_exit']  = $this->t('Proposed Exit');\n    $header['status']    = $this->t('Status');\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    // $row['id']        = $entity->id();\n    $row['user']      = $entity->get('user_id')->entity ? $entity->get('user_id')->entity->label() : 'Unknown';\n    $row['original']  = $entity->get('time_log_id')->entity ? $entity->get('time_log_id')->entity->label() : 'Missing';\n    $row['new_start'] = $this->dateFormatter->format($entity->get('new_enter_time')->value, 'short');\n    $row['new_exit']  = $entity->get('new_exit_time')->value ? $this->dateFormatter->format($entity->get('new_exit_time')->value, 'short') : 'N/A';\n    $row['status']    = $entity->get('status')->value;\n\n    return $row + parent::buildRow($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultOperations(EntityInterface $entity) {\n    $operations = parent::getDefaultOperations($entity);\n\n    // Only show Accept/Reject if the status is pending.\n    if ($entity->get('status')->value == 'pending') {\n      $operations['accept'] = [\n        'title' => $this->t('Accept'),\n        'weight' => -10,\n        'url' => Url::fromRoute('labor_time_tracker.time_log_request.approve', ['time_log_request' => $entity->id()]),\n      ];\n      $operations['reject'] = [\n        'title' => $this->t('Reject'),\n        'weight' => -9,\n        'url' => Url::fromRoute('labor_time_tracker.time_log_request.reject', ['time_log_request' => $entity->id()]),\n      ];\n    }\n\n    return $operations;\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/TimeLogRequestListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TimeLogRequestListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Truncate in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\pgsql\\Driver\\Database\\pgsql;\n\nuse Drupal\\Core\\Database\\Query\\Truncate as QueryTruncate;\n\n/**\n * PostgreSQL implementation of \\Drupal\\Core\\Database\\Query\\Truncate.\n */\nclass Truncate extends QueryTruncate {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    $this->connection->addSavepoint();\n    try {\n      $result = parent::execute();\n    }\n    catch (\\Exception $e) {\n      $this->connection->rollbackSavepoint();\n      throw $e;\n    }\n    $this->connection->releaseSavepoint();\n\n    return $result;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/pgsql/src/Driver/Database/pgsql/Truncate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Truncate", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nslots:\n  brand:\n    - type: html_tag\n      tag: a\n      attributes:\n        href: \"#\"\n      value: Navbar\n  navigation_collapsible:\n    - type: component\n      component: \"bootstrap_components:navbar_nav\"\n      props:\n        variant: default\n        attributes:\n          class:\n            - me-auto\n            - mb-2\n            - mb-lg-0\n        items:\n          - title: Home\n            url: \"#\"\n            link_attributes:\n              class:\n                - active\n          - title: Link\n            url: \"#\"\n          - title: Dropdown\n            url: \"#\"\n            below:\n              - title: \"Action\"\n                url: \"#\"\n              - title: \"Another action\"\n                url: \"#\"\n              - {}\n              - title: \"Something else here\"\n                url: \"#\"\n          - title: Disabled\n            url: \"#\"\n            link_attributes:\n              class:\n                - disabled\nprops:\n  attributes:\n    class:\n      - bg-body-tertiary\n  variant: expand_lg\n  toggler_position: end\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/stories/navbar.default.story.yml", "type": "yaml_reference", "topic": "navbar.default.story"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: QueueOverviewController.php\nTarget symbol: class QueueOverviewController\nNamespace: Drupal\\queue_manager\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for QueueOverviewController.\n- Include required imports:\n  - Drupal\\Core\\Queue\\QueueWorkerManagerInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup as TM\n  - Drupal\\queue_manager\\Element\\QueueSize\n- Ensure these methods exist where relevant:\n  - __construct()\n  - __invoke()\n  - buildOperations()\n  - buildRow()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Controller;\n\nuse Drupal\\Core\\Queue\\QueueWorkerManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup as TM;\nuse Drupal\\queue_manager\\Element\\QueueSize;\n\n/**\n * {@selfdoc}\n */\nfinal readonly class QueueOverviewController {\n\n  /**\n   * {@selfdoc}\n   */\n  public function __construct(\n    private QueueWorkerManagerInterface $workerManager,\n  ) {}\n\n  /**\n   * {@selfdoc}\n   */\n  public function __invoke(): array {\n    $definitions = $this->workerManager->getDefinitions();\n    \\ksort($definitions);\n    return [\n      '#type' => 'table',\n      '#header' => [new TM('Queue'), new TM('Worker'), new TM('Items'), new TM('Operations')],\n      // @phpstan-ignore argument.type\n      '#rows' => \\array_map(self::buildRow(...), $definitions),\n      '#empty' => new TM('No queues were found.'),\n      '#attached' => ['library' => ['queue_manager/queue_overview']],\n      '#attributes' => ['class' => ['qm-queue-overview']],\n    ];\n  }\n\n  /**\n   * {@selfdoc}\n   */\n  private static function buildRow(array $definition): array {\n    $queue_name = $definition['id'];\n    \\assert(\\is_string($queue_name));\n    return [\n      'data' => [\n        $queue_name,\n        $definition['class'],\n        ['data' => [QueueSize::build(NULL, $queue_name, 0.5)]],\n        ['data' => self::buildOperations($queue_name)],\n      ],\n      'data-qm-queue-name' => $queue_name,\n    ];\n  }\n\n  /**\n   * {@selfdoc}\n   */\n  private static function buildOperations(string $queue_name): array {\n    return [\n      [\n        '#type' => 'button',\n        '#value' => new TM('Run'),\n        '#button_type' => 'small',\n        '#attributes' => [\n          'data-qm-queue-name' => $queue_name,\n          'data-qm-queue-overview-run' => TRUE,\n        ],\n      ],\n      [\n        '#type' => 'button',\n        '#value' => new TM('Stop'),\n        '#button_type' => 'small',\n        '#attributes' => [\n          'data-qm-queue-name' => $queue_name,\n          'data-qm-queue-overview-stop' => TRUE,\n        ],\n      ],\n      [\n        '#type' => 'button',\n        '#value' => new TM('Delete'),\n        '#button_type' => 'small',\n        '#attributes' => [\n          'data-qm-queue-name' => $queue_name,\n          'data-qm-queue-overview-delete' => TRUE,\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/src/Controller/QueueOverviewController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "QueueOverviewController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ZefixApiClient in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\zefix;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\ImmutableConfig;\nuse Drupal\\Core\\Logger\\LoggerChannelFactoryInterface;\nuse Drupal\\Core\\Logger\\LoggerChannelInterface;\n\n/**\n * Client to interact with the Zefix Public REST API.\n */\nclass ZefixApiClient {\n\n  /**\n   * The base URL for the test environment.\n   *\n   * @var string\n   */\n  private string $testBaseUrl = 'https://www.zefixintg.admin.ch/ZefixPublicREST/api/v1/';\n\n  /**\n   * The base URL for the production environment.\n   *\n   * @var string\n   */\n  private string $prodBaseUrl = 'https://www.zefix.admin.ch/ZefixPublicREST/api/v1/';\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ImmutableConfig\n   */\n  protected ImmutableConfig $config;\n\n  /**\n   * The logger factory.\n   *\n   * @var \\Drupal\\Core\\Logger\\LoggerChannelInterface\n   */\n  protected LoggerChannelInterface $logger;\n\n  /**\n   * Constructs a ZefixApiClient object.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Drupal\\Core\\Logger\\LoggerChannelFactoryInterface $logger\n   *   The logger factory.\n   */\n  public function __construct(ConfigFactoryInterface $config_factory, LoggerChannelFactoryInterface $logger) {\n    $this->config = $config_factory->get('zefix.settings');\n    $this->logger = $logger->get('zefix');\n  }\n\n  /**\n   * Make a GET request to the Zefix API.\n   *\n   * @param string $endpoint\n   *   The API endpoint.\n   * @param string|null $value\n   *   The value to append to the endpoint.\n   *\n   * @return array|null\n   *   The response data or null on error.\n   */\n  public function get(string $endpoint, ?string $value): ?array {\n    $url = $this->getUrl($value, $endpoint);\n\n    $curl = curl_init();\n    curl_setopt_array($curl, [\n      CURLOPT_URL => $url,\n      CURLOPT_RETURNTRANSFER => TRUE,\n      CURLOPT_ENCODING => '',\n      CURLOPT_MAXREDIRS => 10,\n      CURLOPT_TIMEOUT => 0,\n      CURLOPT_FOLLOWLOCATION => TRUE,\n      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,\n      CURLOPT_CUSTOMREQUEST => 'GET',\n      CURLOPT_USERPWD => $this->config->get('user') . ':' . $this->config->get('password'),\n    ]);\n\n    $response = curl_exec($curl);\n    $httpcode = curl_getinfo($curl, CURLINFO_RESPONSE_CODE);\n    curl_close($curl);\n\n    if ($httpcode === 200) {\n      return json_decode($response, TRUE);\n    }\n    else {\n      $this->logger->error(\"API request failed: @code - @response\", [\n        '@code' => $httpcode,\n        '@response' => $response,\n      ]);\n      return NULL;\n    }\n  }\n\n  /**\n   * Make a POST request to the Zefix API.\n   *\n   * @param string $endpoint\n   *   The API endpoint.\n   * @param array $data\n   *   The data to send in the POST request.\n   *\n   * @return array|null\n   *   The response data or null on error.\n   */\n  public function post(string $endpoint, array $data): ?array {\n    $url = $this->getUrl(NULL, $endpoint);\n    $curl = curl_init();\n    curl_setopt_array($curl, [\n      CURLOPT_URL => $url,\n      CURLOPT_RETURNTRANSFER => TRUE,\n      CURLOPT_ENCODING => '',\n      CURLOPT_MAXREDIRS => 10,\n      CURLOPT_TIMEOUT => 0,\n      CURLOPT_FOLLOWLOCATION => TRUE,\n      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,\n      CURLOPT_CUSTOMREQUEST => 'POST',\n      CURLOPT_POSTFIELDS => json_encode($data),\n      CURLOPT_USERPWD => $this->config->get('user') . ':' . $this->config->get('password'),\n      CURLOPT_HTTPHEADER => [\n        'Content-Type: application/json',\n      ],\n    ]);\n\n    $response = curl_exec($curl);\n    $httpcode = curl_getinfo($curl, CURLINFO_RESPONSE_CODE);\n    curl_close($curl);\n\n    if ($httpcode === 200) {\n      return json_decode($response, TRUE);\n    }\n    else {\n      $this->logger->error(\"API request failed: @code - @response\", [\n        '@code' => $httpcode,\n        '@response' => $response,\n      ]);\n      return NULL;\n    }\n  }\n\n  /**\n   * Construct the full URL for the API request.\n   *\n   * @param string|null $value\n   *   The value to append to the endpoint.\n   * @param string $endpoint\n   *   The API endpoint.\n   *\n   * @return string\n   *   The full URL.\n   */\n  public function getUrl(?string $value, string $endpoint): string {\n    if ($value === NULL) {\n      $url = $this->config->get('environment') === 'test' ? $this->testBaseUrl . $endpoint : $this->prodBaseUrl . $endpoint;\n    }\n    else {\n      $url = $this->config->get('environment') === 'test' ? $this->testBaseUrl . $endpoint . '/' . $value : $this->prodBaseUrl . $endpoint . '/' . $value;\n    }\n    return $url;\n  }\n\n}\n", "metadata": {"source": "repos/zefix/src/ZefixApiClient.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ZefixApiClient", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class OEmbedResourceConstraint in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\media\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Checks if a value represents a valid oEmbed resource URL.\n *\n * @internal\n *   This is an internal part of the oEmbed system and should only be used by\n *   oEmbed-related code in Drupal core.\n */\n#[Constraint(\n  id: 'oembed_resource',\n  label: new TranslatableMarkup('oEmbed resource', [], ['context' => 'Validation']),\n  type: ['link', 'string', 'string_long']\n)]\nclass OEmbedResourceConstraint extends SymfonyConstraint {\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    public $unknownProviderMessage = 'The given URL does not match any known oEmbed providers.',\n    public $disallowedProviderMessage = 'Sorry, the @name provider is not allowed.',\n    public $invalidResourceMessage = 'The provided URL does not represent a valid oEmbed resource.',\n    public $providerErrorMessage = 'An error occurred while trying to retrieve the oEmbed provider database.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Plugin/Validation/Constraint/OEmbedResourceConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OEmbedResourceConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * FlowDrop Search Toolbar Component\n *\n * Search input with optional view toggle.\n *\n * Available variables:\n * - placeholder: Input placeholder text (default: \"Search...\")\n * - name: Input name attribute (default: \"search\")\n * - value: Current search value\n * - show_view_toggle: Whether to show list/grid toggle\n * - current_view: Current view mode (list, grid)\n * - view_toggle_param: URL parameter for view mode\n */\n#}\n\n{% set placeholder = placeholder|default('Search...') %}\n{% set name = name|default('search') %}\n{% set current_view = current_view|default('list') %}\n\n<div class=\"fd-search-toolbar\">\n  <div class=\"fd-search-toolbar__search\">\n    <svg class=\"fd-search-toolbar__icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n      <path fill-rule=\"evenodd\" d=\"M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z\" clip-rule=\"evenodd\" />\n    </svg>\n    <input\n      type=\"search\"\n      name=\"{{ name }}\"\n      class=\"fd-search-toolbar__input\"\n      placeholder=\"{{ placeholder }}\"\n      {% if value %}value=\"{{ value }}\"{% endif %}\n      autocomplete=\"off\"\n    >\n  </div>\n\n  {% if show_view_toggle %}\n    <div class=\"fd-search-toolbar__views\" role=\"group\" aria-label=\"View options\">\n      <button\n        type=\"button\"\n        class=\"fd-search-toolbar__view-btn{% if current_view == 'list' %} fd-search-toolbar__view-btn--active{% endif %}\"\n        aria-pressed=\"{{ current_view == 'list' ? 'true' : 'false' }}\"\n        data-view=\"list\"\n        title=\"List view\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n          <path fill-rule=\"evenodd\" d=\"M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10zm0 5.25a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75z\" clip-rule=\"evenodd\" />\n        </svg>\n        <span class=\"fd-sr-only\">List view</span>\n      </button>\n      <button\n        type=\"button\"\n        class=\"fd-search-toolbar__view-btn{% if current_view == 'grid' %} fd-search-toolbar__view-btn--active{% endif %}\"\n        aria-pressed=\"{{ current_view == 'grid' ? 'true' : 'false' }}\"\n        data-view=\"grid\"\n        title=\"Grid view\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n          <path fill-rule=\"evenodd\" d=\"M4.25 2A2.25 2.25 0 002 4.25v2.5A2.25 2.25 0 004.25 9h2.5A2.25 2.25 0 009 6.75v-2.5A2.25 2.25 0 006.75 2h-2.5zm0 9A2.25 2.25 0 002 13.25v2.5A2.25 2.25 0 004.25 18h2.5A2.25 2.25 0 009 15.75v-2.5A2.25 2.25 0 006.75 11h-2.5zm9-9A2.25 2.25 0 0011 4.25v2.5A2.25 2.25 0 0013.25 9h2.5A2.25 2.25 0 0018 6.75v-2.5A2.25 2.25 0 0015.75 2h-2.5zm0 9A2.25 2.25 0 0011 13.25v2.5A2.25 2.25 0 0013.25 18h2.5A2.25 2.25 0 0018 15.75v-2.5A2.25 2.25 0 0015.75 11h-2.5z\" clip-rule=\"evenodd\" />\n        </svg>\n        <span class=\"fd-sr-only\">Grid view</span>\n      </button>\n    </div>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/search-toolbar/search-toolbar.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class UserLogin in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Event type for user login events.\n *\n * Triggers when a user successfully logs into the site.\n * This event fires after authentication is complete.\n */\n#[FlowDropEventType(\n  id: \"user.login\",\n  label: new TranslatableMarkup(\"User Login\"),\n  description: new TranslatableMarkup(\"Triggered when a user logs in\"),\n  category: \"user\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [\"user\"],\n)]\nclass UserLogin extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategory(): string {\n    return \"user\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for user login events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add user-specific data.\n    $data[\"operation\"] = \"login\";\n\n    if ($entity instanceof UserInterface) {\n      $data[\"username\"] = $entity->getAccountName();\n      $data[\"email\"] = $entity->getEmail();\n      $data[\"roles\"] = $entity->getRoles();\n      $data[\"last_login\"] = $entity->getLastLoginTime();\n      $data[\"is_active\"] = $entity->isActive();\n    }\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"roles\" => [\n          \"type\" => \"array\",\n          \"title\" => \"User Roles\",\n          \"description\" => \"Only trigger for users with these roles (empty = all)\",\n          \"items\" => [\"type\" => \"string\"],\n          \"default\" => [],\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/UserLogin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserLogin", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ProfileForm.php\nTarget symbol: class ProfileForm\nNamespace: Drupal\\user\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ProfileForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - actions()\n  - save()", "output": "<?php\n\nnamespace Drupal\\user;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form handler for the profile forms.\n *\n * @internal\n */\nclass ProfileForm extends AccountForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    $element = parent::actions($form, $form_state);\n\n    if (!$this->entity->isNew() && $this->entity->hasLinkTemplate('cancel-form')) {\n      $route_info = $this->entity->toUrl('cancel-form');\n      if ($this->getRequest()->query->has('destination')) {\n        $query = $route_info->getOption('query');\n        $query['destination'] = $this->getRequest()->query->get('destination');\n        $route_info->setOption('query', $query);\n      }\n      $element['delete'] = [\n        '#type' => 'link',\n        '#title' => $this->t('Cancel account'),\n        '#access' => $this->entity->id() > 1 && $this->entity->access('delete'),\n        '#attributes' => [\n          'class' => ['button', 'button--danger'],\n        ],\n      ];\n      $element['delete']['#url'] = $route_info;\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    $account = $this->entity;\n    $account->save();\n    $form_state->setValue('uid', $account->id());\n\n    $this->messenger()->addStatus($this->t('The changes have been saved.'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/ProfileForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProfileForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BooleanFormatter.php\nTarget symbol: class BooleanFormatter\nNamespace: Drupal\\Core\\Field\\Plugin\\Field\\FieldFormatter\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BooleanFormatter.\n- Include required imports:\n  - Drupal\\Core\\Field\\Attribute\\FieldFormatter\n  - Drupal\\Core\\Field\\FormatterBase\n  - Drupal\\Core\\Field\\FieldItemListInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n- Ensure these methods exist where relevant:\n  - defaultSettings()\n  - getOutputFormats()\n  - settingsForm()\n  - settingsSummary()\n  - viewElements()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Field\\FormatterBase;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'boolean' formatter.\n */\n#[FieldFormatter(\n  id: 'boolean',\n  label: new TranslatableMarkup('Boolean'),\n  field_types: [\n    'boolean',\n  ],\n)]\nclass BooleanFormatter extends FormatterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    $settings = [];\n\n    // Fall back to field settings by default.\n    $settings['format'] = 'default';\n    $settings['format_custom_false'] = '';\n    $settings['format_custom_true'] = '';\n\n    return $settings;\n  }\n\n  /**\n   * Gets the available format options.\n   *\n   * @return array|string\n   *   A list of output formats. Each entry is keyed by the machine name of the\n   *   format. The value is an array, of which the first item is the result for\n   *   boolean TRUE, the second is for boolean FALSE. The value can be also an\n   *   array, but this is just the case for the custom format.\n   */\n  protected function getOutputFormats() {\n    $formats = [\n      'default' => [$this->getFieldSetting('on_label'), $this->getFieldSetting('off_label')],\n      'yes-no' => [$this->t('Yes'), $this->t('No')],\n      'true-false' => [$this->t('True'), $this->t('False')],\n      'on-off' => [$this->t('On'), $this->t('Off')],\n      'enabled-disabled' => [$this->t('Enabled'), $this->t('Disabled')],\n      'boolean' => [1, 0],\n      'unicode-yes-no' => ['\u2714', '\u2716'],\n      'custom' => $this->t('Custom'),\n    ];\n\n    return $formats;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $form = parent::settingsForm($form, $form_state);\n\n    $formats = [];\n    foreach ($this->getOutputFormats() as $format_name => $format) {\n      if (is_array($format)) {\n        if ($format_name == 'default') {\n          $formats[$format_name] = $this->t('Field settings (@on_label / @off_label)', [\n            '@on_label' => $format[0],\n            '@off_label' => $format[1],\n          ]);\n        }\n        else {\n          $formats[$format_name] = $this->t('@on_label / @off_label', [\n            '@on_label' => $format[0],\n            '@off_label' => $format[1],\n          ]);\n        }\n      }\n      else {\n        $formats[$format_name] = $format;\n      }\n    }\n\n    $field_name = $this->fieldDefinition->getName();\n    $form['format'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Output format'),\n      '#default_value' => $this->getSetting('format'),\n      '#options' => $formats,\n    ];\n    $form['format_custom_true'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Custom output for TRUE'),\n      '#default_value' => $this->getSetting('format_custom_true'),\n      '#states' => [\n        'visible' => [\n          'select[name=\"fields[' . $field_name . '][settings_edit_form][settings][format]\"]' => ['value' => 'custom'],\n        ],\n      ],\n    ];\n    $form['format_custom_false'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Custom output for FALSE'),\n      '#default_value' => $this->getSetting('format_custom_false'),\n      '#states' => [\n        'visible' => [\n          'select[name=\"fields[' . $field_name . '][settings_edit_form][settings][format]\"]' => ['value' => 'custom'],\n        ],\n      ],\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsSummary() {\n    $summary = [];\n    $setting = $this->getSetting('format');\n\n    if ($setting == 'custom') {\n      $summary[] = $this->t('Custom text: @true_label / @false_label', [\n        '@true_label' => $this->getSetting('format_custom_true'),\n        '@false_label' => $this->getSetting('format_custom_false'),\n      ]);\n    }\n    else {\n      $formats = $this->getOutputFormats();\n      $summary[] = $this->t('Display: @true_label / @false_label', [\n        '@true_label' => $formats[$setting][0],\n        '@false_label' => $formats[$setting][1],\n      ]);\n    }\n\n    return $summary;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewElements(FieldItemListInterface $items, $langcode) {\n    $elements = [];\n\n    $formats = $this->getOutputFormats();\n\n    foreach ($items as $delta => $item) {\n      $format = $this->getSetting('format');\n\n      if ($format == 'custom') {\n        $elements[$delta] = ['#markup' => $item->value ? $this->getSetting('format_custom_true') : $this->getSetting('format_custom_false')];\n      }\n      else {\n        $elements[$delta] = ['#markup' => $item->value ? $formats[$format][0] : $formats[$format][1]];\n      }\n    }\n\n    return $elements;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldFormatter/BooleanFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BooleanFormatter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      color: #333;\n      background-color: #f6f6f6;\n      padding: 20px;\n    }\n    .container {\n      background-color: #ffffff;\n      padding: 20px;\n      border-radius: 6px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      max-width: 600px;\n      margin: 0 auto;\n    }\n    .footer {\n      font-size: 12px;\n      color: #999;\n      margin-top: 20px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <h2>SEO Audit Completed</h2>\n    <p>Hello,</p>\n    <p>Your SEO audit crawl has successfully completed.</p>\n\n    {% if report_url %}\n    <p>You can download the full PDF report here:</p>\n    <p><a href=\"{{ report_url }}\" target=\"_blank\">Download PDF</a></p>\n    {% endif %}\n\n    <p>Thank you,<br>The SEO Audit Team</p>\n\n    <div class=\"footer\">\n      This is an automated message. Please do not reply.\n    </div>\n  </div>\n</body>\n</html>\n", "metadata": {"source": "repos/seo_audit/templates/seo_audit_notification.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface EntityLinkTargetInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\GeneratedUrl;\n\n/**\n * Provides an interface for generating a link target from an entity.\n */\ninterface EntityLinkTargetInterface {\n\n  /**\n   * Gets the generated URL object for a linked entity's link target.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   A linked entity.\n   *\n   * @return \\Drupal\\Core\\GeneratedUrl\n   *   The generated URL plus cacheability metadata.\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/EntityLinkTargetInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityLinkTargetInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Custom in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\field;\n\nuse Drupal\\Component\\Utility\\Xss;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsField;\nuse Drupal\\views\\Render\\ViewsRenderPipelineMarkup;\nuse Drupal\\views\\ResultRow;\n\n/**\n * A handler to provide a field that is completely custom by the administrator.\n *\n * @ingroup views_field_handlers\n */\n#[ViewsField(\"custom\")]\nclass Custom extends FieldPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesGroupBy() {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Do nothing -- to override the parent query.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n\n    // Override the alter text option to always alter the text.\n    $options['alter']['contains']['alter_text'] = ['default' => TRUE];\n    $options['hide_alter_empty'] = ['default' => FALSE];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n\n    // Remove the checkbox.\n    unset($form['alter']['alter_text']);\n    unset($form['alter']['text']['#states']);\n    unset($form['alter']['help']['#states']);\n    $form['#pre_render'][] = [$this, 'preRenderCustomForm'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function trustedCallbacks() {\n    $callbacks = parent::trustedCallbacks();\n    $callbacks[] = 'preRenderCustomForm';\n    return $callbacks;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(ResultRow $values) {\n    // Return the text, so the code never thinks the value is empty.\n    return ViewsRenderPipelineMarkup::create(Xss::filterAdmin($this->options['alter']['text']));\n  }\n\n  /**\n   * Prerender function to move the textarea to the top of a form.\n   *\n   * @param array $form\n   *   The form build array.\n   *\n   * @return array\n   *   The modified form build array.\n   */\n  public function preRenderCustomForm($form) {\n    $form['text'] = $form['alter']['text'];\n    $form['help'] = $form['alter']['help'];\n    unset($form['alter']['text']);\n    unset($form['alter']['help']);\n\n    return $form;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/field/Custom.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Custom", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CacheableUnauthorizedHttpException.php\nTarget symbol: class CacheableUnauthorizedHttpException\nNamespace: Drupal\\Core\\Http\\Exception\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CacheableUnauthorizedHttpException.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheableDependencyInterface\n  - Drupal\\Core\\Cache\\CacheableDependencyTrait\n  - Symfony\\Component\\HttpKernel\\Exception\\UnauthorizedHttpException\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "<?php\n\nnamespace Drupal\\Core\\Http\\Exception;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\CacheableDependencyTrait;\nuse Symfony\\Component\\HttpKernel\\Exception\\UnauthorizedHttpException;\n\n/**\n * A cacheable UnauthorizedHttpException.\n */\nclass CacheableUnauthorizedHttpException extends UnauthorizedHttpException implements CacheableDependencyInterface {\n\n  use CacheableDependencyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(CacheableDependencyInterface $cacheability, $challenge, $message = '', ?\\Throwable $previous = NULL, $code = 0) {\n    $this->setCacheability($cacheability);\n    parent::__construct($challenge, $message, $previous, $code);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Http/Exception/CacheableUnauthorizedHttpException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CacheableUnauthorizedHttpException", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ActionManager.php\nTarget symbol: class ActionManager\nNamespace: Drupal\\Core\\Action\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ActionManager.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\CategorizingPluginManagerInterface\n  - Drupal\\Core\\Action\\Attribute\\Action\n  - Drupal\\Core\\Cache\\CacheBackendInterface\n  - Drupal\\Core\\Extension\\ModuleHandlerInterface\n  - Drupal\\Core\\Plugin\\CategorizingPluginManagerTrait\n  - Drupal\\Core\\Plugin\\DefaultPluginManager\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getDefinitionsByType()", "output": "<?php\n\nnamespace Drupal\\Core\\Action;\n\nuse Drupal\\Component\\Plugin\\CategorizingPluginManagerInterface;\nuse Drupal\\Core\\Action\\Attribute\\Action;\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\CategorizingPluginManagerTrait;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\n\n/**\n * Provides an Action plugin manager.\n *\n * @see \\Drupal\\Core\\Annotation\\Action\n * @see \\Drupal\\Core\\Action\\ActionInterface\n * @see \\Drupal\\Core\\Action\\ActionBase\n * @see plugin_api\n */\nclass ActionManager extends DefaultPluginManager implements CategorizingPluginManagerInterface {\n\n  use CategorizingPluginManagerTrait;\n\n  /**\n   * Constructs a new class instance.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler) {\n    parent::__construct('Plugin/Action', $namespaces, $module_handler, ActionInterface::class, Action::class, 'Drupal\\Core\\Annotation\\Action');\n    $this->alterInfo('action_info');\n    $this->setCacheBackend($cache_backend, 'action_info');\n  }\n\n  /**\n   * Gets the plugin definitions for this entity type.\n   *\n   * @param string $type\n   *   The entity type name.\n   *\n   * @return array\n   *   An array of plugin definitions for this entity type.\n   */\n  public function getDefinitionsByType($type) {\n    return array_filter($this->getDefinitions(), function ($definition) use ($type) {\n      return $definition['type'] === $type;\n    });\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Action/ActionManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ActionManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  logger.channel.mcp_tools_remote:\n    parent: logger.channel_base\n    arguments: ['mcp_tools_remote']\n\n  mcp_tools_remote.api_key_manager:\n    class: Drupal\\mcp_tools_remote\\Service\\ApiKeyManager\n    arguments:\n      - '@state'\n      - '@private_key'\n      - '@datetime.time'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_remote/mcp_tools_remote.services.yml", "type": "yaml_reference", "topic": "mcp tools remote.services"}}
{"instruction": "Show me the implementation of the class SettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\ai_image_crop\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\ai\\AiProviderPluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configuration form for AI Image Crop settings.\n */\nclass SettingsForm extends ConfigFormBase {\n\n  /**\n   * The AI provider plugin manager.\n   */\n  protected AiProviderPluginManager $aiProvider;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    $instance = parent::create($container);\n    $instance->aiProvider = $container->get('ai.provider');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string {\n    return 'ai_image_crop_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array {\n    return ['ai_image_crop.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state): array {\n    $config = $this->config('ai_image_crop.settings');\n\n    // Get available AI providers.\n    $providers = [];\n    foreach ($this->aiProvider->getDefinitions() as $id => $definition) {\n      $providers[$id] = $definition['label'] ?? $id;\n    }\n\n    $form['ai_provider'] = [\n      '#type' => 'select',\n      '#title' => $this->t('AI Provider'),\n      '#description' => $this->t('Select the AI provider to use for image analysis.'),\n      '#options' => $providers,\n      '#default_value' => $config->get('ai_provider'),\n      '#required' => TRUE,\n    ];\n\n    $form['ai_model'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('AI Model'),\n      '#description' => $this->t('The model to use for image analysis (e.g., gpt-4-vision, gpt-5.1).'),\n      '#default_value' => $config->get('ai_model'),\n      '#required' => TRUE,\n    ];\n\n    $form['max_iterations'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum iterations'),\n      '#description' => $this->t('Maximum number of zoom iterations for the AI to refine the focal point.'),\n      '#default_value' => $config->get('max_iterations') ?? 5,\n      '#min' => 1,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['grid_settings'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Grid settings'),\n      '#description' => $this->t('Configure the grid used for focal point detection. The AI will select cells from this grid to zoom into.'),\n      '#open' => TRUE,\n    ];\n\n    $form['grid_settings']['grid_columns'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid columns'),\n      '#description' => $this->t('Number of columns in the selection grid.'),\n      '#default_value' => $config->get('grid_columns') ?? 6,\n      '#min' => 2,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['grid_settings']['grid_rows'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid rows'),\n      '#description' => $this->t('Number of rows in the selection grid.'),\n      '#default_value' => $config->get('grid_rows') ?? 6,\n      '#min' => 2,\n      '#max' => 10,\n      '#required' => TRUE,\n    ];\n\n    $form['action_settings'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Bulk action settings'),\n      '#open' => FALSE,\n    ];\n\n    $form['action_settings']['action_override_behavior'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Existing crops behavior'),\n      '#description' => $this->t('Controls how bulk actions handle images that already have crops applied.'),\n      '#options' => [\n        'follow_widget' => $this->t('Follow widget settings - Use the \"Override existing crops\" setting from each field widget'),\n        'always_override' => $this->t('Always replace - Override all existing crops regardless of widget settings'),\n        'never_override' => $this->t('Skip existing - Never override existing crops regardless of widget settings'),\n      ],\n      '#default_value' => $config->get('action_override_behavior') ?? 'follow_widget',\n    ];\n\n    $form['prompts'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Default prompts'),\n      '#open' => TRUE,\n    ];\n\n    $form['prompts']['default_focal_point_prompt'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Default focal point prompt'),\n      '#description' => $this->t('The default prompt used for focal point detection. This can be overridden per widget.'),\n      '#default_value' => $config->get('default_focal_point_prompt'),\n      '#rows' => 4,\n      '#required' => TRUE,\n    ];\n\n    $form['prompts']['default_crop_prompt'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Default crop prompt'),\n      '#description' => $this->t('The default prompt used for crop area detection. This can be overridden per widget.'),\n      '#default_value' => $config->get('default_crop_prompt'),\n      '#rows' => 4,\n      '#required' => TRUE,\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state): void {\n    $this->config('ai_image_crop.settings')\n      ->set('ai_provider', $form_state->getValue('ai_provider'))\n      ->set('ai_model', $form_state->getValue('ai_model'))\n      ->set('max_iterations', $form_state->getValue('max_iterations'))\n      ->set('grid_columns', $form_state->getValue('grid_columns'))\n      ->set('grid_rows', $form_state->getValue('grid_rows'))\n      ->set('action_override_behavior', $form_state->getValue('action_override_behavior'))\n      ->set('default_focal_point_prompt', $form_state->getValue('default_focal_point_prompt'))\n      ->set('default_crop_prompt', $form_state->getValue('default_crop_prompt'))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/ai_image_crop/src/Form/SettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Extending and altering Drupal", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Extending and altering Drupal\n\nSame name and namespace in other branches\n\n1. [11.x core/core.api.php](/api/drupal/core%21core.api.php/group/extending/11.x) \\extending\n2. [9 core/core.api.php](/api/drupal/core%21core.api.php/group/extending/9) \\extending\n3. [8.9.x core/core.api.php](/api/drupal/core%21core.api.php/group/extending/8.9.x) \\extending\n\nOverview of extensions and alteration methods for Drupal.\n\n### Types of extensions\n\nDrupal's core behavior can be extended and altered via these three basic\ntypes of extensions:\n\n* **Themes**: Themes alter the appearance of Drupal sites. They can include\n  template files, which alter the HTML markup and other raw output of the\n  site; CSS files, which alter the styling applied to the HTML; and\n  JavaScript, Flash, images, and other files. For more information, see the\n  [Theme system and render API topic](/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/theme_render/10 \"Overview of the Theme system and Render API.\") and\n  <https://www.drupal.org/docs/theming-drupal>\n* **Modules**: Modules add to or alter the behavior and functionality of Drupal,\n  by using one or more of the methods listed below. For more information\n  about creating modules, see <https://www.drupal.org/docs/creating-custom-modules>\n* **Installation profiles**: Installation profiles can be used to\n  create distributions, which are complete specific-purpose packages of\n  Drupal including additional modules, themes, and data. For more\n  information, see <https://www.drupal.org/developing/distributions>.\n\n### Alteration methods for modules\n\nHere is a list of the ways that modules can alter or extend Drupal's core\nbehavior, or the behavior of other modules:\n\n* **Hooks**: Specially-named functions that a module defines, which are\n  discovered and called at specific times, usually to alter behavior or data.\n  See the [Hooks topic](/api/drupal/core%21core.api.php/group/hooks/10 \"Define functions that alter the behavior of Drupal core.\") for more information.\n* **Plugins**: Classes that a module defines, which are discovered and\n  instantiated at specific times to add functionality. See the\n  [Plugin API topic](/api/drupal/core%21core.api.php/group/plugin_api/10 \"Using the Plugin API\") for more information.\n* **Entities**: Special plugins that define entity types for storing new types\n  of content or configuration in Drupal. See the\n  [Entity API topic](/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/10 \"Describes how to define and manipulate content and configuration entities.\") for more information.\n* **Services**: Classes that perform basic operations within Drupal, such as\n  accessing the database and sending email. See the\n  [Dependency Injection Container and Services topic](/api/drupal/core%21core.api.php/group/container/10 \"Overview of the Dependency Injection Container and Services.\")\n  for more information.\n* **Routing**: Providing or altering \"routes\", which are URLs that Drupal\n  responds to, or altering routing behavior with event listener classes.\n  See the [Routing and menu topic](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/group/menu/10 \"Define the navigation menus, local actions and tasks, and contextual links.\") for more information.\n* **Events**: Modules can register as event subscribers; when an event is\n  dispatched, a method is called on each registered subscriber, allowing each\n  one to react. See the [Events topic](/api/drupal/core%21core.api.php/group/events/10 \"Overview of event dispatch and subscribing\") for more\n  information.\n\n### \\*.info.yml files\n\nExtensions must each be located in a directory whose name matches the short\nname (or machine name) of the extension, and this directory must contain a\nfile named machine\\_name.info.yml (where machine\\_name is the machine name of\nthe extension). See [\\Drupal\\Core\\Extension\\InfoParserInterface::parse](/api/drupal/core%21lib%21Drupal%21Core%21Extension%21InfoParserInterface.php/function/InfoParserInterface%3A%3Aparse/10 \"Parses Drupal module, theme and profile .info.yml files.\")() for\ndocumentation of the format of .info.yml files.\n\n### File\n\ncore/[core.api.php](/api/drupal/core%21core.api.php/10), line 1238\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=10-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521core.api.php/group/extending/10%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21core.api.php/group/extending/10.md", "type": "doc_summary", "topic": "Extending and altering Drupal"}}
{"instruction": "Show me the implementation of the class DeleteForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\comment\\Form;\n\nuse Drupal\\Core\\Entity\\ContentEntityDeleteForm;\n\n/**\n * Provides the comment delete confirmation form.\n *\n * @internal\n */\nclass DeleteForm extends ContentEntityDeleteForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl() {\n    // Point to the entity of which this comment is a reply.\n    return $this->entity->get('entity_id')->entity->toUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getRedirectUrl() {\n    return $this->getCancelUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription() {\n    return $this->t('Any replies to this comment will be lost. This action cannot be undone.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDeletionMessage() {\n    return $this->t('The comment and all its replies have been deleted.');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function logDeletionMessage() {\n    $this->logger('comment')->info('Deleted comment @cid and its replies.', ['@cid' => $this->entity->id()]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/Form/DeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Select.php\nTarget symbol: class Select\nNamespace: Drupal\\sqlite\\Driver\\Database\\sqlite\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Select.\n- Include required imports:\n  - Drupal\\Core\\Database\\Query\\Select as QuerySelect\n- Ensure these methods exist where relevant:\n  - forUpdate()", "output": "<?php\n\nnamespace Drupal\\sqlite\\Driver\\Database\\sqlite;\n\nuse Drupal\\Core\\Database\\Query\\Select as QuerySelect;\n\n/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Query\\Select.\n */\nclass Select extends QuerySelect {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function forUpdate($set = TRUE) {\n    // SQLite does not support FOR UPDATE so nothing to do.\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/sqlite/src/Driver/Database/sqlite/Select.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Select", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: API Normalization Feeds Integration", "input": "", "output": "# API Normalization Feeds Integration\n\nIntegrates API Normalization with Drupal Feeds module for bulk API imports.\n\n## Overview\n\nAPI Normalization Feeds Integration is a **submodule** that bridges the API Normalization module with the Drupal Feeds module, enabling bulk imports of normalized API data.\n\n## Features\n\n- Bulk API data imports using Feeds module\n- Normalized API response processing\n- Configurable field mappings\n- Support for multiple API providers\n- Batch processing for large datasets\n\n## Requirements\n\n- Drupal 10.3+ or 11.x\n- API Normalization (parent module)\n- **Feeds module** (`feeds/feeds`) - Required contrib module\n\n## Installation\n\n```bash\n# Install Feeds module first\ncomposer require drupal/feeds\n\n# Enable modules\ndrush en api_normalization feeds api_normalization_feeds\n```\n\n## Configuration\n\n1. Navigate to **Admin > Structure > Feeds**\n2. Create a new Feed Type\n3. Configure API Normalization as the fetcher/parser\n4. Map fields from normalized API responses to Drupal entities\n\n## Usage\n\n### Creating a Feed Importer\n\n1. Go to `/admin/structure/feeds`\n2. Click \"Add feed type\"\n3. Configure:\n   - **Fetcher**: API Normalization Fetcher\n   - **Parser**: API Normalization Parser\n   - **Processor**: Your target entity type\n\n### Field Mapping\n\nMap normalized API fields to your Drupal entity fields:\n\n```yaml\n# Example mapping configuration\nsource_field: normalized_api_field\ntarget_field: drupal_entity_field\n```\n\n### Running Imports\n\n```bash\n# Via Drush\ndrush feeds:import feed_type_id\n\n# Via UI\n# Navigate to Content > Feeds > Import\n```\n\n## API Integration\n\nThis module extends Feeds with API Normalization capabilities:\n\n```php\n// Feeds will automatically use normalized API responses\n$feed = Feed::create([\n  'type' => 'api_normalized_feed',\n  'title' => 'My API Feed',\n]);\n$feed->import();\n```\n\n## Use Cases\n\n1. **Content Migration**: Bulk import content from external APIs\n2. **Data Synchronization**: Regular updates from API providers\n3. **Multi-source Aggregation**: Combine data from multiple APIs\n4. **Automated Content Creation**: Schedule regular API imports\n\n## Related Modules\n\n- **api_normalization** - Parent module (required)\n- **feeds** - Drupal Feeds module (required)\n- **api_normalization_ui** - Enhanced UI components\n- **api_normalization_graphql** - GraphQL support\n\n## Troubleshooting\n\n### Import Failures\n\nCheck:\n1. API credentials are configured in API Normalization settings\n2. Feed type is properly configured\n3. Field mappings are correct\n4. API endpoints are accessible\n\n### Performance Issues\n\nFor large imports:\n1. Enable batch processing in Feed type settings\n2. Adjust PHP memory limits\n3. Use Drush for command-line imports\n4. Consider using Queue API for background processing\n\n## Documentation\n\n- [API Normalization Documentation](../../README.md)\n- [Feeds Module Documentation](https://www.drupal.org/docs/contributed-modules/feeds)\n\n## Support\n\n- Issue queue: https://www.drupal.org/project/issues/api_normalization\n- Feeds documentation: https://www.drupal.org/docs/contributed-modules/feeds\n\n## License\n\nGPL-2.0-or-later\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_feeds/README.md", "type": "doc_summary", "topic": "API Normalization Feeds Integration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override to display a block.\n *\n * Available variables:\n * - plugin_id: The ID of the block implementation.\n * - label: The configured label of the block if visible.\n * - configuration: A list of the block's configuration values.\n *   - label: The configured label for the block.\n *   - label_display: The display settings for the label.\n *   - provider: The module or other provider that provided this block plugin.\n *   - Block plugin specific settings will also be stored here.\n * - content: The content of this block.\n * - attributes: array of HTML attributes populated by modules, intended to\n *   be added to the main container tag of this template.\n *   - id: A valid HTML ID and guaranteed unique.\n * - title_attributes: Same as attributes, except applied to the main title\n *   tag that appears in the template.\n * - title_prefix: Additional output populated by modules, intended to be\n *   displayed in front of the main title tag that appears in the template.\n * - title_suffix: Additional output populated by modules, intended to be\n *   displayed after the main title tag that appears in the template.\n *\n * @see template_preprocess_block()\n */\n#}\n\n<div class=\"laposta-subscribe-wrapper\">\n  <div class=\"laposta-subscribe\">\n    <div class=\"laposta-subscribe-list-details\">\n      {% if list_name %}\n        <h2>{{ list_name }}</h2>\n      {% else %}\n        <h2>{{ 'Subscribe to our newsletter'|t }}</h2>\n      {% endif %}\n      {% if show_list_remarks and list_remarks %}\n        <p>{{ list_remarks }}</p>\n      {% endif %}\n    </div>\n    {% if field_order is not empty and available_fields is not empty %}\n      <form {{ attributes.addClass('laposta-subscribe-form') }}>\n        {% for field_tag in field_order %}\n          {% if available_fields[field_tag] is defined and field_tag in enabled_fields %}\n            {% set field = available_fields[field_tag] %}\n            <div class=\"form-item\">\n              <label for=\"{{ field_tag }}\" class=\"form-label\">\n                {{ field.name }}\n                {% if field.required %}\n                  <span class=\"form-required\">*</span>\n                {% endif %}\n              </label>\n              {% if field.data_type == 'text' or field.is_email %}\n                <input type=\"{{ field.is_email ? 'email' : 'text' }}\" id=\"{{ field_tag }}\" name=\"{{ field_tag }}\" {% if field.required %} required {% endif %} class=\"form-control\">\n              {% elseif field.data_type == 'numeric' %}\n                <input type=\"number\" id=\"{{ field_tag }}\" name=\"{{ field_tag }}\" {% if field.required %} required {% endif %} class=\"form-control\">\n              {% elseif field.data_type == 'date' %}\n                <input type=\"date\" id=\"{{ field_tag }}\" name=\"{{ field_tag }}\" {% if field.required %} required {% endif %} class=\"form-control\">\n              {% elseif field.data_type == 'select_single' %}\n                {% if field.datatype_display == 'radio' %}\n                  {% for option in field.options %}\n                    <div class=\"form-check\">\n                      <label for=\"{{ field_tag }}_{{ loop.index }}\" class=\"form-check-label\">{{ option }}</label>\n                      <input type=\"radio\" id=\"{{ field_tag }}_{{ loop.index }}\" name=\"{{ field_tag }}\" value=\"{{ option }}\" {% if field.required %} required {% endif %} class=\"form-check-input\">\n                    </div>\n                  {% endfor %}\n                {% else %}\n                  <select id=\"{{ field_tag }}\" name=\"{{ field_tag }}\" {% if field.required %} required {% endif %} class=\"form-select\">\n                    <option value=\"\">{{ 'Select'|t }}</option>\n                    {% for option in field.options %}\n                      <option value=\"{{ option }}\">{{ option }}</option>\n                    {% endfor %}\n                  </select>\n                {% endif %}\n            {% elseif field.data_type == 'select_multiple' %}\n              <label for=\"{{ field_tag }}\" class=\"form-label\">\n                {{ field.name }}\n                {% if field.required %}\n                  <span class=\"form-required\">*</span>\n                {% endif %}\n              </label>\n              <div id=\"{{ field_tag }}\" class=\"form-checkbox-group\" {% if field.required %} required {% endif %}>\n                {% for option in field.options %}\n                  <div class=\"form-check\">\n                    <input class=\"form-check-input\" type=\"checkbox\" id=\"{{ field_tag }}-{{ loop.index }}\" name=\"{{ field_tag }}[]\" value=\"{{ option }}\">\n                    <label class=\"form-check-label\" for=\"{{ field_tag }}-{{ loop.index }}\">\n                      {{ option }}\n                    </label>\n                  </div>\n                {% endfor %}\n              </div>\n            {% endif %}\n            </div>\n          {% endif %}\n        {% endfor %}\n        {% if honeypot_enabled %}\n          <div class=\"form-item\" style=\"display:none;\">\n            <input type=\"text\" id=\"{{ honeypot_element_name }}\" name=\"{{ honeypot_element_name }}\" value=\"\">\n          </div>\n          <input type=\"hidden\" name=\"honeypot_time\" value=\"{{ 'now'|date('U') }}\">\n        {% endif %}\n        <div class=\"form-actions mb-3\">\n          <div class=\"throbber-wrapper\"></div>\n          <input type=\"submit\" value=\"{{ submit_button_text }}\" class=\"btn btn-primary\">\n        </div>\n        {% if privacy_policy_text %}\n          <div class=\"laposta-subscribe-privacy-policy\">\n            {{ privacy_policy_text }}\n          </div>\n        {% endif %}\n      </form>\n      <div class=\"message-wrapper\">\n        <div class=\"message message--success\"></div>\n        <div class=\"message message--error\"></div>\n      </div>\n    {% else %}\n      <p>{{ 'No fields are enabled for this form.'|t }}</p>\n    {% endif %}\n    <div id=\"subscription-message\"></div>\n  </div>\n</div>\n", "metadata": {"source": "repos/laposta_subscribe/templates/block--laposta-subscribe-block.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DatabaseListener\nSource file: <source_file>\nFile name hint: DatabaseListener.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\EventListener;\n\nuse Drupal\\Core\\Database\\Event\\StatementExecutionEndEvent;\nuse Drupal\\webprofiler\\DataCollector\\DatabaseDataCollector;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * DatabaseListener collects data for the current request.\n */\nclass DatabaseListener implements EventSubscriberInterface {\n\n  /**\n   * DatabaseListener constructor.\n   */\n  public function __construct(\n    private readonly DatabaseDataCollector $collector,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      StatementExecutionEndEvent::class => 'onStatementExecutionEnd',\n    ];\n  }\n\n  /**\n   * Collects data for the current request.\n   */\n  public function onStatementExecutionEnd(StatementExecutionEndEvent $event): void {\n    $this->collector->addStatement($event);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\EventListener;\n\nuse Drupal\\Core\\Database\\Event\\StatementExecutionEndEvent;\nuse Drupal\\webprofiler\\DataCollector\\DatabaseDataCollector;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * DatabaseListener collects data for the current request.\n */\nclass DatabaseListener implements EventSubscriberInterface {\n\n  /**\n   * DatabaseListener constructor.\n   */\n  public function __construct(\n    private readonly DatabaseDataCollector $collector,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      StatementExecutionEndEvent::class => 'onStatementExecutionEnd',\n    ];\n  }\n\n  /**\n   * Collects data for the current request.\n   */\n  public function onStatementExecutionEnd(StatementExecutionEndEvent $event): void {\n    $this->collector->addStatement($event);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/EventListener/DatabaseListener.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatabaseListener", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class EntityInsert in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\n\n/**\n * Event type for entity insert events.\n *\n * Triggers when a new entity is created and saved to the database.\n * This event fires after the entity has been successfully inserted.\n */\n#[FlowDropEventType(\n  id: \"entity.insert\",\n  label: new TranslatableMarkup(\"Entity Insert\"),\n  description: new TranslatableMarkup(\"Triggered when a new entity is created\"),\n  category: \"entity\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [],\n)]\nclass EntityInsert extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for entity insert events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add insert-specific data.\n    $data[\"is_new\"] = TRUE;\n    $data[\"operation\"] = \"insert\";\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    $baseSchema = parent::getParameterSchema();\n\n    // Entity insert doesn't need additional configuration beyond base.\n    return $baseSchema;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/EntityInsert.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityInsert", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: layout_discovery.module\nSource file: <source_file>\nFile name hint: layout_discovery.module\nCurrent implementation:\n<?php\n\n/**\n * @file\n */\n\nuse Drupal\\layout_discovery\\Hook\\LayoutDiscoveryThemeHooks;\n\n/**\n * Prepares variables for layout templates.\n *\n * @param array &$variables\n *   An associative array containing:\n *   - content: An associative array containing the properties of the element.\n *     Properties used: #settings, #layout, #in_preview.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Initial\n *   template_preprocess functions are registered directly in hook_theme().\n *\n * @see https://www.drupal.org/node/3504125\n */\nfunction template_preprocess_layout(&$variables): void {\n  @trigger_error(__FUNCTION__ . '() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Initial template_preprocess functions are registered directly in hook_theme(). See https://www.drupal.org/node/3504125', E_USER_DEPRECATED);\n  \\Drupal::service(LayoutDiscoveryThemeHooks::class)->preprocessLayout($variables);\n}", "output": "<?php\n\n/**\n * @file\n */\n\nuse Drupal\\layout_discovery\\Hook\\LayoutDiscoveryThemeHooks;\n\n/**\n * Prepares variables for layout templates.\n *\n * @param array &$variables\n *   An associative array containing:\n *   - content: An associative array containing the properties of the element.\n *     Properties used: #settings, #layout, #in_preview.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Initial\n *   template_preprocess functions are registered directly in hook_theme().\n *\n * @see https://www.drupal.org/node/3504125\n */\nfunction template_preprocess_layout(&$variables): void {\n  @trigger_error(__FUNCTION__ . '() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Initial template_preprocess functions are registered directly in hook_theme(). See https://www.drupal.org/node/3504125', E_USER_DEPRECATED);\n  \\Drupal::service(LayoutDiscoveryThemeHooks::class)->preprocessLayout($variables);\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_discovery/layout_discovery.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutDiscovery", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nslots:\n  content: 'A simple alert. Check it out!'\n  debug: 'I am a debug code. $array = [];'\nprops:\n  open: true\n  closable: true\nlibrary_wrapper: >\n  <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css\" />\n  <script type=\"module\" src=\"https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js\"></script>\n  {{ _story }}\n", "metadata": {"source": "repos/display_builder/components/shoelace/alert/stories/alert.default.story.yml", "type": "yaml_reference", "topic": "alert.default.story"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the configuration files of the book module.\n\nbook.settings:\n  type: config_object\n  label: 'Book settings'\n  constraints:\n    FullyValidatable: ~\n  mapping:\n    allowed_types:\n      type: sequence\n      label: 'Allowed content types'\n      sequence:\n        type: mapping\n        mapping:\n          content_type:\n            type: string\n            label: 'Content type machine name'\n            constraints:\n              EntityBundleExists: node\n          child_type:\n            type: string\n            label: 'Allowed child type'\n            constraints:\n              NotNull: []\n              EntityBundleExists: node\n              ExistsIn:\n                selector: '%root.allowed_types'\n                which: values\n                message: \"The child page content type <em>@child_type</em> must be one of those selected as an allowed book outline types.\"\n    book_sort:\n      type: string\n      label: 'Sort order'\n      constraints:\n        Choice:\n          - weight\n          - title\n    truncate_label:\n      type: boolean\n      label: 'Truncate book label'\n    use_parent_selector:\n      type: boolean\n      label: 'Use parent selector'\n\nblock.settings.book_navigation:\n  type: block_settings\n  label: 'Book navigation block'\n  mapping:\n    block_mode:\n      type: string\n      label: 'Block display mode'\n      constraints:\n        Choice:\n          - 'all pages'\n          - 'book pages'\n          - 'primary book page'\n          - 'child book pages'\n    show_top_item:\n      type: boolean\n      label: 'Show top level item'\n    use_top_level_title:\n      type: boolean\n      label: 'Use the top-level page title as block title'\n", "metadata": {"source": "repos/livre/book/config/schema/book.schema.yml", "type": "yaml_reference", "topic": "book.schema"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: PageManager.php\nTarget symbol: class PageManager\nNamespace: Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for PageManager.\n- Include required imports:\n  - Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout\n- Ensure these methods exist where relevant:\n  - loadInstances()\n  - saveInstances()", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts;\n\nuse Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout;\n\n/**\n * Handles Display Suite specific layout implementations.\n *\n * @BootstrapFiveLayoutsHandler(\"page_manager\")\n */\nclass PageManager extends BootstrapFiveLayoutsHandlerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadInstances(?array $entity_ids = NULL) {\n    $layouts = [];\n    $properties = ['variant' => 'panels_variant'];\n    if ($entity_ids) {\n      $properties['id'] = $entity_ids;\n    }\n    /** @var \\Drupal\\Core\\Entity\\EntityTypeManager $entity_type_manager */\n    $entity_type_manager = $this->container->get('entity_type.manager');\n    /** @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityInterface[] $config_entities */\n    $config_entities = $entity_type_manager->getStorage('page_variant')->loadByProperties($properties);\n    foreach ($config_entities as $entity_id => $config_entity) {\n      if (($info = $config_entity->get('variant_settings')) && isset($info['layout']) && isset($info['blocks'])) {\n        $id = $info['layout'];\n\n        // BootstrapLayout requires an associative array of \"items\" assigned to\n        // a particular region, keyed by that region. Unfortunately, Page\n        // Manager stores this value inside each block array; extract it.\n        $regions = [];\n        foreach ($info['blocks'] as $uuid => $block) {\n          $regions[$block['region']][$uuid] = $block;\n        }\n\n        // Retrieve any layout settings.\n        $settings = $info['layout_settings'] ?? [];\n\n        // Create a new BootstrapFiveLayout instance.\n        $layouts[$entity_id] = new BootstrapFiveLayout($id, $regions, $settings);\n      }\n    }\n    return $layouts;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function saveInstances(array $layouts = []) {\n    /** @var \\Drupal\\Core\\Entity\\EntityTypeManager $entity_type_manager */\n    $entity_type_manager = $this->container->get('entity_type.manager');\n\n    /** @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityInterface[] $config_entities */\n    $config_entities = $entity_type_manager->getStorage('page_variant')\n      ->loadByProperties(['variant' => 'panels_variant', 'id' => array_keys($layouts)]);\n\n    /** @var \\Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout[] $layouts */\n    foreach ($layouts as $entity_id => $layout) {\n      $config_entity = $config_entities[$entity_id];\n      $info = $config_entity->get('variant_settings');\n      $info['layout'] = $layout->getId();\n\n      // The region is stored inside the block array. To effectively change\n      // a region for a block, the variant's blocks must be iterated over and\n      // changed manually based on the associative region key provided by the\n      // BootstrapLayout instance.\n      $info['blocks'] = [];\n      foreach ($layout->getRegions() as $region => $blocks) {\n        foreach ($blocks as $uuid => $block) {\n          $block['region'] = $region;\n          $info['blocks'][$uuid] = $block;\n        }\n      }\n\n      $info['layout_settings'] = $layout->getSettings();\n      $config_entity->set('variant_settings', $info)->save();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/Plugin/BootstrapFiveLayouts/PageManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PageManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "enforced_configs:\n  'config_enforce:registry:d2_devel':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: /admin/config/development/config_enforce/enforced_configs\n    hash: intentionally_invalid\n  'core:entity_form_display:node:page:default':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: /admin/structure/types/manage/page/form-display\n    hash: pB3PeJwomuRetuAV22YDXLlvgJd0YGZShfpvBneRunQ\n  'core:entity_view_display:node:page:default':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: /admin/structure/types/manage/page/display\n    hash: CwNAY0-shl4F_EcAyLxB9jQJuCQY-hQTtSG0DyQaFEs\n  'field:field:node:page:body':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: '/admin/structure/types/manage/page/fields/node.page.body?_wrapper_format=drupal_modal'\n    hash: CtbqGJsDVWg-ZDIxNpSSvRmP3jlk3_oYdzcGB-8ksoQ\n  'field:storage:node:body':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: '/admin/structure/types/manage/page/fields/node.page.body?_wrapper_format=drupal_modal'\n    hash: vibla2KItroBDAbk44NhLAIMkvLSwyDCINt_6fi43Do\n  'filter:format:d2':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: /admin/config/content/formats/manage/d2\n    hash: xTyw_vj6ah2MGiWeO_1n1jrqn6wl4z4TXBghPGEcaKY\n  'node:type:page':\n    config_directory: config/install\n    enforcement_level: 20\n    hash: dgd881VCKHJhNjp9E7lTbfbr8GhZEamPFjYLSmI29AU\n  'system:site':\n    config_directory: config/optional\n    enforcement_level: 20\n    config_form_uri: /admin/config/system/site-information\n    hash: pOdqixosUhXh3m-BgcQ_-Wexy64FSP3KXCo5qGCDLUs\n  'user:role:administrator':\n    config_directory: config/install\n    enforcement_level: 20\n    config_form_uri: /admin/people/roles/add\n    hash: FSrk2jZ3NxDELR9VLvJ4-85OuyNgmSnE-eujn4I3e00\n", "metadata": {"source": "repos/d2/.local-dev/web/modules/custom/d2_devel/config/install/config_enforce.registry.d2_devel.yml", "type": "yaml_reference", "topic": "config enforce.registry.d2 devel"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: TwoColumnLayout.php\nTarget symbol: class TwoColumnLayout\nNamespace: Drupal\\layout_builder\\Plugin\\Layout\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TwoColumnLayout.\n- Ensure these methods exist where relevant:\n  - getDefaultWidth()\n  - getWidthOptions()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\layout_builder\\Plugin\\Layout;\n\n/**\n * Configurable two column layout plugin class.\n *\n * @internal\n *   Plugin classes are internal.\n */\nclass TwoColumnLayout extends MultiWidthLayoutBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getWidthOptions() {\n    return [\n      '50-50' => '50%/50%',\n      '33-67' => '33%/67%',\n      '67-33' => '67%/33%',\n      '25-75' => '25%/75%',\n      '75-25' => '75%/25%',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getDefaultWidth() {\n    return '50-50';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Plugin/Layout/TwoColumnLayout.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TwoColumnLayout", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: d7_shortcut\nlabel: Shortcut links\nmigration_tags:\n  - Drupal 7\n  - Content\nsource:\n  plugin: d7_shortcut\n  constants:\n    uri_scheme: 'internal:/'\nprocess:\n  shortcut_set:\n    plugin: migration_lookup\n    migration: d7_shortcut_set\n    source: menu_name\n  title: link_title\n  weight: weight\n  link:\n    plugin: concat\n    source:\n      - 'constants/uri_scheme'\n      - link_path\ndestination:\n  plugin: entity:shortcut\nmigration_dependencies:\n  required:\n    - d7_shortcut_set\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/migrations/d7_shortcut.yml", "type": "yaml_reference", "topic": "d7 shortcut"}}
{"instruction": "Show me the implementation of the class WebprofilerRequestMatcher in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\RequestMatcher;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\ImmutableConfig;\nuse Drupal\\Core\\Path\\PathMatcherInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\RequestMatcherInterface;\n\n/**\n * Exclude some path to be profiled.\n */\nclass WebprofilerRequestMatcher implements RequestMatcherInterface {\n\n  /**\n   * An immutable config object.\n   *\n   * @var \\Drupal\\Core\\Config\\ImmutableConfig\n   */\n  private ImmutableConfig $config;\n\n  /**\n   * The patterns to exclude.\n   *\n   * @var string\n   */\n  private string $patterns;\n\n  /**\n   * WebprofilerRequestMatcher constructor.\n   *\n   * @param \\Drupal\\Core\\Path\\PathMatcherInterface $pathMatcher\n   *   The path matcher service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config\n   *   The config factory service.\n   * @param string $configuration\n   *   The configuration name that contains the exclude paths.\n   */\n  public function __construct(\n    protected readonly PathMatcherInterface $pathMatcher,\n    ConfigFactoryInterface $config,\n    string $configuration,\n  ) {\n    $this->config = $config->get('webprofiler.settings');\n\n    $patterns = $this->config->get($configuration);\n\n    // Never add Webprofiler to phpinfo page.\n    $patterns .= \"\\r\\n/admin/reports/status/php\";\n\n    // Never add Webprofiler to uninstall confirm page.\n    $patterns .= \"\\r\\n/admin/modules/uninstall/*\";\n\n    $this->patterns = $patterns;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function matches(Request $request): bool {\n    $path = $request->getPathInfo();\n\n    return !$this->pathMatcher->matchPath($path, $this->patterns);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/RequestMatcher/WebprofilerRequestMatcher.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WebprofilerRequestMatcher", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "flowdrop_pipeline.flowdrop_pipeline_type.*:\n  type: config_entity\n  label: 'FlowDrop Pipeline type config'\n  mapping:\n    id:\n      type: string\n      label: 'ID'\n    label:\n      type: label\n      label: 'Label'\n    uuid:\n      type: string\n    description:\n      type: string\n      label: 'Description'\n    default_max_concurrent_jobs:\n      type: integer\n      label: 'Default Max Concurrent Jobs'\n    default_job_priority_strategy:\n      type: string\n      label: 'Default Job Priority Strategy'\n    default_retry_strategy:\n      type: string\n      label: 'Default Retry Strategy'\n    execution_timeout:\n      type: integer\n      label: 'Execution Timeout'\n    memory_limit:\n      type: integer\n      label: 'Memory Limit'\n    allowed_workflow_types:\n      type: sequence\n      label: 'Allowed Workflow Types'\n      sequence:\n        type: string\n        label: 'Workflow Type'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_pipeline/config/schema/flowdrop_pipeline.entity_type.schema.yml", "type": "yaml_reference", "topic": "flowdrop pipeline.entity type.schema"}}
{"instruction": "Show me the implementation of the class QueueDeleteCommand in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Drush\\Commands;\n\nuse Composer\\Console\\Input\\InputArgument;\nuse Drupal\\Core\\Queue\\QueueFactory;\nuse Drush\\Commands\\AutowireTrait;\nuse Symfony\\Component\\Console\\Attribute\\AsCommand;\nuse Symfony\\Component\\Console\\Command\\Command;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\n/**\n * {@selfdoc}\n */\n#[AsCommand(\n  name: 'qm:queue:delete',\n  description: 'Deletes a queue and every item in the queue.',\n)]\nfinal class QueueDeleteCommand extends Command {\n\n  use AutowireTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    private readonly QueueFactory $queueFactory,\n  ) {\n    parent::__construct();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function configure(): void {\n    $this->addArgument(\n      name: 'queue',\n      mode: InputArgument::REQUIRED,\n      description: 'The name of the queue to delete.'\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function execute(InputInterface $input, OutputInterface $output): int {\n    $queue_name = $input->getArgument('queue');\n    \\assert(\\is_string($queue_name));\n    $this->queueFactory->get($queue_name)->deleteQueue();\n    $output->writeln(\\sprintf('All items in \"%s\" queue deleted.', $queue_name));\n    return self::SUCCESS;\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/src/Drush/Commands/QueueDeleteCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "QueueDeleteCommand", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LightgalleryPlugin in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a LightGallery plugin attribute object.\n *\n * Plugin Namespace: Plugin\\Lightgallery.\n *\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginManager\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginBase\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass LightgalleryPlugin extends Plugin {\n\n  /**\n   * Constructs a LightgalleryPlugin attribute.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $label\n   *   The human-readable name of the plugin.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|string $description\n   *   A brief description of the plugin.\n   * @param int $weight\n   *   The weight of the plugin (for ordering in UI).\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $label = NULL,\n    public readonly TranslatableMarkup|string $description = '',\n    public readonly int $weight = 0,\n    public readonly ?string $deriver = NULL,\n  ) {}\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/Attribute/LightgalleryPlugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryPlugin", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ConfigAnalysisService.php\nTarget symbol: class ConfigAnalysisService\nNamespace: Drupal\\mcp_tools\\Service\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ConfigAnalysisService.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Config\\StorageInterface\n  - Drupal\\Core\\Config\\StorageComparer\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getConfig()\n  - getConfigStatus()\n  - getOverrides()\n  - listConfig()\n  - sanitizeConfigData()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools\\Service;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\StorageInterface;\nuse Drupal\\Core\\Config\\StorageComparer;\n\n/**\n * Service for analyzing configuration.\n */\nclass ConfigAnalysisService {\n\n  public function __construct(\n    protected ConfigFactoryInterface $configFactory,\n    protected StorageInterface $activeStorage,\n    protected StorageInterface $syncStorage,\n  ) {}\n\n  /**\n   * Get configuration sync status.\n   *\n   * @return array\n   *   Configuration sync status data.\n   */\n  public function getConfigStatus(): array {\n    try {\n      $storageComparer = new StorageComparer(\n        $this->syncStorage,\n        $this->activeStorage\n      );\n\n      $hasChanges = $storageComparer->createChangelist()->hasChanges();\n      $changelist = [];\n\n      if ($hasChanges) {\n        foreach ($storageComparer->getAllCollectionNames() as $collection) {\n          foreach (['create', 'update', 'delete', 'rename'] as $op) {\n            $changes = $storageComparer->getChangelist($op, $collection);\n            if (!empty($changes)) {\n              foreach ($changes as $name) {\n                $changelist[] = [\n                  'name' => $name,\n                  'operation' => $op,\n                  'collection' => $collection,\n                ];\n              }\n            }\n          }\n        }\n      }\n\n      return [\n        'has_changes' => $hasChanges,\n        'total_changes' => count($changelist),\n        'changes' => $changelist,\n        'sync_directory_exists' => !empty($this->syncStorage->listAll()),\n      ];\n    }\n    catch (\\Exception $e) {\n      return [\n        'error' => 'Unable to compare configuration: ' . $e->getMessage(),\n        'has_changes' => FALSE,\n      ];\n    }\n  }\n\n  /**\n   * Get a specific configuration object.\n   *\n   * @param string $name\n   *   Configuration name (e.g., 'system.site').\n   *\n   * @return array\n   *   Configuration data.\n   */\n  public function getConfig(string $name): array {\n    $config = $this->configFactory->get($name);\n\n    if ($config->isNew()) {\n      return [\n        'error' => \"Configuration '$name' does not exist.\",\n      ];\n    }\n\n    $data = $config->getRawData();\n\n    // SECURITY: Avoid leaking secrets by default.\n    // Allow full output only when explicitly enabled in settings.\n    $settings = $this->configFactory->get('mcp_tools.settings');\n    $includeSensitive = (bool) ($settings->get('output.include_sensitive') ?? FALSE);\n    if (!$includeSensitive) {\n      $data = $this->sanitizeConfigData($data);\n    }\n\n    return [\n      'name' => $name,\n      'data' => $data,\n    ];\n  }\n\n  /**\n   * Redact sensitive keys from configuration arrays.\n   *\n   * @param array $data\n   *   Raw configuration data.\n   *\n   * @return array\n   *   Sanitized configuration data.\n   */\n  protected function sanitizeConfigData(array $data): array {\n    $sensitiveKeys = [\n      'password',\n      'pass',\n      'secret',\n      'token',\n      'key',\n      'credential',\n      'credentials',\n      'api_key',\n      'apikey',\n      'client_secret',\n      'private',\n    ];\n\n    $sanitized = $data;\n    array_walk_recursive($sanitized, function (&$value, $key) use ($sensitiveKeys) {\n      foreach ($sensitiveKeys as $sensitiveKey) {\n        if (stripos((string) $key, $sensitiveKey) !== FALSE) {\n          $value = '[REDACTED]';\n          return;\n        }\n      }\n    });\n\n    return $sanitized;\n  }\n\n  /**\n   * List all configuration names.\n   *\n   * @param string|null $prefix\n   *   Optional prefix filter (e.g., 'system.' or 'node.type.').\n   *\n   * @return array\n   *   List of configuration names.\n   */\n  public function listConfig(?string $prefix = NULL): array {\n    $names = $this->activeStorage->listAll($prefix ?? '');\n\n    return [\n      'prefix' => $prefix,\n      'total' => count($names),\n      'names' => $names,\n    ];\n  }\n\n  /**\n   * Get configuration overrides.\n   *\n   * @return array\n   *   List of overridden configuration.\n   */\n  public function getOverrides(): array {\n    $overrides = [];\n\n    // Check common configuration that might be overridden.\n    $configsToCheck = [\n      'system.site',\n      'system.performance',\n      'system.logging',\n      'system.mail',\n    ];\n\n    foreach ($configsToCheck as $name) {\n      $config = $this->configFactory->get($name);\n      if ($config->hasOverrides()) {\n        $overrides[] = [\n          'name' => $name,\n          'has_overrides' => TRUE,\n        ];\n      }\n    }\n\n    return [\n      'total_checked' => count($configsToCheck),\n      'overridden_count' => count($overrides),\n      'overridden' => $overrides,\n      'note' => 'Only common configurations are checked. Use $settings or $config overrides in settings.php.',\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/mcp_tools/src/Service/ConfigAnalysisService.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigAnalysisService", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ImageGalleryFormatter.php\nTarget symbol: class ImageGalleryFormatter\nNamespace: Drupal\\slider_gallery\\Plugin\\Field\\FieldFormatter\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ImageGalleryFormatter.\n- Include required imports:\n  - Drupal\\Core\\Field\\FieldItemListInterface\n  - Drupal\\Core\\Field\\FormatterBase\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\file\\FileInterface\n  - Drupal\\image\\Entity\\ImageStyle\n  - Drupal\\media\\Entity\\Media\n  - Drupal\\file\\Entity\\File\n- Ensure these methods exist where relevant:\n  - defaultSettings()\n  - settingsForm()\n  - viewElements()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\slider_gallery\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Field\\FormatterBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\file\\FileInterface;\nuse Drupal\\image\\Entity\\ImageStyle;\nuse Drupal\\media\\Entity\\Media;\nuse Drupal\\file\\Entity\\File;\n\n/**\n * Plugin implementation of the 'image_gallery_formatter'.\n *\n * @FieldFormatter(\n *   id = \"image_gallery_formatter\",\n *   label = @Translation(\"Galer\u00eda de im\u00e1genes (Fancybox)\"),\n *   field_types = {\n *     \"image\",\n *     \"entity_reference\"\n *   }\n * )\n */\nclass ImageGalleryFormatter extends FormatterBase\n{\n\n  public static function defaultSettings(): array\n  {\n    return array_merge(parent::defaultSettings(), [\n      'max_images' => 5,\n      'image_style' => '',\n    ]);\n  }\n\n  public function settingsForm(array $form, FormStateInterface $form_state): array\n  {\n    $elements = parent::settingsForm($form, $form_state);\n\n    $styles = ImageStyle::loadMultiple();\n    $options = ['' => $this->t('- Sin estilo -')];\n    foreach ($styles as $id => $style) {\n      $options[$id] = $style->label();\n    }\n\n    $elements['max_images'] = [\n      '#type' => 'number',\n      '#title' => $this->t('M\u00e1ximo de im\u00e1genes visibles'),\n      '#default_value' => $this->getSetting('max_images'),\n      '#min' => 1,\n    ];\n\n    $elements['image_style'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Estilo de imagen'),\n      '#options' => $options,\n      '#default_value' => $this->getSetting('image_style'),\n    ];\n\n    return $elements;\n  }\n\n  public function viewElements(FieldItemListInterface $items, $langcode): array\n  {\n    $max = (int)$this->getSetting('max_images');\n    $style = $this->getSetting('image_style');\n    $gallery_id = 'gallery-' . uniqid();\n\n    $images = [];\n    $hidden = [];\n    $index = 0;\n\n    foreach ($items as $item) {\n      $file = NULL;\n      $alt = '';\n      $title = '';\n\n      if ($item->entity instanceof FileInterface) {\n        $file = $item->entity;\n        $alt = $item->alt ?? '';\n        $title = $item->title ?? '';\n      } elseif ($item->entity instanceof Media && $item->entity->bundle() === 'image') {\n        $media_image = $item->entity->get('field_media_image')->first();\n        if ($media_image) {\n          $file = File::load($media_image->target_id);\n          $alt = $media_image->alt;\n          $title = $media_image->title;\n        }\n      }\n\n      if (!$file) {\n        continue;\n      }\n\n      $url = $style && ImageStyle::load($style)\n        ? ImageStyle::load($style)->buildUrl($file->getFileUri())\n        : \\Drupal::service('file_url_generator')->generateAbsoluteString($file->getFileUri());\n\n      $data = [\n        'url' => $url,\n        'alt' => $alt,\n        'title' => $title,\n        'gallery_id' => $gallery_id,\n      ];\n\n      if ($index < $max) {\n        $images[] = $data;\n      } else {\n        $hidden[] = $data;\n      }\n\n      $index++;\n    }\n\n    return [[\n      '#theme' => 'image_gallery',\n      '#images' => $images,\n      '#hidden_images' => $hidden,\n      '#gallery_id' => $gallery_id,\n      '#attached' => [\n        'library' => [\n          'slider_gallery/fancybox',\n        ],\n      ],\n    ]];\n  }\n\n}\n", "metadata": {"source": "repos/slider_gallery/src/Plugin/Field/FieldFormatter/ImageGalleryFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageGalleryFormatter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: LightgalleryPlugin\nSource file: <source_file>\nFile name hint: LightgalleryPlugin.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\lightgallery_formatter\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a LightGallery plugin attribute object.\n *\n * Plugin Namespace: Plugin\\Lightgallery.\n *\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginManager\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginBase\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass LightgalleryPlugin extends Plugin {\n\n  /**\n   * Constructs a LightgalleryPlugin attribute.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $label\n   *   The human-readable name of the plugin.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|string $description\n   *   A brief description of the plugin.\n   * @param int $weight\n   *   The weight of the plugin (for ordering in UI).\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   */\n  function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $label = NULL,\n    public readonly TranslatableMarkup|string $description = '',\n    public readonly int $weight = 0,\n    public readonly ?string $deriver = NULL,\n  ) {}\n\n}", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a LightGallery plugin attribute object.\n *\n * Plugin Namespace: Plugin\\Lightgallery.\n *\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginManager\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginInterface\n * @see \\Drupal\\lightgallery_formatter\\LightgalleryPluginBase\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass LightgalleryPlugin extends Plugin {\n\n  /**\n   * Constructs a LightgalleryPlugin attribute.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $label\n   *   The human-readable name of the plugin.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|string $description\n   *   A brief description of the plugin.\n   * @param int $weight\n   *   The weight of the plugin (for ordering in UI).\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly ?TranslatableMarkup $label = NULL,\n    public readonly TranslatableMarkup|string $description = '',\n    public readonly int $weight = 0,\n    public readonly ?string $deriver = NULL,\n  ) {}\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/Attribute/LightgalleryPlugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryPlugin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% macro set_handler(controller, route, method) %}\n  {% if controller.class is defined -%}\n    {%- if method|default(false) %}<span\n      class=\"sf-toolbar-status sf-toolbar-redirection-method\">{{ method }}</span>{% endif -%}\n    {%- set link = controller.file|file_link(controller.line) %}\n    {%- if link %}<a href=\"{{ link }}\" title=\"{{ controller.class }}\">{% else %}<span title=\"{{ controller.class }}\">{% endif %}\n\n    {%- if route|default(false) -%}\n      @{{ route }}\n    {%- else -%}\n      {{- controller.class|abbr_class|striptags -}}\n      {{- controller.method ? ' :: ' ~ controller.method -}}\n    {%- endif -%}\n\n    {%- if link %}</a>{% else %}</span>{% endif %}\n  {%- else -%}\n    <span>{{ route|default(controller) }}</span>\n  {%- endif %}\n{% endmacro %}\n\n{% block toolbar %}\n\n  {% import _self as helper %}\n  {% set request_handler %}\n    {{ helper.set_handler(collector.controller) }}\n  {% endset %}\n\n  {% if collector.redirect %}\n    {% set redirect_handler %}\n      {{ helper.set_handler(collector.redirect.controller, collector.redirect.route, 'GET' != collector.redirect.method ? collector.redirect.method) }}\n    {% endset %}\n  {% endif %}\n\n  {% if collector.forwardtoken %}\n    {% set forward_profile = profile.childByToken(collector.forwardtoken) %}\n    {% set forward_handler %}\n      {{ helper.set_handler(forward_profile ? forward_profile.collector('request').controller : 'n/a') }}\n    {% endset %}\n  {% endif %}\n\n  {% set request_status_code_color = (collector.statuscode >= 400) ? 'red' : (collector.statuscode >= 300) ? 'yellow' : 'green' %}\n\n  {% set icon %}\n    <span class=\"sf-toolbar-status sf-toolbar-status-{{ request_status_code_color }}\">{{ collector.statuscode }}</span>\n    {% if collector.route %}\n      {% if collector.redirect %}{{ include('@webprofiler/Icon/redirect.svg') }}{% endif %}\n      {% if collector.forwardtoken %}{{ include('@webprofiler/Icon/forward.svg') }}{% endif %}\n      <span class=\"sf-toolbar-label\">{{ 'GET' != collector.method ? collector.method }} @</span>\n      <span class=\"sf-toolbar-value sf-toolbar-info-piece-additional\">{{ collector.route }}</span>\n    {% endif %}\n  {% endset %}\n\n  {% set text %}\n    <div class=\"sf-toolbar-info-group\">\n      <div class=\"sf-toolbar-info-piece\">\n        <b>HTTP status</b>\n        <span>{{ collector.statuscode }} {{ collector.statustext }}</span>\n      </div>\n\n      {% if 'GET' != collector.method -%}\n        <div class=\"sf-toolbar-info-piece\">\n          <b>Method</b>\n          <span>{{ collector.method }}</span>\n        </div>\n      {%- endif %}\n\n      <div class=\"sf-toolbar-info-piece\">\n        <b>Controller</b>\n        <span>{{ request_handler }}</span>\n      </div>\n\n      <div class=\"sf-toolbar-info-piece\">\n        <b>Route name</b>\n        <span>{{ collector.route|default('n/a') }}</span>\n      </div>\n\n      <div class=\"sf-toolbar-info-piece\">\n        <b>Has session</b>\n        <span>{% if collector.sessionmetadata|length %}yes{% else %}no{% endif %}</span>\n      </div>\n    </div>\n\n    {% if redirect_handler is defined -%}\n      <div class=\"sf-toolbar-info-group\">\n        <div class=\"sf-toolbar-info-piece\">\n          <b>\n            <span\n              class=\"sf-toolbar-redirection-status sf-toolbar-status-yellow\">{{ collector.redirect.status_code }}</span>\n            Redirect from\n          </b>\n          <span>{{ redirect_handler }}(<a\n              href=\"{{ path('webprofiler.dashboard', { token: collector.redirect.token }) }}\">{{ collector.redirect.token }}</a>)</span>\n        </div>\n      </div>\n    {% endif %}\n\n    {% if forward_handler is defined %}\n      <div class=\"sf-toolbar-info-group\">\n        <div class=\"sf-toolbar-info-piece\">\n          <b>Forwarded to</b>\n          <span>{{ forward_handler }}(<a\n              href=\"{{ path('webprofiler.dashboard', { token: collector.forwardtoken }) }}\">{{ collector.forwardtoken }}</a>)</span>\n        </div>\n      </div>\n    {% endif %}\n  {% endset %}\n\n  {{ include('@webprofiler/Profiler/toolbar_item.html.twig', { link: profiler_url }) }}\n{% endblock %}\n\n{% block panel %}\n  {{ collector.panel() }}\n{% endblock %}\n", "metadata": {"source": "repos/webprofiler/templates/Collector/request.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class EnvironmentSupportValidator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\package_manager\\Validator;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\package_manager\\Event\\SandboxValidationEvent;\nuse Drupal\\Core\\Url;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Checks that the environment has support for Package Manager.\n *\n * @internal\n *   This is an internal part of Package Manager and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class EnvironmentSupportValidator implements EventSubscriberInterface {\n\n  use BaseRequirementValidatorTrait {\n    getSubscribedEvents as private getSubscribedEventsFromTrait;\n  }\n  use StringTranslationTrait;\n\n  /**\n   * The name of the environment variable to check.\n   *\n   * This environment variable, if defined, should be parseable by\n   * \\Drupal\\Core\\Url::fromUri() and link to an explanation of why Package\n   * Manager is not supported in the current environment.\n   *\n   * @var string\n   */\n  public const VARIABLE_NAME = 'DRUPAL_PACKAGE_MANAGER_NOT_SUPPORTED_HELP_URL';\n\n  /**\n   * Checks that this environment supports Package Manager.\n   */\n  public function validate(SandboxValidationEvent $event): void {\n    $message = $this->t('Package Manager is not supported by your environment.');\n\n    $help_url = getenv(static::VARIABLE_NAME);\n    if (empty($help_url)) {\n      return;\n    }\n    // If the URL is not parseable, catch the exception that Url::fromUri()\n    // would generate.\n    try {\n      $message = $this->t('<a href=\":url\">@message</a>', [\n        ':url' => Url::fromUri($help_url)->toString(),\n        '@message' => $message,\n      ]);\n    }\n    catch (\\InvalidArgumentException) {\n      // No need to do anything here. The message just won't be a link.\n    }\n    $event->addError([$message]);\n    // If Package Manager is unsupported, there's no point in doing any more\n    // validation.\n    $event->stopPropagation();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    // Set priority to run before BaseRequirementsFulfilledValidator, and even\n    // before other base requirement validators.\n    // @see \\Drupal\\package_manager\\Validator\\BaseRequirementsFulfilledValidator\n    return array_map(fn () => ['validate', BaseRequirementsFulfilledValidator::PRIORITY + 1000], static::getSubscribedEventsFromTrait());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/package_manager/src/Validator/EnvironmentSupportValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EnvironmentSupportValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FlowDropHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Routing\\RouteProviderInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\n\n/**\n * FlowDrop hooks implementation.\n */\nclass FlowDropHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Constructs a new FlowDropHooks object.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteProviderInterface $routeProvider\n   *   The route provider service.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $currentUser\n   *   The current user.\n   */\n  public function __construct(\n    protected readonly RouteProviderInterface $routeProvider,\n    protected readonly AccountProxyInterface $currentUser,\n  ) {}\n\n  /**\n   * Implements hook_flowdrop_node_processor_info_alter().\n   *\n   * @param array<string, mixed> $data\n   *   The processor info data.\n   */\n  #[Hook('flowdrop_node_processor_info_alter')]\n  public function flowdropNodeProcessorInfoAlter(array &$data): void {}\n\n  /**\n   * Implements hook_toolbar().\n   *\n   * Adds a FlowDrop item to the admin toolbar for quick access.\n   *\n   * @return array<string, mixed>\n   *   A render array for the toolbar item.\n   */\n  #[Hook('toolbar')]\n  public function toolbar(): array {\n    $items = [];\n\n    // Check if the dashboard route exists.\n    if (!$this->routeExists(\"flowdrop.dashboard\")) {\n      return $items;\n    }\n\n    $items[\"flowdrop\"] = [\n      \"#type\" => \"toolbar_item\",\n      \"#weight\" => 50,\n      \"#access\" => $this->currentUser->hasPermission('administer flowdrop'),\n      \"#cache\" => [\n        \"contexts\" => [\"user.permissions\"],\n      ],\n      \"tab\" => [\n        \"#type\" => \"link\",\n        \"#title\" => $this->t(\"FlowDrop\"),\n        \"#url\" => Url::fromRoute(\"flowdrop.dashboard\"),\n        \"#attributes\" => [\n          \"title\" => $this->t(\"FlowDrop workflow automation\"),\n          \"class\" => [\"toolbar-icon\", \"toolbar-icon-flowdrop\"],\n        ],\n      ],\n      \"#attached\" => [\n        \"library\" => [\n          \"flowdrop/toolbar\",\n        ],\n      ],\n    ];\n\n    return $items;\n  }\n\n  /**\n   * Checks if a route exists.\n   *\n   * @param string $routeName\n   *   The route name.\n   *\n   * @return bool\n   *   TRUE if the route exists, FALSE otherwise.\n   */\n  protected function routeExists(string $routeName): bool {\n    try {\n      $this->routeProvider->getRouteByName($routeName);\n      return TRUE;\n    }\n    catch (\\Exception $e) {\n      return FALSE;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/src/Hook/FlowDropHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ContextualLinksPlaceholder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\contextual\\Element;\n\nuse Drupal\\Component\\Utility\\Crypt;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Site\\Settings;\nuse Drupal\\Core\\Template\\Attribute;\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\nuse Drupal\\Core\\Render\\Element\\RenderElementBase;\nuse Drupal\\Component\\Render\\FormattableMarkup;\n\n/**\n * Provides a contextual_links_placeholder element.\n */\n#[RenderElement('contextual_links_placeholder')]\nclass ContextualLinksPlaceholder extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#pre_render' => [\n        [static::class, 'preRenderPlaceholder'],\n      ],\n      '#id' => NULL,\n    ];\n  }\n\n  /**\n   * Pre-render callback: Renders a contextual links placeholder into #markup.\n   *\n   * Renders an empty (hence invisible) placeholder div with a data-attribute\n   * that contains an identifier (\"contextual id\"), which allows the JavaScript\n   * of the drupal.contextual-links library to dynamically render contextual\n   * links.\n   *\n   * @param array $element\n   *   A structured array with #id containing a \"contextual id\".\n   *\n   * @return array\n   *   The passed-in element with a contextual link placeholder in '#markup'.\n   *\n   * @see \\Drupal\\contextual\\ContextualLinksSerializer::linksToId()\n   */\n  public static function preRenderPlaceholder(array $element) {\n    $token = Crypt::hmacBase64($element['#id'], Settings::getHashSalt() . \\Drupal::service('private_key')->get());\n    $attribute = new Attribute([\n      'data-contextual-id' => $element['#id'],\n      'data-contextual-token' => $token,\n      'data-drupal-ajax-container' => '',\n    ]);\n    $element['#markup'] = new FormattableMarkup('<div@attributes></div>', ['@attributes' => $attribute]);\n    $element['#attached']['drupalSettings']['contextual']['theme'] = \\Drupal::service('theme.manager')->getActiveTheme()->getName();\n    $cache = CacheableMetadata::createFromRenderArray($element);\n    $cache->addCacheContexts(['theme']);\n    $cache->applyTo($element);\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contextual/src/Element/ContextualLinksPlaceholder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContextualLinksPlaceholder", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: to\nSource file: <source_file>\nFile name hint: FlowDropJobTypeListBuilder.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_job;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Defines a class to build a listing of flowdrop job type entities.\n *\n * Features sortable table headers with default sorting by label alphabetically.\n * Supports pagination for large datasets.\n *\n * @see \\Drupal\\flowdrop_job\\Entity\\FlowDropJobType\n */\nfinal class FlowDropJobTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The number of entities to list per page.\n   *\n   * @var int\n   */\n  protected $limit = 50;\n\n  /**\n   * The current sort field.\n   *\n   * @var string\n   */\n  protected string $sortField = \"label\";\n\n  /**\n   * The current sort direction.\n   *\n   * @var string\n   */\n  protected string $sortDirection = \"asc\";\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<\\Drupal\\Core\\Entity\\EntityInterface>\n   *   An array of entities sorted according to the current tablesort.\n   */\n  public function load(): array {\n    $entities = parent::load();\n\n    // Get sort parameters from request.\n    $request = \\Drupal::request();\n    $order = $request->query->get(\"order\");\n    $sort = $request->query->get(\"sort\", \"asc\");\n\n    // Determine the field to sort by based on header label.\n    if ($order !== NULL) {\n      $fieldMap = [\n        \"Label\" => \"label\",\n      ];\n      if (isset($fieldMap[$order])) {\n        $this->sortField = $fieldMap[$order];\n        $this->sortDirection = $sort;\n      }\n    }\n\n    // Sort entities in memory.\n    usort($entities, function ($a, $b) {\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $a */\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $b */\n      $valueA = strtolower($a->label() ?? \"\");\n      $valueB = strtolower($b->label() ?? \"\");\n\n      // Compare values.\n      if ($valueA === $valueB) {\n        return 0;\n      }\n\n      $result = $valueA < $valueB ? -1 : 1;\n\n      // Reverse for descending order.\n      if ($this->sortDirection === \"desc\") {\n        $result = -$result;\n      }\n\n      return $result;\n    });\n\n    // Apply pagination.\n    return $this->getEntityListForPager($entities);\n  }\n\n  /**\n   * Gets a paginated slice of entities.\n   *\n   * @param array<\\Drupal\\Core\\Entity\\EntityInterface> $entities\n   *   All sorted entities.\n   *\n   * @return array<\\Drupal\\Core\\Entity\\EntityInterface>\n   *   Entities for the current page.\n   */\n  protected function getEntityListForPager(array $entities): array {\n    // Get current page from request.\n    $page = \\Drupal::request()->query->getInt(\"page\", 0);\n\n    // Calculate offset.\n    $offset = $page * $this->limit;\n\n    // Initialize pager.\n    \\Drupal::service(\"pager.manager\")->createPager(count($entities), $this->limit);\n\n    // Return slice of entities for current page.\n    return array_slice($entities, $offset, $this->limit);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<string, array<string, mixed>>\n   *   An array of sortable header definitions.", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_job;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Defines a class to build a listing of flowdrop job type entities.\n *\n * Features sortable table headers with default sorting by label alphabetically.\n * Supports pagination for large datasets.\n *\n * @see \\Drupal\\flowdrop_job\\Entity\\FlowDropJobType\n */\nfinal class FlowDropJobTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The number of entities to list per page.\n   *\n   * @var int\n   */\n  protected $limit = 50;\n\n  /**\n   * The current sort field.\n   *\n   * @var string\n   */\n  protected string $sortField = \"label\";\n\n  /**\n   * The current sort direction.\n   *\n   * @var string\n   */\n  protected string $sortDirection = \"asc\";\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<\\Drupal\\Core\\Entity\\EntityInterface>\n   *   An array of entities sorted according to the current tablesort.\n   */\n  public function load(): array {\n    $entities = parent::load();\n\n    // Get sort parameters from request.\n    $request = \\Drupal::request();\n    $order = $request->query->get(\"order\");\n    $sort = $request->query->get(\"sort\", \"asc\");\n\n    // Determine the field to sort by based on header label.\n    if ($order !== NULL) {\n      $fieldMap = [\n        \"Label\" => \"label\",\n      ];\n      if (isset($fieldMap[$order])) {\n        $this->sortField = $fieldMap[$order];\n        $this->sortDirection = $sort;\n      }\n    }\n\n    // Sort entities in memory.\n    usort($entities, function ($a, $b) {\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $a */\n      /** @var \\Drupal\\Core\\Entity\\EntityInterface $b */\n      $valueA = strtolower($a->label() ?? \"\");\n      $valueB = strtolower($b->label() ?? \"\");\n\n      // Compare values.\n      if ($valueA === $valueB) {\n        return 0;\n      }\n\n      $result = $valueA < $valueB ? -1 : 1;\n\n      // Reverse for descending order.\n      if ($this->sortDirection === \"desc\") {\n        $result = -$result;\n      }\n\n      return $result;\n    });\n\n    // Apply pagination.\n    return $this->getEntityListForPager($entities);\n  }\n\n  /**\n   * Gets a paginated slice of entities.\n   *\n   * @param array<\\Drupal\\Core\\Entity\\EntityInterface> $entities\n   *   All sorted entities.\n   *\n   * @return array<\\Drupal\\Core\\Entity\\EntityInterface>\n   *   Entities for the current page.\n   */\n  protected function getEntityListForPager(array $entities): array {\n    // Get current page from request.\n    $page = \\Drupal::request()->query->getInt(\"page\", 0);\n\n    // Calculate offset.\n    $offset = $page * $this->limit;\n\n    // Initialize pager.\n    \\Drupal::service(\"pager.manager\")->createPager(count($entities), $this->limit);\n\n    // Return slice of entities for current page.\n    return array_slice($entities, $offset, $this->limit);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<string, array<string, mixed>>\n   *   An array of sortable header definitions.\n   */\n  public function buildHeader(): array {\n    $header = [\n      \"label\" => [\n        \"data\" => $this->t(\"Label\"),\n        \"field\" => \"label\",\n        \"specifier\" => \"label\",\n        \"sort\" => \"asc\",\n      ],\n    ];\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity): array {\n    $row[\"label\"] = $entity->label();\n    return $row + parent::buildRow($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return array<string, mixed>\n   *   The render array for the list.\n   */\n  public function render(): array {\n    $build = parent::render();\n\n    // Add tablesort to the table.\n    $build[\"table\"][\"#header\"] = $this->buildHeader();\n    $build[\"table\"][\"#attributes\"][\"class\"][] = \"sortable-table\";\n    $build[\"table\"][\"#empty\"] = $this->t(\n      'No flowdrop job types available. <a href=\":link\">Add flowdrop job type</a>.',\n      [\":link\" => Url::fromRoute(\"flowdrop.structure.job_type.add\")->toString()],\n    );\n\n    // Add pager for pagination.\n    $build[\"pager\"] = [\n      \"#type\" => \"pager\",\n    ];\n\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_job/src/FlowDropJobTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FlowDropJobTypeListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - core.entity_view_mode.node.card_common\n    - field.field.node.recipe.field_cooking_time\n    - field.field.node.recipe.field_difficulty\n    - field.field.node.recipe.field_ingredients\n    - field.field.node.recipe.field_media_image\n    - field.field.node.recipe.field_number_of_servings\n    - field.field.node.recipe.field_preparation_time\n    - field.field.node.recipe.field_recipe_category\n    - field.field.node.recipe.field_recipe_instruction\n    - field.field.node.recipe.field_summary\n    - field.field.node.recipe.field_tags\n    - field.field.node.recipe.layout_builder__layout\n    - node.type.recipe\n  module:\n    - user\nid: node.recipe.card_common\ntargetEntityType: node\nbundle: recipe\nmode: card_common\ncontent:\n  field_media_image:\n    type: entity_reference_entity_view\n    label: hidden\n    settings:\n      view_mode: responsive_3x2\n      link: false\n    third_party_settings: {  }\n    weight: 1\n    region: content\nhidden:\n  content_moderation_control: true\n  field_cooking_time: true\n  field_difficulty: true\n  field_ingredients: true\n  field_number_of_servings: true\n  field_preparation_time: true\n  field_recipe_category: true\n  field_recipe_instruction: true\n  field_summary: true\n  field_tags: true\n  langcode: true\n  layout_builder__layout: true\n  links: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_view_display.node.recipe.card_common.yml", "type": "yaml_reference", "topic": "core.entity view display.node.recipe.card common"}}
{"instruction": "Show me the implementation of the class DynamicLocalTasks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\content_moderation\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\content_moderation\\ModerationInformationInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Routing\\RouterInterface;\n\n/**\n * Generates moderation-related local tasks.\n */\nclass DynamicLocalTasks extends DeriverBase implements ContainerDeriverInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The base plugin ID.\n   *\n   * @var string\n   */\n  protected $basePluginId;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The moderation information service.\n   *\n   * @var \\Drupal\\content_moderation\\ModerationInformationInterface\n   */\n  protected $moderationInfo;\n\n  /**\n   * The router.\n   *\n   * @var \\Symfony\\Component\\Routing\\RouterInterface\n   */\n  protected $router;\n\n  /**\n   * Creates a FieldUiLocalTask object.\n   *\n   * @param string $base_plugin_id\n   *   The base plugin ID.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The translation manager.\n   * @param \\Drupal\\content_moderation\\ModerationInformationInterface $moderation_information\n   *   The moderation information service.\n   * @param \\Symfony\\Component\\Routing\\RouterInterface $router\n   *   The router.\n   */\n  public function __construct($base_plugin_id, EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation, ModerationInformationInterface $moderation_information, RouterInterface $router) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->stringTranslation = $string_translation;\n    $this->basePluginId = $base_plugin_id;\n    $this->moderationInfo = $moderation_information;\n    $this->router = $router;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $base_plugin_id,\n      $container->get('entity_type.manager'),\n      $container->get('string_translation'),\n      $container->get('content_moderation.moderation_information'),\n      $container->get('router')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $this->derivatives = [];\n\n    // Add the moderated content task if the route exists.\n    if ($this->router->getRouteCollection()->get('content_moderation.admin_moderated_content') !== NULL) {\n      $this->derivatives['content_moderation.moderated_content'] = [\n        'route_name' => 'content_moderation.admin_moderated_content',\n        'title' => $this->t('Moderated content'),\n        'parent_id' => 'system.admin_content',\n        'weight' => 1,\n      ];\n    }\n\n    // Add the latest version tab to entities.\n    $latest_version_entities = array_filter($this->entityTypeManager->getDefinitions(), function (EntityTypeInterface $type) {\n      return $this->moderationInfo->canModerateEntitiesOfEntityType($type) && $type->hasLinkTemplate('latest-version');\n    });\n\n    foreach ($latest_version_entities as $entity_type_id => $entity_type) {\n      $this->derivatives[\"$entity_type_id.latest_version_tab\"] = [\n        'route_name' => \"entity.$entity_type_id.latest_version\",\n        'title' => $this->t('Latest version'),\n        'base_route' => \"entity.$entity_type_id.canonical\",\n        'weight' => 1,\n      ] + $base_plugin_definition;\n    }\n\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_moderation/src/Plugin/Derivative/DynamicLocalTasks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DynamicLocalTasks", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nname: large_21_9\nlabel: 'Large 21:9 (1440x620)'\neffects:\n  90b69780-6eb1-4cc8-a500-88235ad52f5c:\n    uuid: 90b69780-6eb1-4cc8-a500-88235ad52f5c\n    id: image_scale_and_crop\n    weight: 1\n    data:\n      width: 1440\n      height: 620\n      anchor: center-center\n  622f10ec-5f36-427e-a54a-4c0b8a45d6ab:\n    uuid: 622f10ec-5f36-427e-a54a-4c0b8a45d6ab\n    id: image_convert_avif\n    weight: 2\n    data:\n      extension: webp\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/image.style.large_21_9.yml", "type": "yaml_reference", "topic": "image.style.large 21 9"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "htmx_sse:\n  remote: https://htmx.org/extensions/sse/\n  version: 2.2.3\n  license:\n    name: BSD Zero Clause License\n    gpl-compatible: true\n  dependencies:\n    # @see \\Drupal\\display_builder\\Hook\\LibrariesSwitcher\n    - display_builder/_htmx_sse_cdn\n\n_htmx_sse_cdn:\n  js:\n    https://cdn.jsdelivr.net/npm/htmx-ext-sse@2.2.3/dist/sse.min.js:\n      type: external\n      minified: true\n\n_htmx_sse_local:\n  js:\n    /libraries/htmx-ext-sse/node_modules/htmx-ext-sse/dist/sse.min.js:\n      minified: true\n\nshoelace:\n  remote: https://shoelace.style/\n  version: 2.20.1\n  license:\n    name: MIT\n    url: https://github.com/shoelace-style/shoelace/blob/next/LICENSE.md\n    gpl-compatible: true\n  dependencies:\n    # @see \\Drupal\\display_builder\\Hook\\LibrariesSwitcher\n    - display_builder/_shoelace_cdn\n\n# Only to be loaded as a display_builder/shoelace dependency.\n# The default value for Web users.\n_shoelace_cdn:\n  css:\n    theme:\n      https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.min.css:\n        type: external\n        minified: true\n      https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.min.css:\n        type: external\n        minified: true\n  js:\n    # https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace.min.js:\n    https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.min.js:\n      type: external\n      minified: true\n      attributes:\n        type: module\n\n# Only to be loaded as a display_builder/shoelace dependency.\n# The default value for pipeline jobs.\n_shoelace_local:\n  css:\n    theme:\n      /libraries/shoelace/node_modules/@shoelace-style/shoelace/cdn/themes/light.css:\n        {}\n      /libraries/shoelace/node_modules/@shoelace-style/shoelace/cdn/themes/dark.css:\n        {}\n  js:\n    /libraries/shoelace/node_modules/@shoelace-style/shoelace/cdn/shoelace.js:\n      attributes:\n        type: module\n\ndb_drawer:\n  css:\n    component:\n      ./assets/css/db_drawer.css: {}\n  js:\n    ./assets/js/db_drawer.js: {}\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/drupal.displace\n\nsearch:\n  css:\n    component:\n      ./assets/css/search.css: {}\n  js:\n    ./assets/js/search.js: {}\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/drupal.debounce\n    - core/once\n\nform_description:\n  js:\n    ./assets/js/form_description.js: {}\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/once\n    - display_builder/local_storage_manager\n\npreview:\n  css:\n    component:\n      ./assets/css/preview.css: {}\n  js:\n    ./assets/js/preview.js: {}\n  dependencies:\n    - core/drupal\n    - core/internal.floating-ui\n\ncontextual_menu:\n  js:\n    ./assets/js/contextual_menu.js: {}\n  dependencies:\n    - core/internal.floating-ui\n\n# Keyboard mapping behavior.\nkeyboard:\n  js:\n    ./assets/js/keyboard.js: {}\n\n# Local storage utility class.\nlocal_storage_manager:\n  js:\n    ./assets/js/localStorageManager.js: {}\n\n# Contextual forms tweaks.\nform:\n  css:\n    theme:\n      ./assets/css/form.css: {}\n\n# Viewport switcher island.\nviewport_switcher:\n  js:\n    ./assets/js/viewport_switcher.js: {}\n\nhighlight:\n  js:\n    ./assets/js/highlight.js: {}\n\nfullscreen:\n  js:\n    ./assets/js/fullscreen.js: {}\n\n# Custom fixes for CKEditor and Wysiwyg.\n_fix_wysiwyg:\n  js:\n    ./assets/js/_fix_wysiwyg.js: {}\n\n# Global fixes meant to disappear or replaced by a cleaner solution.\n_fix:\n  css:\n    theme:\n      ./assets/css/_fix.css: {}\n", "metadata": {"source": "repos/display_builder/display_builder.libraries.yml", "type": "yaml_reference", "topic": "display builder.libraries"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Captions\nslots:\n  slides:\n    - type: component\n      component: \"bootstrap_components:carousel_item\"\n      slots:\n        image:\n          theme: image\n          uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAzLjVyZW07IHRleHQtYW5jaG9yOiBtaWRkbGU7IHVzZXItc2VsZWN0OiBub25lIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IEZpcnN0IHNsaWRlIj48dGl0bGU+UGxhY2Vob2xkZXI8L3RpdGxlPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiM3NzciPjwvcmVjdD48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZmlsbD0iIzU1NSIgZHk9Ii4zZW0iPkZpcnN0IHNsaWRlPC90ZXh0Pjwvc3ZnPgo=\"\n        caption:\n          - type: html_tag\n            tag: h5\n            value: \"First slide label\"\n          - type: html_tag\n            tag: p\n            value: \"Some representative placeholder content for the first slide.\"\n    - type: component\n      component: \"bootstrap_components:carousel_item\"\n      slots:\n        image:\n          theme: image\n          uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAzLjVyZW07IHRleHQtYW5jaG9yOiBtaWRkbGU7IHVzZXItc2VsZWN0OiBub25lIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IFNlY29uZCBzbGlkZSI+PHRpdGxlPlBsYWNlaG9sZGVyPC90aXRsZT48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY2Ij48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiM0NDQiIGR5PSIuM2VtIj5TZWNvbmQgc2xpZGU8L3RleHQ+PC9zdmc+Cg==\"\n        caption:\n          - type: html_tag\n            tag: h5\n            value: \"Second slide label\"\n          - type: html_tag\n            tag: p\n            value: \"Some representative placeholder content for the second slide.\"\n    - type: component\n      component: \"bootstrap_components:carousel_item\"\n      slots:\n        image:\n          theme: image\n          uri: \"data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZm9udC1zaXplOiAzLjVyZW07IHRleHQtYW5jaG9yOiBtaWRkbGU7IHVzZXItc2VsZWN0OiBub25lIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgc2xpY2UiIGZvY3VzYWJsZT0iZmFsc2UiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUGxhY2Vob2xkZXI6IFRoaXJkIHNsaWRlIj48dGl0bGU+UGxhY2Vob2xkZXI8L3RpdGxlPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiM1NTUiPjwvcmVjdD48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZmlsbD0iIzMzMyIgZHk9Ii4zZW0iPlRoaXJkIHNsaWRlPC90ZXh0Pjwvc3ZnPgo=\"\n        caption:\n          - type: html_tag\n            tag: h5\n            value: \"Third slide label\"\n          - type: html_tag\n            tag: p\n            value: \"Some representative placeholder content for the third slide.\"\nprops:\n  with_controls: true\n  with_indicators: true\n  with_touch: true\n  interval: 0\n", "metadata": {"source": "repos/bootstrap_components/components/carousel/stories/carousel.captions.story.yml", "type": "yaml_reference", "topic": "carousel.captions.story"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: KeyUsageTrackerInterface\nSource file: <source_file>\nFile name hint: KeyUsageTrackerInterface.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\n/**\n * Tracks which encryption keys are active and which are referenced.\n */\ninterface KeyUsageTrackerInterface {\n\n  /**\n   * Returns referenced (in-use) encryption key IDs.\n   *\n   * @return array{result: \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[], cacheability: \\Drupal\\Core\\Cache\\CacheableDependencyInterface}\n   *   A set of key pair IDs (array keys), plus cacheability metadata.\n   */\n  public function getReferencedEncryptionKeyIds(): array;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\n/**\n * Tracks which encryption keys are active and which are referenced.\n */\ninterface KeyUsageTrackerInterface {\n\n  /**\n   * Returns referenced (in-use) encryption key IDs.\n   *\n   * @return array{result: \\Drupal\\easy_encryption\\Encryption\\EncryptionKeyId[], cacheability: \\Drupal\\Core\\Cache\\CacheableDependencyInterface}\n   *   A set of key pair IDs (array keys), plus cacheability metadata.\n   */\n  public function getReferencedEncryptionKeyIds(): array;\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyUsageTrackerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "KeyUsageTrackerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "enable_all_components: true\naccessible_components: []\ncontent_type_settings: {}\nmedia_browser: sdc_inline_editor_media_modal\n", "metadata": {"source": "repos/sdc_inline_editor/config/install/sdc_inline_editor.settings.yml", "type": "yaml_reference", "topic": "sdc inline editor.settings"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: FieldFile.php\nTarget symbol: class FieldFile\nNamespace: Drupal\\file\\Plugin\\migrate\\process\\d6\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for FieldFile.\n- Include required imports:\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\migrate\\MigrateLookupInterface\n  - Drupal\\migrate\\Plugin\\MigrationInterface\n  - Drupal\\migrate\\Attribute\\MigrateProcess\n  - Drupal\\migrate\\MigrateExecutableInterface\n  - Drupal\\migrate\\ProcessPluginBase\n  - Drupal\\migrate\\Row\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - transform()", "output": "<?php\n\nnamespace Drupal\\file\\Plugin\\migrate\\process\\d6;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\migrate\\MigrateLookupInterface;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Determines the settings for a Drupal 6 file field.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess('d6_field_file')]\nclass FieldFile extends ProcessPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The current migration.\n   */\n  protected MigrationInterface $migration;\n\n  /**\n   * The migrate lookup service.\n   *\n   * @var \\Drupal\\migrate\\MigrateLookupInterface\n   */\n  protected $migrateLookup;\n\n  /**\n   * Constructs a FieldFile plugin instance.\n   *\n   * @param array $configuration\n   *   The plugin configuration.\n   * @param string $plugin_id\n   *   The plugin ID.\n   * @param mixed $plugin_definition\n   *   The plugin definition.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationInterface $migration\n   *   The current migration.\n   * @param \\Drupal\\migrate\\MigrateLookupInterface $migrate_lookup\n   *   The migrate lookup service.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, MigrationInterface $migration, MigrateLookupInterface $migrate_lookup) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->migration = $migration;\n    $this->migrateLookup = $migrate_lookup;\n\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition, ?MigrationInterface $migration = NULL) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $migration,\n      $container->get('migrate.lookup')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    $options = unserialize($value['data']);\n\n    // Try to look up the ID of the migrated file. If one cannot be found, it\n    // means the file referenced by the current field item did not migrate for\n    // some reason -- file migration is notoriously brittle -- and we do NOT\n    // want to send invalid file references into the field system (it causes\n    // fatal errors), so return an empty item instead.\n    $lookup_result = $this->migrateLookup->lookup('d6_file', [$value['fid']]);\n    if ($lookup_result) {\n      return [\n        'target_id' => $lookup_result[0]['fid'],\n        'display' => $value['list'],\n        'description' => $options['description'] ?? '',\n        'alt' => $options['alt'] ?? '',\n        'title' => $options['title'] ?? '',\n      ];\n    }\n    else {\n      return [];\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/migrate/process/d6/FieldFile.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldFile", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: SEO Audit", "input": "", "output": "# SEO Audit\n\n## Introduction\n\n**SEO Audit** is a powerful Drupal module that performs automated SEO audits on any website \u2014 including local development environments \u2014 by crawling pages and analyzing crucial SEO elements. It helps site administrators identify and resolve SEO issues, ultimately improving search engine visibility.\n\n## Table of Contents\n\n* [Requirements](#requirements)\n* [Installation](#installation)\n* [Configuration](#configuration)\n* [Features](#features)\n* [Troubleshooting & FAQ](#troubleshooting--faq)\n\n## Requirements\n\n* Drupal core: ^10 || ^11\n* PHP dependencies:\n\n  * `spatie/crawler`: ^8.0\n  * `symfony/dom-crawler`: ^6.4\n  * `symfony/css-selector`: ^6.4\n  * `t1gor/robots-txt-parser`: ^0.2.5\n  * `dompdf/dompdf`: ^3.1\n* Drupal modules:\n\n  * `queue_ui`: ^3.2\n\n## Installation\n\nInstall via Drush or download the module manually:\n\n```bash\ndrush en seo_audit -y\n```\n\nPlace the module under `/modules/custom/seo_audit` if installing manually.\n\n## Configuration\n\n1. Enable the module and its dependencies:\n\n   ```bash\n   drush en seo_audit -y\n   ```\n2. Configure crawl behavior at:\n\n   * `/admin/config/search/seo-audit/settings`\n   * You can configure:\n\n     * **Crawl concurrency**: Number of simultaneous requests to send\n     * **Crawl limit**: Total number of URLs to be crawled (Use -1 for No limit.)\n     * **Crawl depth**: How deep the crawler should follow internal links from the start page\n     * Enable/disable the following checks:\n\n       * H1 tag presence\n       * Title tag presence\n       * Meta description\n       * Meta robots tag\n       * Image `alt` attributes\n       * Broken links\n       * Visual breadcrumbs\n       * JSON-LD breadcrumbs\n     * **Email notification settings**:\n\n       * Enable/disable notifications\n       * Set one or more recipient email addresses\n3. Set a high enough cron time limit (e.g., > 7200 seconds) at:\n\n   * `/admin/config/system/queue-ui/cron/seo_audit_crawl_queue`\n   * **Note:** Broken link checking consumes the most time.\n4. *(Optional)* Set up a mailer service to receive crawl completion notifications.\n\n## Features\n\n* Crawl any site via: `/admin/config/search/seo-audit/crawl`\n* Queued execution: Crawls are processed via the queue during cron runs, or manually via:\n\n  ```bash\n  drush queue:run seo_audit_crawl_queue\n  ```\n* Results dashboard:\n\n  * View crawl history at: `/admin/config/search/seo-audit/results`\n  * Users see only their own crawl results.\n* Detailed crawl view:\n\n  * `/admin/config/search/seo-audit/results/{id}`\n* Download crawl reports in:\n\n  * CSV\n  * JSON\n  * PDF\n* Customizable PDF report:\n\n  * Only includes checks that are enabled in settings.\n* Email notifications after crawl completes (if configured).\n* Supports local sites (with virtual host setup).\n* Crawls only internal URLs (ensures domain-restricted scans).\n* Respects `robots.txt` rules (skips disallowed paths).\n* Color-coded crawl output:\n\n  * **HTTP Status Codes:**\n\n    * `2xx` (Success): Green `#28a745`\n    * `3xx` (Redirect): Teal `#17a2b8`\n    * `4xx` (Client Error): Orange `#fd7e14`\n    * `5xx` (Server Error): Red `#dc3545`\n  * **Result Cells:**\n\n    * 'Found': Light Green `#cdf9cc`\n    * Others: Light Red `#f9cccc`\n\n## Troubleshooting & FAQ\n\n**Q:** The crawl does not start or completes with errors?\n**A:** Ensure your server allows outgoing HTTP requests. Firewall restrictions or misconfigured virtual hosts may block crawling.\n\n**Q:** Emails are not received after crawl completion?\n**A:** Confirm that the site has a working email system and the notification email is valid.\n\n**Q:** PDF reports are missing styles or are unreadable?\n**A:** Verify that all Dompdf dependencies are installed correctly and compatible with your server setup.\n", "metadata": {"source": "repos/seo_audit/README.md", "type": "doc_summary", "topic": "SEO Audit"}}
{"instruction": "Show me the implementation of the class CancelUser in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\Action;\n\nuse Drupal\\Core\\Action\\ActionBase;\nuse Drupal\\Core\\Action\\Attribute\\Action;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\TempStore\\PrivateTempStoreFactory;\n\n/**\n * Cancels a user account.\n */\n#[Action(\n  id: 'user_cancel_user_action',\n  label: new TranslatableMarkup('Cancel the selected user accounts'),\n  type: 'user',\n  confirm_form_route_name: 'user.multiple_cancel_confirm'\n)]\nclass CancelUser extends ActionBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The tempstore factory.\n   *\n   * @var \\Drupal\\Core\\TempStore\\PrivateTempStoreFactory\n   */\n  protected $tempStoreFactory;\n\n  /**\n   * The current user.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   */\n  protected $currentUser;\n\n  /**\n   * Constructs a CancelUser object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\TempStore\\PrivateTempStoreFactory $temp_store_factory\n   *   The tempstore factory.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $current_user\n   *   Current user.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, PrivateTempStoreFactory $temp_store_factory, AccountInterface $current_user) {\n    $this->currentUser = $current_user;\n    $this->tempStoreFactory = $temp_store_factory;\n\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function executeMultiple(array $entities) {\n    $this->tempStoreFactory->get('user_user_operations_cancel')->set($this->currentUser->id(), $entities);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute($object = NULL) {\n    $this->executeMultiple([$object]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function access($object, ?AccountInterface $account = NULL, $return_as_object = FALSE) {\n    /** @var \\Drupal\\user\\UserInterface $object */\n    return $object->access('delete', $account, $return_as_object);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/Action/CancelUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CancelUser", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class MonthDate in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a month.\n */\n#[ViewsArgument(\n  id: 'datetime_month',\n)]\nclass MonthDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'm';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/views/argument/MonthDate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MonthDate", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: EntityLinkTargetInterface.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\GeneratedUrl;\n\n/**\n * Provides an interface for generating a link target from an entity.\n */\ninterface EntityLinkTargetInterface {\n\n  /**\n   * Gets the generated URL object for a linked entity's link target.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   A linked entity.\n   *\n   * @return \\Drupal\\Core\\GeneratedUrl\n   *   The generated URL plus cacheability metadata.\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\GeneratedUrl;\n\n/**\n * Provides an interface for generating a link target from an entity.\n */\ninterface EntityLinkTargetInterface {\n\n  /**\n   * Gets the generated URL object for a linked entity's link target.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   A linked entity.\n   *\n   * @return \\Drupal\\Core\\GeneratedUrl\n   *   The generated URL plus cacheability metadata.\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/EntityLinkTargetInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityLinkTargetInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class StringLongItem in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldType;\n\nuse Drupal\\Component\\Utility\\Random;\nuse Drupal\\Core\\Field\\Attribute\\FieldType;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldStorageDefinitionInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines the 'string_long' field type.\n */\n#[FieldType(\n  id: \"string_long\",\n  label: new TranslatableMarkup(\"Long text\"),\n  description: [\n    new TranslatableMarkup(\"Uses a text area (multiple rows) for input\"),\n    new TranslatableMarkup(\"No fixed maximum length\"),\n    new TranslatableMarkup(\"May use more storage and be slower searching and sorting\"),\n    new TranslatableMarkup(\"Use for longer text without formatting\"),\n  ],\n  category: \"plain_text\",\n  weight: -5,\n  default_widget: \"string_textarea\",\n  default_formatter: \"basic_string\",\n)]\nclass StringLongItem extends StringItemBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function schema(FieldStorageDefinitionInterface $field_definition) {\n    return [\n      'columns' => [\n        'value' => [\n          'type' => $field_definition->getSetting('case_sensitive') ? 'blob' : 'text',\n          'size' => 'big',\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function generateSampleValue(FieldDefinitionInterface $field_definition) {\n    $random = new Random();\n    $values['value'] = $random->paragraphs();\n    return $values;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldType/StringLongItem.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StringLongItem", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - user\nid: who_s_online\nlabel: 'Who''s online block'\nmodule: user\ndescription: 'Shows the user names of the most recently active users, and the total number of active users.'\ntag: default\nbase_table: users_field_data\nbase_field: uid\ndisplay:\n  default:\n    id: default\n    display_title: Default\n    display_plugin: default\n    position: 0\n    display_options:\n      title: 'Who''s online'\n      fields:\n        name:\n          id: name\n          table: users_field_data\n          field: name\n          relationship: none\n          group_type: group\n          admin_label: ''\n          entity_type: user\n          entity_field: name\n          plugin_id: field\n          label: ''\n          exclude: false\n          alter:\n            alter_text: false\n            make_link: false\n            absolute: false\n            word_boundary: false\n            ellipsis: false\n            strip_tags: false\n            trim: false\n            html: false\n          element_type: ''\n          element_class: ''\n          element_label_type: ''\n          element_label_class: ''\n          element_label_colon: true\n          element_wrapper_type: ''\n          element_wrapper_class: ''\n          element_default_classes: true\n          empty: ''\n          hide_empty: false\n          empty_zero: false\n          hide_alter_empty: true\n          type: user_name\n      pager:\n        type: some\n        options:\n          offset: 0\n          items_per_page: 10\n      exposed_form:\n        type: basic\n        options:\n          submit_button: Apply\n          reset_button: false\n          reset_button_label: Reset\n          exposed_sorts_label: 'Sort by'\n          expose_sort_order: true\n          sort_asc_label: Asc\n          sort_desc_label: Desc\n      access:\n        type: perm\n        options:\n          perm: 'access user profiles'\n      cache:\n        type: tag\n        options: {  }\n      empty:\n        area_text_custom:\n          id: area_text_custom\n          table: views\n          field: area_text_custom\n          relationship: none\n          group_type: group\n          admin_label: ''\n          plugin_id: text_custom\n          empty: true\n          content: 'There are currently 0 users online.'\n          tokenize: false\n      sorts:\n        access:\n          id: access\n          table: users_field_data\n          field: access\n          relationship: none\n          group_type: group\n          admin_label: ''\n          entity_type: user\n          entity_field: access\n          plugin_id: date\n          order: DESC\n          expose:\n            label: ''\n            field_identifier: access\n          exposed: false\n          granularity: second\n      arguments: {  }\n      filters:\n        status:\n          id: status\n          table: users_field_data\n          field: status\n          entity_type: user\n          entity_field: status\n          plugin_id: boolean\n          value: '1'\n          group: 1\n          expose:\n            operator: '0'\n            operator_limit_selection: false\n            operator_list: {  }\n        access:\n          id: access\n          table: users_field_data\n          field: access\n          relationship: none\n          group_type: group\n          admin_label: ''\n          entity_type: user\n          entity_field: access\n          plugin_id: date\n          operator: '>='\n          value:\n            min: ''\n            max: ''\n            value: '-15 minutes'\n            type: offset\n          group: 1\n          exposed: false\n          expose:\n            operator_id: access_op\n            label: 'Last access'\n            description: 'A user is considered online for this long after they have last viewed a page.'\n            use_operator: false\n            operator: access_op\n            operator_limit_selection: false\n            operator_list: {  }\n            identifier: access\n            required: false\n            remember: false\n            multiple: false\n            remember_roles:\n              authenticated: authenticated\n          is_grouped: false\n          group_info:\n            label: ''\n            description: ''\n            identifier: ''\n            optional: true\n            widget: select\n            multiple: false\n            remember: false\n            default_group: All\n            default_group_multiple: {  }\n            group_items: {  }\n      style:\n        type: html_list\n        options:\n          grouping: {  }\n          row_class: ''\n          default_row_class: true\n          type: ul\n          wrapper_class: item-list\n          class: ''\n      row:\n        type: fields\n      query:\n        type: views_query\n        options:\n          query_comment: ''\n          disable_sql_rewrite: false\n          distinct: false\n          replica: false\n          query_tags: {  }\n      relationships: {  }\n      header:\n        result:\n          id: result\n          table: views\n          field: result\n          relationship: none\n          group_type: group\n          admin_label: ''\n          plugin_id: result\n          empty: false\n          content: 'There are currently @total users online.'\n      footer: {  }\n      display_extenders: {  }\n    cache_metadata:\n      max-age: -1\n      contexts:\n        - 'languages:language_content'\n        - 'languages:language_interface'\n        - user.permissions\n      tags: {  }\n  who_s_online_block:\n    id: who_s_online_block\n    display_title: 'Who''s online'\n    display_plugin: block\n    position: 1\n    display_options:\n      display_description: 'A list of users that are currently logged in.'\n      display_extenders: {  }\n      block_description: 'Who''s online'\n    cache_metadata:\n      max-age: -1\n      contexts:\n        - 'languages:language_content'\n        - 'languages:language_interface'\n        - user.permissions\n      tags: {  }\n", "metadata": {"source": "repos/drupal_core/core/modules/user/config/optional/views.view.who_s_online.yml", "type": "yaml_reference", "topic": "views.view.who s online"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: MessengerInterface\nSource file: <source_file>\nFile name hint: MessengerInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Messenger;\n\n/**\n * Stores runtime messages sent out to individual users on the page.\n *\n * An example for these messages is for example: \"Content X got saved\".\n */\ninterface MessengerInterface {\n\n  /**\n   * A status message.\n   */\n  const TYPE_STATUS = 'status';\n\n  /**\n   * A warning.\n   */\n  const TYPE_WARNING = 'warning';\n\n  /**\n   * An error.\n   */\n  const TYPE_ERROR = 'error';\n\n  /**\n   * Adds a new message to the queue.\n   *\n   * The messages will be displayed in the order they got added later.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param string $type\n   *   (optional) The message's type. Either self::TYPE_STATUS,\n   *   self::TYPE_WARNING, or self::TYPE_ERROR.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addMessage($message, $type = self::TYPE_STATUS, $repeat = FALSE);\n\n  /**\n   * Adds a new status message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addStatus($message, $repeat = FALSE);\n\n  /**\n   * Adds a new error message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addError($message, $repeat = FALSE);\n\n  /**\n   * Adds a new warning message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addWarning($message, $repeat = FALSE);\n\n  /**\n   * Gets all messages.\n   *\n   * @return string[][]|\\Drupal\\Component\\Render\\MarkupInterface[][]\n   *   Keys are message types and values are indexed arrays of messages. Message\n   *   types are either self::TYPE_STATUS, self::TYPE_WARNING, or\n   *   self::TYPE_ERROR.\n   */\n  public function all();\n\n  /**\n   * Gets all messages of a certain type.\n   *\n   * @param string $type\n   *   The messages' type. Either self::TYPE_STATUS, self::TYPE_WARNING,\n   *   or self::TYPE_ERROR.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The messages of given type.\n   */\n  public function messagesByType($type);\n\n  /**\n   * Deletes all messages.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The deleted messages.\n   */\n  public function deleteAll();", "output": "<?php\n\nnamespace Drupal\\Core\\Messenger;\n\n/**\n * Stores runtime messages sent out to individual users on the page.\n *\n * An example for these messages is for example: \"Content X got saved\".\n */\ninterface MessengerInterface {\n\n  /**\n   * A status message.\n   */\n  const TYPE_STATUS = 'status';\n\n  /**\n   * A warning.\n   */\n  const TYPE_WARNING = 'warning';\n\n  /**\n   * An error.\n   */\n  const TYPE_ERROR = 'error';\n\n  /**\n   * Adds a new message to the queue.\n   *\n   * The messages will be displayed in the order they got added later.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param string $type\n   *   (optional) The message's type. Either self::TYPE_STATUS,\n   *   self::TYPE_WARNING, or self::TYPE_ERROR.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addMessage($message, $type = self::TYPE_STATUS, $repeat = FALSE);\n\n  /**\n   * Adds a new status message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addStatus($message, $repeat = FALSE);\n\n  /**\n   * Adds a new error message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addError($message, $repeat = FALSE);\n\n  /**\n   * Adds a new warning message to the queue.\n   *\n   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n   *   The translated message to be displayed to the user. For consistency with\n   *   other messages, it should begin with a capital letter and end with a\n   *   period.\n   * @param bool $repeat\n   *   (optional) If this is FALSE and the message is already set, then the\n   *   message won't be repeated. Defaults to FALSE.\n   *\n   * @return $this\n   */\n  public function addWarning($message, $repeat = FALSE);\n\n  /**\n   * Gets all messages.\n   *\n   * @return string[][]|\\Drupal\\Component\\Render\\MarkupInterface[][]\n   *   Keys are message types and values are indexed arrays of messages. Message\n   *   types are either self::TYPE_STATUS, self::TYPE_WARNING, or\n   *   self::TYPE_ERROR.\n   */\n  public function all();\n\n  /**\n   * Gets all messages of a certain type.\n   *\n   * @param string $type\n   *   The messages' type. Either self::TYPE_STATUS, self::TYPE_WARNING,\n   *   or self::TYPE_ERROR.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The messages of given type.\n   */\n  public function messagesByType($type);\n\n  /**\n   * Deletes all messages.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The deleted messages.\n   */\n  public function deleteAll();\n\n  /**\n   * Deletes all messages of a certain type.\n   *\n   * @param string $type\n   *   The messages' type. Either self::TYPE_STATUS, self::TYPE_WARNING, or\n   *   self::TYPE_ERROR.\n   *\n   * @return string[]|\\Drupal\\Component\\Render\\MarkupInterface[]\n   *   The deleted messages of given type.\n   */\n  public function deleteByType($type);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Messenger/MessengerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MessengerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Playground\nstatus: experimental\ndescription: 'An interactive playground component for testing FlowDrop workflows. Provides a chat-like interface for sending messages to workflows and viewing responses.'\ngroup: FlowDrop\n\nprops:\n  type: object\n  properties:\n    workflow:\n      type: object\n      title: Workflow Data\n      description: 'Workflow data object containing id, name, nodes, edges, and metadata'\n    initial_session_id:\n      type: string\n      title: Initial Session ID\n      description: 'Session ID (UUID) to auto-select when playground loads. The session will be loaded automatically.'\n    show_chat_input:\n      type: boolean\n      title: Show Chat Input\n      description: 'Whether to show the text input field. Set to false for workflows without chat input nodes to show only the Run button.'\n      default: true\n    show_run_button:\n      type: boolean\n      title: Show Run Button\n      description: 'Whether to show the Run button. Set to false for view-only mode.'\n      default: true\n    predefined_message:\n      type: string\n      title: Predefined Message\n      description: 'Custom message to send when Run button is clicked (used when chat input is hidden).'\n    auto_run:\n      type: boolean\n      title: Auto Run\n      description: 'Automatically execute the workflow on load without user interaction.'\n      default: false\n    endpoint_config:\n      type: object\n      title: Endpoint Configuration\n      description: 'API endpoint configuration for playground operations'\n    container_id:\n      type: string\n      title: Container ID\n      description: 'Unique identifier for the playground container'\n    mode:\n      type: string\n      title: Display Mode\n      description: 'Playground display mode: \"standalone\" (embedded in page), \"embedded\" (with close button), or \"modal\" (full-screen overlay)'\n      default: 'standalone'\n      enum:\n        - standalone\n        - embedded\n        - modal\n    height:\n      type: string\n      title: Height\n      description: 'Playground height (CSS value, e.g., \"100vh\", \"600px\")'\n      default: '100%'\n    width:\n      type: string\n      title: Width\n      description: 'Playground width (CSS value)'\n      default: '100%'\n    back_url:\n      type: string\n      title: Back URL\n      description: 'URL for the back button navigation (workflow listing)'\n      default: '/admin/flowdrop/workflows'\n    editor_url:\n      type: string\n      title: Editor URL\n      description: 'URL for the Edit Workflow button (workflow editor)'\n    workflow_name:\n      type: string\n      title: Workflow Name\n      description: 'Name of the workflow for display'\n    show_header:\n      type: boolean\n      title: Show Header\n      description: 'Whether to display a header with workflow name and back navigation'\n      default: true\n    attributes:\n      type: Drupal\\Core\\Template\\Attribute\n      title: Attributes\n      description: 'Additional HTML attributes for the container element'\n\nlibraryOverrides:\n  css:\n    component:\n      playground.css: {}\n  js:\n    playground.js: { preprocess: false }\n  dependencies:\n    - flowdrop_ui_components/flowdrop\n    - flowdrop_ui_components/fullscreen-layout\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/playground/playground.component.yml", "type": "yaml_reference", "topic": "playground.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  sdc_inline_editor.sdc_validator_service:\n    class: Drupal\\sdc_inline_editor\\Service\\SDCValidatorService\n  sdc_inline_editor.content_validator_service:\n    class: Drupal\\sdc_inline_editor\\Service\\ContentValidatorService\n    arguments: ['@sdc_inline_editor.sdc_validator_service']\n  sdc_inline_editor.content_builder_service:\n    class: Drupal\\sdc_inline_editor\\Service\\ContentBuilderService\n    arguments: ['@entity_type.manager']\n  sdc_inline_editor.page_editor_service:\n    class: Drupal\\sdc_inline_editor\\Service\\PageEditorService\n    arguments: ['@entity_type.manager', '@current_user', '@sdc_inline_editor.content_validator_service']\n  sdc_inline_editor.page_validator_service:\n    class: Drupal\\sdc_inline_editor\\Service\\PageValidatorService\n  sdc_inline_editor.twig.sdc_attributes_extension:\n    class: Drupal\\sdc_inline_editor\\Twig\\SDCAttributesExtension\n    tags:\n      - { name: twig.extension }\n  sdc_inline_editor.sdc_service:\n    class: Drupal\\sdc_inline_editor\\Service\\SDCService\n    arguments: ['@plugin.manager.sdc', '@config.factory', '@sdc_inline_editor.sdc_validator_service', '@renderer']\n  sdc_inline_editor.helper:\n    class: Drupal\\sdc_inline_editor\\Helper\\SdcInlineEditorHelper\n    arguments: ['@sdc_inline_editor.sdc_service']\n  media_library.opener.sdc_inline_editor:\n    class: Drupal\\sdc_inline_editor\\Service\\MediaLibrarySdcInlineEditorOpener\n    arguments: ['@entity_type.manager', '@extension.list.module', '@renderer']\n    tags:\n      - { name: media_library.opener }\n", "metadata": {"source": "repos/sdc_inline_editor/sdc_inline_editor.services.yml", "type": "yaml_reference", "topic": "sdc inline editor.services"}}
{"instruction": "Show me the implementation of the class FieldFilteredMarkup in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field;\n\nuse Drupal\\Component\\Utility\\Html;\nuse Drupal\\Component\\Render\\MarkupInterface;\nuse Drupal\\Component\\Render\\MarkupTrait;\nuse Drupal\\Component\\Utility\\Xss;\n\n/**\n * Defines an object that passes safe strings through the Field system.\n *\n * This object filters the string using a very restrictive tag list when it is\n * created.\n *\n * @internal\n *   This object is marked as internal because it should only be used by the\n *   Field module and field-related plugins.\n *\n * @see \\Drupal\\Core\\Render\\Markup\n */\nfinal class FieldFilteredMarkup implements MarkupInterface, \\Countable {\n  use MarkupTrait;\n\n  /**\n   * Overrides \\Drupal\\Component\\Render\\MarkupTrait::create().\n   *\n   * @return string|\\Drupal\\Component\\Render\\MarkupInterface\n   *   A safe string filtered with the allowed tag list and normalized.\n   *\n   * @see \\Drupal\\Core\\Field\\FieldFilteredMarkup::allowedTags()\n   * @see \\Drupal\\Component\\Utility\\Xss::filter()\n   * @see \\Drupal\\Component\\Utility\\Html::normalize()\n   */\n  public static function create($string) {\n    $string = (string) $string;\n    if ($string === '') {\n      return '';\n    }\n    $safe_string = new static();\n    // All known XSS vectors are filtered out by\n    // \\Drupal\\Component\\Utility\\Xss::filter(), all tags in the markup are\n    // allowed intentionally by the trait, and no danger is added in by\n    // \\Drupal\\Component\\Utility\\Html::normalize(). Since the normalized value\n    // is essentially the same markup, designate this string as safe as well.\n    // This method is an internal part of field sanitization, so the resultant,\n    // sanitized string should be printable as is.\n    $safe_string->string = Html::normalize(Xss::filter($string, static::allowedTags()));\n    return $safe_string;\n  }\n\n  /**\n   * Returns the allowed tag list.\n   *\n   * @return string[]\n   *   A list of allowed tags.\n   */\n  public static function allowedTags() {\n    return [\n      'a',\n      'b',\n      'big',\n      'code',\n      'del',\n      'em',\n      'i',\n      'ins',\n      'pre',\n      'q',\n      'small',\n      'span',\n      'strong',\n      'sub',\n      'sup',\n      'tt',\n      'ol',\n      'ul',\n      'li',\n      'p',\n      'br',\n      'img',\n    ];\n  }\n\n  /**\n   * Returns a human-readable list of allowed tags for display in help texts.\n   *\n   * @return string\n   *   A human-readable list of allowed tags for display in help texts.\n   */\n  public static function displayAllowedTags() {\n    return '<' . implode('> <', static::allowedTags()) . '>';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/FieldFilteredMarkup.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldFilteredMarkup", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: El calendario est\u00e1 lleno de excusas para complacer a los amantes del chocolate, desde festividades religiosas a cumplea\u00f1os - incluso el D\u00eda Internacional del chocolate, el 7 de julio. Pero aquellos que son veganos o no toman l\u00e1cteos no tienen por qu\u00e9 perd\u00e9rselo porque hay una gran oferta de chocolates veganos sin lactosa.", "input": "", "output": "El calendario est\u00e1 lleno de excusas para complacer a los amantes del chocolate, desde festividades religiosas a cumplea\u00f1os - incluso el D\u00eda Internacional del chocolate, el 7 de julio. Pero aquellos que son veganos o no toman l\u00e1cteos no tienen por qu\u00e9 perd\u00e9rselo porque hay una gran oferta de chocolates veganos sin lactosa.\n\nEl chocolate con leche sin lactosa se fabrica de forma similar al chocolate normal, hasta el momento en el que se a\u00f1ade la leche. Los granos de cacao son tostados durante un par de horas hasta que adquieren su rico sabor. Se elimina la c\u00e1scara y se muele el interior del grano hasta conseguir una pasta que pueda mezclarse con la manteca de cacao, produciendo as\u00ed el porcentaje de cacao deseado. Los saborizantes, el az\u00facar y la leche son a\u00f1adidos despu\u00e9s en diferentes cantidades dependiendo del tipo de chocolate que se desea realizar. El chocolate es granulado en este punto y se tritura hasta que est\u00e1 suave, \u00a1esto puede llevar d\u00edas! Finalmente, se templa mediante un proceso de calentamiento y enfriamiento hasta que est\u00e1 listo para comer.\n\nEntonces, \u00bfc\u00f3mo hacen para que los chocolates veganos adquieran ese sabor y esa textura cremosa propias de la leche?\n\n## Leche de arroz\n\nEl sabor de la leche de arroz complementa perfectamente a las semillas de cacao y fue una de las primeras alternativas usadas para crear chocolate con leche vegano. La leche de arroz est\u00e1 hecha de polvo de arroz y algunas veces se combina con leche de avellana para crear la textura y el sabor correctos que son ideales para producir todo tipo de barras de chocolate.\n\n## Leche de coco\n\nLa leche de coco es el ingrediente perfecto para agregar cremosidad a una barra de chocolate. Con altos niveles de grasa, un sabor dulce pero no abrumador y con la consistencia correcta, es una excelente opci\u00f3n para el chocolate con leche vegano. El chocolate hecho de esta manera se derretir\u00e1 estupendamente para luego rociarlo o mojar en \u00e9l, y la leche de coco agrega un ligero sabor tropical que funciona bien con otros sabores de frutas y nueces.\n\n## Leche de soja\n\nLa soja ha sido durante mucho tiempo el pilar de las dietas veganas y vegetarianas ya que es rica en prote\u00ednas y est\u00e1 disponible en una amplia variedad de texturas adecuadas para todo tipo de platos. La leche de soja est\u00e1 ampliamente disponible y es una excelente alternativa a la leche para el chocolate. No es tan rica en grasa como algunas leches veganas, pero tiene un sabor neutro que facilita su combinaci\u00f3n con casi cualquier otro sabor.\n\n## Leche de almendras y avellanas\n\nLas leches hechas de almendras y avellanas son f\u00e1ciles de encontrar en los estantes de los supermercados y son perfectas para la producci\u00f3n de chocolate. Al igual que la leche de soja, suelen ser bastante bajas en grasa y, por lo tanto, algo menos cremosas, pero tienen ese sabor a fruto seco que combina muy bien con cualquier tipo de chocolate.\n\nMuchos fabricantes usan una combinaci\u00f3n de las leches anteriores citadas para crear la consistencia perfecta para su producto. Usando una mezcla de estas leches, son capaces de producir todo tipo de chocolates con leche (incluido el chocolate blanco).\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/modules/demo_umami_content/default_content/languages/es/article_body/dairy-free-delicious-milk-chocolate.md", "type": "doc_summary", "topic": "El calendario est\u00e1 lleno de excusas para complacer a los amantes del chocolate, desde festividades religiosas a cumplea\u00f1os - incluso el D\u00eda Internacional del chocolate, el 7 de julio. Pero aquellos que son veganos o no toman l\u00e1cteos no tienen por qu\u00e9 perd\u00e9rselo porque hay una gran oferta de chocolates veganos sin lactosa."}}
{"instruction": "Show me the implementation of the class BootstrapFiveLayoutsUpdateManager in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Extension\\ThemeHandlerInterface;\nuse Drupal\\Core\\Theme\\ThemeManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n *\n */\nclass BootstrapFiveLayoutsUpdateManager extends BootstrapFiveLayoutsPluginManager {\n\n  /**\n   * The service container.\n   *\n   * @var \\Symfony\\Component\\DependencyInjection\\ContainerInterface\n   */\n  protected ContainerInterface $container;\n\n  /**\n   * Constructs a new \\Drupal\\bootstrap_five_layouts\\BootstrapFiveLayoutsManager object.\n   *\n   * @param \\Traversable $namespaces\n   *   An object that implements \\Traversable which contains the root paths\n   *   keyed by the corresponding namespace to look for plugin implementations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache_backend\n   *   Cache backend instance to use.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Extension\\ThemeHandlerInterface $theme_handler\n   *   The theme manager used to invoke the alter hook with.\n   * @param \\Drupal\\Core\\Theme\\ThemeManagerInterface $theme_manager\n   *   The theme manager used to invoke the alter hook with.\n   */\n  public function __construct(\\Traversable $namespaces, CacheBackendInterface $cache_backend, ModuleHandlerInterface $module_handler, ThemeHandlerInterface $theme_handler, ThemeManagerInterface $theme_manager) {\n    parent::__construct($namespaces, $cache_backend, $module_handler, $theme_handler, $theme_manager, 'Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts\\BootstrapFiveLayoutsUpdateInterface', 'Drupal\\bootstrap_five_layouts\\Annotation\\BootstrapFiveLayoutsUpdate');\n    $this->alterInfo('bootstrap_five_layouts_update_info');\n    $this->setCacheBackend($cache_backend, 'bootstrap_five_layouts_update_info');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setContainer(ContainerInterface $container): void {\n    $this->container = $container;\n  }\n\n  /**\n   * Retrieves the update plugins for a specific schema version.\n   *\n   * @param int $schema\n   *   The update schema version to retrieve.\n   *\n   * @return \\Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts\\BootstrapFiveLayoutsUpdateInterface[]\n   *   An array of update plugins, keyed by their plugin id.\n   */\n  public function getUpdates($schema) {\n    $updates = [];\n    foreach ($this->getDefinitions() as $plugin_id => $definition) {\n      if (isset($definition['schema']) && $definition['schema'] == $schema) {\n        $updates[$plugin_id] = $this->createInstance($plugin_id);\n      }\n    }\n    return $updates;\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/BootstrapFiveLayoutsUpdateManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BootstrapFiveLayoutsUpdateManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: adds\nSource file: <source_file>\nFile name hint: ControllerResolver.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Controller;\n\nuse Drupal\\Core\\Routing\\RouteObjectInterface;\nuse Drupal\\Core\\Utility\\CallableResolver;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * ControllerResolver to enhance controllers beyond Symfony's basic handling.\n *\n * It adds one behavior:\n *\n *  - By default, a controller name follows the class::method notation. This\n *    class adds the possibility to use a service from the container as a\n *    controller by using a service:method notation (Symfony uses the same\n *    convention).\n */\nclass ControllerResolver implements ControllerResolverInterface {\n\n  /**\n   * Constructs a new ControllerResolver.\n   *\n   * @param \\Drupal\\Core\\Utility\\CallableResolver $callableResolver\n   *   The callable resolver.\n   */\n  public function __construct(protected CallableResolver $callableResolver) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getControllerFromDefinition($controller, $path = '') {\n    try {\n      $callable = $this->callableResolver->getCallableFromDefinition($controller);\n    }\n    catch (\\InvalidArgumentException $e) {\n      throw new \\InvalidArgumentException(sprintf('The controller for URI \"%s\" is not callable.', $path), 0, $e);\n    }\n    return $callable;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getController(Request $request): callable|FALSE {\n    if (!$controller = $request->attributes->get(RouteObjectInterface::CONTROLLER_NAME)) {\n      return FALSE;\n    }\n    return $this->getControllerFromDefinition($controller, $request->getPathInfo());\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Controller;\n\nuse Drupal\\Core\\Routing\\RouteObjectInterface;\nuse Drupal\\Core\\Utility\\CallableResolver;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * ControllerResolver to enhance controllers beyond Symfony's basic handling.\n *\n * It adds one behavior:\n *\n *  - By default, a controller name follows the class::method notation. This\n *    class adds the possibility to use a service from the container as a\n *    controller by using a service:method notation (Symfony uses the same\n *    convention).\n */\nclass ControllerResolver implements ControllerResolverInterface {\n\n  /**\n   * Constructs a new ControllerResolver.\n   *\n   * @param \\Drupal\\Core\\Utility\\CallableResolver $callableResolver\n   *   The callable resolver.\n   */\n  public function __construct(protected CallableResolver $callableResolver) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getControllerFromDefinition($controller, $path = '') {\n    try {\n      $callable = $this->callableResolver->getCallableFromDefinition($controller);\n    }\n    catch (\\InvalidArgumentException $e) {\n      throw new \\InvalidArgumentException(sprintf('The controller for URI \"%s\" is not callable.', $path), 0, $e);\n    }\n    return $callable;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getController(Request $request): callable|FALSE {\n    if (!$controller = $request->attributes->get(RouteObjectInterface::CONTROLLER_NAME)) {\n      return FALSE;\n    }\n    return $this->getControllerFromDefinition($controller, $request->getPathInfo());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/ControllerResolver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ControllerResolver", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "views_pretty_paths.views_pretty_paths_admin_form:\n  path: /admin/config/views-pretty-path\n  defaults:\n    _form: \\Drupal\\views_pretty_paths\\Form\\ViewsPrettyPathAdminForm\n    _title: Views Pretty Path\n  requirements:\n    _permission: access administration pages\n  options:\n    _admin_route: TRUE\n", "metadata": {"source": "repos/views_pretty_paths/views_pretty_paths.routing.yml", "type": "yaml_reference", "topic": "views pretty paths.routing"}}
{"instruction": "Show me the implementation of the class LocalePages in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n */\n\n@trigger_error(__FILE__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Functions have been deprecated and moved to system.module. See https://www.drupal.org/node/3538089', E_USER_DEPRECATED);\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/locale.pages.inc", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LocalePages", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.field.user.user.user_picture\n    - image.style.thumbnail\n  module:\n    - image\n    - user\nid: user.user.default\ntargetEntityType: user\nbundle: user\nmode: default\ncontent:\n  account:\n    weight: -10\n    region: content\n  contact:\n    weight: 5\n    region: content\n  language:\n    weight: 0\n    region: content\n  timezone:\n    weight: 6\n    region: content\n  user_picture:\n    type: image_image\n    weight: -1\n    region: content\n    settings:\n      progress_indicator: throbber\n      preview_image_style: thumbnail\n    third_party_settings: {  }\nhidden:\n  langcode: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_form_display.user.user.default.yml", "type": "yaml_reference", "topic": "core.entity form display.user.user.default"}}
{"instruction": "Show me the implementation of the interface PluginWithFormsInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\n\n/**\n * Provides an interface for plugins which have forms.\n *\n * Plugin forms are embeddable forms referenced by the plugin annotation.\n * Used by plugin types which have a larger number of plugin-specific forms.\n */\ninterface PluginWithFormsInterface extends PluginInspectionInterface {\n\n  /**\n   * Gets the form class for the given operation.\n   *\n   * @param string $operation\n   *   The name of the operation.\n   *\n   * @return string|null\n   *   The form class if defined, NULL otherwise.\n   */\n  public function getFormClass($operation);\n\n  /**\n   * Gets whether the plugin has a form class for the given operation.\n   *\n   * @param string $operation\n   *   The name of the operation.\n   *\n   * @return bool\n   *   TRUE if the plugin has a form class for the given operation.\n   */\n  public function hasFormClass($operation);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/PluginWithFormsInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PluginWithFormsInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: MediaSource.php\nTarget symbol: class MediaSource\nNamespace: Drupal\\media\\Attribute\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for MediaSource.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\Attribute\\Plugin\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\media\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a MediaSource attribute.\n *\n * Media sources are responsible for implementing all the logic for dealing\n * with a particular type of media. They provide various universal and\n * type-specific metadata about media of the type they handle.\n *\n * Plugin namespace: Plugin\\media\\Source\n *\n * For a working example, see \\Drupal\\media\\Plugin\\media\\Source\\File.\n *\n * @see \\Drupal\\media\\MediaSourceInterface\n * @see \\Drupal\\media\\MediaSourceBase\n * @see \\Drupal\\media\\MediaSourceManager\n * @see hook_media_source_info_alter()\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass MediaSource extends Plugin {\n\n  /**\n   * Constructs a new MediaSource attribute.\n   *\n   * @param string $id\n   *   The attribute class ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $label\n   *   The human-readable name of the media source.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup|null $description\n   *   (optional) A brief description of the media source.\n   * @param string[] $allowed_field_types\n   *   (optional) The field types that can be used as a source field for this\n   *   media source.\n   * @param class-string[] $forms\n   *   (optional) The classes used to define media source-specific forms. An\n   *   array of form class names, keyed by ID. The ID represents the operation\n   *   the form is used for, for example, 'media_library_add'.\n   * @param string $default_thumbnail_filename\n   *   (optional) A filename for the default thumbnail.\n   *   The thumbnails are placed in the directory defined by the config setting\n   *   'media.settings.icon_base_uri'. When using custom icons, make sure the\n   *   module provides a hook_install() implementation to copy the custom icons\n   *   to this directory. The media_install() function provides a clear example\n   *   of how to do this.\n   * @param string $thumbnail_uri_metadata_attribute\n   *   (optional) The metadata attribute name to provide the thumbnail URI.\n   * @param string $thumbnail_width_metadata_attribute\n   *   (optional) The metadata attribute name to provide the thumbnail width.\n   * @param string $thumbnail_height_metadata_attribute\n   *   (optional) The metadata attribute name to provide the thumbnail height.\n   * @param string|null $thumbnail_alt_metadata_attribute\n   *   (optional) The metadata attribute name to provide the thumbnail alt.\n   *   \"Thumbnail\" will be used if the attribute name is not provided.\n   * @param string|null $thumbnail_title_metadata_attribute\n   *   (optional) The metadata attribute name to provide the thumbnail title.\n   *   The name of the media item will be used if the attribute name is not\n   *   provided.\n   * @param string $default_name_metadata_attribute\n   *   (optional) The metadata attribute name to provide the default name.\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly TranslatableMarkup $label,\n    public readonly ?TranslatableMarkup $description = NULL,\n    public readonly array $allowed_field_types = [],\n    public readonly array $forms = [],\n    public readonly string $default_thumbnail_filename = 'generic.png',\n    public readonly string $thumbnail_uri_metadata_attribute = 'thumbnail_uri',\n    public readonly string $thumbnail_width_metadata_attribute = 'thumbnail_width',\n    public readonly string $thumbnail_height_metadata_attribute = 'thumbnail_height',\n    public readonly ?string $thumbnail_alt_metadata_attribute = NULL,\n    public readonly ?string $thumbnail_title_metadata_attribute = NULL,\n    public readonly string $default_name_metadata_attribute = 'default_name',\n    public readonly ?string $deriver = NULL,\n  ) {}\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Attribute/MediaSource.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaSource", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{# Photo Set Block Component #}\n{# This component displays multiple images with customizable layouts #}\n{# To change the maximum number of images allowed, update the data-sdc-max-images attribute below (default: 20) #}\n\n<div {{ sdc_component_attributes(component_name) }} class=\"photo-set-block photo-set-{{ layout|default('grid') }}\">\n\n      <div class=\"photo-set-container image-column-{{ columns|default('2') }}\"\n       data-sdc-field=\"images\"\n       data-sdc-sidebar=\"true\"\n       data-sdc-type=\"multi-image-selector\"\n       data-sdc-prop-multi-image-selector=\"{{ images|default([])|json_encode }}\"\n       data-sdc-max-images=\"20\"\n  >\n    {% if images and images|length > 0 %}\n      {% for imageUuid in images %}\n        {% set media_entity = load_media_entity(imageUuid) %}\n        {% if media_entity %}\n          <div class=\"photo-set-item\">\n            {% set original_image_url = media_image_url(media_entity) %}\n            {% set image_url = (imageSize|default('raw') == 'raw' or imageSize|default('') == '') ? original_image_url : media_image_url(media_entity, imageSize) %}\n            <img src=\"{{ image_url }}\" data-original-image-url=\"{{ original_image_url }}\"\n                 alt=\"{{ media_image_alt(media_entity) }}\"\n                 class=\"photo-set-image\" />\n          </div>\n        {% else %}\n          <div class=\"image-placeholder\">Image {{ loop.index }} not found</div>\n        {% endif %}\n      {% endfor %}\n    {% else %}\n      <div class=\"image-placeholder\">No images selected.</div>\n    {% endif %}\n  </div>\n\n  {# Caption - sidebar editor #}\n  {% if caption %}\n    <div class=\"photo-set-caption\">\n      {{ caption }}\n    </div>\n  {% endif %}\n\n  {% if editable %}\n    <div data-sdc-field=\"caption\"\n        data-sdc-sidebar=\"true\"\n        data-sdc-type=\"text-input\"\n        data-sdc-prop-text-input=\"{{ caption|default('') }}\">\n    </div>\n\n    {# Layout - sidebar editor #}\n    <div data-sdc-field=\"layout\"\n        data-sdc-sidebar=\"true\"\n        data-sdc-type=\"select-dropdown\"\n        data-sdc-options='[\n          {\"value\": \"grid\", \"label\": \"Grid Layout\"},\n          {\"value\": \"masonry\", \"label\": \"Masonry Layout\"},\n          {\"value\": \"carousel\", \"label\": \"Carousel/Slider\"}\n        ]'\n        data-sdc-prop-select-dropdown=\"{{ layout|default('grid') }}\">\n    </div>\n\n    {# Columns - sidebar editor #}\n    <div data-sdc-field=\"columns\"\n        data-sdc-sidebar=\"true\"\n        data-sdc-type=\"number-input\"\n        data-sdc-min=\"1\"\n        data-sdc-max=\"4\"\n        data-sdc-prop-number-input=\"{{ columns|default('2') }}\">\n    </div>\n\n    {# Image size - sidebar editor #}\n    <div data-sdc-field=\"imageSize\"\n        data-sdc-sidebar=\"true\"\n        data-sdc-type=\"select-dropdown\"\n        data-sdc-options='{{ get_image_style_dropdown_options('sdc_inline_editor_') }}'\n        data-sdc-prop-select-dropdown=\"{{ imageSize|default('raw') }}\">\n    </div>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/sdc_inline_editor/components/photo-set-block/photo-set-block.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: LayoutEntityDisplayNormalizer\nSource file: <source_file>\nFile name hint: LayoutEntityDisplayNormalizer.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\layout_builder\\Normalizer;\n\nuse Drupal\\layout_builder\\Entity\\LayoutEntityDisplayInterface;\nuse Drupal\\serialization\\Normalizer\\ConfigEntityNormalizer;\n\n/**\n * Normalizes/denormalizes LayoutEntityDisplay objects into an array structure.\n *\n * @internal\n *   Tagged services are internal.\n */\nclass LayoutEntityDisplayNormalizer extends ConfigEntityNormalizer {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static function getDataWithoutInternals(array $data) {\n    $data = parent::getDataWithoutInternals($data);\n    // Do not expose the actual layout sections in normalization.\n    // @todo Determine what to expose here in\n    //   https://www.drupal.org/node/2942975.\n    unset($data['third_party_settings']['layout_builder']['sections']);\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      LayoutEntityDisplayInterface::class => TRUE,\n    ];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Normalizer;\n\nuse Drupal\\layout_builder\\Entity\\LayoutEntityDisplayInterface;\nuse Drupal\\serialization\\Normalizer\\ConfigEntityNormalizer;\n\n/**\n * Normalizes/denormalizes LayoutEntityDisplay objects into an array structure.\n *\n * @internal\n *   Tagged services are internal.\n */\nclass LayoutEntityDisplayNormalizer extends ConfigEntityNormalizer {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static function getDataWithoutInternals(array $data) {\n    $data = parent::getDataWithoutInternals($data);\n    // Do not expose the actual layout sections in normalization.\n    // @todo Determine what to expose here in\n    //   https://www.drupal.org/node/2942975.\n    unset($data['third_party_settings']['layout_builder']['sections']);\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      LayoutEntityDisplayInterface::class => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Normalizer/LayoutEntityDisplayNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutEntityDisplayNormalizer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CreateWebform.php\nTarget symbol: class CreateWebform\nNamespace: Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CreateWebform.\n- Include required imports:\n  - Drupal\\mcp_tools_webform\\Service\\WebformService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_webform\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_webform\\Service\\WebformService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_create_webform',\n  label: new TranslatableMarkup('Create Webform'),\n  description: new TranslatableMarkup('Create a new webform with elements.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform machine name'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'title' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'elements' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Elements definition'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Webform ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'status' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Status'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateWebform extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'webform';\n\n\n  protected WebformService $webformService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->webformService = $container->get('mcp_tools_webform.webform');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $id = $input['id'] ?? '';\n    $title = $input['title'] ?? '';\n\n    if (empty($id) || empty($title)) {\n      return ['success' => FALSE, 'error' => 'Both id and title are required.'];\n    }\n\n    $elements = $input['elements'] ?? [];\n\n    return $this->webformService->createWebform($id, $title, $elements);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/src/Plugin/tool/Tool/CreateWebform.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateWebform", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: TransactionStatusChangeEvent\nSource file: <source_file>\nFile name hint: TransactionStatusChangeEvent.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Event;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * The transaction status change event.\n */\nfinal class TransactionStatusChangeEvent extends Event {\n\n  /**\n   * The constructor.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param string $oldStatus\n   *   The old status.\n   * @param string $newStatus\n   *   The new status.\n   * @param array<string, mixed> $context\n   *   Extra context information for callers (debug/logging).\n   */\n  public function __construct(\n    public readonly NexiXpayTransactionInterface $transaction,\n    public readonly string $oldStatus,\n    public readonly string $newStatus,\n    public readonly array $context = [],\n  ) {}\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Event;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * The transaction status change event.\n */\nfinal class TransactionStatusChangeEvent extends Event {\n\n  /**\n   * The constructor.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param string $oldStatus\n   *   The old status.\n   * @param string $newStatus\n   *   The new status.\n   * @param array<string, mixed> $context\n   *   Extra context information for callers (debug/logging).\n   */\n  public function __construct(\n    public readonly NexiXpayTransactionInterface $transaction,\n    public readonly string $oldStatus,\n    public readonly string $newStatus,\n    public readonly array $context = [],\n  ) {}\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Event/TransactionStatusChangeEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TransactionStatusChangeEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class Menu in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\InstanceInterface;\nuse Drupal\\display_builder\\IslandPluginBase;\nuse Drupal\\display_builder\\IslandType;\n\n/**\n * Menu island plugin implementation.\n */\n#[Island(\n  id: 'menu',\n  label: new TranslatableMarkup('Main menu items'),\n  description: new TranslatableMarkup('Copy, paste and duplicate.'),\n  type: IslandType::Menu,\n)]\nclass Menu extends IslandPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(InstanceInterface $builder, array $data = [], array $options = []): array {\n    $builder_id = (string) $builder->id();\n    // Attribute data-contextual-menu is important for the js mapping.\n    // @see assets/js/contextual_menu.js\n    // Urls are generated with placeholders to be replaced in the js.\n    $duplicate = $this->buildMenuItem($this->t('Duplicate'), 'duplicate');\n    $duplicate = $this->htmxEvents->onClickDuplicate($duplicate, $builder_id, '__node_id__', '__parent_id__', '__slot_id__', '__slot_position__');\n\n    $paste = $this->buildMenuItem($this->t('Paste'), 'paste');\n    $paste = $this->htmxEvents->onClickPaste($paste, $builder_id, '__node_id__', '__parent_id__', '__slot_id__', '__slot_position__');\n\n    return [\n      $this->buildMenuItem($this->t('Copy'), 'copy'),\n      $paste,\n      $duplicate,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Plugin/display_builder/Island/Menu.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Menu", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Navigation\ndescription: New administration navigation\npackage: Core\nversion: VERSION\nconfigure: navigation.settings\ntype: module\ndependencies:\n  - drupal:block\n  - drupal:file\n  - drupal:layout_builder\n", "metadata": {"source": "repos/drupal_core/core/modules/navigation/navigation.info.yml", "type": "yaml_reference", "topic": "navigation.info"}}
{"instruction": "Show me the implementation of the class SoapConditionsResponder in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client_webform\\Element;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Render\\Element\\FormElementBase;\nuse Drupal\\soap_client_webform\\Element\\SoapConditionsResponderInterface;\n\n/**\n * Provides Webform #states conditional element for SOAP responses.\n *\n * Creates boolean checkbox sub-elements based on SOAP operation output fields.\n * These checkboxes are automatically updated when a SOAP emitter element fires,\n * enabling Webform #states conditional logic based on SOAP response data.\n *\n * @FormElement(\"soap_conditions_responder\")\n */\nclass SoapConditionsResponder extends FormElementBase implements SoapConditionsResponderInterface\n{\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo(): array\n  {\n    $class = get_class($this);\n    return [\n      '#input' => TRUE,\n      '#process' => [[$class, 'processElement']],\n      '#theme_wrappers' => ['container'],\n      '#tree' => TRUE,\n      '#emitter_element' => '',\n      '#operation_id' => '',\n      '#field_mappings' => [],\n      '#debug_value' => FALSE,\n    ];\n  }\n\n  /**\n   * Processes the element.\n   *\n   * Creates checkbox sub-elements based on SOAP operation output fields for\n   * use with Webform #states conditional logic.\n   *\n   * @param array<string, mixed> $element\n   *   The form element.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   * @param array<string, mixed> $complete_form\n   *   The complete form.\n   *\n   * @return array<string, mixed>\n   *   The processed element.\n   */\n  public static function processElement(\n    array &$element,\n    FormStateInterface $form_state,\n    array &$complete_form,\n  ): array {\n    $operation_id = $element['#operation_id'] ?? '';\n    $element_key = $element['#webform_key'] ?? 'soap_conditions_responder';\n\n    if (empty($operation_id)) {\n      $element['error_message'] = [\n        '#type' => 'markup',\n        '#markup' => '<div class=\"messages messages--warning\">'\n          . t('No SOAP operation configured.')\n          . '</div>',\n      ];\n      return $element;\n    }\n\n    // Load SOAP operation to get output fields\n    $operation_storage = \\Drupal::entityTypeManager()\n      ->getStorage('soap_operation');\n    $operation = $operation_storage->load($operation_id);\n\n    if (!$operation) {\n      $element['error_message'] = [\n        '#type' => 'markup',\n        '#markup' => '<div class=\"messages messages--error\">'\n          . t('SOAP operation \"@id\" not found.', ['@id' => $operation_id])\n          . '</div>',\n      ];\n      return $element;\n    }\n\n    // Get output fields from operation schema\n    $schema = $operation->schema();\n    $output_fields = $schema['output']['fields'] ?? [];\n\n    $wrapper_id = 'soap-conditions-responder-' . $element_key;\n    $element['#attributes']['class'][] = 'soap-conditions-responder-wrapper';\n    $debug_value = $element['#debug_value'] ?? FALSE;\n    $visibility_class = $debug_value ? '' : 'visually-hidden';\n    $emitter_element = $element['#emitter_element'] ?? '';\n\n    $element['#prefix'] = \"<div id=\\\"{$wrapper_id}\\\" \"\n      . \"data-soap-conditions-responder=\\\"{$element_key}\\\" \"\n      . \"data-operation-id=\\\"{$operation_id}\\\" \"\n      . \"data-emitter-element=\\\"{$emitter_element}\\\">\"\n      . \"<div class=\\\"soap-conditions-responder-loading-overlay hidden\\\">\"\n      . \"<div class=\\\"soap-conditions-responder-spinner\\\"></div>\"\n      . \"</div>\"\n      . \"<div id=\\\"{$wrapper_id}-inner\\\" class='{$visibility_class}'>\";\n\n    $element['#suffix'] = '</div></div>';\n\n    $element['_has_data'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Has Data'),\n      '#default_value' => FALSE,\n      '#attributes' => [\n        'data-soap-conditions-responder-field' => '_has_data',\n        'class' => ['soap-conditions-responder-checkbox'],\n      ],\n      '#weight' => -50,\n    ];\n\n    $weight = 0;\n    foreach ($output_fields as $field_config) {\n      $field_name = $field_config['machine_name'] ?? $field_config['name'];\n      $field_label = $field_config['label']\n        ?? ucfirst(str_replace('_', ' ', $field_name));\n      $field_type = $field_config['type'] ?? 'string';\n\n      $is_boolean = in_array($field_type, ['boolean', 'bool']);\n      $form_element_type = $is_boolean ? 'checkbox' : 'hidden';\n\n      $element[$field_name] = [\n        '#type' => $form_element_type,\n        '#title' => $field_label,\n        '#default_value' => $is_boolean ? FALSE : '',\n        '#attributes' => [\n          'data-soap-conditions-responder-field' => $field_name,\n          'data-field-type' => $field_type,\n          'class' => ['soap-conditions-responder-field'],\n        ],\n        '#weight' => $weight++,\n      ];\n    }\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/modules/soap_client_webform/src/Element/SoapConditionsResponder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapConditionsResponder", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: is\nSource file: <source_file>\nFile name hint: ResponseDisplayPluginInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\display;\n\n/**\n * Defines a display which returns a Response object.\n *\n * This interface is meant to be used for display plugins, which do return some\n * other format requiring to return a response directly.\n */\ninterface ResponseDisplayPluginInterface extends DisplayPluginInterface {\n\n  /**\n   * Builds up a response with the rendered view as content.\n   *\n   * @param string $view_id\n   *   The view ID.\n   * @param string $display_id\n   *   The display ID.\n   * @param array $args\n   *   (optional) The arguments of the view.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\Response\n   *   The built response.\n   */\n  public static function buildResponse($view_id, $display_id, array $args = []);\n\n}\n// BUG: ensure this implementation follows Drupal 11 and PHP 8.3.", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\display;\n\n/**\n * Defines a display which returns a Response object.\n *\n * This interface is meant to be used for display plugins, which do return some\n * other format requiring to return a response directly.\n */\ninterface ResponseDisplayPluginInterface extends DisplayPluginInterface {\n\n  /**\n   * Builds up a response with the rendered view as content.\n   *\n   * @param string $view_id\n   *   The view ID.\n   * @param string $display_id\n   *   The display ID.\n   * @param array $args\n   *   (optional) The arguments of the view.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\Response\n   *   The built response.\n   */\n  public static function buildResponse($view_id, $display_id, array $args = []);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/display/ResponseDisplayPluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ResponseDisplayPluginInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
