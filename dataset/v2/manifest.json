{
  "stage": "dataset_refinement",
  "timestamp": "2026-02-08T11:37:30Z",
  "inputs": [
    {
      "name": "v1_train",
      "version": "v1",
      "hash": "e274986cf431cc6ae20e7df78d45809a19f2c4278bf4564518e009dadf9a5a1d"
    },
    {
      "name": "v1_valid",
      "version": "v1",
      "hash": "6c4c60cc67bdf5ab65afa000cb8b9eba35d8e4195124b8730b76276ae772e13b"
    },
    {
      "name": "v1_test",
      "version": "v1",
      "hash": "d0f4d7cc9ddcda4fd2dfbbec1c28c6e1e3f0a1dc3de984f80079289c5b9ce3b2"
    }
  ],
  "outputs": {
    "train_split": {
      "path": "dataset/v2/train.jsonl",
      "hash": "f9e54da2777e92569fa2fb8d5f06e6d4eef71bdb0546910787738b8472de3230"
    },
    "valid_split": {
      "path": "dataset/v2/valid.jsonl",
      "hash": "1f563332bda8b6f5b9ce6e72cdfeb6cf0fcac2b65d531300c11d897fd1229766"
    },
    "test_split": {
      "path": "dataset/v2/test.jsonl",
      "hash": "c56293440b81787d48ab6404267788ea3d408dd14e877676c247800b274113bd"
    },
    "rejected_samples": {
      "path": "dataset/v2/rejected.jsonl",
      "hash": "145ff865671d8db532e0389ccc5306d67935850ea823a761fbc6619f3e530be5"
    },
    "eval_candidate_pool": {
      "path": "dataset/v2/eval_candidate_pool.jsonl",
      "hash": "2953f57e2487dccee56c13a5c3ae0554076d84e09de0a8b0b723d7bdad50fe3b"
    },
    "training_pool_clean": {
      "path": "dataset/v2/training_pool_clean.jsonl",
      "hash": "194cc98fc807287a60d2096345bb08fb68de8d38416b4620203635180b030e98"
    },
    "training_pool_experimental": {
      "path": "dataset/v2/training_pool_experimental.jsonl",
      "hash": "ec9b61d1d3c8efbdc90e2070657d4abf10327d04113752d38cf657a83a01f439"
    },
    "quality_scorecard": {
      "path": "dataset/v2/quality_scorecard.json",
      "hash": "f66bb93d846a77a835afa6584ea6ea15e5d82ca94a0d636f9dc5657e3861e052"
    }
  },
  "metrics": {
    "input_total": 18409,
    "filtered_total": 18327,
    "output_char_filtered_total": 15272,
    "chunked_source_records": 0,
    "chunked_total_records": 15248,
    "rebalanced_total_records": 8771,
    "dropped_test_records": 0,
    "augmented_records": 4005,
    "augmentation_candidate_pool": 5341,
    "source_share_cap_dropped": 4742,
    "final_total": 8034,
    "test_ratio_before_rebalance": 0.4248,
    "test_ratio_after_rebalance": 0.0,
    "split_train": 6427,
    "split_valid": 803,
    "split_test": 804,
    "eval_candidate_pool_size": 6477,
    "exclude_test_sources_from_training_pool": true,
    "exclude_sources_prefixes": [
      "docs/symfony_com/"
    ],
    "yield_breakdown": {
      "input_records": 18409,
      "after_validation_filter": 18327,
      "after_output_char_filter": 15272,
      "after_chunking": 15248,
      "after_test_pool_extraction": 8771,
      "after_augmentation": 8034,
      "rejected_records": 7903
    },
    "feedback_targets": {
      "source": "/home/seutje/projects/DrupalGym/eval/metrics.json",
      "weak_categories": [
        "attributes",
        "sdc",
        "di"
      ],
      "details": [
        {
          "category": "attributes",
          "negative_prompt_count": 1,
          "avg_delta": -0.6
        },
        {
          "category": "sdc",
          "negative_prompt_count": 1,
          "avg_delta": -0.3334
        },
        {
          "category": "di",
          "negative_prompt_count": 1,
          "avg_delta": -0.25
        }
      ]
    },
    "rejection_reasons": {
      "class_interface_mismatch": 52,
      "interface_class_mismatch": 10,
      "trait_class_mismatch": 10,
      "trait_enum_mismatch": 1,
      "class_enum_mismatch": 3,
      "truncation_artifact": 3,
      "class_trait_mismatch": 2,
      "interface_enum_mismatch": 1,
      "max_output_chars": 3055,
      "excluded_source_prefix": 24,
      "augmentation_non_php_source": 3428,
      "augmentation_non_php_output": 2,
      "source_share_cap_drop": 4742
    },
    "sample_type_distribution": {
      "retrieval": 8771,
      "bugfix": 1002,
      "refactor": 1001,
      "write_from_spec": 1001,
      "explain_and_implement": 1001
    },
    "clean_pool_size": 8771,
    "experimental_pool_size": 4005,
    "source_concentration_top10": [
      {
        "source_prefix": "repos/drupal_core",
        "count": 3615,
        "share": 0.45
      },
      {
        "source_prefix": "repos/flowdrop",
        "count": 522,
        "share": 0.065
      },
      {
        "source_prefix": "repos/mcp_tools",
        "count": 467,
        "share": 0.0581
      },
      {
        "source_prefix": "repos/api_normalization",
        "count": 388,
        "share": 0.0483
      },
      {
        "source_prefix": "repos/display_builder",
        "count": 291,
        "share": 0.0362
      },
      {
        "source_prefix": "repos/webprofiler",
        "count": 178,
        "share": 0.0222
      },
      {
        "source_prefix": "docs/www_drupal_org",
        "count": 170,
        "share": 0.0212
      },
      {
        "source_prefix": "repos/eb",
        "count": 148,
        "share": 0.0184
      },
      {
        "source_prefix": "repos/bootstrap_components",
        "count": 122,
        "share": 0.0152
      },
      {
        "source_prefix": "repos/soap_client",
        "count": 96,
        "share": 0.0119
      }
    ],
    "weak_category_coverage": {
      "attributes": 3183,
      "di": 2235,
      "sdc": 2881
    },
    "train_output_percentiles": {
      "p50": 1631,
      "p90": 4488,
      "p95": 5184,
      "p99": 5877
    },
    "quality_scorecard": {
      "dataset_version": "v2",
      "thresholds": {
        "malformed_instruction_class_slot_max": 50,
        "yaml_too_short_share_max": 0.1,
        "drupal_core_train_share_max": 0.45,
        "train_output_p95_max": 9000,
        "weak_category_targets": {
          "attributes": 600,
          "di": 600,
          "sdc": 400
        }
      },
      "metrics": {
        "malformed_instruction_class_slot": 0,
        "yaml_too_short_share": 0.0,
        "drupal_core_train_share": 0.45,
        "train_output_p95": 5184,
        "weak_category_coverage": {
          "attributes": 3183,
          "di": 2235,
          "sdc": 2881
        }
      },
      "checks": {
        "malformed_instruction_class_slot": true,
        "yaml_too_short_share": true,
        "drupal_core_train_share": true,
        "train_output_p95": true,
        "weak_category_coverage": true
      },
      "overall_passed": true
    }
  },
  "config": {
    "input_version": "v1",
    "output_version": "v2",
    "seed": 42,
    "max_output_lines": 300,
    "max_output_chars": 6000,
    "max_source_share": 0.45,
    "chunk_instruction_mode": "metadata_only",
    "weak_category_targets": {
      "attributes": 600,
      "di": 600,
      "sdc": 400
    },
    "chunk_overlap_lines": 30,
    "target_test_ratio": 0.15,
    "exclude_test_sources_from_training_pool": true,
    "exclude_sources_prefixes": [
      "docs/symfony_com/"
    ],
    "augmentation": {
      "enabled": true,
      "ratio": 0.75,
      "input_excerpt_lines": 120,
      "types": [
        "bugfix",
        "refactor",
        "write_from_spec",
        "explain_and_implement"
      ]
    }
  }
}