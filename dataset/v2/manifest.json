{
  "stage": "dataset_refinement",
  "timestamp": "2026-02-08T11:25:51Z",
  "inputs": [
    {
      "name": "v1_train",
      "version": "v1",
      "hash": "27321b07b5b841a8bf238645167be4e0e08eeb4a6a031248718e7e9e516b3a39"
    },
    {
      "name": "v1_valid",
      "version": "v1",
      "hash": "149f05deb2761748a441456f395f1743118abb0103cea840072581560f1c5d14"
    },
    {
      "name": "v1_test",
      "version": "v1",
      "hash": "9f1bf4d81f0df941d4a10a76ba1dcd7adb12db4f87bcef122de841925892cc88"
    }
  ],
  "outputs": {
    "train_split": {
      "path": "dataset/v2/train.jsonl",
      "hash": "bce0e8b91996df1fac3134a352e465d5857cc63e521c958d1c10ce79eab572a1"
    },
    "valid_split": {
      "path": "dataset/v2/valid.jsonl",
      "hash": "a3bdd664050b0ac275dbd3dee1bd43cfcae4812c6434c3fb979e77ca722d382d"
    },
    "test_split": {
      "path": "dataset/v2/test.jsonl",
      "hash": "5196ff2ae432ac297d1c027a9bec43d11b9705453579acb8a6bc3ea18a8b3466"
    },
    "rejected_samples": {
      "path": "dataset/v2/rejected.jsonl",
      "hash": "77783d36ab2cae9dd4ff03b4c42cbe135ff6eeea00a98554c52e3c3bb3967852"
    },
    "eval_candidate_pool": {
      "path": "dataset/v2/eval_candidate_pool.jsonl",
      "hash": "a9fd9617e9acd826afdf8854a3f5fa1a343cecb63c2f78c77cb78305ab8b8076"
    },
    "training_pool_clean": {
      "path": "dataset/v2/training_pool_clean.jsonl",
      "hash": "38b428424f01764a6f8a63366293b5e691b090d69cfdce525cf943c827f1f60a"
    },
    "training_pool_experimental": {
      "path": "dataset/v2/training_pool_experimental.jsonl",
      "hash": "d048a915a63bad71eb0571e0de581d7ed1a90b792dd32bba01c97d3df8fb3bb4"
    },
    "quality_scorecard": {
      "path": "dataset/v2/quality_scorecard.json",
      "hash": "36a9c068133496f019fdee87f3d141f52fd8ca7cd75c99cedffb8baa5512f8bf"
    }
  },
  "metrics": {
    "input_total": 18412,
    "filtered_total": 18330,
    "output_char_filtered_total": 15273,
    "chunked_source_records": 0,
    "chunked_total_records": 15249,
    "rebalanced_total_records": 8771,
    "dropped_test_records": 0,
    "augmented_records": 4005,
    "augmentation_candidate_pool": 5341,
    "source_share_cap_dropped": 4738,
    "final_total": 8038,
    "test_ratio_before_rebalance": 0.4248,
    "test_ratio_after_rebalance": 0.0,
    "split_train": 6429,
    "split_valid": 803,
    "split_test": 806,
    "eval_candidate_pool_size": 6478,
    "exclude_test_sources_from_training_pool": true,
    "exclude_sources_prefixes": [
      "docs/symfony_com/"
    ],
    "yield_breakdown": {
      "input_records": 18412,
      "after_validation_filter": 18330,
      "after_output_char_filter": 15273,
      "after_chunking": 15249,
      "after_test_pool_extraction": 8771,
      "after_augmentation": 8038,
      "rejected_records": 7901
    },
    "feedback_targets": {
      "source": "/home/seutje/projects/DrupalGym/eval/metrics.json",
      "weak_categories": [
        "attributes",
        "sdc",
        "di"
      ],
      "details": [
        {
          "category": "attributes",
          "negative_prompt_count": 1,
          "avg_delta": -0.6
        },
        {
          "category": "sdc",
          "negative_prompt_count": 1,
          "avg_delta": -0.3334
        },
        {
          "category": "di",
          "negative_prompt_count": 1,
          "avg_delta": -0.25
        }
      ]
    },
    "rejection_reasons": {
      "trait_enum_mismatch": 1,
      "interface_class_mismatch": 10,
      "class_interface_mismatch": 52,
      "trait_class_mismatch": 10,
      "class_enum_mismatch": 3,
      "truncation_artifact": 3,
      "class_trait_mismatch": 2,
      "interface_enum_mismatch": 1,
      "max_output_chars": 3057,
      "excluded_source_prefix": 24,
      "augmentation_non_php_source": 3428,
      "augmentation_non_php_output": 2,
      "source_share_cap_drop": 4738
    },
    "sample_type_distribution": {
      "retrieval": 8771,
      "bugfix": 1002,
      "refactor": 1001,
      "write_from_spec": 1001,
      "explain_and_implement": 1001
    },
    "clean_pool_size": 8771,
    "experimental_pool_size": 4005,
    "source_concentration_top10": [
      {
        "source_prefix": "repos/drupal_core",
        "count": 3617,
        "share": 0.45
      },
      {
        "source_prefix": "repos/flowdrop",
        "count": 541,
        "share": 0.0673
      },
      {
        "source_prefix": "repos/mcp_tools",
        "count": 466,
        "share": 0.058
      },
      {
        "source_prefix": "repos/api_normalization",
        "count": 388,
        "share": 0.0483
      },
      {
        "source_prefix": "repos/display_builder",
        "count": 297,
        "share": 0.0369
      },
      {
        "source_prefix": "repos/webprofiler",
        "count": 173,
        "share": 0.0215
      },
      {
        "source_prefix": "docs/www_drupal_org",
        "count": 170,
        "share": 0.0211
      },
      {
        "source_prefix": "repos/eb",
        "count": 140,
        "share": 0.0174
      },
      {
        "source_prefix": "repos/bootstrap_components",
        "count": 121,
        "share": 0.0151
      },
      {
        "source_prefix": "repos/livre",
        "count": 97,
        "share": 0.0121
      }
    ],
    "weak_category_coverage": {
      "attributes": 3249,
      "di": 2255,
      "sdc": 2890
    },
    "train_output_percentiles": {
      "p50": 1669,
      "p90": 4443,
      "p95": 5204,
      "p99": 5835
    },
    "quality_scorecard": {
      "dataset_version": "v2",
      "thresholds": {
        "malformed_instruction_class_slot_max": 50,
        "yaml_too_short_share_max": 0.1,
        "drupal_core_train_share_max": 0.45,
        "train_output_p95_max": 9000,
        "weak_category_targets": {
          "attributes": 600,
          "di": 600,
          "sdc": 400
        }
      },
      "metrics": {
        "malformed_instruction_class_slot": 0,
        "yaml_too_short_share": 0.1413,
        "drupal_core_train_share": 0.45,
        "train_output_p95": 5204,
        "weak_category_coverage": {
          "attributes": 3249,
          "di": 2255,
          "sdc": 2890
        }
      },
      "checks": {
        "malformed_instruction_class_slot": true,
        "yaml_too_short_share": false,
        "drupal_core_train_share": true,
        "train_output_p95": true,
        "weak_category_coverage": true
      },
      "overall_passed": false
    }
  },
  "config": {
    "input_version": "v1",
    "output_version": "v2",
    "seed": 42,
    "max_output_lines": 300,
    "max_output_chars": 6000,
    "max_source_share": 0.45,
    "chunk_instruction_mode": "metadata_only",
    "weak_category_targets": {
      "attributes": 600,
      "di": 600,
      "sdc": 400
    },
    "chunk_overlap_lines": 30,
    "target_test_ratio": 0.15,
    "exclude_test_sources_from_training_pool": true,
    "exclude_sources_prefixes": [
      "docs/symfony_com/"
    ],
    "augmentation": {
      "enabled": true,
      "ratio": 0.75,
      "input_excerpt_lines": 120,
      "types": [
        "bugfix",
        "refactor",
        "write_from_spec",
        "explain_and_implement"
      ]
    }
  }
}