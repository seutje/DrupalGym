{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: File.php\nTarget symbol: class File\nNamespace: Drupal\\file\\Plugin\\views\\wizard\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for File.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\views\\Attribute\\ViewsWizard\n  - Drupal\\views\\Plugin\\views\\wizard\\WizardPluginBase\n- Ensure these methods exist where relevant:\n  - defaultDisplayOptions()", "output": "<?php\n\nnamespace Drupal\\file\\Plugin\\views\\wizard;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsWizard;\nuse Drupal\\views\\Plugin\\views\\wizard\\WizardPluginBase;\n\n/**\n * Tests creating managed files views with the wizard.\n */\n#[ViewsWizard(\n  id: 'file_managed',\n  title: new TranslatableMarkup('Files'),\n  base_table: 'file_managed'\n)]\nclass File extends WizardPluginBase {\n\n  /**\n   * Set the created column.\n   *\n   * @var string\n   */\n  protected $createdColumn = 'created';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defaultDisplayOptions() {\n    $display_options = parent::defaultDisplayOptions();\n\n    // Add permission-based access control.\n    $display_options['access']['type'] = 'perm';\n\n    // Remove the default fields, since we are customizing them here.\n    unset($display_options['fields']);\n\n    /* Field: File: Name */\n    $display_options['fields']['filename']['id'] = 'filename';\n    $display_options['fields']['filename']['table'] = 'file_managed';\n    $display_options['fields']['filename']['field'] = 'filename';\n    $display_options['fields']['filename']['entity_type'] = 'file';\n    $display_options['fields']['filename']['entity_field'] = 'filename';\n    $display_options['fields']['filename']['label'] = '';\n    $display_options['fields']['filename']['alter']['alter_text'] = 0;\n    $display_options['fields']['filename']['alter']['make_link'] = 0;\n    $display_options['fields']['filename']['alter']['absolute'] = 0;\n    $display_options['fields']['filename']['alter']['trim'] = 0;\n    $display_options['fields']['filename']['alter']['word_boundary'] = 0;\n    $display_options['fields']['filename']['alter']['ellipsis'] = 0;\n    $display_options['fields']['filename']['alter']['strip_tags'] = 0;\n    $display_options['fields']['filename']['alter']['html'] = 0;\n    $display_options['fields']['filename']['hide_empty'] = 0;\n    $display_options['fields']['filename']['empty_zero'] = 0;\n    $display_options['fields']['filename']['plugin_id'] = 'field';\n    $display_options['fields']['filename']['type'] = 'file_link';\n\n    return $display_options;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/views/wizard/File.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "File", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: StackedSessionHandlerPass\nSource file: <source_file>\nFile name hint: StackedSessionHandlerPass.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\DependencyInjection\\Compiler;\n\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * Provides a compiler pass for stacked session save handlers.\n */\nclass StackedSessionHandlerPass implements CompilerPassInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ContainerBuilder $container): void {\n\n    if ($container->hasDefinition('session_handler')) {\n      return;\n    }\n\n    $session_handler_proxies = [];\n    $priorities = [];\n\n    foreach ($container->findTaggedServiceIds('session_handler_proxy') as $id => $attributes) {\n      $priorities[$id] = $attributes[0]['priority'] ?? 0;\n      $session_handler_proxies[$id] = $container->getDefinition($id);\n    }\n\n    array_multisort($priorities, SORT_ASC, $session_handler_proxies);\n\n    $decorated_id = 'session_handler.storage';\n    foreach ($session_handler_proxies as $id => $decorator) {\n      // Prepend the inner session handler as first constructor argument.\n      $arguments = $decorator->getArguments();\n      array_unshift($arguments, new Reference($decorated_id));\n      $decorator->setArguments($arguments);\n\n      $decorated_id = $id;\n    }\n\n    $container->setAlias('session_handler', $decorated_id);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\DependencyInjection\\Compiler;\n\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * Provides a compiler pass for stacked session save handlers.\n */\nclass StackedSessionHandlerPass implements CompilerPassInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ContainerBuilder $container): void {\n\n    if ($container->hasDefinition('session_handler')) {\n      return;\n    }\n\n    $session_handler_proxies = [];\n    $priorities = [];\n\n    foreach ($container->findTaggedServiceIds('session_handler_proxy') as $id => $attributes) {\n      $priorities[$id] = $attributes[0]['priority'] ?? 0;\n      $session_handler_proxies[$id] = $container->getDefinition($id);\n    }\n\n    array_multisort($priorities, SORT_ASC, $session_handler_proxies);\n\n    $decorated_id = 'session_handler.storage';\n    foreach ($session_handler_proxies as $id => $decorator) {\n      // Prepend the inner session handler as first constructor argument.\n      $arguments = $decorator->getArguments();\n      array_unshift($arguments, new Reference($decorated_id));\n      $decorator->setArguments($arguments);\n\n      $decorated_id = $id;\n    }\n\n    $container->setAlias('session_handler', $decorated_id);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/DependencyInjection/Compiler/StackedSessionHandlerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StackedSessionHandlerPass", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: QueryParameter.php\nTarget symbol: class QueryParameter\nNamespace: Drupal\\views\\Plugin\\views\\argument_default\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for QueryParameter.\n- Include required imports:\n  - Drupal\\Component\\Utility\\NestedArray\n  - Drupal\\Core\\Cache\\Cache\n  - Drupal\\Core\\Cache\\CacheableDependencyInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\views\\Attribute\\ViewsArgumentDefault\n- Ensure these methods exist where relevant:\n  - buildOptionsForm()\n  - defineOptions()\n  - getArgument()\n  - getCacheContexts()\n  - getCacheMaxAge()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\argument_default;\n\nuse Drupal\\Component\\Utility\\NestedArray;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsArgumentDefault;\n\n/**\n * A query parameter argument default handler.\n *\n * @ingroup views_argument_default_plugins\n */\n#[ViewsArgumentDefault(\n  id: 'query_parameter',\n  title: new TranslatableMarkup('Query parameter'),\n)]\nclass QueryParameter extends ArgumentDefaultPluginBase implements CacheableDependencyInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['query_param'] = ['default' => ''];\n    $options['fallback'] = ['default' => ''];\n    $options['multiple'] = ['default' => 'and'];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['query_param'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Query parameter'),\n      '#description' => $this->t('The query parameter to use.'),\n      '#default_value' => $this->options['query_param'],\n    ];\n    $form['fallback'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Fallback value'),\n      '#description' => $this->t('The fallback value to use when the above query parameter is not present.'),\n      '#default_value' => $this->options['fallback'],\n    ];\n    $form['multiple'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Multiple values'),\n      '#description' => $this->t('Conjunction to use when handling multiple values. E.g. \"?value[0]=a&value[1]=b\".'),\n      '#default_value' => $this->options['multiple'],\n      '#options' => [\n        'and' => $this->t('AND'),\n        'or' => $this->t('OR'),\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getArgument() {\n    $current_request = $this->view->getRequest();\n    // Convert a[b][c][d] into ['a', 'b', 'c', 'd'].\n    $path = array_filter(preg_split('#(\\[|\\]\\[|\\])#', $this->options['query_param']));\n\n    if ($current_request->query->has($path[0])) {\n      $query = $current_request->query->all();\n      $param = NestedArray::getValue($query, $path);\n      if (is_array($param)) {\n        $conjunction = ($this->options['multiple'] == 'and') ? ',' : '+';\n        $param = implode($conjunction, $param);\n      }\n\n      return $param;\n    }\n    else {\n      // Otherwise, use the fixed fallback value.\n      return $this->options['fallback'];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheMaxAge() {\n    return Cache::PERMANENT;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheContexts() {\n    return ['url'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/argument_default/QueryParameter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "QueryParameter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DbLog\nSource file: <source_file>\nFile name hint: DbLog.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\dblog\\Logger;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Database\\Database;\nuse Drupal\\Core\\Database\\DatabaseException;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Drupal\\Core\\Logger\\LogMessageParserInterface;\nuse Drupal\\Core\\Logger\\RfcLoggerTrait;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Logs events in the watchdog database table.\n */\nclass DbLog implements LoggerInterface {\n  use RfcLoggerTrait;\n  use DependencySerializationTrait;\n\n  /**\n   * The dedicated database connection target to use for log entries.\n   */\n  const DEDICATED_DBLOG_CONNECTION_TARGET = 'dedicated_dblog';\n\n  /**\n   * The database connection object.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $connection;\n\n  /**\n   * The message's placeholders parser.\n   *\n   * @var \\Drupal\\Core\\Logger\\LogMessageParserInterface\n   */\n  protected $parser;\n\n  /**\n   * Constructs a DbLog object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection object.\n   * @param \\Drupal\\Core\\Logger\\LogMessageParserInterface $parser\n   *   The parser to use when extracting message variables.\n   */\n  public function __construct(Connection $connection, LogMessageParserInterface $parser) {\n    $this->connection = $connection;\n    $this->parser = $parser;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function log($level, string|\\Stringable $message, array $context = []): void {\n    // Remove backtrace and exception since they may contain an unserializable\n    // variable.\n    unset($context['backtrace'], $context['exception']);\n\n    // Convert PSR3-style messages to \\Drupal\\Component\\Render\\FormattableMarkup\n    // style, so they can be translated too in runtime.\n    $message_placeholders = $this->parser->parseMessagePlaceholders($message, $context);\n\n    try {\n      $this->connection\n        ->insert('watchdog')\n        ->fields([\n          'uid' => $context['uid'],\n          'type' => mb_substr($context['channel'], 0, 64),\n          'message' => $message,\n          'variables' => serialize($message_placeholders),\n          'severity' => $level,\n          'link' => $context['link'],\n          'location' => $context['request_uri'],\n          'referer' => $context['referer'],\n          'hostname' => mb_substr($context['ip'], 0, 128),\n          'timestamp' => $context['timestamp'],\n        ])\n        ->execute();\n    }\n    catch (\\Exception $e) {\n      // When running Drupal on MySQL or MariaDB you can run into several errors\n      // that corrupt the database connection. Some examples for these kind of\n      // errors on the database layer are \"1100 - Table 'xyz' was not locked\n      // with LOCK TABLES\" and \"1153 - Got a packet bigger than\n      // 'max_allowed_packet' bytes\". If such an error happens, the MySQL server\n      // invalidates the connection and answers all further requests in this\n      // connection with \"2006 - MySQL server had gone away\". In that case the\n      // insert statement above results in a database exception. To ensure that\n      // the causal error is written to the log we try once to open a dedicated\n      // connection and write again.\n      if (\n        // Only handle database related exceptions.\n        ($e instanceof DatabaseException || $e instanceof \\PDOException) &&\n        // Avoid an endless loop of re-write attempts.\n        $this->connection->getTarget() != self::DEDICATED_DBLOG_CONNECTION_TARGET\n      ) {\n        // Open a dedicated connection for logging.\n        $key = $this->connection->getKey();\n        $info = Database::getConnectionInfo($key);\n        Database::addConnectionInfo($key, self::DEDICATED_DBLOG_CONNECTION_TARGET, $info['default']);\n        $this->connection = Database::getConnection(self::DEDICATED_DBLOG_CONNECTION_TARGET, $key);\n        // Now try once to log the error again.\n        $this->log($level, $message, $context);\n      }\n      else {\n        throw $e;\n      }\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\dblog\\Logger;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Database\\Database;\nuse Drupal\\Core\\Database\\DatabaseException;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Drupal\\Core\\Logger\\LogMessageParserInterface;\nuse Drupal\\Core\\Logger\\RfcLoggerTrait;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Logs events in the watchdog database table.\n */\nclass DbLog implements LoggerInterface {\n  use RfcLoggerTrait;\n  use DependencySerializationTrait;\n\n  /**\n   * The dedicated database connection target to use for log entries.\n   */\n  const DEDICATED_DBLOG_CONNECTION_TARGET = 'dedicated_dblog';\n\n  /**\n   * The database connection object.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $connection;\n\n  /**\n   * The message's placeholders parser.\n   *\n   * @var \\Drupal\\Core\\Logger\\LogMessageParserInterface\n   */\n  protected $parser;\n\n  /**\n   * Constructs a DbLog object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection object.\n   * @param \\Drupal\\Core\\Logger\\LogMessageParserInterface $parser\n   *   The parser to use when extracting message variables.\n   */\n  public function __construct(Connection $connection, LogMessageParserInterface $parser) {\n    $this->connection = $connection;\n    $this->parser = $parser;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function log($level, string|\\Stringable $message, array $context = []): void {\n    // Remove backtrace and exception since they may contain an unserializable\n    // variable.\n    unset($context['backtrace'], $context['exception']);\n\n    // Convert PSR3-style messages to \\Drupal\\Component\\Render\\FormattableMarkup\n    // style, so they can be translated too in runtime.\n    $message_placeholders = $this->parser->parseMessagePlaceholders($message, $context);\n\n    try {\n      $this->connection\n        ->insert('watchdog')\n        ->fields([\n          'uid' => $context['uid'],\n          'type' => mb_substr($context['channel'], 0, 64),\n          'message' => $message,\n          'variables' => serialize($message_placeholders),\n          'severity' => $level,\n          'link' => $context['link'],\n          'location' => $context['request_uri'],\n          'referer' => $context['referer'],\n          'hostname' => mb_substr($context['ip'], 0, 128),\n          'timestamp' => $context['timestamp'],\n        ])\n        ->execute();\n    }\n    catch (\\Exception $e) {\n      // When running Drupal on MySQL or MariaDB you can run into several errors\n      // that corrupt the database connection. Some examples for these kind of\n      // errors on the database layer are \"1100 - Table 'xyz' was not locked\n      // with LOCK TABLES\" and \"1153 - Got a packet bigger than\n      // 'max_allowed_packet' bytes\". If such an error happens, the MySQL server\n      // invalidates the connection and answers all further requests in this\n      // connection with \"2006 - MySQL server had gone away\". In that case the\n      // insert statement above results in a database exception. To ensure that\n      // the causal error is written to the log we try once to open a dedicated\n      // connection and write again.\n      if (\n        // Only handle database related exceptions.\n        ($e instanceof DatabaseException || $e instanceof \\PDOException) &&\n        // Avoid an endless loop of re-write attempts.\n        $this->connection->getTarget() != self::DEDICATED_DBLOG_CONNECTION_TARGET\n      ) {\n        // Open a dedicated connection for logging.\n        $key = $this->connection->getKey();\n        $info = Database::getConnectionInfo($key);\n        Database::addConnectionInfo($key, self::DEDICATED_DBLOG_CONNECTION_TARGET, $info['default']);\n        $this->connection = Database::getConnection(self::DEDICATED_DBLOG_CONNECTION_TARGET, $key);\n        // Now try once to log the error again.\n        $this->log($level, $message, $context);\n      }\n      else {\n        throw $e;\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/dblog/src/Logger/DbLog.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DbLog", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"(Navbar nav)\"\ndescription: \"Internal: to be used in the 'Navbar' component.\"\ngroup: Navbar\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/components/navbar/\"\nvariants:\n  default:\n    title: Default\n  scroll:\n    title: Scroll\nprops:\n  type: object\n  properties:\n    dropdown_id:\n      title: ID\n      description: \"Must start with a letter. Randomly generated if empty.\"\n      type: string\n    items:\n      title: \"Menu items\"\n      description: \"Full-height and lightweight navigation (including support for dropdowns).\"\n      type: array\n    attributes:\n      title: \"HTML attributes\"\n      description: \"Arbitrary HTML attributes for the <ul> container (class can be an array or string).\"\n      type: object\n      additionalProperties: true\n      properties:\n        class:\n          type: array\n          items:\n            type: string\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/navbar_nav/navbar_nav.component.yml", "type": "yaml_reference", "topic": "navbar nav.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "announcements_feed.announcement:\n  path: '/admin/announcements_feed'\n  defaults:\n    _controller: '\\Drupal\\announcements_feed\\Controller\\AnnounceController::getAnnouncements'\n    _title: 'Community announcements'\n  requirements:\n    _permission: 'access announcements'\n", "metadata": {"source": "repos/drupal_core/core/modules/announcements_feed/announcements_feed.routing.yml", "type": "yaml_reference", "topic": "announcements feed.routing"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Accessibility", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Getting started](/docs/getting-started)\n\n* [System requirements](/docs/getting-started/system-requirements)\n* [Installing Drupal](/docs/getting-started/installing-drupal)\n* [Accessibility](/docs/getting-started/accessibility)\n* [Understanding Drupal](/docs/getting-started/understanding-drupal)\n* [Umami: Drupal demonstration installation profile](/docs/getting-started/umami-drupal-demonstration-installation-profile)\n* [Distributions](/docs/getting-started/drupal-distributions)\n* [Multisite Drupal](/docs/getting-started/multisite-drupal)\n* [Sustainability](/docs/getting-started/sustainability)\n\n# Accessibility\n\nAccessibility best practices in Drupal.\n\n## [Drupal Accessibility Features](/docs/accessibility/drupal-accessibility-features)\n\nDrupal provides advanced accessibility features to help different groups of users.\n\n## [Contributed Modules for Extending Accessibility in Drupal](/docs/getting-started/accessibility/contributed-modules-for-extending-accessibility-in-drupal)\n\nList of modules that have accessibility benefits in Drupal\n\n## [How to Ensure Your Contribution is Accessible](/docs/getting-started/accessibility/how-to-ensure-your-contribution-is-accessible)\n\nAccessibility is most efficiently and elegantly achieved when it is part of the process all the way through, from concept to release.\n\n## [How to do an accessibility review?](/docs/getting-started/accessibility/how-to-do-an-accessibility-review)\n\nThis documentation provides a step by step process for reviewing the accessibility of your module theme or site.\n\n## [External Accessibility Resources](/docs/accessibility/external-accessibility-resources)\n\nList of additional websites, tools, and other resources for accessibility.\n\n## [Drupal Accessibility (a11y) Office Hours](/docs/getting-started/accessibility/drupal-accessibility-a11y-office-hours)\n\nThe Accessibility Topic Maintainers host live office hours, 3rd Thursday of every month at 5pm PT (but trying a different time for July!)\n\n## [Hide Content Properly](/docs/getting-started/accessibility/hide-content-properly)\n\nThis page covers major techniques for hiding content for all users and users with screen readers.\n\n## [Accessibility Conformance Report (ACR) Process](/docs/getting-started/accessibility/accessibility-conformance-report-acr-process)\n\nThe Drupal developers are often asked for an Accessibility Conformance Report (often referred to a VPAT). This is our approach.\n\n## Guide maintainers\n\n[![bnjmnm's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-2369194-1686065666.jpg?itok=odNqT1--)](/user/2369194 \"View bnjmnm's profile\")\n\n[![mgifford's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-27930-1682272704.jpg?itok=W_lUw-wS)](/user/27930 \"View mgifford's profile\")\n\n[![andrewmacpherson's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-265648-1403128753.jpg?itok=G6jMBTqy)](/user/265648 \"View andrewmacpherson's profile\")\n\n[![rainbreaw's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-525170-1570804221.jpg?itok=PKtDFOKA)](/user/525170 \"View rainbreaw's profile\")\n\n[![cehfisher's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-731798-1699462525.jpg?itok=k-n0uf6w)](/user/731798 \"View cehfisher's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/accessibility.md", "type": "doc_summary", "topic": "Accessibility"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Example\nslots:\n  content:\n    - type: component\n      component: 'display_builder:placeholder'\n      story: button\n    - type: component\n      component: 'display_builder:placeholder'\n      story: button\n    - type: component\n      component: 'display_builder:placeholder'\n      story: button\n    - type: component\n      component: 'display_builder:placeholder'\n      story: button\n    - type: component\n      component: 'display_builder:placeholder'\n      story: button\nprops:\n  title: Lorem ipsum\n", "metadata": {"source": "repos/display_builder/components/draggables/draggables.default.story.yml", "type": "yaml_reference", "topic": "draggables.default.story"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: TokenBrowserHooks.php\nTarget symbol: class TokenBrowserHooks\nNamespace: Drupal\\token_browser\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TokenBrowserHooks.\n- Include required imports:\n  - Drupal\\Core\\Render\\RendererInterface\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\Utility\\Token\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n  - Drupal\\token_browser\\TokenBrowserTreeBuilderInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - help()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\token_browser\\Hook;\n\nuse Drupal\\Core\\Render\\RendererInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Utility\\Token;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\token_browser\\TokenBrowserTreeBuilderInterface;\n\n/**\n * Hook implementations for token_browser.\n */\nfinal class TokenBrowserHooks {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly Token $token,\n    protected readonly TokenBrowserTreeBuilderInterface $treeBuilder,\n    protected readonly RendererInterface $renderer,\n  ) {\n  }\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?array {\n    if ($route_name == 'help.page.token_browser') {\n      $token_tree = $this->treeBuilder->buildAllRenderable([\n        'click_insert' => FALSE,\n        'show_restricted' => TRUE,\n        'show_nested' => FALSE,\n        'recursion_limit' => 1,\n      ]);\n\n      $output = '<h3>' . $this->t('About') . '</h3>';\n      $output .= '<p>' . $this->t('The <a href=\":project\">Token browser</a> module provides a user interface for the site token system. Tokens are specially formatted chunks of text that serve as placeholders for a dynamically generated value. For more information, covering both the token system and the additional tools provided by the Token module, see the <a href=\":online\">online documentation</a>.', [\n        ':online' => 'https://www.drupal.org/documentation/modules/token',\n        ':project' => 'https://www.drupal.org/project/token',\n      ]) . '</p>';\n      $output .= '<h3>' . $this->t('Uses') . '</h3>';\n      $output .= '<p>' . $this->t('Your website uses a shared token system for exposing and using placeholder tokens and their appropriate replacement values. This allows for any module to provide placeholder tokens for strings without having to reinvent the wheel. It also ensures consistency in the syntax used for tokens, making the system as a whole easier for end users to use.') . '</p>';\n      $output .= '<p>' . $this->t('The list of the currently available tokens on this site are shown below.') . '</p>';\n\n      return [\n        '#type' => 'container',\n        '#markup' => $output,\n        'table' => $token_tree,\n      ];\n    }\n\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/token_browser/src/Hook/TokenBrowserHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TokenBrowserHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: LanguageContentSettings\nSource file: <source_file>\nFile name hint: LanguageContentSettings.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\language\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\DrupalSqlBase;\n\n/**\n * Drupal 7 i18n node settings from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBas\n *\n * @MigrateSource(\n *   id = \"d7_language_content_settings\",\n *   source_module = \"locale\"\n * )\n */\nclass LanguageContentSettings extends DrupalSqlBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function query() {\n    return $this->select('node_type', 't')\n      ->fields('t', [\n        'type',\n      ]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = [\n      'type' => $this->t('Type'),\n      'language_content_type' => $this->t('Multilingual support.'),\n      'i18n_lock_node' => $this->t('Lock language.'),\n    ];\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    $type = $row->getSourceProperty('type');\n    $row->setSourceProperty('language_content_type', $this->variableGet('language_content_type_' . $type, NULL));\n    $i18n_node_options = $this->variableGet('i18n_node_options_' . $type, NULL);\n    if ($i18n_node_options && in_array('lock', $i18n_node_options)) {\n      $row->setSourceProperty('i18n_lock_node', 1);\n    }\n    else {\n      $row->setSourceProperty('i18n_lock_node', 0);\n    }\n\n    // Get the entity translation entity settings.\n    $entity_translation_entity_types = $this->variableGet('entity_translation_entity_types', NULL);\n    $row->setSourceProperty('entity_translation_entity_types', $entity_translation_entity_types);\n    return parent::prepareRow($row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['type']['type'] = 'string';\n    return $ids;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\language\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\DrupalSqlBase;\n\n/**\n * Drupal 7 i18n node settings from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBas\n *\n * @MigrateSource(\n *   id = \"d7_language_content_settings\",\n *   source_module = \"locale\"\n * )\n */\nclass LanguageContentSettings extends DrupalSqlBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    return $this->select('node_type', 't')\n      ->fields('t', [\n        'type',\n      ]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    $fields = [\n      'type' => $this->t('Type'),\n      'language_content_type' => $this->t('Multilingual support.'),\n      'i18n_lock_node' => $this->t('Lock language.'),\n    ];\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    $type = $row->getSourceProperty('type');\n    $row->setSourceProperty('language_content_type', $this->variableGet('language_content_type_' . $type, NULL));\n    $i18n_node_options = $this->variableGet('i18n_node_options_' . $type, NULL);\n    if ($i18n_node_options && in_array('lock', $i18n_node_options)) {\n      $row->setSourceProperty('i18n_lock_node', 1);\n    }\n    else {\n      $row->setSourceProperty('i18n_lock_node', 0);\n    }\n\n    // Get the entity translation entity settings.\n    $entity_translation_entity_types = $this->variableGet('entity_translation_entity_types', NULL);\n    $row->setSourceProperty('entity_translation_entity_types', $entity_translation_entity_types);\n    return parent::prepareRow($row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['type']['type'] = 'string';\n    return $ids;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/language/src/Plugin/migrate/source/d7/LanguageContentSettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageContentSettings", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer http drush wrapper:\n  title: 'Administer HTTP Drush Wrapper configuration'\n  restrict access: true\n", "metadata": {"source": "repos/http_drush_wrapper/http_drush_wrapper.permissions.yml", "type": "yaml_reference", "topic": "http drush wrapper.permissions"}}
{"instruction": "Show me the implementation of the class FilterD2 in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\d2_filter\\Plugin\\Filter;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\d2\\D2Helper;\nuse Drupal\\filter\\FilterProcessResult;\nuse Drupal\\filter\\Plugin\\FilterBase;\n\n/**\n * @Filter(\n *   id = \"filter_d2\",\n *   title = @Translation(\"D2 Filter\"),\n *   description = @Translation(\"Render D2 diagrams.\"),\n *   type = Drupal\\filter\\Plugin\\FilterInterface::TYPE_TRANSFORM_IRREVERSIBLE,\n *   weight = -10,\n * )\n */\nclass FilterD2 extends FilterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process($text, $langcode) {\n    // Replace content of the [d2] blocks.\n    $text = preg_replace_callback('@\\[d2\\](.+?)\\[/d2\\]@s', function(array $matches) {\n      return self::processD2($matches[1]);\n    }, $text);\n\n    return new FilterProcessResult($text);\n  }\n\n  /**\n   * Callback to process a single [d2] block.\n   */\n  public function processD2($text) {\n    return (new D2Helper())->getSvg($text);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function tips($long = FALSE) {\n    return self::help($long);\n  }\n\n  /**\n   * Provide help text.\n   */\n  static function help($long = FALSE) {\n    if ($long) {\n      return 'With <a href=\"https://d2lang.com\" target=\"_blank\" rel=\"noopener noreferrer\">D2</a> you can create inline diagrams:<br/>'\n          . '<code>[d2]<br/>direction: right<br/>&nbsp;&nbsp;Alice -> Bob<br/>[/d2]<br/></code>'\n          . 'For more info, see <a href=\"http://drupal.org/project/d2\">D2: Declarative Diagramming</a>.';\n    }\n    else {\n      return 'Use <a href=\"https://d2lang.com\" target=\"_blank\" rel=\"noopener noreferrer\">D2</a> to generate an inline diagram.';\n    }\n  }\n\n}\n", "metadata": {"source": "repos/d2/modules/d2_filter/src/Plugin/Filter/FilterD2.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FilterD2", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.field.media.remote_video.field_media_oembed_video\n    - media.type.remote_video\n  module:\n    - media\n    - path\nid: media.remote_video.default\ntargetEntityType: media\nbundle: remote_video\nmode: default\ncontent:\n  created:\n    type: datetime_timestamp\n    weight: 10\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  field_media_oembed_video:\n    type: oembed_textfield\n    weight: 0\n    region: content\n    settings:\n      size: 60\n      placeholder: ''\n    third_party_settings: {  }\n  langcode:\n    type: language_select\n    weight: 2\n    region: content\n    settings:\n      include_locked: true\n    third_party_settings: {  }\n  path:\n    type: path\n    weight: 30\n    region: content\n    settings: {  }\n    third_party_settings: {  }\n  status:\n    type: boolean_checkbox\n    weight: 100\n    region: content\n    settings:\n      display_label: true\n    third_party_settings: {  }\n  uid:\n    type: entity_reference_autocomplete\n    weight: 4\n    region: content\n    settings:\n      match_operator: CONTAINS\n      match_limit: 10\n      size: 60\n      placeholder: ''\n    third_party_settings: {  }\nhidden:\n  moderation_state: true\n  name: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_form_display.media.remote_video.default.yml", "type": "yaml_reference", "topic": "core.entity form display.media.remote video.default"}}
{"instruction": "Show me the implementation of the class AddRoleUser in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\Action;\n\nuse Drupal\\Core\\Action\\Attribute\\Action;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Adds a role to a user.\n */\n#[Action(\n  id: 'user_add_role_action',\n  label: new TranslatableMarkup('Add a role to the selected users'),\n  type: 'user'\n)]\nclass AddRoleUser extends ChangeUserRoleBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute($account = NULL) {\n    $rid = $this->configuration['rid'];\n    // Skip adding the role to the user if they already have it.\n    if ($account !== FALSE && !$account->hasRole($rid)) {\n      // For efficiency manually save the original account before applying\n      // any changes.\n      $account->setOriginal(clone $account);\n      $account->addRole($rid)->save();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/Action/AddRoleUser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AddRoleUser", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Installation Guide", "input": "", "output": "# Installation Guide\n\n**Module**: API Normalization\n**Version**: 2.x\n**Drupal**: 11.x\n\n---\n\n## Prerequisites\n\n- Drupal 11.x\n- PHP 8.3 or higher\n- Composer\n- Drush 12.x or higher\n\n### Optional Dependencies\n\n- **ECA Module**: For workflow automation\n- **FlowDrop Module**: For visual workflow builder\n- **AI Module**: For AI-powered features\n- **AI Agents Module**: For agent integration\n- **ECK Module**: For entity type creation\n\n---\n\n## Installation Methods\n\n### Method 1: Composer (Recommended)\n\n```bash\ncomposer require drupal/api_normalization\ndrush en api_normalization\ndrush cr\n```\n\n### Method 2: Manual Installation\n\n1. Download the module to `modules/custom/api_normalization`\n2. Enable via Drush:\n   ```bash\n   drush en api_normalization\n   drush cr\n   ```\n3. Or enable via UI: `/admin/modules`\n\n---\n\n## Post-Installation\n\n### 1. Verify Installation\n\n```bash\ndrush api-normalization:status\n```\n\n### 2. Configure Settings\n\nNavigate to `/admin/config/services/api_normalization` or use Drush:\n\n```bash\ndrush config:set api_normalization.settings cache_enabled true\ndrush config:set api_normalization.settings rate_limit_enabled true\n```\n\n### 3. Import OpenAPI Schema (Optional)\n\n```bash\ndrush api-normalization:import-schema /path/to/openapi.yaml\n```\n\n---\n\n## Configuration\n\nSee [Configuration Guide](./configuration.md) for detailed configuration options.\n\n### Quick Configuration\n\n```bash\n# Enable caching\ndrush config:set api_normalization.settings cache_enabled true\n\n# Set rate limit\ndrush config:set api_normalization.settings rate_limit 100\n\n# Configure API gateway\ndrush config:set api_normalization.settings api_gateway_url \"https://api.example.com\"\n```\n\n---\n\n## Troubleshooting\n\n### Module Not Found\n\n- Verify module is in `modules/custom/api_normalization`\n- Run `composer dump-autoload`\n- Clear cache: `drush cr`\n\n### Missing Dependencies\n\n- Run `composer install` to install dependencies\n- Check PHP version: `php -v` (must be 8.3+)\n\n### Permissions Issues\n\n- Ensure web server can write to `sites/default/files`\n- Check file permissions: `drush status`\n\nSee [Troubleshooting Guide](./troubleshooting.md) for more help.\n\n---\n\n## Next Steps\n\n- [Getting Started](./gettingStarted.md) - Quick start guide\n- [User Guide](./userGuide.md) - Complete user documentation\n- [Examples](./examples.md) - Real-world examples\n", "metadata": {"source": "repos/api_normalization/docs/installation.md", "type": "doc_summary", "topic": "Installation Guide"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: zefix\ntype: module\ndescription: Zugriff auf die Zefix API\npackage: 'Development'\ncore_version_requirement: ^8 || ^9 || ^10 || ^11\n", "metadata": {"source": "repos/zefix/zefix.info.yml", "type": "yaml_reference", "topic": "zefix.info"}}
{"instruction": "Show me the implementation of the class ApiRequestProcessor in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Drupal\\api_normalization\\Event\\ApiResponseEvent;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\nuse Psr\\Log\\LoggerInterface;\nuse Drupal\\api_normalization\\Service\\ApiClient;\n\n/**\n * Processes queued API requests.\n *\n * @QueueWorker(\n *   id = \"api_normalization_requests\",\n *   title = @Translation(\"API Request Processor\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass ApiRequestProcessor extends QueueWorkerBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * Constructs a new ApiRequestProcessor.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    protected ApiClient $apiClient,\n    protected EventDispatcherInterface $eventDispatcher,\n    protected LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('api_normalization.api_client'),\n      $container->get('event_dispatcher'),\n      $container->get('logger.factory')->get('api_normalization'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    $start_time = microtime(TRUE);\n\n    try {\n      $response = $this->apiClient->request(\n        $data['method'],\n        $data['endpoint'],\n        $data['data'] ?? []\n      );\n\n      $response_time = microtime(TRUE) - $start_time;\n\n      $event = new ApiResponseEvent(\n        provider: $data['provider'] ?? 'unknown',\n        statusCode: $response['status_code'] ?? 200,\n        responseData: $response['data'] ?? [],\n        endpoint: $data['endpoint'],\n        requestData: $data['data'] ?? NULL,\n        responseTime: $response_time,\n      );\n\n      $this->eventDispatcher->dispatch($event, ApiResponseEvent::RESPONSE_RECEIVED);\n\n      $this->logger->info('Processed API request: @endpoint in @time seconds', [\n        '@endpoint' => $data['endpoint'],\n        '@time' => number_format($response_time, 3),\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process API request: @message', [\n        '@message' => $e->getMessage(),\n      ]);\n\n      $event = new ApiResponseEvent(\n        provider: $data['provider'] ?? 'unknown',\n        statusCode: 500,\n        responseData: ['error' => $e->getMessage()],\n        endpoint: $data['endpoint'],\n        requestData: $data['data'] ?? NULL,\n      );\n\n      $this->eventDispatcher->dispatch($event, ApiResponseEvent::REQUEST_FAILED);\n\n      throw $e;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/QueueWorker/ApiRequestProcessor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiRequestProcessor", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ViewsRelationship in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\views\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\PluginID;\n\n/**\n * Defines a Plugin attribute class for views relationship handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\relationship\\RelationshipPluginBase\n *\n * @ingroup views_relationship_handlers\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass ViewsRelationship extends PluginID {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Attribute/ViewsRelationship.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsRelationship", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class StatusReport in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Extension\\Requirement\\RequirementSeverity;\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\n\n/**\n * Creates status report page element.\n */\n#[RenderElement('status_report')]\nclass StatusReport extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#theme' => 'status_report_grouped',\n      '#priorities' => [\n        'error',\n        'warning',\n        'checked',\n        'ok',\n      ],\n      '#pre_render' => [\n        [static::class, 'preRenderGroupRequirements'],\n      ],\n    ];\n  }\n\n  /**\n   * Render API callback: Groups requirements.\n   *\n   * This function is assigned as a #pre_render callback.\n   */\n  public static function preRenderGroupRequirements($element) {\n    $grouped_requirements = [];\n    RequirementSeverity::convertLegacyIntSeveritiesToEnums($element['#requirements'], __METHOD__);\n    /** @var array{title: \\Drupal\\Core\\StringTranslation\\TranslatableMarkup, value: mixed, description: \\Drupal\\Core\\StringTranslation\\TranslatableMarkup, severity: \\Drupal\\Core\\Extension\\Requirement\\RequirementSeverity} $requirement */\n    foreach ($element['#requirements'] as $key => $requirement) {\n      $severity = RequirementSeverity::Info;\n      if (isset($requirement['severity'])) {\n        $severity = $requirement['severity'] === RequirementSeverity::OK ? RequirementSeverity::Info : $requirement['severity'];\n      }\n      elseif (defined('MAINTENANCE_MODE') && MAINTENANCE_MODE == 'install') {\n        $severity = RequirementSeverity::OK;\n      }\n\n      $grouped_requirements[$severity->status()]['title'] = $severity->title();\n      $grouped_requirements[$severity->status()]['type'] = $severity->status();\n      $grouped_requirements[$severity->status()]['items'][$key] = $requirement;\n    }\n\n    // Order the grouped requirements by a set order.\n    $order = array_flip($element['#priorities']);\n    uksort($grouped_requirements, function ($a, $b) use ($order) {\n      return $order[$a] <=> $order[$b];\n    });\n\n    $element['#grouped_requirements'] = $grouped_requirements;\n\n    return $element;\n  }\n\n  /**\n   * Gets the severities.\n   *\n   * @return array\n   *   An associative array of the requirements severities. The keys are the\n   *   requirement constants defined in install.inc.\n   *\n   * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. There is no\n   *   replacement.\n   *\n   * @see https://www.drupal.org/node/3410939\n   */\n  public static function getSeverities() {\n    @trigger_error('Calling ' . __METHOD__ . '() is deprecated in drupal:11.2.0 and is removed from in drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3410939', \\E_USER_DEPRECATED);\n    return [\n      RequirementSeverity::Info->value => [\n        'title' => t('Checked', [], ['context' => 'Examined']),\n        'status' => 'checked',\n      ],\n      RequirementSeverity::OK->value => [\n        'title' => t('OK'),\n        'status' => 'ok',\n      ],\n      RequirementSeverity::Warning->value => [\n        'title' => t('Warnings found'),\n        'status' => 'warning',\n      ],\n      RequirementSeverity::Error->value => [\n        'title' => t('Errors found'),\n        'status' => 'error',\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/StatusReport.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StatusReport", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DatabaseEvent\nSource file: <source_file>\nFile name hint: DatabaseEvent.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Database\\Event;\n\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Represents a database event.\n */\nabstract class DatabaseEvent extends Event {\n\n  /**\n   * The time of the event.\n   */\n  public readonly float $time;\n\n  /**\n   * Constructs a DatabaseEvent object.\n   */\n  function __construct() {\n    $this->time = microtime(TRUE);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Event;\n\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Represents a database event.\n */\nabstract class DatabaseEvent extends Event {\n\n  /**\n   * The time of the event.\n   */\n  public readonly float $time;\n\n  /**\n   * Constructs a DatabaseEvent object.\n   */\n  public function __construct() {\n    $this->time = microtime(TRUE);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Event/DatabaseEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatabaseEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: PhpassHooks.php\nTarget symbol: class PhpassHooks\nNamespace: Drupal\\phpass\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for PhpassHooks.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n- Ensure these methods exist where relevant:\n  - formSystemModulesUninstallConfirmFormAlter()\n  - help()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\phpass\\Hook;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for phpass.\n */\nclass PhpassHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.phpass':\n        $output = '';\n        $output .= '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The Password Compatibility module provides the password checking algorithm for user accounts created with Drupal prior to version 10.1.0. For more information, see the <a href=\":phpass\">online documentation for the Password Compatibility module</a>.', [\n          ':phpass' => 'https://www.drupal.org/docs/core-modules-and-themes/core-modules/password-compatibility-module',\n        ]) . '</p>';\n        $output .= '<p>' . $this->t('Drupal 10.1.0 and later use a different algorithm to compute the hashed password. This provides better security against brute-force attacks. The hashed passwords are different from the ones computed with Drupal versions before 10.1.0.') . '</p>';\n        $output .= '<p>' . $this->t('When the Password Compatibility module is installed, a user can log in with a username and password created before Drupal 10.1.0. The first time these credentials are used, a new hash is computed and saved. From then on, the user will be able to log in with the same username and password whether or not this module is installed.') . '</p>';\n        $output .= '<p>' . $this->t('Passwords created before Drupal 10.1.0 <strong>will not work</strong> unless they are used at least once while this module is installed. Make sure that you can log in before uninstalling this module.') . '</p>';\n        return $output;\n    }\n    return NULL;\n  }\n\n  /**\n   * Implements hook_form_FORM_ID_alter() for system_modules_uninstall_confirm_form.\n   */\n  #[Hook('form_system_modules_uninstall_confirm_form_alter')]\n  public function formSystemModulesUninstallConfirmFormAlter(array &$form, FormStateInterface $form_state) : void {\n    $modules = \\Drupal::keyValueExpirable('modules_uninstall')->get(\\Drupal::currentUser()->id());\n    if (!in_array('phpass', $modules)) {\n      return;\n    }\n    \\Drupal::messenger()->addWarning($this->t('Make sure that you can log in before uninstalling the Password Compatibility module. For more information, see the <a href=\":phpass\">online documentation for the Password Compatibility module</a>.', [\n      ':phpass' => 'https://www.drupal.org/docs/core-modules-and-themes/core-modules/password-compatibility-module',\n    ]));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/phpass/src/Hook/PhpassHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PhpassHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FileEncodingConstraint\nSource file: <source_file>\nFile name hint: FileEncodingConstraint.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Defines an encoding constraint for files.\n */\n#[Constraint(\n  id: 'FileEncoding',\n  label: new TranslatableMarkup('File encoding', [], ['context' => 'Validation'])\n)]\nclass FileEncodingConstraint extends SymfonyConstraint {\n\n  /**\n   * The allowed file encodings.\n   *\n   * @var array\n   */\n  public array $encodings;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?array $encodings = NULL,\n    public string $message = \"The file is encoded with %detected. It must be encoded with %encoding\",\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->encodings = $encodings ?? $this->encodings;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Defines an encoding constraint for files.\n */\n#[Constraint(\n  id: 'FileEncoding',\n  label: new TranslatableMarkup('File encoding', [], ['context' => 'Validation'])\n)]\nclass FileEncodingConstraint extends SymfonyConstraint {\n\n  /**\n   * The allowed file encodings.\n   *\n   * @var array\n   */\n  public array $encodings;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?array $encodings = NULL,\n    public string $message = \"The file is encoded with %detected. It must be encoded with %encoding\",\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->encodings = $encodings ?? $this->encodings;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Validation/Constraint/FileEncodingConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileEncodingConstraint", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the interface StateTransitionValidationInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\content_moderation;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\workflows\\StateInterface;\nuse Drupal\\workflows\\WorkflowInterface;\n\n/**\n * Validates whether a certain state transition is allowed.\n */\ninterface StateTransitionValidationInterface {\n\n  /**\n   * Gets a list of transitions that are legal for this user on this entity.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity to be transitioned.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $user\n   *   The account that wants to perform a transition.\n   *\n   * @return \\Drupal\\workflows\\Transition[]\n   *   The list of transitions that are legal for this user on this entity.\n   */\n  public function getValidTransitions(ContentEntityInterface $entity, AccountInterface $user);\n\n  /**\n   * Checks if a transition between two states if valid for the given user.\n   *\n   * @param \\Drupal\\workflows\\WorkflowInterface $workflow\n   *   The workflow entity.\n   * @param \\Drupal\\workflows\\StateInterface $original_state\n   *   The original workflow state.\n   * @param \\Drupal\\workflows\\StateInterface $new_state\n   *   The new workflow state.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $user\n   *   The user to validate.\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity to be transitioned.\n   *\n   * @return bool\n   *   Returns TRUE if transition is valid, otherwise FALSE.\n   */\n  public function isTransitionValid(WorkflowInterface $workflow, StateInterface $original_state, StateInterface $new_state, AccountInterface $user, ContentEntityInterface $entity);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_moderation/src/StateTransitionValidationInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "StateTransitionValidationInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: TransactionTokenAccessCheck.php\nTarget symbol: class for\nNamespace: Drupal\\nexi_xpay\\Access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface\n  - Symfony\\Component\\HttpFoundation\\Request\n- Ensure these methods exist where relevant:\n  - access()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Defines a class for performing access checks based on a transaction token.\n *\n * This class provides a static method for verifying if an incoming request\n * contains a valid token. The check involves verifying the presence\n * of the token, matching it against the expected hashed value,\n * and ensuring it has not expired.\n *\n *\n * Usage of this class ensures secure access control to resources linked\n * to a transaction in systems like Nexi XPay.\n */\nfinal class TransactionTokenAccessCheck {\n\n  /**\n   * Custom access callback for the transaction route.\n   */\n  public static function access(AccountInterface $account, NexiXpayTransactionInterface $nexi_xpay_transaction, Request $request): AccessResult {\n    $token = (string) $request->query->get('t', '');\n    if ($token === '') {\n      return AccessResult::forbidden('Missing token.')->setCacheMaxAge(0);\n    }\n\n    $hash = $nexi_xpay_transaction->getPublicTokenHash();\n    if (!$hash) {\n      return AccessResult::forbidden('Token not configured.')->setCacheMaxAge(0);\n    }\n\n    $expires = $nexi_xpay_transaction->getTokenExpiresTime();\n    if ($expires !== NULL && \\time() > $expires) {\n      return AccessResult::forbidden('Token expired.')->setCacheMaxAge(0);\n    }\n\n    $calc = hash('sha256', $token);\n    if (!hash_equals($hash, $calc)) {\n      return AccessResult::forbidden('Invalid token.')->setCacheMaxAge(0);\n    }\n\n    return AccessResult::allowed()->setCacheMaxAge(0);\n  }\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Access/TransactionTokenAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TransactionTokenAccessCheck", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class StackedSessionHandlerPass in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\DependencyInjection\\Compiler;\n\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * Provides a compiler pass for stacked session save handlers.\n */\nclass StackedSessionHandlerPass implements CompilerPassInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ContainerBuilder $container): void {\n\n    if ($container->hasDefinition('session_handler')) {\n      return;\n    }\n\n    $session_handler_proxies = [];\n    $priorities = [];\n\n    foreach ($container->findTaggedServiceIds('session_handler_proxy') as $id => $attributes) {\n      $priorities[$id] = $attributes[0]['priority'] ?? 0;\n      $session_handler_proxies[$id] = $container->getDefinition($id);\n    }\n\n    array_multisort($priorities, SORT_ASC, $session_handler_proxies);\n\n    $decorated_id = 'session_handler.storage';\n    foreach ($session_handler_proxies as $id => $decorator) {\n      // Prepend the inner session handler as first constructor argument.\n      $arguments = $decorator->getArguments();\n      array_unshift($arguments, new Reference($decorated_id));\n      $decorator->setArguments($arguments);\n\n      $decorated_id = $id;\n    }\n\n    $container->setAlias('session_handler', $decorated_id);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/DependencyInjection/Compiler/StackedSessionHandlerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StackedSessionHandlerPass", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Dark dropdown\"\nslots:\n  title: \"Dropdown button\"\nprops:\n  variant: dropdown\n  button_variant: secondary\n  dark: true\n  content:\n    - title: \"Action\"\n      url: \"#\"\n      link_attributes:\n        class:\n          - active\n    - title: \"Another action\"\n      url: \"#\"\n    - title: \"Something else here\"\n      url: \"#\"\n    - {}\n    - title: \"Separated link\"\n      url: \"#\"\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/stories/dropdown.dark.story.yml", "type": "yaml_reference", "topic": "dropdown.dark.story"}}
{"instruction": "Show me the implementation of the class EbRollbackOperation in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\eb\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ContentEntityType;\nuse Drupal\\Core\\Entity\\ContentEntityBase;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage;\nuse Drupal\\Core\\Field\\BaseFieldDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\eb\\Access\\EbRollbackOperationAccessControlHandler;\nuse Drupal\\views\\EntityViewsData;\n\n/**\n * Defines the EbRollbackOperation content entity.\n *\n * Represents a single operation that was executed during a definition apply.\n * Always rolled back as part of its parent EbRollback entity.\n */\n#[ContentEntityType(\n  id: 'eb_rollback_operation',\n  label: new TranslatableMarkup('Rollback Operation'),\n  label_collection: new TranslatableMarkup('Rollback Operations'),\n  label_singular: new TranslatableMarkup('rollback operation'),\n  label_plural: new TranslatableMarkup('rollback operations'),\n  entity_keys: [\n    'id' => 'id',\n    'uuid' => 'uuid',\n    'label' => 'description',\n  ],\n  handlers: [\n    'storage' => SqlContentEntityStorage::class,\n    'access' => EbRollbackOperationAccessControlHandler::class,\n    'views_data' => EntityViewsData::class,\n  ],\n  admin_permission: 'administer entity builder',\n  base_table: 'eb_rollback_operation',\n)]\nclass EbRollbackOperation extends ContentEntityBase implements EbRollbackOperationInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function baseFieldDefinitions(EntityTypeInterface $entity_type): array {\n    $fields = parent::baseFieldDefinitions($entity_type);\n\n    $fields['rollback_id'] = BaseFieldDefinition::create('entity_reference')\n      ->setLabel(new TranslatableMarkup('Rollback'))\n      ->setDescription(new TranslatableMarkup('The parent rollback entity.'))\n      ->setSetting('target_type', 'eb_rollback')\n      ->setRequired(TRUE);\n\n    $fields['definition_id'] = BaseFieldDefinition::create('string')\n      ->setLabel(new TranslatableMarkup('Definition ID'))\n      ->setDescription(new TranslatableMarkup('Denormalized from rollback for query optimization.'))\n      ->setSetting('max_length', 255)\n      ->setRequired(TRUE);\n\n    $fields['operation_type'] = BaseFieldDefinition::create('string')\n      ->setLabel(new TranslatableMarkup('Operation Type'))\n      ->setDescription(new TranslatableMarkup('The operation plugin ID.'))\n      ->setSetting('max_length', 64)\n      ->setRequired(TRUE);\n\n    $fields['description'] = BaseFieldDefinition::create('string')\n      ->setLabel(new TranslatableMarkup('Description'))\n      ->setDescription(new TranslatableMarkup('Human-readable operation description.'))\n      ->setSetting('max_length', 255)\n      ->setRequired(TRUE);\n\n    $fields['original_data'] = BaseFieldDefinition::create('map')\n      ->setLabel(new TranslatableMarkup('Original Data'))\n      ->setDescription(new TranslatableMarkup('Serialized rollback data.'));\n\n    $fields['sequence'] = BaseFieldDefinition::create('integer')\n      ->setLabel(new TranslatableMarkup('Sequence'))\n      ->setDescription(new TranslatableMarkup('Execution order within rollback.'))\n      ->setDefaultValue(0);\n\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preSave(EntityStorageInterface $storage): void {\n    parent::preSave($storage);\n\n    // Validate definition_id matches rollback.definition_id.\n    $rollback = $this->getRollback();\n    if ($rollback !== NULL) {\n      $rollbackDefinitionId = $rollback->getDefinitionId();\n      if ($rollbackDefinitionId !== NULL && $this->getDefinitionId() !== $rollbackDefinitionId) {\n        throw new \\InvalidArgumentException(\n          'Operation definition_id must match rollback.definition_id'\n        );\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRollback(): ?EbRollbackInterface {\n    $entity = $this->get('rollback_id')->entity;\n    return $entity instanceof EbRollbackInterface ? $entity : NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRollbackId(): ?int {\n    /** @var string|int|null $value */\n    $value = $this->get('rollback_id')->target_id;\n    return $value !== NULL ? (int) $value : NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setRollbackId(int $rollbackId): self {\n    $this->set('rollback_id', $rollbackId);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefinitionId(): ?string {\n    return $this->get('definition_id')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setDefinitionId(string $definitionId): self {\n    $this->set('definition_id', $definitionId);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOperationType(): string {\n    return $this->get('operation_type')->value ?? '';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setOperationType(string $type): self {\n    $this->set('operation_type', $type);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    return $this->get('description')->value ?? '';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setDescription(string $description): self {\n    $this->set('description', $description);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOriginalData(): array {\n    $first = $this->get('original_data')->first();\n    return $first !== NULL ? ($first->getValue() ?? []) : [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setOriginalData(array $data): self {\n    $this->set('original_data', $data);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSequence(): int {\n    return (int) $this->get('sequence')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setSequence(int $sequence): self {\n    $this->set('sequence', $sequence);\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/eb/src/Entity/EbRollbackOperation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EbRollbackOperation", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SectionListTrait.php\nTarget symbol: trait for\nNamespace: Drupal\\layout_builder\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete trait implementation for for.\n- Ensure these methods exist where relevant:\n  - __clone()\n  - addBlankSection()\n  - appendSection()\n  - count()\n  - getSection()\n  - hasBlankSection()\n  - hasSection()\n  - insertSection()\n  - removeAllSections()\n  - removeSection()\n  - setSection()\n  - setSections()", "output": "<?php\n\nnamespace Drupal\\layout_builder;\n\n/**\n * Provides a trait for maintaining a list of sections.\n *\n * @see \\Drupal\\layout_builder\\SectionListInterface\n */\ntrait SectionListTrait {\n\n  /**\n   * Stores the information for all sections.\n   *\n   * Implementations of this method are expected to call array_values() to rekey\n   * the list of sections.\n   *\n   * @param \\Drupal\\layout_builder\\Section[] $sections\n   *   An array of section objects.\n   *\n   * @return $this\n   */\n  abstract protected function setSections(array $sections);\n\n  /**\n   * {@inheritdoc}\n   */\n  public function count(): int {\n    if ($this->hasBlankSection()) {\n      return 0;\n    }\n\n    return count($this->getSections());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSection($delta) {\n    if (!$this->hasSection($delta)) {\n      throw new \\OutOfBoundsException(sprintf(\n        'Invalid section delta \"%s\", there are %d sections.',\n        $delta,\n        $this->count()\n      ));\n    }\n    return $this->getSections()[$delta];\n  }\n\n  /**\n   * Sets the section for the given delta on the display.\n   *\n   * @param int $delta\n   *   The delta of the section.\n   * @param \\Drupal\\layout_builder\\Section $section\n   *   The layout section.\n   *\n   * @return $this\n   */\n  public function setSection($delta, Section $section) {\n    $sections = $this->getSections();\n    $sections[$delta] = $section;\n    $this->setSections($sections);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function appendSection(Section $section) {\n    $delta = $this->count();\n\n    $this->setSection($delta, $section);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function insertSection($delta, Section $section) {\n    // Clear the section list if there is currently a blank section.\n    if ($this->hasBlankSection()) {\n      $this->removeAllSections();\n    }\n\n    if ($this->hasSection($delta)) {\n      // @todo Use https://www.drupal.org/node/66183 once resolved.\n      $start = array_slice($this->getSections(), 0, $delta);\n      $end = array_slice($this->getSections(), $delta);\n      $this->setSections(array_merge($start, [$section], $end));\n    }\n    else {\n      $this->appendSection($section);\n    }\n    return $this;\n  }\n\n  /**\n   * Adds a blank section to the list.\n   *\n   * @return $this\n   *\n   * @see \\Drupal\\layout_builder\\Plugin\\Layout\\BlankLayout\n   */\n  protected function addBlankSection() {\n    if ($this->hasSection(0)) {\n      throw new \\Exception('A blank section must only be added to an empty list');\n    }\n\n    $this->appendSection(new Section('layout_builder_blank'));\n    return $this;\n  }\n\n  /**\n   * Indicates if this section list contains a blank section.\n   *\n   * A blank section is used to differentiate the difference between a layout\n   * that has never been instantiated and one that has purposefully had all\n   * sections removed.\n   *\n   * @return bool\n   *   TRUE if the section list contains a blank section, FALSE otherwise.\n   *\n   * @see \\Drupal\\layout_builder\\Plugin\\Layout\\BlankLayout\n   */\n  protected function hasBlankSection() {\n    // A blank section will only ever exist when the delta is 0, as added by\n    // ::removeSection().\n    return $this->hasSection(0) && $this->getSection(0)->getLayoutId() === 'layout_builder_blank';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function removeSection($delta) {\n    // Clear the section list if there is currently a blank section.\n    if ($this->hasBlankSection()) {\n      $this->removeAllSections();\n    }\n\n    $sections = $this->getSections();\n    unset($sections[$delta]);\n    $this->setSections($sections);\n    // Add a blank section when the last section is removed.\n    if (empty($sections)) {\n      $this->addBlankSection();\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function removeAllSections($set_blank = FALSE) {\n    $this->setSections([]);\n    if ($set_blank) {\n      $this->addBlankSection();\n    }\n    return $this;\n  }\n\n  /**\n   * Indicates if there is a section at the specified delta.\n   *\n   * @param int $delta\n   *   The delta of the section.\n   *\n   * @return bool\n   *   TRUE if there is a section for this delta, FALSE otherwise.\n   */\n  protected function hasSection($delta) {\n    return isset($this->getSections()[$delta]);\n  }\n\n  /**\n   * Magic method: Implements a deep clone.\n   */\n  public function __clone() {\n    $sections = $this->getSections();\n\n    foreach ($sections as $delta => $item) {\n      $sections[$delta] = clone $item;\n    }\n\n    $this->setSections($sections);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/SectionListTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "SectionListTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class DataReferenceDefinition in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData;\n\n/**\n * A typed data definition class for defining references.\n *\n * Note that this definition class assumes that the data type for referencing\n * a certain target type is named \"{TARGET_TYPE}_reference\".\n *\n * @see \\Drupal\\Core\\TypedData\\DataReferenceBase\n */\nclass DataReferenceDefinition extends DataDefinition implements DataReferenceDefinitionInterface {\n\n  /**\n   * @var \\Drupal\\Core\\TypedData\\DataDefinitionInterface\n   */\n  protected $targetDefinition;\n\n  /**\n   * Creates a new data reference definition.\n   *\n   * @param string $target_data_type\n   *   The data type of the referenced data.\n   *\n   * @return static\n   */\n  public static function create($target_data_type) {\n    // This assumes implementations use a \"TYPE_reference\" naming pattern.\n    $definition = parent::create($target_data_type . '_reference');\n    return $definition->setTargetDefinition(\\Drupal::typedDataManager()->createDataDefinition($target_data_type));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createFromDataType($data_type) {\n    if (!str_ends_with($data_type, '_reference')) {\n      throw new \\InvalidArgumentException('Data type must be of the form \"{TARGET_TYPE}_reference\"');\n    }\n    // Cut of the _reference suffix.\n    return static::create(substr($data_type, 0, strlen($data_type) - strlen('_reference')));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetDefinition() {\n    return $this->targetDefinition;\n  }\n\n  /**\n   * Sets the definition of the referenced data.\n   *\n   * @param \\Drupal\\Core\\TypedData\\DataDefinitionInterface $definition\n   *   The target definition to set.\n   *\n   * @return $this\n   */\n  public function setTargetDefinition(DataDefinitionInterface $definition) {\n    $this->targetDefinition = $definition;\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/DataReferenceDefinition.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DataReferenceDefinition", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - eck\n    - link\nid: openapi_schema.field_source_url\nfield_name: field_source_url\nentity_type: openapi_schema\ntype: link\nsettings: {  }\nmodule: link\nlocked: false\ncardinality: 1\ntranslatable: true\nindexes: {  }\npersist_with_no_fields: false\ncustom_storage: false\n", "metadata": {"source": "repos/api_normalization/config/install.disabled/field.storage.openapi_schema.field_source_url.yml", "type": "yaml_reference", "topic": "field.storage.openapi schema.field source url"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: JsonEncoder\nSource file: <source_file>\nFile name hint: JsonEncoder.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\serialization\\Encoder;\n\nuse Symfony\\Component\\Serializer\\Encoder\\JsonDecode;\nuse Symfony\\Component\\Serializer\\Encoder\\JsonEncode;\nuse Symfony\\Component\\Serializer\\Encoder\\JsonEncoder as BaseJsonEncoder;\n\n/**\n * Adds 'ajax' to the supported content types of the JSON encoder.\n *\n * @internal\n *   This encoder should not be used directly. Rather, use the `serializer`\n *   service.\n */\nclass JsonEncoder extends BaseJsonEncoder {\n\n  /**\n   * The formats that this Encoder supports.\n   *\n   * @var array\n   */\n  protected static $format = ['json', 'ajax'];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(?JsonEncode $encodingImpl = NULL, ?JsonDecode $decodingImpl = NULL) {\n    // Encode <, >, ', &, and \" for RFC4627-compliant JSON, which may also be\n    // embedded into HTML.\n    // @see \\Symfony\\Component\\HttpFoundation\\JsonResponse\n    // Additionally, substitute invalid UTF-8 sequences to ensure control\n    // characters and malformed data are properly handled.\n    // @see https://www.drupal.org/project/drupal/issues/3549107\n    $json_encoding_options = JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_AMP | JSON_HEX_QUOT | JSON_INVALID_UTF8_SUBSTITUTE;\n    $this->encodingImpl = $encodingImpl ?: new JsonEncode([JsonEncode::OPTIONS => $json_encoding_options]);\n    $this->decodingImpl = $decodingImpl ?: new JsonDecode([JsonDecode::ASSOCIATIVE => TRUE]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsEncoding(string $format, array $context = []): bool {\n    return in_array($format, static::$format);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsDecoding(string $format, array $context = []): bool {\n    return in_array($format, static::$format);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\serialization\\Encoder;\n\nuse Symfony\\Component\\Serializer\\Encoder\\JsonDecode;\nuse Symfony\\Component\\Serializer\\Encoder\\JsonEncode;\nuse Symfony\\Component\\Serializer\\Encoder\\JsonEncoder as BaseJsonEncoder;\n\n/**\n * Adds 'ajax' to the supported content types of the JSON encoder.\n *\n * @internal\n *   This encoder should not be used directly. Rather, use the `serializer`\n *   service.\n */\nclass JsonEncoder extends BaseJsonEncoder {\n\n  /**\n   * The formats that this Encoder supports.\n   *\n   * @var array\n   */\n  protected static $format = ['json', 'ajax'];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(?JsonEncode $encodingImpl = NULL, ?JsonDecode $decodingImpl = NULL) {\n    // Encode <, >, ', &, and \" for RFC4627-compliant JSON, which may also be\n    // embedded into HTML.\n    // @see \\Symfony\\Component\\HttpFoundation\\JsonResponse\n    // Additionally, substitute invalid UTF-8 sequences to ensure control\n    // characters and malformed data are properly handled.\n    // @see https://www.drupal.org/project/drupal/issues/3549107\n    $json_encoding_options = JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_AMP | JSON_HEX_QUOT | JSON_INVALID_UTF8_SUBSTITUTE;\n    $this->encodingImpl = $encodingImpl ?: new JsonEncode([JsonEncode::OPTIONS => $json_encoding_options]);\n    $this->decodingImpl = $decodingImpl ?: new JsonDecode([JsonDecode::ASSOCIATIVE => TRUE]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsEncoding(string $format, array $context = []): bool {\n    return in_array($format, static::$format);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supportsDecoding(string $format, array $context = []): bool {\n    return in_array($format, static::$format);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/Encoder/JsonEncoder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "JsonEncoder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class EckEntityTypeEditForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eck\\Form\\EntityType;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Provides the edit form for ECK Entity Type.\n *\n * @ingroup eck\n */\nclass EckEntityTypeEditForm extends EckEntityTypeFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    $actions = parent::actions($form, $form_state);\n    // Change the submit button value.\n    $actions['submit']['#value'] = $this->t('Update @type', ['@type' => $this->entity->label()]);\n\n    return $actions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form = parent::buildForm($form, $form_state);\n\n    /** @var \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage $fieldStorage */\n    $fieldStorage = $this->entityTypeManager->getStorage($this->entity->id());\n\n    /** @var \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $efm */\n    $definitions = $this->entityFieldManager->getBaseFieldDefinitions($this->entity->id());\n\n    foreach (['title', 'created', 'changed', 'uid', 'status'] as $field) {\n      // Lock entity base field configuration in case when that field already\n      // contain some data.\n      if (isset($definitions[$field]) && $fieldStorage->countFieldData($definitions[$field], TRUE)) {\n        $form['base_fields'][$field]['#disabled'] = TRUE;\n      }\n    }\n\n    return $form;\n  }\n\n}\n", "metadata": {"source": "repos/eck/src/Form/EntityType/EckEntityTypeEditForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EckEntityTypeEditForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ImageEffectBase.php\nTarget symbol: class for\nNamespace: Drupal\\image\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\Core\\Plugin\\ConfigurablePluginBase\n  - Drupal\\Core\\Plugin\\RemovableDependentPluginReturn\n  - Psr\\Log\\LoggerInterface\n  - Symfony\\Component\\DependencyInjection\\Attribute\\Autowire\n- Ensure these methods exist where relevant:\n  - __construct()\n  - calculateDependencies()\n  - getConfiguration()\n  - getDerivativeExtension()\n  - getSummary()\n  - getUuid()\n  - getWeight()\n  - label()\n  - onCollectionDependencyRemoval()\n  - setConfiguration()\n  - setWeight()\n  - transformDimensions()", "output": "<?php\n\nnamespace Drupal\\image;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Plugin\\ConfigurablePluginBase;\nuse Drupal\\Core\\Plugin\\RemovableDependentPluginReturn;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\Autowire;\n\n/**\n * Provides a base class for image effects.\n *\n * @see \\Drupal\\image\\Annotation\\ImageEffect\n * @see \\Drupal\\image\\ImageEffectInterface\n * @see \\Drupal\\image\\ConfigurableImageEffectInterface\n * @see \\Drupal\\image\\ConfigurableImageEffectBase\n * @see \\Drupal\\image\\ImageEffectManager\n * @see plugin_api\n */\nabstract class ImageEffectBase extends ConfigurablePluginBase implements ImageEffectInterface, ContainerFactoryPluginInterface {\n\n  /**\n   * The image effect ID.\n   *\n   * @var string\n   */\n  protected $uuid;\n\n  /**\n   * The weight of the image effect.\n   *\n   * @var int|string\n   */\n  protected $weight = '';\n\n  /**\n   * A logger instance.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected $logger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    #[Autowire(service: 'logger.channel.image')]\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformDimensions(array &$dimensions, $uri) {\n    // Most image effects will not change the dimensions. This base\n    // implementation represents this behavior. Override this method if your\n    // image effect does change the dimensions.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeExtension($extension) {\n    // Most image effects will not change the extension. This base\n    // implementation represents this behavior. Override this method if your\n    // image effect does change the extension.\n    return $extension;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSummary() {\n    return [\n      '#markup' => '',\n      '#effect' => [\n        'id' => $this->pluginDefinition['id'],\n        'label' => $this->label(),\n        'description' => $this->pluginDefinition['description'],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function label() {\n    return $this->pluginDefinition['label'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getUuid() {\n    return $this->uuid;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setWeight($weight) {\n    $this->weight = $weight;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getWeight() {\n    return $this->weight;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfiguration() {\n    return [\n      'uuid' => $this->getUuid(),\n      'id' => $this->getPluginId(),\n      'weight' => $this->getWeight(),\n      'data' => $this->configuration,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setConfiguration(array $configuration) {\n    $configuration += [\n      'data' => [],\n      'uuid' => '',\n      'weight' => '',\n    ];\n    $this->configuration = $configuration['data'] + $this->defaultConfiguration();\n    $this->uuid = $configuration['uuid'];\n    $this->weight = $configuration['weight'];\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onCollectionDependencyRemoval(array $dependencies): RemovableDependentPluginReturn {\n    // If the module that provides the image effect plugin is uninstalled,\n    // the plugin instance should be removed from the collection.\n    return in_array($this->getPluginDefinition()['provider'], $dependencies['module'] ?? []) ? RemovableDependentPluginReturn::Remove : RemovableDependentPluginReturn::Unchanged;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/src/ImageEffectBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageEffectBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: OptionsButtonsWidget\nSource file: <source_file>\nFile name hint: OptionsButtonsWidget.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldWidget;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'options_buttons' widget.\n */\n#[FieldWidget(\n  id: 'options_buttons',\n  label: new TranslatableMarkup('Check boxes/radio buttons'),\n  field_types: [\n    'boolean',\n    'entity_reference',\n    'list_integer',\n    'list_float',\n    'list_string',\n  ],\n  multiple_values: TRUE,\n)]\nclass OptionsButtonsWidget extends OptionsWidgetBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $element = parent::formElement($items, $delta, $element, $form, $form_state);\n\n    $options = $this->getOptions($items->getEntity());\n    $selected = $this->getSelectedOptions($items);\n\n    // If required and there is one single option, preselect it.\n    if ($this->required && count($options) == 1) {\n      $selected = [array_key_first($options)];\n    }\n\n    if ($this->multiple) {\n      $element += [\n        '#type' => 'checkboxes',\n        '#default_value' => $selected,\n        '#options' => $options,\n      ];\n    }\n    else {\n      $element += [\n        '#type' => 'radios',\n        // Radio buttons need a scalar value. Take the first default value, or\n        // default to NULL so that the form element is properly recognized as\n        // not having a default value.\n        '#default_value' => $selected ? reset($selected) : NULL,\n        '#options' => $options,\n      ];\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEmptyLabel() {\n    if (!$this->required && !$this->multiple) {\n      return $this->t('N/A');\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldWidget;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'options_buttons' widget.\n */\n#[FieldWidget(\n  id: 'options_buttons',\n  label: new TranslatableMarkup('Check boxes/radio buttons'),\n  field_types: [\n    'boolean',\n    'entity_reference',\n    'list_integer',\n    'list_float',\n    'list_string',\n  ],\n  multiple_values: TRUE,\n)]\nclass OptionsButtonsWidget extends OptionsWidgetBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $element = parent::formElement($items, $delta, $element, $form, $form_state);\n\n    $options = $this->getOptions($items->getEntity());\n    $selected = $this->getSelectedOptions($items);\n\n    // If required and there is one single option, preselect it.\n    if ($this->required && count($options) == 1) {\n      $selected = [array_key_first($options)];\n    }\n\n    if ($this->multiple) {\n      $element += [\n        '#type' => 'checkboxes',\n        '#default_value' => $selected,\n        '#options' => $options,\n      ];\n    }\n    else {\n      $element += [\n        '#type' => 'radios',\n        // Radio buttons need a scalar value. Take the first default value, or\n        // default to NULL so that the form element is properly recognized as\n        // not having a default value.\n        '#default_value' => $selected ? reset($selected) : NULL,\n        '#options' => $options,\n      ];\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEmptyLabel() {\n    if (!$this->required && !$this->multiple) {\n      return $this->t('N/A');\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldWidget/OptionsButtonsWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OptionsButtonsWidget", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the interface ExecutableInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Executable;\n\n/**\n * An interface for executable plugins.\n *\n * @ingroup plugin_api\n */\ninterface ExecutableInterface {\n\n  /**\n   * Executes the plugin.\n   *\n   * phpcs:ignore Drupal.Commenting.FunctionComment.ParamNameNoMatch\n   * @param object|null $object\n   *   (optional) An object to execute the plugin on/with.\n   *\n   * @see https://www.drupal.org/project/drupal/issues/3354672\n   *\n   * @todo Uncomment the new $object method parameter before drupal:12.0.0.\n   */\n  public function execute(/* ?object $object = NULL */);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Executable/ExecutableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ExecutableInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SearchPageAccessControlHandler.php\nTarget symbol: class SearchPageAccessControlHandler\nNamespace: Drupal\\search\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SearchPageAccessControlHandler.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Access\\AccessibleInterface\n  - Drupal\\Core\\Entity\\EntityAccessControlHandler\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Session\\AccountInterface\n- Ensure these methods exist where relevant:\n  - checkAccess()", "output": "<?php\n\nnamespace Drupal\\search;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessibleInterface;\nuse Drupal\\Core\\Entity\\EntityAccessControlHandler;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Defines the access control handler for the search page entity type.\n *\n * @see \\Drupal\\search\\Entity\\SearchPage\n */\nclass SearchPageAccessControlHandler extends EntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account) {\n    /** @var \\Drupal\\search\\SearchPageInterface $entity */\n    if (in_array($operation, ['delete', 'disable'])) {\n      if ($entity->isDefaultSearch()) {\n        return AccessResult::forbidden()->addCacheableDependency($entity);\n      }\n      else {\n        return parent::checkAccess($entity, $operation, $account)->addCacheableDependency($entity);\n      }\n    }\n    if ($operation == 'view') {\n      if (!$entity->status()) {\n        return AccessResult::forbidden()->addCacheableDependency($entity);\n      }\n      $plugin = $entity->getPlugin();\n      if ($plugin instanceof AccessibleInterface) {\n        return $plugin->access($operation, $account, TRUE)->addCacheableDependency($entity);\n      }\n      return AccessResult::allowed()->addCacheableDependency($entity);\n    }\n    return parent::checkAccess($entity, $operation, $account);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/src/SearchPageAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SearchPageAccessControlHandler", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EckEntityTypeListBuilder.php\nTarget symbol: class EckEntityTypeListBuilder\nNamespace: Drupal\\eck\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for EckEntityTypeListBuilder.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Url\n  - Drupal\\eck\\EckEntityTypeBundleInfo\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildHeader()\n  - buildRow()\n  - createInstance()", "output": "<?php\n\nnamespace Drupal\\eck\\Controller;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\eck\\EckEntityTypeBundleInfo;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a listing of ECK entities.\n *\n * @ingroup eck\n */\nclass EckEntityTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n\n  /**\n   * EckEntityTypeBundleInfo service.\n   *\n   * @var \\Drupal\\eck\\EckEntityTypeBundleInfo\n   */\n  protected $eckBundleInfo;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager'),\n      $container->get('eck.entity_type.bundle.info')\n    );\n  }\n\n  /**\n   * Constructs a new EntityListBuilder object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\eck\\EckEntityTypeBundleInfo $bundle_info\n   *   ECK Entity Bundle Info service.\n   */\n  public function __construct(EntityTypeInterface $entity_type, EntityTypeManagerInterface $entity_type_manager, EckEntityTypeBundleInfo $bundle_info) {\n    $storage = $entity_type_manager->getStorage($entity_type->id());\n    parent::__construct($entity_type, $storage);\n    $this->entityTypeManager = $entity_type_manager;\n    $this->eckBundleInfo = $bundle_info;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    $header['label'] = $this->t('Entity Type');\n    $header['description'] = $this->t('Description');\n    $header['machine_name'] = $this->t('Machine Name');\n\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    $row['label'] = $entity->label();\n    $row['description'] = $entity->getDescription();\n    $row['machine_name'] = $entity->id();\n\n    if (!$this->eckBundleInfo->entityTypeHasBundles($entity->id())) {\n      $row['operations']['data']['#links']['add_bundle'] = [\n        'title' => $this->t('Add bundle'),\n        'url' => new Url('eck.entity.' . $entity->id() . '_type.add'),\n      ];\n    }\n    else {\n      // Add link to list operation.\n      $row['operations']['data']['#links']['add_content'] = [\n        'title' => $this->t('Add content'),\n        'url' => new Url('eck.entity.add_page', ['eck_entity_type' => $entity->id()]),\n      ];\n      // Directly link to the add entity page if there is only one bundle.\n      if ($this->eckBundleInfo->entityTypeBundleCount($entity->id()) === 1) {\n        $bundle_machine_names = $this->eckBundleInfo->getEntityTypeBundleMachineNames($entity->id());\n        $arguments = [\n          'eck_entity_type' => $entity->id(),\n          'eck_entity_bundle' => reset($bundle_machine_names),\n        ];\n        $row['operations']['data']['#links']['add_content']['url'] = new Url('eck.entity.add', $arguments);\n      }\n\n      $contentExists = (bool) $this->entityTypeManager->getStorage($entity->id())\n        ->getQuery()\n        ->accessCheck(FALSE)\n        ->range(0, 1)\n        ->execute();\n      if ($contentExists) {\n        // Add link to list operation.\n        $row['operations']['data']['#links']['content_list'] = [\n          'title' => $this->t('Content list'),\n          'url' => new Url('eck.entity.' . $entity->id() . '.list'),\n        ];\n      }\n    }\n\n    $row['operations']['data']['#links']['bundle_list'] = [\n      'title' => $this->t('Bundle list'),\n      'url' => new Url('eck.entity.' . $entity->id() . '_type.list'),\n    ];\n\n    return array_merge_recursive($row, parent::buildRow($entity));\n  }\n\n}\n", "metadata": {"source": "repos/eck/src/Controller/EckEntityTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EckEntityTypeListBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "component_instance_form:\n  css:\n    theme:\n      css/component-instance-form.css: {}\n", "metadata": {"source": "repos/canvas_bootstrap/canvas_bootstrap.libraries.yml", "type": "yaml_reference", "topic": "canvas bootstrap.libraries"}}
{"instruction": "Show me the implementation of the class ConfigHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * @internal\n *   This is an internal part of Drupal CMS and may be changed or removed at any\n *   time without warning. External code should not interact with this class.\n */\nfinal class ConfigHooks {\n\n  #[Hook('config_schema_info_alter')]\n  public function configSchemaInfoAlter(array &$definitions): void {\n    // @todo Remove when https://www.drupal.org/i/3569887 is released.\n    if (isset($definitions['block.settings.project_browser_block:*'])) {\n      $definitions['block.settings.project_browser_block:*']['mapping']['default_sort']['constraints']['NotBlank']['allowNull'] = TRUE;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/Hook/ConfigHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for the project status report.\n *\n * Available variables:\n * - last_checked: Themed last time update data was checked.\n * - no_updates_message: Message when there are no project updates.\n * - project_types: A list of project types.\n *   - label: The project type label.\n *   - table: The project status table.\n *\n * @see \\Drupal\\update\\Hook\\UpdateThemeHooks::preprocessUpdateReport()\n *\n * @ingroup themeable\n */\n#}\n{{ last_checked }}\n\n{% for project_type in project_types %}\n  <h3>{{ project_type.label }}</h3>\n  {{ project_type.table }}\n{% else %}\n  <p>{{ no_updates_message }}</p>\n{% endfor %}\n", "metadata": {"source": "repos/drupal_core/core/modules/update/templates/update-report.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "sdc_inline_editor.config:\n  title: 'SDC Inline Editor Configuration'\n  description: 'Configure which components are accessible from the front-end builder'\n  parent: system.admin_config_content\n  route_name: sdc_inline_editor.config\n  weight: 10\n", "metadata": {"source": "repos/sdc_inline_editor/sdc_inline_editor.links.menu.yml", "type": "yaml_reference", "topic": "sdc inline editor.links.menu"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Globals - 9.5.x - drupal", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Globals - 9.5.x - drupal\n\n* [11.x](/api/drupal/globals/11.x)\n* [10.3.x](/api/drupal/globals/10)\n* [9.5.x](/api/drupal/globals/9)\n* [8.9.x](/api/drupal/globals/8.9.x)\n* [7.x](/api/drupal/globals/7.x)\n\nName contains\n\nDescription contains\n\n| Title | Deprecated | File name | Summary | Direct uses | Strings |\n| --- | --- | --- | --- | --- | --- |\n| [$base\\_insecure\\_url](/api/drupal/core%21globals.api.php/global/base_insecure_url/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | The insecure base URL of the Drupal installation. |  |  |\n| [$base\\_path](/api/drupal/core%21globals.api.php/global/base_path/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | The base path of the Drupal installation. | 50 | 2 |\n| [$base\\_root](/api/drupal/core%21globals.api.php/global/base_root/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | The root URL of the host, excluding the path. |  |  |\n| [$base\\_secure\\_url](/api/drupal/core%21globals.api.php/global/base_secure_url/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | The secure base URL of the Drupal installation. |  |  |\n| [$base\\_url](/api/drupal/core%21globals.api.php/global/base_url/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | The base URL of the Drupal installation. |  | 4 |\n| [$conf](/api/drupal/core%21globals.api.php/global/conf/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | Allows defining of site-specific service providers for the Drupal kernel. |  |  |\n| [$config](/api/drupal/core%21globals.api.php/global/config/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | Array of configuration overrides from the settings.php file. |  | 133 |\n| [$install\\_state](/api/drupal/core%21globals.api.php/global/install_state/9) |  | core/[globals.api.php](/api/drupal/core%21globals.api.php/9) | Store settings and profile information during installation process. |  |  |\n\n**[Other projects](https://api.drupal.org/api/projects)**\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=9-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/globals/9%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/globals/9.md", "type": "doc_summary", "topic": "Globals - 9.5.x - drupal"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: OEmbedInterface\nSource file: <source_file>\nFile name hint: OEmbedInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\media\\Plugin\\media\\Source;\n\nuse Drupal\\media\\MediaSourceFieldConstraintsInterface;\n\n/**\n * Defines additional functionality for source plugins that use oEmbed.\n */\ninterface OEmbedInterface extends MediaSourceFieldConstraintsInterface {\n\n  /**\n   * Returns the oEmbed provider names.\n   *\n   * The allowed providers can be configured by the user. If it is not\n   * configured, all providers supported by the plugin are returned.\n   *\n   * @return string[]\n   *   A list of oEmbed provider names.\n   */\n  public function getProviders();\n\n}", "output": "<?php\n\nnamespace Drupal\\media\\Plugin\\media\\Source;\n\nuse Drupal\\media\\MediaSourceFieldConstraintsInterface;\n\n/**\n * Defines additional functionality for source plugins that use oEmbed.\n */\ninterface OEmbedInterface extends MediaSourceFieldConstraintsInterface {\n\n  /**\n   * Returns the oEmbed provider names.\n   *\n   * The allowed providers can be configured by the user. If it is not\n   * configured, all providers supported by the plugin are returned.\n   *\n   * @return string[]\n   *   A list of oEmbed provider names.\n   */\n  public function getProviders();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Plugin/media/Source/OEmbedInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "OEmbedInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EntityKeyTrait.php\nTarget symbol: trait consolidates\nNamespace: Drupal\\eb\\Service\\Traits\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete trait implementation for consolidates.\n- Ensure these methods exist where relevant:\n  - getHumanReadableEntityKey()\n  - makeEntityKey()", "output": "<?php\n\nnamespace Drupal\\eb\\Service\\Traits;\n\n/**\n * Provides methods for generating entity keys from operations.\n *\n * This trait consolidates entity key generation logic used across\n * DependencyResolver, ChangeDetector, and other services.\n */\ntrait EntityKeyTrait {\n\n  /**\n   * Generate canonical entity key for dependency tracking.\n   *\n   * Keys follow the format: \"type:entity_type:bundle:field_name\" etc.\n   *\n   * @param array<string, mixed> $operation\n   *   Operation data.\n   * @param int|null $index\n   *   Optional operation index for uniqueness.\n   *\n   * @return string\n   *   Canonical key like \"bundle:node:article\" or \"field:node:article:body\".\n   */\n  protected function makeEntityKey(array $operation, ?int $index = NULL): string {\n    $operationType = $operation['operation'] ?? '';\n\n    if (in_array($operationType, ['create_bundle', 'update_bundle'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundleId = $operation['bundle_id'] ?? '';\n      return \"bundle:{$entityType}:{$bundleId}\";\n    }\n\n    if (in_array($operationType, ['create_field', 'update_field'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $fieldName = $operation['field_name'] ?? '';\n      return \"field:{$entityType}:{$bundle}:{$fieldName}\";\n    }\n\n    if (in_array($operationType, ['configure_form_mode', 'configure_view_mode'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $displayMode = $operation['display_mode'] ?? 'default';\n      $fieldName = $operation['field_name'] ?? '';\n      $displayType = $operationType === 'configure_form_mode' ? 'form' : 'view';\n      return \"display:{$displayType}:{$entityType}:{$bundle}:{$displayMode}:{$fieldName}\";\n    }\n\n    if ($operationType === 'create_menu') {\n      $menuId = $operation['menu_id'] ?? '';\n      return \"menu:{$menuId}\";\n    }\n\n    if ($operationType === 'create_menu_link') {\n      $menuId = $operation['menu_id'] ?? '';\n      $title = $operation['title'] ?? '';\n      return \"menu_link:{$menuId}:{$title}\";\n    }\n\n    if (in_array($operationType, ['create_field_group', 'update_field_group'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $groupName = $operation['group_name'] ?? '';\n      $displayMode = $operation['display_mode'] ?? 'default';\n      $context = $operation['context'] ?? 'form';\n      return \"field_group:{$context}:{$entityType}:{$bundle}:{$displayMode}:{$groupName}\";\n    }\n\n    // Fallback for unknown operation types.\n    $suffix = $index !== NULL ? \":{$index}\" : ':0';\n    return \"operation:{$operationType}{$suffix}\";\n  }\n\n  /**\n   * Get human-readable entity key for error messages.\n   *\n   * @param array<string, mixed> $operation\n   *   Operation data.\n   *\n   * @return string\n   *   Human-readable key like \"Bundle node.article\".\n   */\n  protected function getHumanReadableEntityKey(array $operation): string {\n    $operationType = $operation['operation'] ?? '';\n\n    if (str_contains($operationType, 'bundle')) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundleId = $operation['bundle_id'] ?? '';\n      return \"Bundle {$entityType}.{$bundleId}\";\n    }\n\n    if (str_contains($operationType, 'field') && !str_contains($operationType, 'field_group')) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $fieldName = $operation['field_name'] ?? '';\n      return \"Field {$entityType}.{$bundle}.{$fieldName}\";\n    }\n\n    if (str_contains($operationType, 'field_group')) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $groupName = $operation['group_name'] ?? '';\n      return \"Field Group {$entityType}.{$bundle}.{$groupName}\";\n    }\n\n    if (str_contains($operationType, 'menu')) {\n      $menuId = $operation['menu_id'] ?? '';\n      return \"Menu {$menuId}\";\n    }\n\n    return \"Entity\";\n  }\n\n}\n", "metadata": {"source": "repos/eb/src/Service/Traits/EntityKeyTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "EntityKeyTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: OrderSubscriber.php\nTarget symbol: class OrderSubscriber\nNamespace: Drupal\\commerce_referral\\EventSubscriber\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for OrderSubscriber.\n- Include required imports:\n  - Drupal\\commerce_order\\Entity\\OrderInterface\n  - Drupal\\commerce_referral\\ReferralManager\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Logger\\LoggerChannelInterface\n  - Drupal\\state_machine\\Event\\WorkflowTransitionEvent\n  - Symfony\\Component\\EventDispatcher\\EventSubscriberInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getSubscribedEvents()\n  - onOrderTransition()", "output": "<?php\n\nnamespace Drupal\\commerce_referral\\EventSubscriber;\n\nuse Drupal\\commerce_order\\Entity\\OrderInterface;\nuse Drupal\\commerce_referral\\ReferralManager;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Logger\\LoggerChannelInterface;\nuse Drupal\\state_machine\\Event\\WorkflowTransitionEvent;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Subscribes to order events to award referral kickbacks.\n */\nclass OrderSubscriber implements EventSubscriberInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * The logger.\n   *\n   * @var \\Drupal\\Core\\Logger\\LoggerChannelInterface\n   */\n  protected LoggerChannelInterface $logger;\n\n  /**\n   * The referral manager.\n   *\n   * @var \\Drupal\\commerce_referral\\ReferralManager\n   */\n  protected ReferralManager $referralManager;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  public function __construct(\n    EntityTypeManagerInterface $entity_type_manager,\n    LoggerChannelInterface $logger,\n    ReferralManager $referral_manager,\n    ConfigFactoryInterface $config_factory,\n  ) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->logger = $logger;\n    $this->referralManager = $referral_manager;\n    $this->configFactory = $config_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    // Note: We cannot read config in a static method, so we subscribe to both\n    // possible events and determine which one to process in the handler method.\n    return [\n      'commerce_order.place.post_transition' => 'onOrderTransition',\n      'commerce_order.paid.post_transition' => 'onOrderTransition',\n    ];\n  }\n\n  /**\n   * Awards the kickback to referrers when a referral coupon was used.\n   */\n  public function onOrderTransition(WorkflowTransitionEvent $event): void {\n    // Check if this is the configured event to award kickbacks.\n    $config = $this->configFactory->get('commerce_referral.settings');\n    $kickback_event = $config->get('kickback_event') ?? 'place';\n    $transition_id = $event->getTransition()->getId();\n\n    // Only process if this is the configured transition.\n    if ($transition_id !== $kickback_event) {\n      return;\n    }\n\n    /** @var \\Drupal\\commerce_order\\Entity\\OrderInterface $order */\n    $order = $event->getEntity();\n    /** @var ?\\Drupal\\commerce_promotion\\Entity\\CouponInterface[] $coupons */\n    $coupons = $order->get('coupons')->referencedEntities();\n    if (empty($coupons)) {\n      return;\n    }\n\n    $customer = $order->getCustomer();\n\n    foreach ($coupons as $coupon) {\n      // Check if this coupon corresponds to a referral entity.\n      $referral = $this->referralManager->loadReferralByCouponId((string) $coupon->id());\n      if (!$referral) {\n        continue;\n      }\n\n      // If the order customer is the referrer, skip (self-use should already\n      // be blocked by validation but double-check).\n      $referrer_uid = (int) $referral->get('referrer_user')->target_id;\n      $customer_uid = (int) $customer->id();\n      if ($referrer_uid && $customer_uid && $referrer_uid === $customer_uid) {\n        continue;\n      }\n\n      // If referee_user not set, set it now.\n      if ($referral->get('referee_user')->isEmpty()) {\n        $referral->set('referee_user', $customer->id());\n      }\n\n      // Ensure kickback not already awarded for this referral.\n      if (!$referral->get('kickback_coupon')->isEmpty()) {\n        $referral->save();\n        continue;\n      }\n\n      try {\n        /** @var ?\\Drupal\\user\\UserInterface $referrer */\n        $referrer = $this->entityTypeManager->getStorage('user')->load($referrer_uid);\n        if ($referrer) {\n          $this->referralManager->awardKickback($referral, $referrer);\n          $this->logger->info('Awarded kickback coupon for referral @rid to user @uid.', [\n            '@rid' => $referral->id(),\n            '@uid' => $referrer_uid,\n          ]);\n        }\n      }\n      catch (\\Throwable $e) {\n        $this->logger->error('Failed awarding kickback for referral @rid: @msg', [\n          '@rid' => $referral->id(),\n          '@msg' => $e->getMessage(),\n        ]);\n      }\n\n      $referral->save();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/commerce_referral/src/EventSubscriber/OrderSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OrderSubscriber", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Basic module building tutorial: Lorem ipsum generator", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Creating modules](/docs/develop/creating-modules)\n\n* [Getting Started - Background & Prerequisites](/docs/develop/creating-modules/getting-started-background-prerequisites)\n* [Naming and placing your Drupal module](/docs/develop/creating-modules/naming-and-placing-your-drupal-module)\n* [Let Drupal know about your module with an .info.yml file](/docs/develop/creating-modules/let-drupal-know-about-your-module-with-an-infoyml-file)\n* [Include default configuration in your Drupal module](/docs/develop/creating-modules/include-default-configuration-in-your-drupal-module)\n* [Defining and using your own configuration in Drupal](/docs/develop/creating-modules/defining-and-using-your-own-configuration-in-drupal)\n* [Create a custom page](/docs/develop/creating-modules/create-a-custom-page-using-a-controller)\n* [Creating custom blocks](/docs/creating-modules/creating-custom-blocks \"Turn https://www.drupal.org/node/2465705 into a sub-guide.\")\n* [Creating custom field types, widgets, and formatters](/docs/creating-custom-modules/creating-custom-field-types-widgets-and-formatters \"Added menu link.\")\n* [Subscribe to and dispatch events](/docs/develop/creating-modules/subscribe-to-and-dispatch-events \"Get to know Symfony events in Drupal 8 and find out how they relate to Drupal hooks.\")\n* [Building a Views display style plugin for Drupal](/docs/develop/creating-modules/building-a-views-display-style-plugin-for-drupal)\n* [Adding stylesheets (CSS) and JavaScript (JS) to a Drupal module](/docs/develop/creating-modules/adding-assets-css-js-to-a-drupal-module-via-librariesyml)\n* [Step by step tutorial \"Lorem Ipsum\"](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator)\n* [Step by step tutorial: Hello World](/docs/creating-custom-modules/step-by-step-tutorial-hello-world)\n* [Understanding hooks](/docs/develop/creating-modules/understanding-hooks)\n\n# Basic module building tutorial: Lorem ipsum generator\n\nStep-by-step guide for building a module called\u00a0*Lorem ipsum*that generates placeholder blocks of random text. This guide walks developers through the motions of writing:\n\n* The basic structure;\n* Config sync;\n* Settings form;\n* Controller;\n* Services;\n* A block;\n* Theming; and\n* Testing.\n\n## [Tutorial introduction](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator/tutorial-introduction)\n\nWhat to expect from this guide.\n\n## [Basic structure](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator/basic-structure)\n\nStarting point.\n\n## [Settings Form](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator/settings-form)\n\nHow to make changes that are written to the Database.\n\n## [Defining a block](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator/defining-a-block)\n\nLeverage the Plugin API to define a custom Block.\n\n## [Theming](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator/theming)\n\nHow to implement theming for a custom template.\n\n## [Testing a Drupal module](/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator/testing-a-drupal-module)\n\nNow for some QA: let's check that our module works as expected.\n\n## Tags\n\n[Contributed modules](/taxonomy/term/190367)\n\n[Basic Structure](/taxonomy/term/184411)\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/creating-modules/basic-module-building-tutorial-lorem-ipsum-generator.md", "type": "doc_summary", "topic": "Basic module building tutorial: Lorem ipsum generator"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: FilterD2\nSource file: <source_file>\nFile name hint: FilterD2.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\d2_filter\\Plugin\\Filter;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\d2\\D2Helper;\nuse Drupal\\filter\\FilterProcessResult;\nuse Drupal\\filter\\Plugin\\FilterBase;\n\n/**\n * @Filter(\n *   id = \"filter_d2\",\n *   title = @Translation(\"D2 Filter\"),\n *   description = @Translation(\"Render D2 diagrams.\"),\n *   type = Drupal\\filter\\Plugin\\FilterInterface::TYPE_TRANSFORM_IRREVERSIBLE,\n *   weight = -10,\n * )\n */\nclass FilterD2 extends FilterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function process($text, $langcode) {\n    // Replace content of the [d2] blocks.\n    $text = preg_replace_callback('@\\[d2\\](.+?)\\[/d2\\]@s', function(array $matches) {\n      return self::processD2($matches[1]);\n    }, $text);\n\n    return new FilterProcessResult($text);\n  }\n\n  /**\n   * Callback to process a single [d2] block.\n   */\n  public function processD2($text) {\n    return (new D2Helper())->getSvg($text);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function tips($long = FALSE) {\n    return self::help($long);\n  }\n\n  /**\n   * Provide help text.\n   */\n  static function help($long = FALSE) {\n    if ($long) {\n      return 'With <a href=\"https://d2lang.com\" target=\"_blank\" rel=\"noopener noreferrer\">D2</a> you can create inline diagrams:<br/>'\n          . '<code>[d2]<br/>direction: right<br/>&nbsp;&nbsp;Alice -> Bob<br/>[/d2]<br/></code>'\n          . 'For more info, see <a href=\"http://drupal.org/project/d2\">D2: Declarative Diagramming</a>.';\n    }\n    else {\n      return 'Use <a href=\"https://d2lang.com\" target=\"_blank\" rel=\"noopener noreferrer\">D2</a> to generate an inline diagram.';\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\d2_filter\\Plugin\\Filter;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\d2\\D2Helper;\nuse Drupal\\filter\\FilterProcessResult;\nuse Drupal\\filter\\Plugin\\FilterBase;\n\n/**\n * @Filter(\n *   id = \"filter_d2\",\n *   title = @Translation(\"D2 Filter\"),\n *   description = @Translation(\"Render D2 diagrams.\"),\n *   type = Drupal\\filter\\Plugin\\FilterInterface::TYPE_TRANSFORM_IRREVERSIBLE,\n *   weight = -10,\n * )\n */\nclass FilterD2 extends FilterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process($text, $langcode) {\n    // Replace content of the [d2] blocks.\n    $text = preg_replace_callback('@\\[d2\\](.+?)\\[/d2\\]@s', function(array $matches) {\n      return self::processD2($matches[1]);\n    }, $text);\n\n    return new FilterProcessResult($text);\n  }\n\n  /**\n   * Callback to process a single [d2] block.\n   */\n  public function processD2($text) {\n    return (new D2Helper())->getSvg($text);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function tips($long = FALSE) {\n    return self::help($long);\n  }\n\n  /**\n   * Provide help text.\n   */\n  static function help($long = FALSE) {\n    if ($long) {\n      return 'With <a href=\"https://d2lang.com\" target=\"_blank\" rel=\"noopener noreferrer\">D2</a> you can create inline diagrams:<br/>'\n          . '<code>[d2]<br/>direction: right<br/>&nbsp;&nbsp;Alice -> Bob<br/>[/d2]<br/></code>'\n          . 'For more info, see <a href=\"http://drupal.org/project/d2\">D2: Declarative Diagramming</a>.';\n    }\n    else {\n      return 'Use <a href=\"https://d2lang.com\" target=\"_blank\" rel=\"noopener noreferrer\">D2</a> to generate an inline diagram.';\n    }\n  }\n\n}\n", "metadata": {"source": "repos/d2/modules/d2_filter/src/Plugin/Filter/FilterD2.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FilterD2", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Photo Set Block", "input": "", "output": "# Photo Set Block\n\nThe photo set block allows multiple images to be selected and displayed. When the images are clicked, it will open up a light-box that allows them to cycle through the selected images. Like Mac preview, or Windows gallery.\n\n## Parameters\n- Images (required, 1 or more)\n    - Image caption (optional)\n", "metadata": {"source": "repos/sdc_inline_editor/components/single-image-block/README.md", "type": "doc_summary", "topic": "Photo Set Block"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: SendmailCommandValidationTransportFactory\nSource file: <source_file>\nFile name hint: SendmailCommandValidationTransportFactory.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\Core\\Mailer\\Transport;\n\nuse Drupal\\Core\\Site\\Settings;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\AutowireDecorated;\nuse Symfony\\Component\\Mailer\\Transport\\Dsn;\nuse Symfony\\Component\\Mailer\\Transport\\TransportFactoryInterface;\nuse Symfony\\Component\\Mailer\\Transport\\TransportInterface;\n\n/**\n * Command validation decorator for sendmail transport factory.\n */\nclass SendmailCommandValidationTransportFactory implements TransportFactoryInterface {\n\n  /**\n   * Construct command validation decorator for sendmail transport factory.\n   *\n   * @param \\Symfony\\Component\\Mailer\\Transport\\TransportFactoryInterface $inner\n   *   The decorated sendmail transport factory.\n   */\n  public function __construct(\n    #[AutowireDecorated]\n    protected TransportFactoryInterface $inner,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function create(Dsn $dsn): TransportInterface {\n    $command = $dsn->getOption('command');\n    if (!empty($command)) {\n      $commands = Settings::get('mailer_sendmail_commands', []);\n      if (!in_array($command, $commands, TRUE)) {\n        throw new \\RuntimeException(\"Unsafe sendmail command {$command}\");\n      }\n    }\n\n    return $this->inner->create($dsn);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supports(Dsn $dsn): bool {\n    return $this->inner->supports($dsn);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Mailer\\Transport;\n\nuse Drupal\\Core\\Site\\Settings;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\AutowireDecorated;\nuse Symfony\\Component\\Mailer\\Transport\\Dsn;\nuse Symfony\\Component\\Mailer\\Transport\\TransportFactoryInterface;\nuse Symfony\\Component\\Mailer\\Transport\\TransportInterface;\n\n/**\n * Command validation decorator for sendmail transport factory.\n */\nclass SendmailCommandValidationTransportFactory implements TransportFactoryInterface {\n\n  /**\n   * Construct command validation decorator for sendmail transport factory.\n   *\n   * @param \\Symfony\\Component\\Mailer\\Transport\\TransportFactoryInterface $inner\n   *   The decorated sendmail transport factory.\n   */\n  public function __construct(\n    #[AutowireDecorated]\n    protected TransportFactoryInterface $inner,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function create(Dsn $dsn): TransportInterface {\n    $command = $dsn->getOption('command');\n    if (!empty($command)) {\n      $commands = Settings::get('mailer_sendmail_commands', []);\n      if (!in_array($command, $commands, TRUE)) {\n        throw new \\RuntimeException(\"Unsafe sendmail command {$command}\");\n      }\n    }\n\n    return $this->inner->create($dsn);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function supports(Dsn $dsn): bool {\n    return $this->inner->supports($dsn);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Mailer/Transport/SendmailCommandValidationTransportFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SendmailCommandValidationTransportFactory", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - path_alias\nid: path_alias.path_alias\ntarget_entity_type_id: path_alias\ntarget_bundle: path_alias\ndefault_langcode: und\nlanguage_alterable: true\n", "metadata": {"source": "repos/drupal_core/core/modules/path/config/optional/language.content_settings.path_alias.path_alias.yml", "type": "yaml_reference", "topic": "language.content settings.path alias.path alias"}}
{"instruction": "Show me the implementation of the class SoapResponseEventBase in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Event;\n\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Base class for SOAP response events.\n */\nabstract class SoapResponseEventBase extends Event\n{\n  /**\n   * Constructs a SOAP response event.\n   *\n   * @param string $triggeringFieldName\n   *   The webform element machine name that triggered the event.\n   * @param string $operationId\n   *   The SOAP operation plugin ID.\n   * @param array $fieldValues\n   *   The field values associated with the event.\n   * @param array $context\n   *   Additional context (webform, form_state, complete_form, etc).\n   */\n  public function __construct(\n    protected string $triggeringFieldName,\n    protected string $operationId,\n    protected array $fieldValues,\n    protected array $context = [],\n  ) {}\n\n  /**\n   * Returns the triggering field machine name.\n   *\n   * @return string\n   *   The webform element machine name.\n   */\n  public function triggeringFieldName(): string\n  {\n    return $this->triggeringFieldName;\n  }\n\n  /**\n   * Returns the operation plugin ID.\n   *\n   * @return string\n   *   The SOAP operation plugin ID.\n   */\n  public function operationId(): string\n  {\n    return $this->operationId;\n  }\n\n  /**\n   * Returns the field values.\n   *\n   * @return array\n   *   Field values associated with the event.\n   */\n  public function fieldValues(): array\n  {\n    return $this->fieldValues;\n  }\n\n  /**\n   * Returns the event context.\n   *\n   * @return array\n   *   Additional context data.\n   */\n  public function context(): array\n  {\n    return $this->context;\n  }\n\n  /**\n   * Returns a specific context value.\n   *\n   * @param string $key\n   *   The context key.\n   * @param mixed $default\n   *   Default value if key not found.\n   *\n   * @return mixed\n   *   The context value or default.\n   */\n  public function contextValue(string $key, mixed $default = NULL): mixed\n  {\n    return $this->context[$key] ?? $default;\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/src/Event/SoapResponseEventBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapResponseEventBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class MediaLinkTargetStandaloneWhenAvailable in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\media\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\GeneratedUrl;\nuse Drupal\\media\\MediaInterface;\n\n/**\n * Provides a Media link target handler that prefers the standalone URL.\n *\n * @see \\Drupal\\media\\Entity\\MediaLinkTarget\n */\nclass MediaLinkTargetStandaloneWhenAvailable extends MediaLinkTarget {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl {\n    assert($entity instanceof MediaInterface);\n\n    // Default to the standalone URL if it is enabled.\n    // @see media_entity_type_alter()\n    if (\\Drupal::config('media.settings')->get('standalone_url')) {\n      return $entity->toUrl('canonical')->toString(TRUE);\n    }\n\n    return parent::getLinkTarget($entity);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Entity/MediaLinkTargetStandaloneWhenAvailable.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaLinkTargetStandaloneWhenAvailable", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "zefix.settings_form:\n  path: '/admin/config/system/zefix'\n  defaults:\n    _title: 'Zugang zur Zefix API konfigurieren'\n    _form: 'Drupal\\zefix\\Form\\SettingsForm'\n  requirements:\n    _permission: 'administer zefix configuration'\n", "metadata": {"source": "repos/zefix/zefix.routing.yml", "type": "yaml_reference", "topic": "zefix.routing"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  _defaults:\n    autoconfigure: true\n    autowire: true\n\n  Drupal\\layout_builder_formatter\\Hook\\HelpHook:\n    class: Drupal\\layout_builder_formatter\\Hook\\HelpHook\n  Drupal\\layout_builder_formatter\\Hook\\EntityTypeAlterHook:\n    class: Drupal\\layout_builder_formatter\\Hook\\EntityTypeAlterHook\n  Drupal\\layout_builder_formatter\\Hook\\EntityFieldAccessAlterHook:\n    class: Drupal\\layout_builder_formatter\\Hook\\EntityFieldAccessAlterHook\n", "metadata": {"source": "repos/layout_builder_formatter/layout_builder_formatter.services.yml", "type": "yaml_reference", "topic": "layout builder formatter.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema definitions for FlowDrop Interrupt module configuration.\n\nflowdrop_interrupt.settings:\n  type: config_object\n  label: 'FlowDrop Interrupt settings'\n  mapping:\n    default_expiration:\n      type: integer\n      label: 'Default expiration time'\n    cleanup_enabled:\n      type: boolean\n      label: 'Enable automatic cleanup'\n    cleanup_max_age:\n      type: integer\n      label: 'Maximum age for cleanup'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_interrupt/config/schema/flowdrop_interrupt.schema.yml", "type": "yaml_reference", "topic": "flowdrop interrupt.schema"}}
{"instruction": "Show me the implementation of the class ApiNormalizationAccessChecker in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Access checker for API Normalizer operations.\n */\nclass ApiNormalizationAccessChecker implements AccessInterface {\n\n  /**\n   * Check access for API Normalizer operations.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The currently logged in account.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(AccountInterface $account) {\n    // Allow access to users with 'administer api normalizer' permission\n    // or users with 'administer site configuration' permission.\n    if ($account->hasPermission('administer api normalizer') ||\n        $account->hasPermission('administer site configuration')) {\n      return AccessResult::allowed();\n    }\n\n    return AccessResult::forbidden();\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Access/ApiNormalizationAccessChecker.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiNormalizationAccessChecker", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ViewsCache\nSource file: <source_file>\nFile name hint: ViewsCache.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views cache plugins.\n *\n * @see \\Drupal\\views\\Plugin\\views\\cache\\CachePluginBase\n *\n * @ingroup views_cache_plugins\n *\n * @Annotation\n */\nclass ViewsCache extends ViewsPluginAnnotationBase {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The plugin title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $title = '';\n\n  /**\n   * An optional short title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $short_title = '';\n\n  /**\n   * A short help string; this is displayed in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $help = '';\n\n  /**\n   * The types of the display this plugin can be used with.\n   *\n   * For example the Feed display defines the type 'feed', so only rss style\n   * and row plugins can be used in the views UI.\n   *\n   * @var array\n   */\n  public $display_types;\n\n  /**\n   * The base tables on which this cache plugin can be used.\n   *\n   * If no base table is specified the plugin can be used with all tables.\n   *\n   * @var array\n   */\n  public $base;\n\n  /**\n   * Whether the plugin should be not selectable in the UI.\n   *\n   * If it's set to TRUE, you can still use it via the API in config files.\n   *\n   * @var bool\n   */\n  public $no_ui;\n\n}\n// BUG: ensure this implementation follows Drupal 11 and PHP 8.3.", "output": "<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views cache plugins.\n *\n * @see \\Drupal\\views\\Plugin\\views\\cache\\CachePluginBase\n *\n * @ingroup views_cache_plugins\n *\n * @Annotation\n */\nclass ViewsCache extends ViewsPluginAnnotationBase {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The plugin title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $title = '';\n\n  /**\n   * An optional short title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $short_title = '';\n\n  /**\n   * A short help string; this is displayed in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $help = '';\n\n  /**\n   * The types of the display this plugin can be used with.\n   *\n   * For example the Feed display defines the type 'feed', so only rss style\n   * and row plugins can be used in the views UI.\n   *\n   * @var array\n   */\n  public $display_types;\n\n  /**\n   * The base tables on which this cache plugin can be used.\n   *\n   * If no base table is specified the plugin can be used with all tables.\n   *\n   * @var array\n   */\n  public $base;\n\n  /**\n   * Whether the plugin should be not selectable in the UI.\n   *\n   * If it's set to TRUE, you can still use it via the API in config files.\n   *\n   * @var bool\n   */\n  public $no_ui;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Annotation/ViewsCache.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsCache", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Composer requirements", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Drupal 10](/docs/getting-started/system-requirements/composer-requirements#s-drupal-10)\n* [Drupal 11](/docs/getting-started/system-requirements/composer-requirements#s-drupal-11)\n* [Drupal 12](/docs/getting-started/system-requirements/composer-requirements#s-drupal-12)\n\n## [System requirements](/docs/getting-started/system-requirements)\n\n* [Overview](/docs/getting-started/system-requirements/overview)\n* [Web Server](/docs/getting-started/system-requirements/web-server-requirements)\n* [Database server](/docs/getting-started/system-requirements/database-server-requirements)\n* [Memory](/docs/getting-started/system-requirements/memory-requirements)\n* [Composer](/docs/getting-started/system-requirements/composer-requirements)\n* [PHP](/docs/getting-started/system-requirements/php-requirements)\n* [PHP OpenSSL](/docs/getting-started/system-requirements/php-openssl-requirements)\n* [Browser](/docs/getting-started/system-requirements/browser-requirements)\n* [Setting the MySQL transaction isolation level](/docs/getting-started/system-requirements/setting-the-mysql-transaction-isolation-level)\n* [Relocated web root on shared hosting with symlink](/docs/getting-started/system-requirements/relocated-web-root-on-shared-hosting)\n\n# Composer requirements\n\nLast [updated](/node/3293746/discuss) on\n\n14 January 2026\n\nInstallation and updates of Drupal sites should be performed using the [Composer](https://www.drupal.org/docs/develop/using-composer)\u00a0dependency manager.\n\n#### Drupal 10\n\nDrupal 10 requires\u00a0**Composer 2.3.6 or higher**, since this will be the requirement for using Automatic Updates. Composer can be updated by running `composer self-update`.\n\n#### Drupal 11\n\nDrupal 11 requires **Composer 2.7.0 or higher**; this change was made for the\u00a0[Composer security fix released in February 2024](https://www.drupal.org/project/drupal/issues/3421371).\n\n#### Drupal 12\n\nDrupal 12 recommends the latest secure release of Composer, 2.9.3.\n\nOlder versions of Composer may continue to install or update Drupal successfully but bug reports will only be accepted for supported versions.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3293746/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283293746%29%20Composer%20requirements) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/system-requirements/composer-requirements.md", "type": "doc_summary", "topic": "Composer requirements"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: BootstrapFiveLayoutsUpdateBase.php\nTarget symbol: class BootstrapFiveLayoutsUpdateBase\nNamespace: Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BootstrapFiveLayoutsUpdateBase.\n- Include required imports:\n  - Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout\n  - Drupal\\bootstrap_five_layouts\\BootstrapFiveLayoutsManager\n  - Drupal\\Core\\Plugin\\PluginBase\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - getPath()\n  - processExistingLayout()\n  - update()", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts;\n\nuse Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout;\nuse Drupal\\bootstrap_five_layouts\\BootstrapFiveLayoutsManager;\nuse Drupal\\Core\\Plugin\\PluginBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n *\n */\nclass BootstrapFiveLayoutsUpdateBase extends PluginBase implements BootstrapFiveLayoutsUpdateInterface {\n\n  /**\n   * The path to the provider.\n   *\n   * @var string\n   */\n  protected $path;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, ?ContainerInterface $container = NULL) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    if (!isset($container)) {\n      $container = \\Drupal::getContainer();\n    }\n    $this->setContainer($container);\n\n    // Retrieve the path to provider.\n    $this->path = \\Drupal::service('extension.list.module')->getPath($this->pluginDefinition['provider']) ?: \\Drupal::service('extension.list.theme')->getPath($this->pluginDefinition['provider']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static($configuration, $plugin_id, $plugin_definition, $container);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPath() {\n    return $this->path;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function update(BootstrapFiveLayoutsManager $manager, array $data = [], $display_messages = TRUE) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processExistingLayout(BootstrapFiveLayout $layout, array $data = [], $display_messages = TRUE) {\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/Plugin/BootstrapFiveLayouts/BootstrapFiveLayoutsUpdateBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BootstrapFiveLayoutsUpdateBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: FlowDrop UI Agents", "input": "", "output": "# FlowDrop UI Agents\n\nThis module provides a visual editor for AI Agents using FlowDrop UI and Modeler\nAPI. It enables drag-and-drop design of AI agent workflows with bidirectional\nconversion between FlowDrop workflow format and AI Agent configuration entities.\n\nFor a full description of the module, visit the\n[project page](https://www.drupal.org/project/flowdrop_ui_agents).\n\nSubmit bug reports and feature suggestions, or track changes in the\n[issue queue](https://www.drupal.org/project/issues/flowdrop_ui_agents).\n\n\n## Table of contents\n\n- Requirements\n- Installation\n- Configuration\n- Features\n- Maintainers\n\n\n## Requirements\n\nThis module requires the following modules:\n\n- **AI** (ai:ai) - Provides core AI functionality for Drupal\n- **AI Agents** (ai_agents:ai_agents) - Provides AI agent capabilities\n- **Modeler API** (modeler_api:modeler_api) - Provides API for workflow modeling\n- **FlowDrop UI** (flowdrop:flowdrop_ui) - Provides the FlowDrop visual editor\n  framework\n\n\n## Installation\n\nInstall as you would normally install a contributed Drupal module. For further\ninformation, see\n[Installing Drupal Modules](https://www.drupal.org/docs/extending-drupal/installing-drupal-modules).\n\n\n## Configuration\n\n1. Enable the module at Administration > Extend.\n2. Configure AI providers at Administration > Configuration > AI.\n3. Create or edit AI Agents to access the FlowDrop visual editor.\n4. The editor appears when creating or editing agents with the FlowDrop modeler\n   enabled via the Modeler API.\n\n## Features\n\n- **Visual Workflow Editor**: Drag-and-drop interface for AI agent workflows\n  using FlowDrop UI components\n- **Bidirectional Conversion**: Converts between AI Agent config entities and\n  FlowDrop workflow format (nodes/edges)\n- **Tool Management**: Visual configuration of tools available to agents from\n  function call plugins\n- **Agent Configuration**: Configure system prompts, max loops, orchestration,\n  and triage settings\n- **REST API Endpoints**: Provides API for fetching available tools, agents, and\n  node metadata for the editor sidebar\n- **Node Positioning**: Saves and restores node positions in the visual editor\n\n## API Endpoints\n\nThe module provides REST endpoints for the FlowDrop editor sidebar:\n\n| Endpoint | Purpose |\n|----------|---------|\n| `GET /api/flowdrop-agents/nodes` | Flat list of all nodes (tools + agents). **Used by sidebar.** |\n| `GET /api/flowdrop-agents/nodes/by-category` | Nodes grouped by category |\n| `GET /api/flowdrop-agents/nodes/{id}/metadata` | Metadata for a specific node |\n| `GET /api/flowdrop-agents/port-config` | Port/connection configuration |\n| `GET /api/flowdrop-agents/workflow/{agent_id}` | Workflow data for an agent |\n| `POST /api/flowdrop-agents/assistant/{id}/save` | Save assistant workflow |\n\n### Sidebar Data Flow\n\nThe FlowDrop sidebar component calls `/api/flowdrop-agents/nodes` (the flat list)\nand groups nodes by category client-side. Each node includes:\n\n- `category`: Category name for grouping (e.g., \"Sub-Agent Tools\", \"Entity Tools\")\n- `categoryWeight`: Sort weight for category ordering (lower = first)\n\nCategory weights:\n- `-100`: Agents (Sub-Agent Tools)\n- `-90`: Chatbots\n- `-80`: Search/RAG tools\n- `0`: Standard tools (default)\n- `100`: Other/uncategorized\n\n## Known Issues\n\n### Sidebar Category Ordering\n\nThe `categoryWeight` feature requires a patch to FlowDrop UI. Without the patch,\nthe sidebar will sort categories alphabetically instead of by weight.\n\n**Status**: Patch submitted upstream to FlowDrop\n([#XXXXXXX](https://www.drupal.org/project/flowdrop/issues/XXXXXXX)).\n\n**Workaround**: Apply the patch from `patches/flowdrop/category-weight-sorting.patch`:\n\n```bash\ncd web/modules/contrib/flowdrop\npatch -p1 < /path/to/flowdrop_ui_agents/patches/flowdrop/category-weight-sorting.patch\n```\n\nOr add to your project's `composer.json` using\n[cweagans/composer-patches](https://github.com/cweagans/composer-patches):\n\n```json\n{\n    \"extra\": {\n        \"patches\": {\n            \"drupal/flowdrop\": {\n                \"Category weight sorting\": \"https://www.drupal.org/files/issues/XXXX-flowdrop-category-weight.patch\"\n            }\n        }\n    }\n}\n```\n\nOnce FlowDrop merges this upstream, the patch will no longer be needed.\n\n\n## Maintainers\n\n- David Galeano - [gxleano](https://www.drupal.org/u/gxleano)\n- James Abrahams - [yautja_cetanu](https://www.drupal.org/u/yautja_cetanu)\n", "metadata": {"source": "repos/flowdrop_ui_agents/README.md", "type": "doc_summary", "topic": "FlowDrop UI Agents"}}
{"instruction": "Show me the implementation of the class FindBrokenLinks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\mcp_tools\\Service\\RateLimiter;\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_broken_links',\n  label: new TranslatableMarkup('Find Broken Links'),\n  description: new TranslatableMarkup('Scan content for broken internal links (404s). Checks href attributes in text fields.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup('Maximum number of links to check (1-500, default: 100)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'broken_links' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Broken Links'),\n      description: new TranslatableMarkup('List of broken links found with source information'),\n    ),\n    'total_checked' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Checked'),\n      description: new TranslatableMarkup('Number of links checked'),\n    ),\n    'broken_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Broken Count'),\n      description: new TranslatableMarkup('Number of broken links found'),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup('Recommendations for fixing issues'),\n    ),\n  ],\n)]\nclass FindBrokenLinks extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * Read operation rate limiter.\n   */\n  protected RateLimiter $rateLimiter;\n\n  /**\n   * Config factory.\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    $instance->rateLimiter = $container->get('mcp_tools.rate_limiter');\n    $instance->configFactory = $container->get('config.factory');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $limit = isset($input['limit']) ? (int) $input['limit'] : 100;\n\n    if ($limit < 1 || $limit > 500) {\n      return ['success' => FALSE, 'error' => 'Limit must be between 1 and 500.'];\n    }\n\n    $settings = $this->configFactory->get('mcp_tools.settings');\n    $maxUrlsPerScan = (int) ($settings->get('rate_limits.broken_link_scan.max_urls_per_scan') ?? 500);\n    if ($maxUrlsPerScan > 0) {\n      $limit = min($limit, $maxUrlsPerScan);\n    }\n\n    $rateCheck = $this->rateLimiter->checkReadLimit('broken_link_scan');\n    if (!$rateCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $rateCheck['error'],\n        'code' => $rateCheck['code'] ?? 'RATE_LIMIT_EXCEEDED',\n        'retry_after' => $rateCheck['retry_after'] ?? NULL,\n      ];\n    }\n\n    return $this->analysisService->findBrokenLinks($limit);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/src/Plugin/tool/Tool/FindBrokenLinks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FindBrokenLinks", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ScrollTopCommand.php\nTarget symbol: class ScrollTopCommand\nNamespace: Drupal\\Core\\Ajax\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ScrollTopCommand.\n- Ensure these methods exist where relevant:\n  - __construct()\n  - render()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * Provides an AJAX command for scrolling to the top of an element.\n *\n * This command is implemented in Drupal.AjaxCommands.prototype.scrollTop.\n */\nclass ScrollTopCommand implements CommandInterface {\n\n  /**\n   * A CSS selector string.\n   *\n   * @var string\n   */\n  protected $selector;\n\n  /**\n   * Constructs a \\Drupal\\Core\\Ajax\\ScrollTopCommand object.\n   *\n   * @param string $selector\n   *   A CSS selector.\n   */\n  public function __construct($selector) {\n    $this->selector = $selector;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(): array {\n    return [\n      'command' => 'scrollTop',\n      'selector' => $this->selector,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Ajax/ScrollTopCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ScrollTopCommand", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ConfigFactoryWrapper in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Config;\n\nuse Drupal\\Core\\Config\\ConfigFactory;\nuse Drupal\\webprofiler\\DataCollector\\ConfigDataCollector;\n\n/**\n * Wraps a config factory to be able to figure out all used config files.\n */\nclass ConfigFactoryWrapper extends ConfigFactory {\n\n  /**\n   * The data collector to store config data.\n   *\n   * @var \\Drupal\\webprofiler\\DataCollector\\ConfigDataCollector\n   */\n  private ConfigDataCollector $dataCollector;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get($name) {\n    $result = parent::get($name);\n    $this->dataCollector->addConfig($name, $result);\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadMultiple(array $names) {\n    $results = parent::loadMultiple($names);\n    foreach ($results as $name => $result) {\n      $this->dataCollector->addConfig($name, $result);\n    }\n\n    return $results;\n  }\n\n  /**\n   * Set the data collector to store config data.\n   *\n   * @param \\Drupal\\webprofiler\\DataCollector\\ConfigDataCollector $dataCollector\n   *   The data collector to store config data.\n   */\n  public function setDataCollector(ConfigDataCollector $dataCollector): void {\n    $this->dataCollector = $dataCollector;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Config/ConfigFactoryWrapper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigFactoryWrapper", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "dependencies: {}\nid: trigger\nlabel: 'Trigger'\ndescription: 'Start workflow on events (entity changes, user actions, form submissions, cron, etc.)'\ncategory: inputs\nicon: 'mdi:flash-outline'\nplugin_version: 2.2.0\nenabled: true\nparameters:\n  variant:\n    configurable: false\n    connectable: false\n    required: false\n    default: start\noutputs:\n  data:\n    exposed: true\n  user:\n    exposed: true\n  form:\n    exposed: true\n  form_values:\n    exposed: true\n  form_id:\n    exposed: true\n  form_state:\n    exposed: true\n  cron:\n    exposed: true\ntags: {}\nexecutor_plugin: 'flowdrop_trigger:trigger'\nvisual_type: terminal\nsupported_visual_types:\n  - default\n  - simple\n  - terminal\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/config/install/flowdrop_node_type.flowdrop_node_type.trigger.yml", "type": "yaml_reference", "topic": "flowdrop node type.flowdrop node type.trigger"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Idea.php\nTarget symbol: class Idea\nNamespace: Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Idea.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor\n  - Drupal\\flowdrop\\DTO\\ParameterBagInterface\n  - Drupal\\flowdrop\\DTO\\ValidationResult\n  - Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - create()\n  - getOutputSchema()\n  - getParameterSchema()\n  - process()\n  - validateParams()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Idea node processor for BPMN-like conceptual flow diagrams.\n *\n * This node type allows users to chain conceptual ideas together without\n * committing to specific implementations. Useful for brainstorming,\n * planning workflows, and creating high-level process diagrams.\n */\n#[FlowDropNodeProcessor(\n  id: \"idea\",\n  label: new TranslatableMarkup(\"Idea\"),\n  description: \"Conceptual idea node for BPMN-like flow diagrams\",\n  version: \"1.0.0\"\n)]\nfinal class Idea extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Idea nodes are conceptual - no required inputs.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    // Idea nodes are primarily visual/conceptual.\n    // They pass through their configuration as output data.\n    return [\n      \"instanceTitle\" => $params->get(\"instanceTitle\", \"New Idea\"),\n      \"instanceDescription\" => $params->get(\"instanceDescription\", \"\"),\n      \"icon\" => $params->get(\"icon\", \"mdi:lightbulb-outline\"),\n      \"color\" => $params->get(\"color\", \"#6366f1\"),\n      \"enableLeftPort\" => $params->get(\"enableLeftPort\", TRUE),\n      \"enableRightPort\" => $params->get(\"enableRightPort\", TRUE),\n      \"enableTopPort\" => $params->get(\"enableTopPort\", FALSE),\n      \"enableBottomPort\" => $params->get(\"enableBottomPort\", FALSE),\n      \"message\" => \"Idea node content available for reference\",\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"instanceTitle\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Title\",\n          \"description\" => \"The main title or name of your idea\",\n          \"default\" => \"New Idea\",\n          \"x-display-order\" => -2,\n        ],\n        \"instanceDescription\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Description\",\n          \"description\" => \"Detailed description of the idea or concept\",\n          \"format\" => \"multiline\",\n          \"default\" => \"Describe your idea here...\",\n          \"x-display-order\" => -1,\n        ],\n        \"icon\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Icon\",\n          \"description\" => \"Custom icon for the idea (Iconify format, e.g., mdi:brain)\",\n          \"default\" => \"mdi:lightbulb-outline\",\n        ],\n        \"color\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Accent Color\",\n          \"description\" => \"Accent color for visual grouping (hex format)\",\n          \"default\" => \"#6366f1\",\n        ],\n        \"enableLeftPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Left Port\",\n          \"description\" => \"Show connection port on the left side (input)\",\n          \"default\" => TRUE,\n        ],\n        \"enableRightPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Right Port\",\n          \"description\" => \"Show connection port on the right side (output)\",\n          \"default\" => TRUE,\n        ],\n        \"enableTopPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Top Port\",\n          \"description\" => \"Show connection port on the top (input)\",\n          \"default\" => FALSE,\n        ],\n        \"enableBottomPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Bottom Port\",\n          \"description\" => \"Show connection port on the bottom (output)\",\n          \"default\" => FALSE,\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/Idea.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Idea", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Memory requirements", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Composer](/docs/getting-started/system-requirements/memory-requirements#s-composer)\n* [PHP](/docs/getting-started/system-requirements/memory-requirements#s-php)\n* [Solr, Memcache, etc.](/docs/getting-started/system-requirements/memory-requirements#s-solr-memcache-etc)\n\n## [System requirements](/docs/getting-started/system-requirements)\n\n* [Overview](/docs/getting-started/system-requirements/overview)\n* [Web Server](/docs/getting-started/system-requirements/web-server-requirements)\n* [Database server](/docs/getting-started/system-requirements/database-server-requirements)\n* [Memory](/docs/getting-started/system-requirements/memory-requirements)\n* [Composer](/docs/getting-started/system-requirements/composer-requirements)\n* [PHP](/docs/getting-started/system-requirements/php-requirements)\n* [PHP OpenSSL](/docs/getting-started/system-requirements/php-openssl-requirements)\n* [Browser](/docs/getting-started/system-requirements/browser-requirements)\n* [Setting the MySQL transaction isolation level](/docs/getting-started/system-requirements/setting-the-mysql-transaction-isolation-level)\n* [Relocated web root on shared hosting with symlink](/docs/getting-started/system-requirements/relocated-web-root-on-shared-hosting)\n\n# Memory requirements\n\nLast [updated](/node/3366077/discuss) on\n\n9 February 2024\n\nDrupal's memory requirements depend on which programs and tools are in use. PHP uses some memory, and if you also use Solr, Memcache, or similar programs, it all adds up. You probably need to run [Composer](https://www.drupal.org/docs/system-requirements/composer-requirements) commands occasionally, which require a certain amount of free memory. You can check the memory usage with a Unix command line tool such as `htop` or with the [WebProfiler](https://www.drupal.org/project/webprofiler) module.\n\n* Minimum RAM: 1 GB\n\n## Composer\n\nRunning a [Composer](https://www.drupal.org/docs/system-requirements/composer-requirements) command such as `composer update` used to require a lot of free memory (RAM). Luckily, this was [improved in Composer 2](http://github.com/composer/composer/pull/8850), and much less memory is now required.\n\nFor a Drupal 10 installation with around 30 contrib modules, Composer may not use more than a maximum of 200 MB of RAM to successfully run `composer update`, but it is recommended to have at least 1 GB of free memory available, to be on the safe side.\n\nTo get an estimate of the memory required, you can run a benchmark test.\n\nNote: Run first without `COMPOSER_DISABLE_NETWORK=1` to allow local caches to get populated, and then with:\n\n```\n$ COMPOSER_DISABLE_NETWORK=1 composer update --dry-run --profile\n[12.1MiB/0.07s] Loading composer repositories with package information\n[...]\n[23.3MiB/5.01s] No installed packages - skipping audit.\n[23.2MiB/5.01s] Memory usage: 23.2MiB (peak: 194.72MiB), time: 5.01s\n```\n\nIn the example above with 30 contrib modules in *composer.json*, Composer's memory usage maxed out at ~200 MB.\n\n## PHP\n\nPHP memory requirements can vary significantly depending on the modules in use on your site. The minimum required memory size is 64 MB, typically 128 MB or 256 MB are found in production systems. For more, see\u00a0[PHP memory requirements](https://www.drupal.org/docs/getting-started/system-requirements/php-requirements#s-memory-requirements).\n\n## Solr, Memcache, etc.\n\nMemcache and Solr can require a lot of memory, depending on the amount of data. Check usage with `htop` or the [WebProfiler](https://www.drupal.org/project/webprofiler) module.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3366077/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283366077%29%20Memory%20requirements) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/system-requirements/memory-requirements.md", "type": "doc_summary", "topic": "Memory requirements"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SetDefaultImage.php\nTarget symbol: class SetDefaultImage\nNamespace: Drupal\\drupal_cms_helper\\Plugin\\ConfigAction\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SetDefaultImage.\n- Include required imports:\n  - Drupal\\Core\\Config\\Action\\Attribute\\ConfigAction\n  - Drupal\\Core\\Config\\Action\\ConfigActionPluginInterface\n  - Drupal\\Core\\Config\\ConfigManagerInterface\n  - Drupal\\Core\\DependencyInjection\\AutowiredInstanceTrait\n  - Drupal\\Core\\Field\\FieldConfigBase\n  - Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\field\\FieldStorageConfigInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - apply()\n  - create()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper\\Plugin\\ConfigAction;\n\nuse Drupal\\Core\\Config\\Action\\Attribute\\ConfigAction;\nuse Drupal\\Core\\Config\\Action\\ConfigActionPluginInterface;\nuse Drupal\\Core\\Config\\ConfigManagerInterface;\nuse Drupal\\Core\\DependencyInjection\\AutowiredInstanceTrait;\nuse Drupal\\Core\\Field\\FieldConfigBase;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\field\\FieldStorageConfigInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Sets the default image of an image field.\n *\n * This is needed because, by default, core will invalidate the default image\n * of an image field if it refers to a file entity that doesn't exist. However,\n * this situation can easily be encountered while applying a recipe, since\n * you could use a config action to set the default image to a file entity\n * that the recipe ships, but doesn't exist when config actions are applied.\n *\n * An example of using this in a recipe:\n * @code\n * field.field.node.article.field_image:\n *   # This is the UUID of a file entity that may or may not exist yet.\n *   setDefaultImage: 059dcb1d-3f0d-4390-89d7-6ebe2bc0d833\n * @endcode\n *\n * @api\n *   This is part of Drupal CMS's developer-facing API and may be relied upon.\n */\n#[ConfigAction(\n  id: 'setDefaultImage',\n  admin_label: new TranslatableMarkup('Set default image'),\n  entity_types: [\n    'base_field_override',\n    'field_config',\n    'field_storage_config',\n  ],\n)]\nfinal readonly class SetDefaultImage implements ConfigActionPluginInterface, ContainerFactoryPluginInterface {\n\n  use AutowiredInstanceTrait;\n\n  public function __construct(\n    private ConfigManagerInterface $configManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): self {\n    return self::createInstanceAutowired($container);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function apply(string $configName, mixed $value): void {\n    $field = $this->configManager->loadConfigEntityByName($configName);\n\n    // Check assumptions...\n    assert(\n      // We need to be working on an entity that supports changing settings.\n      ($field instanceof FieldConfigBase || $field instanceof FieldStorageConfigInterface) &&\n      // And it must be an image field.\n      $field->getType() === 'image' &&\n      // The value is the UUID of a file entity, but it need not exist yet.\n      is_string($value)\n    );\n    $field->setSetting('default_image', ['uuid' => $value] + $field->getSetting('default_image'))\n      // We need to mark the field as syncing so that the default image won't\n      // be changed to NULL if the file doesn't exist yet.\n      // @see \\Drupal\\image\\Hook\\ImageHooks::entityPresave()\n      ->setSyncing(TRUE)\n      ->save();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/Plugin/ConfigAction/SetDefaultImage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SetDefaultImage", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: EntityReference\nSource file: <source_file>\nFile name hint: EntityReference.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\row;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\n\n/**\n * EntityReference row plugin.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\n  id: \"entity_reference\",\n  title: new TranslatableMarkup(\"Entity Reference inline fields\"),\n  help: new TranslatableMarkup(\"Displays the fields with an optional template.\"),\n  theme: \"views_view_fields\",\n  register_theme: FALSE,\n  display_types: [\"entity_reference\"]\n)]\nclass EntityReference extends Fields {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['separator'] = ['default' => '-'];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n\n    // Expand the description of the 'Inline field' checkboxes.\n    $form['inline']['#description'] .= '<br />' . $this->t(\"<strong>Note:</strong> In 'Entity Reference' displays, all fields will be displayed inline unless an explicit selection of inline fields is made here.\");\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender($row) {\n    // Force all fields to be inline by default.\n    if (empty($this->options['inline'])) {\n      $fields = $this->view->getHandlers('field', $this->displayHandler->display['id']);\n      $names = array_keys($fields);\n      $this->options['inline'] = array_combine($names, $names);\n    }\n\n    return parent::preRender($row);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\row;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\n\n/**\n * EntityReference row plugin.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\n  id: \"entity_reference\",\n  title: new TranslatableMarkup(\"Entity Reference inline fields\"),\n  help: new TranslatableMarkup(\"Displays the fields with an optional template.\"),\n  theme: \"views_view_fields\",\n  register_theme: FALSE,\n  display_types: [\"entity_reference\"]\n)]\nclass EntityReference extends Fields {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['separator'] = ['default' => '-'];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n\n    // Expand the description of the 'Inline field' checkboxes.\n    $form['inline']['#description'] .= '<br />' . $this->t(\"<strong>Note:</strong> In 'Entity Reference' displays, all fields will be displayed inline unless an explicit selection of inline fields is made here.\");\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender($row) {\n    // Force all fields to be inline by default.\n    if (empty($this->options['inline'])) {\n      $fields = $this->view->getHandlers('field', $this->displayHandler->display['id']);\n      $names = array_keys($fields);\n      $this->options['inline'] = array_combine($names, $names);\n    }\n\n    return parent::preRender($row);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/row/EntityReference.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityReference", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Security model", "input": "", "output": "# Security model\n\n## Use Display Builder\n\nTo use a Display Builder instance, an user role needs at least 2 permissions:\n\n- The specific permission to use the Display Builder profile associated to the instance\n- The classic permission related to the display we are building. For example, `Administer display` for entity view displays, or `Administer views ` for view displays.\n\nThose permissions are checked at 2 different levels:\n\n- when accessing the Display Builder, by the controllers which are loading `ProfileViewBuilder`, through `ProfileAccessControlHandler`\n- when using the Display Builder, by the API controllers, through `InstanceAccessControlHandler`\n\n## Administer Display Builder\n\nDisplay Builder UI sub-module add a few permissions:\n\n- `Administer Display Builder profiles` for pages in `/admin/structure/display-builder`\n- `Administer Display Builder presets` for page in `/admin/structure/display-builder/preset`\n- `List Display Builder instances` for `/admin/structure/display-builder/instances` page\n", "metadata": {"source": "repos/display_builder/docs/security-model.md", "type": "doc_summary", "topic": "Security model"}}
{"instruction": "Show me the implementation of the class DatetimeRangePostUpdate in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Post-update functions for Datetime Range module.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction datetime_range_removed_post_updates(): array {\n  return [\n    'datetime_range_post_update_translatable_separator' => '9.0.0',\n    'datetime_range_post_update_views_string_plugin_id' => '9.0.0',\n    'datetime_range_post_update_from_to_configuration' => '11.0.0',\n  ];\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime_range/datetime_range.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatetimeRangePostUpdate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Best practices for developers", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Best practices for developers\n\nSame name and namespace in other branches\n\n1. [10 core/core.api.php](/api/drupal/core%21core.api.php/group/best_practices/10) \\best\\_practices\n2. [9 core/core.api.php](/api/drupal/core%21core.api.php/group/best_practices/9) \\best\\_practices\n3. [8.9.x core/core.api.php](/api/drupal/core%21core.api.php/group/best_practices/8.9.x) \\best\\_practices\n\nOverview of standards and best practices for developers\n\nIdeally, all code that is included in Drupal Core and contributed modules,\nthemes, and distributions will be secure, internationalized, maintainable,\nand efficient. In order to facilitate this, the Drupal community has\ndeveloped a set of guidelines and standards for developers to follow.\n\nStandards and best practices that developers should be aware of include:\n\n* **Security**: <https://www.drupal.org/writing-secure-code> and the\n  Sanitization functions topic\n* **Coding standards**: <https://www.drupal.org/coding-standards>\n  and <https://www.drupal.org/coding-standards/docs>\n* **Accessibility**: <https://www.drupal.org/node/1637990> (modules) and\n  <https://www.drupal.org/node/464472> (themes)\n* **Usability**: <https://www.drupal.org/ui-standards>\n* **Internationalization**: [Internationalization topic](/api/drupal/core%21lib%21Drupal%21Core%21Language%21language.api.php/group/i18n/11.x \"Internationalization and translation\")\n* **Automated testing**: [Automated tests topic](/api/drupal/core%21core.api.php/group/testing/11.x \"Overview of PHPUnit and Nightwatch automated tests.\")\n\n### File\n\ncore/[core.api.php](/api/drupal/core%21core.api.php/11.x), line 1561\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521core.api.php/group/best_practices/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21core.api.php/group/best_practices/11.x.md", "type": "doc_summary", "topic": "Best practices for developers"}}
{"instruction": "Show me the implementation of the interface DateSqlInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\query;\n\n/**\n * Defines an interface for handling date queries with SQL.\n *\n * @internal\n *   Classes implementing this interface should only be used by the Views SQL\n *   query plugin.\n *\n * @see \\Drupal\\views\\Plugin\\views\\query\\Sql\n */\ninterface DateSqlInterface {\n\n  /**\n   * Returns a native database expression for a given field.\n   *\n   * @param string $field\n   *   The query field that will be used in the expression.\n   * @param bool $string_date\n   *   For certain databases, date format functions vary depending on string or\n   *   numeric storage.\n   *\n   * @return string\n   *   An expression representing a date field with timezone.\n   */\n  public function getDateField($field, $string_date);\n\n  /**\n   * Creates a native database date formatting.\n   *\n   * @param string $field\n   *   An appropriate query expression pointing to the date field.\n   * @param string $format\n   *   A format string for the result. For example: 'Y-m-d H:i:s'.\n   *\n   * @return string\n   *   A string representing the field formatted as a date as specified by\n   *   $format.\n   */\n  public function getDateFormat($field, $format);\n\n  /**\n   * Applies the given offset to the given field.\n   *\n   * @param string &$field\n   *   The date field in a string format.\n   * @param int $offset\n   *   The timezone offset in seconds.\n   */\n  public function setFieldTimezoneOffset(&$field, $offset);\n\n  /**\n   * Set the database to the given timezone.\n   *\n   * @param string $offset\n   *   The timezone.\n   */\n  public function setTimezoneOffset($offset);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/query/DateSqlInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DateSqlInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Callback in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Passes the source value to a callback.\n *\n * The callback process plugin allows simple processing of the value, such as\n * strtolower(). To pass more than one argument, pass an array as the source\n * and set the unpack_source option.\n *\n * Available configuration keys:\n * - callable: The name of the callable method.\n * - unpack_source: (optional) Whether to interpret the source as an array of\n *   arguments.\n *\n * Examples:\n *\n * @code\n * process:\n *   destination_field:\n *     plugin: callback\n *     callable: mb_strtolower\n *     source: source_field\n * @endcode\n *\n * An example where the callable is a static method in a class:\n *\n * @code\n * process:\n *   destination_field:\n *     plugin: callback\n *     callable:\n *       - '\\Drupal\\Component\\Utility\\Unicode'\n *       - ucfirst\n *     source: source_field\n * @endcode\n *\n * An example where the callback accepts no arguments:\n *\n * @code\n * process:\n *   time:\n *     plugin: callback\n *     callable: time\n *     unpack_source: true\n *     source: [  ]\n * @endcode\n *\n * An example where the callback accepts more than one argument:\n *\n * @code\n * source:\n *   plugin: source_plugin_goes_here\n *   constants:\n *     slash: /\n * process:\n *   field_link_url:\n *     plugin: callback\n *     callable: rtrim\n *     unpack_source: true\n *     source:\n *       - url\n *       - constants/slash\n * @endcode\n *\n * This will remove the trailing '/', if any, from a URL.\n *\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('callback')]\nclass Callback extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    if (!isset($configuration['callable'])) {\n      throw new \\InvalidArgumentException('The \"callable\" must be set.');\n    }\n    elseif (!is_callable($configuration['callable'])) {\n      throw new \\InvalidArgumentException('The \"callable\" must be a valid function or method.');\n    }\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (!empty($this->configuration['unpack_source'])) {\n      if (!is_array($value)) {\n        throw new MigrateException(sprintf(\"When 'unpack_source' is set, the source must be an array. Instead it was of type '%s'\", gettype($value)));\n      }\n      return call_user_func($this->configuration['callable'], ...$value);\n    }\n    return call_user_func($this->configuration['callable'], $value);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/Callback.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Callback", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CountryManagerInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\Core\\Locale\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Ensure these methods exist where relevant:\n  - getList()", "output": "<?php\n\nnamespace Drupal\\Core\\Locale;\n\n/**\n * Defines a common interface for country managers.\n */\ninterface CountryManagerInterface {\n\n  /**\n   * Returns a list of country code => country name pairs.\n   *\n   * @return array\n   *   An array of country code => country name pairs.\n   */\n  public function getList();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Locale/CountryManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CountryManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for a single node in a printer-friendly outline.\n *\n * Available variables:\n * - node: Fully loaded node.\n * - depth: Depth of the current node inside the outline.\n * - title: (optional) Node title.\n * - content: Node content.\n * - children: All the child nodes recursively rendered through this file.\n *\n * @see template_preprocess_book_node_export_html()\n *\n * @ingroup themeable\n */\n#}\n<article>\n  {% if title %}\n    <h1>{{ title }}</h1>\n  {% endif %}\n  {{ content }}\n  {{ children }}\n</article>\n", "metadata": {"source": "repos/livre/book/templates/book-node-export-html.html.twig", "type": "twig_reference"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Drupal.org Submission Checklist - API Normalization Feeds Integration", "input": "", "output": "# Drupal.org Submission Checklist - API Normalization Feeds Integration\n\n## Module Information\n\n- **Module Name**: API Normalization Feeds Integration\n- **Machine Name**: `api_normalization_feeds`\n- **Type**: Submodule (Integration)\n- **Parent Module**: api_normalization\n- **Package**: API Normalization\n- **Drupal Compatibility**: 10.3+, 11.x\n\n## Pre-Submission Checklist\n\n### Code Quality\n- [x] No hardcoded values (all configuration-driven)\n- [x] Follows Drupal coding standards\n- [x] Uses dependency injection where appropriate\n- [x] Proper namespace structure\n- [x] All functions properly documented\n\n### Dependencies\n- [x] All dependencies properly declared in .info.yml\n- [x] Parent module: `api_normalization`\n- [x] Contrib module: `feeds:feeds` (properly namespaced)\n- [x] No custom dependencies\n- [x] All contrib modules available on drupal.org\n\n### Integration Points\n- [x] Feeds module integration properly implemented\n- [x] Uses Feeds plugin APIs\n- [x] Extends Feeds fetcher/parser\n- [x] No direct Feeds module modifications\n\n### Configuration\n- [x] Configuration via Feeds module UI\n- [x] No additional configuration schemas needed\n- [x] Leverages parent module configuration\n\n### Documentation\n- [x] README.md present and complete\n- [x] Installation instructions provided\n- [x] Configuration examples included\n- [x] Use cases documented\n- [x] Troubleshooting section included\n\n### Security\n- [x] No sensitive data hardcoded\n- [x] Inherits parent module security\n- [x] Uses Feeds module permission system\n- [x] Proper access control\n\n### Testing Readiness\n- [ ] Manual testing completed with Feeds module\n- [ ] Installation tested on clean Drupal site\n- [ ] Feed import tested with various API sources\n- [ ] Field mapping tested\n- [ ] Batch processing tested\n\n## Submission Notes\n\nThis is an **integration submodule** that bridges API Normalization with the Drupal Feeds module for bulk API data imports.\n\n### Key Features\n- Bulk API data imports\n- Normalized response processing via Feeds\n- Configurable field mappings\n- Batch processing support\n- Multi-provider API support\n\n### Integration Benefits\n- Leverages Feeds module's mature import system\n- Adds API normalization to Feeds workflows\n- No reinvention of import mechanisms\n- Full Feeds UI integration\n\n### Module Status\n- **Status**: Ready for drupal.org submission\n- **Stability**: Stable\n- **API Status**: Stable (follows Feeds plugin API)\n\n## Dependencies Detail\n\n### Required Contrib Modules\n1. **feeds** (`feeds:feeds`)\n   - Drupal.org project: https://www.drupal.org/project/feeds\n   - Purpose: Bulk data import framework\n   - Minimum version: Latest stable\n\n## Post-Submission Tasks\n\n- [ ] Create project page on drupal.org\n- [ ] Add to API Normalization project family\n- [ ] Link from Feeds module documentation\n- [ ] Add to \"Works with Feeds\" showcase\n- [ ] Monitor issue queue\n- [ ] Create integration examples\n\n## Drupal.org Project Settings\n\n**Recommended settings:**\n- Project type: Module (integration submodule)\n- Category: Web services\n- Maintenance status: Actively maintained\n- Development status: Maintenance fixes\n- Parent project: api_normalization\n- Related projects: feeds\n\n## Integration Testing Checklist\n\n- [ ] Feed type creation tested\n- [ ] API Normalization fetcher works\n- [ ] API Normalization parser works\n- [ ] Field mapping functions correctly\n- [ ] Batch imports complete successfully\n- [ ] Error handling works as expected\n- [ ] Compatible with latest Feeds version\n\n## Community Engagement\n\n**Target audiences:**\n1. Sites using Feeds for content import\n2. Sites consuming multiple API sources\n3. Data migration projects\n4. Content aggregation platforms\n\n**Promotion strategy:**\n- Post in Feeds issue queue announcing integration\n- Create tutorial/blog post on drupal.org\n- Add examples to module documentation\n- Present at DrupalCon (API + Feeds integration)\n\n## Additional Notes\n\nThis module provides a powerful combination:\n- Feeds: Mature, battle-tested import framework\n- API Normalization: Multi-provider API abstraction\n- Result: Unified bulk import from any API source\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_feeds/DRUPAL_ORG_SUBMISSION.md", "type": "doc_summary", "topic": "Drupal.org Submission Checklist - API Normalization Feeds Integration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Offcanvas dark\"\nslots:\n  brand:\n    - type: html_tag\n      tag: a\n      attributes:\n        href: \"#\"\n      value: \"Offcanvas dark navbar\"\n  navigation_collapsible:\n    - type: component\n      component: \"bootstrap_components:navbar_nav\"\n      props:\n        variant: default\n        attributes:\n          class:\n            - justify-content-end\n            - flex-grow-1\n            - pe-3\n        items:\n          - title: Home\n            url: \"#\"\n            link_attributes:\n              class:\n                - active\n          - title: Link\n            url: \"#\"\n          - title: Dropdown\n            url: \"#\"\n            below:\n              - title: \"Action\"\n                url: \"#\"\n              - title: \"Another action\"\n                url: \"#\"\n              - {}\n              - title: \"Something else here\"\n                url: \"#\"\n          - title: Disabled\n            url: \"#\"\n            link_attributes:\n              class:\n                - disabled\n  offcanvas_label: \"Dark offcanvas\"\nprops:\n  attributes:\n    class:\n      - bg-dark\n    data-bs-theme: dark\n  toggler_position: end\n  toggle_action: offcanvas\n  offcanvas_position: end\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/stories/navbar.offcanvas_dark.story.yml", "type": "yaml_reference", "topic": "navbar.offcanvas dark.story"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for displaying a single search result.\n *\n * This template renders a single search result. The list of results is\n * rendered using '#theme' => 'item_list', with suggestions of:\n * - item_list__search_results__(plugin_id)\n * - item_list__search_results\n *\n * Available variables:\n * - url: URL of the result.\n * - title: Title of the result.\n * - snippet: A small preview of the result. Does not apply to user searches.\n * - info: String of all the meta information ready for print. Does not apply\n *   to user searches.\n * - plugin_id: The machine-readable name of the plugin being executed,such\n *   as \"node_search\" or \"user_search\".\n * - title_prefix: Additional output populated by modules, intended to be\n *   displayed in front of the main title tag that appears in the template.\n * - title_suffix: Additional output populated by modules, intended to be\n *   displayed after the main title tag that appears in the template.\n * - info_split: Contains same data as info, but split into separate parts.\n *   - info_split.type: Node type (or item type string supplied by module).\n *   - info_split.user: Author of the node linked to users profile. Depends\n *     on permission.\n *   - info_split.date: Last update of the node. Short formatted.\n *   - info_split.comment: Number of comments output as \"% comments\", %\n *     being the count. (Depends on comment.module).\n * @todo The info variable needs to be made drillable and each of these sub\n *   items should instead be within info and renamed info.foo, info.bar, etc.\n *\n * Other variables:\n * - title_attributes: HTML attributes for the title.\n * - content_attributes: HTML attributes for the content.\n *\n * Since info_split is keyed, a direct print of the item is possible.\n * This array does not apply to user searches so it is recommended to check\n * for its existence before printing. The default keys of 'type', 'user' and\n * 'date' always exist for node searches. Modules may provide other data.\n * @code\n *   {% if (info_split.comment) %}\n *     <span class=\"info-comment\">\n *       {{ info_split.comment }}\n *     </span>\n *   {% endif %}\n * @endcode\n *\n * To check for all available data within info_split, use the code below.\n * @code\n *   <pre>\n *     {{ dump(info_split) }}\n *   </pre>\n * @endcode\n *\n * @see \\Drupal\\search\\Hook\\SearchThemeHooks::preprocessSearchResult()\n *\n * @ingroup themeable\n */\n#}\n{{ title_prefix }}\n<h3{{ title_attributes }}>\n  <a href=\"{{ url }}\">{{ title }}</a>\n</h3>\n{{ title_suffix }}\n{% if snippet %}\n  <p{{ content_attributes }}>{{ snippet }}</p>\n{% endif %}\n{% if info %}\n  <p>{{ info }}</p>\n{% endif %}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/templates/search-result.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class ImageToolkitForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\TypedConfigManagerInterface;\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\ImageToolkit\\ImageToolkitManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configures image toolkit settings for this site.\n *\n * @internal\n */\nclass ImageToolkitForm extends ConfigFormBase {\n\n  /**\n   * An array containing currently available toolkits.\n   *\n   * @var \\Drupal\\Core\\ImageToolkit\\ImageToolkitInterface[]\n   */\n  protected $availableToolkits = [];\n\n  /**\n   * Constructs an ImageToolkitForm object.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The factory for configuration objects.\n   * @param \\Drupal\\Core\\Config\\TypedConfigManagerInterface $typedConfigManager\n   *   The typed config manager.\n   * @param \\Drupal\\Core\\ImageToolkit\\ImageToolkitManager $manager\n   *   The image toolkit plugin manager.\n   */\n  public function __construct(ConfigFactoryInterface $config_factory, TypedConfigManagerInterface $typedConfigManager, ImageToolkitManager $manager) {\n    parent::__construct($config_factory, $typedConfigManager);\n\n    foreach ($manager->getAvailableToolkits() as $id => $definition) {\n      $this->availableToolkits[$id] = $manager->createInstance($id);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('config.factory'),\n      $container->get('config.typed'),\n      $container->get('image.toolkit.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'system_image_toolkit_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['system.image'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form['image_toolkit'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Select an image processing toolkit'),\n      '#config_target' => 'system.image:toolkit',\n      '#options' => [],\n    ];\n\n    // If we have more than one image toolkit, allow the user to select the one\n    // to use, and load each of the toolkits' settings form.\n    foreach ($this->availableToolkits as $id => $toolkit) {\n      $definition = $toolkit->getPluginDefinition();\n      $form['image_toolkit']['#options'][$id] = $definition['title'];\n      $form['image_toolkit_settings'][$id] = [\n        '#type' => 'details',\n        '#title' => $this->t('@toolkit settings', ['@toolkit' => $definition['title']]),\n        '#open' => TRUE,\n        '#tree' => TRUE,\n        '#states' => [\n          'visible' => [\n            ':radio[name=\"image_toolkit\"]' => ['value' => $id],\n          ],\n        ],\n      ];\n      $form['image_toolkit_settings'][$id] += $toolkit->buildConfigurationForm([], $form_state);\n    }\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state) {\n    parent::validateForm($form, $form_state);\n\n    // Call the form validation handler for each of the toolkits.\n    foreach ($this->availableToolkits as $toolkit) {\n      $toolkit->validateConfigurationForm($form, $form_state);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    // Call the form submit handler for each of the toolkits.\n    foreach ($this->availableToolkits as $toolkit) {\n      $toolkit->submitConfigurationForm($form, $form_state);\n    }\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/ImageToolkitForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageToolkitForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: UpdateSettingsForm.php\nTarget symbol: class UpdateSettingsForm\nNamespace: Drupal\\update\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for UpdateSettingsForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\ConfigTarget\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\Url\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - arrayToMultiLineString()\n  - buildForm()\n  - formatMultipleViolationsMessage()\n  - getEditableConfigNames()\n  - getFormId()\n  - multiLineStringToArray()\n  - submitForm()", "output": "<?php\n\nnamespace Drupal\\update;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\ConfigTarget;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configure update settings for this site.\n *\n * @internal\n */\nclass UpdateSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'update_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['update.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form['update_check_frequency'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Check for updates'),\n      '#config_target' => new ConfigTarget(\n        'update.settings',\n        'check.interval_days',\n        toConfig: fn($value) => intval($value)),\n      '#options' => [\n        1 => $this->t('Daily'),\n        7 => $this->t('Weekly'),\n      ],\n      '#description' => $this->t('Select how frequently you want to automatically check for new releases of your currently installed modules and themes.'),\n    ];\n\n    $form['update_check_disabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Check for updates of uninstalled modules and themes'),\n      '#config_target' => 'update.settings:check.disabled_extensions',\n    ];\n\n    $form['update_notify_emails'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Email addresses to notify when updates are available'),\n      '#rows' => 4,\n      '#config_target' => new ConfigTarget(\n        'update.settings',\n        'notification.emails',\n        static::class . '::arrayToMultiLineString',\n        static::class . '::multiLineStringToArray',\n      ),\n      '#description' => $this->t('Whenever your site checks for available updates and finds new releases, it can notify a list of users via email. Put each address on a separate line. If blank, no emails will be sent.'),\n    ];\n\n    $form['update_notification_threshold'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Email notification threshold'),\n      '#config_target' => 'update.settings:notification.threshold',\n      '#options' => [\n        'all' => $this->t('All newer versions'),\n        'security' => $this->t('Only security updates'),\n      ],\n      '#description' => $this->t(\n        'You can choose to send email only if a security update is available, or to be notified about all newer versions. If there are updates available of Drupal core or any of your installed modules and themes, your site will always print a message on the <a href=\":status_report\">status report</a> page. If there is a security update, an error message will be printed on administration pages for users with <a href=\":update_permissions\">permission to view update notifications</a>.',\n        [\n          ':status_report' => Url::fromRoute('system.status')->toString(),\n          ':update_permissions' => Url::fromRoute('user.admin_permissions', [], ['fragment' => 'module-update'])\n            ->toString(),\n        ]\n      ),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function formatMultipleViolationsMessage(string $form_element_name, array $violations): TranslatableMarkup {\n    if ($form_element_name !== 'update_notify_emails') {\n      return parent::formatMultipleViolationsMessage($form_element_name, $violations);\n    }\n\n    $invalid_email_addresses = [];\n    foreach ($violations as $violation) {\n      $invalid_email_addresses[] = $violation->getInvalidValue();\n    }\n    return $this->t('%emails are not valid email addresses.', ['%emails' => implode(', ', $invalid_email_addresses)]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $config = $this->config('update.settings');\n    // See if the update_check_disabled setting is being changed, and if so,\n    // invalidate all update status data.\n    if ($form_state->getValue('update_check_disabled') != $config->get('check.disabled_extensions')) {\n      update_storage_clear();\n    }\n\n    parent::submitForm($form, $form_state);\n  }\n\n  /**\n   * Prepares the submitted value to be stored in the notify_emails property.\n   *\n   * @param string $value\n   *   The submitted value.\n   *\n   * @return array\n   *   The value to be stored in config.\n   */\n  public static function multiLineStringToArray(string $value): array {\n    return trim($value) ? array_map('trim', explode(\"\\n\", $value)) : [];\n  }\n\n  /**\n   * Prepares the saved notify_emails property to be displayed in the form.\n   *\n   * @param array $value\n   *   The value saved in config.\n   *\n   * @return string\n   *   The value of the form element.\n   */\n  public static function arrayToMultiLineString(array $value): string {\n    return implode(\"\\n\", $value);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/update/src/UpdateSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UpdateSettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class ToolApiIntegration in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Integration;\n\nuse Drupal\\api_normalization\\Service\\FeatureManager;\nuse Drupal\\api_normalization\\Service\\ToolSchemaGenerator;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\n\n/**\n * Integration with Tool API module.\n */\nclass ToolApiIntegration {\n\n  /**\n   * Array of tools.\n   */\n  private array $tools = [];\n\n  public function __construct(\n    private readonly ToolSchemaGenerator $schemaGenerator,\n    private readonly ModuleHandlerInterface $moduleHandler,\n    private readonly FeatureManager $featureManager,\n  ) {}\n\n  /**\n   * Check if MCP integration is enabled.\n   *\n   * @return bool\n   *   TRUE if feature is enabled.\n   */\n  public function isEnabled(): bool {\n    return $this->featureManager->isEnabled('mcp_integration');\n  }\n\n  /**\n   * Add a tool from Tool API.\n   *\n   * @param object $tool\n   *   Tool API tool object.\n   */\n  public function addTool(object $tool): void {\n    if (!$this->isEnabled()) {\n      return;\n    }\n    $this->tools[] = $tool;\n  }\n\n  /**\n   * Get schema for Tool API tool.\n   *\n   * @param string $toolId\n   *   Tool ID.\n   *\n   * @return array|null\n   *   OpenAPI schema or NULL if not found.\n   */\n  public function getToolSchema(string $toolId): ?array {\n    foreach ($this->tools as $tool) {\n      if ($this->getToolId($tool) === $toolId) {\n        return $this->schemaGenerator->generateOpenApiSchema($tool);\n      }\n    }\n    return NULL;\n  }\n\n  /**\n   * Get all Tool API tools.\n   *\n   * @return array\n   *   Array of tools.\n   */\n  public function getTools(): array {\n    return $this->tools;\n  }\n\n  /**\n   * Get tool ID.\n   */\n  protected function getToolId(object $tool): string {\n    if (method_exists($tool, 'getId')) {\n      return $tool->getId();\n    }\n    if (method_exists($tool, 'getPluginId')) {\n      return $tool->getPluginId();\n    }\n    if (isset($tool->id)) {\n      return $tool->id;\n    }\n    return 'unknown_tool';\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Integration/ToolApiIntegration.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ToolApiIntegration", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file views-bootstrap-grid.html.twig\n * Default simple view template to display Bootstrap Grids.\n *\n *\n * - columns: Contains rows grouped by columns.\n * - rows: Contains a nested array of rows. Each row contains an array of\n *   columns.\n * - column_type: Contains a number (default Bootstrap grid system column type).\n *\n * @ingroup views_templates\n */\n#}\n{%\n  set classes = [\n    'views-view-grid',\n    'row'\n  ]\n%}\n{% if title %}\n  <h3>{{ title }}</h3>\n{% endif %}\n<div id=\"{{ id }}\" {{ attributes.addClass(classes) }}>\n    {% for row in rows %}\n      <div{{ row.attributes }}>\n      {{- row.content -}}\n      </div>\n    {% endfor %}\n</div>\n", "metadata": {"source": "repos/bootstrap_five_layouts/modules/bootstrap_five_layouts_viewsstyle/templates/bootstrap-five-layouts-viewsstyle-grid.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: YamlDirectoryDiscovery\nSource file: <source_file>\nFile name hint: YamlDirectoryDiscovery.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Plugin\\Discovery;\n\nuse Drupal\\Component\\Discovery\\YamlDirectoryDiscovery as ComponentYamlDirectoryDiscovery;\n\n/**\n * Allows multiple YAML files per directory to define plugin definitions.\n */\nclass YamlDirectoryDiscovery extends YamlDiscovery {\n\n  /**\n   * Constructs a YamlDirectoryDiscovery object.\n   *\n   * @param array $directories\n   *   An array of directories to scan, keyed by the provider. The value can\n   *   either be a string or an array of strings. The string values should be\n   *   the path of a directory to scan.\n   * @param string $file_cache_key_suffix\n   *   The file cache key suffix. This should be unique for each type of\n   *   discovery.\n   * @param string $key\n   *   (optional) The key contained in the discovered data that identifies it.\n   *   Defaults to 'id'.\n   */\n  public function __construct(array $directories, $file_cache_key_suffix, $key = 'id') {\n    // Intentionally does not call parent constructor as this class uses a\n    // different YAML discovery.\n    $this->discovery = new ComponentYamlDirectoryDiscovery($directories, $file_cache_key_suffix, $key);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin\\Discovery;\n\nuse Drupal\\Component\\Discovery\\YamlDirectoryDiscovery as ComponentYamlDirectoryDiscovery;\n\n/**\n * Allows multiple YAML files per directory to define plugin definitions.\n */\nclass YamlDirectoryDiscovery extends YamlDiscovery {\n\n  /**\n   * Constructs a YamlDirectoryDiscovery object.\n   *\n   * @param array $directories\n   *   An array of directories to scan, keyed by the provider. The value can\n   *   either be a string or an array of strings. The string values should be\n   *   the path of a directory to scan.\n   * @param string $file_cache_key_suffix\n   *   The file cache key suffix. This should be unique for each type of\n   *   discovery.\n   * @param string $key\n   *   (optional) The key contained in the discovered data that identifies it.\n   *   Defaults to 'id'.\n   */\n  public function __construct(array $directories, $file_cache_key_suffix, $key = 'id') {\n    // Intentionally does not call parent constructor as this class uses a\n    // different YAML discovery.\n    $this->discovery = new ComponentYamlDirectoryDiscovery($directories, $file_cache_key_suffix, $key);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/Discovery/YamlDirectoryDiscovery.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "YamlDirectoryDiscovery", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: PipelineEventSubscriber.php\nTarget symbol: class PipelineEventSubscriber\nNamespace: Drupal\\flowdrop_orchestration_connector\\EventSubscriber\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for PipelineEventSubscriber.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\orchestration\\Webhooks\n  - Psr\\Log\\LoggerInterface\n  - Symfony\\Component\\EventDispatcher\\EventSubscriberInterface\n  - Symfony\\Component\\EventDispatcher\\GenericEvent\n- Ensure these methods exist where relevant:\n  - __construct()\n  - dispatchWebhook()\n  - extractPipelineId()\n  - getSubscribedEvents()\n  - onRealTimeEvent()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_orchestration_connector\\EventSubscriber;\n\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\orchestration\\Webhooks;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\EventDispatcher\\GenericEvent;\n\n/**\n * Event subscriber for FlowDrop pipeline completion events.\n *\n * Listens to FlowDrop's real-time events and dispatches webhooks to registered\n * external platforms when workflows complete. This enables external automation\n * platforms to receive notifications about FlowDrop workflow execution results.\n *\n * Webhook registration:\n * - Platforms register webhooks via POST /orchestration/webhook/register\n * - Webhooks identified by ID (e.g., \"flowdrop::my_workflow__node_abc\")\n * - When a workflow completes, this subscriber dispatches to matching webhooks\n *\n * @see \\Drupal\\orchestration\\Webhooks\n * @see \\Drupal\\flowdrop_runtime\\Service\\RealTime\\EventBroadcaster\n */\nclass PipelineEventSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new PipelineEventSubscriber.\n   *\n   * @param \\Drupal\\orchestration\\Webhooks $webhooks\n   *   The orchestration webhooks service.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger service.\n   */\n  public function __construct(\n    protected Webhooks $webhooks,\n    protected EntityTypeManagerInterface $entityTypeManager,\n    protected LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      \"flowdrop_runtime.real_time_event\" => [\"onRealTimeEvent\", 0],\n    ];\n  }\n\n  /**\n   * Handle FlowDrop real-time events.\n   *\n   * @param \\Symfony\\Component\\EventDispatcher\\GenericEvent $event\n   *   The event containing real-time event data.\n   */\n  public function onRealTimeEvent(GenericEvent $event): void {\n    $type = $event->getArgument(\"type\");\n    $eventName = $event->getArgument(\"event\");\n    $executionId = $event->getArgument(\"execution_id\");\n    $data = $event->getArgument(\"data\");\n\n    // Only process execution-level completion events.\n    if ($type !== \"execution\") {\n      return;\n    }\n\n    // Handle completion events (completed, failed).\n    if ($eventName === \"completed\" || $eventName === \"failed\") {\n      $this->dispatchWebhook($executionId, $eventName, $data);\n    }\n  }\n\n  /**\n   * Dispatch a webhook for pipeline completion.\n   *\n   * @param string $executionId\n   *   The execution ID (usually pipeline ID).\n   * @param string $status\n   *   The completion status (completed, failed).\n   * @param array<string, mixed> $data\n   *   Additional event data.\n   */\n  protected function dispatchWebhook(string $executionId, string $status, array $data): void {\n    // Try to load the pipeline to get workflow and trigger info.\n    $pipelineStorage = $this->entityTypeManager->getStorage(\"flowdrop_pipeline\");\n\n    // Extract pipeline ID from execution ID if it follows our format.\n    $pipelineId = $this->extractPipelineId($executionId);\n    if ($pipelineId === NULL) {\n      return;\n    }\n\n    $pipeline = $pipelineStorage->load($pipelineId);\n    if ($pipeline === NULL) {\n      return;\n    }\n\n    // Get workflow ID for webhook routing.\n    /** @var \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline */\n    $workflowId = $pipeline->getWorkflowId();\n\n    // Check if this pipeline was triggered via orchestration.\n    // Look for orchestration source in execution context or input data.\n    $inputData = $pipeline->getInputData();\n    $triggerConfigId = $inputData[\"trigger_config_id\"] ?? NULL;\n\n    if ($triggerConfigId === NULL) {\n      // Not an orchestration-triggered pipeline.\n      return;\n    }\n\n    // Build webhook ID - matches what external platforms register.\n    $webhookId = \"flowdrop::{$triggerConfigId}\";\n\n    // Build payload for the webhook.\n    $payload = [\n      \"event\" => \"workflow.{$status}\",\n      \"timestamp\" => time(),\n      \"execution_id\" => $executionId,\n      \"pipeline_id\" => $pipelineId,\n      \"workflow_id\" => $workflowId,\n      \"trigger_config_id\" => $triggerConfigId,\n      \"status\" => $status,\n      \"output\" => $pipeline->getOutputData(),\n      \"error\" => $status === \"failed\" ? ($pipeline->getErrorMessage() ?: ($data[\"error\"] ?? NULL)) : NULL,\n      \"execution_time\" => $data[\"execution_time\"] ?? NULL,\n    ];\n\n    $this->logger->info(\"Dispatching webhook @webhook for pipeline @pipeline (@status)\", [\n      \"@webhook\" => $webhookId,\n      \"@pipeline\" => $pipelineId,\n      \"@status\" => $status,\n    ]);\n\n    // Dispatch to the registered webhook URL.\n    $this->webhooks->dispatch($webhookId, $payload);\n  }\n\n  /**\n   * Extract pipeline ID from execution ID.\n   *\n   * Execution IDs may follow different formats. This method attempts to\n   * extract the pipeline ID from common patterns.\n   *\n   * @param string $executionId\n   *   The execution ID.\n   *\n   * @return string|null\n   *   The pipeline ID or NULL if not extractable.\n   */\n  protected function extractPipelineId(string $executionId): ?string {\n    // Pattern: pipeline_workflowid_timestamp or similar.\n    // If the execution ID is numeric, it's likely the pipeline ID directly.\n    if (is_numeric($executionId)) {\n      return $executionId;\n    }\n\n    // Try to extract from pattern: pipeline_X_Y or exec_X.\n    if (preg_match(\"/^pipeline_(\\d+)/\", $executionId, $matches)) {\n      return $matches[1];\n    }\n\n    // The execution ID might be the pipeline ID itself.\n    // Check if it exists in the database.\n    return $executionId;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_orchestration_connector/src/EventSubscriber/PipelineEventSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PipelineEventSubscriber", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class HelpHook in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Hook;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Attribute\\Hook;\n\n/**\n * Hook implementations for hook_help().\n *\n * Provides help text for the API Normalization module.\n */\nclass HelpHook {\n\n  /**\n   * Implements hook_help().\n   *\n   * @param string $route_name\n   *   The route name for the current page.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match object.\n   *\n   * @return string|null\n   *   A render array containing help text, or NULL if no help is available.\n   */\n  #[Hook('help')]\n  public function help(string $route_name, RouteMatchInterface $route_match): ?string {\n    // Delegate to the procedural implementation for now.\n    // This allows gradual migration while maintaining backward compatibility.\n    return api_normalization_help($route_name, $route_match);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Hook/HelpHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpHook", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ReadOnlyModeMethodFilter.php\nTarget symbol: class ReadOnlyModeMethodFilter\nNamespace: Drupal\\jsonapi\\Routing\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ReadOnlyModeMethodFilter.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Routing\\FilterInterface\n  - Drupal\\Core\\Url\n  - Symfony\\Component\\HttpFoundation\\Request\n  - Symfony\\Component\\HttpKernel\\Exception\\MethodNotAllowedHttpException\n  - Symfony\\Component\\Routing\\RouteCollection\n- Ensure these methods exist where relevant:\n  - __construct()\n  - filter()", "output": "<?php\n\nnamespace Drupal\\jsonapi\\Routing;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\FilterInterface;\nuse Drupal\\Core\\Url;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Exception\\MethodNotAllowedHttpException;\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Filters routes based on the HTTP method and JSON:API's read-only mode.\n */\nclass ReadOnlyModeMethodFilter implements FilterInterface {\n\n  /**\n   * The decorated method filter.\n   *\n   * @var \\Drupal\\Core\\Routing\\FilterInterface\n   */\n  protected $inner;\n\n  /**\n   * Whether JSON:API's read-only mode is enabled.\n   *\n   * @var bool\n   */\n  protected $readOnlyModeIsEnabled;\n\n  /**\n   * ReadOnlyModeMethodFilter constructor.\n   *\n   * @param \\Drupal\\Core\\Routing\\FilterInterface $inner\n   *   The decorated method filter.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The configuration factory.\n   */\n  public function __construct(FilterInterface $inner, ConfigFactoryInterface $config_factory) {\n    $this->inner = $inner;\n    $this->readOnlyModeIsEnabled = $config_factory->get('jsonapi.settings')->get('read_only');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function filter(RouteCollection $collection, Request $request) {\n    $all_supported_methods = [];\n    foreach ($collection->all() as $name => $route) {\n      $all_supported_methods[] = $route->getMethods();\n    }\n\n    $all_supported_methods = array_merge(...$all_supported_methods);\n    $collection = $this->inner->filter($collection, $request);\n\n    if (!$this->readOnlyModeIsEnabled) {\n      return $collection;\n    }\n\n    $read_only_methods = ['GET', 'HEAD', 'OPTIONS', 'TRACE'];\n    foreach ($collection->all() as $name => $route) {\n      if (!$route->hasDefault(Routes::JSON_API_ROUTE_FLAG_KEY)) {\n        continue;\n      }\n\n      $supported_methods = $route->getMethods();\n      assert(count($supported_methods) > 0, 'JSON:API routes always have a method specified.');\n      $is_read_only_route = empty(array_diff($supported_methods, $read_only_methods));\n      if (!$is_read_only_route) {\n        $collection->remove($name);\n      }\n    }\n    if (count($collection)) {\n      return $collection;\n    }\n    throw new MethodNotAllowedHttpException(array_intersect($all_supported_methods, $read_only_methods), sprintf(\"JSON:API is configured to accept only read operations. Site administrators can configure this at %s.\", Url::fromRoute('jsonapi.settings')->setAbsolute()->toString(TRUE)->getGeneratedUrl()));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/Routing/ReadOnlyModeMethodFilter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ReadOnlyModeMethodFilter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class WorkspaceDeleteForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\workspaces_ui\\Form;\n\nuse Drupal\\Component\\Datetime\\TimeInterface;\nuse Drupal\\Core\\Entity\\ContentEntityDeleteForm;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\workspaces\\WorkspaceTrackerInterface;\nuse Drupal\\workspaces\\WorkspaceRepositoryInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a form for deleting a workspace.\n *\n * @internal\n */\nclass WorkspaceDeleteForm extends ContentEntityDeleteForm {\n\n  /**\n   * The workspace entity.\n   *\n   * @var \\Drupal\\workspaces\\WorkspaceInterface\n   */\n  protected $entity;\n\n  /**\n   * The workspace tracker service.\n   *\n   * @var \\Drupal\\workspaces\\WorkspaceTrackerInterface\n   */\n  protected $workspaceTracker;\n\n  /**\n   * The workspace repository service.\n   *\n   * @var \\Drupal\\workspaces\\WorkspaceRepositoryInterface\n   */\n  protected $workspaceRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity.repository'),\n      $container->get('workspaces.tracker'),\n      $container->get('workspaces.repository'),\n      $container->get('entity_type.bundle.info'),\n      $container->get('datetime.time')\n    );\n  }\n\n  /**\n   * Constructs a WorkspaceDeleteForm object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository service.\n   * @param \\Drupal\\workspaces\\WorkspaceTrackerInterface $workspace_tracker\n   *   The workspace tracker service to check how many revisions will be\n   *   deleted.\n   * @param \\Drupal\\workspaces\\WorkspaceRepositoryInterface $workspace_repository\n   *   The workspace repository service.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface $entity_type_bundle_info\n   *   The entity type bundle service.\n   * @param \\Drupal\\Component\\Datetime\\TimeInterface $time\n   *   The time service.\n   */\n  public function __construct(EntityRepositoryInterface $entity_repository, WorkspaceTrackerInterface $workspace_tracker, WorkspaceRepositoryInterface $workspace_repository, ?EntityTypeBundleInfoInterface $entity_type_bundle_info = NULL, ?TimeInterface $time = NULL) {\n    parent::__construct($entity_repository, $entity_type_bundle_info, $time);\n    $this->workspaceTracker = $workspace_tracker;\n    $this->workspaceRepository = $workspace_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form = parent::buildForm($form, $form_state);\n\n    $workspace_tree = $this->workspaceRepository->loadTree();\n    if (!empty($workspace_tree[$this->entity->id()]['descendants'])) {\n      $form['description']['#markup'] = $this->t('The %label workspace can not be deleted because it has child workspaces.', [\n        '%label' => $this->entity->label(),\n      ]);\n      $form['actions']['submit']['#disabled'] = TRUE;\n\n      return $form;\n    }\n\n    $tracked_entities = $this->workspaceTracker->getTrackedEntities($this->entity->id());\n    $items = [];\n    foreach ($tracked_entities as $entity_type_id => $entity_ids) {\n      $revision_ids = $this->workspaceTracker->getAllTrackedRevisions($this->entity->id(), $entity_type_id, $entity_ids);\n      $label = $this->entityTypeManager->getDefinition($entity_type_id)->getLabel();\n      $items[] = $this->formatPlural(count($revision_ids), '1 @label revision.', '@count @label revisions.', ['@label' => $label]);\n    }\n    $form['revisions'] = [\n      '#theme' => 'item_list',\n      '#title' => $this->t('The following will also be deleted:'),\n      '#items' => $items,\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription() {\n    return $this->t('This action cannot be undone, and will also delete all content created in this workspace.');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces_ui/src/Form/WorkspaceDeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WorkspaceDeleteForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface FileMediaFormatterInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\file\\Plugin\\Field\\FieldFormatter;\n\n/**\n * Defines getter methods for FileMediaFormatterBase.\n *\n * This interface is used on the FileMediaFormatterBase class to ensure that\n * each file media formatter will be based on a media type.\n *\n * Abstract classes are not able to implement abstract static methods,\n * this interface will work around that.\n *\n * @see \\Drupal\\file\\Plugin\\Field\\FieldFormatter\\FileMediaFormatterBase\n */\ninterface FileMediaFormatterInterface {\n\n  /**\n   * Gets the applicable media type for a formatter.\n   *\n   * @return string\n   *   The media type of this formatter.\n   */\n  public static function getMediaType();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Field/FieldFormatter/FileMediaFormatterInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FileMediaFormatterInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for Menu footer block.\n */\n#}\n{%\n  set classes = [\n    'block',\n    'block-' ~ configuration.provider|clean_class,\n    'block-' ~ plugin_id|clean_class,\n  ]\n%}\n\n{% embed \"umami:footer-block\" with {\n  attributes: attributes.addClass(classes),\n  content,\n  label,\n  title_attributes,\n  title_prefix,\n  title_suffix,\n} only %}\n  {% block content %}\n    {% embed \"umami:title\" with {\n      attributes: title_attributes.addClass('footer-block__title'),\n      label: label ? label : content.field_title,\n      title_prefix,\n      title_suffix,\n    } only %}\n      {% block title_prefix %}\n        {{ title_prefix }}\n      {% endblock %}\n      {% block title_suffix %}\n        {{ title_suffix }}\n      {% endblock %}\n    {% endembed %}\n    {{ content }}\n  {% endblock %}\n{% endembed %}\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/components/navigation/block--system-menu-block--footer.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class IconPackConfigErrorException in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Theme\\Icon\\Exception;\n\n/**\n * Raised when we have an icon pack error.\n *\n * @internal\n *   This API is experimental.\n */\nclass IconPackConfigErrorException extends \\Exception {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/Icon/Exception/IconPackConfigErrorException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "IconPackConfigErrorException", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GetEntitySettings in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_sitemap\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_sitemap\\Service\\SitemapService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_sitemap_entity_settings',\n  label: new TranslatableMarkup('Get Entity Sitemap Settings'),\n  description: new TranslatableMarkup('Get sitemap inclusion settings for an entity type and optionally a specific bundle.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup('The entity type ID (e.g., \"node\", \"taxonomy_term\", \"media\").'),\n      required: TRUE,\n    ),\n    'bundle' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup('Optional: specific bundle to get settings for (e.g., \"article\", \"page\").'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'bundle' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Bundle'),\n      description: new TranslatableMarkup(''),\n    ),\n    'settings' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Sitemap Settings'),\n      description: new TranslatableMarkup(''),\n    ),\n    'bundles' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('All Bundle Settings'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetEntitySettings extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'sitemap';\n\n\n  protected SitemapService $sitemapService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->sitemapService = $container->get('mcp_tools_sitemap.sitemap');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? '';\n    $bundle = $input['bundle'] ?? NULL;\n\n    if (empty($entityType)) {\n      return ['success' => FALSE, 'error' => 'Entity type is required.'];\n    }\n\n    return $this->sitemapService->getEntitySettings($entityType, $bundle);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_sitemap/src/Plugin/tool/Tool/GetEntitySettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetEntitySettings", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Action in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines an Action annotation object.\n *\n * Plugin Namespace: Plugin\\Action\n *\n * @see \\Drupal\\Core\\Action\\ActionInterface\n * @see \\Drupal\\Core\\Action\\ActionManager\n * @see \\Drupal\\Core\\Action\\ActionBase\n * @see \\Drupal\\Core\\Action\\Plugin\\Action\\UnpublishAction\n * @see plugin_api\n *\n * @Annotation\n */\nclass Action extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The human-readable name of the action plugin.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * The route name for a confirmation form for this action.\n   *\n   * This property is optional and it does not need to be declared.\n   *\n   * @var string\n   *\n   * @todo Provide a more generic way to allow an action to be confirmed first.\n   */\n  public $confirm_form_route_name = '';\n\n  /**\n   * The entity type the action can apply to.\n   *\n   * @var string\n   *\n   * @todo Replace with \\Drupal\\Core\\Plugin\\Context\\Context.\n   */\n  public $type = '';\n\n  /**\n   * The category under which the action should be listed in the UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $category;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Annotation/Action.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Action", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CountryTokens in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Provides Token integration for country.\n */\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Render\\BubbleableMetadata;\n\n/**\n * Implements hook_token_info().\n */\nfunction country_token_info() {\n  if (!\\Drupal::hasService('token.entity_mapper')) {\n    return;\n  }\n\n  $types = [];\n  $tokens = [];\n  foreach (\\Drupal::entityTypeManager()->getDefinitions() as $entity_type_id => $entity_type) {\n    if (!$entity_type->entityClassImplements(ContentEntityInterface::class)) {\n      continue;\n    }\n    $token_type = \\Drupal::service('token.entity_mapper')->getTokenTypeForEntityType($entity_type_id);\n    if (empty($token_type)) {\n      continue;\n    }\n\n    // Build country name tokens for all country fields.\n    $fields = \\Drupal::service('entity_field.manager')->getFieldStorageDefinitions($entity_type_id);\n    foreach ($fields as $field_name => $field) {\n      if ($field->getType() != 'country') {\n        continue;\n      }\n\n      $tokens[$token_type . '-' . $field_name]['country_original_name'] = [\n        'name' => t('The country name'),\n        'description' => NULL,\n        'module' => 'country',\n      ];\n    }\n  }\n\n  return [\n    'types' => $types,\n    'tokens' => $tokens,\n  ];\n}\n\n/**\n * Implements hook_tokens().\n */\nfunction country_tokens($type, $tokens, array $data, array $options, BubbleableMetadata $bubbleable_metadata) {\n  $replacements = [];\n\n  if (!empty($data['field_property'])) {\n    foreach ($tokens as $token => $original) {\n      $delta = 0;\n      $parts = explode(':', $token);\n      if (is_numeric($parts[0])) {\n        if (count($parts) > 1) {\n          $delta = $parts[0];\n          $property_name = $parts[1];\n        }\n        else {\n          continue;\n        }\n      }\n      else {\n        $property_name = $parts[0];\n      }\n      if ($property_name != 'country_original_name') {\n        continue;\n      }\n      if (!isset($data[$data['field_name']][$delta])) {\n        continue;\n      }\n\n      $field_item = $data[$data['field_name']][$delta];\n\n      $country_name = \"\";\n      if ($country_code = $field_item->value) {\n        $field_definition = $field_item->getFieldDefinition();\n        $countries = \\Drupal::service('country.field.manager')->getSelectableCountries($field_definition);\n        $country_name = $countries[$country_code];\n      }\n      $replacements[$original] = $country_name->render();\n    }\n  }\n\n  return $replacements;\n}\n", "metadata": {"source": "repos/country/country.tokens.inc", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CountryTokens", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Random\nSource file: <source_file>\nFile name hint: Random.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\sort;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\UncacheableDependencyTrait;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsSort;\n\n/**\n * Handle a random sort.\n */\n#[ViewsSort(\"random\")]\nclass Random extends SortPluginBase implements CacheableDependencyInterface {\n\n  use UncacheableDependencyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesGroupBy() {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $this->query->addOrderBy('rand');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['order']['#access'] = FALSE;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\sort;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\UncacheableDependencyTrait;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsSort;\n\n/**\n * Handle a random sort.\n */\n#[ViewsSort(\"random\")]\nclass Random extends SortPluginBase implements CacheableDependencyInterface {\n\n  use UncacheableDependencyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesGroupBy() {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $this->query->addOrderBy('rand');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['order']['#access'] = FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/sort/Random.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Random", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: SiteMaintenanceModeForm\nSource file: <source_file>\nFile name hint: SiteMaintenanceModeForm.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\TypedConfigManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Url;\nuse Drupal\\user\\PermissionHandlerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configure maintenance settings for this site.\n *\n * @internal\n */\nclass SiteMaintenanceModeForm extends ConfigFormBase {\n\n  /**\n   * The state keyvalue collection.\n   *\n   * @var \\Drupal\\Core\\State\\StateInterface\n   */\n  protected $state;\n\n  /**\n   * The permission handler.\n   *\n   * @var \\Drupal\\user\\PermissionHandlerInterface\n   */\n  protected $permissionHandler;\n\n  /**\n   * Constructs a new SiteMaintenanceModeForm.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The factory for configuration objects.\n   * @param \\Drupal\\Core\\Config\\TypedConfigManagerInterface $typedConfigManager\n   *   The typed config manager.\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state keyvalue collection to use.\n   * @param \\Drupal\\user\\PermissionHandlerInterface $permission_handler\n   *   The permission handler.\n   */\n  function __construct(ConfigFactoryInterface $config_factory, TypedConfigManagerInterface $typedConfigManager, StateInterface $state, PermissionHandlerInterface $permission_handler) {\n    parent::__construct($config_factory, $typedConfigManager);\n    $this->state = $state;\n    $this->permissionHandler = $permission_handler;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('config.factory'),\n      $container->get('config.typed'),\n      $container->get('state'),\n      $container->get('user.permissions')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'system_site_maintenance_mode';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['system.maintenance'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $permissions = $this->permissionHandler->getPermissions();\n    $permission_label = $permissions['access site in maintenance mode']['title'];\n    $form['maintenance_mode'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Put site into maintenance mode'),\n      '#default_value' => $this->state->get('system.maintenance_mode'),\n      '#description' => $this->t('Visitors will only see the maintenance mode message. Only users with the \"@permission-label\" <a href=\":permissions-url\">permission</a> will be able to access the site. Authorized users can log in directly via the <a href=\":user-login\">user login</a> page.', [\n        '@permission-label' => $permission_label,\n        ':permissions-url' => Url::fromRoute('user.admin_permissions')\n          ->toString(),\n        ':user-login' => Url::fromRoute('user.login')->toString(),\n      ]),\n    ];\n    $form['maintenance_mode_message'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Message to display when in maintenance mode'),\n      '#config_target' => 'system.maintenance:message',\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->state->set('system.maintenance_mode', $form_state->getValue('maintenance_mode'));\n    parent::submitForm($form, $form_state);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\TypedConfigManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\State\\StateInterface;\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Url;\nuse Drupal\\user\\PermissionHandlerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configure maintenance settings for this site.\n *\n * @internal\n */\nclass SiteMaintenanceModeForm extends ConfigFormBase {\n\n  /**\n   * The state keyvalue collection.\n   *\n   * @var \\Drupal\\Core\\State\\StateInterface\n   */\n  protected $state;\n\n  /**\n   * The permission handler.\n   *\n   * @var \\Drupal\\user\\PermissionHandlerInterface\n   */\n  protected $permissionHandler;\n\n  /**\n   * Constructs a new SiteMaintenanceModeForm.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The factory for configuration objects.\n   * @param \\Drupal\\Core\\Config\\TypedConfigManagerInterface $typedConfigManager\n   *   The typed config manager.\n   * @param \\Drupal\\Core\\State\\StateInterface $state\n   *   The state keyvalue collection to use.\n   * @param \\Drupal\\user\\PermissionHandlerInterface $permission_handler\n   *   The permission handler.\n   */\n  public function __construct(ConfigFactoryInterface $config_factory, TypedConfigManagerInterface $typedConfigManager, StateInterface $state, PermissionHandlerInterface $permission_handler) {\n    parent::__construct($config_factory, $typedConfigManager);\n    $this->state = $state;\n    $this->permissionHandler = $permission_handler;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('config.factory'),\n      $container->get('config.typed'),\n      $container->get('state'),\n      $container->get('user.permissions')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'system_site_maintenance_mode';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['system.maintenance'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $permissions = $this->permissionHandler->getPermissions();\n    $permission_label = $permissions['access site in maintenance mode']['title'];\n    $form['maintenance_mode'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Put site into maintenance mode'),\n      '#default_value' => $this->state->get('system.maintenance_mode'),\n      '#description' => $this->t('Visitors will only see the maintenance mode message. Only users with the \"@permission-label\" <a href=\":permissions-url\">permission</a> will be able to access the site. Authorized users can log in directly via the <a href=\":user-login\">user login</a> page.', [\n        '@permission-label' => $permission_label,\n        ':permissions-url' => Url::fromRoute('user.admin_permissions')\n          ->toString(),\n        ':user-login' => Url::fromRoute('user.login')->toString(),\n      ]),\n    ];\n    $form['maintenance_mode_message'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Message to display when in maintenance mode'),\n      '#config_target' => 'system.maintenance:message',\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->state->set('system.maintenance_mode', $form_state->getValue('maintenance_mode'));\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/SiteMaintenanceModeForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SiteMaintenanceModeForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LoggingSettingsForm.php\nTarget symbol: class LoggingSettingsForm\nNamespace: Drupal\\db_wipe_entity\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LoggingSettingsForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - buildForm()\n  - getEditableConfigNames()\n  - getFormId()\n  - submitForm()", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configure logging settings for DB Wipe Entity.\n */\nclass LoggingSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'db_wipe_entity_logging_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['db_wipe_entity.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $config = $this->config('db_wipe_entity.settings');\n    $logging = $config->get('logging');\n\n    $form['logging'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Logging Settings'),\n      '#open' => TRUE,\n      '#tree' => TRUE,\n    ];\n\n    $form['logging']['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable logging'),\n      '#description' => $this->t('Log wipe operations to Drupal watchdog.'),\n      '#default_value' => $logging['enabled'] ?? TRUE,\n    ];\n\n    $form['logging']['what_to_log'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('What to log'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"logging[enabled]\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['logging']['what_to_log']['log_protected_attempts'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Protection rule matches'),\n      '#description' => $this->t('Log when entities are protected from deletion by rules.'),\n      '#default_value' => $logging['log_protected_attempts'] ?? TRUE,\n    ];\n\n    $form['logging']['what_to_log']['log_batch_progress'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Batch progress'),\n      '#description' => $this->t('Log progress during batch operations.'),\n      '#default_value' => $logging['log_batch_progress'] ?? FALSE,\n    ];\n\n    $form['logging']['what_to_log']['log_sql_queries'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('SQL queries (debug)'),\n      '#description' => $this->t('Log SQL queries in SQL Direct mode.'),\n      '#default_value' => $logging['log_sql_queries'] ?? FALSE,\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->config('db_wipe_entity.settings')\n      ->set('logging.enabled', $form_state->getValue(['logging', 'enabled']))\n      ->set(\n        'logging.log_protected_attempts',\n        $form_state->getValue(['logging', 'what_to_log', 'log_protected_attempts']),\n      )\n      ->set('logging.log_batch_progress', $form_state->getValue(['logging', 'what_to_log', 'log_batch_progress']))\n      ->set('logging.log_sql_queries', $form_state->getValue(['logging', 'what_to_log', 'log_sql_queries']))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Form/LoggingSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LoggingSettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface OptionsProviderInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData;\n\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Interface for retrieving all possible and settable values.\n *\n * While possible values specify which values existing data might have, settable\n * values define the values that are allowed to be set by a user.\n *\n * For example, in a workflow scenario, the settable values for a state field\n * might depend on the currently set state, while possible values are all\n * states. Thus settable values would be used in an editing context, while\n * possible values would be used for presenting filtering options in a search.\n *\n * For convenience, lists of both settable and possible values are also provided\n * as structured options arrays that can be used in an Options widget such as a\n * select box or checkboxes.\n *\n * Note that this interface is mostly applicable for primitive data values, but\n * can be used on complex data structures if a (primitive) main property is\n * specified. In that case, the allowed values and options apply to the main\n * property only.\n *\n * @see \\Drupal\\Core\\Field\\Plugin\\Field\\FieldWidget\\OptionsWidgetBase\n */\ninterface OptionsProviderInterface {\n\n  /**\n   * Returns an array of possible values.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values viewable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the possible values. If\n   *   omitted, all possible values are returned.\n   *\n   * @return array\n   *   An array of possible values.\n   */\n  public function getPossibleValues(?AccountInterface $account = NULL);\n\n  /**\n   * Returns an array of possible values with labels for display.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values viewable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the possible options.\n   *   If omitted, all possible options are returned.\n   *\n   * @return array\n   *   An array of possible options for the object that may be used in an\n   *   Options widget, for example when existing data should be filtered. It may\n   *   either be a flat array of option labels keyed by values, or a\n   *   two-dimensional array of option groups (array of flat option arrays,\n   *   keyed by option group label). Note that labels should NOT be sanitized.\n   */\n  public function getPossibleOptions(?AccountInterface $account = NULL);\n\n  /**\n   * Returns an array of settable values.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values settable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the settable values. If\n   *   omitted, all settable values are returned.\n   *\n   * @return array\n   *   An array of settable values.\n   */\n  public function getSettableValues(?AccountInterface $account = NULL);\n\n  /**\n   * Returns an array of settable values with labels for display.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values settable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the settable options. If\n   *   omitted, all settable options are returned.\n   *\n   * @return array\n   *   An array of settable options for the object that may be used in an\n   *   Options widget, usually when new data should be entered. It may either be\n   *   a flat array of option labels keyed by values, or a two-dimensional array\n   *   of option groups (array of flat option arrays, keyed by option group\n   *   label). Note that labels should NOT be sanitized.\n   */\n  public function getSettableOptions(?AccountInterface $account = NULL);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/OptionsProviderInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "OptionsProviderInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TranslationsDataCollector in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\webprofiler\\StringTranslation\\TranslationManagerWrapper;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\n\n/**\n * Collects translations data.\n */\nclass TranslationsDataCollector extends DataCollector implements HasPanelInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * TranslationsDataCollector constructor.\n   *\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $translation\n   *   The translation service.\n   */\n  public function __construct(\n    private readonly TranslationInterface $translation,\n  ) {\n    $this->data['translations']['translated'] = [];\n    $this->data['translations']['untranslated'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n    if ($this->translation instanceof TranslationManagerWrapper) {\n      $this->data['translations']['translated'] = $this->translation->getTranslated();\n      $this->data['translations']['untranslated'] = $this->translation->getUntranslated();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName() {\n    return 'translations';\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return the number of translated strings.\n   *\n   * @return int\n   *   The number of translated strings.\n   */\n  public function getTranslatedCount(): int {\n    return \\count($this->data['translations']['translated']);\n  }\n\n  /**\n   * Return the number of untranslated strings.\n   *\n   * @return int\n   *   The number of untranslated strings.\n   */\n  public function getUntranslatedCount(): int {\n    return \\count($this->data['translations']['untranslated']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    return [\n      '#theme' => 'webprofiler_dashboard_tabs',\n      '#tabs' => [\n        [\n          'label' => $this->t('Translated'),\n          'content' => $this->renderTranslated($this->data['translations']['translated']),\n        ],\n        [\n          'label' => $this->t('Untranslated'),\n          'content' => $this->renderUntranslated($this->data['translations']['untranslated']),\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Render a list of translated strings.\n   *\n   * @param array $translated\n   *   A list of translated strings.\n   *\n   * @return array\n   *   The render array of the list of translated strings.\n   */\n  private function renderTranslated(array $translated): array {\n    \\array_walk(\n      $translated,\n      static function (&$key, $data): void {\n        $key = [\n          $data,\n          $key,\n          [\n            'data' => [\n              '#type' => 'inline_template',\n              '#template' => '<a href=\"{{ link }}\" target=\"_blank\">{{ \"Edit\"|t }}</a>',\n              '#context' => [\n                'link' => Url::fromRoute('locale.translate_page', ['string' => $data])\n                  ->toString(),\n              ],\n            ],\n          ],\n        ];\n      },\n    );\n\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Original'),\n          $this->t('Translation'),\n          $this->t('Action'),\n        ],\n        '#rows' => $translated,\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n  /**\n   * Render a list of untranslated strings.\n   *\n   * @param array $untranslated\n   *   A list of untranslated strings.\n   *\n   * @return array\n   *   The render array of the list of untranslated strings.\n   */\n  private function renderUntranslated(array $untranslated): array {\n    \\array_walk(\n      $untranslated,\n      static function (&$key, $data): void {\n        $key = [\n          $data,\n          [\n            'data' => [\n              '#type' => 'inline_template',\n              '#template' => '<a href=\"{{ link }}\" target=\"_blank\">{{ \"Translate\"|t }}</a>',\n              '#context' => [\n                'link' => Url::fromRoute('locale.translate_page', ['string' => $data])\n                  ->toString(),\n              ],\n            ],\n          ],\n        ];\n      },\n    );\n\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Original'),\n          $this->t('Action'),\n        ],\n        '#rows' => $untranslated,\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/TranslationsDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TranslationsDataCollector", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ListRecipes in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_recipes\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_recipes\\Service\\RecipesService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_recipes_list',\n  label: new TranslatableMarkup('List Recipes'),\n  description: new TranslatableMarkup('List all available Drupal Recipes from site, core, and contrib sources.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'recipes' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Available Recipes'),\n      description: new TranslatableMarkup('List of available recipes with name, label, description, type, source, and path.'),\n    ),\n    'count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Recipe Count'),\n      description: new TranslatableMarkup('Total number of available recipes.'),\n    ),\n    'sources' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Recipe Sources'),\n      description: new TranslatableMarkup('List of directories where recipes were found.'),\n    ),\n  ],\n)]\nclass ListRecipes extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'recipes';\n\n\n  /**\n   * The recipes service.\n   */\n  protected RecipesService $recipesService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->recipesService = $container->get('mcp_tools_recipes.recipes');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->recipesService->listRecipes();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_recipes/src/Plugin/tool/Tool/ListRecipes.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListRecipes", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Email in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Plugin\\DataType;\n\nuse Drupal\\Core\\Serialization\\Attribute\\JsonSchema;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\TypedData\\Attribute\\DataType;\nuse Drupal\\Core\\TypedData\\Type\\StringInterface;\n\n/**\n * The Email data type.\n *\n * The plain value of Email is the email address represented as PHP string.\n */\n#[DataType(\n  id: \"email\",\n  label: new TranslatableMarkup(\"Email\"),\n  constraints: [\"Email\" => []],\n)]\nclass Email extends StringData implements StringInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  #[JsonSchema(['type' => 'string', 'format' => 'email'])]\n  public function getCastedValue() {\n    return parent::getCastedValue();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Plugin/DataType/Email.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Email", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DirectoryWithMetadataPluginDiscovery\nSource file: <source_file>\nFile name hint: DirectoryWithMetadataPluginDiscovery.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Plugin\\Discovery;\n\nuse Drupal\\Core\\File\\FileSystemInterface;\n\n/**\n * Discover directories that contain a specific metadata file.\n */\nclass DirectoryWithMetadataPluginDiscovery extends YamlDiscovery {\n\n  /**\n   * Constructs a DirectoryWithMetadataPluginDiscovery object.\n   *\n   * @param array $directories\n   *   An array of directories to scan, keyed by the provider. The value can\n   *   either be a string or an array of strings. The string values should be\n   *   the path of a directory to scan.\n   * @param string $file_cache_key_suffix\n   *   The file cache key suffix. This should be unique for each type of\n   *   discovery.\n   * @param \\Drupal\\Core\\File\\FileSystemInterface|null $file_system\n   *   The file system service.\n   */\n  public function __construct(array $directories, $file_cache_key_suffix, ?FileSystemInterface $file_system = NULL) {\n    // Intentionally does not call parent constructor as this class uses a\n    // different YAML discovery.\n    if ($file_system) {\n      @trigger_error(sprintf('Passing the $fileSystem parameter to %s() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. The class no longer uses the file system service. See https://www.drupal.org/node/3530869', __METHOD__), E_USER_DEPRECATED);\n    }\n    $this->discovery = new DirectoryWithMetadataDiscovery($directories, $file_cache_key_suffix);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin\\Discovery;\n\nuse Drupal\\Core\\File\\FileSystemInterface;\n\n/**\n * Discover directories that contain a specific metadata file.\n */\nclass DirectoryWithMetadataPluginDiscovery extends YamlDiscovery {\n\n  /**\n   * Constructs a DirectoryWithMetadataPluginDiscovery object.\n   *\n   * @param array $directories\n   *   An array of directories to scan, keyed by the provider. The value can\n   *   either be a string or an array of strings. The string values should be\n   *   the path of a directory to scan.\n   * @param string $file_cache_key_suffix\n   *   The file cache key suffix. This should be unique for each type of\n   *   discovery.\n   * @param \\Drupal\\Core\\File\\FileSystemInterface|null $file_system\n   *   The file system service.\n   */\n  public function __construct(array $directories, $file_cache_key_suffix, ?FileSystemInterface $file_system = NULL) {\n    // Intentionally does not call parent constructor as this class uses a\n    // different YAML discovery.\n    if ($file_system) {\n      @trigger_error(sprintf('Passing the $fileSystem parameter to %s() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. The class no longer uses the file system service. See https://www.drupal.org/node/3530869', __METHOD__), E_USER_DEPRECATED);\n    }\n    $this->discovery = new DirectoryWithMetadataDiscovery($directories, $file_cache_key_suffix);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/Discovery/DirectoryWithMetadataPluginDiscovery.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DirectoryWithMetadataPluginDiscovery", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the trait EntityKeyTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eb\\Service\\Traits;\n\n/**\n * Provides methods for generating entity keys from operations.\n *\n * This trait consolidates entity key generation logic used across\n * DependencyResolver, ChangeDetector, and other services.\n */\ntrait EntityKeyTrait {\n\n  /**\n   * Generate canonical entity key for dependency tracking.\n   *\n   * Keys follow the format: \"type:entity_type:bundle:field_name\" etc.\n   *\n   * @param array<string, mixed> $operation\n   *   Operation data.\n   * @param int|null $index\n   *   Optional operation index for uniqueness.\n   *\n   * @return string\n   *   Canonical key like \"bundle:node:article\" or \"field:node:article:body\".\n   */\n  protected function makeEntityKey(array $operation, ?int $index = NULL): string {\n    $operationType = $operation['operation'] ?? '';\n\n    if (in_array($operationType, ['create_bundle', 'update_bundle'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundleId = $operation['bundle_id'] ?? '';\n      return \"bundle:{$entityType}:{$bundleId}\";\n    }\n\n    if (in_array($operationType, ['create_field', 'update_field'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $fieldName = $operation['field_name'] ?? '';\n      return \"field:{$entityType}:{$bundle}:{$fieldName}\";\n    }\n\n    if (in_array($operationType, ['configure_form_mode', 'configure_view_mode'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $displayMode = $operation['display_mode'] ?? 'default';\n      $fieldName = $operation['field_name'] ?? '';\n      $displayType = $operationType === 'configure_form_mode' ? 'form' : 'view';\n      return \"display:{$displayType}:{$entityType}:{$bundle}:{$displayMode}:{$fieldName}\";\n    }\n\n    if ($operationType === 'create_menu') {\n      $menuId = $operation['menu_id'] ?? '';\n      return \"menu:{$menuId}\";\n    }\n\n    if ($operationType === 'create_menu_link') {\n      $menuId = $operation['menu_id'] ?? '';\n      $title = $operation['title'] ?? '';\n      return \"menu_link:{$menuId}:{$title}\";\n    }\n\n    if (in_array($operationType, ['create_field_group', 'update_field_group'])) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $groupName = $operation['group_name'] ?? '';\n      $displayMode = $operation['display_mode'] ?? 'default';\n      $context = $operation['context'] ?? 'form';\n      return \"field_group:{$context}:{$entityType}:{$bundle}:{$displayMode}:{$groupName}\";\n    }\n\n    // Fallback for unknown operation types.\n    $suffix = $index !== NULL ? \":{$index}\" : ':0';\n    return \"operation:{$operationType}{$suffix}\";\n  }\n\n  /**\n   * Get human-readable entity key for error messages.\n   *\n   * @param array<string, mixed> $operation\n   *   Operation data.\n   *\n   * @return string\n   *   Human-readable key like \"Bundle node.article\".\n   */\n  protected function getHumanReadableEntityKey(array $operation): string {\n    $operationType = $operation['operation'] ?? '';\n\n    if (str_contains($operationType, 'bundle')) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundleId = $operation['bundle_id'] ?? '';\n      return \"Bundle {$entityType}.{$bundleId}\";\n    }\n\n    if (str_contains($operationType, 'field') && !str_contains($operationType, 'field_group')) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $fieldName = $operation['field_name'] ?? '';\n      return \"Field {$entityType}.{$bundle}.{$fieldName}\";\n    }\n\n    if (str_contains($operationType, 'field_group')) {\n      $entityType = $operation['entity_type'] ?? '';\n      $bundle = $operation['bundle'] ?? '';\n      $groupName = $operation['group_name'] ?? '';\n      return \"Field Group {$entityType}.{$bundle}.{$groupName}\";\n    }\n\n    if (str_contains($operationType, 'menu')) {\n      $menuId = $operation['menu_id'] ?? '';\n      return \"Menu {$menuId}\";\n    }\n\n    return \"Entity\";\n  }\n\n}\n", "metadata": {"source": "repos/eb/src/Service/Traits/EntityKeyTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "EntityKeyTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: JsOptimizer\nSource file: <source_file>\nFile name hint: JsOptimizer.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Asset;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Utility\\Error;\nuse Peast\\Formatter\\Compact as CompactFormatter;\nuse Peast\\Peast;\nuse Peast\\Renderer;\nuse Peast\\Syntax\\Exception as PeastSyntaxException;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Optimizes a JavaScript asset.\n */\nclass JsOptimizer implements AssetOptimizerInterface {\n\n  /**\n   * Constructs a new JsOptimizer object.\n   *\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(protected readonly LoggerInterface $logger) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function optimize(array $js_asset) {\n    if ($js_asset['type'] !== 'file') {\n      throw new \\Exception(\"Error trying to optimize JavaScript asset: {$js_asset['data']}. Only file JavaScript assets can be optimized.\");\n    }\n    // Note, that files with \"preprocess\" set to FALSE should never even enter\n    // this method.\n    if (!$js_asset['preprocess']) {\n      throw new \\Exception(\"Error trying to optimize JavaScript asset: {$js_asset['data']}. Only file JavaScript assets with preprocessing enabled can be optimized.\");\n    }\n\n    // If a BOM is found, convert the file to UTF-8, then use substr() to\n    // remove the BOM from the result.\n    $data = file_get_contents($js_asset['data']);\n    if ($encoding = (Unicode::encodingFromBOM($data))) {\n      $data = mb_substr(Unicode::convertToUtf8($data, $encoding), 1);\n    }\n    // If no BOM is found, check for the charset attribute.\n    elseif (isset($js_asset['attributes']['charset'])) {\n      $data = Unicode::convertToUtf8($data, $js_asset['attributes']['charset']);\n    }\n    // Remove comments, whitespace, and optional braces.\n    try {\n      $ast = Peast::latest($data)->parse();\n      $renderer = new Renderer();\n      $renderer->setFormatter(new CompactFormatter());\n      return $renderer->render($ast);\n    }\n    catch (\\Exception $exception) {\n      if ($exception instanceof PeastSyntaxException) {\n        $position = $exception->getPosition();\n        Error::logException($this->logger, $exception, 'Syntax error:  @message, File: @asset_file, Line: @asset_line, Column: @asset_column, Index: @asset_index', [\n          '@asset_file' => $js_asset['data'],\n          '@asset_line' => $position->getLine(),\n          '@asset_column' => $position->getColumn(),\n          '@asset_index' => $position->getIndex(),\n        ]);\n      }\n      else {\n        Error::logException($this->logger, $exception);\n      }\n      return $data;\n    }\n  }\n\n  /**\n   * Processes the contents of a javascript asset for cleanup.\n   *\n   * @param string $contents\n   *   The contents of the javascript asset.\n   *\n   * @return string\n   *   Contents of the javascript asset.\n   */\n  public function clean($contents) {\n    // Remove JS source and source mapping URLs or these may cause 404 errors.\n    $contents = preg_replace('/\\/\\/(#|@)\\s(sourceURL|sourceMappingURL)=\\s*(\\S*?)\\s*$/m', '', $contents);\n\n    return $contents;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Asset;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Utility\\Error;\nuse Peast\\Formatter\\Compact as CompactFormatter;\nuse Peast\\Peast;\nuse Peast\\Renderer;\nuse Peast\\Syntax\\Exception as PeastSyntaxException;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Optimizes a JavaScript asset.\n */\nclass JsOptimizer implements AssetOptimizerInterface {\n\n  /**\n   * Constructs a new JsOptimizer object.\n   *\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(protected readonly LoggerInterface $logger) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function optimize(array $js_asset) {\n    if ($js_asset['type'] !== 'file') {\n      throw new \\Exception(\"Error trying to optimize JavaScript asset: {$js_asset['data']}. Only file JavaScript assets can be optimized.\");\n    }\n    // Note, that files with \"preprocess\" set to FALSE should never even enter\n    // this method.\n    if (!$js_asset['preprocess']) {\n      throw new \\Exception(\"Error trying to optimize JavaScript asset: {$js_asset['data']}. Only file JavaScript assets with preprocessing enabled can be optimized.\");\n    }\n\n    // If a BOM is found, convert the file to UTF-8, then use substr() to\n    // remove the BOM from the result.\n    $data = file_get_contents($js_asset['data']);\n    if ($encoding = (Unicode::encodingFromBOM($data))) {\n      $data = mb_substr(Unicode::convertToUtf8($data, $encoding), 1);\n    }\n    // If no BOM is found, check for the charset attribute.\n    elseif (isset($js_asset['attributes']['charset'])) {\n      $data = Unicode::convertToUtf8($data, $js_asset['attributes']['charset']);\n    }\n    // Remove comments, whitespace, and optional braces.\n    try {\n      $ast = Peast::latest($data)->parse();\n      $renderer = new Renderer();\n      $renderer->setFormatter(new CompactFormatter());\n      return $renderer->render($ast);\n    }\n    catch (\\Exception $exception) {\n      if ($exception instanceof PeastSyntaxException) {\n        $position = $exception->getPosition();\n        Error::logException($this->logger, $exception, 'Syntax error:  @message, File: @asset_file, Line: @asset_line, Column: @asset_column, Index: @asset_index', [\n          '@asset_file' => $js_asset['data'],\n          '@asset_line' => $position->getLine(),\n          '@asset_column' => $position->getColumn(),\n          '@asset_index' => $position->getIndex(),\n        ]);\n      }\n      else {\n        Error::logException($this->logger, $exception);\n      }\n      return $data;\n    }\n  }\n\n  /**\n   * Processes the contents of a javascript asset for cleanup.\n   *\n   * @param string $contents\n   *   The contents of the javascript asset.\n   *\n   * @return string\n   *   Contents of the javascript asset.\n   */\n  public function clean($contents) {\n    // Remove JS source and source mapping URLs or these may cause 404 errors.\n    $contents = preg_replace('/\\/\\/(#|@)\\s(sourceURL|sourceMappingURL)=\\s*(\\S*?)\\s*$/m', '', $contents);\n\n    return $contents;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Asset/JsOptimizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "JsOptimizer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class AbstractFilterHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views_pretty_paths\\FilterHandlers;\n\nuse Drupal\\Component\\Utility\\UrlHelper;\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Defines AbstractFilterHandler class.\n */\nabstract class AbstractFilterHandler implements ViewsPrettyPathFilterHandlerInterface {\n\n  /**\n   * Database service.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $database;\n\n  /**\n   * Constructs AbstractFilterHandler object.\n   */\n  public function __construct(Connection $connection) {\n    $this->database = $connection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetedFilterPluginIds() {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformPathValueForViewsQuery($filter_value_string, $filter_data) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformSubmittedValueForUrl($value) {\n  }\n\n  /**\n   * Encode multiple words.\n   *\n   * @param string $words_string\n   *   Get words.\n   * @param string $delimiter\n   *   Delimiter to use.\n   */\n  protected function encodeMultipleWordsForUrl($words_string, $delimiter = '-') {\n    $words_array = explode(' ', $words_string);\n    $encoded_words_array = array_map(function ($word) {\n      return $this->encodeWordForUrl($word);\n\n    }, $words_array);\n    return implode($delimiter, $encoded_words_array);\n  }\n\n  /**\n   * Encode a single word.\n   *\n   * @param string $word\n   *   Given word.\n   *\n   * @return string\n   *   Encoded word.\n   */\n  protected function encodeWordForUrl($word) {\n    $processed_word = trim(strtolower($word));\n    $processed_word = implode('-', array_map(function ($word_item) {\n      return UrlHelper::encodePath($word_item);\n    }, explode('-', $processed_word)));\n    return $processed_word;\n  }\n\n  /**\n   * Decode a single word.\n   *\n   * @param string $word\n   *   Given word.\n   *\n   * @return string\n   *   Decoded word.\n   */\n  protected function decodeUrlWord($word) {\n    return urldecode($word);\n  }\n\n}\n", "metadata": {"source": "repos/views_pretty_paths/src/FilterHandlers/AbstractFilterHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AbstractFilterHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ApiNormalizationAiSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Provides a form for AI-powered API normalization settings.\n */\nclass ApiNormalizationAiSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'api_normalization_ai_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['api_normalization.ai_settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $config = $this->config('api_normalization.ai_settings');\n\n    $form['intelligent_normalization'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('Intelligent API Normalization'),\n      '#description' => $this->t('Configure AI-powered API response normalization and transformation.'),\n    ];\n\n    $form['intelligent_normalization']['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable AI-Powered Normalization'),\n      '#default_value' => $config->get('intelligent_normalization.enabled') ?? TRUE,\n      '#description' => $this->t('Use AI to intelligently normalize API responses from different providers.'),\n    ];\n\n    $form['intelligent_normalization']['model'] = [\n      '#type' => 'select',\n      '#title' => $this->t('AI Model for Normalization'),\n      '#options' => [\n        'llama3.1:8b' => $this->t('Llama 3.1 8B (Fast)'),\n        'llama3.1:70b' => $this->t('Llama 3.1 70B (Accurate)'),\n        'qwen2.5-coder:7b' => $this->t('Qwen 2.5 Coder 7B (Code-focused)'),\n        'phi3.5' => $this->t('Phi 3.5 (Efficient)'),\n      ],\n      '#default_value' => $config->get('intelligent_normalization.model') ?? 'llama3.1:8b',\n      '#states' => [\n        'visible' => [\n          ':input[name=\"enabled\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['schema_generation'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('AI Schema Generation'),\n      '#description' => $this->t('Configure AI-powered OpenAPI schema generation and validation.'),\n    ];\n\n    $form['schema_generation']['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable AI Schema Generation'),\n      '#default_value' => $config->get('schema_generation.enabled') ?? TRUE,\n      '#description' => $this->t('Automatically generate OpenAPI schemas using AI analysis.'),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->config('api_normalization.ai_settings')\n      ->set('intelligent_normalization.enabled', $form_state->getValue(['intelligent_normalization', 'enabled']))\n      ->set('intelligent_normalization.model', $form_state->getValue(['intelligent_normalization', 'model']))\n      ->set('schema_generation.enabled', $form_state->getValue(['schema_generation', 'enabled']))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Form/ApiNormalizationAiSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiNormalizationAiSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CachedStrategy in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Render\\Placeholder;\n\nuse Drupal\\Core\\Render\\RenderCacheInterface;\n\n/**\n * Looks up placeholders in the render cache and returns those we could find.\n */\nclass CachedStrategy implements PlaceholderStrategyInterface {\n\n  public function __construct(\n    protected readonly PlaceholderStrategyInterface $placeholderStrategy,\n    protected readonly RenderCacheInterface $renderCache,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processPlaceholders(array $placeholders) {\n    $return = $this->renderCache->getMultiple($placeholders);\n    if ($return) {\n      $return = $this->processNestedPlaceholders($return);\n    }\n\n    return $return;\n  }\n\n  /**\n   * Fetch any nested placeholders from cache.\n   *\n   * Placeholders returned from cache may have placeholders in #attached, which\n   * can themselves be fetched from the cache. By recursively processing the\n   * placeholders here, we're able to use multiple cache get to fetch the cache\n   * items at each level of recursion.\n   */\n  private function processNestedPlaceholders(array $placeholders): array {\n    $sets = [];\n    foreach ($placeholders as $key => $placeholder) {\n      if (!empty($placeholder['#attached']['placeholders'])) {\n        $sets[] = $placeholder['#attached']['placeholders'];\n      }\n    }\n    if ($sets) {\n      $cached = $this->renderCache->getMultiple(...array_merge($sets));\n      if ($cached) {\n        $cached = $this->processNestedPlaceholders($cached);\n        foreach ($placeholders as $key => $placeholder) {\n          if (!empty($placeholder['#attached']['placeholders'])) {\n            $placeholders[$key]['#attached']['placeholders'] = array_replace($placeholder['#attached']['placeholders'], $cached);\n          }\n        }\n      }\n    }\n    return $placeholders;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Placeholder/CachedStrategy.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CachedStrategy", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use migration:\n  title: 'Use MCP migration tools'\n  description: 'Import/export content via CSV/JSON migration tools via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_migration/mcp_tools_migration.permissions.yml", "type": "yaml_reference", "topic": "mcp tools migration.permissions"}}
{"instruction": "Show me the implementation of the class MigrateField in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate_drupal\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a field plugin annotation object.\n *\n * Field plugins are responsible for handling the migration of custom fields\n * (provided by Field API in Drupal 7) to Drupal 8. They are allowed to alter\n * fieldable entity migrations when these migrations are being generated, and\n * can compute destination field types for individual fields during the actual\n * migration process.\n *\n * Plugin Namespace: Plugin\\migrate\\field\n *\n * @Annotation\n */\nclass MigrateField extends Plugin {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct($values) {\n    parent::__construct($values);\n    // Provide default value for core property, in case it's missing.\n    if (empty($this->definition['core'])) {\n      $this->definition['core'] = [6];\n    }\n  }\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * Map of D6 and D7 field types to D8 field type plugin IDs.\n   *\n   * @var string[]\n   */\n  public $type_map = [];\n\n  /**\n   * The Drupal core version(s) this plugin applies to.\n   *\n   * @var int[]\n   */\n  public $core;\n\n  /**\n   * Identifies the system providing the data the field plugin will read.\n   *\n   * The source_module is expected to be the name of a Drupal module that must\n   * be installed in the source database.\n   *\n   * @var string\n   */\n  public $source_module;\n\n  /**\n   * Identifies the system handling the data the destination plugin will write.\n   *\n   * The destination_module is expected to be the name of a Drupal module on the\n   * destination site that must be installed.\n   *\n   * @var string\n   */\n  public $destination_module;\n\n  /**\n   * The weight of this plugin relative to other plugins.\n   *\n   * The weight of this plugin relative to other plugins servicing the same\n   * field type and core version.  The lowest weighted applicable plugin will be\n   * used for each field.\n   *\n   * @var int\n   */\n  public $weight = 0;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate_drupal/src/Annotation/MigrateField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MigrateField", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'FlowDrop UI Components'\ntype: module\ndescription: 'Provides reusable Single Directory Components (SDC) for the FlowDrop dashboard and administrative interfaces. Delivers a consistent visual language matching the FlowDrop workflow editor.'\npackage: FlowDrop\ncore_version_requirement: ^11\n\n# No dependencies - this is a foundational UI module that can be used by any FlowDrop module\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/flowdrop_ui_components.info.yml", "type": "yaml_reference", "topic": "flowdrop ui components.info"}}
{"instruction": "Show me the implementation of the interface SearchableHelpInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\help;\n\nuse Drupal\\Core\\Language\\LanguageInterface;\n\n/**\n * Provides an interface for a HelpSection plugin that also supports search.\n *\n * @see \\Drupal\\help\\HelpSectionPluginInterface\n */\ninterface SearchableHelpInterface {\n\n  /**\n   * Returns the IDs of topics that should be indexed for searching.\n   *\n   * @return string[]\n   *   An array of topic IDs that should be searchable. IDs need to be\n   *   unique within this HelpSection plugin.\n   */\n  public function listSearchableTopics();\n\n  /**\n   * Renders one topic for search indexing or search results.\n   *\n   * @param string $topic_id\n   *   The ID of the topic to be indexed.\n   * @param \\Drupal\\Core\\Language\\LanguageInterface $language\n   *   The language to render the topic in.\n   *\n   * @return array\n   *   An array of information about the topic, with elements:\n   *   - title: The title of the topic in this language.\n   *   - text: The text of the topic in this language.\n   *   - url: The URL of the topic as a \\Drupal\\Core\\Url object.\n   *   - cacheable_metadata: (optional) An object to add as a cache dependency\n   *     if this topic is shown in search results.\n   */\n  public function renderTopicForSearch($topic_id, LanguageInterface $language);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/help/src/SearchableHelpInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SearchableHelpInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# cspell:ignore localizable\nid: d6_language_content_taxonomy_vocabulary_settings\nlabel: Drupal 6 language taxonomy vocabulary settings\nmigration_tags:\n  - Drupal 6\n  - Configuration\nsource:\n  plugin: d6_language_content_settings_taxonomy_vocabulary\n  constants:\n    target_type: 'taxonomy_term'\n    default_langcode: 'site_default'\nprocess:\n  target_bundle:\n    -\n      plugin: migration_lookup\n      migration: d6_taxonomy_vocabulary\n      source: vid\n    -\n      plugin: skip_on_empty\n      method: row\n  # State is the value in the i18ntaxonomy_vocabulary array defined as:\n  # 0: No multilingual options.\n  # 1: Localizable terms. Run through the localization system.\n  # 2: Predefined language for a vocabulary and its terms.\n  # 3: Per-language terms, translatable (referencing terms with different\n  #  languages) but not localizable.\n  language_alterable:\n    plugin: static_map\n    source: state\n    map:\n      0: false\n      1: true\n      2: false\n      3: true\n  'third_party_settings/content_translation/enabled':\n    plugin: static_map\n    source: state\n    map:\n      0: false\n      1: true\n      2: false\n      3: false\n  target_entity_type_id: 'constants/target_type'\n  default_langcode:\n    plugin: default_value\n    default_value: site_default\n    source: language\ndestination:\n  plugin: entity:language_content_settings\nmigration_dependencies:\n  required:\n    - d6_taxonomy_vocabulary\n    - language\n", "metadata": {"source": "repos/drupal_core/core/modules/language/migrations/d6_language_content_taxonomy_vocabulary_settings.yml", "type": "yaml_reference", "topic": "d6 language content taxonomy vocabulary settings"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ArgumentsResolverInterface.php\nTarget symbol: interface ArgumentsResolverInterface\nNamespace: Drupal\\Component\\Utility\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for ArgumentsResolverInterface.\n- Ensure these methods exist where relevant:\n  - getArguments()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Component\\Utility;\n\n/**\n * Resolves the arguments to pass to a callable.\n */\ninterface ArgumentsResolverInterface {\n\n  /**\n   * Gets arguments suitable for passing to the given callable.\n   *\n   * @return array\n   *   An array of arguments to pass to the callable.\n   *\n   * @throws \\RuntimeException\n   *   When a value for an argument given cannot be resolved.\n   */\n  public function getArguments(callable $callable);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Utility/ArgumentsResolverInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ArgumentsResolverInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class RealTimeEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\DTO\\RealTime;\n\n/**\n * Real-time event for broadcasting execution updates.\n *\n * We could use this to implement WebSocket\n * based broadcaster using notification_server project.\n */\nclass RealTimeEvent {\n\n  public function __construct(\n    private readonly string $type,\n    private readonly string $executionId,\n    private readonly string $event,\n    private readonly array $data,\n    private readonly int $timestamp,\n    private readonly ?string $nodeId = NULL,\n  ) {}\n\n  /**\n   * Get the event type.\n   *\n   * @return string\n   *   The event type.\n   */\n  public function getType(): string {\n    return $this->type;\n  }\n\n  /**\n   * Get the execution ID.\n   *\n   * @return string\n   *   The execution ID.\n   */\n  public function getExecutionId(): string {\n    return $this->executionId;\n  }\n\n  /**\n   * Get the event name.\n   *\n   * @return string\n   *   The event name.\n   */\n  public function getEvent(): string {\n    return $this->event;\n  }\n\n  /**\n   * Get the event data.\n   *\n   * @return array\n   *   The event data.\n   */\n  public function getData(): array {\n    return $this->data;\n  }\n\n  /**\n   * Get the event timestamp.\n   *\n   * @return int\n   *   The event timestamp.\n   */\n  public function getTimestamp(): int {\n    return $this->timestamp;\n  }\n\n  /**\n   * Get the node ID (if applicable).\n   *\n   * @return string|null\n   *   The node ID or NULL.\n   */\n  public function getNodeId(): ?string {\n    return $this->nodeId;\n  }\n\n  /**\n   * Convert to array for serialization.\n   *\n   * @return array\n   *   Array representation of the event.\n   */\n  public function toArray(): array {\n    return [\n      'type' => $this->type,\n      'execution_id' => $this->executionId,\n      'event' => $this->event,\n      'data' => $this->data,\n      'timestamp' => $this->timestamp,\n      'node_id' => $this->nodeId,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/DTO/RealTime/RealTimeEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RealTimeEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ExportMetadata in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\DefaultContent;\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\n\n/**\n * Collects metadata about an entity being exported.\n *\n * @internal\n *   This API is experimental.\n */\nfinal class ExportMetadata {\n\n  /**\n   * The collected export metadata.\n   */\n  private array $metadata = ['version' => '1.0'];\n\n  /**\n   * Files that should accompany the exported entity.\n   *\n   * @var array<string, string>\n   *\n   * @see ::getAttachments()\n   */\n  private array $attachments = [];\n\n  public function __construct(ContentEntityInterface $entity) {\n    $this->metadata['entity_type'] = $entity->getEntityTypeId();\n    $this->metadata['uuid'] = $entity->uuid();\n\n    $entity_type = $entity->getEntityType();\n    if ($entity_type->hasKey('bundle')) {\n      $this->metadata['bundle'] = $entity->bundle();\n    }\n    if ($entity_type->hasKey('langcode')) {\n      $this->metadata['default_langcode'] = $entity->language()->getId();\n    }\n  }\n\n  /**\n   * Returns the collected metadata as an array.\n   *\n   * @return array\n   *   The collected export metadata.\n   */\n  public function get(): array {\n    return $this->metadata;\n  }\n\n  /**\n   * Adds a dependency on another content entity.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity we depend upon.\n   */\n  public function addDependency(ContentEntityInterface $entity): void {\n    $uuid = $entity->uuid();\n    if ($uuid === $this->metadata['uuid']) {\n      throw new \\LogicException('An entity cannot depend on itself.');\n    }\n    $this->metadata['depends'][$uuid] = $entity->getEntityTypeId();\n  }\n\n  /**\n   * Returns the dependencies of the exported entity.\n   *\n   * @return string[][]\n   *   An array of dependencies, where each dependency is a tuple with two\n   *   elements: an entity type ID, and a UUID.\n   */\n  public function getDependencies(): array {\n    $dependencies = [];\n    foreach ($this->metadata['depends'] ?? [] as $uuid => $entity_type_id) {\n      $dependencies[] = [$entity_type_id, $uuid];\n    }\n    return $dependencies;\n  }\n\n  /**\n   * Attaches a file to the exported entity.\n   *\n   * @param string $uri\n   *   The URI of the file, which may or may not physically exist.\n   * @param string $name\n   *   The name of the exported file.\n   */\n  public function addAttachment(string $uri, string $name): void {\n    $this->attachments[$uri] = $name;\n  }\n\n  /**\n   * Returns the files attached to this entity.\n   *\n   * @return array<string, string>\n   *   The keys are the files' current URIs, and the values are the names of the\n   *   files when they are exported.\n   */\n  public function getAttachments(): array {\n    return $this->attachments;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/DefaultContent/ExportMetadata.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExportMetadata", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Template for LightGallery formatter output.\n *\n * This template renders static images as a fallback while JavaScript loads.\n * Once React initializes, it replaces this content with the interactive gallery.\n *\n * Benefits of this approach:\n * - SEO: Search engines can index images and links\n * - Accessibility: Works without JavaScript\n * - Performance: Users see images immediately before JS loads\n * - Graceful degradation: Basic gallery works if JS fails\n *\n * Available variables:\n * - gallery_id: Unique identifier for this gallery instance.\n * - items: Array of gallery items with src, thumb, alt, subHtml, lightboxThumb.\n * - item_count: Number of items in the gallery.\n * - attributes: HTML attributes for the container element.\n *\n * @see \\Drupal\\lightgallery_formatter\\Plugin\\Field\\FieldFormatter\\LightGalleryFormatter\n *\n * @ingroup themeable\n */\n#}\n{{ attach_library('lightgallery_formatter/gallery') }}\n<div{{ attributes }}>\n  {#\n    Static fallback content - visible until React loads.\n    React will replace this with the interactive gallery.\n  #}\n  {% if items %}\n    {% for item in items %}\n      <a href=\"{{ item.src }}\" class=\"lightgallery-fallback-item\" title=\"{{ item.alt|default('') }}\">\n        <img\n          src=\"{{ item.thumb|default(item.src) }}\"\n          alt=\"{{ item.alt|default('') }}\"\n          class=\"lightgallery-fallback-thumbnail\"\n          loading=\"lazy\"\n        />\n      </a>\n    {% endfor %}\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/lightgallery_formatter/templates/lightgallery-formatter.html.twig", "type": "twig_reference"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: UuidReferenceInterface\nSource file: <source_file>\nFile name hint: UuidReferenceInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\serialization\\EntityResolver;\n\nuse Symfony\\Component\\Serializer\\Normalizer\\NormalizerInterface;\n\n/**\n * Interface for extracting UUID from entity reference data when denormalizing.\n */\ninterface UuidReferenceInterface extends NormalizerInterface {\n\n  /**\n   * Get the uuid from the data array.\n   *\n   * @param array $data\n   *   The data, as was passed into the Normalizer.\n   *\n   * @return string\n   *   A UUID.\n   */\n  function getUuid($data);\n\n}", "output": "<?php\n\nnamespace Drupal\\serialization\\EntityResolver;\n\nuse Symfony\\Component\\Serializer\\Normalizer\\NormalizerInterface;\n\n/**\n * Interface for extracting UUID from entity reference data when denormalizing.\n */\ninterface UuidReferenceInterface extends NormalizerInterface {\n\n  /**\n   * Get the uuid from the data array.\n   *\n   * @param array $data\n   *   The data, as was passed into the Normalizer.\n   *\n   * @return string\n   *   A UUID.\n   */\n  public function getUuid($data);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/EntityResolver/UuidReferenceInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "UuidReferenceInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DisplayBuilderViews in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Contains install file.\n */\n\ndeclare(strict_types=1);\n\n/**\n * Implements hook_install().\n */\nfunction display_builder_views_install(): void {\n  $config = Drupal::service('config.factory')->getEditable('views.settings');\n  /** @var array $display_extenders */\n  $display_extenders = $config->get('display_extenders') ?: [];\n  $display_extenders[] = 'display_builder';\n  $config->set('display_extenders', $display_extenders);\n  $config->save();\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction display_builder_views_uninstall(): void {\n  $config = Drupal::service('config.factory')->getEditable('views.settings');\n  /** @var array $display_extenders */\n  $display_extenders = $config->get('display_extenders') ?: [];\n  $key = \\array_search('display_builder', $display_extenders, TRUE);\n\n  if ($key !== FALSE) {\n    unset($display_extenders[$key]);\n    $config->set('display_extenders', $display_extenders);\n    $config->save();\n  }\n}\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/display_builder_views.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DisplayBuilderViews", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Content Moderation'\ntype: module\ndescription: 'Provides additional publication states that can be used by other modules to moderate content.'\nversion: VERSION\npackage: Core\nconfigure: entity.workflow.collection\ndependencies:\n  - drupal:workflows\n", "metadata": {"source": "repos/drupal_core/core/modules/content_moderation/content_moderation.info.yml", "type": "yaml_reference", "topic": "content moderation.info"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EntityRevisionParamConverter.php\nTarget symbol: class EntityRevisionParamConverter\nNamespace: Drupal\\Core\\ParamConverter\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for EntityRevisionParamConverter.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityRepositoryInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Entity\\TranslatableInterface\n  - Symfony\\Component\\Routing\\Route\n- Ensure these methods exist where relevant:\n  - __construct()\n  - applies()\n  - convert()", "output": "<?php\n\nnamespace Drupal\\Core\\ParamConverter;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Entity\\TranslatableInterface;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Parameter converter for upcasting entity revision IDs to full objects.\n *\n * This is useful for pages which want to show a specific revision, like\n * \"/entity_example/{entity_example}/revision/{entity_example_revision}\".\n *\n *\n * In order to use it you should specify some additional options in your route:\n * @code\n * example.route:\n *   path: /foo/{entity_example_revision}\n *   options:\n *     parameters:\n *       entity_example_revision:\n *         type: entity_revision:entity_example\n * @endcode\n */\nclass EntityRevisionParamConverter implements ParamConverterInterface {\n\n  use DynamicEntityTypeParamConverterTrait;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * Creates a new EntityRevisionParamConverter instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager, EntityRepositoryInterface $entity_repository) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function convert($value, $definition, $name, array $defaults) {\n    $entity_type_id = $this->getEntityTypeFromDefaults($definition, $name, $defaults);\n    /** @var \\Drupal\\Core\\Entity\\RevisionableStorageInterface $storage */\n    $storage = $this->entityTypeManager->getStorage($entity_type_id);\n    $entity = $storage->loadRevision($value);\n\n    // If the entity type is translatable, ensure we return the proper\n    // translation object for the current context.\n    if ($entity instanceof EntityInterface && $entity instanceof TranslatableInterface) {\n      $entity = $this->entityRepository->getTranslationFromContext($entity, NULL, ['operation' => 'entity_upcast']);\n    }\n\n    return $entity;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies($definition, $name, Route $route) {\n    return isset($definition['type']) && str_contains($definition['type'], 'entity_revision:');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/ParamConverter/EntityRevisionParamConverter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityRevisionParamConverter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: CircuitBreakerStatusController\nSource file: <source_file>\nFile name hint: CircuitBreakerStatusController.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\api_normalization\\Controller;\n\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\api_normalization\\Service\\CircuitBreakerService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Controller for circuit breaker status page.\n */\nclass CircuitBreakerStatusController extends ControllerBase {\n\n  /**\n   * The circuit breaker service.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\CircuitBreakerService\n   */\n  protected CircuitBreakerService $circuitBreaker;\n\n  /**\n   * Constructs a CircuitBreakerStatusController.\n   *\n   * @param \\Drupal\\api_normalization\\Service\\CircuitBreakerService $circuit_breaker\n   *   The circuit breaker service.\n   */\n  public function __construct(CircuitBreakerService $circuit_breaker) {\n    $this->circuitBreaker = $circuit_breaker;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('api_normalization.circuit_breaker')\n    );\n  }\n\n  /**\n   * Displays circuit breaker status.\n   *\n   * @return array\n   *   A render array.\n   */\n  public function status(): array {\n    $all_states = $this->circuitBreaker->getAllStates();\n\n    $rows = [];\n    foreach ($all_states as $endpoint => $state) {\n      $stats = $this->circuitBreaker->getStatistics($endpoint);\n\n      $state_class = match ($state) {\n        CircuitBreakerService::STATE_CLOSED => 'color-success',\n        CircuitBreakerService::STATE_HALF_OPEN => 'color-warning',\n        CircuitBreakerService::STATE_OPEN => 'color-error',\n        default => '',\n      };\n\n      $rows[] = [\n        'endpoint' => $endpoint,\n        'state' => [\n          'data' => [\n            '#markup' => '<strong class=\"' . $state_class . '\">' . strtoupper($state) . '</strong>',\n          ],\n        ],\n        'failure_count' => $stats['failure_count'] ?? 0,\n        'last_failure' => $stats['last_failure_time'] ? date('Y-m-d H:i:s', $stats['last_failure_time']) : 'Never',\n        'last_success' => $stats['last_success_time'] ? date('Y-m-d H:i:s', $stats['last_success_time']) : 'Never',\n        'last_error' => $stats['last_error'] ?? 'None',\n        'operations' => [\n          'data' => [\n            '#type' => 'operations',\n            '#links' => [\n              'reset' => [\n                'title' => $this->t('Reset'),\n                'url' => Url::fromRoute('api_normalization.circuit_breaker.reset', [\n                  'endpoint' => base64_encode($endpoint),\n                ]),\n              ],\n            ],\n          ],\n        ],\n      ];\n    }\n\n    $build = [\n      '#type' => 'container',\n      '#attributes' => ['class' => ['circuit-breaker-status']],\n    ];\n\n    $build['summary'] = [\n      '#type' => 'html_tag',\n      '#tag' => 'div',\n      '#attributes' => ['class' => ['circuit-breaker-summary']],\n      '#value' => $this->t('Monitoring @count endpoint(s)', ['@count' => count($all_states)]),\n    ];\n\n    $build['table'] = [\n      '#type' => 'table',\n      '#header' => [\n        $this->t('Endpoint'),\n        $this->t('State'),\n        $this->t('Failures'),\n        $this->t('Last Failure'),\n        $this->t('Last Success'),\n        $this->t('Last Error'),\n        $this->t('Operations'),\n      ],\n      '#rows' => $rows,\n      '#empty' => $this->t('No circuit breakers configured.'),\n      '#cache' => [\n        'max-age' => 30,\n        'contexts' => ['url'],\n      ],\n    ];\n", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Controller;\n\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\api_normalization\\Service\\CircuitBreakerService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Controller for circuit breaker status page.\n */\nclass CircuitBreakerStatusController extends ControllerBase {\n\n  /**\n   * The circuit breaker service.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\CircuitBreakerService\n   */\n  protected CircuitBreakerService $circuitBreaker;\n\n  /**\n   * Constructs a CircuitBreakerStatusController.\n   *\n   * @param \\Drupal\\api_normalization\\Service\\CircuitBreakerService $circuit_breaker\n   *   The circuit breaker service.\n   */\n  public function __construct(CircuitBreakerService $circuit_breaker) {\n    $this->circuitBreaker = $circuit_breaker;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('api_normalization.circuit_breaker')\n    );\n  }\n\n  /**\n   * Displays circuit breaker status.\n   *\n   * @return array\n   *   A render array.\n   */\n  public function status(): array {\n    $all_states = $this->circuitBreaker->getAllStates();\n\n    $rows = [];\n    foreach ($all_states as $endpoint => $state) {\n      $stats = $this->circuitBreaker->getStatistics($endpoint);\n\n      $state_class = match ($state) {\n        CircuitBreakerService::STATE_CLOSED => 'color-success',\n        CircuitBreakerService::STATE_HALF_OPEN => 'color-warning',\n        CircuitBreakerService::STATE_OPEN => 'color-error',\n        default => '',\n      };\n\n      $rows[] = [\n        'endpoint' => $endpoint,\n        'state' => [\n          'data' => [\n            '#markup' => '<strong class=\"' . $state_class . '\">' . strtoupper($state) . '</strong>',\n          ],\n        ],\n        'failure_count' => $stats['failure_count'] ?? 0,\n        'last_failure' => $stats['last_failure_time'] ? date('Y-m-d H:i:s', $stats['last_failure_time']) : 'Never',\n        'last_success' => $stats['last_success_time'] ? date('Y-m-d H:i:s', $stats['last_success_time']) : 'Never',\n        'last_error' => $stats['last_error'] ?? 'None',\n        'operations' => [\n          'data' => [\n            '#type' => 'operations',\n            '#links' => [\n              'reset' => [\n                'title' => $this->t('Reset'),\n                'url' => Url::fromRoute('api_normalization.circuit_breaker.reset', [\n                  'endpoint' => base64_encode($endpoint),\n                ]),\n              ],\n            ],\n          ],\n        ],\n      ];\n    }\n\n    $build = [\n      '#type' => 'container',\n      '#attributes' => ['class' => ['circuit-breaker-status']],\n    ];\n\n    $build['summary'] = [\n      '#type' => 'html_tag',\n      '#tag' => 'div',\n      '#attributes' => ['class' => ['circuit-breaker-summary']],\n      '#value' => $this->t('Monitoring @count endpoint(s)', ['@count' => count($all_states)]),\n    ];\n\n    $build['table'] = [\n      '#type' => 'table',\n      '#header' => [\n        $this->t('Endpoint'),\n        $this->t('State'),\n        $this->t('Failures'),\n        $this->t('Last Failure'),\n        $this->t('Last Success'),\n        $this->t('Last Error'),\n        $this->t('Operations'),\n      ],\n      '#rows' => $rows,\n      '#empty' => $this->t('No circuit breakers configured.'),\n      '#cache' => [\n        'max-age' => 30,\n        'contexts' => ['url'],\n      ],\n    ];\n\n    $build['#attached']['library'][] = 'api_normalization/circuit-breaker-status';\n\n    return $build;\n  }\n\n  /**\n   * Resets a circuit breaker.\n   *\n   * @param string $endpoint\n   *   Base64 encoded endpoint identifier.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\RedirectResponse\n   *   Redirect response.\n   */\n  public function reset(string $endpoint) {\n    $endpoint = base64_decode($endpoint);\n    $this->circuitBreaker->reset($endpoint);\n\n    $this->messenger()->addStatus($this->t('Circuit breaker for @endpoint has been reset.', [\n      '@endpoint' => $endpoint,\n    ]));\n\n    return $this->redirect('api_normalization.circuit_breaker.status');\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Controller/CircuitBreakerStatusController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CircuitBreakerStatusController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: StaticReflectionParser.php\nTarget symbol: class StaticReflectionParser\nNamespace: Drupal\\migrate\\Plugin\\Discovery\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for StaticReflectionParser.\n- Include required imports:\n  - Drupal\\Component\\Annotation\\Doctrine\\StaticReflectionParser as BaseStaticReflectionParser\n- Ensure these methods exist where relevant:\n  - getParentParser()", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\Discovery;\n\nuse Drupal\\Component\\Annotation\\Doctrine\\StaticReflectionParser as BaseStaticReflectionParser;\n\n/**\n * Allows getting the reflection parser for the parent class.\n *\n * @internal\n *   This provides backwards compatibility for migration source plugins\n *   using annotations and having more than one provider. This functionality\n *   will be deprecated with plugin discovery by annotations in\n *   https://www.drupal.org/project/drupal/issues/3522409.\n */\nclass StaticReflectionParser extends BaseStaticReflectionParser {\n\n  /**\n   * If the current class extends another, get the parser for the latter.\n   *\n   * @param \\Drupal\\Component\\Annotation\\Doctrine\\StaticReflectionParser $parser\n   *   The current static parser.\n   * @param \\Doctrine\\Common\\Reflection\\ClassFinderInterface $finder\n   *   The class finder. Must implement\n   *   \\Drupal\\Component\\ClassFinder\\ClassFinderInterface, but can do so\n   *   implicitly (i.e., implements the interface's methods but not the actual\n   *   interface).\n   *\n   * @return static|null\n   *   The static parser for the parent if there's a parent class or NULL.\n   */\n  public static function getParentParser(BaseStaticReflectionParser $parser, $finder) {\n    // Ensure the class has been parsed before accessing the parentClassName\n    // property.\n    $parser->parse();\n    if ($parser->parentClassName) {\n      return new static($parser->parentClassName, $finder, $parser->classAnnotationOptimize);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/Discovery/StaticReflectionParser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StaticReflectionParser", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class LibrariesSwitcher in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\State\\StateInterface;\n\n/**\n * Hook implementations for display_builder.\n */\nclass LibrariesSwitcher {\n\n  private const STATE_STORAGE_KEY = 'display_builder.asset_libraries_local';\n\n  public function __construct(\n    protected StateInterface $state,\n  ) {}\n\n  /**\n   * Switch libraries according to environment.\n   *\n   * @param array $libraries\n   *   An associative array of libraries, passed by reference. The array key\n   *   for any particular library will be the name from *.libraries.yml.\n   * @param string $extension\n   *   Can either be 'core' or the machine name of the extension that registered\n   *   the libraries.\n   */\n  #[Hook('library_info_alter')]\n  public function switchLibraries(array &$libraries, string $extension): void {\n    if ($extension !== 'display_builder') {\n      return;\n    }\n\n    // By default, libraries are retrieved from CDN. Switch to local mode with\n    // a state value.\n    // This is needed for tests or disconnected environments.\n    $is_local = $this->state->get(self::STATE_STORAGE_KEY, FALSE);\n\n    if (!$is_local) {\n      return;\n    }\n\n    if (isset($libraries['shoelace']['dependencies'])) {\n      $libraries['shoelace']['dependencies'] = \\array_filter(\n        $libraries['shoelace']['dependencies'],\n        static fn ($dependency) => $dependency !== 'display_builder/_shoelace_cdn'\n      );\n      $libraries['shoelace']['dependencies'][] = 'display_builder/_shoelace_local';\n    }\n\n    if (isset($libraries['htmx_sse']['dependencies'])) {\n      $libraries['htmx_sse']['dependencies'] = \\array_filter(\n        $libraries['htmx_sse']['dependencies'],\n        static fn ($dependency) => $dependency !== 'display_builder/_htmx_sse_cdn'\n      );\n      $libraries['htmx_sse']['dependencies'][] = 'display_builder/_htmx_sse_local';\n    }\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Hook/LibrariesSwitcher.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LibrariesSwitcher", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait LayoutRebuildTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder\\Controller;\n\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\CloseDialogCommand;\nuse Drupal\\Core\\Ajax\\ReplaceCommand;\nuse Drupal\\layout_builder\\SectionStorageInterface;\n\n/**\n * Provides AJAX responses to rebuild the Layout Builder.\n */\ntrait LayoutRebuildTrait {\n\n  /**\n   * Rebuilds the layout.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage.\n   *\n   * @return \\Drupal\\Core\\Ajax\\AjaxResponse\n   *   An AJAX response to either rebuild the layout and close the dialog, or\n   *   reload the page.\n   */\n  protected function rebuildAndClose(SectionStorageInterface $section_storage) {\n    $response = $this->rebuildLayout($section_storage);\n    $response->addCommand(new CloseDialogCommand('#drupal-off-canvas'));\n    return $response;\n  }\n\n  /**\n   * Rebuilds the layout.\n   *\n   * @param \\Drupal\\layout_builder\\SectionStorageInterface $section_storage\n   *   The section storage.\n   *\n   * @return \\Drupal\\Core\\Ajax\\AjaxResponse\n   *   An AJAX response to either rebuild the layout and close the dialog, or\n   *   reload the page.\n   */\n  protected function rebuildLayout(SectionStorageInterface $section_storage) {\n    $response = new AjaxResponse();\n    $layout = [\n      '#type' => 'layout_builder',\n      '#section_storage' => $section_storage,\n    ];\n    $response->addCommand(new ReplaceCommand('#layout-builder', $layout));\n    return $response;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/Controller/LayoutRebuildTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "LayoutRebuildTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Sizing: small\"\nslots:\n  title: \"Small button\"\nprops:\n  variant: dropdown\n  attributes:\n    class:\n      - m-1\n  button_variant: secondary__sm\n  content:\n    - title: \"Action\"\n      url: \"#\"\n    - title: \"Another action\"\n      url: \"#\"\n    - title: \"Something else here\"\n      url: \"#\"\n    - {}\n    - title: \"Separated link\"\n      url: \"#\"\nlibrary_wrapper: >\n  {% set splits = [\n    false,\n    true,\n  ] %}\n\n  <div class=\"d-inline-flex\">\n  {% for split in splits %}\n    {% set size_props = {'#props': _story['#props']|merge({\n      'button_split': split,\n    })} %}\n\n    {% set size_story = _story %}\n    {{ size_story|merge(size_props) }}\n  {% endfor %}\n  </div>\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/stories/dropdown.sizing_small.story.yml", "type": "yaml_reference", "topic": "dropdown.sizing small.story"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Data Viewer\nstatus: stable\ndescription: 'Displays JSON data in a formatted, collapsible view with syntax highlighting. Used for viewing input/output data, metadata, and execution context.'\ngroup: FlowDrop\n\nprops:\n  type: object\n  required:\n    - label\n  properties:\n    label:\n      type: string\n      title: Label\n      description: 'The label for the data section'\n    data:\n      type: string\n      title: Data\n      description: 'The JSON string to display'\n    collapsed:\n      type: boolean\n      title: Initially Collapsed\n      description: 'Whether the data should be initially collapsed'\n      default: true\n    max_height:\n      type: string\n      title: Max Height\n      description: 'Maximum height for the data container (CSS value)'\n      default: '300px'\n    variant:\n      type: string\n      title: Variant\n      description: 'Visual variant for the container'\n      enum:\n        - default\n        - success\n        - warning\n        - error\n        - info\n      default: default\n\nlibraryOverrides:\n  css:\n    component:\n      data-viewer.css: {}\n  js:\n    data-viewer.js: {}\n  dependencies:\n    - flowdrop_ui_components/theme-layer\n    - core/once\n    - core/drupal\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/data-viewer/data-viewer.component.yml", "type": "yaml_reference", "topic": "data-viewer.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the views plugins of the REST module.\n\nviews.display.rest_export:\n  type: views_display_path\n  label: 'REST display options'\n  mapping:\n    auth:\n      type: sequence\n      label: 'Authentication'\n      sequence:\n        type: string\n        label: 'Authentication Provider'\n\nviews.row.data_field:\n  type: views_row\n  label: 'Field row'\n  mapping:\n    field_options:\n      type: sequence\n      label: 'Options'\n      sequence:\n        type: mapping\n        label: 'Row'\n        mapping:\n          alias:\n            type: string\n            label: 'Alias for ID'\n          raw_output:\n            type: boolean\n            label: 'Raw output for ID'\n\nviews.style.serializer:\n  type: views_style\n  label: 'Serialized output format'\n  mapping:\n    formats:\n      type: sequence\n      label: 'Formats'\n      sequence:\n        type: string\n        label: 'Format'\n", "metadata": {"source": "repos/drupal_core/core/modules/rest/config/schema/rest.views.schema.yml", "type": "yaml_reference", "topic": "rest.views.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - user\nid: user_unblock_user_action\nlabel: 'Unblock the selected user(s)'\ntype: user\nplugin: user_unblock_user_action\nconfiguration: {  }\n", "metadata": {"source": "repos/drupal_core/core/modules/user/config/install/system.action.user_unblock_user_action.yml", "type": "yaml_reference", "topic": "system.action.user unblock user action"}}
{"instruction": "Show me the implementation of the class ImageEffectBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\image;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Plugin\\ConfigurablePluginBase;\nuse Drupal\\Core\\Plugin\\RemovableDependentPluginReturn;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\Autowire;\n\n/**\n * Provides a base class for image effects.\n *\n * @see \\Drupal\\image\\Annotation\\ImageEffect\n * @see \\Drupal\\image\\ImageEffectInterface\n * @see \\Drupal\\image\\ConfigurableImageEffectInterface\n * @see \\Drupal\\image\\ConfigurableImageEffectBase\n * @see \\Drupal\\image\\ImageEffectManager\n * @see plugin_api\n */\nabstract class ImageEffectBase extends ConfigurablePluginBase implements ImageEffectInterface, ContainerFactoryPluginInterface {\n\n  /**\n   * The image effect ID.\n   *\n   * @var string\n   */\n  protected $uuid;\n\n  /**\n   * The weight of the image effect.\n   *\n   * @var int|string\n   */\n  protected $weight = '';\n\n  /**\n   * A logger instance.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected $logger;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    #[Autowire(service: 'logger.channel.image')]\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformDimensions(array &$dimensions, $uri) {\n    // Most image effects will not change the dimensions. This base\n    // implementation represents this behavior. Override this method if your\n    // image effect does change the dimensions.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeExtension($extension) {\n    // Most image effects will not change the extension. This base\n    // implementation represents this behavior. Override this method if your\n    // image effect does change the extension.\n    return $extension;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSummary() {\n    return [\n      '#markup' => '',\n      '#effect' => [\n        'id' => $this->pluginDefinition['id'],\n        'label' => $this->label(),\n        'description' => $this->pluginDefinition['description'],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function label() {\n    return $this->pluginDefinition['label'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getUuid() {\n    return $this->uuid;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setWeight($weight) {\n    $this->weight = $weight;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getWeight() {\n    return $this->weight;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfiguration() {\n    return [\n      'uuid' => $this->getUuid(),\n      'id' => $this->getPluginId(),\n      'weight' => $this->getWeight(),\n      'data' => $this->configuration,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setConfiguration(array $configuration) {\n    $configuration += [\n      'data' => [],\n      'uuid' => '',\n      'weight' => '',\n    ];\n    $this->configuration = $configuration['data'] + $this->defaultConfiguration();\n    $this->uuid = $configuration['uuid'];\n    $this->weight = $configuration['weight'];\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function calculateDependencies() {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onCollectionDependencyRemoval(array $dependencies): RemovableDependentPluginReturn {\n    // If the module that provides the image effect plugin is uninstalled,\n    // the plugin instance should be removed from the collection.\n    return in_array($this->getPluginDefinition()['provider'], $dependencies['module'] ?? []) ? RemovableDependentPluginReturn::Remove : RemovableDependentPluginReturn::Unchanged;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/src/ImageEffectBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageEffectBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: as\nSource file: <source_file>\nFile name hint: ExtendableInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Database\\Query;\n\n/**\n * Interface for extendable query objects.\n *\n * \"Extenders\" follow the \"Decorator\" OOP design pattern.  That is, they wrap\n * and \"decorate\" another object. In our case, they implement the same\n * interface as select queries and wrap a select query, to which they delegate\n * almost all operations. Subclasses of this class may implement additional\n * methods or override existing methods as appropriate. Extenders may also wrap\n * other extender objects, allowing for arbitrarily complex \"enhanced\" queries.\n */\ninterface ExtendableInterface {\n\n  /**\n   * Enhance this object by wrapping it in an extender object.\n   *\n   * @param class-string $extender_name\n   *   The fully-qualified name of the extender class, without the leading '\\'\n   *   (for example, Drupal\\my_module\\myExtenderClass). The extender name will\n   *   be checked against the current database connection to allow\n   *   driver-specific subclasses as well, using the same logic as the query\n   *   objects themselves.\n   *\n   * @return \\Drupal\\Core\\Database\\Query\\ExtendableInterface\n   *   The extender object, which now contains a reference to this object.\n   */\n  function extend($extender_name);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Query;\n\n/**\n * Interface for extendable query objects.\n *\n * \"Extenders\" follow the \"Decorator\" OOP design pattern.  That is, they wrap\n * and \"decorate\" another object. In our case, they implement the same\n * interface as select queries and wrap a select query, to which they delegate\n * almost all operations. Subclasses of this class may implement additional\n * methods or override existing methods as appropriate. Extenders may also wrap\n * other extender objects, allowing for arbitrarily complex \"enhanced\" queries.\n */\ninterface ExtendableInterface {\n\n  /**\n   * Enhance this object by wrapping it in an extender object.\n   *\n   * @param class-string $extender_name\n   *   The fully-qualified name of the extender class, without the leading '\\'\n   *   (for example, Drupal\\my_module\\myExtenderClass). The extender name will\n   *   be checked against the current database connection to allow\n   *   driver-specific subclasses as well, using the same logic as the query\n   *   objects themselves.\n   *\n   * @return \\Drupal\\Core\\Database\\Query\\ExtendableInterface\n   *   The extender object, which now contains a reference to this object.\n   */\n  public function extend($extender_name);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Query/ExtendableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ExtendableInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class RecipeConfigurator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Recipe;\n\n/**\n * @internal\n *   This API is experimental.\n */\nfinal class RecipeConfigurator {\n\n  /**\n   * @var \\Drupal\\Core\\Recipe\\Recipe[]\n   */\n  public readonly array $recipes;\n\n  /**\n   * A cache of already-loaded recipes, keyed by path.\n   *\n   * @var \\Drupal\\Core\\Recipe\\Recipe[]\n   */\n  private static array $cache = [];\n\n  /**\n   * @param string[] $recipes\n   *   A list of recipes for a recipe to apply. The recipes will be applied in\n   *   the order listed.\n   * @param string $include_path\n   *   The recipe's include path.\n   */\n  public function __construct(array $recipes, string $include_path) {\n    $this->recipes = array_map(fn(string $name) => static::getIncludedRecipe($include_path, $name), $recipes);\n  }\n\n  /**\n   * Gets an included recipe object.\n   *\n   * @param string $include_path\n   *   The recipe's include path.\n   * @param string $name\n   *   The machine name of the recipe to get.\n   *\n   * @return \\Drupal\\Core\\Recipe\\Recipe\n   *   The recipe object.\n   *\n   * @throws \\Drupal\\Core\\Recipe\\UnknownRecipeException\n   *   Thrown when the recipe cannot be found.\n   */\n  public static function getIncludedRecipe(string $include_path, string $name): Recipe {\n    // In order to allow recipes to include core provided recipes, $name can be\n    // a Drupal root relative path to a recipe folder. For example, a recipe can\n    // include the core provided 'article_tags' recipe by listing the recipe as\n    // 'core/recipes/article_tags'. It is strongly recommended not to rely on\n    // relative paths for including recipes. Required recipes should be put in\n    // the same parent directory as the recipe being applied. Note, only linux\n    // style directory separators are supported. PHP on Windows can resolve the\n    // mix of directory separators.\n    if (str_contains($name, '/')) {\n      $path = \\Drupal::root() . \"/$name/recipe.yml\";\n    }\n    else {\n      $path = $include_path . \"/$name/recipe.yml\";\n    }\n\n    if (array_key_exists($path, static::$cache)) {\n      return static::$cache[$path];\n    }\n    if (file_exists($path)) {\n      return static::$cache[$path] = Recipe::createFromDirectory(dirname($path));\n    }\n    $search_path = dirname($path, 2);\n    throw new UnknownRecipeException($name, $search_path, sprintf(\"Can not find the %s recipe, search path: %s\", $name, $search_path));\n  }\n\n  /**\n   * Returns all the recipes installed by this recipe.\n   *\n   * @return \\Drupal\\Core\\Recipe\\Recipe[]\n   *   An array of all the recipes being installed.\n   */\n  private function listAllRecipes(): array {\n    $recipes = [];\n    foreach ($this->recipes as $recipe) {\n      $recipes[] = $recipe;\n      $recipes = array_merge($recipes, $recipe->recipes->listAllRecipes());\n    }\n    return array_values(array_unique($recipes, SORT_REGULAR));\n  }\n\n  /**\n   * List all the extensions installed by this recipe and its dependencies.\n   *\n   * @return string[]\n   *   All the modules and themes that will be installed by the current\n   *   recipe and all the recipes it depends on.\n   */\n  public function listAllExtensions(): array {\n    $extensions = [];\n    foreach ($this->listAllRecipes() as $recipe) {\n      $extensions = array_merge($extensions, $recipe->install->modules, $recipe->install->themes);\n    }\n    return array_values(array_unique($extensions));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Recipe/RecipeConfigurator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RecipeConfigurator", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Main React-based library for LightGallery integration.\n# Uses ES module format - Drupal automatically excludes from aggregation.\n# React and LightGallery are bundled internally for reliability.\ngallery:\n  version: '1.x'\n  js:\n    js/dist/lightgallery-react.js:\n      attributes:\n        type: module\n      preprocess: false\n      minified: true\n  css:\n    # LightGallery CSS from React bundle (includes all plugin styles)\n    theme:\n      js/dist/style.css: { preprocess: false, minified: true }\n    # Module theme overrides\n    component:\n      css/lightgallery_formatter.theme.css: { preprocess: false }\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/once\n", "metadata": {"source": "repos/lightgallery_formatter/lightgallery_formatter.libraries.yml", "type": "yaml_reference", "topic": "lightgallery formatter.libraries"}}
{"instruction": "Show me the implementation of the class EntityOperations in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\field;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Routing\\RedirectDestinationTrait;\nuse Drupal\\views\\Attribute\\ViewsField;\nuse Drupal\\views\\Entity\\Render\\EntityTranslationRenderTrait;\nuse Drupal\\views\\ResultRow;\n\n/**\n * Renders all operations links for an entity.\n *\n * @ingroup views_field_handlers\n */\n#[ViewsField(\"entity_operations\")]\nclass EntityOperations extends FieldPluginBase {\n\n  use EntityTranslationRenderTrait;\n  use RedirectDestinationTrait;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity repository service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * The entity display repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface\n   */\n  protected $entityDisplayRepository;\n\n  /**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   */\n  protected $languageManager;\n\n  /**\n   * Constructs a new EntityOperations object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(array $configuration, $plugin_id, array $plugin_definition, EntityTypeManagerInterface $entity_type_manager, LanguageManagerInterface $language_manager, EntityRepositoryInterface $entity_repository) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->entityTypeManager = $entity_type_manager;\n    $this->languageManager = $language_manager;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesGroupBy() {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defineOptions() {\n    $options = parent::defineOptions();\n\n    $options['destination'] = [\n      'default' => FALSE,\n    ];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n\n    $form['destination'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Include destination'),\n      '#description' => $this->t('Enforce a <code>destination</code> parameter in the link to return the user to the original view upon completing the link action. Most operations include a destination by default and this setting is no longer needed.'),\n      '#default_value' => $this->options['destination'],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(ResultRow $values) {\n    $entity = $this->getEntity($values);\n    // Allow for the case where there is no entity, if we are on a non-required\n    // relationship.\n    if (empty($entity)) {\n      return '';\n    }\n\n    $entity = $this->getEntityTranslationByRelationship($entity, $values);\n    $cacheability = new CacheableMetadata();\n    $operations = $this->entityTypeManager->getListBuilder($entity->getEntityTypeId())->getOperations($entity, $cacheability);\n    if ($this->options['destination']) {\n      foreach ($operations as &$operation) {\n        if (!isset($operation['query'])) {\n          $operation['query'] = [];\n        }\n        $operation['query'] += $this->getDestinationArray();\n      }\n    }\n    $build = [\n      '#type' => 'operations',\n      '#links' => $operations,\n      // Allow links to use modals.\n      '#attached' => [\n        'library' => ['core/drupal.dialog.ajax'],\n      ],\n    ];\n    $cacheability->applyTo($build);\n    return $build;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // We purposefully do not call parent::query() because we do not want the\n    // default query behavior for Views fields. Instead, let the entity\n    // translation renderer provide the correct query behavior.\n    if ($this->languageManager->isMultilingual()) {\n      $this->getEntityTranslationRenderer()->query($this->query, $this->relationship);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEntityTypeId() {\n    return $this->getEntityType();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityTypeManager() {\n    return $this->entityTypeManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityRepository() {\n    return $this->entityRepository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getLanguageManager() {\n    return $this->languageManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getView() {\n    return $this->view;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function clickSortable() {\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/field/EntityOperations.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityOperations", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class D2Helper in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\d2;\n\nuse Consensus\\PhpD2\\D2;\nuse Symfony\\Component\\Process\\Exception\\ProcessFailedException;\n\n/**\n * Helper class to interface with the D2 CLI.\n */\nclass D2Helper {\n\n  /**\n   * Return an SVG for a given D2 input.\n   */\n  public function getSvg(string $d2_input, array $d2_options = []): string {\n    $cid = 'd2:' . hash('sha256', $d2_input);\n\n    if ($cache = \\Drupal::cache()->get($cid)) {\n      $svg = $cache->data;\n    }\n    else {\n      try {\n        $d2_command_options = \\Drupal::moduleHandler()->invokeAll('d2_command_options');\n        $svg = (new D2())->generateSvg($d2_input, array_merge($d2_command_options, $d2_options));\n        \\Drupal::cache()->set($cid, $svg);\n      }\n      catch (ProcessFailedException $e) {\n        $error = $e->getProcess()->getErrorOutput();\n        \\Drupal::logger('d2')->error($error);\n\n        if (!\\Drupal::currentUser()->hasPermission('view d2 diagram errors')) {\n          return '';\n        }\n        \\Drupal::messenger()->addError(t('D2 failed to generate SVG from input: <br />%error', ['%error' => $error]));\n        return '<pre>' . $d2_input . '</pre>';\n      }\n    }\n\n    return $svg;\n  }\n\n}\n", "metadata": {"source": "repos/d2/src/D2Helper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "D2Helper", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: metatag_ai_generate.install\nSource file: <source_file>\nFile name hint: metatag_ai_generate.install\nCurrent implementation:\n<?php\n\n/**\n * @file\n * Install, update and uninstall functions for Metatag AI Generate.\n */\n\n/**\n * Implements hook_install().\n */\nfunction metatag_ai_generate_install($is_syncing): void {\n  // Ne pas afficher de message lors d'une importation de config.\n  if ($is_syncing) {\n    return;\n  }\n\n  // Note: La route n'existe pas encore, mais le message guide l'admin.\n  // La route sera creee dans une phase ulterieure (Phase 5: Configuration).\n  \\Drupal::messenger()->addStatus(t(\n    'Metatag AI Generate has been installed. Configure the module at <em>Configuration > Search and metadata > Metatag AI Generate</em> when the settings page is available.',\n  ));\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction metatag_ai_generate_uninstall($is_syncing): void {\n  // Nettoyer les etats si necessaire.\n  \\Drupal::state()->delete('metatag_ai_generate.last_generation');\n}", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for Metatag AI Generate.\n */\n\n/**\n * Implements hook_install().\n */\nfunction metatag_ai_generate_install($is_syncing): void {\n  // Ne pas afficher de message lors d'une importation de config.\n  if ($is_syncing) {\n    return;\n  }\n\n  // Note: La route n'existe pas encore, mais le message guide l'admin.\n  // La route sera creee dans une phase ulterieure (Phase 5: Configuration).\n  \\Drupal::messenger()->addStatus(t(\n    'Metatag AI Generate has been installed. Configure the module at <em>Configuration > Search and metadata > Metatag AI Generate</em> when the settings page is available.',\n  ));\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction metatag_ai_generate_uninstall($is_syncing): void {\n  // Nettoyer les etats si necessaire.\n  \\Drupal::state()->delete('metatag_ai_generate.last_generation');\n}\n", "metadata": {"source": "repos/metatag_ai_generate/metatag_ai_generate.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MetatagAiGenerate", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class EntityTypeProtection in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Plugin\\ProtectionRule;\n\nuse Drupal\\Core\\Entity\\Query\\QueryInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Protects entire entity types or specific bundles from deletion.\n *\n * @ProtectionRule(\n *   id = \"entity_type\",\n *   label = @Translation(\"Entity Type\"),\n *   description = @Translation(\"Protect entire entity types or specific bundles from deletion.\"),\n *   category = @Translation(\"Entity\")\n * )\n */\nclass EntityTypeProtection extends ProtectionRulePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return [\n      'entity_type' => '',\n      'bundles' => [],\n      'protect_all_bundles' => TRUE,\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    // Get entity type options.\n    $entity_type_options = $this->getEntityTypeOptions();\n\n    // Determine current entity type value.\n    $entity_type = $form_state->getValue(['configuration', 'entity_type'], $this->configuration['entity_type']);\n    // If still empty but we have options, use the first one as default.\n    if (empty($entity_type) && !empty($entity_type_options)) {\n      $entity_type = array_key_first($entity_type_options);\n    }\n\n    // Determine protect_all_bundles value from form_state or configuration.\n    $protect_all_bundles = $form_state->getValue(['configuration', 'protect_all_bundles']);\n    if ($protect_all_bundles === NULL) {\n      $protect_all_bundles = $this->configuration['protect_all_bundles'];\n    }\n    $protect_all_bundles = (bool) $protect_all_bundles;\n\n    $form['entity_type'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Entity type'),\n      '#description' => $this->t('Select the entity type to protect.'),\n      '#options' => $entity_type_options,\n      '#default_value' => $entity_type,\n      '#required' => TRUE,\n      '#ajax' => [\n        'callback' => [static::class, 'updateBundlesCallback'],\n        'wrapper' => 'entity-type-bundles-wrapper',\n      ],\n    ];\n\n    // Wrap both checkbox and bundles in AJAX wrapper.\n    $form['bundles_container'] = [\n      '#type' => 'container',\n      '#attributes' => ['id' => 'entity-type-bundles-wrapper'],\n    ];\n\n    $form['bundles_container']['protect_all_bundles'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Protect all bundles'),\n      '#description' => $this->t('If unchecked, you can select specific bundles to protect.'),\n      '#default_value' => $protect_all_bundles,\n      '#parents' => ['configuration', 'protect_all_bundles'],\n      '#ajax' => [\n        'callback' => [static::class, 'updateBundlesCallback'],\n        'wrapper' => 'entity-type-bundles-wrapper',\n      ],\n    ];\n\n    $bundle_options = [];\n    if ($entity_type) {\n      $bundle_options = $this->getBundleOptions($entity_type);\n    }\n\n    $form['bundles_container']['bundles'] = [\n      '#type' => 'checkboxes',\n      '#title' => $this->t('Bundles'),\n      '#description' => $this->t('Select specific bundles to protect.'),\n      '#options' => $bundle_options,\n      '#default_value' => $this->configuration['bundles'],\n      '#parents' => ['configuration', 'bundles'],\n      // PHP-side visibility control.\n      '#access' => !$protect_all_bundles,\n    ];\n\n    return $form;\n  }\n\n  /**\n   * Ajax callback to update bundles.\n   */\n  public static function updateBundlesCallback(array &$form, FormStateInterface $form_state): array {\n    return $form['configuration']['bundles_container'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state): void {\n    $this->configuration['entity_type'] = $form_state->getValue('entity_type');\n    $this->configuration['protect_all_bundles'] = (bool) $form_state->getValue('protect_all_bundles');\n    $this->configuration['bundles'] = array_filter($form_state->getValue('bundles', []));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function appliesTo(string $entity_type_id, ?string $bundle = NULL): bool {\n    if ($this->configuration['entity_type'] !== $entity_type_id) {\n      return FALSE;\n    }\n\n    if ($this->configuration['protect_all_bundles']) {\n      return TRUE;\n    }\n\n    if ($bundle === NULL) {\n      return !empty($this->configuration['bundles']);\n    }\n\n    return in_array($bundle, $this->configuration['bundles'], TRUE);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function modifyQuery(QueryInterface $query, string $entity_type_id, ?string $bundle = NULL): void {\n    // This plugin prevents wipe entirely, so no query modification needed.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function shouldPreventWipe(string $entity_type_id, ?string $bundle = NULL): bool {\n    return $this->appliesTo($entity_type_id, $bundle);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function summary(): string {\n    $entity_type = $this->configuration['entity_type'];\n    if (empty($entity_type)) {\n      return (string) $this->t('No entity type configured');\n    }\n\n    $entity_type_label = $this->entityTypeManager->getDefinition($entity_type)->getLabel() ?? $entity_type;\n\n    if ($this->configuration['protect_all_bundles']) {\n      return (string) $this->t('Protect all @type entities', ['@type' => $entity_type_label]);\n    }\n\n    $bundles = array_filter($this->configuration['bundles']);\n    if (empty($bundles)) {\n      return (string) $this->t('No bundles selected for @type', ['@type' => $entity_type_label]);\n    }\n\n    return (string) $this->t('Protect @type bundles: @bundles', [\n      '@type' => $entity_type_label,\n      '@bundles' => implode(', ', $bundles),\n    ]);\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Plugin/ProtectionRule/EntityTypeProtection.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityTypeProtection", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "canvas_full_html.settings:\n  title: 'Canvas Full HTML'\n  description: 'Configure Full HTML text format for Canvas WYSIWYG editors.'\n  route_name: canvas_full_html.settings\n  parent: system.admin_config_content\n  weight: 10\n", "metadata": {"source": "repos/canvas_full_html/canvas_full_html.links.menu.yml", "type": "yaml_reference", "topic": "canvas full html.links.menu"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: d6_node_type\nlabel: Node type configuration\nmigration_tags:\n  - Drupal 6\n  - Configuration\nsource:\n  plugin: d6_node_type\n  constants:\n    preview: 1 # NodePreviewMode::Optional\n    create_body: false\nprocess:\n  type: type\n  name: name\n  module: module\n  description: description\n  help: help\n  title_label: title_label\n  'preview_mode': 'constants/preview'\n  'display_submitted': display_submitted\n  'new_revision': 'options/revision'\n  'settings/node/options': options\n  create_body: has_body\n  create_body_label: body_label\n  'third_party_settings/menu_ui/available_menus':\n    plugin: static_map\n    bypass: true\n    source: available_menus\n    map:\n      main-menu: main\n      management: admin\n      navigation: tools\n      user-menu: account\n  'third_party_settings/menu_ui/parent':\n    plugin: static_map\n    bypass: true\n    source: parent\n    map:\n      'main-menu:': 'main:'\n      'management:': 'admin:'\n      'navigation:': 'tools:'\n      'user-menu:': 'account:'\ndestination:\n  plugin: entity:node_type\n", "metadata": {"source": "repos/drupal_core/core/modules/node/migrations/d6_node_type.yml", "type": "yaml_reference", "topic": "d6 node type"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Delete.php\nTarget symbol: class for\nNamespace: Drupal\\Core\\Database\\Query\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Database\\Connection\n- Ensure these methods exist where relevant:\n  - __construct()\n  - __toString()\n  - execute()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Database\\Query;\n\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * General class for an abstracted DELETE operation.\n *\n * @ingroup database\n */\nclass Delete extends Query implements ConditionInterface {\n\n  use QueryConditionTrait;\n\n  /**\n   * The table from which to delete.\n   *\n   * @var string\n   */\n  protected $table;\n\n  /**\n   * Constructs a Delete object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   A Connection object.\n   * @param string $table\n   *   Name of the table to associate with this query.\n   * @param array $options\n   *   Array of database options.\n   */\n  public function __construct(Connection $connection, $table, array $options = []) {\n    parent::__construct($connection, $options);\n    $this->table = $table;\n\n    $this->condition = $this->connection->condition('AND');\n  }\n\n  /**\n   * Executes the DELETE query.\n   *\n   * @return int\n   *   The number of rows affected by the delete query.\n   */\n  public function execute() {\n    $values = [];\n    if (count($this->condition)) {\n      $this->condition->compile($this->connection, $this);\n      $values = $this->condition->arguments();\n    }\n\n    $stmt = $this->connection->prepareStatement((string) $this, $this->queryOptions, TRUE);\n    try {\n      $stmt->execute($values, $this->queryOptions);\n      return $stmt->rowCount();\n    }\n    catch (\\Exception $e) {\n      $this->connection->exceptionHandler()->handleExecutionException($e, $stmt, $values, $this->queryOptions);\n    }\n  }\n\n  /**\n   * Implements PHP magic __toString method to convert the query to a string.\n   *\n   * @return string\n   *   The prepared statement.\n   */\n  public function __toString() {\n    // Create a sanitized comment string to prepend to the query.\n    $comments = $this->connection->makeComment($this->comments);\n\n    $query = $comments . 'DELETE FROM {' . $this->connection->escapeTable($this->table) . '} ';\n\n    if (count($this->condition)) {\n\n      $this->condition->compile($this->connection, $this);\n      $query .= \"\\nWHERE \" . $this->condition;\n    }\n\n    return $query;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Query/Delete.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Delete", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: Batch.php\nTarget symbol: class Batch\nNamespace: Drupal\\Core\\Queue\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Batch.\n- Ensure these methods exist where relevant:\n  - claimItem()\n  - getAllItems()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Queue;\n\n/**\n * Defines a batch queue handler used by the Batch API.\n *\n * This implementation:\n * - Ensures FIFO ordering.\n * - Allows an item to be repeatedly claimed until it is actually deleted (no\n *   notion of lease time or 'expire' date), to allow multipass operations.\n *\n * Stale items from failed batches are cleaned from the {queue} table on cron\n * using the 'created' date.\n *\n * @ingroup queue\n */\nclass Batch extends DatabaseQueue {\n\n  /**\n   * Overrides \\Drupal\\Core\\Queue\\DatabaseQueue::claimItem().\n   *\n   * Unlike \\Drupal\\Core\\Queue\\DatabaseQueue::claimItem(), this method provides\n   * a default lease time of 0 (no expiration) instead of 30. This allows the\n   * item to be claimed repeatedly until it is deleted.\n   */\n  public function claimItem($lease_time = 0) {\n    try {\n      $item = $this->connection->queryRange('SELECT [data], [item_id] FROM {queue} q WHERE [name] = :name ORDER BY [item_id] ASC', 0, 1, [':name' => $this->name])->fetchObject();\n      if ($item) {\n        $item->data = unserialize($item->data);\n        return $item;\n      }\n    }\n    catch (\\Exception $e) {\n      $this->catchException($e);\n    }\n    return FALSE;\n  }\n\n  /**\n   * Retrieves all remaining items in the queue.\n   *\n   * This is specific to Batch API and is not part of the\n   * \\Drupal\\Core\\Queue\\QueueInterface.\n   *\n   * @return array\n   *   An array of queue items.\n   */\n  public function getAllItems() {\n    $result = [];\n    try {\n      $items = $this->connection->select('queue', 'q')\n        ->fields('q', ['data'])\n        ->condition('name', $this->name)\n        ->orderBy('item_id', 'ASC')\n        ->execute()\n        ->fetchAll();\n\n      foreach ($items as $item) {\n        $result[] = unserialize($item->data);\n      }\n    }\n    catch (\\Exception $e) {\n      $this->catchException($e);\n    }\n    return $result;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Queue/Batch.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Batch", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: FormController.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Controller;\n\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Drupal\\Core\\Form\\FormBuilderInterface;\nuse Drupal\\Core\\Form\\FormState;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface;\n\n/**\n * Common base class for form interstitial controllers.\n */\nabstract class FormController {\n  use DependencySerializationTrait;\n\n  /**\n   * The argument resolver.\n   *\n   * @var \\Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface\n   */\n  protected $argumentResolver;\n\n  /**\n   * The form builder.\n   *\n   * @var \\Drupal\\Core\\Form\\FormBuilderInterface\n   */\n  protected $formBuilder;\n\n  /**\n   * Constructs a new \\Drupal\\Core\\Controller\\FormController object.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface $argument_resolver\n   *   The argument resolver.\n   * @param \\Drupal\\Core\\Form\\FormBuilderInterface $form_builder\n   *   The form builder.\n   */\n  public function __construct(ArgumentResolverInterface $argument_resolver, FormBuilderInterface $form_builder) {\n    $this->argumentResolver = $argument_resolver;\n    $this->formBuilder = $form_builder;\n  }\n\n  /**\n   * Invokes the form and returns the result.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   *\n   * @return array\n   *   The render array that results from invoking the controller.\n   */\n  public function getContentResult(Request $request, RouteMatchInterface $route_match) {\n    $form_arg = $this->getFormArgument($route_match);\n    $form_object = $this->getFormObject($route_match, $form_arg);\n\n    // Add the form and form_state to trick the getArguments method of the\n    // controller resolver.\n    $form_state = new FormState();\n    $request->attributes->set('form', []);\n    $request->attributes->set('form_state', $form_state);\n    $args = $this->argumentResolver->getArguments($request, [$form_object, 'buildForm']);\n    $request->attributes->remove('form');\n    $request->attributes->remove('form_state');\n\n    // Remove $form and $form_state from the arguments, and re-index them.\n    unset($args[0], $args[1]);\n    $form_state->addBuildInfo('args', array_values($args));\n\n    return $this->formBuilder->buildForm($form_object, $form_state);\n  }\n\n  /**\n   * Extracts the form argument string from a request.\n   *\n   * Depending on the type of form the argument string may be stored in a\n   * different request attribute.\n   *\n   * One example of a route definition is given below.\n   * @code\n   *   defaults:\n   *     _form: Drupal\\example\\Form\\ExampleForm\n   * @endcode\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match object from which to extract a form definition string.\n   *\n   * @return string\n   *   The form definition string.\n   */\n  abstract protected function getFormArgument(RouteMatchInterface $route_match);\n\n  /**\n   * Returns the object used to build the form.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   * @param string $form_arg\n   *   Either a class name or a service ID.\n   *\n   * @return \\Drupal\\Core\\Form\\FormInterface\n   *   The form object to use.\n   */\n  abstract protected function getFormObject(RouteMatchInterface $route_match, $form_arg);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Controller;\n\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Drupal\\Core\\Form\\FormBuilderInterface;\nuse Drupal\\Core\\Form\\FormState;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface;\n\n/**\n * Common base class for form interstitial controllers.\n */\nabstract class FormController {\n  use DependencySerializationTrait;\n\n  /**\n   * The argument resolver.\n   *\n   * @var \\Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface\n   */\n  protected $argumentResolver;\n\n  /**\n   * The form builder.\n   *\n   * @var \\Drupal\\Core\\Form\\FormBuilderInterface\n   */\n  protected $formBuilder;\n\n  /**\n   * Constructs a new \\Drupal\\Core\\Controller\\FormController object.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface $argument_resolver\n   *   The argument resolver.\n   * @param \\Drupal\\Core\\Form\\FormBuilderInterface $form_builder\n   *   The form builder.\n   */\n  public function __construct(ArgumentResolverInterface $argument_resolver, FormBuilderInterface $form_builder) {\n    $this->argumentResolver = $argument_resolver;\n    $this->formBuilder = $form_builder;\n  }\n\n  /**\n   * Invokes the form and returns the result.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   *\n   * @return array\n   *   The render array that results from invoking the controller.\n   */\n  public function getContentResult(Request $request, RouteMatchInterface $route_match) {\n    $form_arg = $this->getFormArgument($route_match);\n    $form_object = $this->getFormObject($route_match, $form_arg);\n\n    // Add the form and form_state to trick the getArguments method of the\n    // controller resolver.\n    $form_state = new FormState();\n    $request->attributes->set('form', []);\n    $request->attributes->set('form_state', $form_state);\n    $args = $this->argumentResolver->getArguments($request, [$form_object, 'buildForm']);\n    $request->attributes->remove('form');\n    $request->attributes->remove('form_state');\n\n    // Remove $form and $form_state from the arguments, and re-index them.\n    unset($args[0], $args[1]);\n    $form_state->addBuildInfo('args', array_values($args));\n\n    return $this->formBuilder->buildForm($form_object, $form_state);\n  }\n\n  /**\n   * Extracts the form argument string from a request.\n   *\n   * Depending on the type of form the argument string may be stored in a\n   * different request attribute.\n   *\n   * One example of a route definition is given below.\n   * @code\n   *   defaults:\n   *     _form: Drupal\\example\\Form\\ExampleForm\n   * @endcode\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match object from which to extract a form definition string.\n   *\n   * @return string\n   *   The form definition string.\n   */\n  abstract protected function getFormArgument(RouteMatchInterface $route_match);\n\n  /**\n   * Returns the object used to build the form.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   * @param string $form_arg\n   *   Either a class name or a service ID.\n   *\n   * @return \\Drupal\\Core\\Form\\FormInterface\n   *   The form object to use.\n   */\n  abstract protected function getFormObject(RouteMatchInterface $route_match, $form_arg);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/FormController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FormController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ToolApiIntegration.php\nTarget symbol: class ToolApiIntegration\nNamespace: Drupal\\api_normalization\\Integration\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ToolApiIntegration.\n- Include required imports:\n  - Drupal\\api_normalization\\Service\\FeatureManager\n  - Drupal\\api_normalization\\Service\\ToolSchemaGenerator\n  - Drupal\\Core\\Extension\\ModuleHandlerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - addTool()\n  - getToolId()\n  - getToolSchema()\n  - getTools()\n  - isEnabled()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Integration;\n\nuse Drupal\\api_normalization\\Service\\FeatureManager;\nuse Drupal\\api_normalization\\Service\\ToolSchemaGenerator;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\n\n/**\n * Integration with Tool API module.\n */\nclass ToolApiIntegration {\n\n  /**\n   * Array of tools.\n   */\n  private array $tools = [];\n\n  public function __construct(\n    private readonly ToolSchemaGenerator $schemaGenerator,\n    private readonly ModuleHandlerInterface $moduleHandler,\n    private readonly FeatureManager $featureManager,\n  ) {}\n\n  /**\n   * Check if MCP integration is enabled.\n   *\n   * @return bool\n   *   TRUE if feature is enabled.\n   */\n  public function isEnabled(): bool {\n    return $this->featureManager->isEnabled('mcp_integration');\n  }\n\n  /**\n   * Add a tool from Tool API.\n   *\n   * @param object $tool\n   *   Tool API tool object.\n   */\n  public function addTool(object $tool): void {\n    if (!$this->isEnabled()) {\n      return;\n    }\n    $this->tools[] = $tool;\n  }\n\n  /**\n   * Get schema for Tool API tool.\n   *\n   * @param string $toolId\n   *   Tool ID.\n   *\n   * @return array|null\n   *   OpenAPI schema or NULL if not found.\n   */\n  public function getToolSchema(string $toolId): ?array {\n    foreach ($this->tools as $tool) {\n      if ($this->getToolId($tool) === $toolId) {\n        return $this->schemaGenerator->generateOpenApiSchema($tool);\n      }\n    }\n    return NULL;\n  }\n\n  /**\n   * Get all Tool API tools.\n   *\n   * @return array\n   *   Array of tools.\n   */\n  public function getTools(): array {\n    return $this->tools;\n  }\n\n  /**\n   * Get tool ID.\n   */\n  protected function getToolId(object $tool): string {\n    if (method_exists($tool, 'getId')) {\n      return $tool->getId();\n    }\n    if (method_exists($tool, 'getPluginId')) {\n      return $tool->getPluginId();\n    }\n    if (isset($tool->id)) {\n      return $tool->id;\n    }\n    return 'unknown_tool';\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Integration/ToolApiIntegration.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ToolApiIntegration", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface PermissionCheckerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Session;\n\n/**\n * Defines a permission checker interface.\n *\n * This service checks if a role has a permission. It can be swapped out or\n * decorated to allow for more complex logic. If you do so, ensure that you\n * provide ample automated tests so your site remains secure.\n *\n * @ingroup user_api\n */\ninterface PermissionCheckerInterface {\n\n  /**\n   * Checks whether an account has a permission.\n   *\n   * @param string $permission\n   *   The name of the permission to check for.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The user account for which to check the permissions.\n   *\n   * @return bool\n   *   Whether the account has the permission.\n   */\n  public function hasPermission(string $permission, AccountInterface $account): bool;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Session/PermissionCheckerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PermissionCheckerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Configuring Sublime Text", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Screenshot](/docs/develop/development-tools/editors-and-ides/configuring-sublime-text#s-screenshot)\n* [Configuration](/docs/develop/development-tools/editors-and-ides/configuring-sublime-text#s-configuration)\n* [Enabling whitespace characters](/docs/develop/development-tools/editors-and-ides/configuring-sublime-text#s-enabling-whitespace-characters)\n* [Useful plugins](/docs/develop/development-tools/editors-and-ides/configuring-sublime-text#s-useful-plugins)\n* [Other resources](/docs/develop/development-tools/editors-and-ides/configuring-sublime-text#s-other-resources)\n\n## [Editors and IDEs](/docs/develop/development-tools/editors-and-ides)\n\n* [PHPStorm](/docs/develop/development-tools/editors-and-ides/configuring-phpstorm)\n* [Sublime Text](/docs/develop/development-tools/editors-and-ides/configuring-sublime-text)\n* [Vim](/docs/develop/development-tools/editors-and-ides/configuring-vim)\n* [Emacs](/docs/develop/development-tools/editors-and-ides/emacs)\n* [Eclipse](/docs/develop/development-tools/editors-and-ides/configuring-eclipse)\n* [Komodo](/docs/develop/development-tools/editors-and-ides/komodo)\n* [NetBeans](/docs/develop/development-tools/editors-and-ides/netbeans)\n* [Visual Studio Code](/docs/develop/development-tools/editors-and-ides/configuring-visual-studio-code)\n* [jEdit](/docs/develop/development-tools/editors-and-ides/configuring-jedit)\n* [GNU Global setup for Drupal](/docs/develop/development-tools/editors-and-ides/gnu-global-setup-for-drupal)\n\n# Configuring Sublime Text\n\nLast [updated](/node/1346890/discuss) on\n\n21 September 2022\n\n[Sublime Text](http://sublimetext.com/) is a sophisticated text editor for code, html and prose. You'll love the slick user interface and extraordinary features.\n\nSublime Text is available for OS X, Windows and Linux.\n\n### Screenshot\n\n![screenshot sublime text](/files/sublime.png)\n\n### Configuration\n\nFor linux and mac users there is a script to auto configure your sublime at [Sublime Drupal](https://github.com/enzolutions/sublime-drupal).\n\nGo to \"Preferences\" => \"Settings - User\" and change the following settings:\n\n```\n{\n  \"rulers\": [80],\n  \"tab_size\": 2,\n  \"translate_tabs_to_spaces\": true,\n  \"use_tab_stops\": true,\n  \"trim_automatic_white_space\": true,\n  \"trim_trailing_white_space_on_save\": true,\n  \"ensure_newline_at_eof_on_save\": true,\n  \"fallback_encoding\": \"UTF-8\",\n  \"default_line_ending\": \"unix\",\n  \"shift_tab_unindent\": true,\n  \"word_separators\": \"./\\\\()\\\\'-:,.;<>~!@#%^&*|+=[]{}`~?\"\n}\n```\n\n### Enabling whitespace characters\n\nOptionally, you could also add a setting to view whitespace characters to the end of the code settings (found above):\n\n```\n\"draw_white_space\": \"all\"\n```\n\n### Useful plugins\n\n* **[Sublime Coder](https://github.com/mattwithoos/SublimeText3DrupalCoder)**: A plugin that provides integration with Coder (specifically Drupal Code Sniffer)\u00a0for Sublime Text 3.\n* **[Sublime Drush](https://github.com/kostajh/sublime-drush)**: A plugin that provides integration with Drush 6 for Sublime Text 3.\n* **[Goto Drupal API](https://github.com/BrianGilbert/Sublime-Text-2-Goto-Drupal-API)**: A command to jump to the api.drupal.org documentation for the current word.\n* **[Go to Documentation](https://github.com/kemayo/sublime-text-2-goto-documentation)**: A command to jump to the documentation for the current word. Supported languages include PHP and Javascript.\n* **[Drupal Sublime text](https://github.com/robballou/drupal-sublimetext)**: A package for Drupal snippets, autocomplete support, and info file syntax highlighting for Sublime Text.\n* **[CodeComplice](https://github.com/spectacles/CodeComplice)**: A code intelligence plugin\u00a0for Sublime Text 3.\n\n### Other resources\n\n* **[Sublime Text 2 autocompletion drush command](http://drupal.org/project/sublime_completion)**: A drush based Drupal autocomplete file generator for ST2.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/1346890/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%281346890%29%20Configuring%20Sublime%20Text) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/development-tools/editors-and-ides/configuring-sublime-text.md", "type": "doc_summary", "topic": "Configuring Sublime Text"}}
{"instruction": "Show me the implementation of the class UnableToResolveProjectRootException in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types = 1);\n\n/**\n * Copyright (C) 2025 PRONOVIX GROUP.\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,\n * USA.\n */\n\nnamespace Drupal\\recipe_code_installer\\Application\\Port\\Exception;\n\n/**\n * Thrown when the project root could not be resolved.\n *\n * @internal This class is not part of the module's public programming API.\n */\nfinal class UnableToResolveProjectRootException extends \\Exception {}\n", "metadata": {"source": "repos/recipe_code_installer/src/Application/Port/Exception/UnableToResolveProjectRootException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UnableToResolveProjectRootException", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Buttons", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Use when](/docs/develop/user-interface-standards/buttons#s-use-when)\n* [Example](/docs/develop/user-interface-standards/buttons#s-example)\n* [Recommendations](/docs/develop/user-interface-standards/buttons#s-recommendations)\n* [API](/docs/develop/user-interface-standards/buttons#s-api)\n* [Problem it solves](/docs/develop/user-interface-standards/buttons#s-problem-it-solves)\n\n## [User interface standards](/docs/develop/user-interface-standards)\n\n* [Form elements](/docs/develop/user-interface-standards/form-elements)\n* [Buttons](/docs/develop/user-interface-standards/buttons)\n* [Dropbutton](/docs/develop/user-interface-standards/dropdown-buttons)\n* [Radio buttons](/docs/develop/user-interface-standards/radio-buttons)\n* [Checkboxes](/docs/develop/user-interface-standards/checkbox-and-checkboxes)\n* [Select list](/docs/develop/user-interface-standards/select-list)\n* [Navigation](/docs/develop/user-interface-standards/navigation)\n* [Contextual Links](/docs/develop/user-interface-standards/contextual-links)\n* [Local action](/docs/develop/user-interface-standards/local-action)\n* [Tabs](/docs/develop/user-interface-standards/tabs)\n* [Details](/docs/develop/user-interface-standards/details)\n* [Fieldsets](/docs/develop/user-interface-standards/fieldsets)\n* [Vertical tabs](/docs/develop/user-interface-standards/vertical-tabs)\n* [Listings](/docs/develop/user-interface-standards/listings)\n* [Table](/docs/develop/user-interface-standards/table)\n* [Interface text](/docs/develop/user-interface-standards/interface-text)\n* [Machine name](/docs/develop/user-interface-standards/machine-name)\n* [Tours](/docs/develop/user-interface-standards/tours)\n* [Tour text standards](/docs/extending-drupal/contributed-modules/contributed-module-documentation/tour/tour-text-standards)\n\n# Buttons\n\nLast [updated](/node/1850248/discuss) on\n\n26 August 2025\n\n## Use when\n\nYou want to express an immediate action. A button consists of text or an icon (or both text and an icon) that communicates what action occurs when the user clicks it.\n\n### Example\n\n![](/files/all_buttons_default_hover_active.png)\n\n### Recommendations\n\n* Decide if a button is a right control to use. Buttons should be used to initiate immediate action. Do **not** use a button:\n  + To navigate to another page, window, or Help topic. *(Exception: Wizard navigation uses Back and Next command buttons.)*\n  + If the command is embedded in a body of text.\n  + If the command is secondary in nature. That is, it does not relate to the primary purpose of the window. In this case, either a lightweight command button or link would be appropriate.\n  + If the command is part of a menu or group of related links.\n  + If the label is lengthy, consisting of five or more words, thus giving a command button an awkward appearance.\n* Choose the right button style:\n  + Choose a button style depending on the primacy of the button, the number of containers on the screen, and the screen layout.\n  + Choose a raised or flat button depending on the container it will be in and depending on the number of z-space layers you have on the screen.\n  + Use primarily one type of button per container. Only mix button types when you have a good reason to, such as emphasizing an important function.\n  + Use the\u00a0`#button_type` property to add the styling for the buttons. Available button types are\u00a0*primary* and *dangerous.*\n    - Use *primary* only for a button that truly completes the form submission.\n    - Use *danger* only for a destructive button if it appears as an alternative option within a set of other buttons.\n* Determine if you should use radio buttons in conjunction with generic command buttons. Use radio buttons if:\n  + There are five or more possible actions.\n  + Users need to view additional information before making a decision.\n  + Users need to interact with the choices (perhaps to see additional information) before making a decision.\n  + Users view the choices as options instead of different commands.\n\n### API\n\n[Drupal 10](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21Button.php/class/Button/10),\u00a0[Drupal 9](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21Button.php/class/Button/9),\u00a0[Drupal 8.9](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21Button.php/class/Button/8.9.x), [Drupal 7](https://api.drupal.org/api/drupal/developer!topics!forms_api_reference.html/7.x#button), [Drupal 6](https://api.drupal.org/api/drupal/developer!topics!forms_api_reference.html/6.x#button)\n\n### Problem it solves\n\nA button highlights important actions that can take place like submitting a form, editing a page, or clicking through to a point of interest.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/1850248/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%281850248%29%20Buttons) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/user-interface-standards/buttons.md", "type": "doc_summary", "topic": "Buttons"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nname: medium_21_9\nlabel: 'Medium 21:9 (1024x440)'\neffects:\n  52985ed4-81d6-4ecf-90c1-4e8c651f76ba:\n    uuid: 52985ed4-81d6-4ecf-90c1-4e8c651f76ba\n    id: image_scale_and_crop\n    weight: 1\n    data:\n      width: 1024\n      height: 440\n      anchor: center-center\n  dd8d02b0-2ae5-4e0c-988f-730711911c49:\n    uuid: dd8d02b0-2ae5-4e0c-988f-730711911c49\n    id: image_convert_avif\n    weight: 2\n    data:\n      extension: webp\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/image.style.medium_21_9.yml", "type": "yaml_reference", "topic": "image.style.medium 21 9"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# yaml-language-server: $schema=../../../../vendor/symfony/dependency-injection/Loader/schema/services.schema.json\nservices:\n  logger.channel.nexi_xpay:\n    parent: logger.channel_base\n    arguments: ['nexi_xpay']\n\n  nexi_xpay.logger:\n    class: Drupal\\nexi_xpay\\Service\\Logger\n    arguments:\n      - '@logger.channel.nexi_xpay'\n      - '@config.factory'\n\n  nexi_xpay.client:\n    class: Drupal\\nexi_xpay\\Service\\NexiXpayClient\n    arguments:\n      - '@http_client'\n      - '@config.factory'\n      - '@nexi_xpay.logger'\n      - '@uuid'\n\n  nexi_xpay.mode_manager:\n    class: Drupal\\nexi_xpay\\Plugin\\XpayMode\\NexiXpayModeManager\n    arguments:\n      - '@container.namespaces'\n      - '@cache.discovery'\n      - '@module_handler'\n\n  nexi_xpay.manager:\n    class: Drupal\\nexi_xpay\\Service\\NexiXpayManager\n    arguments:\n      - '@nexi_xpay.client'\n      - '@nexi_xpay.mode_manager'\n      - '@nexi_xpay.logger'\n\n  nexi_xpay.status_updater:\n    class: Drupal\\nexi_xpay\\Service\\TransactionStatusUpdater\n    arguments:\n      - '@event_dispatcher'\n      - '@nexi_xpay.logger'\n", "metadata": {"source": "repos/nexi_xpay/nexi_xpay.services.yml", "type": "yaml_reference", "topic": "nexi xpay.services"}}
{"instruction": "Show me the implementation of the class SoapOperation in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Plugin\\OperationDispatcher;\n\nuse Drupal\\soap_client\\Plugin\\OperationDispatcherBase;\n\n/**\n * Provides the default SoapOperation dispatcher plugin.\n *\n * @OperationDispatcher(\n *   id = \"soap_operation\",\n * )\n */\nclass SoapOperation extends OperationDispatcherBase {}\n", "metadata": {"source": "repos/soap_client/src/Plugin/OperationDispatcher/SoapOperation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapOperation", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Date\nSource file: <source_file>\nFile name hint: Date.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\Component\\Datetime\\TimeInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItem;\nuse Drupal\\views\\Attribute\\ViewsArgument;\nuse Drupal\\views\\FieldAPIHandlerTrait;\nuse Drupal\\views\\Plugin\\views\\argument\\Date as NumericDate;\n\n/**\n * Abstract argument handler for dates.\n *\n * Adds an option to set a default argument based on the current date.\n *\n * Definitions terms:\n * - many to one: If true, the \"many to one\" helper will be used.\n * - invalid input: A string to give to the user for obviously invalid input.\n *                  This is deprecated in favor of argument validators.\n *\n * @see \\Drupal\\views\\ManyToOneHelper\n *\n * @ingroup views_argument_handlers\n */\n#[ViewsArgument(\n  id: 'datetime',\n)]\nclass Date extends NumericDate {\n\n  use FieldAPIHandlerTrait;\n\n  /**\n   * Determines if the timezone offset is calculated.\n   *\n   * @var bool\n   */\n  protected $calculateOffset = TRUE;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    RouteMatchInterface $route_match,\n    DateFormatterInterface $date_formatter,\n    TimeInterface $time,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $route_match, $date_formatter, $time);\n\n    $definition = $this->getFieldStorageDefinition();\n    if ($definition->getSetting('datetime_type') === DateTimeItem::DATETIME_TYPE_DATE) {\n      // Timezone offset calculation is not applicable to dates that are stored\n      // as date-only.\n      $this->calculateOffset = FALSE;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDateField() {\n    // Use string date storage/formatting since datetime fields are stored as\n    // strings rather than UNIX timestamps.\n    return $this->query->getDateField(\"$this->tableAlias.$this->realField\", TRUE, $this->calculateOffset);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDateFormat($format) {\n    // Pass in the string-field option.\n    return $this->query->getDateFormat($this->getDateField(), $format, TRUE);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\Component\\Datetime\\TimeInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItem;\nuse Drupal\\views\\Attribute\\ViewsArgument;\nuse Drupal\\views\\FieldAPIHandlerTrait;\nuse Drupal\\views\\Plugin\\views\\argument\\Date as NumericDate;\n\n/**\n * Abstract argument handler for dates.\n *\n * Adds an option to set a default argument based on the current date.\n *\n * Definitions terms:\n * - many to one: If true, the \"many to one\" helper will be used.\n * - invalid input: A string to give to the user for obviously invalid input.\n *                  This is deprecated in favor of argument validators.\n *\n * @see \\Drupal\\views\\ManyToOneHelper\n *\n * @ingroup views_argument_handlers\n */\n#[ViewsArgument(\n  id: 'datetime',\n)]\nclass Date extends NumericDate {\n\n  use FieldAPIHandlerTrait;\n\n  /**\n   * Determines if the timezone offset is calculated.\n   *\n   * @var bool\n   */\n  protected $calculateOffset = TRUE;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    RouteMatchInterface $route_match,\n    DateFormatterInterface $date_formatter,\n    TimeInterface $time,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $route_match, $date_formatter, $time);\n\n    $definition = $this->getFieldStorageDefinition();\n    if ($definition->getSetting('datetime_type') === DateTimeItem::DATETIME_TYPE_DATE) {\n      // Timezone offset calculation is not applicable to dates that are stored\n      // as date-only.\n      $this->calculateOffset = FALSE;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDateField() {\n    // Use string date storage/formatting since datetime fields are stored as\n    // strings rather than UNIX timestamps.\n    return $this->query->getDateField(\"$this->tableAlias.$this->realField\", TRUE, $this->calculateOffset);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDateFormat($format) {\n    // Pass in the string-field option.\n    return $this->query->getDateFormat($this->getDateField(), $format, TRUE);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/views/argument/Date.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Date", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class Note in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Notes node processor for adding documentation and comments to workflows.\n */\n#[FlowDropNodeProcessor(\n  id: \"note\",\n  label: new TranslatableMarkup(\"Note\"),\n  description: \"Add notes and comments\",\n  version: \"1.0.0\"\n)]\nfinal class Note extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Notes nodes don't require any inputs.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    // Notes nodes don't process data, they just store documentation.\n    return [\n      \"content\" => $params->get(\"content\", \"\"),\n      \"noteType\" => $params->get(\"noteType\", \"info\"),\n      \"message\" => \"Note content available for reference\",\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"content\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Note Content\",\n          \"description\" => \"Documentation or comment text (supports Markdown)\",\n          \"format\" => \"markdown\",\n          \"default\" => \"# Workflow Notes\\n\\nAdd your documentation here using **Markdown** formatting.\\n\\n## Features\\n- Supports **bold** and *italic* text\\n- Create lists and code blocks\\n- Add links and more!\",\n        ],\n        \"noteType\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Note Type\",\n          \"description\" => \"Visual style and color of the note\",\n          \"default\" => \"info\",\n          \"enum\" => [\"info\", \"warning\", \"success\", \"error\", \"note\"],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"content\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Note Content\",\n          \"description\" => \"The markdown content of the note\",\n          \"format\" => \"markdown\",\n        ],\n        \"noteType\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Note Type\",\n          \"description\" => \"The visual type of the note (info, warning, success, error, note)\",\n        ],\n        \"message\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Message\",\n          \"description\" => \"Status message about the note\",\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/Note.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Note", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Viewing Drupal announcements'\ntop_level: true\n---\n{% set actions_link_text %}\n{% trans %}Announcements{% endtrans %}\n{% endset %}\n{% set actions_link = render_var(help_route_link(actions_link_text, 'announcements_feed.announcement')) %}\n{% set permissions_link_text %}\n{% trans %}View official announcements related to Drupal{% endtrans %}\n{% endset %}\n{% set permissions_link = render_var(help_route_link(permissions_link_text, 'user.admin_permissions.module', {'modules': 'announcements_feed'})) %}\n<h2>{% trans %}What are Drupal announcements?{% endtrans %}</h2>\n<p>{% trans %}A feed of announcements about the Drupal project and Drupal Association programs.{% endtrans %}</p>\n<p>{% trans %}The purpose of this feed is to provide a channel for outreach directly to Drupal site owners. This content must be highly relevant to site owners interests, serve the strategic goals of the project, and/or promote the sustainability of the project and the Drupal Association.{% endtrans %}</p>\n<p>{% trans %}The module sources its content from a JSON feed generated from <a href=\"https://www.drupal.org/about/announcements\">here</a>. The governance policy for the content is documented <a href=\"https://www.drupal.org/node/3274085\">here</a>.{% endtrans %}</p>\n<h2>{% trans %}How can I see the Announcements in my site?{% endtrans %}</h2>\n<p>{% trans %}If you have the toolbar module enabled, you will see a direct link to them in the toolbar. If the toolbar module is not enabled, the content can always be accessed in the <em>{{ actions_link }}</em> page.{% endtrans %}</p>\n<h2>{% trans %}Who can see the Announcements?{% endtrans %}</h2>\n<p>{% trans %}Users with the <em>{{ permissions_link }}</em> permission can view Drupal announcements.{% endtrans %}</p>\n<h2>{% trans %}Additional resources{% endtrans %}</h2>\n<ul>\n  <li><a href=\"https://www.drupal.org/docs/core-modules-and-themes/core-modules/announcements-feed/announcements-feed-module-overview\">{% trans %}Announcement module overview{% endtrans %}</a></li>\n</ul>\n", "metadata": {"source": "repos/drupal_core/core/modules/announcements_feed/help_topics/announcements_feed.overview.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: helpers\nlabel: Helpers\ndescription: 'Handy utility nodes for common tasks like formatting, validation, debugging, logging, and workflow organization.'\nicon: 'mdi:help-circle'\ncolor: '#64748b'\nenabled: true\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_category/config/install/flowdrop_node_category.flowdrop_node_category.helpers.yml", "type": "yaml_reference", "topic": "flowdrop node category.flowdrop node category.helpers"}}
{"instruction": "Show me the implementation of the interface EntityFieldManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\n/**\n * Provides an interface for an entity field manager.\n */\ninterface EntityFieldManagerInterface {\n\n  /**\n   * Gets the base field definitions for a content entity type.\n   *\n   * Only fields that are not specific to a given bundle or set of bundles are\n   * returned. This excludes configurable fields, as they are always attached\n   * to a specific bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID. Only entity types that implement\n   *   \\Drupal\\Core\\Entity\\FieldableEntityInterface are supported.\n   *\n   * @return \\Drupal\\Core\\Field\\FieldDefinitionInterface[]\n   *   The array of base field definitions for the entity type, keyed by field\n   *   name.\n   *\n   * @throws \\LogicException\n   *   Thrown if one of the entity keys is flagged as translatable.\n   */\n  public function getBaseFieldDefinitions($entity_type_id);\n\n  /**\n   * Gets the field definitions for a specific bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID. Only entity types that implement\n   *   \\Drupal\\Core\\Entity\\FieldableEntityInterface are supported.\n   * @param string $bundle\n   *   The bundle.\n   *\n   * @return \\Drupal\\Core\\Field\\FieldDefinitionInterface[]\n   *   The array of field definitions for the bundle, keyed by field name.\n   */\n  public function getFieldDefinitions($entity_type_id, $bundle);\n\n  /**\n   * Gets the field storage definitions for a content entity type.\n   *\n   * This returns all field storage definitions for base fields and bundle\n   * fields of an entity type. Note that field storage definitions of a base\n   * field equal the full base field definition (i.e. they implement\n   * FieldDefinitionInterface), while the storage definitions for bundle fields\n   * may implement FieldStorageDefinitionInterface only.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID. Only content entities are supported.\n   *\n   * @return \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface[]\n   *   The array of field storage definitions for the entity type, keyed by\n   *   field name.\n   *\n   * @see \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface\n   */\n  public function getFieldStorageDefinitions($entity_type_id);\n\n  /**\n   * Gets a lightweight map of fields across bundles.\n   *\n   * @return array\n   *   An array keyed by entity type. Each value is an array which keys are\n   *   field names and value is an array with two entries:\n   *   - type: The field type.\n   *   - bundles: An associative array of the bundles in which the field\n   *     appears, where the keys and values are both the bundle's machine name.\n   */\n  public function getFieldMap();\n\n  /**\n   * Sets a lightweight map of fields across bundles.\n   *\n   * @param array[] $field_map\n   *   See the return value of self::getFieldMap().\n   *\n   * @return $this\n   */\n  public function setFieldMap(array $field_map);\n\n  /**\n   * Gets a lightweight map of fields across bundles filtered by field type.\n   *\n   * @param string $field_type\n   *   The field type to filter by.\n   *\n   * @return array\n   *   An array keyed by entity type. Each value is an array which keys are\n   *   field names and value is an array with two entries:\n   *   - type: The field type.\n   *   - bundles: An associative array of the bundles in which the field\n   *     appears, where the keys and values are both the bundle's machine name.\n   */\n  public function getFieldMapByFieldType($field_type);\n\n  /**\n   * Clears static and persistent field definition caches.\n   */\n  public function clearCachedFieldDefinitions();\n\n  /**\n   * Disable the use of caches.\n   *\n   * @param bool $use_caches\n   *   FALSE to not use any caches.\n   */\n  public function useCaches($use_caches = FALSE);\n\n  /**\n   * Gets the \"extra fields\" for a bundle.\n   *\n   * @param string $entity_type_id\n   *   The entity type ID.\n   * @param string $bundle\n   *   The bundle name.\n   *\n   * @return array\n   *   A nested array of 'pseudo-field' elements. Each list is nested within the\n   *   following keys: entity type, bundle name, context (either 'form' or\n   *   'display'). The keys are the name of the elements as appearing in the\n   *   renderable array (either the entity form or the displayed entity). The\n   *   value is an associative array:\n   *   - label: The human readable name of the element. Make sure you sanitize\n   *     this appropriately.\n   *   - description: A short description of the element contents.\n   *   - weight: The default weight of the element.\n   *   - visible: (optional) The default visibility of the element. Defaults to\n   *     TRUE.\n   *   - edit: (optional) String containing markup (normally a link) used as the\n   *     element's 'edit' operation in the administration interface. Only for\n   *     'form' context.\n   *   - delete: (optional) String containing markup (normally a link) used as\n   *     the element's 'delete' operation in the administration interface. Only\n   *     for 'form' context.\n   */\n  public function getExtraFields($entity_type_id, $bundle);\n\n  /**\n   * Returns the labels used for a field on an entity type.\n   *\n   * @param string $entity_type\n   *   The entity type.\n   * @param string $field_name\n   *   The machine name of the field.\n   *\n   * @return array\n   *   An array where the first element is the most commonly used label for the\n   *   field and the second element is a list of all labels in use. When more\n   *   than one label is used the same number of times then the labels are\n   *   sorted alphabetically.\n   */\n  public function getFieldLabels(string $entity_type, string $field_name): array;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/EntityFieldManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityFieldManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: StatementExecutionStartEvent\nSource file: <source_file>\nFile name hint: StatementExecutionStartEvent.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Database\\Event;\n\n/**\n * Represents the start of a statement execution as an event.\n */\nclass StatementExecutionStartEvent extends DatabaseEvent {\n\n  /**\n   * Constructs a StatementExecutionStartEvent object.\n   *\n   * See 'Customizing database settings' in settings.php for an explanation of\n   * the $key and $target connection values.\n   *\n   * @param int $statementObjectId\n   *   The id of the StatementInterface object as returned by spl_object_id().\n   * @param string $key\n   *   The database connection key.\n   * @param string $target\n   *   The database connection target.\n   * @param string $queryString\n   *   The SQL statement string being executed, with placeholders.\n   * @param array $args\n   *   The placeholders' replacement values.\n   * @param array $caller\n   *   A normalized debug backtrace entry representing the last non-db method\n   *   called.\n   */\n  public function __construct(\n    public readonly int $statementObjectId,\n    public readonly string $key,\n    public readonly string $target,\n    public readonly string $queryString,\n    public readonly array $args,\n    public readonly array $caller,\n  ) {\n    parent::__construct();\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Event;\n\n/**\n * Represents the start of a statement execution as an event.\n */\nclass StatementExecutionStartEvent extends DatabaseEvent {\n\n  /**\n   * Constructs a StatementExecutionStartEvent object.\n   *\n   * See 'Customizing database settings' in settings.php for an explanation of\n   * the $key and $target connection values.\n   *\n   * @param int $statementObjectId\n   *   The id of the StatementInterface object as returned by spl_object_id().\n   * @param string $key\n   *   The database connection key.\n   * @param string $target\n   *   The database connection target.\n   * @param string $queryString\n   *   The SQL statement string being executed, with placeholders.\n   * @param array $args\n   *   The placeholders' replacement values.\n   * @param array $caller\n   *   A normalized debug backtrace entry representing the last non-db method\n   *   called.\n   */\n  public function __construct(\n    public readonly int $statementObjectId,\n    public readonly string $key,\n    public readonly string $target,\n    public readonly string $queryString,\n    public readonly array $args,\n    public readonly array $caller,\n  ) {\n    parent::__construct();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Event/StatementExecutionStartEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StatementExecutionStartEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - field.storage.node.field_api_url\n    - node.type.api_endpoint\nid: node.api_endpoint.field_api_url\nfield_name: field_api_url\nentity_type: node\nbundle: api_endpoint\nlabel: 'API URL'\ndescription: 'The complete URL to the API endpoint, including protocol and path.'\nrequired: true\ntranslatable: false\ndefault_value: {  }\ndefault_value_callback: ''\nsettings:\n  link_type: 17\n  title: 1\nfield_type: link\n", "metadata": {"source": "repos/api_normalization/config/install.disabled/field.field.node.api_endpoint.field_api_url.yml", "type": "yaml_reference", "topic": "field.field.node.api endpoint.field api url"}}
{"instruction": "Show me the implementation of the class Compiler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\compiler\\Annotation;\n\nuse Drupal\\Component\\Annotation\\PluginID;\n\n/**\n * Defines a compiler plugin annotation object.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * @Annotation\n */\nclass Compiler extends PluginID {\n\n}\n", "metadata": {"source": "repos/compiler/src/Annotation/Compiler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Compiler", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: InstallerServiceProvider.php\nTarget symbol: class is\nNamespace: Drupal\\Core\\Installer\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for is.\n- Include required imports:\n  - Drupal\\Core\\DependencyInjection\\ContainerBuilder\n  - Drupal\\Core\\DependencyInjection\\ServiceProviderInterface\n  - Drupal\\Core\\DependencyInjection\\ServiceModifierInterface\n  - Symfony\\Component\\DependencyInjection\\Reference\n- Ensure these methods exist where relevant:\n  - alter()\n  - register()", "output": "<?php\n\nnamespace Drupal\\Core\\Installer;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderInterface;\nuse Drupal\\Core\\DependencyInjection\\ServiceModifierInterface;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * Service provider for the early installer environment.\n *\n * This class is manually added by install_begin_request() via\n * $conf['container_service_providers'] and required to prevent various services\n * from trying to retrieve data from storages that do not exist yet.\n */\nclass InstallerServiceProvider extends NormalInstallerServiceProvider implements ServiceProviderInterface, ServiceModifierInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function register(ContainerBuilder $container) {\n    // Inject the special configuration storage for the installer.\n    // This special implementation MUST NOT be used anywhere else than the early\n    // installer environment.\n    $container->register('config.storage', 'Drupal\\Core\\Config\\InstallStorage');\n\n    // Replace services with in-memory implementations.\n    $container\n      ->register('keyvalue', 'Drupal\\Core\\KeyValueStore\\KeyValueMemoryFactory');\n    $container\n      ->register('keyvalue.expirable', 'Drupal\\Core\\KeyValueStore\\KeyValueNullExpirableFactory');\n\n    // Replace services with no-op implementations.\n    $container\n      ->register('url_generator', 'Drupal\\Core\\Routing\\NullGenerator')\n      ->addArgument(new Reference('request_stack'));\n    $container\n      ->register('path_processor_manager', 'Drupal\\Core\\PathProcessor\\NullPathProcessorManager');\n    $container\n      ->register('router.dumper', 'Drupal\\Core\\Routing\\NullMatcherDumper');\n\n    // Replace the route builder with an empty implementation.\n    // @todo Convert installer steps into routes; add an installer.routing.yml.\n    $definition = $container->getDefinition('router.builder');\n    $definition->setClass('Drupal\\Core\\Installer\\InstallerRouteBuilder')\n      // The core router builder, but there is no reason here to be lazy, so\n      // we don't need to ship with a custom proxy class.\n      ->setLazy(FALSE);\n\n    parent::register($container);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alter(ContainerBuilder $container) {\n    // Disable Twig cache (php storage does not exist yet).\n    $twig_config = $container->getParameter('twig.config');\n    $twig_config['cache'] = FALSE;\n    $container->setParameter('twig.config', $twig_config);\n\n    // No service may persist when the early installer kernel is rebooted into\n    // the production environment.\n    // @todo The DrupalKernel reboot performed by drupal_install_system() is\n    //   actually not a \"regular\" reboot (like ModuleInstaller::install()), so\n    //   services are not actually persisted.\n    foreach ($container->findTaggedServiceIds('persist') as $id => $tags) {\n      $definition = $container->getDefinition($id);\n      $definition->clearTag('persist');\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Installer/InstallerServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InstallerServiceProvider", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# This is so your IDE knows about the syntax for fixes and autocomplete.\n$schema: https://git.drupalcode.org/project/drupal/-/raw/HEAD/core/assets/schemas/v1/metadata.schema.json\n\n# The human readable name.\nname: Umami Badge\n\n# Status can be: \"experimental\", \"stable\", \"deprecated\", \"obsolete\".\nstatus: experimental\n\n# Schema for the props. We support www.json-schema.org. Learn more about the\n# syntax there.\nprops:\n  # Props are always an object with keys. Each key is a variable in your\n  # component template.\n  type: object\n\n  properties:\n    attributes:\n      type: Drupal\\Core\\Template\\Attribute\n      title: Attributes\n      description: Wrapper attributes.\n    icon:\n      type: string\n      description: Icon Name\n      enum:\n        - knife\n        - timer\n        - serves\n        - difficulty\n      meta:enum:\n        knife: Knife\n        timer: Timer\n        serves: Serves\n        difficulty: Difficulty\n      x-translation-context: Umami recipes icon names\nslots:\n  label:\n    type: string\n    description: Label text\n  text:\n    type: string\n    description: Text\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/components/badge/badge.component.yml", "type": "yaml_reference", "topic": "badge.component"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Chapter 1. Understanding Drupal", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal User Guide](/docs/user_guide/en/index.html)\n\n* [Preface](/docs/user_guide/en/preface.html)\n* [Chapter 1. Understanding Drupal](/docs/user_guide/en/understanding-chapter.html)\n* [Chapter 2. Planning Your Site](/docs/user_guide/en/planning-chapter.html)\n* [Chapter 3. Installation](/docs/user_guide/en/installation-chapter.html)\n* [Chapter 4. Basic Site Configuration](/docs/user_guide/en/config-chapter.html)\n* [Chapter 5. Basic Page Management](/docs/user_guide/en/content-chapter.html)\n* [Chapter 6. Setting Up Content Structure](/docs/user_guide/en/content-structure-chapter.html)\n* [Chapter 7. Managing User Accounts](/docs/user_guide/en/user-chapter.html)\n* [Chapter 8. Blocks](/docs/user_guide/en/blocks-chapter.html)\n* [Chapter 9. Creating Listings with Views](/docs/user_guide/en/views-chapter.html)\n* [Chapter 10. Making Your Site Multilingual](/docs/user_guide/en/multilingual-chapter.html)\n* [Chapter 11. Extending and Customizing Your Site](/docs/user_guide/en/extend-chapter.html)\n* [Chapter 12. Preventing and Fixing Problems](/docs/user_guide/en/prevent-chapter.html)\n* [Chapter 13. Security and Maintenance](/docs/user_guide/en/security-chapter.html)\n* [Chapter 14. Final Thoughts](/docs/user_guide/en/thoughts-chapter.html)\n* [Glossary](/docs/user_guide/en/glossary.html)\n* [Index](/docs/user_guide/en/_index.html)\n* [Appendix A. Appendix](/docs/user_guide/en/appendix.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/understanding-chapter.html \"Cap\u00edtol 1. Entendre el Drupal\")\n* [Magyar](/hu/docs/user_guide/hu/understanding-chapter.html \"1. fejezet - Ismerked\u00e9s\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/understanding-chapter.html \"Cap\u00edtulo 1. Entendiendo Drupal\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/understanding-chapter.html \"\u0420\u043e\u0437\u0434\u0456\u043b 1. \u041f\u043e\u0440\u043e\u0437\u0443\u043c\u0456\u043d\u043d\u044f \u0437 Drupal-\u043e\u043c\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/understanding-chapter.html \"\u7b2c 1 \u7ae0 \u7406\u89e3 Drupal\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/understanding-chapter.html \"Chapitre 1. Comprendre Drupal\")\n* [Deutsch](/de/docs/user_guide/de/understanding-chapter.html \"Kapitel 1. Drupal verstehen\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/understanding-chapter.html \"\u0641\u0635\u0644 1. \u062f\u0631\u06a9 \u062f\u0631\u0648\u067e\u0627\u0644\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/understanding-chapter.html \"Bab 1. Memahami Drupal\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/understanding-chapter.html \"\u7b2c1\u7ae0 Drupal\u306b\u3064\u3044\u3066\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/understanding-chapter.html \"Cap\u00edtulo 1. Understanding Drupal\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/understanding-chapter.html \"\u0413\u043b\u0430\u0432\u0430 1. \u041e\u0441\u043d\u043e\u0432\u044b Drupal\")\n\n# Chapter 1. Understanding Drupal\n\n## [1.1. Concept: Drupal as a Content Management System](/docs/user_guide/en/understanding-drupal.html)\n\nOverview of Drupal and the reasons to choose it as a reliable Content Management\nSystem (CMS).\n\n## [1.2. Concept: Modules](/docs/user_guide/en/understanding-modules.html)\n\nOverview of modules and the functionality they can be used for.\n\n## [1.3. Concept: Themes](/docs/user_guide/en/understanding-themes.html)\n\nOverview of themes and where to obtain them.\n\n## [1.4. Concept: Distributions](/docs/user_guide/en/understanding-distributions.html)\n\nOverview of distributions, which can be used to set up websites for specific\npurposes.\n\n## [1.5. Concept: Types of Data](/docs/user_guide/en/understanding-data.html)\n\nOverview of common types of data used in a site.\n\n## [1.6. Concept: The Drupal Project](/docs/user_guide/en/understanding-project.html)\n\nOverview of Free and Open Source Software (FOSS), Drupal project, and Drupal\nAssociation.\n\n## [1.7. Concept: Drupal Licensing](/docs/user_guide/en/understanding-gpl.html)\n\nOverview of Drupal licensing and the guidelines to be followed by users and\ncontributors.\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: guide.asciidoc\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/understanding-chapter.md", "type": "doc_summary", "topic": "Chapter 1. Understanding Drupal"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme implementation for text filter help.\n *\n * Available variables:\n * - attributes: HTML attributes for the containing element.\n * - children: The rendered child elements of the container.\n *\n * @see \\Drupal\\Core\\Theme\\ThemePreprocess::preprocessContainer()\n *\n * @ingroup themeable\n */\n#}\n{%\n  set classes = [\n    has_parent ? 'js-form-wrapper',\n    has_parent ? 'form-wrapper',\n    'filter-help',\n  ]\n%}\n<div{{ attributes.addClass(classes) }}>{{ children }}</div>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/components/text_format/container--text-format-filter-help.html.twig", "type": "twig_reference"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: TranslationsDataCollector.php\nTarget symbol: class TranslationsDataCollector\nNamespace: Drupal\\webprofiler\\DataCollector\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TranslationsDataCollector.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\StringTranslation\\TranslationInterface\n  - Drupal\\Core\\Url\n  - Drupal\\webprofiler\\StringTranslation\\TranslationManagerWrapper\n  - Symfony\\Component\\HttpFoundation\\Request\n  - Symfony\\Component\\HttpFoundation\\Response\n- Ensure these methods exist where relevant:\n  - __construct()\n  - collect()\n  - getName()\n  - getPanel()\n  - getTranslatedCount()\n  - getUntranslatedCount()\n  - renderTranslated()\n  - renderUntranslated()\n  - reset()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\webprofiler\\StringTranslation\\TranslationManagerWrapper;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\n\n/**\n * Collects translations data.\n */\nclass TranslationsDataCollector extends DataCollector implements HasPanelInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * TranslationsDataCollector constructor.\n   *\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $translation\n   *   The translation service.\n   */\n  public function __construct(\n    private readonly TranslationInterface $translation,\n  ) {\n    $this->data['translations']['translated'] = [];\n    $this->data['translations']['untranslated'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n    if ($this->translation instanceof TranslationManagerWrapper) {\n      $this->data['translations']['translated'] = $this->translation->getTranslated();\n      $this->data['translations']['untranslated'] = $this->translation->getUntranslated();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName() {\n    return 'translations';\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return the number of translated strings.\n   *\n   * @return int\n   *   The number of translated strings.\n   */\n  public function getTranslatedCount(): int {\n    return \\count($this->data['translations']['translated']);\n  }\n\n  /**\n   * Return the number of untranslated strings.\n   *\n   * @return int\n   *   The number of untranslated strings.\n   */\n  public function getUntranslatedCount(): int {\n    return \\count($this->data['translations']['untranslated']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    return [\n      '#theme' => 'webprofiler_dashboard_tabs',\n      '#tabs' => [\n        [\n          'label' => $this->t('Translated'),\n          'content' => $this->renderTranslated($this->data['translations']['translated']),\n        ],\n        [\n          'label' => $this->t('Untranslated'),\n          'content' => $this->renderUntranslated($this->data['translations']['untranslated']),\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Render a list of translated strings.\n   *\n   * @param array $translated\n   *   A list of translated strings.\n   *\n   * @return array\n   *   The render array of the list of translated strings.\n   */\n  private function renderTranslated(array $translated): array {\n    \\array_walk(\n      $translated,\n      static function (&$key, $data): void {\n        $key = [\n          $data,\n          $key,\n          [\n            'data' => [\n              '#type' => 'inline_template',\n              '#template' => '<a href=\"{{ link }}\" target=\"_blank\">{{ \"Edit\"|t }}</a>',\n              '#context' => [\n                'link' => Url::fromRoute('locale.translate_page', ['string' => $data])\n                  ->toString(),\n              ],\n            ],\n          ],\n        ];\n      },\n    );\n\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Original'),\n          $this->t('Translation'),\n          $this->t('Action'),\n        ],\n        '#rows' => $translated,\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n  /**\n   * Render a list of untranslated strings.\n   *\n   * @param array $untranslated\n   *   A list of untranslated strings.\n   *\n   * @return array\n   *   The render array of the list of untranslated strings.\n   */\n  private function renderUntranslated(array $untranslated): array {\n    \\array_walk(\n      $untranslated,\n      static function (&$key, $data): void {\n        $key = [\n          $data,\n          [\n            'data' => [\n              '#type' => 'inline_template',\n              '#template' => '<a href=\"{{ link }}\" target=\"_blank\">{{ \"Translate\"|t }}</a>',\n              '#context' => [\n                'link' => Url::fromRoute('locale.translate_page', ['string' => $data])\n                  ->toString(),\n              ],\n            ],\n          ],\n        ];\n      },\n    );\n\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Original'),\n          $this->t('Action'),\n        ],\n        '#rows' => $untranslated,\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/TranslationsDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TranslationsDataCollector", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class TransactionTokenAccessCheck in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Defines a class for performing access checks based on a transaction token.\n *\n * This class provides a static method for verifying if an incoming request\n * contains a valid token. The check involves verifying the presence\n * of the token, matching it against the expected hashed value,\n * and ensuring it has not expired.\n *\n *\n * Usage of this class ensures secure access control to resources linked\n * to a transaction in systems like Nexi XPay.\n */\nfinal class TransactionTokenAccessCheck {\n\n  /**\n   * Custom access callback for the transaction route.\n   */\n  public static function access(AccountInterface $account, NexiXpayTransactionInterface $nexi_xpay_transaction, Request $request): AccessResult {\n    $token = (string) $request->query->get('t', '');\n    if ($token === '') {\n      return AccessResult::forbidden('Missing token.')->setCacheMaxAge(0);\n    }\n\n    $hash = $nexi_xpay_transaction->getPublicTokenHash();\n    if (!$hash) {\n      return AccessResult::forbidden('Token not configured.')->setCacheMaxAge(0);\n    }\n\n    $expires = $nexi_xpay_transaction->getTokenExpiresTime();\n    if ($expires !== NULL && \\time() > $expires) {\n      return AccessResult::forbidden('Token expired.')->setCacheMaxAge(0);\n    }\n\n    $calc = hash('sha256', $token);\n    if (!hash_equals($hash, $calc)) {\n      return AccessResult::forbidden('Invalid token.')->setCacheMaxAge(0);\n    }\n\n    return AccessResult::allowed()->setCacheMaxAge(0);\n  }\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Access/TransactionTokenAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TransactionTokenAccessCheck", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use layout_builder:\n  title: 'Use MCP Layout Builder tools'\n  description: 'Enable, disable, and configure Layout Builder for content types via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_layout_builder/mcp_tools_layout_builder.permissions.yml", "type": "yaml_reference", "topic": "mcp tools layout builder.permissions"}}
{"instruction": "Show me the implementation of the class SourceController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\security_advisories_nl\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Url;\n\n/**\n * Controller for managing security advisory sources.\n */\nclass SourceController extends ControllerBase {\n\n  /**\n   * List all configured sources.\n   */\n  public function listSources() {\n    $config = $this->config('security_advisories_nl.settings');\n    $sources = $config->get('sources') ?? [];\n\n    $header = [\n      $this->t('Label'),\n      $this->t('ID'),\n      $this->t('Type'),\n      $this->t('URL'),\n      $this->t('Status'),\n      $this->t('Operations'),\n    ];\n\n    $rows = [];\n    foreach ($sources as $source) {\n      $operations = [\n        '#type' => 'operations',\n        '#links' => [\n          'edit' => [\n            'title' => $this->t('Edit'),\n            'url' => Url::fromRoute('security_advisories_nl.source_edit', ['source_id' => $source['id']]),\n          ],\n          'delete' => [\n            'title' => $this->t('Delete'),\n            'url' => Url::fromRoute('security_advisories_nl.source_delete', ['source_id' => $source['id']]),\n          ],\n          'fetch' => [\n            'title' => $this->t('Fetch now'),\n            'url' => Url::fromRoute('security_advisories_nl.source_fetch', ['source_id' => $source['id']]),\n          ],\n        ],\n      ];\n\n      $status = $source['enabled']\n        ? ['data' => ['#markup' => '<span style=\"color: green;\">\u2713 ' . $this->t('Enabled') . '</span>']]\n        : ['data' => ['#markup' => '<span style=\"color: gray;\">\u2717 ' . $this->t('Disabled') . '</span>']];\n\n      $color_badge = '<span style=\"display: inline-block; width: 12px; height: 12px; background: ' . ($source['color'] ?? '#6c757d') . '; border-radius: 2px; margin-right: 5px;\"></span>';\n\n      $rows[] = [\n        ['data' => ['#markup' => $color_badge . htmlspecialchars($source['label'])]],\n        $source['id'],\n        $source['type'],\n        [\n          'data' => [\n            '#markup' => '<a href=\"' . htmlspecialchars($source['url']) . '\" target=\"_blank\" rel=\"noopener\">' .\n              (strlen($source['url']) > 50 ? substr($source['url'], 0, 50) . '...' : $source['url']) .\n              '</a>',\n          ],\n        ],\n        $status,\n        ['data' => $operations],\n      ];\n    }\n\n    $build = [];\n\n    $build['description'] = [\n      '#markup' => '<p>' . $this->t('Manage the sources for security advisories. You can add RSS feeds, WordPress REST API endpoints, or generic JSON APIs.') . '</p>',\n    ];\n\n    $build['add_link'] = [\n      '#type' => 'link',\n      '#title' => $this->t('+ Add new source'),\n      '#url' => Url::fromRoute('security_advisories_nl.source_add'),\n      '#attributes' => [\n        'class' => ['button', 'button--primary'],\n        'style' => 'margin-bottom: 1rem;',\n      ],\n    ];\n\n    $build['table'] = [\n      '#type' => 'table',\n      '#header' => $header,\n      '#rows' => $rows,\n      '#empty' => $this->t('No sources configured. Click \"Add new source\" to get started.'),\n      '#attributes' => ['class' => ['sources-list']],\n    ];\n\n    return $build;\n  }\n\n  /**\n   * Fetch advisories from a single source.\n   */\n  public function fetchSource($source_id) {\n    $config = $this->config('security_advisories_nl.settings');\n    $sources = $config->get('sources') ?? [];\n\n    $source_config = NULL;\n    foreach ($sources as $source) {\n      if ($source['id'] === $source_id) {\n        $source_config = $source;\n        break;\n      }\n    }\n\n    if (!$source_config) {\n      $this->messenger()->addError($this->t('Source not found.'));\n      return $this->redirect('security_advisories_nl.sources');\n    }\n\n    /** @var \\Drupal\\security_advisories_nl\\Service\\AdvisoryFetcherService $fetcher */\n    $fetcher = \\Drupal::service('security_advisories_nl.fetcher');\n\n    try {\n      $result = $fetcher->fetchSource($source_id, $source_config);\n      $this->messenger()->addStatus($this->t('Fetched @count new advisories from %source.', [\n        '@count' => $result['count'],\n        '%source' => $source_config['label'],\n      ]));\n    }\n    catch (\\Exception $e) {\n      $this->messenger()->addError($this->t('Error fetching from %source: @message', [\n        '%source' => $source_config['label'],\n        '@message' => $e->getMessage(),\n      ]));\n    }\n\n    return $this->redirect('security_advisories_nl.sources');\n  }\n\n}\n", "metadata": {"source": "repos/security_advisories_nl/src/Controller/SourceController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SourceController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - node\nid: node.field_auto_import\nfield_name: field_auto_import\nentity_type: node\ntype: boolean\nsettings: {  }\nmodule: core\nlocked: false\ncardinality: 1\ntranslatable: true\nindexes: {  }\npersist_with_no_fields: false\ncustom_storage: false\n", "metadata": {"source": "repos/api_normalization/config/install.disabled/field.storage.node.field_auto_import.yml", "type": "yaml_reference", "topic": "field.storage.node.field auto import"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: InvokeCommand.php\nTarget symbol: class InvokeCommand\nNamespace: Drupal\\Core\\Ajax\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for InvokeCommand.\n- Ensure these methods exist where relevant:\n  - __construct()\n  - render()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * AJAX command for invoking an arbitrary jQuery method.\n *\n * The 'invoke' command will instruct the client to invoke the given jQuery\n * method with the supplied arguments on the elements matched by the given\n * selector. Intended for simple jQuery commands, such as attr(), addClass(),\n * removeClass(), toggleClass(), etc.\n *\n * This command is implemented by Drupal.AjaxCommands.prototype.invoke()\n * defined in misc/ajax.js.\n *\n * @ingroup ajax\n */\nclass InvokeCommand implements CommandInterface {\n\n  /**\n   * A CSS selector string.\n   *\n   * If the command is a response to a request from an #ajax form element then\n   * this value can be NULL.\n   *\n   * @var string\n   */\n  protected $selector;\n\n  /**\n   * A jQuery method to invoke.\n   *\n   * @var string\n   */\n  protected $method;\n\n  /**\n   * An optional list of arguments to pass to the method.\n   *\n   * @var array\n   */\n  protected $arguments;\n\n  /**\n   * Constructs an InvokeCommand object.\n   *\n   * @param string $selector\n   *   A jQuery selector.\n   * @param string $method\n   *   The name of a jQuery method to invoke.\n   * @param array $arguments\n   *   An optional array of arguments to pass to the method.\n   */\n  public function __construct($selector, $method, array $arguments = []) {\n    $this->selector = $selector;\n    $this->method = $method;\n    $this->arguments = $arguments;\n  }\n\n  /**\n   * Implements Drupal\\Core\\Ajax\\CommandInterface:render().\n   */\n  public function render() {\n\n    return [\n      'command' => 'invoke',\n      'selector' => $this->selector,\n      'method' => $this->method,\n      'args' => $this->arguments,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Ajax/InvokeCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InvokeCommand", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ConfigHooks.php\nTarget symbol: class ConfigHooks\nNamespace: Drupal\\drupal_cms_helper\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ConfigHooks.\n- Include required imports:\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n- Ensure these methods exist where relevant:\n  - configSchemaInfoAlter()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * @internal\n *   This is an internal part of Drupal CMS and may be changed or removed at any\n *   time without warning. External code should not interact with this class.\n */\nfinal class ConfigHooks {\n\n  #[Hook('config_schema_info_alter')]\n  public function configSchemaInfoAlter(array &$definitions): void {\n    // @todo Remove when https://www.drupal.org/i/3569887 is released.\n    if (isset($definitions['block.settings.project_browser_block:*'])) {\n      $definitions['block.settings.project_browser_block:*']['mapping']['default_sort']['constraints']['NotBlank']['allowNull'] = TRUE;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/Hook/ConfigHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: in\nSource file: <source_file>\nFile name hint: Plugin.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Component\\Annotation;\n\nuse Drupal\\Component\\Utility\\NestedArray;\n\n/**\n * Defines a Plugin annotation object.\n *\n * Annotations in plugin classes can use this class in order to pass various\n * metadata about the plugin through the parser to\n * DiscoveryInterface::getDefinitions() calls. This allows the metadata\n * of a class to be located with the class itself, rather than in module-based\n * info hooks.\n *\n * @ingroup plugin_api\n *\n * @Annotation\n */\nclass Plugin implements AnnotationInterface {\n\n  /**\n   * The plugin definition read from the class annotation.\n   *\n   * @var array\n   */\n  protected $definition;\n\n  /**\n   * Constructs a Plugin object.\n   *\n   * Builds up the plugin definition and invokes the get() method for any\n   * classed annotations that were used.\n   */\n  public function __construct($values) {\n    $reflection = new \\ReflectionClass($this);\n    // Only keep actual default values by ignoring NULL values.\n    $defaults = array_filter($reflection->getDefaultProperties(), function ($value) {\n      return $value !== NULL;\n    });\n    $parsed_values = $this->parse($values);\n    $this->definition = NestedArray::mergeDeepArray([$defaults, $parsed_values], TRUE);\n  }\n\n  /**\n   * Parses an annotation into its definition.\n   *\n   * @param array $values\n   *   The annotation array.\n   *\n   * @return array\n   *   The parsed annotation as a definition.\n   */\n  protected function parse(array $values) {\n    $definitions = [];\n    foreach ($values as $key => $value) {\n      if ($value instanceof AnnotationInterface) {\n        $definitions[$key] = $value->get();\n      }\n      elseif (is_array($value)) {\n        $definitions[$key] = $this->parse($value);\n      }\n      else {\n        $definitions[$key] = $value;\n      }\n    }\n    return $definitions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get() {\n    return $this->definition;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getProvider() {\n    return $this->definition['provider'] ?? FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setProvider($provider) {\n    $this->definition['provider'] = $provider;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getId() {\n    return $this->definition['id'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClass() {\n    return $this->definition['class'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setClass($class) {\n    $this->definition['class'] = $class;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Component\\Annotation;\n\nuse Drupal\\Component\\Utility\\NestedArray;\n\n/**\n * Defines a Plugin annotation object.\n *\n * Annotations in plugin classes can use this class in order to pass various\n * metadata about the plugin through the parser to\n * DiscoveryInterface::getDefinitions() calls. This allows the metadata\n * of a class to be located with the class itself, rather than in module-based\n * info hooks.\n *\n * @ingroup plugin_api\n *\n * @Annotation\n */\nclass Plugin implements AnnotationInterface {\n\n  /**\n   * The plugin definition read from the class annotation.\n   *\n   * @var array\n   */\n  protected $definition;\n\n  /**\n   * Constructs a Plugin object.\n   *\n   * Builds up the plugin definition and invokes the get() method for any\n   * classed annotations that were used.\n   */\n  public function __construct($values) {\n    $reflection = new \\ReflectionClass($this);\n    // Only keep actual default values by ignoring NULL values.\n    $defaults = array_filter($reflection->getDefaultProperties(), function ($value) {\n      return $value !== NULL;\n    });\n    $parsed_values = $this->parse($values);\n    $this->definition = NestedArray::mergeDeepArray([$defaults, $parsed_values], TRUE);\n  }\n\n  /**\n   * Parses an annotation into its definition.\n   *\n   * @param array $values\n   *   The annotation array.\n   *\n   * @return array\n   *   The parsed annotation as a definition.\n   */\n  protected function parse(array $values) {\n    $definitions = [];\n    foreach ($values as $key => $value) {\n      if ($value instanceof AnnotationInterface) {\n        $definitions[$key] = $value->get();\n      }\n      elseif (is_array($value)) {\n        $definitions[$key] = $this->parse($value);\n      }\n      else {\n        $definitions[$key] = $value;\n      }\n    }\n    return $definitions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get() {\n    return $this->definition;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getProvider() {\n    return $this->definition['provider'] ?? FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setProvider($provider) {\n    $this->definition['provider'] = $provider;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getId() {\n    return $this->definition['id'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClass() {\n    return $this->definition['class'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setClass($class) {\n    $this->definition['class'] = $class;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Annotation/Plugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Plugin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class StoreToEntity in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\Action;\n\nuse Drupal\\Core\\Action\\Attribute\\Action;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\eca\\Attribute\\EcaAction;\nuse Drupal\\eca\\Plugin\\Action\\ConfigurableActionBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Stores normalized API data to a Drupal entity.\n */\n#[Action(\n  id: 'api_normalization_store_to_entity',\n  label: new TranslatableMarkup('Store to Entity'),\n  type: 'system',\n)]\n#[EcaAction(\n  description: new TranslatableMarkup('Store normalized API data to a Drupal entity with field mapping.'),\n  version_introduced: '1.0.0',\n)]\n/**\n * Entity class for StoreToEntity.\n *\n * @ingroup api_normalization\n */\nclass StoreToEntity extends ConfigurableActionBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function externallyAvailable(): bool {\n    return TRUE;\n  }\n\n  /**\n   * The entity type manager.\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->entityTypeManager = $container->get('entity_type.manager');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(): void {\n    $data = $this->getTokenValue('normalized_data', []);\n    $entity_type = $this->configuration['entity_type'];\n    $bundle = $this->configuration['bundle'];\n    $field_mapping = $this->configuration['field_mapping'] ?? [];\n\n    $storage = $this->entityTypeManager->getStorage($entity_type);\n    $values = ['type' => $bundle];\n\n    foreach ($field_mapping as $api_field => $entity_field) {\n      if (isset($data[$api_field])) {\n        $values[$entity_field] = $data[$api_field];\n      }\n    }\n\n    $entity = $storage->create($values);\n    $entity->save();\n\n    $this->tokenService->addTokenData('created_entity', $entity);\n    $this->tokenService->addTokenData('entity_id', $entity->id());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return [\n      'entity_type' => 'node',\n      'bundle' => '',\n      'field_mapping' => [],\n    ] + parent::defaultConfiguration();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $form['entity_type'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Entity Type'),\n      '#options' => $this->getEntityTypeOptions(),\n      '#default_value' => $this->configuration['entity_type'],\n      '#required' => TRUE,\n    ];\n\n    $form['bundle'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Bundle'),\n      '#default_value' => $this->configuration['bundle'],\n      '#required' => TRUE,\n    ];\n\n    $form['field_mapping'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Field Mapping (JSON)'),\n      '#default_value' => json_encode($this->configuration['field_mapping'], JSON_PRETTY_PRINT),\n      '#description' => $this->t('JSON object mapping API fields to entity fields. Example: {\"api_title\": \"title\", \"api_body\": \"body\"}'),\n    ];\n\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state): void {\n    $this->configuration['entity_type'] = $form_state->getValue('entity_type');\n    $this->configuration['bundle'] = $form_state->getValue('bundle');\n    $mapping_json = $form_state->getValue('field_mapping');\n    $decoded = json_decode($mapping_json, TRUE);\n    $this->configuration['field_mapping'] = (json_last_error() === JSON_ERROR_NONE) ? $decoded : [];\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * Gets entity type options.\n   */\n  protected function getEntityTypeOptions(): array {\n    $options = [];\n    foreach ($this->entityTypeManager->getDefinitions() as $id => $definition) {\n      if ($definition->hasKey('bundle')) {\n        $options[$id] = $definition->getLabel();\n      }\n    }\n    return $options;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/Action/StoreToEntity.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StoreToEntity", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LayoutBuilderFormAlter in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\block_description_modifier\\Service;\n\nuse Drupal\\block_content\\BlockContentInterface;\nuse Drupal\\block_description_modifier\\Repository\\InlineBlockConfigRepository;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Layout Builder form alter: hide and force labels for configured inline blocks.\n *\n * For selected inline block bundles we:\n * - hide \"Block description (info)\" in inline block entity subform\n * - hide block placement admin label and user-facing title\n * - force \"Display title\" off\n * - ensure the computed label is stored before core submit.\n */\nfinal class LayoutBuilderFormAlter {\n\n  public function __construct(\n    private readonly InlineBlockConfigRepository $repository,\n    private readonly InlineBlockLabelApplier $labelApplier,\n  ) {}\n\n  public function alter(array &$form, FormStateInterface $form_state): void {\n    $bundle = $this->resolveInlineBlockBundle($form, $form_state);\n    if ($bundle === NULL) {\n      return;\n    }\n\n    $bundleConfig = $this->repository->getInline($bundle);\n    if (!$bundleConfig || empty($bundleConfig['hide_label'])) {\n      return;\n    }\n\n    $placeholder = $this->labelApplier->placeholderLabelForBundle($bundle);\n    if ($placeholder === '') {\n      $placeholder = InlineBlockLabelApplier::FALLBACK_CORRUPTED_FIELD;\n    }\n\n    // A) Hide \"Block description\" / administrative label of the block placement\n    // (Layout Builder stores this in settings[admin_label]).\n    if (isset($form['settings']['admin_label']) && is_array($form['settings']['admin_label'])) {\n      $this->forceHiddenTextElement($form['settings']['admin_label'], $form_state, [\n        'settings',\n        'admin_label',\n      ], $placeholder);\n    }\n\n    // B) Hide inline block entity admin label (block_content.info) inside block_form.\n    // Different variants can place it differently.\n    $this->forceHiddenByPath($form, $form_state, ['settings', 'block_form', 'info'], $placeholder);\n    $this->forceHiddenByPath($form, $form_state, ['block_form', 'info'], $placeholder);\n\n    // C) Hide the user-visible title (\"Title (shown to the user)\") and force it to placeholder.\n    foreach (['label', 'title'] as $key) {\n      if (isset($form['settings'][$key]) && is_array($form['settings'][$key])) {\n        $this->forceHiddenTextElement($form['settings'][$key], $form_state, [\n          'settings',\n          $key,\n        ], $placeholder);\n      }\n    }\n\n    // D) Hide \"Display title\" toggle and force it off.\n    foreach (['label_display', 'display_title', 'title_display'] as $key) {\n      if (isset($form['settings'][$key]) && is_array($form['settings'][$key])) {\n        $form['settings'][$key]['#type'] = 'hidden';\n        $form['settings'][$key]['#value'] = 0;\n        $form['settings'][$key]['#default_value'] = 0;\n        // Hide from UI. It is safe here because we also set the value.\n        $form['settings'][$key]['#access'] = FALSE;\n        $form_state->setValue(['settings', $key], 0);\n      }\n    }\n\n    // Ensure LB stores the computed label (especially for provider=field) BEFORE core submit.\n    $form['#validate'] ??= [];\n    $form['#validate'][] = 'block_description_modifier_layout_builder_inline_block_validate';\n  }\n\n  /**\n   * Determines the inline block bundle for both \"add\" and \"update/edit\" forms.\n   */\n  private function resolveInlineBlockBundle(array &$form, FormStateInterface $form_state): ?string {\n    // 1) Prefer embedded inline block entity/block stored by Layout Builder.\n    $block = $form['settings']['block_form']['#block'] ?? NULL;\n    if ($block && method_exists($block, 'bundle')) {\n      return (string) $block->bundle();\n    }\n\n    // 2) Embedded entity on some variants.\n    $entity = $form['settings']['block_form']['#entity'] ?? NULL;\n    if ($entity instanceof BlockContentInterface) {\n      return $entity->bundle();\n    }\n\n    // 3) Add form usually has route parameter plugin_id = inline_block:{bundle}.\n    $routeMatch = \\Drupal::routeMatch();\n    $pluginId = (string) ($routeMatch->getParameter('plugin_id') ?? '');\n    if ($pluginId !== '' && str_starts_with($pluginId, 'inline_block:')) {\n      $bundle = substr($pluginId, strlen('inline_block:'));\n      return $bundle !== '' ? $bundle : NULL;\n    }\n\n    // 4) Sometimes stored in form state.\n    $pluginId = (string) ($form_state->get('plugin_id') ?? '');\n    if ($pluginId !== '' && str_starts_with($pluginId, 'inline_block:')) {\n      $bundle = substr($pluginId, strlen('inline_block:'));\n      return $bundle !== '' ? $bundle : NULL;\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Forces a nested element to hidden and sets submitted value.\n   *\n   * @param list<string> $path\n   */\n  private function forceHiddenByPath(array &$form, FormStateInterface $form_state, array $path, string $value): void {\n    $cursor = &$form;\n    foreach ($path as $segment) {\n      if (!is_array($cursor) || !array_key_exists($segment, $cursor)) {\n        return;\n      }\n      $cursor = &$cursor[$segment];\n    }\n    if (!is_array($cursor)) {\n      return;\n    }\n\n    $this->forceHiddenTextElement($cursor, $form_state, $path, $value);\n  }\n\n  /**\n   * Forces a text element to hidden while preserving a valid submitted value.\n   *\n   * @param array<string, mixed> $element\n   * @param list<string> $path\n   */\n  private function forceHiddenTextElement(array &$element, FormStateInterface $form_state, array $path, string $value): void {\n    $element['#required'] = FALSE;\n    $element['#attributes']['required'] = FALSE;\n    $element['#type'] = 'hidden';\n    $element['#value'] = $value;\n    $element['#default_value'] = $value;\n    unset($element['#title'], $element['#description']);\n    $form_state->setValue($path, $value);\n  }\n\n}\n", "metadata": {"source": "repos/block_description_modifier/src/Service/LayoutBuilderFormAlter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderFormAlter", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Views Filter Role Access'\ntype: module\ndescription: 'Allows site builders to restrict specific Views filters to certain user roles.'\npackage: Views\ncore_version_requirement: ^9.4 || ^10 || ^11\ndependencies:\n  - drupal:views\n  - drupal:user\n", "metadata": {"source": "repos/views_filter_role_access/views_filter_role_access.info.yml", "type": "yaml_reference", "topic": "views filter role access.info"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Laposta Subscribe\ntype: module\ndescription: 'Provides a block with a subscribe form for Laposta.'\ncore_version_requirement: ^10 || ^11\npackage: 'Web services'\nconfigure: laposta_subscribe.api_key_settings\ndependencies:\n  - drupal:block\nversion: '1.1.0'\nauthor: 'Fred Klopper <fred@miix.dev>'\n", "metadata": {"source": "repos/laposta_subscribe/laposta_subscribe.info.yml", "type": "yaml_reference", "topic": "laposta subscribe.info"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: TreePanel\nSource file: <source_file>\nFile name hint: TreePanel.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\InstanceInterface;\nuse Drupal\\display_builder\\IslandType;\nuse Drupal\\display_builder\\SlotSourceProxy;\nuse Drupal\\display_builder\\SourceWithSlotsInterface;\nuse Drupal\\ui_patterns\\SourceWithChoicesInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Layers island plugin implementation.\n */\n#[Island(\n  id: 'tree',\n  label: new TranslatableMarkup('Tree'),\n  description: new TranslatableMarkup('Hierarchical view of components and blocks.'),\n  type: IslandType::View,\n  default_region: 'main',\n  icon: 'bar-chart-steps',\n)]\nclass TreePanel extends BuilderPanel {\n\n  /**\n   * Proxy for slot source operations.\n   */\n  protected SlotSourceProxy $slotSourceProxy;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->slotSourceProxy = $container->get('display_builder.slot_sources_proxy');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function keyboardShortcuts(): array {\n    return [\n      'key' => 't',\n      'help' => t('Show the tree'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(InstanceInterface $builder, array $data = [], array $options = []): array {\n    $builder_id = (string) $builder->id();\n\n    $build = [\n      '#type' => 'component',\n      '#component' => 'display_builder:panel_tree',\n      '#slots' => [\n        'items' => $this->digFromSlot($builder_id, $data),\n      ],\n      '#attributes' => [\n        // Required for JavaScript @see components/dropzone/dropzone.js.\n        'data-db-id' => $builder_id,\n        'data-node-title' => $this->t('Base container'),\n        'data-db-root' => TRUE,\n        // 'class' => ['db-dropzone--root', 'db-dropzone'],\n      ],\n    ];\n\n    return $build;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildSingleComponent(string $builder_id, string $instance_id, SourceWithSlotsInterface $source, array $data, int $index = 0): ?array {\n    $component_id = NULL;\n    $label = $source->label();\n\n    if ($source instanceof SourceWithChoicesInterface) {\n      $component_id = $source->getChoice($data['source']);\n      $label = $this->slotSourceProxy->getLabelWithSummary($data, [])['label'];\n    }\n    $instance_id = $instance_id ?: $data['node_id'];\n\n    if (!$instance_id || !$component_id) {\n      return NULL;\n    }\n\n    $slots = [];\n\n    foreach ($source->getSlotDefinitions() as $slot_id => $definition) {\n      $items = [\n        '#type' => 'component',\n        '#component' => 'display_builder:tree_item',\n        '#props' => [\n          'icon' => 'box-arrow-in-right',\n        ],\n        '#slots' => [\n          'title' => $definition['title'],\n        ],\n        // Slot is needed for contextual menu paste.\n        // @see assets/js/contextual_menu.js\n        '#attributes' => [\n          'data-slot-id' => $slot_id,\n          'data-slot-title' => $definition['title'],\n          'data-node-id' => $instance_id,\n          'data-node-title' => $label,\n          'data-menu-type' => 'slot',\n        ],\n      ];\n\n      if ($sources = $source->getSlotValue($slot_id)) {\n        $items['#slots']['children'] = $this->digFromSlot($builder_id, $sources);\n      }", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\InstanceInterface;\nuse Drupal\\display_builder\\IslandType;\nuse Drupal\\display_builder\\SlotSourceProxy;\nuse Drupal\\display_builder\\SourceWithSlotsInterface;\nuse Drupal\\ui_patterns\\SourceWithChoicesInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Layers island plugin implementation.\n */\n#[Island(\n  id: 'tree',\n  label: new TranslatableMarkup('Tree'),\n  description: new TranslatableMarkup('Hierarchical view of components and blocks.'),\n  type: IslandType::View,\n  default_region: 'main',\n  icon: 'bar-chart-steps',\n)]\nclass TreePanel extends BuilderPanel {\n\n  /**\n   * Proxy for slot source operations.\n   */\n  protected SlotSourceProxy $slotSourceProxy;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->slotSourceProxy = $container->get('display_builder.slot_sources_proxy');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function keyboardShortcuts(): array {\n    return [\n      'key' => 't',\n      'help' => t('Show the tree'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(InstanceInterface $builder, array $data = [], array $options = []): array {\n    $builder_id = (string) $builder->id();\n\n    $build = [\n      '#type' => 'component',\n      '#component' => 'display_builder:panel_tree',\n      '#slots' => [\n        'items' => $this->digFromSlot($builder_id, $data),\n      ],\n      '#attributes' => [\n        // Required for JavaScript @see components/dropzone/dropzone.js.\n        'data-db-id' => $builder_id,\n        'data-node-title' => $this->t('Base container'),\n        'data-db-root' => TRUE,\n        // 'class' => ['db-dropzone--root', 'db-dropzone'],\n      ],\n    ];\n\n    return $build;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildSingleComponent(string $builder_id, string $instance_id, SourceWithSlotsInterface $source, array $data, int $index = 0): ?array {\n    $component_id = NULL;\n    $label = $source->label();\n\n    if ($source instanceof SourceWithChoicesInterface) {\n      $component_id = $source->getChoice($data['source']);\n      $label = $this->slotSourceProxy->getLabelWithSummary($data, [])['label'];\n    }\n    $instance_id = $instance_id ?: $data['node_id'];\n\n    if (!$instance_id || !$component_id) {\n      return NULL;\n    }\n\n    $slots = [];\n\n    foreach ($source->getSlotDefinitions() as $slot_id => $definition) {\n      $items = [\n        '#type' => 'component',\n        '#component' => 'display_builder:tree_item',\n        '#props' => [\n          'icon' => 'box-arrow-in-right',\n        ],\n        '#slots' => [\n          'title' => $definition['title'],\n        ],\n        // Slot is needed for contextual menu paste.\n        // @see assets/js/contextual_menu.js\n        '#attributes' => [\n          'data-slot-id' => $slot_id,\n          'data-slot-title' => $definition['title'],\n          'data-node-id' => $instance_id,\n          'data-node-title' => $label,\n          'data-menu-type' => 'slot',\n        ],\n      ];\n\n      if ($sources = $source->getSlotValue($slot_id)) {\n        $items['#slots']['children'] = $this->digFromSlot($builder_id, $sources);\n      }\n\n      $slots[] = $items;\n    }\n\n    // I f a single item, expand by default.\n    if (\\count($slots) === 1) {\n      $slots[0]['#props']['expanded'] = TRUE;\n    }\n\n    return [\n      '#type' => 'component',\n      '#component' => 'display_builder:tree_item',\n      '#props' => [\n        'expanded' => TRUE,\n        'icon' => 'box',\n      ],\n      '#slots' => [\n        'title' => $label,\n        'children' => $slots,\n      ],\n      // Required for the context menu label.\n      // @see assets/js/contextual_menu.js\n      '#attributes' => [\n        'data-node-id' => $instance_id,\n        'data-node-title' => $label,\n        'data-slot-position' => $index,\n        'data-menu-type' => 'component',\n        // 'class' => ['db-dropzone', 'db-tree__component'],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildSingleBlock(string $builder_id, string $instance_id, array $data, int $index = 0): array {\n    $instance_id = $instance_id ?: $data['node_id'];\n    $label = $this->slotSourceProxy->getLabelWithSummary($data, $this->configuration['contexts'] ?? []);\n\n    if (isset($data['source_id']) && $data['source_id'] === 'entity_field') {\n      $label['summary'] = (string) $this->t('Field: @label', ['@label' => $label['label']]);\n    }\n\n    return [\n      '#type' => 'component',\n      '#component' => 'display_builder:tree_item',\n      '#props' => [\n        'icon' => 'view-list',\n      ],\n      '#slots' => [\n        'title' => $label['summary'],\n      ],\n      '#attributes' => [\n        'data-node-id' => $instance_id,\n        // This label is used for contextual menu.\n        // @see assets/js/contextual_menu.js\n        'data-node-title' => $label['summary'],\n        'data-slot-position' => $index,\n        'data-menu-type' => 'block',\n        // 'class' => ['db-dropzone', 'db-tree__block'],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Plugin/display_builder/Island/TreePanel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TreePanel", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set attributes = attributes.addClass('menu__item') %}\n{% set attributes = (variant and variant != 'default') ? attributes.setAttribute('variant', variant) : attributes %}\n{% set attributes = disabled ? attributes.setAttribute('disabled', true) : attributes %}\n{% set attributes = attributes.setAttribute('type', 'checkbox') %}\n{% set attributes = value ? attributes.setAttribute('value', value) : attributes %}\n\n{% if variant == 'divider' %}\n  <sl-divider></sl-divider>\n{% else %}\n  <sl-menu-item{{ attributes }}>\n    {{ title }}\n    {% if icon %}\n      <sl-icon slot=\"{{ icon_position|default('prefix') }}\" name=\"{{ icon }}\"></sl-icon>\n    {% endif %}\n    {% if submenu %}\n    <sl-menu slot=\"submenu\">\n      {{ submenu }}\n    </sl-menu>\n    {% endif %}\n  </sl-menu-item>\n{% endif %}\n", "metadata": {"source": "repos/display_builder/components/shoelace/menu_item/menu_item.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_client.mcp_server.*:\n  type: config_entity\n  label: MCP Server\n  mapping:\n    id:\n      type: string\n      label: ID\n    label:\n      type: label\n      label: Label\n    uuid:\n      type: string\n      label: UUID\n    description:\n      type: string\n      label: Description\n    endpoint:\n      type: string\n      label: Endpoint\n    transport_type:\n      type: string\n      label: Transport Type\n    stdio_command:\n      type: string\n      label: STDIO Command\n    stdio_env:\n      type: sequence\n      label: STDIO Environment Variables\n      sequence:\n        type: mapping\n        label: Environment Variable\n        mapping:\n          type:\n            type: string\n            label: Type\n          value:\n            type: string\n            label: Value\n          key_id:\n            type: string\n            label: Key ID\n    stdio_cwd:\n      type: string\n      label: STDIO Working Directory\n    timeout:\n      type: integer\n      label: Timeout\n    http_headers:\n      type: mapping\n      label: HTTP Headers\n      mapping:\n        Authorization_key:\n          type: string\n          label: Authorization Key ID\n        Authorization_prefix:\n          type: string\n          label: Authorization Prefix\n    tools:\n      type: sequence\n      label: Tools\n      sequence:\n        type: mapping\n        label: Tool\n        mapping:\n          name:\n            type: string\n            label: Name\n          description:\n            type: string\n            label: Description\n          # Following MCP protocol standard (camelCase).\n          inputSchema:\n            type: ignore\n            label: Input Schema\n          enabled:\n            type: boolean\n            label: Enabled\n          locked:\n            type: boolean\n            label: Locked\n          operation:\n            type: string\n            label: Operation\n            constraints:\n              Choice:\n                choices:\n                  - explain\n                  - read\n                  - transform\n                  - trigger\n                  - write\n          lockedDefinition:\n            type: mapping\n            label: Locked Definition\n            nullable: true\n            mapping:\n              name:\n                type: string\n                label: Name\n              description:\n                type: string\n                label: Description\n              # Following MCP protocol standard (camelCase).\n              inputSchema:\n                type: ignore\n                label: Input Schema\n", "metadata": {"source": "repos/mcp_client/config/schema/mcp_client.schema.yml", "type": "yaml_reference", "topic": "mcp client.schema"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: EditorDialogSave\nSource file: <source_file>\nFile name hint: EditorDialogSave.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\editor\\Ajax;\n\nuse Drupal\\Core\\Ajax\\CommandInterface;\n\n/**\n * Provides an AJAX command for saving the contents of an editor dialog.\n *\n * This command is implemented in editor.dialog.js in\n * Drupal.AjaxCommands.prototype.editorDialogSave.\n */\nclass EditorDialogSave implements CommandInterface {\n\n  /**\n   * An array of values that will be passed back to the editor by the dialog.\n   *\n   * @var array\n   */\n  protected array $values;\n\n  /**\n   * Constructs an EditorDialogSave object.\n   *\n   * @param array $values\n   *   The values that should be passed to the form constructor in Drupal.\n   */\n  function __construct(array $values) {\n    $this->values = $values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    return [\n      'command' => 'editorDialogSave',\n      'values' => $this->values,\n    ];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\editor\\Ajax;\n\nuse Drupal\\Core\\Ajax\\CommandInterface;\n\n/**\n * Provides an AJAX command for saving the contents of an editor dialog.\n *\n * This command is implemented in editor.dialog.js in\n * Drupal.AjaxCommands.prototype.editorDialogSave.\n */\nclass EditorDialogSave implements CommandInterface {\n\n  /**\n   * An array of values that will be passed back to the editor by the dialog.\n   *\n   * @var array\n   */\n  protected array $values;\n\n  /**\n   * Constructs an EditorDialogSave object.\n   *\n   * @param array $values\n   *   The values that should be passed to the form constructor in Drupal.\n   */\n  public function __construct(array $values) {\n    $this->values = $values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    return [\n      'command' => 'editorDialogSave',\n      'values' => $this->values,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/editor/src/Ajax/EditorDialogSave.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EditorDialogSave", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the interface MenuParentFormSelectorInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Menu;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\n\n/**\n * Defines an interface for menu selector form elements and menu link options.\n */\ninterface MenuParentFormSelectorInterface {\n\n  /**\n   * Gets the options for a select element to choose a menu and parent.\n   *\n   * @param string $id\n   *   Optional ID of a link plugin. This will exclude the link and its\n   *   children from the select options.\n   * @param array $menus\n   *   Optional array of menu names as keys and titles as values to limit\n   *   the select options.  If NULL, all menus will be included.\n   * @param \\Drupal\\Core\\Cache\\CacheableMetadata|null &$cacheability\n   *   Optional cacheability metadata object, which will be populated based on\n   *   the accessibility of the links and the cacheability of the links.\n   *\n   * @return array\n   *   Keyed array where the keys are contain a menu name and parent ID and\n   *   the values are a menu name or link title indented by depth.\n   */\n  public function getParentSelectOptions($id = '', ?array $menus = NULL, ?CacheableMetadata &$cacheability = NULL);\n\n  /**\n   * Gets a form element to choose a menu and parent.\n   *\n   * The specific type of form element will vary depending on the\n   * implementation, but callers will normally need to set the #title for the\n   * element.\n   *\n   * @param string $menu_parent\n   *   A menu name and parent ID concatenated with a ':' character to use as the\n   *   default value.\n   * @param string $id\n   *   (optional) ID of a link plugin. This will exclude the link and its\n   *   children from being selected.\n   * @param array $menus\n   *   (optional) Array of menu names as keys and titles as values to limit\n   *   the values that may be selected. If NULL, all menus will be included.\n   *\n   * @return array\n   *   A form element to choose a parent, or an empty array if no possible\n   *   parents exist for the given parameters. The resulting form value will be\n   *   a single string containing the chosen menu name and parent ID separated\n   *   by a ':' character.\n   */\n  public function parentSelectElement($menu_parent, $id = '', ?array $menus = NULL);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Menu/MenuParentFormSelectorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MenuParentFormSelectorInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: 6.4. Concept: Reference Fields", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Prerequisite knowledge](/docs/user_guide/en/structure-reference-fields.html#s-prerequisite-knowledge)\n* [What is a reference field?](/docs/user_guide/en/structure-reference-fields.html#s-what-is-a-reference-field)\n* [Related topics](/docs/user_guide/en/structure-reference-fields.html#s-related-topics)\n\n## [Chapter 6. Setting Up Content Structure](/docs/user_guide/en/content-structure-chapter.html)\n\n* [6.1. Adding a Content Type](/docs/user_guide/en/structure-content-type.html)\n* [6.2. Deleting a Content Type](/docs/user_guide/en/structure-content-type-delete.html)\n* [6.3. Adding Basic Fields to a Content Type](/docs/user_guide/en/structure-fields.html)\n* [6.4. Concept: Reference Fields](/docs/user_guide/en/structure-reference-fields.html)\n* [6.5. Concept: Taxonomy](/docs/user_guide/en/structure-taxonomy.html)\n* [6.6. Setting Up a Taxonomy](/docs/user_guide/en/structure-taxonomy-setup.html)\n* [6.7. Adding a Reference Field](/docs/user_guide/en/structure-adding-reference.html)\n* [6.8. Concept: Forms and Widgets](/docs/user_guide/en/structure-widgets.html)\n* [6.9. Changing Content Entry Forms](/docs/user_guide/en/structure-form-editing.html)\n* [6.10. Concept: View Modes and Formatters](/docs/user_guide/en/structure-view-modes.html)\n* [6.11. Changing Content Display](/docs/user_guide/en/structure-content-display.html)\n* [6.12. Concept: Image Styles](/docs/user_guide/en/structure-image-styles.html)\n* [6.13. Setting Up an Image Style](/docs/user_guide/en/structure-image-style-create.html)\n* [6.14. Concept: Responsive Image Styles](/docs/user_guide/en/structure-image-responsive.html)\n* [6.15. Concept: Text Formats and Editors](/docs/user_guide/en/structure-text-formats.html)\n* [6.16. Configuring Text Formats and Editors](/docs/user_guide/en/structure-text-format-config.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/structure-reference-fields.html \"6.4. Concept: Reference Fields\")\n* [Magyar](/hu/docs/user_guide/hu/structure-reference-fields.html \"6.4. Alapfogalom: hivatkoz\u00e1smez\u0151k\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/structure-reference-fields.html \"6.4. Concept: Reference Fields\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/structure-reference-fields.html \"6.4. \u041e\u0441\u043d\u043e\u0432\u0438: \u041f\u043e\u043b\u0435 \u043f\u043e\u0441\u0438\u043b\u0430\u043d\u043d\u044f \u043d\u0430 \u0441\u0443\u0442\u043d\u0456\u0441\u0442\u044c\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/structure-reference-fields.html \"6.4. Concept: Reference Fields\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/structure-reference-fields.html \"6.4. Concept : champs de type r\u00e9f\u00e9rence\")\n* [Deutsch](/de/docs/user_guide/de/structure-reference-fields.html \"6.4. Konzept: Referenzfelder\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/structure-reference-fields.html \"6.4. \u0645\u0641\u0647\u0648\u0645: \u0641\u06cc\u0644\u062f\u0647\u0627\u06cc \u0645\u0631\u062c\u0639\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/structure-reference-fields.html \"6.4. Concept: Reference Fields\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/structure-reference-fields.html \"6.4. Concept: Reference Fields\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/structure-reference-fields.html \"6.4. Concept: Reference Fields\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/structure-reference-fields.html \"6.4. \u041a\u043e\u043d\u0446\u0435\u043f\u0446\u0438\u044f: \u041f\u043e\u043b\u0435 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044c\")\n\n# 6.4. Concept: Reference Fields\n\nLast [updated](/node/2827323/discuss) on\n\n14 April 2025\n\n### Prerequisite knowledge\n\n[Section\u00a02.3, \u201cConcept: Content Entities and Fields\u201d](/docs/user_guide/en/planning-data-types.html \" Content Entities and Fields\")\n\n### What is a reference field?\n\nA *reference field* is a field that represents a relationship between an entity\nand one or more other entities, which may belong to the same or different entity\ntype. The three most commonly-used reference fields are:\n\nContent reference\n:   A reference to a content item. For example, you might want to connect recipes\n    to the vendors who submitted them. You would set up a content reference field\n    called Submitted by referencing Vendor content items on the Recipe content\n    type.\n\nTaxonomy term reference\n:   A reference to a taxonomy term. For example, you might want to connect recipes\n    to their ingredients. You would set up a taxonomy term reference field called\n    Ingredients on the Recipe content type. This reference field will point to the\n    vocabulary Ingredients.\n\nUser reference\n:   A reference to a user account. For example, you might want to connect recipes\n    with their chefs. You would set up a user reference field called Chefs on the\n    Recipe content type.\n\n### Related topics\n\n[Section\u00a06.5, \u201cConcept: Taxonomy\u201d](/docs/user_guide/en/structure-taxonomy.html \" Taxonomy\")\n\n**Attributions**\n\nWritten and edited by [Surendra Mohan](https://www.drupal.org/u/surendramohan),\nand [Jojy Alphonso](https://www.drupal.org/u/jojyja) at\n[Red Crackle](http://redcrackle.com).\n\nNext [\u2192 6.5. Concept: Taxonomy](/docs/user_guide/en/structure-taxonomy.html)\n\nPrevious [\u2190 6.3. Adding Basic Fields to a Content Type](/docs/user_guide/en/structure-fields.html)\n\n##\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: structure-reference-fields.asciidoc\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2827323/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282827323%29%206.4.%20Concept%3A%20Reference%20Fields) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/structure-reference-fields.md", "type": "doc_summary", "topic": "6.4. Concept: Reference Fields"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<div class=\"text-wrapper text-align-{{ text_align|default('left') }} {{ disable_animation is defined and disable_animation == false ? 'animated' : '' }}\" {{ sdc_component_attributes(component_name) }}>\n\n\t{% if editable %}\n\t\t<div data-sdc-field=\"disable_animation\" data-sdc-sidebar=\"true\" data-sdc-type=\"checkbox-toggle\" data-sdc-prop-checkbox-toggle=\"{{ disable_animation is defined ? (disable_animation ? 'true' : 'false') : 'true' }}\" style=\"display: none;\"></div>\n\n\t\t<div data-sdc-field=\"text_align\" data-sdc-sidebar=\"true\" data-sdc-type=\"select-dropdown\" data-sdc-options='[\n\t\t\t\t\t\t\t\t\t            {\"value\": \"left\", \"label\": \"Left\"},\n\t\t\t\t\t\t\t\t\t            {\"value\": \"center\", \"label\": \"Center\"},\n\t\t\t\t\t\t\t\t\t            {\"value\": \"right\", \"label\": \"Right\"}\n\t\t\t\t\t\t\t\t\t          ]' data-sdc-prop-select-dropdown=\"{{ text_align|default('left') }}\" style=\"display: none;\"></div>\n\t{% endif %}\n\n\t<div {{ sdc_field_attributes('text', editable|default(false), {'data-sdc-type': 'text-editor'} ) }}>\n\t\t{{text|raw}}\n\t</div>\n</div>\n", "metadata": {"source": "repos/sdc_inline_editor/components/text-block/text-block.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "token_browser.tree:\n  path: '/token-browser/tree'\n  defaults:\n    _controller: '\\Drupal\\token_browser\\Controller\\TokenBrowserController::outputTree'\n  requirements:\n    _csrf_token: 'TRUE'\n\ntoken_browser.htmx:\n  path: '/token-browser/htmx/{token_type}/{parent}/{token}'\n  defaults:\n    _controller: '\\Drupal\\token_browser\\Controller\\TokenBrowserController::outputHtmxRows'\n  requirements:\n    _permission: 'access content'\n  options:\n    _htmx_route: true\n    parameters:\n      token_type:\n        type: string\n      parent:\n        type: string\n      token:\n        type: string\n", "metadata": {"source": "repos/token_browser/token_browser.routing.yml", "type": "yaml_reference", "topic": "token browser.routing"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DateFilterHandler.php\nTarget symbol: class DateFilterHandler\nNamespace: Drupal\\views_pretty_paths\\FilterHandlers\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DateFilterHandler.\n- Ensure these methods exist where relevant:\n  - getTargetedFilterPluginIds()\n  - transformPathValueForViewsQuery()\n  - transformSubmittedValueForUrl()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views_pretty_paths\\FilterHandlers;\n\n/**\n * Defines DateFilterHandler class.\n */\nclass DateFilterHandler extends AbstractFilterHandler implements ViewsPrettyPathFilterHandlerInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetedFilterPluginIds() {\n    return [\n      'date',\n      'datetime',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformPathValueForViewsQuery($filter_value_string, $filter_data) {\n    $return_values = [];\n    if (!empty($filter_value_string)) {\n      $raw_values = explode('+', $filter_value_string);\n      $return_values['min'] = str_replace('-', '/', strtolower($raw_values[0]));\n      $return_values['max'] = str_replace('-', '/', strtolower($raw_values[1]));\n    }\n    return $return_values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformSubmittedValueForUrl($value) {\n    $min = str_replace('/', '-', strtolower($value['min']));\n    $max = str_replace('/', '-', strtolower($value['max']));\n    return empty($min . $max) ? '' : $min . '+' . $max;\n  }\n\n}\n", "metadata": {"source": "repos/views_pretty_paths/src/FilterHandlers/DateFilterHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateFilterHandler", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Offcanvas\ndescription: \"Build hidden sidebars into your project for navigation, shopping carts, and more with a few classes and our JavaScript plugin.\"\ngroup: Dialog\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/components/offcanvas/\"\nvariants:\n  start:\n    title: Start\n  end:\n    title: End\n  top:\n    title: Top\n  bottom:\n    title: Bottom\nslots:\n  title:\n    title: Title\n    description: \"Offcanvas title.\"\n  body:\n    title: Body\n    description: \"The content of the offcanvas.\"\nprops:\n  type: object\n  properties:\n    responsive:\n      title: Responsive\n      description: \"Hide content in offcanvas below the selected breakpoint. Above that breakpoint, the contents within will behave as usual.\"\n      type: string\n      enum:\n        - offcanvas-sm\n        - offcanvas-md\n        - offcanvas-lg\n        - offcanvas-xl\n        - offcanvas-xxl\n      \"meta:enum\":\n        offcanvas-sm: \"Hide below small\"\n        offcanvas-md: \"Hide below medium\"\n        offcanvas-lg: \"Hide below large\"\n        offcanvas-xl: \"Hide below extra large\"\n        offcanvas-xxl: \"Hide below extra extra large\"\n    backdrop:\n      title: Backdrop\n      description: \"When backdrop is set to static, the offcanvas will not close when clicking outside of it.\"\n      type: string\n      enum:\n        - \"false\"\n        - static\n      \"meta:enum\":\n        \"false\": \"No backdrop\"\n        static: Static\n    scroll:\n      title: \"Body scrolling\"\n      description: \"By default, body scrolling is disabled.\"\n      type: boolean\n    header_attributes:\n      title: \"Header attributes\"\n      description: \"The attributes to customize the offcanvas header if present.\"\n      type: string\n    heading_level:\n      title: \"Heading level\"\n      description: \"Heading level of the offcanvas.\"\n      type: integer\n      enum:\n        - 1\n        - 2\n        - 3\n        - 4\n        - 5\n        - 6\n      \"meta:enum\":\n        1: h1\n        2: h2\n        3: h3\n        4: h4\n        5: \"h5 (Default)\"\n        6: h6\n    heading_attributes:\n      title: \"Heading attributes\"\n      description: \"The attributes to customize the offcanvas title if present.\"\n      type: string\n    body_attributes:\n      title: \"Body attributes\"\n      description: \"The attributes to customize the offcanvas body if present.\"\n      type: string\n    offcanvas_id:\n      title: ID\n      description: \"ID used by external buttons to toggle the visibility. Must start with a letter. Randomly generated if empty.\"\n      type: string\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/offcanvas/offcanvas.component.yml", "type": "yaml_reference", "topic": "offcanvas.component"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: FindBySource\nSource file: <source_file>\nFile name hint: FindBySource.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_redirect\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_redirect\\Service\\RedirectService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_redirect_find',\n  label: new TranslatableMarkup('Find Redirect by Source'),\n  description: new TranslatableMarkup('Find a redirect by its source path.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'source' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Path'),\n      description: new TranslatableMarkup('The source path to search for (e.g., \"old-page\" or \"/old-page\").'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'found' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Redirect Found'),\n      description: new TranslatableMarkup(''),\n    ),\n    'redirect' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Redirect Details'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass FindBySource extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'redirect';\n\n\n  protected RedirectService $redirectService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->redirectService = $container->get('mcp_tools_redirect.redirect');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $source = $input['source'] ?? '';\n\n    if (empty($source)) {\n      return ['success' => FALSE, 'error' => 'Source path is required.'];\n    }\n\n    return $this->redirectService->findBySource($source);\n  }\n\n\n\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_redirect\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_redirect\\Service\\RedirectService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_redirect_find',\n  label: new TranslatableMarkup('Find Redirect by Source'),\n  description: new TranslatableMarkup('Find a redirect by its source path.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'source' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Path'),\n      description: new TranslatableMarkup('The source path to search for (e.g., \"old-page\" or \"/old-page\").'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'found' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Redirect Found'),\n      description: new TranslatableMarkup(''),\n    ),\n    'redirect' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Redirect Details'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass FindBySource extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'redirect';\n\n\n  protected RedirectService $redirectService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->redirectService = $container->get('mcp_tools_redirect.redirect');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $source = $input['source'] ?? '';\n\n    if (empty($source)) {\n      return ['success' => FALSE, 'error' => 'Source path is required.'];\n    }\n\n    return $this->redirectService->findBySource($source);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_redirect/src/Plugin/tool/Tool/FindBySource.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FindBySource", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - eck.eck_entity_type.api_request\n  module:\n    - eck\nid: api_request.default\nlabel: 'Default'\nentity_type: api_request\n", "metadata": {"source": "repos/api_normalization/config/optional.disabled/eck.eck_entity_bundle.api_request.default.yml", "type": "yaml_reference", "topic": "eck.eck entity bundle.api request.default"}}
{"instruction": "Show me the implementation of the trait SoapEventEmitterTrait in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client_webform\\Element;\n\nuse Drupal\\soap_client\\Event\\SoapResponseResetEvent;\nuse Drupal\\soap_client\\Event\\SoapResponseSearchEvent;\nuse Drupal\\soap_client\\Event\\SoapResponseSelectEvent;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;\n\n/**\n * Trait for elements that emit SOAP response events.\n *\n * Provides default implementations of SoapResponseEmitterInterface methods.\n * Classes using this trait must provide:\n * - protected EventDispatcherInterface $eventDispatcher\n * - Implementation of fieldName() and operationId()\n */\ntrait SoapEventEmitterTrait\n{\n  /**\n   * Emits search event when search is initiated.\n   *\n   * @param array $context\n   *   Event context.\n   */\n  public function emitSearchEvent(array $context): void\n  {\n    $event = new SoapResponseSearchEvent(\n      $this->fieldName(),\n      $this->operationId(),\n      $context['field_values'] ?? [],\n      $context,\n    );\n\n    $this->eventDispatcher()->dispatch($event);\n  }\n\n  /**\n   * Emits select event when value is selected.\n   *\n   * @param array $context\n   *   Event context (must include 'value').\n   */\n  public function emitSelectEvent(array $context): void\n  {\n    $event = new SoapResponseSelectEvent(\n      $this->fieldName(),\n      $this->operationId(),\n      $context['field_values'] ?? ['value' => $context['value'] ?? NULL],\n      $context,\n    );\n\n    $this->eventDispatcher()->dispatch($event);\n  }\n\n  /**\n   * Emits reset event when selection is cleared.\n   *\n   * @param array $context\n   *   Event context.\n   */\n  public function emitResetEvent(array $context): void\n  {\n    $event = new SoapResponseResetEvent(\n      $this->fieldName(),\n      $this->operationId(),\n      [],\n      $context,\n    );\n\n    $this->eventDispatcher()->dispatch($event);\n  }\n\n  /**\n   * Returns the event dispatcher service.\n   *\n   * @return \\Symfony\\Component\\EventDispatcher\\EventDispatcherInterface\n   *   The event dispatcher.\n   */\n  protected function eventDispatcher(): EventDispatcherInterface\n  {\n    if (!isset($this->eventDispatcher)) {\n      $this->eventDispatcher = \\Drupal::service('event_dispatcher');\n    }\n    return $this->eventDispatcher;\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/modules/soap_client_webform/src/Element/SoapEventEmitterTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "SoapEventEmitterTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EcaEntityImport in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eca_entity_import\\Plugin\\migrate\\process;\n\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\nuse Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException;\nuse Drupal\\Core\\Entity\\EntityFormInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\eca_migrate\\Plugin\\migrate\\process\\Eca;\nuse Drupal\\entity_import\\Plugin\\migrate\\process\\EntityImportProcessInterface;\nuse Drupal\\entity_import\\Plugin\\migrate\\process\\EntityImportProcessTrait;\n\n/**\n * Define eca entity import.\n *\n * @MigrateProcessPlugin(\n *   id = \"eca_entity_import\",\n *   label = @Translation(\"ECA\")\n * )\n */\nclass EcaEntityImport extends Eca implements EntityImportProcessInterface {\n\n  use EntityImportProcessTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $form['#markup'] = $this->t('The \"@label\" process plugin has no configurations. The entity importer ID is \"<b>@id</b>\". It can be used within the ECA model, e.g. to run a model only on a certain entity import. The entity import ID is available within the ECA model in the token <b>row:source:importer_id</b>.', [\n      '@label' => $this->getLabel(),\n      '@id' => $this->getImporterId($form_state),\n    ]);\n\n    return $form;\n  }\n\n  /**\n   * Returns the importer id.\n   *\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   *\n   * @return string\n   *   The importer id.\n   */\n  protected function getImporterId(FormStateInterface $form_state): string {\n    $formObject = $form_state->getFormObject();\n\n    if ($formObject instanceof EntityFormInterface) {\n      /** @var \\Drupal\\entity_import\\Entity\\EntityImporterFieldMappingInterface $entity */\n      $entity = $formObject->getEntity();\n      try {\n        $id = $entity->getImporterEntity()?->id();\n        if ($id) {\n          return $id;\n        }\n      }\n      catch (InvalidPluginDefinitionException | PluginNotFoundException $e) {\n        $this->messenger()->addError($e->getMessage());\n      }\n    }\n\n    return '';\n  }\n\n}\n", "metadata": {"source": "repos/eca_entity_import/src/Plugin/migrate/process/EcaEntityImport.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EcaEntityImport", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BusinessIdentityTwigExtension.php\nTarget symbol: class BusinessIdentityTwigExtension\nNamespace: Drupal\\business_identity\\Twig\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BusinessIdentityTwigExtension.\n- Include required imports:\n  - Drupal\\business_identity\\BusinessIdentityManagerInterface\n  - Twig\\Extension\\AbstractExtension\n  - Twig\\TwigFunction\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getBusinessAddress()\n  - getBusinessContact()\n  - getBusinessInfo()\n  - getBusinessName()\n  - getFunctions()\n  - getName()\n  - getSocialLinks()\n  - isBusinessOpen()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\business_identity\\Twig;\n\nuse Drupal\\business_identity\\BusinessIdentityManagerInterface;\nuse Twig\\Extension\\AbstractExtension;\nuse Twig\\TwigFunction;\n\n/**\n * Twig extension for business identity.\n */\nclass BusinessIdentityTwigExtension extends AbstractExtension {\n\n  /**\n   * The business identity manager.\n   *\n   * @var \\Drupal\\business_identity\\BusinessIdentityManagerInterface\n   */\n  protected $businessIdentityManager;\n\n  /**\n   * Constructor.\n   */\n  public function __construct(BusinessIdentityManagerInterface $business_identity_manager) {\n    $this->businessIdentityManager = $business_identity_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFunctions(): array {\n    return [\n      new TwigFunction('business_info', [$this, 'getBusinessInfo']),\n      new TwigFunction('business_name', [$this, 'getBusinessName']),\n      new TwigFunction('business_contact', [$this, 'getBusinessContact']),\n      new TwigFunction('business_address', [$this, 'getBusinessAddress']),\n      new TwigFunction('business_social_links', [$this, 'getSocialLinks']),\n      new TwigFunction('business_is_open', [$this, 'isBusinessOpen']),\n    ];\n  }\n\n  /**\n   * Gets business information.\n   */\n  public function getBusinessInfo(): array {\n    return $this->businessIdentityManager->getBusinessInfo()->toArray();\n  }\n\n  /**\n   * Gets business name.\n   */\n  public function getBusinessName(): string {\n    return $this->businessIdentityManager->getBusinessName();\n  }\n\n  /**\n   * Gets business contact information.\n   */\n  public function getBusinessContact(): array {\n    return $this->businessIdentityManager->getPrimaryContact();\n  }\n\n  /**\n   * Gets formatted business address.\n   */\n  public function getBusinessAddress(string $type = 'headquarters', string $format = 'html'): string {\n    return $this->businessIdentityManager->getFormattedAddress($type, $format);\n  }\n\n  /**\n   * Gets social links.\n   */\n  public function getSocialLinks(): array {\n    return $this->businessIdentityManager->getSocialLinks();\n  }\n\n  /**\n   * Checks if business is open.\n   */\n  public function isBusinessOpen(): bool {\n    return $this->businessIdentityManager->isOpen();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'business_identity.twig_extension';\n  }\n\n}\n", "metadata": {"source": "repos/business_identity/src/Twig/BusinessIdentityTwigExtension.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BusinessIdentityTwigExtension", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: TimeZoneCacheContext.php\nTarget symbol: class TimeZoneCacheContext\nNamespace: Drupal\\Core\\Cache\\Context\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for TimeZoneCacheContext.\n- Include required imports:\n  - Drupal\\Core\\Cache\\CacheableMetadata\n- Ensure these methods exist where relevant:\n  - getCacheableMetadata()\n  - getContext()\n  - getLabel()", "output": "<?php\n\nnamespace Drupal\\Core\\Cache\\Context;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\n\n/**\n * Defines the TimeZoneCacheContext service, for \"per time zone\" caching.\n *\n * Cache context ID: 'timezone'.\n *\n * @see \\Drupal\\Core\\Session\\AccountProxy::setAccount()\n */\nclass TimeZoneCacheContext implements CacheContextInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getLabel() {\n    return t(\"Time zone\");\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getContext() {\n    // date_default_timezone_set() is called in AccountProxy::setAccount(), so\n    // we can safely retrieve the timezone.\n    return date_default_timezone_get();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheableMetadata() {\n    return new CacheableMetadata();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/Context/TimeZoneCacheContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TimeZoneCacheContext", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class GovcmsCa3ConsumerHelper in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update, and uninstall functions for GovCMS CA3 Consumer Helper.\n */\n\ndeclare(strict_types=1);\n\nuse Drupal\\Core\\Extension\\Requirement\\RequirementSeverity;\nuse Drupal\\Core\\Hook\\Attribute\\LegacyRequirementsHook;\nuse Drupal\\govcms_ca3_consumer_helper\\Constants\\Ca3MediaFields;\n\n/**\n * Implements hook_requirements().\n *\n * Checks that required fields exist on the CA3 media bundle.\n *\n * Note: This hook must remain procedural and cannot use OOP attributes.\n * Install hooks (including hook_requirements) are required to be procedural\n * for compatibility with installation and update phases.\n */\n#[LegacyRequirementsHook]\nfunction govcms_ca3_consumer_helper_requirements(string $phase): array {\n  $requirements = [];\n\n  // Only check at runtime, not during installation.\n  if ($phase !== 'runtime') {\n    return $requirements;\n  }\n\n  // Check if service container is available.\n  if (!\\Drupal::hasContainer()) {\n    return $requirements;\n  }\n\n  // Check if the CA3 media bundle exists.\n  $entity_type_manager = \\Drupal::entityTypeManager();\n  $media_type = $entity_type_manager\n    ->getStorage('media_type')\n    ->load(Ca3MediaFields::BUNDLE);\n\n  if (!$media_type) {\n    $requirements['govcms_ca3_consumer_helper_bundle'] = [\n      'title' => t('CA3 media bundle'),\n      'value' => t('Missing'),\n      'description' => t('The CA3 media bundle (@bundle) does not exist. Please ensure the recipe has been applied correctly.', [\n        '@bundle' => Ca3MediaFields::BUNDLE,\n      ]),\n      'severity' => RequirementSeverity::Warning,\n    ];\n    return $requirements;\n  }\n\n  // Get field definitions for the CA3 bundle.\n  $entity_field_manager = \\Drupal::service('entity_field.manager');\n  $field_definitions = $entity_field_manager\n    ->getFieldDefinitions('media', Ca3MediaFields::BUNDLE);\n\n  // List of required fields and their descriptions.\n  $required_fields = [\n    Ca3MediaFields::SOURCE_FIELD => t('oEmbed URL field'),\n    Ca3MediaFields::ORIGINAL_HTML => t('Original HTML field'),\n    Ca3MediaFields::HTML => t('HTML field'),\n    Ca3MediaFields::LATEST_HTML => t('Latest HTML field'),\n    Ca3MediaFields::LAST_CHECKED => t('Last checked timestamp field'),\n    Ca3MediaFields::UPDATES_EXIST => t('Updates exist boolean field'),\n  ];\n\n  $missing_fields = [];\n  foreach ($required_fields as $field_name => $field_description) {\n    if (!isset($field_definitions[$field_name])) {\n      $missing_fields[$field_name] = $field_description;\n    }\n  }\n\n  if (!empty($missing_fields)) {\n    $field_list = [];\n    foreach ($missing_fields as $field_name => $field_description) {\n      $field_list[] = t('@description (@field)', [\n        '@description' => $field_description,\n        '@field' => $field_name,\n      ]);\n    }\n\n    $requirements['govcms_ca3_consumer_helper_fields'] = [\n      'title' => t('CA3 media bundle fields'),\n      'value' => t('Missing fields'),\n      'description' => t('The following required fields are missing from the CA3 media bundle: @fields. Please ensure the recipe has been applied correctly. These fields are required for CA3 subscription functionality.', [\n        '@fields' => \\implode(', ', $field_list),\n      ]),\n      'severity' => RequirementSeverity::Warning,\n    ];\n  }\n\n  return $requirements;\n}\n", "metadata": {"source": "repos/govcms_ca3_consumer_helper/govcms_ca3_consumer_helper.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GovcmsCa3ConsumerHelper", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Percentage.php\nTarget symbol: class Percentage\nNamespace: Drupal\\Core\\Batch\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Percentage.\n- Ensure these methods exist where relevant:\n  - format()", "output": "<?php\n\nnamespace Drupal\\Core\\Batch;\n\n/**\n * Helper methods for the batch system.\n */\nclass Percentage {\n\n  /**\n   * Formats the percent completion for a batch set.\n   *\n   * @param int $total\n   *   The total number of operations.\n   * @param int $current\n   *   The number of the current operation. This may be a floating point number\n   *   rather than an integer in the case of a multi-step operation that is not\n   *   yet complete; in that case, the fractional part of $current represents\n   *   the fraction of the operation that has been completed.\n   *\n   * @return string\n   *   The properly formatted percentage, as a string. We output percentages\n   *   using the correct number of decimal places so that we never print \"100%\"\n   *   until we are finished, but we also never print more decimal places than\n   *   are meaningful.\n   *\n   * @see _batch_process()\n   */\n  public static function format($total, $current) {\n    if (!$total || $total == $current) {\n      // If $total doesn't evaluate as true or is equal to the current set, then\n      // we're finished, and we can return \"100\".\n      $percentage = '100';\n    }\n    else {\n      // We add a new digit at 200, 2000, etc. (since, for example, 199/200\n      // would round up to 100% if we didn't).\n      $decimal_places = max(0, floor(log10($total / 2.0)) - 1);\n      do {\n        // Calculate the percentage to the specified number of decimal places.\n        $percentage = sprintf('%01.' . $decimal_places . 'f', round($current / $total * 100, $decimal_places));\n        // When $current is an integer, the above calculation will always be\n        // correct. However, if $current is a floating point number (in the case\n        // of a multi-step batch operation that is not yet complete),\n        // $percentage may be erroneously rounded up to 100%. To prevent that,\n        // we add one more decimal place and try again.\n        $decimal_places++;\n      } while ($percentage == '100');\n    }\n    return $percentage;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Batch/Percentage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Percentage", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface MapperInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin\\Mapper;\n\n/**\n * Plugin mapper interface.\n *\n * Plugin mappers are responsible for mapping a plugin request to its\n * implementation. For example, it might map a cache bin to a memcache bin.\n *\n * Mapper objects incorporate the best practices of retrieving configurations,\n * type information, and factory instantiation.\n */\ninterface MapperInterface {\n\n  /**\n   * Gets or creates a plugin instance that satisfies the given options.\n   *\n   * @param array $options\n   *   An array of options that can be used to determine a suitable plugin to\n   *   instantiate and how to configure it.\n   *\n   * @return object|false\n   *   A fully configured plugin instance. The interface of the plugin instance\n   *   will depend on the plugin type. If no instance can be retrieved, FALSE\n   *   will be returned.\n   */\n  public function getInstance(array $options);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/Mapper/MapperInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MapperInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RequestFormatCacheContext in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Cache\\Context;\n\nuse Drupal\\Core\\Cache\\CacheableMetadata;\n\n/**\n * Defines the RequestFormatCacheContext service, for \"per format\" caching.\n *\n * Cache context ID: 'request_format'.\n */\nclass RequestFormatCacheContext extends RequestStackCacheContextBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getLabel() {\n    return t('Request format');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getContext() {\n    return $this->requestStack->getCurrentRequest()->getRequestFormat();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheableMetadata() {\n    return new CacheableMetadata();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Cache/Context/RequestFormatCacheContext.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RequestFormatCacheContext", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LayoutBuilderRestrictionsByRegion in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Module file for Layout Builder Restrictions by Region.\n */\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\layout_builder_restrictions_by_region\\Form\\FormAlter;\nuse Drupal\\layout_builder_restrictions_by_region\\Form\\RestrictionPluginConfigAlter;\n\n/**\n * Implements hook_form_FORM_ID_alter() for the entity view display edit form.\n */\nfunction layout_builder_restrictions_by_region_form_entity_view_display_edit_form_alter(&$form, FormStateInterface &$form_state, $form_id) {\n  $entity_view_mode_restriction_active = TRUE;\n  if ($config = \\Drupal::config('layout_builder_restrictions.plugins')->get('plugin_config')) {\n    // Provide the per view mode restriction UI *unless* the plugin is disabled.\n    if (isset($config['entity_view_mode_restriction_by_region']) && $config['entity_view_mode_restriction_by_region']['enabled'] == FALSE) {\n      $entity_view_mode_restriction_active = FALSE;\n    }\n  }\n  if ($entity_view_mode_restriction_active) {\n    \\Drupal::classResolver(FormAlter::class)->alterEntityViewDisplayForm($form, $form_state, $form_id);\n  }\n}\n\n/**\n * Implements hook_form_FORM_ID_alter() for the general config form.\n */\nfunction layout_builder_restrictions_by_region_form_restriction_plugin_config_form_alter(&$form, FormStateInterface $form_state, $form_id) {\n  // Alter the general config form to include the by-region configuration.\n  \\Drupal::classResolver(RestrictionPluginConfigAlter::class)->alterForm($form, $form_state, $form_id);\n}\n", "metadata": {"source": "repos/layout_builder_restrictions/modules/layout_builder_restrictions_by_region/layout_builder_restrictions_by_region.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderRestrictionsByRegion", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% if variant and variant != 'default' %}\n  {% set variants = variant|split('__')|map(v => v|replace({(v): 'navbar-' ~ v})|replace({'_': '-'})) %}\n  {% set attributes = attributes.addClass(variants) %}\n{% endif %}\n\n{% set attributes = attributes.addClass('navbar') %}\n{% set attributes = 'dark' in variant ? attributes.setAttribute('data-bs-theme', 'dark') : attributes %}\n\n{% set navbar_id = navbar_id|default(\"navbar-\" ~ random()) %}\n{% set placement = placement|default('default') %}\n{% set toggler_position = toggler_position|default('start') %}\n{% set toggle_action = toggle_action|default('collapse') %}\n{% set offcanvas_position = offcanvas_position|default('end') %}\n{% set attributes = (placement != 'default') ? attributes.addClass(placement) : attributes %}\n\n{% set toggler %}\n  <button class=\"navbar-toggler\"\n          type=\"button\"\n          data-bs-toggle=\"{{ toggle_action }}\"\n          data-bs-target=\"#{{ navbar_id }}\"\n          aria-controls=\"{{ navbar_id }}\"\n          aria-expanded=\"false\"\n          aria-label=\"{{ 'Toggle navigation'|t }}\">\n    <span class=\"navbar-toggler-icon\"></span>\n  </button>\n{% endset %}\n\n<nav{{ attributes }}>\n  <div class=\"container-fluid\">\n    {% if toggler_position == 'start' %}\n      {{ toggler }}\n    {% endif %}\n    {{ brand|add_class('navbar-brand') }}\n    {{ navigation }}\n    {% if toggler_position == 'end' %}\n      {{ toggler }}\n    {% endif %}\n\n    {% if navigation_collapsible %}\n      {% if toggle_action == 'offcanvas' %}\n        {{ include('bootstrap_components:offcanvas', {\n          'title': offcanvas_label|default('Navigation'|t),\n          'body': navigation_collapsible,\n          'variant': offcanvas_position,\n          'offcanvas_id': navbar_id,\n        }, with_context = false) }}\n      {% else %}\n        <div class=\"collapse navbar-collapse\" id=\"{{ navbar_id }}\">\n          {{ navigation_collapsible }}\n        </div>\n      {% endif %}\n    {% endif %}\n  </div>\n</nav>\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/navbar.twig", "type": "twig_reference"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: image.post_update\nSource file: <source_file>\nFile name hint: image.post_update.php\nBroken snippet:\n<?php\n\n/**\n * @file\n * Post-update functions for Image.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction image_removed_post_updates(): array {\n  return [\n    'image_post_update_image_style_dependencies' => '9.0.0',\n    'image_post_update_scale_and_crop_effect_add_anchor' => '9.0.0',\n    'image_post_update_image_loading_attribute' => '10.0.0',\n  ];\n}\n// BUG: ensure this implementation follows Drupal 11 and PHP 8.3.", "output": "<?php\n\n/**\n * @file\n * Post-update functions for Image.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction image_removed_post_updates(): array {\n  return [\n    'image_post_update_image_style_dependencies' => '9.0.0',\n    'image_post_update_scale_and_crop_effect_add_anchor' => '9.0.0',\n    'image_post_update_image_loading_attribute' => '10.0.0',\n  ];\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/image.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImagePostUpdate", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Score\nSource file: <source_file>\nFile name hint: Score.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\search\\Plugin\\views\\sort;\n\nuse Drupal\\views\\Attribute\\ViewsSort;\nuse Drupal\\views\\Plugin\\views\\sort\\SortPluginBase;\n\n/**\n * Sort handler for sorting by search score.\n *\n * @ingroup views_sort_handlers\n */\n#[ViewsSort(\"search_score\")]\nclass Score extends SortPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Check to see if the search filter/argument added 'score' to the table.\n    // Our filter stores it as $handler->search_score -- and we also\n    // need to check its relationship to make sure that we're using the same\n    // one or obviously this won't work.\n    foreach (['filter', 'argument'] as $type) {\n      foreach ($this->view->{$type} as $handler) {\n        if (isset($handler->search_score) && $handler->relationship == $this->relationship) {\n          $this->query->addOrderBy(NULL, NULL, $this->options['order'], $handler->search_score);\n          $this->tableAlias = $handler->tableAlias;\n          return;\n        }\n      }\n    }\n\n    // Do nothing if there is no filter/argument in place. There is no way\n    // to sort on scores.\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\search\\Plugin\\views\\sort;\n\nuse Drupal\\views\\Attribute\\ViewsSort;\nuse Drupal\\views\\Plugin\\views\\sort\\SortPluginBase;\n\n/**\n * Sort handler for sorting by search score.\n *\n * @ingroup views_sort_handlers\n */\n#[ViewsSort(\"search_score\")]\nclass Score extends SortPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Check to see if the search filter/argument added 'score' to the table.\n    // Our filter stores it as $handler->search_score -- and we also\n    // need to check its relationship to make sure that we're using the same\n    // one or obviously this won't work.\n    foreach (['filter', 'argument'] as $type) {\n      foreach ($this->view->{$type} as $handler) {\n        if (isset($handler->search_score) && $handler->relationship == $this->relationship) {\n          $this->query->addOrderBy(NULL, NULL, $this->options['order'], $handler->search_score);\n          $this->tableAlias = $handler->tableAlias;\n          return;\n        }\n      }\n    }\n\n    // Do nothing if there is no filter/argument in place. There is no way\n    // to sort on scores.\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/src/Plugin/views/sort/Score.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Score", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Cappuccino Starter Kit", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Distribution documentation](/docs/getting-started/drupal-distributions/distribution-documentation)\n\n* [Aegir hosting system](/docs/getting-started/drupal-distributions/distribution-documentation/aegir-hosting-system)\n* [Campaignion](/docs/getting-started/drupal-distributions/distribution-documentation/campaignion)\n* [Cartaro](/docs/getting-started/drupal-distributions/distribution-documentation/cartaro)\n* [Commerce Kickstart](/docs/getting-started/drupal-distributions/distribution-documentation/commerce-kickstart)\n* [Commerce clone product variation documentation](/docs/getting-started/drupal-distributions/distribution-documentation/commerce-clone-product-variation-documentation)\n* [Community Media](/docs/getting-started/drupal-distributions/distribution-documentation/community-media)\n* [Demo Framework](/docs/getting-started/drupal-distributions/distribution-documentation/demo-framework)\n* [DruStack](/docs/getting-started/drupal-distributions/distribution-documentation/drustack)\n* [Drupal 8 DrupalCamp Organizing Distribution](/docs/getting-started/drupal-distributions/distribution-documentation/drupal-8-drupalcamp-organizing-distribution)\n* [Drupal Ecological Information Management System (DEIMS)](/docs/getting-started/drupal-distributions/distribution-documentation/drupal-ecological-information-management-system-deims)\n* [Drupal voor Gemeenten](/docs/getting-started/drupal-distributions/distribution-documentation/drupal-voor-gemeenten)\n* [ERPAL](/docs/getting-started/drupal-distributions/distribution-documentation/erpal)\n* [Events](/docs/getting-started/drupal-distributions/distribution-documentation/events)\n* [Faktura - Manage customer accounts and write invoices](/docs/getting-started/drupal-distributions/distribution-documentation/faktura-manage-customer-accounts-and-write-invoices)\n* [Fuse Media](/docs/getting-started/drupal-distributions/distribution-documentation/fuse-media)\n* [Julio, a Distribution for Schools, School Districts, and University Departments](/docs/getting-started/drupal-distributions/distribution-documentation/julio-a-distribution-for-schools-school-districts-and-university-departments)\n* [Lightning (7.x)](/docs/getting-started/drupal-distributions/distribution-documentation/lightning-7x)\n* [Managing News](/docs/getting-started/drupal-distributions/distribution-documentation/managing-news)\n* [NodeStream Drupal platform distribution](/docs/getting-started/drupal-distributions/distribution-documentation/nodestream-drupal-platform-distribution)\n* [Open Aid Map](/docs/getting-started/drupal-distributions/distribution-documentation/open-aid-map)\n* [Open Atrium](/docs/getting-started/drupal-distributions/distribution-documentation/open-atrium)\n* [Open Outreach](/docs/getting-started/drupal-distributions/distribution-documentation/open-outreach)\n* [Open Parish](/docs/getting-started/drupal-distributions/distribution-documentation/open-parish)\n* [Open Restaurant](/docs/getting-started/drupal-distributions/distribution-documentation/open-restaurant)\n* [OpenAid](/docs/getting-started/drupal-distributions/distribution-documentation/openaid)\n* [Panopoly](/docs/getting-started/drupal-distributions/distribution-documentation/panopoly)\n* [Project Kickstart](/docs/getting-started/drupal-distributions/distribution-documentation/project-kickstart)\n* [Pushtape Music Distribution Documentation Handbook](/docs/getting-started/drupal-distributions/distribution-documentation/pushtape-music-distribution-documentation-handbook)\n* [Slovak Drupal Installation Profile](/docs/getting-started/drupal-distributions/distribution-documentation/slovak-drupal-installation-profile)\n* [Spark](/docs/getting-started/drupal-distributions/distribution-documentation/spark)\n* [Spectacle](/docs/getting-started/drupal-distributions/distribution-documentation/spectacle)\n* [Totem](/docs/getting-started/drupal-distributions/distribution-documentation/totem)\n* [Training](/docs/getting-started/drupal-distributions/distribution-documentation/training)\n* [Transcribr Distribution](/docs/getting-started/drupal-distributions/distribution-documentation/transcribr-distribution)\n* [Varbase](/docs/getting-started/drupal-distributions/distribution-documentation/varbase)\n* [govCMS](/docs/getting-started/drupal-distributions/distribution-documentation/govcms)\n\n# Cappuccino Starter Kit\n\nThis guide has not yet been reviewed by [Distribution documentation](/docs/getting-started/drupal-distributions/distribution-documentation) maintainer(s) and added to the menu.\n\n## About Cappuccino\n\nCappuccino is a distribution for turning your website into a dynamic hub - intuitive interfaces for lively content and elegant design. It provides web editors with the best tools to deliver a high level of content and engage their audience.\n\nThis distribution is a starting point that can be used as a basis for further development.\n\n## [Installation](/docs/drupal-distributions/cappuccino-starter-kit/installation)\n\nThis page provides information on how to install the distribution.\n\n## [Basic Usage](/docs/drupal-distributions/cappuccino-starter-kit/basic-usage)\n\nThis page provides information about the basic usage of the distribution.\n\n## [Theming](/docs/drupal-distributions/cappuccino-starter-kit/theming)\n\nThis page provides information about theming.\n\n## [Development informations](/docs/drupal-distributions/cappuccino-starter-kit/development-informations)\n\nAdditional information about the development process\n\n## Related Content\n\n## [Cappuccino Starter Kit](/project/cappuccino)\n\nCappuccino is a Drupal 11 Starter Kit for turning your website into a dynamic hub - intuitive interfaces for lively content and elegant d\n\n## Guide maintainers\n\n[![nagy.balint's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/default-avatar.png?itok=ZYxnS__Q)](/user/1763952 \"View nagy.balint's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/drupal-distributions/distribution-documentation/cappuccino-starter-kit.md", "type": "doc_summary", "topic": "Cappuccino Starter Kit"}}
{"instruction": "Show me the implementation of the class Percentage in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Batch;\n\n/**\n * Helper methods for the batch system.\n */\nclass Percentage {\n\n  /**\n   * Formats the percent completion for a batch set.\n   *\n   * @param int $total\n   *   The total number of operations.\n   * @param int $current\n   *   The number of the current operation. This may be a floating point number\n   *   rather than an integer in the case of a multi-step operation that is not\n   *   yet complete; in that case, the fractional part of $current represents\n   *   the fraction of the operation that has been completed.\n   *\n   * @return string\n   *   The properly formatted percentage, as a string. We output percentages\n   *   using the correct number of decimal places so that we never print \"100%\"\n   *   until we are finished, but we also never print more decimal places than\n   *   are meaningful.\n   *\n   * @see _batch_process()\n   */\n  public static function format($total, $current) {\n    if (!$total || $total == $current) {\n      // If $total doesn't evaluate as true or is equal to the current set, then\n      // we're finished, and we can return \"100\".\n      $percentage = '100';\n    }\n    else {\n      // We add a new digit at 200, 2000, etc. (since, for example, 199/200\n      // would round up to 100% if we didn't).\n      $decimal_places = max(0, floor(log10($total / 2.0)) - 1);\n      do {\n        // Calculate the percentage to the specified number of decimal places.\n        $percentage = sprintf('%01.' . $decimal_places . 'f', round($current / $total * 100, $decimal_places));\n        // When $current is an integer, the above calculation will always be\n        // correct. However, if $current is a floating point number (in the case\n        // of a multi-step batch operation that is not yet complete),\n        // $percentage may be erroneously rounded up to 100%. To prevent that,\n        // we add one more decimal place and try again.\n        $decimal_places++;\n      } while ($percentage == '100');\n    }\n    return $percentage;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Batch/Percentage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Percentage", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: JobSkippingTrait.php\nTarget symbol: trait marks\nNamespace: Drupal\\flowdrop_runtime\\Service\\Orchestrator\\Trait\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete trait implementation for marks.\n- Include required imports:\n  - Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface\n  - Drupal\\flowdrop_runtime\\Service\\Storage\\JobStorageInterface\n  - Psr\\Log\\LoggerInterface\n- Ensure these methods exist where relevant:\n  - getJobSkippingLogger()\n  - getJobSkippingStorage()\n  - markRemainingJobsAsSkipped()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Orchestrator\\Trait;\n\nuse Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface;\nuse Drupal\\flowdrop_runtime\\Service\\Storage\\JobStorageInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Provides common job skipping logic for orchestrators.\n *\n * This trait marks remaining idle and pending jobs as skipped when a workflow\n * completes or fails. This is necessary for conditional workflows where only\n * one branch is taken (e.g., in an if-else workflow, the untaken branch's\n * jobs should be marked as skipped).\n *\n * Requirements for using this trait:\n * - The class must implement getJobSkippingLogger() returning LoggerInterface\n * - The class must implement getJobSkippingStorage() returning JobStorageInterface\n *\n * @see \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\InterruptHandlingTrait\n */\ntrait JobSkippingTrait {\n\n  /**\n   * Marks all remaining idle and pending jobs as skipped.\n   *\n   * Called when a workflow completes or fails to mark jobs that were\n   * never executed due to conditional branching or early termination.\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline containing the jobs.\n   */\n  protected function markRemainingJobsAsSkipped(\n    FlowDropPipelineInterface $pipeline,\n  ): void {\n    $skippedCount = 0;\n    $jobStorage = $this->getJobSkippingStorage();\n\n    // Mark all idle jobs as skipped.\n    $idleJobs = $pipeline->getJobsByStatus(\"idle\");\n    foreach ($idleJobs as $job) {\n      $job->markAsSkipped();\n      $jobStorage->save($job);\n      $skippedCount++;\n    }\n\n    // Mark all pending jobs as skipped.\n    // These are jobs that became ready but were never executed because\n    // the workflow completed before they could run.\n    $pendingJobs = $pipeline->getJobsByStatus(\"pending\");\n    foreach ($pendingJobs as $job) {\n      $job->markAsSkipped();\n      $jobStorage->save($job);\n      $skippedCount++;\n    }\n\n    if ($skippedCount > 0) {\n      $this->getJobSkippingLogger()->info(\"Marked @count remaining jobs as skipped\", [\n        \"@count\" => $skippedCount,\n      ]);\n    }\n  }\n\n  /**\n   * Gets the logger for job skipping operations.\n   *\n   * @return \\Psr\\Log\\LoggerInterface\n   *   The logger service.\n   */\n  abstract protected function getJobSkippingLogger(): LoggerInterface;\n\n  /**\n   * Gets the job storage service for job skipping operations.\n   *\n   * @return \\Drupal\\flowdrop_runtime\\Service\\Storage\\JobStorageInterface\n   *   The job storage service.\n   */\n  abstract protected function getJobSkippingStorage(): JobStorageInterface;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Orchestrator/Trait/JobSkippingTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "JobSkippingTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: d6_comment_entity_display\nlabel: Comment display configuration\nmigration_tags:\n  - Drupal 6\n  - Configuration\nsource:\n  plugin: comment_type\n  constants:\n    entity_type: node\n    view_mode: default\n    options:\n      label: hidden\n      type: comment_default\n      weight: 20\nprocess:\n  entity_type: 'constants/entity_type'\n  field_name:\n    -\n      plugin: migration_lookup\n      source: type\n      migration: d6_comment_type\n    -\n      plugin: skip_on_empty\n      method: row\n  view_mode: 'constants/view_mode'\n  options: 'constants/options'\n  bundle: type\ndestination:\n  plugin: component_entity_display\nmigration_dependencies:\n  required:\n    - d6_comment_field_instance\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/migrations/d6_comment_entity_display.yml", "type": "yaml_reference", "topic": "d6 comment entity display"}}
{"instruction": "Show me the implementation of the trait CategorizingPluginManagerTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\nuse Drupal\\Core\\Extension\\Exception\\UnknownExtensionException;\nuse Drupal\\Core\\Extension\\ModuleExtensionList;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Provides a trait for the CategorizingPluginManagerInterface.\n *\n * The trait provides methods for categorizing plugin definitions based on a\n * 'category' key. The plugin manager should make sure there is a default\n * category. For that the trait's processDefinitionCategory() method can be\n * invoked from the processDefinition() method.\n *\n * @see \\Drupal\\Component\\Plugin\\CategorizingPluginManagerInterface\n */\ntrait CategorizingPluginManagerTrait {\n\n  use StringTranslationTrait;\n\n  /**\n   * Processes a plugin definition to ensure there is a category.\n   *\n   * If the definition lacks a category, it defaults to the providing module.\n   *\n   * @param array $definition\n   *   The plugin definition.\n   */\n  protected function processDefinitionCategory(&$definition) {\n    // Ensure that every plugin has a category.\n    if (empty($definition['category'])) {\n      // Default to the human readable module name if the provider is a module;\n      // otherwise the provider machine name is used.\n      $definition['category'] = $this->getProviderName($definition['provider']);\n    }\n  }\n\n  /**\n   * Gets the name of a provider.\n   *\n   * @param string $provider\n   *   The machine name of a plugin provider.\n   *\n   * @return string\n   *   The human-readable module name if it exists, otherwise the\n   *   machine-readable name passed.\n   */\n  protected function getProviderName($provider) {\n    try {\n      return $this->getModuleExtensionList()->getName($provider);\n    }\n    catch (UnknownExtensionException) {\n      // Otherwise, return the machine name.\n      return $provider;\n    }\n  }\n\n  /**\n   * Returns the module handler used.\n   *\n   * @return \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   *   The module handler.\n   *\n   * @deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. There is no\n   *   replacement.\n   *\n   * @see https://www.drupal.org/node/3310017\n   */\n  public function getModuleHandler() {\n    @trigger_error(__METHOD__ . '() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3310017', E_USER_DEPRECATED);\n    // If the class has an injected module handler, use it. Otherwise fall back\n    // to fetch it from the service container.\n    if (isset($this->moduleHandler)) {\n      return $this->moduleHandler;\n    }\n    return \\Drupal::moduleHandler();\n  }\n\n  /**\n   * Returns the module extension list used.\n   *\n   * @return \\Drupal\\Core\\Extension\\ModuleExtensionList\n   *   The module extension list.\n   */\n  protected function getModuleExtensionList(): ModuleExtensionList {\n    // If the class has an injected module extension list, use it. Otherwise\n    // fall back to fetch it from the service container.\n    if (isset($this->moduleExtensionList)) {\n      return $this->moduleExtensionList;\n    }\n    return \\Drupal::service('extension.list.module');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCategories() {\n    // Fetch all categories from definitions and remove duplicates.\n    $categories = array_unique(array_values(array_map(function ($definition) {\n      return $definition['category'];\n    }, $this->getDefinitions())));\n    natcasesort($categories);\n    return $categories;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSortedDefinitions(?array $definitions = NULL, string $label_key = 'label') {\n    // Sort the plugins first by category, then by label.\n    $definitions = $definitions ?? $this->getDefinitions();\n    uasort($definitions, function ($a, $b) use ($label_key) {\n      if ((string) $a['category'] != (string) $b['category']) {\n        return strnatcasecmp($a['category'], $b['category']);\n      }\n      return strnatcasecmp($a[$label_key], $b[$label_key]);\n    });\n    return $definitions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getGroupedDefinitions(?array $definitions = NULL, string $label_key = 'label') {\n    // @phpstan-ignore arguments.count\n    $definitions = $this->getSortedDefinitions($definitions ?? $this->getDefinitions(), $label_key);\n    $grouped_definitions = [];\n    foreach ($definitions as $id => $definition) {\n      $grouped_definitions[(string) $definition['category']][$id] = $definition;\n    }\n    return $grouped_definitions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  abstract public function getDefinitions();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/CategorizingPluginManagerTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "CategorizingPluginManagerTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RestPermissions in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\rest;\n\nuse Drupal\\Component\\Utility\\NestedArray;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\rest\\Plugin\\Type\\ResourcePluginManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides rest module permissions.\n */\nclass RestPermissions implements ContainerInjectionInterface {\n\n  /**\n   * The rest resource plugin manager.\n   *\n   * @var \\Drupal\\rest\\Plugin\\Type\\ResourcePluginManager\n   */\n  protected $restPluginManager;\n\n  /**\n   * The REST resource config storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected $resourceConfigStorage;\n\n  /**\n   * Constructs a new RestPermissions instance.\n   *\n   * @param \\Drupal\\rest\\Plugin\\Type\\ResourcePluginManager $rest_plugin_manager\n   *   The rest resource plugin manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(ResourcePluginManager $rest_plugin_manager, EntityTypeManagerInterface $entity_type_manager) {\n    $this->restPluginManager = $rest_plugin_manager;\n    $this->resourceConfigStorage = $entity_type_manager->getStorage('rest_resource_config');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static($container->get('plugin.manager.rest'), $container->get('entity_type.manager'));\n  }\n\n  /**\n   * Returns an array of REST permissions.\n   *\n   * @return array\n   *   An array of permissions keyed by permission name.\n   */\n  public function permissions() {\n    $permissions = [];\n    /** @var \\Drupal\\rest\\RestResourceConfigInterface[] $resource_configs */\n    $resource_configs = $this->resourceConfigStorage->loadMultiple();\n    foreach ($resource_configs as $resource_config) {\n      $plugin = $resource_config->getResourcePlugin();\n\n      // Add the rest resource configuration entity as a dependency to the\n      // permissions.\n      $permissions += array_map(function (array $permission_info) use ($resource_config) {\n        $merge_info['dependencies'][$resource_config->getConfigDependencyKey()] = [\n          $resource_config->getConfigDependencyName(),\n        ];\n        return NestedArray::mergeDeep($permission_info, $merge_info);\n      }, $plugin->permissions());\n    }\n    return $permissions;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/rest/src/RestPermissions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RestPermissions", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "webprofiler.toolbar:\n  path: '/profiler/{token}'\n  defaults:\n    _controller: '\\Drupal\\webprofiler\\Controller\\ProfilerController::toolbarAction'\n  requirements:\n    _permission: 'view webprofiler toolbar'\n\nwebprofiler.dashboard:\n  path: '/admin/reports/profiler/view/{token}'\n  defaults:\n    _title: 'Webprofiler Dashboard'\n    _controller: '\\Drupal\\webprofiler\\Controller\\DashboardController::dashboard'\n  requirements:\n    _permission: 'access webprofiler'\n\nwebprofiler.panel:\n  path: '/admin/reports/profiler/view/{token}/panel/{name}'\n  defaults:\n    _controller: '\\Drupal\\webprofiler\\Controller\\DashboardController::panel'\n  requirements:\n    _permission: 'view webprofiler toolbar'\n\n# get query explain\nwebprofiler.database.explain:\n  path: '/admin/reports/profiler/database_explain/{token}/{qid}'\n  defaults:\n    _controller: '\\Drupal\\webprofiler\\Controller\\DatabaseController::explainAction'\n    _title: 'Query explain'\n  requirements:\n    _permission: 'access webprofiler'\n\nwebprofiler.admin_list:\n  path: '/admin/reports/profiler/list'\n  defaults:\n    _controller: '\\Drupal\\webprofiler\\Controller\\ReportController::list'\n    _title: 'Webprofiler'\n  requirements:\n    _permission: 'access webprofiler'\n\nwebprofiler.settings:\n  path: '/admin/config/development/devel/webprofiler'\n  defaults:\n    _form: 'Drupal\\webprofiler\\Form\\SettingsForm'\n    _title: 'Webprofiler settings'\n  requirements:\n    _permission: 'access webprofiler'\n\n# save frontend data\nwebprofiler.frontend.navigation:\n  path: '/admin/reports/profiler/frontend/{profile}/navigation'\n  defaults:\n    _controller: '\\Drupal\\webprofiler\\Controller\\FrontendController::saveNavigationDataAction'\n    _title: 'Save frontend data'\n  options:\n    parameters:\n      profile:\n        type: 'webprofiler:token'\n  methods: [POST]\n  requirements:\n    _permission: 'view webprofiler toolbar'\n\nwebprofiler.frontend.cwv:\n  path: '/admin/reports/profiler/frontend/{profile}/cwv'\n  defaults:\n    _controller: '\\Drupal\\webprofiler\\Controller\\FrontendController::saveCwvDataAction'\n    _title: 'Save CWV data'\n  options:\n    parameters:\n      profile:\n        type: 'webprofiler:token'\n  methods: [POST]\n  requirements:\n    _permission: 'view webprofiler toolbar'\n", "metadata": {"source": "repos/webprofiler/webprofiler.routing.yml", "type": "yaml_reference", "topic": "webprofiler.routing"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - eck\n    - node\n    - rest\n    - serialization\n    - user\nid: api_normalization_rest_exports\nlabel: 'API Normalizer REST Exports'\nmodule: views\ndescription: 'REST API exports for data aggregation - leveraging Views instead of custom code'\ntag: ''\nbase_table: openapi_schema\nbase_field: id\ndisplay:\n  default:\n    display_plugin: default\n    id: default\n    display_title: Master\n    position: 0\n    display_options:\n      access:\n        type: perm\n        options:\n          perm: 'view api statistics'\n      cache:\n        type: tag\n      query:\n        type: views_query\n      exposed_form:\n        type: basic\n      pager:\n        type: mini\n      style:\n        type: default\n      row:\n        type: fields\n      fields:\n        id:\n          id: id\n          table: openapi_schema\n          field: id\n          label: 'Schema ID'\n        title:\n          id: title\n          table: openapi_schema\n          field: title\n          label: 'Schema Title'\n        field_provider:\n          id: field_provider\n          table: openapi_schema__field_provider\n          field: field_provider_value\n          label: 'Provider'\n        field_schema_version:\n          id: field_schema_version\n          table: openapi_schema__field_schema_version\n          field: field_schema_version_value\n          label: 'Version'\n        created:\n          id: created\n          table: openapi_schema\n          field: created\n          label: 'Created'\n          date_format: 'html_date'\n      filters: []\n      sorts:\n        created:\n          id: created\n          table: openapi_schema\n          field: created\n          order: DESC\n      title: 'OpenAPI Schemas REST Export'\n  rest_export_schemas:\n    display_plugin: rest_export\n    id: rest_export_schemas\n    display_title: 'REST Export - Schemas'\n    position: 1\n    display_options:\n      display_extenders: []\n      path: api/openapi-schemas\n      pager:\n        type: some\n        options:\n          items_per_page: 50\n      style:\n        type: serializer\n        options:\n          uses_fields: true\n          formats:\n            json: json\n            xml: xml\n      row:\n        type: data_field\n      defaults:\n        style: false\n        row: false\n        pager: false\n  rest_export_provider_stats:\n    display_plugin: rest_export\n    id: rest_export_provider_stats\n    display_title: 'REST Export - Provider Statistics'\n    position: 2\n    display_options:\n      display_extenders: []\n      path: api/provider-statistics\n      pager:\n        type: some\n        options:\n          items_per_page: 100\n      style:\n        type: serializer\n        options:\n          uses_fields: false\n          formats:\n            json: json\n      row:\n        type: data_entity\n      group_by: true\n      fields:\n        field_provider:\n          id: field_provider\n          table: openapi_schema__field_provider\n          field: field_provider_value\n          label: 'Provider'\n          group_type: grouped\n        id:\n          id: id\n          table: openapi_schema\n          field: id\n          label: 'Count'\n          group_type: count\n      defaults:\n        style: false\n        row: false\n        pager: false\n        group_by: false\n        fields: false\n", "metadata": {"source": "repos/api_normalization/config/install.disabled/views.view.api_normalization_rest_exports.yml", "type": "yaml_reference", "topic": "views.view.api normalization rest exports"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: data\nenabled: true\nlabel: Data\ndescription: 'Store, retrieve, and manage structured data including databases, key-value stores, and persistent storage solutions.'\nicon: 'mdi:database'\ncolor: '#f97316'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_category/config/install/flowdrop_node_category.flowdrop_node_category.data.yml", "type": "yaml_reference", "topic": "flowdrop node category.flowdrop node category.data"}}
{"instruction": "Show me the implementation of the class UserRow in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\views\\row;\n\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Plugin\\views\\row\\EntityRow;\n\n/**\n * A row plugin which renders a user.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\"entity:user\")]\nclass UserRow extends EntityRow {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['view_mode']['default'] = 'full';\n\n    return $options;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/views/row/UserRow.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserRow", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "frequency: 15\ntolerance: 20\nto: ''\nsubject: 'URGENT: Drupal cron has failed, please investigate'\nmessage: 'The scheduled cron has not been running as expected for the last @minutes minutes, and we need someone to investigate the issue as soon as possible at :site'\n", "metadata": {"source": "repos/cron_fail_alert/config/install/cron_fail_alert.settings.yml", "type": "yaml_reference", "topic": "cron fail alert.settings"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer flowdrop configuration:\n  title: 'Administer FlowDrop configuration'\n\nadminister flowdrop:\n  title: 'Administer FlowDrop'\n  description: 'Administer all FlowDrop configuration and entities'\n  restrict access: true\n", "metadata": {"source": "repos/flowdrop/flowdrop.permissions.yml", "type": "yaml_reference", "topic": "flowdrop.permissions"}}
{"instruction": "Show me the implementation of the interface ExecutableManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Executable;\n\nuse Drupal\\Component\\Plugin\\PluginManagerInterface;\n\n/**\n * An interface for managers of executable plugins.\n */\ninterface ExecutableManagerInterface extends PluginManagerInterface {\n\n  /**\n   * Executes an executable plugin.\n   *\n   * @param \\Drupal\\Core\\Executable\\ExecutableInterface $plugin\n   *   An executable plugin instance managed by the implementing manager.\n   *\n   * @return mixed\n   *   The returned data varies by plugin implementation, e.g. conditions return\n   *   the boolean evaluation result.\n   *\n   * @throws \\Drupal\\Core\\Executable\\ExecutableException\n   *   If the plugin could not be executed.\n   */\n  public function execute(ExecutableInterface $plugin);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Executable/ExecutableManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ExecutableManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: NexiXpayManagerInterface\nSource file: <source_file>\nFile name hint: NexiXpayManagerInterface.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\nexi_xpay\\Service;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Drupal\\nexi_xpay\\Value\\ModeHandleResult;\nuse Drupal\\nexi_xpay\\Value\\ModeStartResult;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Interface for NexiXpayManager.\n */\ninterface NexiXpayManagerInterface {\n\n  /**\n   * Starts the payment process.\n   */\n  public function startPayment(NexiXpayTransactionInterface $transaction, Request $request): ModeStartResult;\n\n  /**\n   * Handles the return from Nexi.\n   */\n  public function handleReturn(NexiXpayTransactionInterface $transaction, Request $request): ModeHandleResult;\n\n  /**\n   * Handles the notification from Nexi.\n   */\n  public function handleNotify(NexiXpayTransactionInterface $transaction, Request $request): ModeHandleResult;\n\n  /**\n   * Builds the public pay page (order summary + CTA).\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   *\n   * @return array<string, mixed>\n   *   Render array for the pay page.\n   */\n  public function buildPayPage(NexiXpayTransactionInterface $transaction, Request $request): array;\n\n  /**\n   * Builds the public return page after handling return logic.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   * @param \\Drupal\\nexi_xpay\\Value\\ModeHandleResult $handle\n   *   The result of handling the return.\n   *\n   * @return array<string, mixed>\n   *   The render array for the return page.\n   */\n  public function buildReturnPage(NexiXpayTransactionInterface $transaction, Request $request, ModeHandleResult $handle): array;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Service;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Drupal\\nexi_xpay\\Value\\ModeHandleResult;\nuse Drupal\\nexi_xpay\\Value\\ModeStartResult;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Interface for NexiXpayManager.\n */\ninterface NexiXpayManagerInterface {\n\n  /**\n   * Starts the payment process.\n   */\n  public function startPayment(NexiXpayTransactionInterface $transaction, Request $request): ModeStartResult;\n\n  /**\n   * Handles the return from Nexi.\n   */\n  public function handleReturn(NexiXpayTransactionInterface $transaction, Request $request): ModeHandleResult;\n\n  /**\n   * Handles the notification from Nexi.\n   */\n  public function handleNotify(NexiXpayTransactionInterface $transaction, Request $request): ModeHandleResult;\n\n  /**\n   * Builds the public pay page (order summary + CTA).\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   *\n   * @return array<string, mixed>\n   *   Render array for the pay page.\n   */\n  public function buildPayPage(NexiXpayTransactionInterface $transaction, Request $request): array;\n\n  /**\n   * Builds the public return page after handling return logic.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   * @param \\Drupal\\nexi_xpay\\Value\\ModeHandleResult $handle\n   *   The result of handling the return.\n   *\n   * @return array<string, mixed>\n   *   The render array for the return page.\n   */\n  public function buildReturnPage(NexiXpayTransactionInterface $transaction, Request $request, ModeHandleResult $handle): array;\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Service/NexiXpayManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "NexiXpayManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: AnalyticsProcessing\nSource file: <source_file>\nFile name hint: AnalyticsProcessing.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\api_normalization\\Service\\MetricsCollector;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Processes analytics data from queue.\n *\n * @QueueWorker(\n *   id = \"api_normalization_analytics_processing\",\n *   title = @Translation(\"Analytics Processing\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass AnalyticsProcessing extends QueueWorkerBase {\n\n  /**\n   * The metrics collector.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\MetricsCollector\n   */\n  protected MetricsCollector $metrics;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs an AnalyticsProcessing queue worker.\n   *\n   * @param array $configuration\n   *   Configuration.\n   * @param string $plugin_id\n   *   Plugin ID.\n   * @param mixed $plugin_definition\n   *   Plugin definition.\n   * @param \\Drupal\\api_normalization\\Service\\MetricsCollector $metrics\n   *   The metrics collector.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    MetricsCollector $metrics,\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->metrics = $metrics;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    if (!isset($data['event_type']) || !isset($data['timestamp'])) {\n      $this->logger->error('Invalid analytics queue item data');\n      return;\n    }\n\n    try {\n      // Log analytics event to watchdog for metrics collection.\n      \\Drupal::logger('api_normalization')->info('Analytics event: @type', [\n        '@type' => $data['event_type'],\n      ], [\n        'context' => [\n          'endpoint' => $data['endpoint'] ?? '',\n          'response_time' => $data['response_time'] ?? 0,\n          'status_code' => $data['status_code'] ?? 200,\n        ],\n      ]);\n\n      $this->logger->debug('Processed analytics event: @type', [\n        '@type' => $data['event_type'],\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process analytics event: @error', [\n        '@error' => $e->getMessage(),\n      ]);\n      throw $e;\n    }\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\api_normalization\\Service\\MetricsCollector;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Processes analytics data from queue.\n *\n * @QueueWorker(\n *   id = \"api_normalization_analytics_processing\",\n *   title = @Translation(\"Analytics Processing\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass AnalyticsProcessing extends QueueWorkerBase {\n\n  /**\n   * The metrics collector.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\MetricsCollector\n   */\n  protected MetricsCollector $metrics;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs an AnalyticsProcessing queue worker.\n   *\n   * @param array $configuration\n   *   Configuration.\n   * @param string $plugin_id\n   *   Plugin ID.\n   * @param mixed $plugin_definition\n   *   Plugin definition.\n   * @param \\Drupal\\api_normalization\\Service\\MetricsCollector $metrics\n   *   The metrics collector.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    MetricsCollector $metrics,\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->metrics = $metrics;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    if (!isset($data['event_type']) || !isset($data['timestamp'])) {\n      $this->logger->error('Invalid analytics queue item data');\n      return;\n    }\n\n    try {\n      // Log analytics event to watchdog for metrics collection.\n      \\Drupal::logger('api_normalization')->info('Analytics event: @type', [\n        '@type' => $data['event_type'],\n      ], [\n        'context' => [\n          'endpoint' => $data['endpoint'] ?? '',\n          'response_time' => $data['response_time'] ?? 0,\n          'status_code' => $data['status_code'] ?? 200,\n        ],\n      ]);\n\n      $this->logger->debug('Processed analytics event: @type', [\n        '@type' => $data['event_type'],\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process analytics event: @error', [\n        '@error' => $e->getMessage(),\n      ]);\n      throw $e;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/QueueWorker/AnalyticsProcessing.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AnalyticsProcessing", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ConfigFactoryWrapper.php\nTarget symbol: class ConfigFactoryWrapper\nNamespace: Drupal\\webprofiler\\Config\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ConfigFactoryWrapper.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactory\n  - Drupal\\webprofiler\\DataCollector\\ConfigDataCollector\n- Ensure these methods exist where relevant:\n  - get()\n  - loadMultiple()\n  - setDataCollector()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Config;\n\nuse Drupal\\Core\\Config\\ConfigFactory;\nuse Drupal\\webprofiler\\DataCollector\\ConfigDataCollector;\n\n/**\n * Wraps a config factory to be able to figure out all used config files.\n */\nclass ConfigFactoryWrapper extends ConfigFactory {\n\n  /**\n   * The data collector to store config data.\n   *\n   * @var \\Drupal\\webprofiler\\DataCollector\\ConfigDataCollector\n   */\n  private ConfigDataCollector $dataCollector;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get($name) {\n    $result = parent::get($name);\n    $this->dataCollector->addConfig($name, $result);\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadMultiple(array $names) {\n    $results = parent::loadMultiple($names);\n    foreach ($results as $name => $result) {\n      $this->dataCollector->addConfig($name, $result);\n    }\n\n    return $results;\n  }\n\n  /**\n   * Set the data collector to store config data.\n   *\n   * @param \\Drupal\\webprofiler\\DataCollector\\ConfigDataCollector $dataCollector\n   *   The data collector to store config data.\n   */\n  public function setDataCollector(ConfigDataCollector $dataCollector): void {\n    $this->dataCollector = $dataCollector;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Config/ConfigFactoryWrapper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigFactoryWrapper", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: RestEndpointTool\nSource file: <source_file>\nFile name hint: RestEndpointTool.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Plugin\\AgentApiTool;\n\nuse Drupal\\api_normalization_agents\\Attribute\\AgentApiTool;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Executes REST API endpoints as agent tools.\n */\n#[AgentApiTool(\n  id: 'rest_endpoint',\n  label: new TranslatableMarkup('REST Endpoint Tool'),\n  description: new TranslatableMarkup('Executes REST API calls from normalized specifications'),\n)]\nfinal class RestEndpointTool extends AgentApiToolBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(array $parameters, array $context): array {\n    if (!isset($context['endpoint_config'])) {\n      return [\n        'success' => FALSE,\n        'data' => NULL,\n        'metadata' => ['error' => 'Missing endpoint configuration'],\n      ];\n    }\n\n    $endpointConfig = $context['endpoint_config'];\n\n    try {\n      // In a real implementation, this would:\n      // 1. Get the api_normalizer service\n      // 2. Build a request using normalized API spec\n      // 3. Execute with inherited rate limiting and failover\n      // 4. Transform response for agent consumption.\n      // Placeholder for now.\n      return [\n        'success' => TRUE,\n        'data' => [\n          'message' => 'REST endpoint executed',\n          'endpoint' => $endpointConfig['path'] ?? 'unknown',\n          'method' => $endpointConfig['method'] ?? 'GET',\n        ],\n        'metadata' => [\n          'api_id' => $endpointConfig['api_id'] ?? NULL,\n          'rate_limit_group' => $endpointConfig['rate_limit_group'] ?? 'default',\n        ],\n      ];\n    }\n    catch (\\Exception $e) {\n      return [\n        'success' => FALSE,\n        'data' => NULL,\n        'metadata' => ['error' => $e->getMessage()],\n      ];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOssaToolSchema(): array {\n    return [\n      'type' => 'function',\n      'function' => [\n        'name' => 'rest_api_call',\n        'description' => 'Executes a REST API call through the normalization layer',\n        'parameters' => [\n          'type' => 'object',\n          'properties' => [\n            'endpoint' => [\n              'type' => 'string',\n              'description' => 'The API endpoint path',\n            ],\n            'method' => [\n              'type' => 'string',\n              'description' => 'HTTP method (GET, POST, PUT, DELETE)',\n              'enum' => ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],\n            ],\n            'parameters' => [\n              'type' => 'object',\n              'description' => 'Request parameters',\n            ],\n          ],\n          'required' => ['endpoint', 'method'],\n        ],\n      ],\n    ];\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Plugin\\AgentApiTool;\n\nuse Drupal\\api_normalization_agents\\Attribute\\AgentApiTool;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Executes REST API endpoints as agent tools.\n */\n#[AgentApiTool(\n  id: 'rest_endpoint',\n  label: new TranslatableMarkup('REST Endpoint Tool'),\n  description: new TranslatableMarkup('Executes REST API calls from normalized specifications'),\n)]\nfinal class RestEndpointTool extends AgentApiToolBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(array $parameters, array $context): array {\n    if (!isset($context['endpoint_config'])) {\n      return [\n        'success' => FALSE,\n        'data' => NULL,\n        'metadata' => ['error' => 'Missing endpoint configuration'],\n      ];\n    }\n\n    $endpointConfig = $context['endpoint_config'];\n\n    try {\n      // In a real implementation, this would:\n      // 1. Get the api_normalizer service\n      // 2. Build a request using normalized API spec\n      // 3. Execute with inherited rate limiting and failover\n      // 4. Transform response for agent consumption.\n      // Placeholder for now.\n      return [\n        'success' => TRUE,\n        'data' => [\n          'message' => 'REST endpoint executed',\n          'endpoint' => $endpointConfig['path'] ?? 'unknown',\n          'method' => $endpointConfig['method'] ?? 'GET',\n        ],\n        'metadata' => [\n          'api_id' => $endpointConfig['api_id'] ?? NULL,\n          'rate_limit_group' => $endpointConfig['rate_limit_group'] ?? 'default',\n        ],\n      ];\n    }\n    catch (\\Exception $e) {\n      return [\n        'success' => FALSE,\n        'data' => NULL,\n        'metadata' => ['error' => $e->getMessage()],\n      ];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOssaToolSchema(): array {\n    return [\n      'type' => 'function',\n      'function' => [\n        'name' => 'rest_api_call',\n        'description' => 'Executes a REST API call through the normalization layer',\n        'parameters' => [\n          'type' => 'object',\n          'properties' => [\n            'endpoint' => [\n              'type' => 'string',\n              'description' => 'The API endpoint path',\n            ],\n            'method' => [\n              'type' => 'string',\n              'description' => 'HTTP method (GET, POST, PUT, DELETE)',\n              'enum' => ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],\n            ],\n            'parameters' => [\n              'type' => 'object',\n              'description' => 'Request parameters',\n            ],\n          ],\n          'required' => ['endpoint', 'method'],\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/src/Plugin/AgentApiTool/RestEndpointTool.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RestEndpointTool", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: LinkSeparateFormatter\nSource file: <source_file>\nFile name hint: LinkSeparateFormatter.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\link\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'link_separate' formatter.\n *\n * @todo https://www.drupal.org/node/1829202 Merge into 'link' formatter once\n *   there is a #type like 'item' that can render a compound label and content\n *   outside of a form context.\n */\n#[FieldFormatter(\n  id: 'link_separate',\n  label: new TranslatableMarkup('Separate link text and URL'),\n  field_types: [\n    'link',\n  ],\n)]\nclass LinkSeparateFormatter extends LinkFormatter {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    return [\n      'trim_length' => 80,\n      'rel' => '',\n      'target' => '',\n    ] + parent::defaultSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  function viewElements(FieldItemListInterface $items, $langcode) {\n    $element = [];\n    $entity = $items->getEntity();\n    $settings = $this->getSettings();\n\n    foreach ($items as $delta => $item) {\n      // By default use the full URL as the link text.\n      $url = $this->buildUrl($item);\n      $link_title = $url->toString();\n\n      // If the link text field value is available, use it for the text.\n      if (empty($settings['url_only']) && !empty($item->title)) {\n        // Unsanitized token replacement here because the entire link title\n        // gets auto-escaped during link generation in\n        // \\Drupal\\Core\\Utility\\LinkGenerator::generate().\n        $link_title = \\Drupal::token()->replace($item->title, [$entity->getEntityTypeId() => $entity], ['clear' => TRUE]);\n      }\n\n      // The link_separate formatter has two titles; the link text (as in the\n      // field values) and the URL itself. If there is no link text value,\n      // $link_title defaults to the URL, so it needs to be unset.\n      // The URL version may need to be trimmed as well.\n      if (empty($item->title)) {\n        $link_title = NULL;\n      }\n      $url_title = $url->toString();\n      if (!empty($settings['trim_length'])) {\n        $link_title = $link_title !== NULL ? Unicode::truncate($link_title, $settings['trim_length'], FALSE, TRUE) : NULL;\n        $url_title = Unicode::truncate($url_title, $settings['trim_length'], FALSE, TRUE);\n      }\n\n      $element[$delta] = [\n        '#theme' => 'link_formatter_link_separate',\n        '#title' => $link_title,\n        '#url_title' => $url_title,\n        '#url' => $url,\n      ];\n\n      if (!empty($item->_attributes)) {\n        // Set our attributes on the <a> element that is being built.\n        $url->setOption('attributes', $item->_attributes);\n\n        // Unset field item attributes since they have been included in the\n        // formatter output and should not be rendered in the field template.\n        unset($item->_attributes);\n      }\n    }\n    return $element;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\link\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Component\\Utility\\Unicode;\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'link_separate' formatter.\n *\n * @todo https://www.drupal.org/node/1829202 Merge into 'link' formatter once\n *   there is a #type like 'item' that can render a compound label and content\n *   outside of a form context.\n */\n#[FieldFormatter(\n  id: 'link_separate',\n  label: new TranslatableMarkup('Separate link text and URL'),\n  field_types: [\n    'link',\n  ],\n)]\nclass LinkSeparateFormatter extends LinkFormatter {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    return [\n      'trim_length' => 80,\n      'rel' => '',\n      'target' => '',\n    ] + parent::defaultSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewElements(FieldItemListInterface $items, $langcode) {\n    $element = [];\n    $entity = $items->getEntity();\n    $settings = $this->getSettings();\n\n    foreach ($items as $delta => $item) {\n      // By default use the full URL as the link text.\n      $url = $this->buildUrl($item);\n      $link_title = $url->toString();\n\n      // If the link text field value is available, use it for the text.\n      if (empty($settings['url_only']) && !empty($item->title)) {\n        // Unsanitized token replacement here because the entire link title\n        // gets auto-escaped during link generation in\n        // \\Drupal\\Core\\Utility\\LinkGenerator::generate().\n        $link_title = \\Drupal::token()->replace($item->title, [$entity->getEntityTypeId() => $entity], ['clear' => TRUE]);\n      }\n\n      // The link_separate formatter has two titles; the link text (as in the\n      // field values) and the URL itself. If there is no link text value,\n      // $link_title defaults to the URL, so it needs to be unset.\n      // The URL version may need to be trimmed as well.\n      if (empty($item->title)) {\n        $link_title = NULL;\n      }\n      $url_title = $url->toString();\n      if (!empty($settings['trim_length'])) {\n        $link_title = $link_title !== NULL ? Unicode::truncate($link_title, $settings['trim_length'], FALSE, TRUE) : NULL;\n        $url_title = Unicode::truncate($url_title, $settings['trim_length'], FALSE, TRUE);\n      }\n\n      $element[$delta] = [\n        '#theme' => 'link_formatter_link_separate',\n        '#title' => $link_title,\n        '#url_title' => $url_title,\n        '#url' => $url,\n      ];\n\n      if (!empty($item->_attributes)) {\n        // Set our attributes on the <a> element that is being built.\n        $url->setOption('attributes', $item->_attributes);\n\n        // Unset field item attributes since they have been included in the\n        // formatter output and should not be rendered in the field template.\n        unset($item->_attributes);\n      }\n    }\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/link/src/Plugin/Field/FieldFormatter/LinkSeparateFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LinkSeparateFormatter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class Zip in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Plugin\\Archiver;\n\nuse Drupal\\Core\\Archiver\\Attribute\\Archiver;\nuse Drupal\\Core\\Archiver\\Zip as BaseZip;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines an archiver implementation for .zip files.\n *\n * @link http://php.net/zip\n */\n#[Archiver(\n  id: 'Zip',\n  title: new TranslatableMarkup('Zip'),\n  description: new TranslatableMarkup('Handles zip files.'),\n  extensions: ['zip']\n)]\nclass Zip extends BaseZip {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/Archiver/Zip.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Zip", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# FlowDrop Job Local Tasks\n\n# Job list tabs\nflowdrop.jobs.list:\n  route_name: flowdrop.jobs\n  title: 'List'\n  base_route: flowdrop.jobs\n\n# Job type tabs\nflowdrop.structure.job_types.list:\n  route_name: flowdrop.structure.job_types\n  title: 'List'\n  base_route: flowdrop.structure.job_types\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_job/flowdrop_job.links.task.yml", "type": "yaml_reference", "topic": "flowdrop job.links.task"}}
{"instruction": "Show me the implementation of the class AiImageCropGraphicalLibraryBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\ai_image_crop\\ImageToolkit;\n\nuse Drupal\\Core\\File\\FileSystemInterface;\n\n/**\n * Abstract base class for graphical library services.\n */\nabstract class AiImageCropGraphicalLibraryBase implements AiImageCropGraphicalLibraryInterface {\n\n  /**\n   * The constructor.\n   */\n  public function __construct(\n    protected FileSystemInterface $fileSystem,\n  ) {\n  }\n\n}\n", "metadata": {"source": "repos/ai_image_crop/src/ImageToolkit/AiImageCropGraphicalLibraryBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AiImageCropGraphicalLibraryBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CloneEntity in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_entity_clone\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_entity_clone\\Service\\EntityCloneService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_entity_clone_clone',\n  label: new TranslatableMarkup('Clone Entity'),\n  description: new TranslatableMarkup('Clone a single entity with optional title prefix/suffix and child paragraph handling.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup('The entity type to clone (e.g., node, media, paragraph)'),\n      required: TRUE,\n    ),\n    'entity_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity ID'),\n      description: new TranslatableMarkup('The ID of the entity to clone'),\n      required: TRUE,\n    ),\n    'title_prefix' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title Prefix'),\n      description: new TranslatableMarkup('Prefix to add to the cloned entity title'),\n      required: FALSE,\n    ),\n    'title_suffix' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title Suffix'),\n      description: new TranslatableMarkup('Suffix to add to the cloned entity title (default: \" (Clone)\")'),\n      required: FALSE,\n    ),\n    'clone_children' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Clone Children'),\n      description: new TranslatableMarkup('Whether to clone child paragraphs (default: true)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'source_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Entity ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'clone_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Cloned Entity ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'clone_uuid' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Cloned Entity UUID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Cloned Entity Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CloneEntity extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'entity_clone';\n\n\n  protected EntityCloneService $entityCloneService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->entityCloneService = $container->get('mcp_tools_entity_clone.entity_clone');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? '';\n    $entityId = $input['entity_id'] ?? '';\n\n    if (empty($entityType) || empty($entityId)) {\n      return ['success' => FALSE, 'error' => 'Both entity_type and entity_id are required.'];\n    }\n\n    $options = [];\n    if (isset($input['title_prefix'])) {\n      $options['title_prefix'] = $input['title_prefix'];\n    }\n    if (isset($input['title_suffix'])) {\n      $options['title_suffix'] = $input['title_suffix'];\n    }\n    if (isset($input['clone_children'])) {\n      $options['clone_children'] = (bool) $input['clone_children'];\n    }\n\n    return $this->entityCloneService->cloneEntity($entityType, $entityId, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_entity_clone/src/Plugin/tool/Tool/CloneEntity.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CloneEntity", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ApiNormalizationUi in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the API Normalization UI module.\n */\n\ndeclare(strict_types=1);\n\n/**\n * Implements hook_install().\n */\nfunction api_normalization_ui_install() {\n  // Set schema version for fresh installs.\n  \\Drupal::keyValue('system.schema')->set('api_normalization_ui', 8000);\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_ui/api_normalization_ui.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiNormalizationUi", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: KeyRotationResult\nSource file: <source_file>\nFile name hint: KeyRotationResult.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\n\n/**\n * Result of rotating the active encryption key and optionally re-encrypting.\n *\n * @immutable\n */\nfinal class KeyRotationResult {\n\n  public function __construct(\n    public readonly ?EncryptionKeyId $oldActiveKeyId,\n    public readonly EncryptionKeyId $newActiveKeyId,\n    public readonly int $updated = 0,\n    public readonly int $skipped = 0,\n    public readonly int $failed = 0,\n  ) {}\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\n\n/**\n * Result of rotating the active encryption key and optionally re-encrypting.\n *\n * @immutable\n */\nfinal class KeyRotationResult {\n\n  public function __construct(\n    public readonly ?EncryptionKeyId $oldActiveKeyId,\n    public readonly EncryptionKeyId $newActiveKeyId,\n    public readonly int $updated = 0,\n    public readonly int $skipped = 0,\n    public readonly int $failed = 0,\n  ) {}\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyRotationResult.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyRotationResult", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "laposta_subscribe.api_key_settings:\n  path: '/admin/config/services/laposta_subscribe/api-key'\n  defaults:\n    _form: '\\Drupal\\laposta_subscribe\\Form\\LapostaSubscribeApiKeyForm'\n    _title: 'Laposta Subscribe API Key Settings'\n  requirements:\n    _permission: 'administer laposta subscribe'\n\nlaposta_subscribe.list_fields_settings:\n  path: '/admin/config/services/laposta_subscribe/list-fields'\n  defaults:\n    _form: '\\Drupal\\laposta_subscribe\\Form\\LapostaSubscribeListFieldsForm'\n    _title: 'Laposta Subscribe List and Fields Settings'\n  requirements:\n    _permission: 'administer laposta subscribe'\n\nlaposta_subscribe.form_settings:\n  path: '/admin/config/services/laposta_subscribe/form'\n  defaults:\n    _form: '\\Drupal\\laposta_subscribe\\Form\\LapostaSubscribeFormSettingsForm'\n    _title: 'Laposta Subscribe Form Settings'\n  requirements:\n    _permission: 'administer laposta subscribe'\n\nlaposta_subscribe.preview:\n  path: '/admin/config/services/laposta_subscribe/preview'\n  defaults:\n    _controller: '\\Drupal\\laposta_subscribe\\Controller\\LapostaSubscribeFormController::form'\n    _title: 'Laposta Subscribe Preview'\n  requirements:\n    _permission: 'administer laposta subscribe'\n\nlaposta_subscribe.help:\n  path: '/admin/config/services/laposta_subscribe/help'\n  defaults:\n    _controller: '\\Drupal\\laposta_subscribe\\Controller\\LapostaSubscribeHelpController::help'\n    _title: 'Laposta Subscribe Help'\n  requirements:\n    _permission: 'administer laposta subscribe'\n\n\nlaposta_subscribe.subscription_log:\n  path: '/admin/config/services/laposta_subscribe/log'\n  defaults:\n    _controller: '\\Drupal\\laposta_subscribe\\Controller\\LapostaSubscribeLogController::content'\n    _title: 'Laposta Subscribe Log'\n  requirements:\n    _permission: 'administer laposta subscribe'\n\nlaposta_subscribe.subscribe:\n  path: '/laposta-subscribe'\n  defaults:\n    _controller: '\\Drupal\\laposta_subscribe\\Controller\\LapostaSubscribeController::subscribe'\n  requirements:\n    _permission: 'access content'\n  methods: [POST]\n", "metadata": {"source": "repos/laposta_subscribe/laposta_subscribe.routing.yml", "type": "yaml_reference", "topic": "laposta subscribe.routing"}}
{"instruction": "Show me the implementation of the class DeleteBundleOperation in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eb\\Plugin\\EbOperation;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\eb\\Attribute\\EbOperation;\nuse Drupal\\eb\\Exception\\ExecutionException;\nuse Drupal\\eb\\PluginBase\\OperationBase;\nuse Drupal\\eb\\Result\\ExecutionResult;\nuse Drupal\\eb\\Result\\PreviewResult;\nuse Drupal\\eb\\Result\\RollbackResult;\nuse Drupal\\eb\\Result\\ValidationResult;\nuse Drupal\\eb\\Service\\DiscoveryServiceInterface;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Operation for deleting entity bundles.\n */\n#[EbOperation(\n  id: 'delete_bundle',\n  label: new TranslatableMarkup('Delete Bundle'),\n  description: new TranslatableMarkup('Deletes a bundle and all its fields'),\n  operationType: 'delete',\n)]\nclass DeleteBundleOperation extends OperationBase {\n\n  /**\n   * Constructor.\n   */\n  public function __construct(\n    array $configuration,\n    string $plugin_id,\n    mixed $plugin_definition,\n    EntityTypeManagerInterface $entityTypeManager,\n    LoggerInterface $logger,\n    ConfigFactoryInterface $configFactory,\n    protected DiscoveryServiceInterface $discoveryService,\n    protected EntityFieldManagerInterface $entityFieldManager,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $entityTypeManager, $logger, $configFactory);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    /** @var \\Psr\\Log\\LoggerInterface $logger */\n    $logger = $container->get('logger.channel.eb');\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('entity_type.manager'),\n      $logger,\n      $container->get('config.factory'),\n      $container->get('eb.discovery_service'),\n      $container->get('entity_field.manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(): ValidationResult {\n    $result = new ValidationResult();\n\n    $this->validateRequiredFields(['entity_type', 'bundle_id'], $result);\n\n    if (!$result->isValid()) {\n      return $result;\n    }\n\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    $validation = $this->discoveryService->validateEntityBundle($entity_type, $bundle_id);\n    if (!$validation['valid']) {\n      foreach ($validation['errors'] as $error) {\n        $result->addError($error, 'bundle_id', 'bundle_not_found');\n      }\n    }\n    else {\n      $result->addWarning(\n        $this->t('WARNING: Deleting this bundle will delete all content and fields.')\n      );\n    }\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preview(): PreviewResult {\n    $preview = new PreviewResult();\n\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    $preview->addOperation(\n      'delete',\n      'bundle',\n      $bundle_id,\n      $this->t('Delete bundle @bundle from @type', [\n        '@bundle' => $bundle_id,\n        '@type' => $entity_type,\n      ])\n    );\n\n    $preview->addDetails([\n      'Entity Type' => $entity_type,\n      'Bundle ID' => $bundle_id,\n      'WARNING' => 'All content and fields will be deleted',\n    ]);\n\n    return $preview;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(): ExecutionResult {\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    return $this->executeWithErrorHandling(function () use ($entity_type, $bundle_id) {\n      $entity_type_definitions = $this->discoveryService->getAllEntityTypes();\n      $bundle_entity_type = $entity_type_definitions[$entity_type]['bundle_entity_type'];\n\n      $bundle_storage = $this->entityTypeManager->getStorage($bundle_entity_type);\n      $bundle = $bundle_storage->load($bundle_id);\n\n      if (!$bundle) {\n        throw new ExecutionException(\"Bundle '{$bundle_id}' not found\");\n      }\n\n      // Store configuration for rollback.\n      $bundle_config = $bundle->toArray();\n\n      // Delete the bundle.\n      $bundle->delete();\n\n      $this->entityFieldManager->clearCachedFieldDefinitions();\n\n      $result = new ExecutionResult(TRUE);\n      $result->addAffectedEntityById($bundle_entity_type, $bundle_id);\n      $result->setRollbackData([\n        'bundle_entity_type' => $bundle_entity_type,\n        'bundle_config' => $bundle_config,\n        'entity_type' => $entity_type,\n      ]);\n\n      $this->logInfo('Deleted bundle: @bundle', ['@bundle' => $bundle_id]);\n\n      return $result;\n    }, 'delete bundle');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function rollback(): RollbackResult {\n    $rollback_data = $this->getRequiredRollbackData();\n\n    return $this->rollbackWithErrorHandling(function () use ($rollback_data) {\n      $bundle_storage = $this->entityTypeManager->getStorage($rollback_data['bundle_entity_type']);\n      $bundle = $bundle_storage->create($rollback_data['bundle_config']);\n      $bundle->save();\n\n      $this->entityFieldManager->clearCachedFieldDefinitions();\n\n      $bundle_id = $rollback_data['bundle_config']['id'] ?? 'unknown';\n      $this->logInfo('Rolled back bundle deletion: @bundle', ['@bundle' => $bundle_id]);\n\n      $result = new RollbackResult(TRUE);\n      $result->addMessage($this->t('Successfully rolled back bundle deletion'));\n\n      return $result;\n    }, 'bundle deletion');\n  }\n\n}\n", "metadata": {"source": "repos/eb/src/Plugin/EbOperation/DeleteBundleOperation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteBundleOperation", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ContextualLinksSerializer in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\contextual;\n\nuse Drupal\\Component\\Utility\\UrlHelper;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\n\n/**\n * Helper methods to handle contextual links <-> ID conversion.\n */\nreadonly class ContextualLinksSerializer {\n\n  public function __construct(\n    protected LanguageManagerInterface $languageManager,\n  ) {}\n\n  /**\n   * Serializes #contextual_links property value array to a string.\n   *\n   * Examples:\n   *  - node:node=1:langcode=en\n   *  -\n   * views_ui_edit:view=frontpage:location=page&view_name=frontpage&view_display_id=page_1&langcode=en\n   *  - menu:menu=tools:langcode=en|block:block=olivero.tools:langcode=en\n   *\n   * So, expressed in a pattern:\n   *  <group>:<route parameters>:<metadata>\n   *\n   * The route parameters and options are encoded as query strings.\n   *\n   * @param array $contextualLinks\n   *   The $element['#contextual_links'] value for some render element.\n   *\n   * @return string\n   *   A serialized representation of a #contextual_links property value array\n   *   for use in a data-* attribute.\n   */\n  public function linksToId(array $contextualLinks): string {\n    $ids = [];\n\n    $langcode = $this->languageManager->getCurrentLanguage(LanguageInterface::TYPE_URL)->getId();\n    foreach ($contextualLinks as $group => $args) {\n      $routeParameters = UrlHelper::buildQuery($args['route_parameters']);\n      $args += ['metadata' => []];\n      // Add the current URL language to metadata so a different ID will be\n      // computed when URLs vary by language. This allows to store different\n      // language-aware contextual links on the client side.\n      $args['metadata'] += ['langcode' => $langcode];\n      $metadata = UrlHelper::buildQuery($args['metadata']);\n      $ids[] = \"$group:$routeParameters:$metadata\";\n    }\n\n    return implode('|', $ids);\n  }\n\n  /**\n   * Unserializes the result of ::linksToId().\n   *\n   * Note that $id is user input. Before calling this method the ID should be\n   * checked against the token stored in the 'data-contextual-token' attribute\n   * which is passed via the 'tokens' request parameter to\n   * \\Drupal\\contextual\\ContextualController::render().\n   *\n   * @param string $id\n   *   A serialized representation of a #contextual_links property value array.\n   *\n   * @return array\n   *   The value for a #contextual_links property.\n   *\n   * @see self::linksToId()\n   * @see \\Drupal\\contextual\\ContextualController::render()\n   */\n  public function idToLinks(string $id): array {\n    $contextualLinks = [];\n\n    foreach (explode('|', $id) as $context) {\n      [$group, $routeParametersRaw, $metadataRaw] = explode(':', $context);\n      parse_str($routeParametersRaw, $routeParameters);\n      $metadata = [];\n      parse_str($metadataRaw, $metadata);\n      $contextualLinks[$group] = [\n        'route_parameters' => $routeParameters,\n        'metadata' => $metadata,\n      ];\n    }\n\n    return $contextualLinks;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contextual/src/ContextualLinksSerializer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContextualLinksSerializer", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FrontendController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Controller;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\webprofiler\\Profiler\\Profiler;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Profiler\\Profile;\n\n/**\n * Collects frontend navigation and CWV data.\n */\nclass FrontendController extends ControllerBase {\n\n  /**\n   * FrontendController constructor.\n   *\n   * @param \\Drupal\\webprofiler\\Profiler\\Profiler $profiler\n   *   The profiler.\n   */\n  final public function __construct(private readonly Profiler $profiler) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): FrontendController {\n    return new static(\n      $container->get('webprofiler.profiler'),\n    );\n  }\n\n  /**\n   * Save the navigation data to frontend collector.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profile $profile\n   *   The profile.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The response.\n   */\n  public function saveNavigationDataAction(Profile $profile, Request $request): JsonResponse {\n    $this->profiler->disable();\n\n    $data = Json::decode($request->getContent());\n\n    /** @var \\Drupal\\webprofiler\\DataCollector\\FrontendDataCollector $collector */\n    $collector = $profile->getCollector('frontend');\n    $collector->setNavigationData($data);\n    $this->profiler->updateProfile($profile);\n\n    return new JsonResponse(['success' => TRUE]);\n  }\n\n  /**\n   * Save the Core Web Vitals data to frontend collector.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profile $profile\n   *   The profile.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The response.\n   */\n  public function saveCwvDataAction(Profile $profile, Request $request): JsonResponse {\n    $this->profiler->disable();\n\n    $data = Json::decode($request->getContent());\n\n    /** @var \\Drupal\\webprofiler\\DataCollector\\FrontendDataCollector $collector */\n    $collector = $profile->getCollector('frontend');\n    $collector->setCwvData($data);\n    $this->profiler->updateProfile($profile);\n\n    return new JsonResponse(['success' => TRUE]);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Controller/FrontendController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FrontendController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "dependencies: {  }\nid: dataframe_operations\nlabel: 'Dataframe Operations'\ndescription: 'Operations on dataframe data'\ncategory: data\nicon: 'mdi:database-cog-outline'\nplugin_version: 1.0.0\nenabled: true\nparameters:\n  columns:\n    configurable: true\n    connectable: false\n    required: false\n    default: {  }\n  condition:\n    configurable: true\n    connectable: false\n    required: false\n  dataframe:\n    configurable: false\n    connectable: true\n    required: false\n  operation:\n    configurable: true\n    connectable: false\n    required: false\n    default: head\n  rows:\n    configurable: true\n    connectable: false\n    required: false\n    default: 5\noutputs:\n  columns:\n    exposed: true\n  input_rows:\n    exposed: true\n  operation:\n    exposed: true\n  output_rows:\n    exposed: true\n  result:\n    exposed: true\n  rows:\n    exposed: true\ntags: {  }\nexecutor_plugin: 'flowdrop_node_processor:dataframe_operations'\nvisual_type: default\nsupported_visual_types:\n  - default\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/config/install/flowdrop_node_type.flowdrop_node_type.dataframe_operations.yml", "type": "yaml_reference", "topic": "flowdrop node type.flowdrop node type.dataframe operations"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: KeyValueStoreExpirableInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\KeyValueStore;\n\n/**\n * Defines the interface for expiring data in a key/value store.\n */\ninterface KeyValueStoreExpirableInterface extends KeyValueStoreInterface {\n\n  /**\n   * Saves a value for a given key with a time to live.\n   *\n   * @param string $key\n   *   The key of the data to store.\n   * @param mixed $value\n   *   The data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  function setWithExpire($key, $value, $expire);\n\n  /**\n   * Sets a value for a given key with a time to live if it does not yet exist.\n   *\n   * If a key is expired it also does not exists.\n   *\n   * @param string $key\n   *   The key of the data to store.\n   * @param mixed $value\n   *   The data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   *\n   * @return bool\n   *   TRUE if the data was set, or FALSE if it already existed.\n   */\n  public function setWithExpireIfNotExists($key, $value, $expire);\n\n  /**\n   * Saves an array of values with a time to live.\n   *\n   * @param array $data\n   *   An array of data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  public function setMultipleWithExpire(array $data, $expire);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\KeyValueStore;\n\n/**\n * Defines the interface for expiring data in a key/value store.\n */\ninterface KeyValueStoreExpirableInterface extends KeyValueStoreInterface {\n\n  /**\n   * Saves a value for a given key with a time to live.\n   *\n   * @param string $key\n   *   The key of the data to store.\n   * @param mixed $value\n   *   The data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  public function setWithExpire($key, $value, $expire);\n\n  /**\n   * Sets a value for a given key with a time to live if it does not yet exist.\n   *\n   * If a key is expired it also does not exists.\n   *\n   * @param string $key\n   *   The key of the data to store.\n   * @param mixed $value\n   *   The data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   *\n   * @return bool\n   *   TRUE if the data was set, or FALSE if it already existed.\n   */\n  public function setWithExpireIfNotExists($key, $value, $expire);\n\n  /**\n   * Saves an array of values with a time to live.\n   *\n   * @param array $data\n   *   An array of data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  public function setMultipleWithExpire(array $data, $expire);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/KeyValueStore/KeyValueStoreExpirableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "KeyValueStoreExpirableInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class PathAliasPostUpdate in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Post update functions for Path Alias.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction path_alias_removed_post_updates(): array {\n  return [\n    'path_alias_post_update_drop_path_alias_status_index' => '11.0.0',\n  ];\n}\n\n/**\n * Update the path_alias_revision indices.\n */\nfunction path_alias_post_update_update_path_alias_revision_indexes(): void {\n  /** @var \\Drupal\\Core\\Entity\\EntityDefinitionUpdateManagerInterface $update_manager */\n  $update_manager = \\Drupal::service('entity.definition_update_manager');\n  $entity_type = $update_manager->getEntityType('path_alias');\n  $update_manager->updateEntityType($entity_type);\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path_alias/path_alias.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathAliasPostUpdate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set base_url = url('<front>') %}\n{% if data.nodes.items|length > 0 %}\n  <div class=\"btn\">\n    <span id=\"node-count\" class=\"btn-effect\">Node Count Details</span>\n    <span id=\"user-count\">User Count Details</span>\n  </div>\n  <div class=\"node-details\">\n    <p>\n      Total Nodes: <a href=\"{{ base_url }}admin/content?type=All&status=All&langcode=All\">{{ data.nodes.total.2 }}</a><br />\n      <small>(Published: <a href=\"{{ base_url }}admin/content?type=All&status=1&langcode=All\">{{ data.nodes.total.0 }}</a> | Unpublished: <a href=\"{{ base_url }}admin/content?type=All&status=2&langcode=All\">{{ data.nodes.total.1 }}</a>)</small>\n    </p>\n    <table>\n      <thead>\n        <tr>\n          <th>S. No.</th>\n          <th>Content Type</th>\n          <th>Published Node</th>\n          <th>Unpublished Node</th>\n          <th>Sum</th>\n        </tr>\n      </thead>\n      <tbody>\n        {% for id, val in data.nodes.items %}\n        <tr>\n          <td>{{ loop.index }}.</td>\n          <td>{{ val.name }}</td>\n          <td><a href=\"{{ base_url }}admin/content?type={{ id }}&status=1&langcode=All\">{{ val.published }}</a></td>\n          <td><a href=\"{{ base_url }}admin/content?type={{ id }}&status=2&langcode=All\">{{ val.unpublished }}</a></td>\n          <td><a href=\"{{ base_url }}admin/content?type={{ id }}&status=All&langcode=All\">{{ val.sum }}</a></td>\n        </tr>\n        {% endfor %}\n      </tbody>\n    </table>\n  </div>\n  <div class=\"user-details\">\n    <p>\n      Total Users: <a href=\"{{ base_url }}admin/people?status=All&role=All&permission=All\">{{ data.users.total.2 }}</a><br />\n      <small>(Active: <a href=\"{{ base_url }}admin/people?status=1&role=All&permission=All\">{{ data.users.total.0 }}</a> |\n      Inactive: <a href=\"{{ base_url }}admin/people?status=2&role=All&permission=All\">{{ data.users.total.1 }}</a>)</small>\n    </p>\n    <table>\n      <thead>\n        <tr>\n          <th>S. No.</th>\n          <th>User Role</th>\n          <th>Active User</th>\n          <th>Inactive User</th>\n          <th>Sum</th>\n        </tr>\n      </thead>\n      <tbody>\n        {% for id, val in data.users.items %}\n        <tr>\n          <td>{{ loop.index }}.</td>\n          <td>{{ val.name }}</td>\n          <td><a href=\"{{ base_url }}admin/people?status=1&role={{ id }}&permission=All\">{{ val.active }}</a></td>\n          <td><a href=\"{{ base_url }}admin/people?status=2&role={{ id }}&permission=All\">{{ val.inactive }}</a></td>\n          <td><a href=\"{{ base_url }}admin/people?status=All&role={{ id }}&permission=All\">{{ val.sum }}</a></td>\n        </tr>\n        {% endfor %}\n      </tbody>\n    </table>\n  </div>\n{% else %}\n  No data available.\n{% endif %}\n", "metadata": {"source": "repos/data_count/templates/data-count.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface EntityDisplayModeInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\n\n/**\n * Provides an interface for entity types that hold form and view mode settings.\n */\ninterface EntityDisplayModeInterface extends ConfigEntityInterface {\n\n  /**\n   * Gets the entity type this display mode is used for.\n   *\n   * @return string\n   *   The entity type name.\n   */\n  public function getTargetType();\n\n  /**\n   * Set the entity type this display mode is used for.\n   *\n   * @param string $target_entity_type\n   *   The target entity type for this display mode.\n   *\n   * @return $this\n   */\n  public function setTargetType($target_entity_type);\n\n  /**\n   * Gets the display mode description.\n   *\n   * @return string\n   *   The display mode description.\n   */\n  public function getDescription(): string;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/EntityDisplayModeInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityDisplayModeInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ConvertTokens\nSource file: <source_file>\nFile name hint: ConvertTokens.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\user\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Plugin to replace !tokens with [tokens].\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess(\n  id: \"convert_tokens\",\n  handle_multiples: TRUE,\n)]\nclass ConvertTokens extends ProcessPluginBase {\n\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    $tokens = [\n      '!site' => '[site:name]',\n      '!username' => '[user:name]',\n      '!mailto' => '[user:mail]',\n      '!login_uri' => '[site:login-url]',\n      '!uri_brief' => '[site:url-brief]',\n      '!edit_uri' => '[user:edit-url]',\n      '!login_url' => '[user:one-time-login-url]',\n      '!uri' => '[site:url]',\n      '!date' => '[date:medium]',\n      '!password' => '',\n    ];\n\n    // Given that our source is a database column that could hold a NULL\n    // value, sometimes that filters down to here. str_replace() cannot\n    // handle NULLs as the subject, so we reset to an empty string.\n    if (is_null($value)) {\n      $value = '';\n    }\n\n    if (is_string($value)) {\n      return str_replace(array_keys($tokens), $tokens, $value);\n    }\n    else {\n      throw new MigrateException('Value must be a string.');\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Plugin to replace !tokens with [tokens].\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess(\n  id: \"convert_tokens\",\n  handle_multiples: TRUE,\n)]\nclass ConvertTokens extends ProcessPluginBase {\n\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    $tokens = [\n      '!site' => '[site:name]',\n      '!username' => '[user:name]',\n      '!mailto' => '[user:mail]',\n      '!login_uri' => '[site:login-url]',\n      '!uri_brief' => '[site:url-brief]',\n      '!edit_uri' => '[user:edit-url]',\n      '!login_url' => '[user:one-time-login-url]',\n      '!uri' => '[site:url]',\n      '!date' => '[date:medium]',\n      '!password' => '',\n    ];\n\n    // Given that our source is a database column that could hold a NULL\n    // value, sometimes that filters down to here. str_replace() cannot\n    // handle NULLs as the subject, so we reset to an empty string.\n    if (is_null($value)) {\n      $value = '';\n    }\n\n    if (is_string($value)) {\n      return str_replace(array_keys($tokens), $tokens, $value);\n    }\n    else {\n      throw new MigrateException('Value must be a string.');\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/migrate/process/ConvertTokens.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConvertTokens", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ConfigurableLanguageManagerInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\language\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Language\\LanguageInterface\n  - Drupal\\Core\\Language\\LanguageManagerInterface\n- Ensure these methods exist where relevant:\n  - getDefinedLanguageTypes()\n  - getLanguageConfigOverride()\n  - getLanguageConfigOverrideStorage()\n  - getNegotiatedLanguageMethod()\n  - getNegotiator()\n  - getStandardLanguageListWithoutConfigured()\n  - rebuildServices()\n  - saveLanguageTypesConfiguration()\n  - setNegotiator()\n  - updateLockedLanguageWeights()", "output": "<?php\n\nnamespace Drupal\\language;\n\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\n\n/**\n * Common interface for language negotiation services.\n */\ninterface ConfigurableLanguageManagerInterface extends LanguageManagerInterface {\n\n  /**\n   * Rebuild the container to register services needed on multilingual sites.\n   */\n  public static function rebuildServices();\n\n  /**\n   * Returns the language negotiator.\n   *\n   * @return \\Drupal\\language\\LanguageNegotiatorInterface\n   *   The language negotiator.\n   */\n  public function getNegotiator();\n\n  /**\n   * Injects the language negotiator.\n   *\n   * @param \\Drupal\\language\\LanguageNegotiatorInterface $negotiator\n   *   The language negotiator.\n   */\n  public function setNegotiator(LanguageNegotiatorInterface $negotiator);\n\n  /**\n   * Returns all the defined language types including fixed ones.\n   *\n   * A language type maybe configurable or fixed. A fixed language type is a\n   * type whose language negotiation methods are module-defined and not altered\n   * through the user interface.\n   *\n   * @return array\n   *   An array of language type machine names.\n   */\n  public function getDefinedLanguageTypes();\n\n  /**\n   * Stores language types configuration.\n   *\n   * @param array $config\n   *   An indexed array with the following keys_\n   *   - configurable: an array of configurable language type names.\n   *   - all: an array of all the defined language type names.\n   */\n  public function saveLanguageTypesConfiguration(array $config);\n\n  /**\n   * Updates locked system language weights.\n   */\n  public function updateLockedLanguageWeights();\n\n  /**\n   * Gets a language config override object.\n   *\n   * @param string $langcode\n   *   The language code for the override.\n   * @param string $name\n   *   The language configuration object name.\n   *\n   * @return \\Drupal\\language\\Config\\LanguageConfigOverride\n   *   The language config override object.\n   */\n  public function getLanguageConfigOverride($langcode, $name);\n\n  /**\n   * Gets a language configuration override storage object.\n   *\n   * @param string $langcode\n   *   The language code for the override.\n   *\n   * @return \\Drupal\\Core\\Config\\StorageInterface\n   *   A storage object to use for reading and writing the\n   *   configuration override.\n   */\n  public function getLanguageConfigOverrideStorage($langcode);\n\n  /**\n   * Returns the standard language list excluding already configured languages.\n   *\n   * @return array\n   *   A list of standard language names keyed by langcode.\n   */\n  public function getStandardLanguageListWithoutConfigured();\n\n  /**\n   * Gets the negotiated language method ID.\n   *\n   * @param string $type\n   *   (optional) The language type; e.g., the interface or the content\n   *   language.\n   *\n   * @return string|null\n   *   The negotiated language method ID.\n   */\n  public function getNegotiatedLanguageMethod($type = LanguageInterface::TYPE_INTERFACE);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/language/src/ConfigurableLanguageManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfigurableLanguageManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Code Reduction Analysis", "input": "", "output": "# Code Reduction Analysis\n\n## Overview\nAnalysis of Apidog tools and features that can eliminate or reduce custom code requirements for the api_normalization integration.\n\n## Tools Analysis\n\n### 1. Apidog CLI Tool\n- **Status**: \u274c NOT AVAILABLE\n- **Code Reduction Potential**: High (if available)\n- **Impact**: Must implement custom HTTP client\n- **Custom Code Required**: HTTP client, authentication, error handling, retry logic\n\n### 2. Apidog MCP Server\n- **Status**: \u26a0\ufe0f MENTIONED BUT UNVERIFIED\n- **Code Reduction Potential**: Medium-High (if available)\n- **Impact**: Could use standardized MCP client instead of custom HTTP client\n- **Custom Code Required**: MCP client integration (less than REST API)\n\n### 3. Apidog REST API\n- **Status**: \u2705 AVAILABLE (OpenAPI access tokens confirmed)\n- **Code Reduction Potential**: Medium\n- **Impact**: Standard HTTP integration, but requires full client implementation\n- **Custom Code Required**: HTTP client, authentication, endpoint methods, error handling\n\n### 4. Apidog Webhooks\n- **Status**: \u2753 UNKNOWN\n- **Code Reduction Potential**: High (if available)\n- **Impact**: Could eliminate polling/scheduled sync code\n- **Custom Code Required**: Webhook handler (minimal if available)\n\n### 5. Apidog Code Generation\n- **Status**: \u2705 AVAILABLE (130+ languages)\n- **Code Reduction Potential**: High\n- **Impact**: Eliminates schema-to-code conversion code\n- **Custom Code Required**: Code generation API client (if API available)\n\n### 6. Apidog Mock Server API\n- **Status**: \u2705 AVAILABLE (cloud and self-hosted)\n- **Code Reduction Potential**: High\n- **Impact**: Eliminates custom mock server code\n- **Custom Code Required**: Mock server API client (if API available)\n\n### 7. Apidog Test Execution API\n- **Status**: \u26a0\ufe0f LIKELY AVAILABLE (CI/CD integration exists)\n- **Code Reduction Potential**: High\n- **Impact**: Eliminates custom test runner code\n- **Custom Code Required**: Test execution API client (if API available)\n\n### 8. Apidog Documentation API\n- **Status**: \u26a0\ufe0f LIKELY AVAILABLE (documentation features exist)\n- **Code Reduction Potential**: Medium\n- **Impact**: Eliminates custom documentation generation\n- **Custom Code Required**: Documentation API client (if API available)\n\n## Code Reduction Summary\n\n### High Impact Tools (If Available)\n1. **Webhooks** - Eliminates polling code (saves ~200-300 lines)\n2. **Code Generation API** - Eliminates schema-to-code conversion (saves ~500+ lines)\n3. **Mock Server API** - Eliminates custom mock server (saves ~300-400 lines)\n4. **Test Execution API** - Eliminates custom test runner (saves ~200-300 lines)\n\n### Medium Impact Tools\n1. **REST API** - Standard integration but requires full client (saves ~100-200 lines vs custom)\n2. **MCP Server** - Standardized integration (saves ~150-200 lines vs REST API)\n3. **Documentation API** - Eliminates custom doc generation (saves ~200-300 lines)\n\n### Low Impact Tools\n1. **CLI Tool** - Not available (no reduction possible)\n\n## Implementation Strategy\n\n### Phase 1: Core Integration (Minimal Custom Code)\n- **Method**: REST API with OpenAPI access tokens\n- **Custom Code**: HTTP client (~300-400 lines)\n- **Benefits**: Reliable, documented, standard approach\n\n### Phase 2: Enhanced Features (Reduce Custom Code)\n- **If Webhooks Available**: Replace polling with webhooks (~200 lines saved)\n- **If Code Generation API Available**: Use Apidog code generation (~500 lines saved)\n- **If Mock Server API Available**: Use Apidog mock servers (~300 lines saved)\n- **If Test Execution API Available**: Use Apidog test execution (~200 lines saved)\n\n## Estimated Code Reduction\n\n### Without Apidog Tools\n- **Total Custom Code**: ~2000-3000 lines\n- **Components**: HTTP client, polling, code generation, mock server, test runner, documentation\n\n### With Apidog Tools (If All Available)\n- **Total Custom Code**: ~500-800 lines\n- **Components**: HTTP client (minimal), webhook handler, API clients for features\n- **Reduction**: ~70-75% less custom code\n\n### Realistic Scenario (REST API + Some Features)\n- **Total Custom Code**: ~1000-1500 lines\n- **Components**: HTTP client, API clients for available features\n- **Reduction**: ~40-50% less custom code\n\n## Recommendations\n\n### Immediate (Phase 1)\n1. **Use REST API** - Most reliable method\n2. **Implement HTTP Client** - Required for all integrations\n3. **Support File Import** - Fallback method\n\n### Future (Phase 2)\n1. **Verify Webhooks** - If available, implement to eliminate polling\n2. **Verify Code Generation API** - If available, use instead of custom generation\n3. **Verify Mock Server API** - If available, use instead of custom mocks\n4. **Verify Test Execution API** - If available, use instead of custom test runner\n\n### Code Reduction Priority\n1. **Webhooks** (highest priority - eliminates polling)\n2. **Code Generation API** (high priority - large code savings)\n3. **Mock Server API** (medium priority - good savings)\n4. **Test Execution API** (medium priority - good savings)\n5. **Documentation API** (low priority - nice to have)\n\n## Conclusion\n\nApidog provides several tools that can significantly reduce custom code requirements. The REST API is confirmed available and should be the primary integration method. Additional features (webhooks, code generation, mock servers, testing) can provide substantial code reduction if their APIs are available and accessible in the free tier.\n\n**Estimated Overall Code Reduction**: 40-75% depending on which Apidog APIs are available and accessible.\n", "metadata": {"source": "repos/api_normalization/modules/apidog_integration/docs/CODE_REDUCTION_ANALYSIS.md", "type": "doc_summary", "topic": "Code Reduction Analysis"}}
{"instruction": "Show me the implementation of the interface DisplayRouterInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\display;\n\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Defines an interface for displays that can collect routes.\n *\n * In addition to implementing the interface, specify 'uses_route' in the\n * plugin definition.\n */\ninterface DisplayRouterInterface extends DisplayPluginInterface {\n\n  /**\n   * Adds the route entry of a view to the collection.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   A collection of routes that should be registered for this resource.\n   */\n  public function collectRoutes(RouteCollection $collection);\n\n  /**\n   * Alters a collection of routes and replaces definitions to the view.\n   *\n   * Most of the collections won't have the needed route, so by the return value\n   * the method can specify to break the search.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   The route collection.\n   *\n   * @return array\n   *   Returns a list of \"$view_id.$display_id\" elements which got overridden.\n   */\n  public function alterRoutes(RouteCollection $collection);\n\n  /**\n   * Generates a URL to this display.\n   *\n   * @return \\Drupal\\Core\\Url\n   *   A URL object for the display.\n   */\n  public function getUrlInfo();\n\n  /**\n   * Returns the route name for the display.\n   *\n   * The default route name for a display is views.$view_id.$display_id. Some\n   * displays may override existing routes; in these cases, the route that is\n   * overridden is returned instead.\n   *\n   * @return string\n   *   The name of the route\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::alterRoutes()\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::getAlteredRouteNames()\n   */\n  public function getRouteName();\n\n  /**\n   * Returns the list of routes overridden by Views.\n   *\n   * @return string[]\n   *   An array of overridden route names. The keys are in the form\n   *   view_id.display_id and the values are the route names.\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::alterRoutes()\n   */\n  public function getAlteredRouteNames();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/display/DisplayRouterInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DisplayRouterInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for the Appearance page.\n *\n * Available variables:\n * - attributes: HTML attributes for the main container.\n * - theme_groups: A list of theme groups. Each theme group contains:\n *   - attributes: HTML attributes specific to this theme group.\n *   - title: Title for the theme group.\n *   - state: State of the theme group, e.g. installed or uninstalled.\n *   - themes: A list of themes within the theme group. Each theme contains:\n *     - attributes: HTML attributes specific to this theme.\n *     - screenshot: A screenshot representing the theme.\n *     - description: Description of the theme.\n *     - name: Theme name.\n *     - version: The theme's version number.\n *     - is_default: Boolean indicating whether the theme is the default theme\n *       or not.\n *     - is_admin: Boolean indicating whether the theme is the admin theme or\n *       not.\n *     - notes: Identifies what context this theme is being used in, e.g.,\n *       default theme, admin theme.\n *     - incompatible: Text describing any compatibility issues.\n *     - module_dependencies: A list of modules that this theme requires.\n *     - operations: A list of operation links, e.g., Settings, Enable, Disable,\n *       etc. these links should only be displayed if the theme is compatible.\n *\n * @see \\Drupal\\system\\Theme\\SystemAdminThemePreprocess::preprocessSystemThemesPage()\n *\n * @ingroup themeable\n */\n#}\n<div{{ attributes }}>\n  {% for theme_group in theme_groups %}\n    {%\n      set theme_group_classes = [\n        'system-themes-list',\n        'system-themes-list-' ~ theme_group.state,\n        'clearfix',\n      ]\n    %}\n    <div{{ theme_group.attributes.addClass(theme_group_classes) }}>\n      <h2 class=\"system-themes-list__header\">{{ theme_group.title }}</h2>\n      {% for theme in theme_group.themes %}\n        {%\n          set theme_classes = [\n            theme.is_default ? 'theme-default',\n            theme.is_admin ? 'theme-admin',\n            'theme-selector',\n            'clearfix',\n          ]\n        %}\n        <div{{ theme.attributes.addClass(theme_classes) }}>\n          {% if theme.screenshot %}\n            {{ theme.screenshot }}\n          {% endif %}\n          <div class=\"theme-info\">\n            <h3 class=\"theme-info__header\">\n              {{- theme.name }} {{ theme.version -}}\n              {% if theme.notes %}\n                ({{ theme.notes|safe_join(', ') }})\n              {%- endif -%}\n            </h3>\n            <div class=\"theme-info__description\">{{ theme.description }}</div>\n            {% if theme.module_dependencies %}\n              <div class=\"theme-info__requires\">\n                {{ 'Requires: @module_dependencies'|t({'@module_dependencies': theme.module_dependencies|render}) }}\n              </div>\n            {% endif %}\n            {# Display operation links if the theme is compatible. #}\n            {% if theme.incompatible %}\n              <div class=\"incompatible\">{{ theme.incompatible }}</div>\n            {% else %}\n              {{ theme.operations }}\n            {% endif %}\n          </div>\n        </div>\n      {% endfor %}\n    </div>\n  {% endfor %}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/modules/system/templates/system-themes-page.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Psr7RequestValueResolver\nSource file: <source_file>\nFile name hint: Psr7RequestValueResolver.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Controller\\ArgumentResolver;\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ValueResolverInterface;\nuse Symfony\\Component\\HttpKernel\\ControllerMetadata\\ArgumentMetadata;\n\n/**\n * Yields a PSR7 request object based on the request object passed along.\n */\nfinal class Psr7RequestValueResolver implements ValueResolverInterface {\n\n  /**\n   * The PSR-7 converter.\n   *\n   * @var \\Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface\n   */\n  protected $httpMessageFactory;\n\n  /**\n   * Constructs a new ControllerResolver.\n   *\n   * @param \\Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface $http_message_factory\n   *   The PSR-7 converter.\n   */\n  public function __construct(HttpMessageFactoryInterface $http_message_factory) {\n    $this->httpMessageFactory = $http_message_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolve(Request $request, ArgumentMetadata $argument): array {\n    return $argument->getType() === ServerRequestInterface::class ? [$this->httpMessageFactory->createRequest($request)] : [];\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Controller\\ArgumentResolver;\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ValueResolverInterface;\nuse Symfony\\Component\\HttpKernel\\ControllerMetadata\\ArgumentMetadata;\n\n/**\n * Yields a PSR7 request object based on the request object passed along.\n */\nfinal class Psr7RequestValueResolver implements ValueResolverInterface {\n\n  /**\n   * The PSR-7 converter.\n   *\n   * @var \\Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface\n   */\n  protected $httpMessageFactory;\n\n  /**\n   * Constructs a new ControllerResolver.\n   *\n   * @param \\Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface $http_message_factory\n   *   The PSR-7 converter.\n   */\n  public function __construct(HttpMessageFactoryInterface $http_message_factory) {\n    $this->httpMessageFactory = $http_message_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolve(Request $request, ArgumentMetadata $argument): array {\n    return $argument->getType() === ServerRequestInterface::class ? [$this->httpMessageFactory->createRequest($request)] : [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/ArgumentResolver/Psr7RequestValueResolver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Psr7RequestValueResolver", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  enforced:\n    module:\n      - ai_image_crop\nid: ai_image_crop_crop_final__user_default\nlabel: 'Default user prompt for final crop selection'\ntype: ai_image_crop_crop_final\nprompt: 'Pick the best crop area from the proposals shown on this image. Choose the one that best frames the focus target.'\n", "metadata": {"source": "repos/ai_image_crop/config/install/ai.ai_prompt.ai_image_crop_crop_final__user_default.yml", "type": "yaml_reference", "topic": "ai.ai prompt.ai image crop crop final  user default"}}
{"instruction": "Show me the implementation of the class Idea in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Idea node processor for BPMN-like conceptual flow diagrams.\n *\n * This node type allows users to chain conceptual ideas together without\n * committing to specific implementations. Useful for brainstorming,\n * planning workflows, and creating high-level process diagrams.\n */\n#[FlowDropNodeProcessor(\n  id: \"idea\",\n  label: new TranslatableMarkup(\"Idea\"),\n  description: \"Conceptual idea node for BPMN-like flow diagrams\",\n  version: \"1.0.0\"\n)]\nfinal class Idea extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Idea nodes are conceptual - no required inputs.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    // Idea nodes are primarily visual/conceptual.\n    // They pass through their configuration as output data.\n    return [\n      \"instanceTitle\" => $params->get(\"instanceTitle\", \"New Idea\"),\n      \"instanceDescription\" => $params->get(\"instanceDescription\", \"\"),\n      \"icon\" => $params->get(\"icon\", \"mdi:lightbulb-outline\"),\n      \"color\" => $params->get(\"color\", \"#6366f1\"),\n      \"enableLeftPort\" => $params->get(\"enableLeftPort\", TRUE),\n      \"enableRightPort\" => $params->get(\"enableRightPort\", TRUE),\n      \"enableTopPort\" => $params->get(\"enableTopPort\", FALSE),\n      \"enableBottomPort\" => $params->get(\"enableBottomPort\", FALSE),\n      \"message\" => \"Idea node content available for reference\",\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"instanceTitle\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Title\",\n          \"description\" => \"The main title or name of your idea\",\n          \"default\" => \"New Idea\",\n          \"x-display-order\" => -2,\n        ],\n        \"instanceDescription\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Description\",\n          \"description\" => \"Detailed description of the idea or concept\",\n          \"format\" => \"multiline\",\n          \"default\" => \"Describe your idea here...\",\n          \"x-display-order\" => -1,\n        ],\n        \"icon\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Icon\",\n          \"description\" => \"Custom icon for the idea (Iconify format, e.g., mdi:brain)\",\n          \"default\" => \"mdi:lightbulb-outline\",\n        ],\n        \"color\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Accent Color\",\n          \"description\" => \"Accent color for visual grouping (hex format)\",\n          \"default\" => \"#6366f1\",\n        ],\n        \"enableLeftPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Left Port\",\n          \"description\" => \"Show connection port on the left side (input)\",\n          \"default\" => TRUE,\n        ],\n        \"enableRightPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Right Port\",\n          \"description\" => \"Show connection port on the right side (output)\",\n          \"default\" => TRUE,\n        ],\n        \"enableTopPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Top Port\",\n          \"description\" => \"Show connection port on the top (input)\",\n          \"default\" => FALSE,\n        ],\n        \"enableBottomPort\" => [\n          \"type\" => \"boolean\",\n          \"title\" => \"Enable Bottom Port\",\n          \"description\" => \"Show connection port on the bottom (output)\",\n          \"default\" => FALSE,\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/Idea.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Idea", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: WorkspacesLazyBuilder\nSource file: <source_file>\nFile name hint: WorkspacesLazyBuilder.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\navigation;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Routing\\RedirectDestinationTrait;\nuse Drupal\\Core\\Security\\Attribute\\TrustedCallback;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\workspaces\\WorkspaceManagerInterface;\n\n/**\n * Defines a service for workspaces #lazy_builder callbacks.\n *\n * @internal\n */\nfinal class WorkspacesLazyBuilder {\n\n  use RedirectDestinationTrait;\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected WorkspaceManagerInterface $workspaceManager,\n  ) {}\n\n  /**\n   * Lazy builder callback for rendering navigation links.\n   *\n   * @return array\n   *   A renderable array as expected by the renderer service.\n   */\n  #[TrustedCallback]\n  public function renderNavigationLinks(): array {\n    $active_workspace = $this->workspaceManager->getActiveWorkspace();\n\n    $url = Url::fromRoute('entity.workspace.collection', [], ['query' => $this->getDestinationArray()]);\n    $url->setOption('attributes', [\n      'class' => [\n        $active_workspace ? 'toolbar-button--workspaces' : 'toolbar-button--workspaces--live',\n        'use-ajax',\n      ],\n      'data-dialog-type' => 'dialog',\n      'data-dialog-renderer' => 'off_canvas_top',\n      'data-dialog-options' => Json::encode([\n        'height' => 161,\n        'classes' => [\n          'ui-dialog' => 'workspaces-dialog',\n        ],\n      ]),\n    ]);\n\n    return [\n      '#theme' => 'navigation_menu',\n      '#title' => $this->t('Workspace'),\n      '#items' => [\n        [\n          'title' => $active_workspace ? $active_workspace->label() : $this->t('Live'),\n          'url' => $url,\n          'class' => 'workspaces',\n          'icon' => [\n            'icon_id' => 'workspaces',\n          ],\n        ],\n      ],\n      '#attached' => [\n        'library' => [\n          'navigation/internal.navigation-workspaces',\n          'workspaces/drupal.workspaces_ui.off-canvas',\n        ],\n      ],\n      '#cache' => [\n        'max-age' => 0,\n      ],\n    ];\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\navigation;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Routing\\RedirectDestinationTrait;\nuse Drupal\\Core\\Security\\Attribute\\TrustedCallback;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\workspaces\\WorkspaceManagerInterface;\n\n/**\n * Defines a service for workspaces #lazy_builder callbacks.\n *\n * @internal\n */\nfinal class WorkspacesLazyBuilder {\n\n  use RedirectDestinationTrait;\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected WorkspaceManagerInterface $workspaceManager,\n  ) {}\n\n  /**\n   * Lazy builder callback for rendering navigation links.\n   *\n   * @return array\n   *   A renderable array as expected by the renderer service.\n   */\n  #[TrustedCallback]\n  public function renderNavigationLinks(): array {\n    $active_workspace = $this->workspaceManager->getActiveWorkspace();\n\n    $url = Url::fromRoute('entity.workspace.collection', [], ['query' => $this->getDestinationArray()]);\n    $url->setOption('attributes', [\n      'class' => [\n        $active_workspace ? 'toolbar-button--workspaces' : 'toolbar-button--workspaces--live',\n        'use-ajax',\n      ],\n      'data-dialog-type' => 'dialog',\n      'data-dialog-renderer' => 'off_canvas_top',\n      'data-dialog-options' => Json::encode([\n        'height' => 161,\n        'classes' => [\n          'ui-dialog' => 'workspaces-dialog',\n        ],\n      ]),\n    ]);\n\n    return [\n      '#theme' => 'navigation_menu',\n      '#title' => $this->t('Workspace'),\n      '#items' => [\n        [\n          'title' => $active_workspace ? $active_workspace->label() : $this->t('Live'),\n          'url' => $url,\n          'class' => 'workspaces',\n          'icon' => [\n            'icon_id' => 'workspaces',\n          ],\n        ],\n      ],\n      '#attached' => [\n        'library' => [\n          'navigation/internal.navigation-workspaces',\n          'workspaces/drupal.workspaces_ui.off-canvas',\n        ],\n      ],\n      '#cache' => [\n        'max-age' => 0,\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/navigation/src/WorkspacesLazyBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WorkspacesLazyBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Gitpod", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [DrupalPod](/docs/develop/development-tools/drupalpod)\n\n* [DrupalPod + Drupal Forge](/docs/develop/development-tools/drupalpod/drupalpod-drupal-forge)\n* [Getting Started](/docs/develop/development-tools/drupalpod/getting-started)\n* [Gitpod](/docs/develop/development-tools/drupalpod/gitpod)\n* [Troubleshooting/FAQ](/docs/7/modules/drupalpod/troubleshootingfaq)\n\n# Gitpod\n\nLast [updated](/node/3374767/discuss) on\n\n15 July 2023\n\nThis documentation **needs work**. See \"Help improve this page\" in the sidebar.\n\nDrupalpod runs on Gitpod, a [cloud development environment](https://www.gitpod.io/cde) that allows developers to write, review, and collaborate on code directly from a web browser. It provides a fully functional development environment that is pre-configured and ready to use, eliminating the need for local setup and configuration.\n\nGitpod leverages the power of Docker containers to create isolated development environments for each project. When you open a project in Gitpod, it automatically spins up a container with all the necessary tools, dependencies, and configurations specified in a dev configuration file (`.gitpod.yml`) or inferred from the project.\n\n## Help improve this page\n\n**Page status:**  Needs work\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3374767/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283374767%29%20Gitpod) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/development-tools/drupalpod/gitpod.md", "type": "doc_summary", "topic": "Gitpod"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  locale.skip_procedural_hook_scan: true\n\nservices:\n  _defaults:\n    autoconfigure: true\n  locale.default.config.storage:\n    class: Drupal\\locale\\LocaleDefaultConfigStorage\n    arguments: ['@config.storage', '@language_manager', '%install_profile%']\n    public: false\n  Drupal\\locale\\LocaleDefaultConfigStorage: '@locale.default.config.storage'\n  locale.config_manager:\n    class: Drupal\\locale\\LocaleConfigManager\n    arguments: ['@config.storage', '@locale.storage', '@config.factory', '@config.typed', '@language_manager', '@locale.default.config.storage', '@config.manager']\n  Drupal\\locale\\LocaleConfigManager: '@locale.config_manager'\n  locale.storage:\n    class: Drupal\\locale\\StringDatabaseStorage\n    arguments: ['@database']\n    tags:\n      - { name: backend_overridable }\n  Drupal\\locale\\StringStorageInterface: '@locale.storage'\n  locale.project:\n    class: Drupal\\locale\\LocaleProjectStorage\n    arguments: ['@keyvalue']\n  Drupal\\locale\\LocaleProjectStorageInterface: '@locale.project'\n  locale.plural.formula:\n    class: Drupal\\locale\\PluralFormula\n    arguments: ['@language_manager', '@state']\n  Drupal\\locale\\PluralFormulaInterface: '@locale.plural.formula'\n  string_translator.locale.lookup:\n    class: Drupal\\locale\\LocaleTranslation\n    arguments: ['@locale.storage', '@cache.default', '@lock', '@config.factory', '@language_manager', '@request_stack']\n    tags:\n      - { name: string_translator }\n      - { name: needs_destruction }\n  stream_wrapper.translations:\n    class: Drupal\\locale\\StreamWrapper\\TranslationsStream\n    tags:\n      - { name: stream_wrapper, scheme: translations }\n  locale.config_subscriber:\n    class: Drupal\\locale\\LocaleConfigSubscriber\n    arguments: ['@config.factory', '@locale.config_manager']\n  locale.locale_translation_cache_tag:\n    class: Drupal\\locale\\EventSubscriber\\LocaleTranslationCacheTag\n    arguments: ['@cache_tags.invalidator']\n  Drupal\\locale\\EventSubscriber\\ConfigSubscriber:\n    autowire: true\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/locale.services.yml", "type": "yaml_reference", "topic": "locale.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "dependencies: {  }\nid: a_or_b\nlabel: A/B\ndescription: 'Simple boolean gateway for A/B use case'\ncategory: logic\nicon: 'mdi:ab-testing'\nplugin_version: 1.0.0\nenabled: true\nparameters:\n  branches:\n    configurable: true\n    connectable: false\n    required: false\n    default:\n      -\n        name: A\n        value: a\n      -\n        name: B\n        value: b\n  weight_a:\n    configurable: false\n    connectable: false\n    required: false\n    default: 50.0\n  weight_b:\n    configurable: false\n    connectable: false\n    required: false\n    default: 50.0\noutputs: {  }\ntags: {  }\nexecutor_plugin: 'flowdrop_node_processor:a_or_b'\nvisual_type: gateway\nsupported_visual_types:\n  - gateway\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/config/install/flowdrop_node_type.flowdrop_node_type.a_or_b.yml", "type": "yaml_reference", "topic": "flowdrop node type.flowdrop node type.a or b"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * FlowDrop Job List Component\n *\n * Displays a list of jobs within a pipeline.\n *\n * Available variables:\n * - jobs: Array of job items\n *   - id: Job ID\n *   - label: Job name\n *   - url: Link to job detail\n *   - status: Job status\n *   - node_type: Node type name\n *   - node_type_url: Link to node type\n *   - duration: Execution duration\n *   - error_message: Error if failed\n */\n#}\n\n{% set status_map = {\n  'pending': {'variant': 'warning', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z\" clip-rule=\"evenodd\"/></svg>'},\n  'running': {'variant': 'info', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0v2.43l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z\" clip-rule=\"evenodd\"/></svg>'},\n  'completed': {'variant': 'success', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z\" clip-rule=\"evenodd\"/></svg>'},\n  'failed': {'variant': 'error', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z\" clip-rule=\"evenodd\"/></svg>'},\n  'cancelled': {'variant': 'neutral', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM6.75 9.25a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z\" clip-rule=\"evenodd\"/></svg>'},\n  'skipped': {'variant': 'neutral', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM6.75 6.75a.75.75 0 000 1.5h2.69l-3.22 3.22a.75.75 0 101.06 1.06l3.22-3.22v2.69a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5z\" clip-rule=\"evenodd\"/></svg>'}\n} %}\n\n<div class=\"fd-job-list\">\n  {% for job in jobs %}\n    {% set config = status_map[job.status]|default({'variant': 'neutral', 'icon': ''}) %}\n\n    <div class=\"fd-job-list__item fd-job-list__item--{{ config.variant }}\">\n      <div class=\"fd-job-list__status-icon\" aria-label=\"{{ job.status|capitalize }}\">\n        {{ config.icon|raw }}\n      </div>\n\n      <div class=\"fd-job-list__content\">\n        <div class=\"fd-job-list__header\">\n          <a href=\"{{ job.url }}\" class=\"fd-job-list__title\">{{ job.label }}</a>\n          {% if job.node_type %}\n            <span class=\"fd-job-list__node-type\">\n              {% if job.node_type_url %}\n                <a href=\"{{ job.node_type_url }}\">{{ job.node_type }}</a>\n              {% else %}\n                {{ job.node_type }}\n              {% endif %}\n            </span>\n          {% endif %}\n        </div>\n\n        {% if job.error_message %}\n          <div class=\"fd-job-list__error\">{{ job.error_message }}</div>\n        {% endif %}\n      </div>\n\n      <div class=\"fd-job-list__meta\">\n        {% if job.duration %}\n          <span class=\"fd-job-list__duration\" title=\"Duration\">\n            <svg viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\n              <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z\" clip-rule=\"evenodd\"/>\n            </svg>\n            {{ job.duration }}\n          </span>\n        {% endif %}\n\n        <span class=\"fd-job-list__badge fd-job-list__badge--{{ config.variant }}\">\n          {{ job.status|capitalize }}\n        </span>\n      </div>\n\n      <a href=\"{{ job.url }}\" class=\"fd-job-list__arrow\" aria-label=\"View job details\">\n        <svg viewBox=\"0 0 20 20\" fill=\"currentColor\">\n          <path fill-rule=\"evenodd\" d=\"M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z\" clip-rule=\"evenodd\"/>\n        </svg>\n      </a>\n    </div>\n  {% endfor %}\n</div>\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/job-list/job-list.twig", "type": "twig_reference"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set attributes = attributes.addClass('offcanvas-' ~ variant|default('start')) %}\n\n{% set offcanvas_id = offcanvas_id|default(\"offcanvas-\" ~ random()) %}\n{% set heading_level = heading_level|default(5) %}\n\n{% set attributes = attributes\n  .addClass('offcanvas')\n  .setAttribute('tabindex', '-1')\n  .setAttribute('id', offcanvas_id)\n%}\n\n{% set attributes = responsive ? attributes.addClass(responsive).removeClass('offcanvas') : attributes %}\n{% set attributes = backdrop ? attributes.setAttribute('data-bs-backdrop', backdrop) : attributes %}\n{% set attributes = scroll ? attributes.setAttribute('data-bs-scroll', 'true') : attributes %}\n{% set attributes = title ? attributes.setAttribute('aria-labelledby', 'label_' ~ offcanvas_id) : attributes %}\n\n{% set header_attributes = create_attribute(header_attributes|default({})) %}\n\n<div{{ attributes }}>\n  <div{{ header_attributes.addClass('offcanvas-header') }}>\n    {% if title %}\n      {% set heading_attributes = create_attribute(heading_attributes|default({})) %}\n      <h{{ heading_level }}{{ heading_attributes.addClass('offcanvas-title').setAttribute('id', 'label_' ~ offcanvas_id) }}>{{ title }}</h{{ heading_level }}>\n    {% endif %}\n    {{ include('bootstrap_components:close_button', {\n      attributes: {\n        'data-bs-dismiss': 'offcanvas',\n        'data-bs-target': '#' ~ offcanvas_id,\n      }|to_attributes,\n    }, with_context = false) }}\n  </div>\n\n  {% if body %}\n    {% set body_attributes = create_attribute(body_attributes|default({})) %}\n    <div{{ body_attributes.addClass('offcanvas-body') }}>\n      {{ body }}\n    </div>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/bootstrap_components/components/offcanvas/offcanvas.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: WorkflowController\nSource file: <source_file>\nFile name hint: WorkflowController.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_ui_agents\\Controller\\Api;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\flowdrop_ui_agents\\Service\\AgentWorkflowMapper;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * API controller for FlowDrop workflow operations.\n *\n * Provides endpoints for loading workflows with different expansion modes.\n */\nfinal class WorkflowController extends ControllerBase {\n\n  /**\n   * The agent workflow mapper service.\n   */\n  protected AgentWorkflowMapper $agentWorkflowMapper;\n\n  /**\n   * Constructs the controller.\n   */\n  public function __construct(AgentWorkflowMapper $agentWorkflowMapper) {\n    $this->agentWorkflowMapper = $agentWorkflowMapper;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('flowdrop_ui_agents.agent_workflow_mapper')\n    );\n  }\n\n  /**\n   * Gets workflow data for an agent with specified expansion mode.\n   *\n   * @param string $agent_id\n   *   The AI Agent ID.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   JSON response with workflow data.\n   */\n  public function getWorkflow(string $agent_id, Request $request): JsonResponse {\n    $expansion = $request->query->get('expansion', 'expanded');\n\n    // Validate expansion mode.\n    $validModes = ['expanded', 'grouped', 'collapsed'];\n    if (!in_array($expansion, $validModes, TRUE)) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => sprintf('Invalid expansion mode \"%s\". Valid modes: %s', $expansion, implode(', ', $validModes)),\n      ], 400);\n    }\n\n    // Load the agent.\n    $storage = $this->entityTypeManager()->getStorage('ai_agent');\n    $agent = $storage->load($agent_id);\n\n    if (!$agent instanceof ConfigEntityInterface) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => sprintf('Agent \"%s\" not found', $agent_id),\n      ], 404);\n    }\n\n    try {\n      // Convert agent to workflow with expansion mode.\n      $workflow = $this->agentWorkflowMapper->agentToWorkflow($agent, $expansion);\n\n      return new JsonResponse([\n        'success' => TRUE,\n        'data' => $workflow,\n        'expansion' => $expansion,\n      ]);\n    }\n    catch (\\Exception $e) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => 'Failed to generate workflow: ' . $e->getMessage(),\n      ], 500);\n    }\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_ui_agents\\Controller\\Api;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\flowdrop_ui_agents\\Service\\AgentWorkflowMapper;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * API controller for FlowDrop workflow operations.\n *\n * Provides endpoints for loading workflows with different expansion modes.\n */\nfinal class WorkflowController extends ControllerBase {\n\n  /**\n   * The agent workflow mapper service.\n   */\n  protected AgentWorkflowMapper $agentWorkflowMapper;\n\n  /**\n   * Constructs the controller.\n   */\n  public function __construct(AgentWorkflowMapper $agentWorkflowMapper) {\n    $this->agentWorkflowMapper = $agentWorkflowMapper;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('flowdrop_ui_agents.agent_workflow_mapper')\n    );\n  }\n\n  /**\n   * Gets workflow data for an agent with specified expansion mode.\n   *\n   * @param string $agent_id\n   *   The AI Agent ID.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   JSON response with workflow data.\n   */\n  public function getWorkflow(string $agent_id, Request $request): JsonResponse {\n    $expansion = $request->query->get('expansion', 'expanded');\n\n    // Validate expansion mode.\n    $validModes = ['expanded', 'grouped', 'collapsed'];\n    if (!in_array($expansion, $validModes, TRUE)) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => sprintf('Invalid expansion mode \"%s\". Valid modes: %s', $expansion, implode(', ', $validModes)),\n      ], 400);\n    }\n\n    // Load the agent.\n    $storage = $this->entityTypeManager()->getStorage('ai_agent');\n    $agent = $storage->load($agent_id);\n\n    if (!$agent instanceof ConfigEntityInterface) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => sprintf('Agent \"%s\" not found', $agent_id),\n      ], 404);\n    }\n\n    try {\n      // Convert agent to workflow with expansion mode.\n      $workflow = $this->agentWorkflowMapper->agentToWorkflow($agent, $expansion);\n\n      return new JsonResponse([\n        'success' => TRUE,\n        'data' => $workflow,\n        'expansion' => $expansion,\n      ]);\n    }\n    catch (\\Exception $e) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => 'Failed to generate workflow: ' . $e->getMessage(),\n      ], 500);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop_ui_agents/src/Controller/Api/WorkflowController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WorkflowController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class CreateRedirect in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_redirect\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_redirect\\Service\\RedirectService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_redirect_create',\n  label: new TranslatableMarkup('Create Redirect'),\n  description: new TranslatableMarkup('Create a new URL redirect. This is a write operation.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'source' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Path'),\n      description: new TranslatableMarkup('The source path to redirect from (e.g., \"old-page\" or \"/old-page\").'),\n      required: TRUE,\n    ),\n    'destination' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Destination'),\n      description: new TranslatableMarkup('The destination path or URL to redirect to (e.g., \"/new-page\" or \"https://example.com\").'),\n      required: TRUE,\n    ),\n    'status_code' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Status Code'),\n      description: new TranslatableMarkup('HTTP redirect status code: 301 (permanent), 302 (temporary), 303, or 307. Default: 301.'),\n      required: FALSE,\n    ),\n    'language' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Language'),\n      description: new TranslatableMarkup('Language code for language-specific redirect (e.g., \"en\", \"de\"). Leave empty for language-neutral.'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'redirect' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Created Redirect'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateRedirect extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'redirect';\n\n\n  protected RedirectService $redirectService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->redirectService = $container->get('mcp_tools_redirect.redirect');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $source = $input['source'] ?? '';\n    $destination = $input['destination'] ?? '';\n    $statusCode = $input['status_code'] ?? 301;\n    $language = $input['language'] ?? NULL;\n\n    if (empty($source)) {\n      return ['success' => FALSE, 'error' => 'Source path is required.'];\n    }\n\n    if (empty($destination)) {\n      return ['success' => FALSE, 'error' => 'Destination is required.'];\n    }\n\n    return $this->redirectService->createRedirect($source, $destination, (int) $statusCode, $language);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_redirect/src/Plugin/tool/Tool/CreateRedirect.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateRedirect", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {}\nname: Categories\nvid: categories\ndescription: 'Categories migrated from WordPress.'\nweight: 0\n", "metadata": {"source": "repos/wp_drupal_migrate/config/install/taxonomy.vocabulary.categories.yml", "type": "yaml_reference", "topic": "taxonomy.vocabulary.categories"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ToolInputNormalizer.php\nTarget symbol: class ToolInputNormalizer\nNamespace: Drupal\\api_normalization\\Service\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ToolInputNormalizer.\n- Include required imports:\n  - Drupal\\Core\\Logger\\LoggerChannelInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - coerceType()\n  - isType()\n  - normalize()\n  - validate()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\Core\\Logger\\LoggerChannelInterface;\n\n/**\n * Normalizes and validates tool inputs from LLM outputs.\n */\nclass ToolInputNormalizer {\n\n  public function __construct(\n    private readonly SchemaRegistry $schemaRegistry,\n    private readonly LoggerChannelInterface $logger,\n  ) {}\n\n  /**\n   * Normalize LLM-generated arguments to match tool schema.\n   *\n   * @param array $llmOutput\n   *   Raw output from LLM (may have wrong types, missing fields).\n   * @param object $tool\n   *   The tool object.\n   *\n   * @return array\n   *   Normalized and validated arguments.\n   *\n   * @throws \\InvalidArgumentException\n   *   When validation fails.\n   */\n  public function normalize(array $llmOutput, object $tool): array {\n    $schema = $this->schemaRegistry->getSchema($tool);\n    $normalized = [];\n    $errors = [];\n\n    if (!isset($schema['paths'])) {\n      $this->logger->warning('No schema found for tool, skipping normalization');\n      return $llmOutput;\n    }\n\n    $requestBody = $schema['paths'][array_key_first($schema['paths'])]['post']['requestBody'] ?? NULL;\n    $properties = $requestBody['content']['application/json']['schema']['properties'] ?? [];\n    $required = $requestBody['content']['application/json']['schema']['required'] ?? [];\n\n    // Check required fields.\n    foreach ($required as $field) {\n      if (!isset($llmOutput[$field])) {\n        $errors[] = \"Required field '{$field}' is missing\";\n      }\n    }\n\n    // Normalize each property.\n    foreach ($properties as $key => $property) {\n      $value = $llmOutput[$key] ?? $property['default'] ?? NULL;\n\n      if ($value === NULL && in_array($key, $required)) {\n        // Already handled in required check.\n        continue;\n      }\n\n      // Type coercion.\n      $normalized[$key] = $this->coerceType($value, $property['type'] ?? 'string');\n\n      // Validation.\n      $validationError = $this->validate($normalized[$key], $property);\n      if ($validationError) {\n        $errors[] = \"Field '{$key}': {$validationError}\";\n      }\n    }\n\n    if (!empty($errors)) {\n      throw new \\InvalidArgumentException('Validation failed: ' . implode('; ', $errors));\n    }\n\n    return $normalized;\n  }\n\n  /**\n   * Coerce value to expected type.\n   */\n  protected function coerceType(mixed $value, string $type): mixed {\n    if ($value === NULL) {\n      return NULL;\n    }\n\n    return match ($type) {\n      'integer', 'int' => (int) $value,\n      'number', 'float' => (float) $value,\n      'boolean', 'bool' => (bool) $value,\n      'array' => is_array($value) ? $value : [$value],\n      'object' => is_array($value) ? (object) $value : $value,\n      default => (string) $value,\n    };\n  }\n\n  /**\n   * Validate value against property schema.\n   */\n  protected function validate(mixed $value, array $property): ?string {\n    // Enum validation.\n    if (isset($property['enum']) && !in_array($value, $property['enum'], TRUE)) {\n      return 'Value not in allowed enum values: ' . implode(', ', $property['enum']);\n    }\n\n    // Type validation.\n    $expectedType = $property['type'] ?? 'string';\n    if (!$this->isType($value, $expectedType)) {\n      return \"Expected type '{$expectedType}', got '\" . gettype($value) . \"'\";\n    }\n\n    // String length validation.\n    if ($expectedType === 'string' && isset($property['maxLength'])) {\n      if (strlen((string) $value) > $property['maxLength']) {\n        return \"String exceeds maxLength of {$property['maxLength']}\";\n      }\n    }\n\n    // Number range validation.\n    if (in_array($expectedType, ['integer', 'number']) && isset($property['minimum'])) {\n      if ($value < $property['minimum']) {\n        return \"Value below minimum of {$property['minimum']}\";\n      }\n    }\n\n    if (in_array($expectedType, ['integer', 'number']) && isset($property['maximum'])) {\n      if ($value > $property['maximum']) {\n        return \"Value above maximum of {$property['maximum']}\";\n      }\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Check if value matches type.\n   */\n  protected function isType(mixed $value, string $type): bool {\n    return match ($type) {\n      'string' => is_string($value),\n      'integer', 'int' => is_int($value),\n      'number', 'float' => is_numeric($value),\n      'boolean', 'bool' => is_bool($value),\n      'array' => is_array($value),\n      'object' => is_object($value) || is_array($value),\n      default => TRUE,\n    };\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/ToolInputNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ToolInputNormalizer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "dependencies: {  }\nid: boolean_gateway\nlabel: 'Boolean Gateway'\ndescription: 'Split execution paths based on conditions for workflow branching'\ncategory: logic\nicon: 'mdi:source-branch'\nplugin_version: 1.0.0\nenabled: true\nparameters:\n  branches:\n    configurable: true\n    connectable: false\n    required: false\n    default:\n      -\n        name: 'True'\n        value: true\n      -\n        name: 'False'\n        value: false\n  value:\n    configurable: false\n    connectable: true\n    required: false\n    default: false\noutputs: {  }\ntags: {  }\nexecutor_plugin: 'flowdrop_node_processor:boolean_gateway'\nvisual_type: gateway\nsupported_visual_types:\n  - gateway\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/config/install/flowdrop_node_type.flowdrop_node_type.boolean_gateway.yml", "type": "yaml_reference", "topic": "flowdrop node type.flowdrop node type.boolean gateway"}}
{"instruction": "Show me the implementation of the interface ExposedFormPluginInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\exposed_form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Plugin\\views\\ViewsPluginInterface;\n\n/**\n * @defgroup views_exposed_form_plugins Views exposed form plugins\n * @{\n * Plugins that handle validation, submission, and rendering of exposed forms.\n *\n * Exposed forms are used for filters, sorts, and pager settings that are\n * exposed to site visitors. Exposed form plugins handle the rendering,\n * validation, and submission of exposed forms, and may add additional form\n * elements.\n *\n * To define an Exposed Form Plugin in a module you need to:\n * - Implement\n *   \\Drupal\\views\\Plugin\\views\\exposed_form\\ExposedFormPluginInterface.\n * - Usually you will want to extend the\n *   \\Drupal\\views\\Plugin\\views\\exposed_form\\ExposedFormPluginBase class.\n * - Exposed form plugins are annotated with\n *   \\Drupal\\views\\Annotation\\ViewsExposedForm annotation. See the\n *   @link annotation Annotations topic @endlink for more information about\n *   annotations.\n * - They must be in namespace directory Plugin\\views\\exposed_form.\n */\n\n/**\n * Interface for exposed filter form plugins.\n *\n * Exposed form plugins handle the rendering, validation, and submission\n * of exposed forms, and may add additional form elements. These plugins can\n * also alter the view query. See\n * \\Drupal\\views\\Plugin\\views\\exposed_form\\InputRequired as an example of\n * that functionality.\n *\n * @see \\Drupal\\views\\Annotation\\ViewsExposedForm\n * @see \\Drupal\\views\\Plugin\\views\\exposed_form\\ExposedFormPluginBase\n */\ninterface ExposedFormPluginInterface extends ViewsPluginInterface {\n\n  /**\n   * Renders the exposed form.\n   *\n   * This method iterates over each handler configured to expose widgets\n   * to the end user and attach those widgets to the exposed form.\n   *\n   * @param bool $block\n   *   (optional) TRUE if the exposed form is being rendered as part of a\n   *   block; FALSE (default) if not.\n   *\n   * @return array\n   *   Form build array. This method returns an empty array if the form is\n   *   being rendered as a block.\n   *\n   * @see \\Drupal\\views\\ViewExecutable::build()\n   */\n  public function renderExposedForm($block = FALSE);\n\n  /**\n   * Runs before the view is rendered.\n   *\n   * Implement if your exposed form needs to run code before the view is\n   * rendered.\n   *\n   * @param \\Drupal\\views\\ResultRow[] $values\n   *   An array of all ResultRow objects returned from the query.\n   *\n   * @see \\Drupal\\views\\ViewExecutable::render()\n   */\n  public function preRender($values);\n\n  /**\n   * Runs after the view has been rendered.\n   *\n   * Implement if your exposed form needs to run code after the view is\n   * rendered.\n   *\n   * @param string $output\n   *   The rendered output of the view display.\n   *\n   * @see \\Drupal\\views\\ViewExecutable::render()\n   */\n  public function postRender(&$output);\n\n  /**\n   * Runs before the view has been executed.\n   *\n   * Implement if your exposed form needs to run code before query execution.\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayPluginBase::preExecute()\n   */\n  public function preExecute();\n\n  /**\n   * Runs after the view has been executed.\n   *\n   * Implement if your exposed form needs to run code after query execution.\n   */\n  public function postExecute();\n\n  /**\n   * Alters the exposed form.\n   *\n   * The exposed form is built by calling the renderExposedForm() method on\n   * this class, and then letting each exposed filter and sort handler add\n   * widgets to the form. After that is finished, this method is called to\n   * let the class alter the finished form.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\exposed_form\\ExposedFormPluginInterface::renderExposedForm()\n   * @see \\Drupal\\views\\Form\\ViewsExposedForm::buildForm()\n   */\n  public function exposedFormAlter(&$form, FormStateInterface $form_state);\n\n  /**\n   * Validates the exposed form submission.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @see \\Drupal\\views\\Form\\ViewsExposedForm::validateForm()\n   */\n  public function exposedFormValidate(&$form, FormStateInterface $form_state);\n\n  /**\n   * Submits the exposed form.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   * @param array $exclude\n   *   Array of keys that will not appear in $view->exposed_raw_input; for\n   *   example, 'form_build_id'.\n   *\n   * @see \\Drupal\\views\\Form\\ViewsExposedForm::submitForm()\n   */\n  public function exposedFormSubmit(&$form, FormStateInterface $form_state, &$exclude);\n\n}\n\n/**\n * @}\n */\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/exposed_form/ExposedFormPluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ExposedFormPluginInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: SupportsTemporaryTablesInterface\nSource file: <source_file>\nFile name hint: SupportsTemporaryTablesInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Database;\n\n/**\n * Adds support for temporary tables.\n *\n * @ingroup database\n */\ninterface SupportsTemporaryTablesInterface {\n\n  /**\n   * Runs a SELECT query and stores its results in a temporary table.\n   *\n   * Use this as a substitute for ->query() when the results need to stored\n   * in a temporary table. Temporary tables exist for the duration of the page\n   * request. User-supplied arguments to the query should be passed in as\n   * separate parameters so that they can be properly escaped to avoid SQL\n   * injection attacks.\n   *\n   * Note that if you need to know how many results were returned, you should do\n   * a SELECT COUNT(*) on the temporary table afterwards.\n   *\n   * @param string $query\n   *   A string containing a normal SELECT SQL query.\n   * @param array $args\n   *   (optional) An array of values to substitute into the query at placeholder\n   *   markers.\n   * @param array $options\n   *   (optional) An associative array of options to control how the query is\n   *   run. See the documentation for DatabaseConnection::defaultOptions() for\n   *   details.\n   *\n   * @return string\n   *   The name of the temporary table.\n   */\n  public function queryTemporary($query, array $args = [], array $options = []);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Database;\n\n/**\n * Adds support for temporary tables.\n *\n * @ingroup database\n */\ninterface SupportsTemporaryTablesInterface {\n\n  /**\n   * Runs a SELECT query and stores its results in a temporary table.\n   *\n   * Use this as a substitute for ->query() when the results need to stored\n   * in a temporary table. Temporary tables exist for the duration of the page\n   * request. User-supplied arguments to the query should be passed in as\n   * separate parameters so that they can be properly escaped to avoid SQL\n   * injection attacks.\n   *\n   * Note that if you need to know how many results were returned, you should do\n   * a SELECT COUNT(*) on the temporary table afterwards.\n   *\n   * @param string $query\n   *   A string containing a normal SELECT SQL query.\n   * @param array $args\n   *   (optional) An array of values to substitute into the query at placeholder\n   *   markers.\n   * @param array $options\n   *   (optional) An associative array of options to control how the query is\n   *   run. See the documentation for DatabaseConnection::defaultOptions() for\n   *   details.\n   *\n   * @return string\n   *   The name of the temporary table.\n   */\n  public function queryTemporary($query, array $args = [], array $options = []);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/SupportsTemporaryTablesInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SupportsTemporaryTablesInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: WorkspaceSafeFormTrait.php\nTarget symbol: trait WorkspaceSafeFormTrait\nNamespace: Drupal\\Core\\Entity\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete trait implementation for WorkspaceSafeFormTrait.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\workspaces\\WorkspaceInformationInterface\n- Ensure these methods exist where relevant:\n  - getWorkspaceInfo()\n  - isWorkspaceSafeEntity()\n  - isWorkspaceSafeEntityType()", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Form;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\workspaces\\WorkspaceInformationInterface;\n\n/**\n * Provides helpers for checking whether objects in forms are workspace-safe.\n */\ntrait WorkspaceSafeFormTrait {\n\n  /**\n   * The workspace information service.\n   */\n  protected ?WorkspaceInformationInterface $workspaceInfo = NULL;\n\n  /**\n   * Determines whether an entity used in a form is workspace-safe.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   An entity object.\n   *\n   * @return bool\n   *   TRUE if the entity is workspace-safe, FALSE otherwise.\n   */\n  protected function isWorkspaceSafeEntity(EntityInterface $entity): bool {\n    if (!\\Drupal::hasService('workspaces.information')) {\n      return FALSE;\n    }\n\n    $is_supported = $this->getWorkspaceInfo()->isEntitySupported($entity);\n    $is_ignored = $this->getWorkspaceInfo()->isEntityIgnored($entity);\n\n    return $is_supported || $is_ignored;\n  }\n\n  /**\n   * Determines whether an entity type used in a form is workspace-safe.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   An entity type object.\n   *\n   * @return bool\n   *   TRUE if the entity type is workspace-safe, FALSE otherwise.\n   */\n  protected function isWorkspaceSafeEntityType(EntityTypeInterface $entity_type): bool {\n    if (!\\Drupal::hasService('workspaces.information')) {\n      return FALSE;\n    }\n\n    $is_supported = $this->getWorkspaceInfo()->isEntityTypeSupported($entity_type);\n    $is_ignored = $this->getWorkspaceInfo()->isEntityTypeIgnored($entity_type);\n\n    return $is_supported || $is_ignored;\n  }\n\n  /**\n   * Retrieves the workspace information service.\n   *\n   * @return \\Drupal\\workspaces\\WorkspaceInformationInterface\n   *   The workspace information service.\n   */\n  protected function getWorkspaceInfo(): WorkspaceInformationInterface {\n    if (!$this->workspaceInfo) {\n      $this->workspaceInfo = \\Drupal::service('workspaces.information');\n    }\n\n    return $this->workspaceInfo;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Form/WorkspaceSafeFormTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "WorkspaceSafeFormTrait", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: BigPipeHooks.php\nTarget symbol: class BigPipeHooks\nNamespace: Drupal\\big_pipe\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BigPipeHooks.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\Url\n  - Drupal\\big_pipe\\Render\\Placeholder\\BigPipeStrategy\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n- Ensure these methods exist where relevant:\n  - help()\n  - pageAttachments()\n  - theme()", "output": "<?php\n\nnamespace Drupal\\big_pipe\\Hook;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\big_pipe\\Render\\Placeholder\\BigPipeStrategy;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for big_pipe.\n */\nclass BigPipeHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.big_pipe':\n        $output = '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The BigPipe module sends pages with dynamic content in a way that allows browsers to show them much faster. For more information, see the <a href=\":big_pipe-documentation\">online documentation for the BigPipe module</a>.', [\n          ':big_pipe-documentation' => 'https://www.drupal.org/documentation/modules/big_pipe',\n        ]) . '</p>';\n        $output .= '<h2>' . $this->t('Uses') . '</h2>';\n        $output .= '<dl>';\n        $output .= '<dt>' . $this->t('Speeding up your site') . '</dt>';\n        $output .= '<dd>' . $this->t('The module requires no configuration. Every part of the page contains metadata that allows BigPipe to figure this out on its own.') . '</dd>';\n        $output .= '</dl>';\n        return $output;\n    }\n    return NULL;\n  }\n\n  /**\n   * Implements hook_page_attachments().\n   *\n   * @see \\Drupal\\big_pipe\\Controller\\BigPipeController::setNoJsCookie()\n   */\n  #[Hook('page_attachments')]\n  public function pageAttachments(array &$page): void {\n    // Routes that don't use BigPipe also don't need no-JS detection.\n    if (\\Drupal::routeMatch()->getRouteObject()->getOption('_no_big_pipe')) {\n      return;\n    }\n    $request = \\Drupal::request();\n    // BigPipe is only used when there is an actual session, so only add the\n    // no-JS detection when there actually is a session. @see\n    // \\Drupal\\big_pipe\\Render\\Placeholder\\BigPipeStrategy.\n    $session_exists = \\Drupal::service('session_configuration')->hasSession($request);\n    $page['#cache']['contexts'][] = 'session.exists';\n    // Only do the no-JS detection while we don't know if there's no JS support:\n    // avoid endless redirect loops.\n    $has_big_pipe_nojs_cookie = $request->cookies->has(BigPipeStrategy::NOJS_COOKIE);\n    $page['#cache']['contexts'][] = 'cookies:' . BigPipeStrategy::NOJS_COOKIE;\n    if ($session_exists) {\n      if (!$has_big_pipe_nojs_cookie) {\n        // Let server set the BigPipe no-JS cookie.\n        $page['#attached']['html_head'][] = [\n          [\n            // Redirect through a 'Refresh' meta tag if JavaScript is disabled.\n            '#tag' => 'meta',\n            '#noscript' => TRUE,\n            '#attributes' => [\n              'http-equiv' => 'Refresh',\n              'content' => '0; URL=' . Url::fromRoute('big_pipe.nojs', [], [\n                'query' => \\Drupal::service('redirect.destination')->getAsArray(),\n              ])->toString(),\n            ],\n          ],\n          'big_pipe_detect_nojs',\n        ];\n      }\n      else {\n        // Let client delete the BigPipe no-JS cookie.\n        $page['#attached']['html_head'][] = [\n          [\n            '#tag' => 'script',\n            '#value' => 'document.cookie = \"' . BigPipeStrategy::NOJS_COOKIE . '=1; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT\"',\n          ],\n          'big_pipe_detect_js',\n        ];\n      }\n    }\n  }\n\n  /**\n   * Implements hook_theme().\n   */\n  #[Hook('theme')]\n  public function theme() : array {\n    return [\n      'big_pipe_interface_preview' => [\n        'variables' => [\n          'callback' => NULL,\n          'arguments' => NULL,\n          'preview' => NULL,\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/big_pipe/src/Hook/BigPipeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BigPipeHooks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface MigrateBuildDependencyInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate;\n\n/**\n * Interface for migration plugin manager for building dependencies.\n */\ninterface MigrateBuildDependencyInterface {\n\n  /**\n   * Builds a dependency tree for the migrations and set their order.\n   *\n   * @param \\Drupal\\migrate\\Plugin\\MigrationInterface[] $migrations\n   *   Array of loaded migrations with their declared dependencies.\n   * @param array $dynamic_ids\n   *   Keys are dynamic ids (for example node:*) values are a list of loaded\n   *   migration ids (for example node:page, node:article).\n   *\n   * @return array\n   *   An array of migrations.\n   */\n  public function buildDependencyMigration(array $migrations, array $dynamic_ids);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/MigrateBuildDependencyInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MigrateBuildDependencyInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the configuration files of the Purge Tag Mapper module.\n\npurge_tag_mapper.settings:\n  type: config_object\n  label: 'Purge Tag Mapper settings'\n  mapping:\n    content_type_tags:\n      type: sequence\n      label: 'Content type to cache tag mappings'\n      sequence:\n        type: mapping\n        label: 'Content type tag mapping'\n        mapping:\n          content_type:\n            type: string\n            label: 'Content type machine name'\n          tags:\n            type: string\n            label: 'Cache tags (one per line)'\n", "metadata": {"source": "repos/purge_tag_mapper/config/schema/purge_tag_mapper.schema.yml", "type": "yaml_reference", "topic": "purge tag mapper.schema"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: LibrariesSwitcher\nSource file: <source_file>\nFile name hint: LibrariesSwitcher.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\State\\StateInterface;\n\n/**\n * Hook implementations for display_builder.\n */\nclass LibrariesSwitcher {\n\n  private const STATE_STORAGE_KEY = 'display_builder.asset_libraries_local';\n\n  public function __construct(\n    protected StateInterface $state,\n  ) {}\n\n  /**\n   * Switch libraries according to environment.\n   *\n   * @param array $libraries\n   *   An associative array of libraries, passed by reference. The array key\n   *   for any particular library will be the name from *.libraries.yml.\n   * @param string $extension\n   *   Can either be 'core' or the machine name of the extension that registered\n   *   the libraries.\n   */\n  #[Hook('library_info_alter')]\n  public function switchLibraries(array &$libraries, string $extension): void {\n    if ($extension !== 'display_builder') {\n      return;\n    }\n\n    // By default, libraries are retrieved from CDN. Switch to local mode with\n    // a state value.\n    // This is needed for tests or disconnected environments.\n    $is_local = $this->state->get(self::STATE_STORAGE_KEY, FALSE);\n\n    if (!$is_local) {\n      return;\n    }\n\n    if (isset($libraries['shoelace']['dependencies'])) {\n      $libraries['shoelace']['dependencies'] = \\array_filter(\n        $libraries['shoelace']['dependencies'],\n        static fn ($dependency) => $dependency !== 'display_builder/_shoelace_cdn'\n      );\n      $libraries['shoelace']['dependencies'][] = 'display_builder/_shoelace_local';\n    }\n\n    if (isset($libraries['htmx_sse']['dependencies'])) {\n      $libraries['htmx_sse']['dependencies'] = \\array_filter(\n        $libraries['htmx_sse']['dependencies'],\n        static fn ($dependency) => $dependency !== 'display_builder/_htmx_sse_cdn'\n      );\n      $libraries['htmx_sse']['dependencies'][] = 'display_builder/_htmx_sse_local';\n    }\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\State\\StateInterface;\n\n/**\n * Hook implementations for display_builder.\n */\nclass LibrariesSwitcher {\n\n  private const STATE_STORAGE_KEY = 'display_builder.asset_libraries_local';\n\n  public function __construct(\n    protected StateInterface $state,\n  ) {}\n\n  /**\n   * Switch libraries according to environment.\n   *\n   * @param array $libraries\n   *   An associative array of libraries, passed by reference. The array key\n   *   for any particular library will be the name from *.libraries.yml.\n   * @param string $extension\n   *   Can either be 'core' or the machine name of the extension that registered\n   *   the libraries.\n   */\n  #[Hook('library_info_alter')]\n  public function switchLibraries(array &$libraries, string $extension): void {\n    if ($extension !== 'display_builder') {\n      return;\n    }\n\n    // By default, libraries are retrieved from CDN. Switch to local mode with\n    // a state value.\n    // This is needed for tests or disconnected environments.\n    $is_local = $this->state->get(self::STATE_STORAGE_KEY, FALSE);\n\n    if (!$is_local) {\n      return;\n    }\n\n    if (isset($libraries['shoelace']['dependencies'])) {\n      $libraries['shoelace']['dependencies'] = \\array_filter(\n        $libraries['shoelace']['dependencies'],\n        static fn ($dependency) => $dependency !== 'display_builder/_shoelace_cdn'\n      );\n      $libraries['shoelace']['dependencies'][] = 'display_builder/_shoelace_local';\n    }\n\n    if (isset($libraries['htmx_sse']['dependencies'])) {\n      $libraries['htmx_sse']['dependencies'] = \\array_filter(\n        $libraries['htmx_sse']['dependencies'],\n        static fn ($dependency) => $dependency !== 'display_builder/_htmx_sse_cdn'\n      );\n      $libraries['htmx_sse']['dependencies'][] = 'display_builder/_htmx_sse_local';\n    }\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Hook/LibrariesSwitcher.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LibrariesSwitcher", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class AliasRepository in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\path_alias;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Database\\Query\\SelectInterface;\nuse Drupal\\Core\\Database\\Statement\\FetchAs;\nuse Drupal\\Core\\Language\\LanguageInterface;\n\n/**\n * Provides the default path alias lookup operations.\n */\nclass AliasRepository implements AliasRepositoryInterface {\n\n  /**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $connection;\n\n  /**\n   * Constructs an AliasRepository object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   A database connection for reading and writing path aliases.\n   */\n  public function __construct(Connection $connection) {\n    $this->connection = $connection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preloadPathAlias($preloaded, $langcode) {\n    $select = $this->getBaseQuery()\n      ->fields('base_table', ['path', 'alias']);\n\n    if (!empty($preloaded)) {\n      $conditions = $this->connection->condition('OR');\n      foreach ($preloaded as $preloaded_item) {\n        $conditions->condition('base_table.path', $this->connection->escapeLike($preloaded_item), 'LIKE');\n      }\n      $select->condition($conditions);\n    }\n\n    $this->addLanguageFallback($select, $langcode);\n\n    $select->orderBy('base_table.id', 'DESC');\n\n    // We want the most recently created alias for each source, however that\n    // will be at the start of the result-set, so fetch everything and reverse\n    // it. Note that it would not be sufficient to reverse the ordering of the\n    // 'base_table.id' column, as that would not guarantee other conditions\n    // added to the query, such as those in ::addLanguageFallback, would be\n    // reversed.\n    $results = $select->execute()->fetchAll(FetchAs::Associative);\n    $aliases = [];\n    foreach (array_reverse($results) as $result) {\n      $aliases[$result['path']] = $result['alias'];\n    }\n\n    return $aliases;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function lookupBySystemPath($path, $langcode) {\n    // See the queries above. Use LIKE for case-insensitive matching.\n    $select = $this->getBaseQuery()\n      ->fields('base_table', ['id', 'path', 'alias', 'langcode'])\n      ->condition('base_table.path', $this->connection->escapeLike($path), 'LIKE');\n\n    $this->addLanguageFallback($select, $langcode);\n\n    $select->orderBy('base_table.id', 'DESC');\n\n    return $select->execute()->fetchAssoc() ?: NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function lookupByAlias($alias, $langcode) {\n    // See the queries above. Use LIKE for case-insensitive matching.\n    $select = $this->getBaseQuery()\n      ->fields('base_table', ['id', 'path', 'alias', 'langcode'])\n      ->condition('base_table.alias', $this->connection->escapeLike($alias), 'LIKE');\n\n    $this->addLanguageFallback($select, $langcode);\n\n    $select->orderBy('base_table.id', 'DESC');\n\n    return $select->execute()->fetchAssoc() ?: NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function pathHasMatchingAlias($initial_substring) {\n    $query = $this->getBaseQuery();\n    $query->addExpression(1);\n\n    return (bool) $query\n      ->condition('base_table.path', $this->connection->escapeLike($initial_substring) . '%', 'LIKE')\n      ->range(0, 1)\n      ->execute()\n      ->fetchField();\n  }\n\n  /**\n   * Returns a SELECT query for the path_alias base table.\n   *\n   * @return \\Drupal\\Core\\Database\\Query\\SelectInterface\n   *   A Select query object.\n   */\n  protected function getBaseQuery() {\n    $query = $this->connection->select('path_alias', 'base_table');\n    $query->condition('base_table.status', 1);\n\n    return $query;\n  }\n\n  /**\n   * Adds path alias language fallback conditions to a select query object.\n   *\n   * @param \\Drupal\\Core\\Database\\Query\\SelectInterface $query\n   *   A Select query object.\n   * @param string $langcode\n   *   Language code to search the path with. If there's no path defined for\n   *   that language it will search paths without language.\n   */\n  protected function addLanguageFallback(SelectInterface $query, $langcode) {\n    // Always get the language-specific alias before the language-neutral one.\n    // For example 'de' is less than 'und' so the order needs to be ASC, while\n    // 'xx-lolspeak' is more than 'und' so the order needs to be DESC.\n    $langcode_list = [$langcode, LanguageInterface::LANGCODE_NOT_SPECIFIED];\n    if ($langcode === LanguageInterface::LANGCODE_NOT_SPECIFIED) {\n      array_pop($langcode_list);\n    }\n    elseif ($langcode > LanguageInterface::LANGCODE_NOT_SPECIFIED) {\n      $query->orderBy('base_table.langcode', 'DESC');\n    }\n    else {\n      $query->orderBy('base_table.langcode', 'ASC');\n    }\n    $query->condition('base_table.langcode', $langcode_list, 'IN');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/path_alias/src/AliasRepository.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AliasRepository", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BlockContentViewBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block_content;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityViewBuilder;\n\n/**\n * View builder handler for content blocks.\n *\n * Note: Content blocks (block_content entities) are not designed to be\n * displayed outside of blocks! This BlockContentViewBuilder class is designed\n * to be used by \\Drupal\\block_content\\Plugin\\Block\\BlockContentBlock::build()\n * and by nothing else.\n *\n * @see \\Drupal\\block_content\\Plugin\\Block\\BlockContentBlock\n */\nclass BlockContentViewBuilder extends EntityViewBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function view(EntityInterface $entity, $view_mode = 'full', $langcode = NULL) {\n    return $this->viewMultiple([$entity], $view_mode, $langcode)[0];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewMultiple(array $entities = [], $view_mode = 'full', $langcode = NULL) {\n    $build_list = parent::viewMultiple($entities, $view_mode, $langcode);\n    // Apply the buildMultiple() #pre_render callback immediately, to make\n    // bubbling of attributes and contextual links to the actual block work.\n    // @see \\Drupal\\block\\BlockViewBuilder::buildBlock()\n    unset($build_list['#pre_render'][0]);\n    return $this->buildMultiple($build_list);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getBuildDefaults(EntityInterface $entity, $view_mode) {\n    $build = parent::getBuildDefaults($entity, $view_mode);\n    // The content block will be rendered in the wrapped block template already\n    // and thus has no entity template itself.\n    unset($build['#theme']);\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block_content/src/BlockContentViewBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockContentViewBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ViewsArgumentValidator.php\nTarget symbol: class ViewsArgumentValidator\nNamespace: Drupal\\views\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ViewsArgumentValidator.", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views argument validator plugins.\n *\n * @see \\Drupal\\views\\Plugin\\views\\argument_validator\\ArgumentValidatorPluginBase\n *\n * @ingroup views_argument_validate_plugins\n *\n * @Annotation\n */\nclass ViewsArgumentValidator extends ViewsPluginAnnotationBase {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The plugin title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $title = '';\n\n  /**\n   * An optional short title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $short_title = '';\n\n  /**\n   * Whether the plugin should be not selectable in the UI.\n   *\n   * If it's set to TRUE, you can still use it via the API in config files.\n   *\n   * @var bool\n   */\n  public $no_ui;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Annotation/ViewsArgumentValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsArgumentValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "limit_query_depth: true\nmax_depth: 2\ndepth_overrides: []\nrestrict_collections: true\ncollection_restriction_exceptions: {  }\nblock_write_operations: false\nwrite_exceptions: []\ncollection_route_mapping:\n  - 'file--file|view.files.page_1'\n  - 'filter_format--filter_format|filter.admin_overview'\n  - 'taxonomy_term--*|entity.taxonomy_vocabulary.edit_form'\n", "metadata": {"source": "repos/jsonapi_security/config/install/jsonapi_security.settings.yml", "type": "yaml_reference", "topic": "jsonapi security.settings"}}
{"instruction": "Show me the implementation of the class TreePanel in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\InstanceInterface;\nuse Drupal\\display_builder\\IslandType;\nuse Drupal\\display_builder\\SlotSourceProxy;\nuse Drupal\\display_builder\\SourceWithSlotsInterface;\nuse Drupal\\ui_patterns\\SourceWithChoicesInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Layers island plugin implementation.\n */\n#[Island(\n  id: 'tree',\n  label: new TranslatableMarkup('Tree'),\n  description: new TranslatableMarkup('Hierarchical view of components and blocks.'),\n  type: IslandType::View,\n  default_region: 'main',\n  icon: 'bar-chart-steps',\n)]\nclass TreePanel extends BuilderPanel {\n\n  /**\n   * Proxy for slot source operations.\n   */\n  protected SlotSourceProxy $slotSourceProxy;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->slotSourceProxy = $container->get('display_builder.slot_sources_proxy');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function keyboardShortcuts(): array {\n    return [\n      'key' => 't',\n      'help' => t('Show the tree'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(InstanceInterface $builder, array $data = [], array $options = []): array {\n    $builder_id = (string) $builder->id();\n\n    $build = [\n      '#type' => 'component',\n      '#component' => 'display_builder:panel_tree',\n      '#slots' => [\n        'items' => $this->digFromSlot($builder_id, $data),\n      ],\n      '#attributes' => [\n        // Required for JavaScript @see components/dropzone/dropzone.js.\n        'data-db-id' => $builder_id,\n        'data-node-title' => $this->t('Base container'),\n        'data-db-root' => TRUE,\n        // 'class' => ['db-dropzone--root', 'db-dropzone'],\n      ],\n    ];\n\n    return $build;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildSingleComponent(string $builder_id, string $instance_id, SourceWithSlotsInterface $source, array $data, int $index = 0): ?array {\n    $component_id = NULL;\n    $label = $source->label();\n\n    if ($source instanceof SourceWithChoicesInterface) {\n      $component_id = $source->getChoice($data['source']);\n      $label = $this->slotSourceProxy->getLabelWithSummary($data, [])['label'];\n    }\n    $instance_id = $instance_id ?: $data['node_id'];\n\n    if (!$instance_id || !$component_id) {\n      return NULL;\n    }\n\n    $slots = [];\n\n    foreach ($source->getSlotDefinitions() as $slot_id => $definition) {\n      $items = [\n        '#type' => 'component',\n        '#component' => 'display_builder:tree_item',\n        '#props' => [\n          'icon' => 'box-arrow-in-right',\n        ],\n        '#slots' => [\n          'title' => $definition['title'],\n        ],\n        // Slot is needed for contextual menu paste.\n        // @see assets/js/contextual_menu.js\n        '#attributes' => [\n          'data-slot-id' => $slot_id,\n          'data-slot-title' => $definition['title'],\n          'data-node-id' => $instance_id,\n          'data-node-title' => $label,\n          'data-menu-type' => 'slot',\n        ],\n      ];\n\n      if ($sources = $source->getSlotValue($slot_id)) {\n        $items['#slots']['children'] = $this->digFromSlot($builder_id, $sources);\n      }\n\n      $slots[] = $items;\n    }\n\n    // I f a single item, expand by default.\n    if (\\count($slots) === 1) {\n      $slots[0]['#props']['expanded'] = TRUE;\n    }\n\n    return [\n      '#type' => 'component',\n      '#component' => 'display_builder:tree_item',\n      '#props' => [\n        'expanded' => TRUE,\n        'icon' => 'box',\n      ],\n      '#slots' => [\n        'title' => $label,\n        'children' => $slots,\n      ],\n      // Required for the context menu label.\n      // @see assets/js/contextual_menu.js\n      '#attributes' => [\n        'data-node-id' => $instance_id,\n        'data-node-title' => $label,\n        'data-slot-position' => $index,\n        'data-menu-type' => 'component',\n        // 'class' => ['db-dropzone', 'db-tree__component'],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildSingleBlock(string $builder_id, string $instance_id, array $data, int $index = 0): array {\n    $instance_id = $instance_id ?: $data['node_id'];\n    $label = $this->slotSourceProxy->getLabelWithSummary($data, $this->configuration['contexts'] ?? []);\n\n    if (isset($data['source_id']) && $data['source_id'] === 'entity_field') {\n      $label['summary'] = (string) $this->t('Field: @label', ['@label' => $label['label']]);\n    }\n\n    return [\n      '#type' => 'component',\n      '#component' => 'display_builder:tree_item',\n      '#props' => [\n        'icon' => 'view-list',\n      ],\n      '#slots' => [\n        'title' => $label['summary'],\n      ],\n      '#attributes' => [\n        'data-node-id' => $instance_id,\n        // This label is used for contextual menu.\n        // @see assets/js/contextual_menu.js\n        'data-node-title' => $label['summary'],\n        'data-slot-position' => $index,\n        'data-menu-type' => 'block',\n        // 'class' => ['db-dropzone', 'db-tree__block'],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Plugin/display_builder/Island/TreePanel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TreePanel", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: d6_term_node_revision\nlabel: Term/node relationship revisions\naudit: true\nmigration_tags:\n  - Drupal 6\n  - Content\nderiver: Drupal\\taxonomy\\Plugin\\migrate\\D6TermNodeDeriver\nsource:\n  plugin: d6_term_node_revision\nprocess:\n  vid:\n    -\n      plugin: migration_lookup\n      migration:\n        - d6_node_complete\n        - d6_node_revision\n      source: vid\n    -\n      plugin: node_complete_node_revision_lookup\n    -\n      plugin: skip_on_empty\n      method: row\n  type: type\n  # The actual field name is dynamic and will be added by the builder.\ndestination:\n  plugin: entity_revision:node\nmigration_dependencies:\n  required:\n    - d6_term_node\n    - d6_node_revision\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/migrations/d6_term_node_revision.yml", "type": "yaml_reference", "topic": "d6 term node revision"}}
{"instruction": "Show me the implementation of the class LocaleServiceProvider in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\locale;\n\nuse Drupal\\Core\\Config\\BootstrapConfigStorageFactory;\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderBase;\n\n/**\n * Overrides the language_manager service to point to language's module one.\n */\nclass LocaleServiceProvider extends ServiceProviderBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alter(ContainerBuilder $container): void {\n    if ($container->hasParameter('language.translate_english')) {\n      $config_storage = BootstrapConfigStorageFactory::get();\n      $config = $config_storage->read('locale.settings');\n      if ($config) {\n        $container->setParameter('language.translate_english', $config['translate_english'] ?? TRUE);\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/src/LocaleServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LocaleServiceProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class OptionsButtonsWidget in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldWidget;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'options_buttons' widget.\n */\n#[FieldWidget(\n  id: 'options_buttons',\n  label: new TranslatableMarkup('Check boxes/radio buttons'),\n  field_types: [\n    'boolean',\n    'entity_reference',\n    'list_integer',\n    'list_float',\n    'list_string',\n  ],\n  multiple_values: TRUE,\n)]\nclass OptionsButtonsWidget extends OptionsWidgetBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $element = parent::formElement($items, $delta, $element, $form, $form_state);\n\n    $options = $this->getOptions($items->getEntity());\n    $selected = $this->getSelectedOptions($items);\n\n    // If required and there is one single option, preselect it.\n    if ($this->required && count($options) == 1) {\n      $selected = [array_key_first($options)];\n    }\n\n    if ($this->multiple) {\n      $element += [\n        '#type' => 'checkboxes',\n        '#default_value' => $selected,\n        '#options' => $options,\n      ];\n    }\n    else {\n      $element += [\n        '#type' => 'radios',\n        // Radio buttons need a scalar value. Take the first default value, or\n        // default to NULL so that the form element is properly recognized as\n        // not having a default value.\n        '#default_value' => $selected ? reset($selected) : NULL,\n        '#options' => $options,\n      ];\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEmptyLabel() {\n    if (!$this->required && !$this->multiple) {\n      return $this->t('N/A');\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldWidget/OptionsButtonsWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OptionsButtonsWidget", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: receive\nSource file: <source_file>\nFile name hint: StateAwareProcessorInterface.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\flowdrop_stategraph\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\flowdrop_stategraph\\DTO\\GraphState;\n\n/**\n * Interface for node processors that work with graph state.\n *\n * Processors implementing this interface receive the current graph state\n * before execution and can return state updates to be applied after.\n *\n * This interface is optional - processors can also access state via the\n * `__state__` key in input parameters. This interface provides a cleaner\n * API for state-heavy processors.\n *\n * Example usage:\n * @code\n * class MyStatefulProcessor extends AbstractFlowDropNodeProcessor\n *     implements StateAwareProcessorInterface {\n *\n *   protected ?GraphState $graphState = null;\n *\n *   public function setGraphState(GraphState $state): void {\n *     $this->graphState = $state;\n *   }\n *\n *   public function process(ParameterBagInterface $params): array {\n *     // Access state directly.\n *     $messages = $this->graphState->messages;\n *\n *     // Process and return state update.\n *     return [\n *       \"output\" => \"result\",\n *       \"state_update\" => [\n *         \"messages\" => [new Message(\"assistant\", \"Response\")],\n *       ],\n *     ];\n *   }\n * }\n * @endcode\n *\n * @see \\Drupal\\flowdrop_stategraph\\DTO\\GraphState\n * @see \\Drupal\\flowdrop_stategraph\\DTO\\StateUpdate\n */\ninterface StateAwareProcessorInterface {\n\n  /**\n   * Sets the current graph state.\n   *\n   * This method is called by the StateGraph orchestrator before process()\n   * is invoked.\n   *\n   * @param \\Drupal\\flowdrop_stategraph\\DTO\\GraphState $state\n   *   The current graph state.\n   */\n  public function setGraphState(GraphState $state): void;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\flowdrop_stategraph\\DTO\\GraphState;\n\n/**\n * Interface for node processors that work with graph state.\n *\n * Processors implementing this interface receive the current graph state\n * before execution and can return state updates to be applied after.\n *\n * This interface is optional - processors can also access state via the\n * `__state__` key in input parameters. This interface provides a cleaner\n * API for state-heavy processors.\n *\n * Example usage:\n * @code\n * class MyStatefulProcessor extends AbstractFlowDropNodeProcessor\n *     implements StateAwareProcessorInterface {\n *\n *   protected ?GraphState $graphState = null;\n *\n *   public function setGraphState(GraphState $state): void {\n *     $this->graphState = $state;\n *   }\n *\n *   public function process(ParameterBagInterface $params): array {\n *     // Access state directly.\n *     $messages = $this->graphState->messages;\n *\n *     // Process and return state update.\n *     return [\n *       \"output\" => \"result\",\n *       \"state_update\" => [\n *         \"messages\" => [new Message(\"assistant\", \"Response\")],\n *       ],\n *     ];\n *   }\n * }\n * @endcode\n *\n * @see \\Drupal\\flowdrop_stategraph\\DTO\\GraphState\n * @see \\Drupal\\flowdrop_stategraph\\DTO\\StateUpdate\n */\ninterface StateAwareProcessorInterface {\n\n  /**\n   * Sets the current graph state.\n   *\n   * This method is called by the StateGraph orchestrator before process()\n   * is invoked.\n   *\n   * @param \\Drupal\\flowdrop_stategraph\\DTO\\GraphState $state\n   *   The current graph state.\n   */\n  public function setGraphState(GraphState $state): void;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_stategraph/src/Plugin/FlowDropNodeProcessor/StateAwareProcessorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "StateAwareProcessorInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class MediaRouteProvider in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\media\\Routing;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides HTML routes for media pages.\n */\nclass MediaRouteProvider extends AdminHtmlRouteProvider {\n\n  /**\n   * The media settings config.\n   *\n   * @var \\Drupal\\Core\\Config\\ImmutableConfig\n   */\n  protected $config;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager, EntityFieldManagerInterface $entity_field_manager, ConfigFactoryInterface $config_factory) {\n    parent::__construct($entity_type_manager, $entity_field_manager);\n    $this->config = $config_factory->get('media.settings');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('entity_field.manager'),\n      $container->get('config.factory')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getCanonicalRoute(EntityTypeInterface $entity_type) {\n    if ($this->config->get('standalone_url')) {\n      return parent::getCanonicalRoute($entity_type);\n    }\n    else {\n      return parent::getEditFormRoute($entity_type);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Routing/MediaRouteProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaRouteProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LoggingSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configure logging settings for DB Wipe Entity.\n */\nclass LoggingSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'db_wipe_entity_logging_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['db_wipe_entity.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $config = $this->config('db_wipe_entity.settings');\n    $logging = $config->get('logging');\n\n    $form['logging'] = [\n      '#type' => 'details',\n      '#title' => $this->t('Logging Settings'),\n      '#open' => TRUE,\n      '#tree' => TRUE,\n    ];\n\n    $form['logging']['enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Enable logging'),\n      '#description' => $this->t('Log wipe operations to Drupal watchdog.'),\n      '#default_value' => $logging['enabled'] ?? TRUE,\n    ];\n\n    $form['logging']['what_to_log'] = [\n      '#type' => 'fieldset',\n      '#title' => $this->t('What to log'),\n      '#states' => [\n        'visible' => [\n          ':input[name=\"logging[enabled]\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n\n    $form['logging']['what_to_log']['log_protected_attempts'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Protection rule matches'),\n      '#description' => $this->t('Log when entities are protected from deletion by rules.'),\n      '#default_value' => $logging['log_protected_attempts'] ?? TRUE,\n    ];\n\n    $form['logging']['what_to_log']['log_batch_progress'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Batch progress'),\n      '#description' => $this->t('Log progress during batch operations.'),\n      '#default_value' => $logging['log_batch_progress'] ?? FALSE,\n    ];\n\n    $form['logging']['what_to_log']['log_sql_queries'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('SQL queries (debug)'),\n      '#description' => $this->t('Log SQL queries in SQL Direct mode.'),\n      '#default_value' => $logging['log_sql_queries'] ?? FALSE,\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->config('db_wipe_entity.settings')\n      ->set('logging.enabled', $form_state->getValue(['logging', 'enabled']))\n      ->set(\n        'logging.log_protected_attempts',\n        $form_state->getValue(['logging', 'what_to_log', 'log_protected_attempts']),\n      )\n      ->set('logging.log_batch_progress', $form_state->getValue(['logging', 'what_to_log', 'log_batch_progress']))\n      ->set('logging.log_sql_queries', $form_state->getValue(['logging', 'what_to_log', 'log_sql_queries']))\n      ->save();\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Form/LoggingSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LoggingSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: EcaEntityImport\nSource file: <source_file>\nFile name hint: EcaEntityImport.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\eca_entity_import\\Plugin\\migrate\\process;\n\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\nuse Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException;\nuse Drupal\\Core\\Entity\\EntityFormInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\eca_migrate\\Plugin\\migrate\\process\\Eca;\nuse Drupal\\entity_import\\Plugin\\migrate\\process\\EntityImportProcessInterface;\nuse Drupal\\entity_import\\Plugin\\migrate\\process\\EntityImportProcessTrait;\n\n/**\n * Define eca entity import.\n *\n * @MigrateProcessPlugin(\n *   id = \"eca_entity_import\",\n *   label = @Translation(\"ECA\")\n * )\n */\nclass EcaEntityImport extends Eca implements EntityImportProcessInterface {\n\n  use EntityImportProcessTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $form['#markup'] = $this->t('The \"@label\" process plugin has no configurations. The entity importer ID is \"<b>@id</b>\". It can be used within the ECA model, e.g. to run a model only on a certain entity import. The entity import ID is available within the ECA model in the token <b>row:source:importer_id</b>.', [\n      '@label' => $this->getLabel(),\n      '@id' => $this->getImporterId($form_state),\n    ]);\n\n    return $form;\n  }\n\n  /**\n   * Returns the importer id.\n   *\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   *\n   * @return string\n   *   The importer id.\n   */\n  protected function getImporterId(FormStateInterface $form_state): string {\n    $formObject = $form_state->getFormObject();\n\n    if ($formObject instanceof EntityFormInterface) {\n      /** @var \\Drupal\\entity_import\\Entity\\EntityImporterFieldMappingInterface $entity */\n      $entity = $formObject->getEntity();\n      try {\n        $id = $entity->getImporterEntity()?->id();\n        if ($id) {\n          return $id;\n        }\n      }\n      catch (InvalidPluginDefinitionException | PluginNotFoundException $e) {\n        $this->messenger()->addError($e->getMessage());\n      }\n    }\n\n    return '';\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\eca_entity_import\\Plugin\\migrate\\process;\n\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\nuse Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException;\nuse Drupal\\Core\\Entity\\EntityFormInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\eca_migrate\\Plugin\\migrate\\process\\Eca;\nuse Drupal\\entity_import\\Plugin\\migrate\\process\\EntityImportProcessInterface;\nuse Drupal\\entity_import\\Plugin\\migrate\\process\\EntityImportProcessTrait;\n\n/**\n * Define eca entity import.\n *\n * @MigrateProcessPlugin(\n *   id = \"eca_entity_import\",\n *   label = @Translation(\"ECA\")\n * )\n */\nclass EcaEntityImport extends Eca implements EntityImportProcessInterface {\n\n  use EntityImportProcessTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $form['#markup'] = $this->t('The \"@label\" process plugin has no configurations. The entity importer ID is \"<b>@id</b>\". It can be used within the ECA model, e.g. to run a model only on a certain entity import. The entity import ID is available within the ECA model in the token <b>row:source:importer_id</b>.', [\n      '@label' => $this->getLabel(),\n      '@id' => $this->getImporterId($form_state),\n    ]);\n\n    return $form;\n  }\n\n  /**\n   * Returns the importer id.\n   *\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The form state.\n   *\n   * @return string\n   *   The importer id.\n   */\n  protected function getImporterId(FormStateInterface $form_state): string {\n    $formObject = $form_state->getFormObject();\n\n    if ($formObject instanceof EntityFormInterface) {\n      /** @var \\Drupal\\entity_import\\Entity\\EntityImporterFieldMappingInterface $entity */\n      $entity = $formObject->getEntity();\n      try {\n        $id = $entity->getImporterEntity()?->id();\n        if ($id) {\n          return $id;\n        }\n      }\n      catch (InvalidPluginDefinitionException | PluginNotFoundException $e) {\n        $this->messenger()->addError($e->getMessage());\n      }\n    }\n\n    return '';\n  }\n\n}\n", "metadata": {"source": "repos/eca_entity_import/src/Plugin/migrate/process/EcaEntityImport.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EcaEntityImport", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: i.2. Audience and Goal", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Preface](/docs/user_guide/en/preface.html)\n\n* [i.1. Copyright](/docs/user_guide/en/copyright.html)\n* [i.2. Audience and Goal](/docs/user_guide/en/preface-audience.html)\n* [i.3. Organization](/docs/user_guide/en/preface-organization.html)\n* [i.4. Reporting Problems](/docs/user_guide/en/preface-reporting.html)\n* [i.5. Conventions of the Guide](/docs/user_guide/en/preface-conventions.html)\n* [i.6. Guiding Scenario](/docs/user_guide/en/preface-scenario.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/preface-audience.html \"i.2. Audi\u00e8ncia i objectius\")\n* [Magyar](/hu/docs/user_guide/hu/preface-audience.html \"i.2. K\u00f6z\u00f6ns\u00e9g \u00e9s c\u00e9lkit\u0171z\u00e9s\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/preface-audience.html \"i.2. Audiencia y objetivo\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/preface-audience.html \"i.2. \u0410\u0443\u0434\u0438\u0442\u043e\u0440\u0456\u044f \u0442\u0430 \u043c\u0435\u0442\u0430\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/preface-audience.html \"i.2. Audience and Goal\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/preface-audience.html \"i.2. Public et objectif\")\n* [Deutsch](/de/docs/user_guide/de/preface-audience.html \"i.2. Zielgruppe und Zielsetzung\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/preface-audience.html \"i.2. \u0645\u062e\u0627\u0637\u0628 \u0648 \u0627\u0647\u062f\u0627\u0641\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/preface-audience.html \"i.2. Audiens dan Tujuan\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/preface-audience.html \"i.2. \u8aad\u8005\u3068\u76ee\u6a19\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/preface-audience.html \"i.2. Audience and Goal\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/preface-audience.html \"i.2. \u0410\u0443\u0434\u0438\u0442\u043e\u0440\u0438\u044f \u0438 \u0426\u0435\u043b\u044c\")\n\n# i.2. Audience and Goal\n\nLast [updated](/node/2827278/discuss) on\n\n14 April 2025\n\nThis guide was written mainly for people with minimal knowledge of the Drupal\ncontent management system. The topics will help them become skilled at\ninstalling, administering, site building, and/or maintaining the content of a\nDrupal-based website. The guide is also aimed at people who already have some\nexperience with a current or past version of Drupal, and want to expand the\nrange of their skills and knowledge or update them to the current version.\n\nThis guide assumes that you have already decided you want to learn and use\nDrupal. If you need to learn more before deciding, see\n[Section\u00a01.1, \u201cConcept: Drupal as a Content Management System\u201d](/docs/user_guide/en/understanding-drupal.html \" Drupal as a Content Management System\").\n\nDepending on which aspects of Drupal you would like to learn, you will need some\nbackground knowledge to understand this guide: general Internet skills and\nknowledge are assumed, and the guide concentrates on how to use the software\nitself. For instance, the sections about installing Drupal on a web server\nassume you can obtain web hosting and figure out how to transfer files to your\nchosen web host. Similarly, the sections about content management assume you can\nlog into a website and fill in a web-based form.\n\nAfter reading this guide, you should be able to:\n\n* Plan the content architecture for a Drupal-based site\n* Build the site that you planned\n* Manage and administer your site\n* Understand documentation and blog posts on topics not covered here, to\n  expand your knowledge and skills\n* Connect with the worldwide Drupal community\n\n**Attributions**\n\nWritten by [Jennifer Hodgdon](https://www.drupal.org/u/jhodgdon).\n\nNext [\u2192 i.3. Organization](/docs/user_guide/en/preface-organization.html)\n\nPrevious [\u2190 i.1. Copyright](/docs/user_guide/en/copyright.html)\n\n##\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: preface-audience.asciidoc\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2827278/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282827278%29%20i.2.%20Audience%20and%20Goal) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/preface-audience.md", "type": "doc_summary", "topic": "i.2. Audience and Goal"}}
{"instruction": "Show me the implementation of the class BlockContentAddLocalAction in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block_content\\Plugin\\Menu\\LocalAction;\n\nuse Drupal\\Core\\Menu\\LocalActionDefault;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Routing\\RouteProviderInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * Modifies the 'Add content block' local action.\n */\nclass BlockContentAddLocalAction extends LocalActionDefault {\n\n  /**\n   * Constructs a BlockContentAddLocalAction object.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    RouteProviderInterface $routeProvider,\n    protected RequestStack $requestStack,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $routeProvider);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('router.route_provider'),\n      $container->get('request_stack'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOptions(RouteMatchInterface $route_match) {\n    $options = parent::getOptions($route_match);\n    // If the route specifies a theme, append it to the query string.\n    if ($theme = $route_match->getParameter('theme')) {\n      $options['query']['theme'] = $theme;\n    }\n\n    // If the current request has a region, append it to the query string.\n    if ($region = $this->requestStack->getCurrentRequest()->query->getString('region')) {\n      $options['query']['region'] = $region;\n    }\n    return $options;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block_content/src/Plugin/Menu/LocalAction/BlockContentAddLocalAction.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockContentAddLocalAction", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EditorDialogSave in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\editor\\Ajax;\n\nuse Drupal\\Core\\Ajax\\CommandInterface;\n\n/**\n * Provides an AJAX command for saving the contents of an editor dialog.\n *\n * This command is implemented in editor.dialog.js in\n * Drupal.AjaxCommands.prototype.editorDialogSave.\n */\nclass EditorDialogSave implements CommandInterface {\n\n  /**\n   * An array of values that will be passed back to the editor by the dialog.\n   *\n   * @var array\n   */\n  protected array $values;\n\n  /**\n   * Constructs an EditorDialogSave object.\n   *\n   * @param array $values\n   *   The values that should be passed to the form constructor in Drupal.\n   */\n  public function __construct(array $values) {\n    $this->values = $values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    return [\n      'command' => 'editorDialogSave',\n      'values' => $this->values,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/editor/src/Ajax/EditorDialogSave.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EditorDialogSave", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PoMemoryWriter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Gettext;\n\n/**\n * Defines a Gettext PO memory writer, to be used by the installer.\n */\nclass PoMemoryWriter implements PoWriterInterface {\n\n  /**\n   * Array to hold all PoItem elements.\n   *\n   * @var array\n   */\n  protected $items;\n\n  /**\n   * Constructor, initialize empty items.\n   */\n  public function __construct() {\n    $this->items = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function writeItem(PoItem $item) {\n    if (is_array($item->getSource())) {\n      $item->setSource(implode(PoItem::DELIMITER, $item->getSource()));\n      $item->setTranslation(implode(PoItem::DELIMITER, $item->getTranslation()));\n    }\n    $context = $item->getContext();\n    $this->items[$context != NULL ? $context : ''][$item->getSource()] = $item->getTranslation();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function writeItems(PoReaderInterface $reader, $count = -1) {\n    $forever = $count == -1;\n    while (($count-- > 0 || $forever) && ($item = $reader->readItem())) {\n      $this->writeItem($item);\n    }\n  }\n\n  /**\n   * Get all stored PoItem's.\n   *\n   * @return array\n   *   Array of all PoItem elements.\n   */\n  public function getData() {\n    return $this->items;\n  }\n\n  /**\n   * Implements Drupal\\Component\\Gettext\\PoMetadataInterface:setLangcode().\n   *\n   * Not implemented. Not relevant for the MemoryWriter.\n   */\n  public function setLangcode($langcode) {\n  }\n\n  /**\n   * Implements Drupal\\Component\\Gettext\\PoMetadataInterface:getLangcode().\n   *\n   * Not implemented. Not relevant for the MemoryWriter.\n   */\n  public function getLangcode() {\n    throw new \\LogicException(__METHOD__ . '() not implemented. Not relevant for the MemoryWriter');\n  }\n\n  /**\n   * Implements Drupal\\Component\\Gettext\\PoMetadataInterface:getHeader().\n   *\n   * Not implemented. Not relevant for the MemoryWriter.\n   */\n  public function getHeader() {\n  }\n\n  /**\n   * Implements Drupal\\Component\\Gettext\\PoMetadataInterface:setHeader().\n   *\n   * Not implemented. Not relevant for the MemoryWriter.\n   */\n  public function setHeader(PoHeader $header) {\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Gettext/PoMemoryWriter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PoMemoryWriter", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ProviderFilterDecorator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\Discovery;\n\nuse Drupal\\Component\\Plugin\\Discovery\\DiscoveryInterface;\nuse Drupal\\Component\\Plugin\\Discovery\\DiscoveryTrait;\n\n/**\n * Remove plugin definitions with non-existing providers.\n *\n * @internal\n *   This provides backwards compatibility for migration source plugins\n *   using annotations and having more than one provider. This functionality\n *   will be deprecated with plugin discovery by annotations in\n *   https://www.drupal.org/project/drupal/issues/3522409.\n */\nclass ProviderFilterDecorator implements DiscoveryInterface {\n\n  use DiscoveryTrait;\n\n  /**\n   * The Discovery object being decorated.\n   *\n   * @var \\Drupal\\Component\\Plugin\\Discovery\\DiscoveryInterface\n   */\n  protected $decorated;\n\n  /**\n   * A callable for testing if a provider exists.\n   *\n   * @var callable\n   */\n  protected $providerExists;\n\n  /**\n   * Constructs an InheritProviderDecorator object.\n   *\n   * @param \\Drupal\\Component\\Plugin\\Discovery\\DiscoveryInterface $decorated\n   *   The object implementing DiscoveryInterface that is being decorated.\n   * @param callable $provider_exists\n   *   A callable, gets passed a provider name, should return TRUE if the\n   *   provider exists and FALSE if not.\n   */\n  public function __construct(DiscoveryInterface $decorated, callable $provider_exists) {\n    $this->decorated = $decorated;\n    $this->providerExists = $provider_exists;\n  }\n\n  /**\n   * Removes plugin definitions with non-existing providers.\n   *\n   * @param mixed[] $definitions\n   *   An array of plugin definitions (empty array if no definitions were\n   *   found). Keys are plugin IDs.\n   * @param callable $provider_exists\n   *   A callable, gets passed a provider name, should return TRUE if the\n   *   provider exists and FALSE if not.\n   *\n   * @return array\n   *   An array of plugin definitions. If a definition is an array and has a\n   *   provider key that provider is guaranteed to exist.\n   */\n  public static function filterDefinitions(array $definitions, callable $provider_exists) {\n    // Besides what the caller accepts, we also accept core or component.\n    $provider_exists = function ($provider) use ($provider_exists) {\n      return in_array($provider, ['core', 'component']) || $provider_exists($provider);\n    };\n    return array_filter($definitions, function ($definition) use ($provider_exists) {\n      // Plugin definitions can be objects (for example, Typed Data) those will\n      // become empty array here and cause no problems.\n      $definition = (array) $definition + [\n        'provider' => [],\n        'providers' => [],\n      ];\n      // There can be one or many providers, handle them as multiple always.\n      $providers = $definition['providers'] ?: (array) $definition['provider'];\n      return count($providers) == count(array_filter($providers, $provider_exists));\n    });\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefinitions() {\n    return static::filterDefinitions($this->decorated->getDefinitions(), $this->providerExists);\n  }\n\n  /**\n   * Passes through all unknown calls onto the decorated object.\n   *\n   * @param string $method\n   *   The method to call on the decorated object.\n   * @param array $args\n   *   Call arguments.\n   *\n   * @return mixed\n   *   The return value from the method on the decorated object.\n   */\n  public function __call($method, array $args) {\n    return call_user_func_array([$this->decorated, $method], $args);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/Discovery/ProviderFilterDecorator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProviderFilterDecorator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CacheablePreconditionFailedHttpException in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Http\\Exception;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\CacheableDependencyTrait;\nuse Symfony\\Component\\HttpKernel\\Exception\\PreconditionFailedHttpException;\n\n/**\n * A cacheable PreconditionFailedHttpException.\n */\nclass CacheablePreconditionFailedHttpException extends PreconditionFailedHttpException implements CacheableDependencyInterface {\n\n  use CacheableDependencyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(CacheableDependencyInterface $cacheability, $message = '', ?\\Throwable $previous = NULL, $code = 0) {\n    $this->setCacheability($cacheability);\n    parent::__construct($message, $previous, $code);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Http/Exception/CacheablePreconditionFailedHttpException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CacheablePreconditionFailedHttpException", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: represents\nSource file: <source_file>\nFile name hint: Output.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\flowdrop\\DTO;\n\n/**\n * Output DTO for the flowdrop module.\n *\n * This class represents output data from node processors,\n * providing specialized methods for output handling.\n */\nclass Output extends Data implements OutputInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setOutput(string $key, mixed $value, ?callable $validator = NULL): static {\n    if ($validator !== NULL && !$validator($value)) {\n      throw new \\InvalidArgumentException(\"Invalid output value for key: {$key}\");\n    }\n\n    return $this->set($key, $value);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addMetadata(string $key, mixed $value): static {\n    $metadata = $this->get('metadata', []);\n    $metadata[$key] = $value;\n    return $this->set('metadata', $metadata);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(string $key, mixed $default = NULL): mixed {\n    $metadata = $this->get('metadata', []);\n    return $metadata[$key] ?? $default;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setStatus(string $status, ?string $message = NULL): static {\n    $this->set('status', $status);\n    if ($message !== NULL) {\n      $this->set('status_message', $message);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getStatus(): string {\n    return $this->get('status', 'unknown');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isSuccess(): bool {\n    return $this->getStatus() === 'success';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isError(): bool {\n    return $this->getStatus() === 'error';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setError(string $message, ?string $code = NULL): static {\n    $this->setStatus('error', $message);\n    if ($code !== NULL) {\n      $this->set('error_code', $code);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getErrorMessage(): ?string {\n    return $this->get('status_message');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getErrorCode(): ?string {\n    return $this->get('error_code');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setSuccess(?string $message = NULL): static {\n    $this->setStatus('success', $message);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSuccessMessage(): ?string {\n    return $this->getStatus() === 'success' ? $this->get('status_message') : NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addExecutionTime(float $execution_time): static {\n    return $this->set('execution_time', $execution_time);\n  }", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\DTO;\n\n/**\n * Output DTO for the flowdrop module.\n *\n * This class represents output data from node processors,\n * providing specialized methods for output handling.\n */\nclass Output extends Data implements OutputInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setOutput(string $key, mixed $value, ?callable $validator = NULL): static {\n    if ($validator !== NULL && !$validator($value)) {\n      throw new \\InvalidArgumentException(\"Invalid output value for key: {$key}\");\n    }\n\n    return $this->set($key, $value);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addMetadata(string $key, mixed $value): static {\n    $metadata = $this->get('metadata', []);\n    $metadata[$key] = $value;\n    return $this->set('metadata', $metadata);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(string $key, mixed $default = NULL): mixed {\n    $metadata = $this->get('metadata', []);\n    return $metadata[$key] ?? $default;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setStatus(string $status, ?string $message = NULL): static {\n    $this->set('status', $status);\n    if ($message !== NULL) {\n      $this->set('status_message', $message);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getStatus(): string {\n    return $this->get('status', 'unknown');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isSuccess(): bool {\n    return $this->getStatus() === 'success';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isError(): bool {\n    return $this->getStatus() === 'error';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setError(string $message, ?string $code = NULL): static {\n    $this->setStatus('error', $message);\n    if ($code !== NULL) {\n      $this->set('error_code', $code);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getErrorMessage(): ?string {\n    return $this->get('status_message');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getErrorCode(): ?string {\n    return $this->get('error_code');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setSuccess(?string $message = NULL): static {\n    $this->setStatus('success', $message);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSuccessMessage(): ?string {\n    return $this->getStatus() === 'success' ? $this->get('status_message') : NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addExecutionTime(float $execution_time): static {\n    return $this->set('execution_time', $execution_time);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getExecutionTime(): ?float {\n    return $this->get('execution_time');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAllOutput(): array {\n    return $this->toArray();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasOutputData(): bool {\n    return !$this->isEmpty();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputCount(): int {\n    return count($this->keys());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function mergeOutput(OutputInterface $other): static {\n    $this->data = array_merge($this->data, $other->toArray());\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/src/DTO/Output.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Output", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class LayoutBuilderRestrictionsByRegion in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Contains update functions for Layout Builder Restrictions by Region.\n */\n\n/**\n * Relocate 'whitelisted_' and 'blacklisted' to 'allowlisted' and 'denylisted'.\n */\nfunction layout_builder_restrictions_by_region_update_8201(&$sandbox) {\n  // When upgrading to 2.14, configuration for 'whitelisted_blocks'\n  // is relocated to 'allowlisted_blocks' and 'blacklisted_blocks' to'\n  // 'denylisted_blocks'. See #3179983.\n  $config_factory = \\Drupal::configFactory();\n\n  if (!isset($sandbox['count'])) {\n    $sandbox['ids'] = $config_factory->listAll('core.entity_view_display.');\n    $sandbox['count'] = count($sandbox['ids']);\n  }\n\n  $ids = array_splice($sandbox['ids'], 0, 50);\n  foreach ($ids as $id) {\n    $display = $config_factory->getEditable($id);\n    if ($display->get('third_party_settings.layout_builder_restrictions')) {\n      $allowed_blocks_by_category_whitelisted = $display->get('third_party_settings.layout_builder_restrictions.entity_view_mode_restriction_by_region.whitelisted_blocks');\n      $allowed_blocks_by_category_blacklisted = $display->get('third_party_settings.layout_builder_restrictions.entity_view_mode_restriction_by_region.blacklisted_blocks');\n      $display\n        ->clear('third_party_settings.layout_builder_restrictions.entity_view_mode_restriction_by_region.whitelisted_blocks')\n        ->set('third_party_settings.layout_builder_restrictions.entity_view_mode_restriction_by_region.allowlisted_blocks', $allowed_blocks_by_category_whitelisted)\n        ->clear('third_party_settings.layout_builder_restrictions.entity_view_mode_restriction_by_region.blacklisted_blocks')\n        ->set('third_party_settings.layout_builder_restrictions.entity_view_mode_restriction_by_region.denylisted_blocks', $allowed_blocks_by_category_blacklisted)\n        ->save();\n    }\n  }\n\n  $sandbox['#finished'] = empty($sandbox['ids']) ? 1 : ($sandbox['count'] - count($sandbox['ids'])) / $sandbox['count'];\n}\n", "metadata": {"source": "repos/layout_builder_restrictions/modules/layout_builder_restrictions_by_region/layout_builder_restrictions_by_region.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderRestrictionsByRegion", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: GeneratedUrl.php\nTarget symbol: class GeneratedUrl\nNamespace: Drupal\\Core\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for GeneratedUrl.\n- Include required imports:\n  - Drupal\\Core\\Render\\BubbleableMetadata\n- Ensure these methods exist where relevant:\n  - getGeneratedUrl()\n  - setGeneratedUrl()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core;\n\nuse Drupal\\Core\\Render\\BubbleableMetadata;\n\n/**\n * Used to return generated URLs, along with associated bubbleable metadata.\n *\n * Note: not to be confused with \\Drupal\\Core\\Url, which is for passing around\n *   URLs that are not generated (typically route name + route parameters).\n */\nclass GeneratedUrl extends BubbleableMetadata {\n\n  /**\n   * The string value of the URL.\n   *\n   * @var string\n   */\n  protected $generatedUrl = '';\n\n  /**\n   * Gets the generated URL.\n   *\n   * @return string\n   *   The generated URL.\n   */\n  public function getGeneratedUrl() {\n    return $this->generatedUrl;\n  }\n\n  /**\n   * Sets the generated URL.\n   *\n   * @param string $generated_url\n   *   The generated URL.\n   *\n   * @return $this\n   */\n  public function setGeneratedUrl($generated_url) {\n    $this->generatedUrl = $generated_url;\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/GeneratedUrl.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GeneratedUrl", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: FrontendController\nSource file: <source_file>\nFile name hint: FrontendController.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\webprofiler\\Controller;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\webprofiler\\Profiler\\Profiler;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Profiler\\Profile;\n\n/**\n * Collects frontend navigation and CWV data.\n */\nclass FrontendController extends ControllerBase {\n\n  /**\n   * FrontendController constructor.\n   *\n   * @param \\Drupal\\webprofiler\\Profiler\\Profiler $profiler\n   *   The profiler.\n   */\n  final public function __construct(private readonly Profiler $profiler) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): FrontendController {\n    return new static(\n      $container->get('webprofiler.profiler'),\n    );\n  }\n\n  /**\n   * Save the navigation data to frontend collector.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profile $profile\n   *   The profile.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The response.\n   */\n  public function saveNavigationDataAction(Profile $profile, Request $request): JsonResponse {\n    $this->profiler->disable();\n\n    $data = Json::decode($request->getContent());\n\n    /** @var \\Drupal\\webprofiler\\DataCollector\\FrontendDataCollector $collector */\n    $collector = $profile->getCollector('frontend');\n    $collector->setNavigationData($data);\n    $this->profiler->updateProfile($profile);\n\n    return new JsonResponse(['success' => TRUE]);\n  }\n\n  /**\n   * Save the Core Web Vitals data to frontend collector.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profile $profile\n   *   The profile.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The response.\n   */\n  public function saveCwvDataAction(Profile $profile, Request $request): JsonResponse {\n    $this->profiler->disable();\n\n    $data = Json::decode($request->getContent());\n\n    /** @var \\Drupal\\webprofiler\\DataCollector\\FrontendDataCollector $collector */\n    $collector = $profile->getCollector('frontend');\n    $collector->setCwvData($data);\n    $this->profiler->updateProfile($profile);\n\n    return new JsonResponse(['success' => TRUE]);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Controller;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\webprofiler\\Profiler\\Profiler;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Profiler\\Profile;\n\n/**\n * Collects frontend navigation and CWV data.\n */\nclass FrontendController extends ControllerBase {\n\n  /**\n   * FrontendController constructor.\n   *\n   * @param \\Drupal\\webprofiler\\Profiler\\Profiler $profiler\n   *   The profiler.\n   */\n  final public function __construct(private readonly Profiler $profiler) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): FrontendController {\n    return new static(\n      $container->get('webprofiler.profiler'),\n    );\n  }\n\n  /**\n   * Save the navigation data to frontend collector.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profile $profile\n   *   The profile.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The response.\n   */\n  public function saveNavigationDataAction(Profile $profile, Request $request): JsonResponse {\n    $this->profiler->disable();\n\n    $data = Json::decode($request->getContent());\n\n    /** @var \\Drupal\\webprofiler\\DataCollector\\FrontendDataCollector $collector */\n    $collector = $profile->getCollector('frontend');\n    $collector->setNavigationData($data);\n    $this->profiler->updateProfile($profile);\n\n    return new JsonResponse(['success' => TRUE]);\n  }\n\n  /**\n   * Save the Core Web Vitals data to frontend collector.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profile $profile\n   *   The profile.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   The response.\n   */\n  public function saveCwvDataAction(Profile $profile, Request $request): JsonResponse {\n    $this->profiler->disable();\n\n    $data = Json::decode($request->getContent());\n\n    /** @var \\Drupal\\webprofiler\\DataCollector\\FrontendDataCollector $collector */\n    $collector = $profile->getCollector('frontend');\n    $collector->setCwvData($data);\n    $this->profiler->updateProfile($profile);\n\n    return new JsonResponse(['success' => TRUE]);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Controller/FrontendController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FrontendController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DateRangeDatelistWidget in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime_range\\Plugin\\Field\\FieldWidget;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldWidget;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\datetime_range\\Plugin\\Field\\FieldType\\DateRangeItem;\n\n/**\n * Plugin implementation of the 'daterange_datelist' widget.\n */\n#[FieldWidget(\n  id: 'daterange_datelist',\n  label: new TranslatableMarkup('Select list'),\n  field_types: ['daterange'],\n)]\nclass DateRangeDatelistWidget extends DateRangeWidgetBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    return [\n      'increment' => '15',\n      'date_order' => 'YMD',\n      'time_type' => '24',\n    ] + parent::defaultSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function formElement(FieldItemListInterface $items, $delta, array $element, array &$form, FormStateInterface $form_state) {\n    $element = parent::formElement($items, $delta, $element, $form, $form_state);\n\n    $date_order = $this->getSetting('date_order');\n\n    if ($this->getFieldSetting('datetime_type') == DateRangeItem::DATETIME_TYPE_DATETIME) {\n      $time_type = $this->getSetting('time_type');\n      $increment = $this->getSetting('increment');\n    }\n    else {\n      $time_type = '';\n      $increment = '';\n    }\n\n    // Set up the date part order array.\n    switch ($date_order) {\n      default:\n      case 'YMD':\n        $date_part_order = ['year', 'month', 'day'];\n        break;\n\n      case 'MDY':\n        $date_part_order = ['month', 'day', 'year'];\n        break;\n\n      case 'DMY':\n        $date_part_order = ['day', 'month', 'year'];\n        break;\n    }\n    switch ($time_type) {\n      case '24':\n        $date_part_order = array_merge($date_part_order, ['hour', 'minute']);\n        break;\n\n      case '12':\n        $date_part_order = array_merge($date_part_order, ['hour', 'minute', 'ampm']);\n        break;\n\n      case 'none':\n        break;\n    }\n\n    $element['value'] = [\n      '#type' => 'datelist',\n      '#date_increment' => $increment,\n      '#date_part_order' => $date_part_order,\n    ] + $element['value'];\n\n    $element['end_value'] = [\n      '#type' => 'datelist',\n      '#date_increment' => $increment,\n      '#date_part_order' => $date_part_order,\n    ] + $element['end_value'];\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $element = parent::settingsForm($form, $form_state);\n\n    $element['date_order'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Date part order'),\n      '#default_value' => $this->getSetting('date_order'),\n      '#options' => [\n        'MDY' => $this->t('Month/Day/Year'),\n        'DMY' => $this->t('Day/Month/Year'),\n        'YMD' => $this->t('Year/Month/Day'),\n      ],\n    ];\n\n    if ($this->getFieldSetting('datetime_type') == DateRangeItem::DATETIME_TYPE_DATETIME) {\n      $element['time_type'] = [\n        '#type' => 'select',\n        '#title' => $this->t('Time type'),\n        '#default_value' => $this->getSetting('time_type'),\n        '#options' => ['24' => $this->t('24 hour time'), '12' => $this->t('12 hour time')],\n      ];\n\n      $element['increment'] = [\n        '#type' => 'select',\n        '#title' => $this->t('Time increments'),\n        '#default_value' => $this->getSetting('increment'),\n        '#options' => [\n          1 => $this->t('1 minute'),\n          5 => $this->t('@count minutes', ['@count' => 5]),\n          10 => $this->t('@count minutes', ['@count' => 10]),\n          15 => $this->t('@count minutes', ['@count' => 15]),\n          30 => $this->t('@count minutes', ['@count' => 30]),\n        ],\n      ];\n    }\n    else {\n      $element['time_type'] = [\n        '#type' => 'hidden',\n        '#value' => 'none',\n      ];\n\n      $element['increment'] = [\n        '#type' => 'hidden',\n        '#value' => $this->getSetting('increment'),\n      ];\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsSummary() {\n    $summary = [];\n\n    $summary[] = $this->t('Date part order: @order', ['@order' => $this->getSetting('date_order')]);\n    if ($this->getFieldSetting('datetime_type') == DateRangeItem::DATETIME_TYPE_DATETIME) {\n      $summary[] = $this->t('Time type: @time_type', ['@time_type' => $this->getSetting('time_type')]);\n      $summary[] = $this->t('Time increments: @increment', ['@increment' => $this->getSetting('increment')]);\n    }\n\n    return $summary;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime_range/src/Plugin/Field/FieldWidget/DateRangeDatelistWidget.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateRangeDatelistWidget", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "username_suggester.settings:\n  title: 'Username Suggester Settings'\n  description: 'Configure username suggestion settings.'\n  parent: user.admin_index\n  route_name: username_suggester.settings\n", "metadata": {"source": "repos/username_suggester/username_suggester.links.menu.yml", "type": "yaml_reference", "topic": "username suggester.links.menu"}}
{"instruction": "Show me the implementation of the class TokenBrowserHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\token_browser\\Hook;\n\nuse Drupal\\Core\\Render\\RendererInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Utility\\Token;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\token_browser\\TokenBrowserTreeBuilderInterface;\n\n/**\n * Hook implementations for token_browser.\n */\nfinal class TokenBrowserHooks {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly Token $token,\n    protected readonly TokenBrowserTreeBuilderInterface $treeBuilder,\n    protected readonly RendererInterface $renderer,\n  ) {\n  }\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?array {\n    if ($route_name == 'help.page.token_browser') {\n      $token_tree = $this->treeBuilder->buildAllRenderable([\n        'click_insert' => FALSE,\n        'show_restricted' => TRUE,\n        'show_nested' => FALSE,\n        'recursion_limit' => 1,\n      ]);\n\n      $output = '<h3>' . $this->t('About') . '</h3>';\n      $output .= '<p>' . $this->t('The <a href=\":project\">Token browser</a> module provides a user interface for the site token system. Tokens are specially formatted chunks of text that serve as placeholders for a dynamically generated value. For more information, covering both the token system and the additional tools provided by the Token module, see the <a href=\":online\">online documentation</a>.', [\n        ':online' => 'https://www.drupal.org/documentation/modules/token',\n        ':project' => 'https://www.drupal.org/project/token',\n      ]) . '</p>';\n      $output .= '<h3>' . $this->t('Uses') . '</h3>';\n      $output .= '<p>' . $this->t('Your website uses a shared token system for exposing and using placeholder tokens and their appropriate replacement values. This allows for any module to provide placeholder tokens for strings without having to reinvent the wheel. It also ensures consistency in the syntax used for tokens, making the system as a whole easier for end users to use.') . '</p>';\n      $output .= '<p>' . $this->t('The list of the currently available tokens on this site are shown below.') . '</p>';\n\n      return [\n        '#type' => 'container',\n        '#markup' => $output,\n        'table' => $token_tree,\n      ];\n    }\n\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/token_browser/src/Hook/TokenBrowserHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TokenBrowserHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: NormalizerRegistry.php\nTarget symbol: class NormalizerRegistry\nNamespace: Drupal\\api_normalization\\Service\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for NormalizerRegistry.\n- Include required imports:\n  - Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface\n  - Drupal\\api_normalization\\Plugin\\Normalizer\\OpenAINormalizer\n  - Drupal\\api_normalization\\Plugin\\Normalizer\\AnthropicNormalizer\n  - Drupal\\api_normalization\\Plugin\\Normalizer\\OllamaNormalizer\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getAllNormalizers()\n  - getNormalizer()\n  - getNormalizerWithFallback()\n  - getProviderIds()\n  - hasNormalizer()\n  - registerDefaultNormalizers()\n  - registerNormalizer()\n  - supportsOperation()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface;\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\OpenAINormalizer;\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\AnthropicNormalizer;\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\OllamaNormalizer;\n\n/**\n * Registry for managing provider normalizers.\n *\n * Central registry that maps provider IDs to their specific normalizer\n * implementations. Eliminates duplicate provider detection logic across\n * multiple services.\n */\nclass NormalizerRegistry {\n\n  /**\n   * Registered normalizers keyed by provider ID.\n   *\n   * @var \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface[]\n   */\n  protected array $normalizers = [];\n\n  /**\n   * The provider registry.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\ProviderRegistry\n   */\n  protected ProviderRegistry $providerRegistry;\n\n  /**\n   * Constructs a NormalizerRegistry.\n   *\n   * @param \\Drupal\\api_normalization\\Service\\ProviderRegistry $provider_registry\n   *   The provider registry service.\n   */\n  public function __construct(ProviderRegistry $provider_registry) {\n    $this->providerRegistry = $provider_registry;\n    $this->registerDefaultNormalizers();\n  }\n\n  /**\n   * Register default normalizers for known providers.\n   */\n  protected function registerDefaultNormalizers(): void {\n    $this->registerNormalizer(new OpenAINormalizer());\n    $this->registerNormalizer(new AnthropicNormalizer());\n    $this->registerNormalizer(new OllamaNormalizer());\n  }\n\n  /**\n   * Register a normalizer.\n   *\n   * @param \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface $normalizer\n   *   The normalizer to register.\n   *\n   * @return $this\n   */\n  public function registerNormalizer(NormalizerInterface $normalizer): self {\n    $this->normalizers[$normalizer->getProviderId()] = $normalizer;\n    return $this;\n  }\n\n  /**\n   * Get a normalizer by provider ID.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   *\n   * @return \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface|null\n   *   The normalizer, or NULL if not found.\n   */\n  public function getNormalizer(string $provider_id): ?NormalizerInterface {\n    // Clean provider ID (remove 'provider_' prefix if present).\n    $clean_id = str_replace('provider_', '', $provider_id);\n\n    return $this->normalizers[$clean_id] ?? NULL;\n  }\n\n  /**\n   * Check if a normalizer exists for a provider.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   *\n   * @return bool\n   *   TRUE if a normalizer exists, FALSE otherwise.\n   */\n  public function hasNormalizer(string $provider_id): bool {\n    return $this->getNormalizer($provider_id) !== NULL;\n  }\n\n  /**\n   * Get all registered normalizers.\n   *\n   * @return \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface[]\n   *   Array of normalizers keyed by provider ID.\n   */\n  public function getAllNormalizers(): array {\n    return $this->normalizers;\n  }\n\n  /**\n   * Get normalizer for a provider with automatic detection fallback.\n   *\n   * If no normalizer is found by exact provider ID, attempts to detect\n   * the provider from the given content/context.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   * @param string|null $detection_content\n   *   Optional content for provider detection fallback.\n   *\n   * @return \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface|null\n   *   The normalizer, or NULL if not found.\n   */\n  public function getNormalizerWithFallback(string $provider_id, ?string $detection_content = NULL): ?NormalizerInterface {\n    $normalizer = $this->getNormalizer($provider_id);\n\n    if ($normalizer === NULL && $detection_content !== NULL) {\n      // Try provider detection.\n      $detected_provider = $this->providerRegistry->detectProvider($detection_content);\n      $normalizer = $this->getNormalizer($detected_provider);\n    }\n\n    return $normalizer;\n  }\n\n  /**\n   * Get all provider IDs that have registered normalizers.\n   *\n   * @return array\n   *   Array of provider IDs.\n   */\n  public function getProviderIds(): array {\n    return array_keys($this->normalizers);\n  }\n\n  /**\n   * Check if a normalizer supports a specific operation.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   * @param string $operation\n   *   The operation name (e.g., 'chat', 'embeddings').\n   *\n   * @return bool\n   *   TRUE if the operation is supported, FALSE otherwise.\n   */\n  public function supportsOperation(string $provider_id, string $operation): bool {\n    $normalizer = $this->getNormalizer($provider_id);\n    return $normalizer ? $normalizer->supports($operation) : FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/NormalizerRegistry.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NormalizerRegistry", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SourceController.php\nTarget symbol: class SourceController\nNamespace: Drupal\\security_advisories_nl\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SourceController.\n- Include required imports:\n  - Drupal\\Core\\Controller\\ControllerBase\n  - Drupal\\Core\\Url\n- Ensure these methods exist where relevant:\n  - fetchSource()\n  - listSources()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\security_advisories_nl\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Url;\n\n/**\n * Controller for managing security advisory sources.\n */\nclass SourceController extends ControllerBase {\n\n  /**\n   * List all configured sources.\n   */\n  public function listSources() {\n    $config = $this->config('security_advisories_nl.settings');\n    $sources = $config->get('sources') ?? [];\n\n    $header = [\n      $this->t('Label'),\n      $this->t('ID'),\n      $this->t('Type'),\n      $this->t('URL'),\n      $this->t('Status'),\n      $this->t('Operations'),\n    ];\n\n    $rows = [];\n    foreach ($sources as $source) {\n      $operations = [\n        '#type' => 'operations',\n        '#links' => [\n          'edit' => [\n            'title' => $this->t('Edit'),\n            'url' => Url::fromRoute('security_advisories_nl.source_edit', ['source_id' => $source['id']]),\n          ],\n          'delete' => [\n            'title' => $this->t('Delete'),\n            'url' => Url::fromRoute('security_advisories_nl.source_delete', ['source_id' => $source['id']]),\n          ],\n          'fetch' => [\n            'title' => $this->t('Fetch now'),\n            'url' => Url::fromRoute('security_advisories_nl.source_fetch', ['source_id' => $source['id']]),\n          ],\n        ],\n      ];\n\n      $status = $source['enabled']\n        ? ['data' => ['#markup' => '<span style=\"color: green;\">\u2713 ' . $this->t('Enabled') . '</span>']]\n        : ['data' => ['#markup' => '<span style=\"color: gray;\">\u2717 ' . $this->t('Disabled') . '</span>']];\n\n      $color_badge = '<span style=\"display: inline-block; width: 12px; height: 12px; background: ' . ($source['color'] ?? '#6c757d') . '; border-radius: 2px; margin-right: 5px;\"></span>';\n\n      $rows[] = [\n        ['data' => ['#markup' => $color_badge . htmlspecialchars($source['label'])]],\n        $source['id'],\n        $source['type'],\n        [\n          'data' => [\n            '#markup' => '<a href=\"' . htmlspecialchars($source['url']) . '\" target=\"_blank\" rel=\"noopener\">' .\n              (strlen($source['url']) > 50 ? substr($source['url'], 0, 50) . '...' : $source['url']) .\n              '</a>',\n          ],\n        ],\n        $status,\n        ['data' => $operations],\n      ];\n    }\n\n    $build = [];\n\n    $build['description'] = [\n      '#markup' => '<p>' . $this->t('Manage the sources for security advisories. You can add RSS feeds, WordPress REST API endpoints, or generic JSON APIs.') . '</p>',\n    ];\n\n    $build['add_link'] = [\n      '#type' => 'link',\n      '#title' => $this->t('+ Add new source'),\n      '#url' => Url::fromRoute('security_advisories_nl.source_add'),\n      '#attributes' => [\n        'class' => ['button', 'button--primary'],\n        'style' => 'margin-bottom: 1rem;',\n      ],\n    ];\n\n    $build['table'] = [\n      '#type' => 'table',\n      '#header' => $header,\n      '#rows' => $rows,\n      '#empty' => $this->t('No sources configured. Click \"Add new source\" to get started.'),\n      '#attributes' => ['class' => ['sources-list']],\n    ];\n\n    return $build;\n  }\n\n  /**\n   * Fetch advisories from a single source.\n   */\n  public function fetchSource($source_id) {\n    $config = $this->config('security_advisories_nl.settings');\n    $sources = $config->get('sources') ?? [];\n\n    $source_config = NULL;\n    foreach ($sources as $source) {\n      if ($source['id'] === $source_id) {\n        $source_config = $source;\n        break;\n      }\n    }\n\n    if (!$source_config) {\n      $this->messenger()->addError($this->t('Source not found.'));\n      return $this->redirect('security_advisories_nl.sources');\n    }\n\n    /** @var \\Drupal\\security_advisories_nl\\Service\\AdvisoryFetcherService $fetcher */\n    $fetcher = \\Drupal::service('security_advisories_nl.fetcher');\n\n    try {\n      $result = $fetcher->fetchSource($source_id, $source_config);\n      $this->messenger()->addStatus($this->t('Fetched @count new advisories from %source.', [\n        '@count' => $result['count'],\n        '%source' => $source_config['label'],\n      ]));\n    }\n    catch (\\Exception $e) {\n      $this->messenger()->addError($this->t('Error fetching from %source: @message', [\n        '%source' => $source_config['label'],\n        '@message' => $e->getMessage(),\n      ]));\n    }\n\n    return $this->redirect('security_advisories_nl.sources');\n  }\n\n}\n", "metadata": {"source": "repos/security_advisories_nl/src/Controller/SourceController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SourceController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_stdio.commands:\n    class: Drupal\\mcp_tools_stdio\\Commands\\McpToolsStdioCommands\n    arguments:\n      - '@plugin.manager.tool'\n      - '@mcp_tools.access_manager'\n      - '@entity_type.manager'\n      - '@account_switcher'\n      - '@event_dispatcher'\n      - '@logger.channel.mcp_tools_stdio'\n    tags:\n      - { name: drush.command }\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_stdio/drush.services.yml", "type": "yaml_reference", "topic": "drush.services"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DeleteBundleOperation\nSource file: <source_file>\nFile name hint: DeleteBundleOperation.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\eb\\Plugin\\EbOperation;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\eb\\Attribute\\EbOperation;\nuse Drupal\\eb\\Exception\\ExecutionException;\nuse Drupal\\eb\\PluginBase\\OperationBase;\nuse Drupal\\eb\\Result\\ExecutionResult;\nuse Drupal\\eb\\Result\\PreviewResult;\nuse Drupal\\eb\\Result\\RollbackResult;\nuse Drupal\\eb\\Result\\ValidationResult;\nuse Drupal\\eb\\Service\\DiscoveryServiceInterface;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Operation for deleting entity bundles.\n */\n#[EbOperation(\n  id: 'delete_bundle',\n  label: new TranslatableMarkup('Delete Bundle'),\n  description: new TranslatableMarkup('Deletes a bundle and all its fields'),\n  operationType: 'delete',\n)]\nclass DeleteBundleOperation extends OperationBase {\n\n  /**\n   * Constructor.\n   */\n  public function __construct(\n    array $configuration,\n    string $plugin_id,\n    mixed $plugin_definition,\n    EntityTypeManagerInterface $entityTypeManager,\n    LoggerInterface $logger,\n    ConfigFactoryInterface $configFactory,\n    protected DiscoveryServiceInterface $discoveryService,\n    protected EntityFieldManagerInterface $entityFieldManager,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $entityTypeManager, $logger, $configFactory);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    /** @var \\Psr\\Log\\LoggerInterface $logger */\n    $logger = $container->get('logger.channel.eb');\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('entity_type.manager'),\n      $logger,\n      $container->get('config.factory'),\n      $container->get('eb.discovery_service'),\n      $container->get('entity_field.manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(): ValidationResult {\n    $result = new ValidationResult();\n\n    $this->validateRequiredFields(['entity_type', 'bundle_id'], $result);\n\n    if (!$result->isValid()) {\n      return $result;\n    }\n\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    $validation = $this->discoveryService->validateEntityBundle($entity_type, $bundle_id);\n    if (!$validation['valid']) {\n      foreach ($validation['errors'] as $error) {\n        $result->addError($error, 'bundle_id', 'bundle_not_found');\n      }\n    }\n    else {\n      $result->addWarning(\n        $this->t('WARNING: Deleting this bundle will delete all content and fields.')\n      );\n    }\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preview(): PreviewResult {\n    $preview = new PreviewResult();\n\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    $preview->addOperation(\n      'delete',\n      'bundle',\n      $bundle_id,\n      $this->t('Delete bundle @bundle from @type', [\n        '@bundle' => $bundle_id,\n        '@type' => $entity_type,\n      ])\n    );\n\n    $preview->addDetails([\n      'Entity Type' => $entity_type,\n      'Bundle ID' => $bundle_id,\n      'WARNING' => 'All content and fields will be deleted',\n    ]);\n\n    return $preview;", "output": "<?php\n\nnamespace Drupal\\eb\\Plugin\\EbOperation;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\eb\\Attribute\\EbOperation;\nuse Drupal\\eb\\Exception\\ExecutionException;\nuse Drupal\\eb\\PluginBase\\OperationBase;\nuse Drupal\\eb\\Result\\ExecutionResult;\nuse Drupal\\eb\\Result\\PreviewResult;\nuse Drupal\\eb\\Result\\RollbackResult;\nuse Drupal\\eb\\Result\\ValidationResult;\nuse Drupal\\eb\\Service\\DiscoveryServiceInterface;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Operation for deleting entity bundles.\n */\n#[EbOperation(\n  id: 'delete_bundle',\n  label: new TranslatableMarkup('Delete Bundle'),\n  description: new TranslatableMarkup('Deletes a bundle and all its fields'),\n  operationType: 'delete',\n)]\nclass DeleteBundleOperation extends OperationBase {\n\n  /**\n   * Constructor.\n   */\n  public function __construct(\n    array $configuration,\n    string $plugin_id,\n    mixed $plugin_definition,\n    EntityTypeManagerInterface $entityTypeManager,\n    LoggerInterface $logger,\n    ConfigFactoryInterface $configFactory,\n    protected DiscoveryServiceInterface $discoveryService,\n    protected EntityFieldManagerInterface $entityFieldManager,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $entityTypeManager, $logger, $configFactory);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    /** @var \\Psr\\Log\\LoggerInterface $logger */\n    $logger = $container->get('logger.channel.eb');\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $container->get('entity_type.manager'),\n      $logger,\n      $container->get('config.factory'),\n      $container->get('eb.discovery_service'),\n      $container->get('entity_field.manager'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(): ValidationResult {\n    $result = new ValidationResult();\n\n    $this->validateRequiredFields(['entity_type', 'bundle_id'], $result);\n\n    if (!$result->isValid()) {\n      return $result;\n    }\n\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    $validation = $this->discoveryService->validateEntityBundle($entity_type, $bundle_id);\n    if (!$validation['valid']) {\n      foreach ($validation['errors'] as $error) {\n        $result->addError($error, 'bundle_id', 'bundle_not_found');\n      }\n    }\n    else {\n      $result->addWarning(\n        $this->t('WARNING: Deleting this bundle will delete all content and fields.')\n      );\n    }\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preview(): PreviewResult {\n    $preview = new PreviewResult();\n\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    $preview->addOperation(\n      'delete',\n      'bundle',\n      $bundle_id,\n      $this->t('Delete bundle @bundle from @type', [\n        '@bundle' => $bundle_id,\n        '@type' => $entity_type,\n      ])\n    );\n\n    $preview->addDetails([\n      'Entity Type' => $entity_type,\n      'Bundle ID' => $bundle_id,\n      'WARNING' => 'All content and fields will be deleted',\n    ]);\n\n    return $preview;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(): ExecutionResult {\n    $entity_type = $this->getDataValue('entity_type');\n    $bundle_id = $this->getDataValue('bundle_id');\n\n    return $this->executeWithErrorHandling(function () use ($entity_type, $bundle_id) {\n      $entity_type_definitions = $this->discoveryService->getAllEntityTypes();\n      $bundle_entity_type = $entity_type_definitions[$entity_type]['bundle_entity_type'];\n\n      $bundle_storage = $this->entityTypeManager->getStorage($bundle_entity_type);\n      $bundle = $bundle_storage->load($bundle_id);\n\n      if (!$bundle) {\n        throw new ExecutionException(\"Bundle '{$bundle_id}' not found\");\n      }\n\n      // Store configuration for rollback.\n      $bundle_config = $bundle->toArray();\n\n      // Delete the bundle.\n      $bundle->delete();\n\n      $this->entityFieldManager->clearCachedFieldDefinitions();\n\n      $result = new ExecutionResult(TRUE);\n      $result->addAffectedEntityById($bundle_entity_type, $bundle_id);\n      $result->setRollbackData([\n        'bundle_entity_type' => $bundle_entity_type,\n        'bundle_config' => $bundle_config,\n        'entity_type' => $entity_type,\n      ]);\n\n      $this->logInfo('Deleted bundle: @bundle', ['@bundle' => $bundle_id]);\n\n      return $result;\n    }, 'delete bundle');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function rollback(): RollbackResult {\n    $rollback_data = $this->getRequiredRollbackData();\n\n    return $this->rollbackWithErrorHandling(function () use ($rollback_data) {\n      $bundle_storage = $this->entityTypeManager->getStorage($rollback_data['bundle_entity_type']);\n      $bundle = $bundle_storage->create($rollback_data['bundle_config']);\n      $bundle->save();\n\n      $this->entityFieldManager->clearCachedFieldDefinitions();\n\n      $bundle_id = $rollback_data['bundle_config']['id'] ?? 'unknown';\n      $this->logInfo('Rolled back bundle deletion: @bundle', ['@bundle' => $bundle_id]);\n\n      $result = new RollbackResult(TRUE);\n      $result->addMessage($this->t('Successfully rolled back bundle deletion'));\n\n      return $result;\n    }, 'bundle deletion');\n  }\n\n}\n", "metadata": {"source": "repos/eb/src/Plugin/EbOperation/DeleteBundleOperation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeleteBundleOperation", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Umami: Drupal demonstration installation profile", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Specific version(s)](/docs/getting-started/umami-drupal-demonstration-installation-profile#s-specific-versions)\n* [How to install Umami?](/docs/getting-started/umami-drupal-demonstration-installation-profile#s-how-to-install-umami)\n* [Why is Umami just for demo use?](/docs/getting-started/umami-drupal-demonstration-installation-profile#s-why-is-umami-just-for-demo-use)\n* [Umami theme](/docs/getting-started/umami-drupal-demonstration-installation-profile#s-umami-theme)\n* [What to do when you are ready to build your Drupal website?](/docs/getting-started/umami-drupal-demonstration-installation-profile#s-what-to-do-when-you-are-ready-to-build-your-drupal-website)\n* [We are a Drupal agency and want to use Umami to sell Drupal](/docs/getting-started/umami-drupal-demonstration-installation-profile#s-we-are-a-drupal-agency-and-want-to-use-umami-to-sell-drupal)\n\n## [Getting started](/docs/getting-started)\n\n* [System requirements](/docs/getting-started/system-requirements)\n* [Installing Drupal](/docs/getting-started/installing-drupal)\n* [Accessibility](/docs/getting-started/accessibility)\n* [Understanding Drupal](/docs/getting-started/understanding-drupal)\n* [Umami: Drupal demonstration installation profile](/docs/getting-started/umami-drupal-demonstration-installation-profile)\n* [Distributions](/docs/getting-started/drupal-distributions)\n* [Multisite Drupal](/docs/getting-started/multisite-drupal)\n* [Sustainability](/docs/getting-started/sustainability)\n\n# Umami: Drupal demonstration installation profile\n\nLast [updated](/node/2941833/discuss) on\n\n6 May 2024\n\nThis documentation **needs review**. See \"Help improve this page\" in the sidebar.\n\n**The Umami installation profile is for demo purposes only**.\n\n#### Specific version(s)\n\nContent for the following Drupal versions: 8, 9, 10, 11.\n\nUmami is an example food magazine website to demonstrate some of the features of Drupal core. It is intended to be used as a demo site, and not suitable as a foundation for building your own site. It is part of the Drupal core ideas [Out of The Box initiative](https://www.drupal.org/node/2847582).\n\nSome of the Umami **features**:\n\n* content: nodes (3 content types), taxonomies (2 vocabularies)\n* media library with images\n* content moderation\n* layout builder\n\n![ header](/files/umami-homepage-01-header.jpg)\n*Umami homepage: header.*\n\n## How to install Umami?\n\nThe Umami can be installed from the **Choose profile** step when you install Drupal\u00a0by selecting the **Demo: Umami Food Magazine (Experimental)** profile or use the profile name `demo_umami` if installing using `drush site:install`.\n\n![Selecting Umami installation profile](/files/drupal-guide-installation-umami.gif)\n*Selecting Umami installation profile.*\n\n## Why is Umami just for demo use?\n\nThe Umami feature set will change and improve over time as new features are added to Drupal, and there is no promise of backward compatibility. Later Drupal versions may make changes that are still compatible with your existing install, but even then the latest content and configuration changes will not take effect until you reinstall. We may also make changes that break your current install, such as modify content types and theme code built around that or introduce dynamic editable layouts instead of hardcoding them in the theme. Changes like that will break your existing Drupal demo install.\n\nFeel free to tinker around with the demo, create and modify views, edit fields, add pages. Nothing is locked down. Umami is a fully functioning demo of Drupal with several core features demonstrated, so you can explore by modifying bits and pieces.\n\n## Umami theme\n\nUmami theme is located at\u00a0`core/profiles/demo_umami/themes/umami/` and is not using base theme.\n\n![ footer](/files/umami-homepage-03-footer.jpg)\n*Umami homepage: footer.*\n\n## What to do when you are ready to build your Drupal website?\n\nOnce you've tried Drupal using Umami and want to build your own site, simply reinstall Drupal selecting the `Minimal` or `Standard` profiles from the install screen. You will then be able to upgrade to future versions of Drupal at will since those two profiles maintain backward compatibility.\n\n## We are a Drupal agency and want to use Umami to sell Drupal\n\nYay! We wish you great success.\n\nWhile Drupal core itself is very capable, it is natural that you may want to add certain contributed modules or customize the demo in other ways. Unfortunately, Drupal core does not support [inheritance in install profiles](https://www.drupal.org/project/drupal/issues/3266057) yet. However, using that patch, you can build your derivative install profile which expands Umami and adds your desired elements. We are eager to see profiles expanding Umami contributed to drupal.org.\n\nThank you for installing Umami. We hope you like it!\n\n## Help improve this page\n\n**Page status:**  Needs review\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2941833/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282941833%29%20Umami%3A%20Drupal%20demonstration%20installation%20profile) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/umami-drupal-demonstration-installation-profile.md", "type": "doc_summary", "topic": "Umami: Drupal demonstration installation profile"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "media.tasks:\n  deriver: 'Drupal\\media\\Plugin\\Derivative\\DynamicLocalTasks'\n\nentity.media_type.edit_form:\n  title: Edit\n  route_name: entity.media_type.edit_form\n  base_route: entity.media_type.edit_form\n\nentity.media_type.collection:\n  title: List\n  route_name: entity.media_type.collection\n  base_route: entity.media_type.collection\n\nentity.media.collection:\n  title: Media\n  route_name: entity.media.collection\n  base_route: system.admin_content\n  weight: 10\n", "metadata": {"source": "repos/drupal_core/core/modules/media/media.links.task.yml", "type": "yaml_reference", "topic": "media.links.task"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Quota Errors: Behavior and Troubleshooting", "input": "", "output": "# Quota Errors: Behavior and Troubleshooting\n\nThis guide explains how quota errors are handled and how to troubleshoot them.\n\n## What Happens When Quota Is Exceeded\n- Job items remain **Active/In progress** and are **retried automatically**.\n- The queue worker treats quota errors as **transient**.\n- Content saves are **not blocked** (continuous translation queues items).\n\n## Where to See the Error\n### 1) TMGMT Job Item Messages (Primary)\n- Go to `/admin/tmgmt/jobs`\n- Open a job and inspect the job items\n\n**Expected message**:\n```\nTranslation quota exceeded. Job item will be automatically retried when quota is available.\nError: You have exceeded your \"api_translation_chars\" quota\n```\n\n### 2) Job Item State\n- Items stay in **Active/In progress**, not **Needs review**.\n\n### 3) Queue Status\n```bash\ndrush queue:list\n```\nLook for `tmgmt_laratranslate_worker` and pending items.\n\n### 4) Logs (Optional)\n```bash\ndrush watchdog:show --type=tmgmt_laratranslate | grep quota\n```\n\n## Troubleshooting Checklist\n1. Confirm cron is running (queue processing depends on cron).\n2. Check queue depth with `drush queue:list`.\n3. Run the worker manually:\n   ```bash\n   drush queue:run tmgmt_laratranslate_worker\n   ```\n4. Verify quota availability in your Lara account.\n5. After quota is restored, run the worker again.\n\n## Common Questions\n**Q: Why aren\u2019t items marked \u201cNeeds review\u201d?**\nA: Quota errors are transient. Items stay active so they can retry automatically.\n\n**Q: Can quota errors block content saves?**\nA: No. Continuous translation queues items and returns immediately, so saves complete.\n\n## For Maintainers (Short Notes)\n- Quota detection: `LaraTranslator::translateData()` rethrows quota exceptions.\n- Retry behavior: `LaraTranslatorWorker::isTransientError()` treats quota as transient and re-queues.\n- Non-blocking saves: `requestJobItemsTranslation()` queues items instead of translating synchronously.\n", "metadata": {"source": "repos/tmgmt_laratranslate/doc/QUOTA_ERROR_HANDLING.md", "type": "doc_summary", "topic": "Quota Errors: Behavior and Troubleshooting"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Quick Start Guide", "input": "", "output": "# Quick Start Guide\n\nGet up and running with Entity Builder in under 5 minutes.\n\n## Prerequisites\n\n- Drupal 11.x\n- PHP 8.3+\n- Composer\n\n## Installation\n\n```bash\n# Install Entity Builder and dependencies\ncomposer require drupal/eb drupal/eb_aggrid drupal/eb_field_group drupal/eb_pathauto drupal/eb_auto_entitylabel\n\n# Install AG-Grid library (requires Asset Packagist - see Installation Guide)\ncomposer require npm-asset/ag-grid-community:33.0.0\n\n# Enable all modules\ndrush en eb eb_ui eb_aggrid eb_field_group eb_pathauto eb_auto_entitylabel field_group pathauto auto_entitylabel -y\n\n# Clear cache\ndrush cr\n```\n\n!!! tip \"Recommended: AG-Grid Interface\"\n    The `eb_aggrid` module provides a powerful spreadsheet-like AG-Grid interface for managing definitions. **Strongly recommended** for the best visual editing experience. Requires the AG-Grid library via [Asset Packagist](https://asset-packagist.org/) - see [Installation Guide](installation.md#entity-builder-ag-grid-eb_aggrid) for setup.\n\n## Quick Start\n\n### Step 1: Navigate to Entity Builder\n\nGo to **Configuration > Development > Entity Builder** (`/admin/config/development/eb`)\n\n### Step 2: Create a New Definition\n\n1. Click **Add definition**\n2. Enter a **Label** (e.g., \"Blog Architecture\")\n3. The **ID** will auto-generate from the label\n\n### Step 3: Define Bundles\n\nClick the **Bundles** tab to add content types, vocabularies, or media types:\n\n| Entity Type | Bundle ID | Label | Description |\n|-------------|-----------|-------|-------------|\n| taxonomy_term | blog_category | Blog Categories | Categories for blog posts |\n| node | blog_post | Blog Post | Blog articles |\n\n### Step 4: Define Fields\n\nClick the **Fields** tab to add fields to your bundles:\n\n| Entity Type | Bundle | Field Name | Field Type | Label | Widget | Formatter |\n|-------------|--------|------------|------------|-------|--------|-----------|\n| node | blog_post | field_category | entity_reference | Category | options_select | entity_reference_label |\n| node | blog_post | field_image | image | Featured Image | image_image | image |\n| node | blog_post | field_summary | text_long | Summary | text_textarea | text_default |\n\n### Step 5: Define Field Groups (Optional)\n\nIf you have `eb_field_group` enabled, click the **Field Groups** tab to organize fields into tabs, fieldsets, or accordions.\n\n### Step 6: Validate, Preview, Apply\n\n1. Click **Validate** to check for errors\n2. Click **Preview** to see planned operations\n3. Click **Apply** to execute\n\n---\n\n## Demo: Job Board Platform\n\nOptionally, import a complete Job Board Platform example to explore Entity Builder features:\n\n```bash\ndrush eb:import web/modules/custom/eb/tests/fixtures/examples/job_board_platform.yml && drush cr\n```\n\nThen visit `/admin/config/development/eb`, click **Job Board Platform**, and click **Apply**.\n\nThis creates 7 taxonomies, 4 content types, 60+ fields, 40+ field groups, URL patterns, and auto-generated labels. Study the YAML at `tests/fixtures/examples/job_board_platform.yml`.\n\n---\n\n## Re-Running Definitions (Smart Sync)\n\nEntity Builder uses **smart sync** - you can safely re-run definitions:\n\n- **New items**: Created\n- **Changed items**: Updated\n- **Unchanged items**: Skipped\n\n---\n\n## Next Steps\n\n- [Core Concepts](concepts.md) - Understand the architecture\n- [YAML Format Reference](yaml-format.md) - Complete YAML specification\n- [Operations Guide](operations.md) - All available operations\n- [AG-Grid Extension](../modules/eb_aggrid/index.md) - Spreadsheet-like interface\n- [Field Group Extension](../modules/eb_field_group/index.md) - Tabbed forms and fieldsets\n- [Pathauto Extension](../modules/eb_pathauto/index.md) - URL alias patterns\n- [Auto Entity Label Extension](../modules/eb_auto_entitylabel/index.md) - Automatic titles\n- [Drush Commands](drush.md) - Full CLI reference\n\n## Troubleshooting\n\n### \"Field type not found\" Error\n\n```bash\ncomposer require drupal/datetime && drush en datetime -y\n```\n\n### \"Bundle already exists\" Error\n\nIn `sync` mode, existing bundles are updated. Use `create_only` mode to fail on duplicates.\n\n### Permission Denied\n\n```bash\ndrush role:perm:add administrator \"administer entity builder\"\n```\n\n### Validation Errors in UI\n\n- Hover over red-highlighted cells for error details\n- Check that entity types and bundles exist\n- Verify field type compatibility with widgets/formatters\n", "metadata": {"source": "repos/eb/docs/users/quickstart.md", "type": "doc_summary", "topic": "Quick Start Guide"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: to\nSource file: <source_file>\nFile name hint: PreviewAwarePluginInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Plugin;\n\n/**\n * Provides an interface to support preview mode injection in plugins.\n *\n * Block and layout plugins can implement this interface to be informed when\n * preview mode is being used in Layout Builder.\n *\n * @see \\Drupal\\layout_builder\\Event\\SectionComponentBuildRenderArrayEvent\n * @see \\Drupal\\layout_builder\\Section::toRenderArray()\n */\ninterface PreviewAwarePluginInterface {\n\n  /**\n   * Set preview mode for the plugin.\n   *\n   * @param bool $in_preview\n   *   TRUE if the plugin should be set to preview mode, FALSE otherwise.\n   */\n  public function setInPreview(bool $in_preview): void;\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\n/**\n * Provides an interface to support preview mode injection in plugins.\n *\n * Block and layout plugins can implement this interface to be informed when\n * preview mode is being used in Layout Builder.\n *\n * @see \\Drupal\\layout_builder\\Event\\SectionComponentBuildRenderArrayEvent\n * @see \\Drupal\\layout_builder\\Section::toRenderArray()\n */\ninterface PreviewAwarePluginInterface {\n\n  /**\n   * Set preview mode for the plugin.\n   *\n   * @param bool $in_preview\n   *   TRUE if the plugin should be set to preview mode, FALSE otherwise.\n   */\n  public function setInPreview(bool $in_preview): void;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/PreviewAwarePluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PreviewAwarePluginInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a 'form' element.\n *\n * Available variables\n * - attributes: A list of HTML attributes for the wrapper element.\n * - children: The child elements of the form.\n *\n * @see\\Drupal\\Core\\Form\\FormPreprocess::preprocessForm()\n */\n#}\n<form{{ attributes }}>\n  {{ children }}\n</form>\n", "metadata": {"source": "repos/drupal_core/core/themes/stable9/templates/form/form.html.twig", "type": "twig_reference"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Zip.php\nTarget symbol: class Zip\nNamespace: Drupal\\system\\Plugin\\Archiver\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Zip.\n- Include required imports:\n  - Drupal\\Core\\Archiver\\Attribute\\Archiver\n  - Drupal\\Core\\Archiver\\Zip as BaseZip\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup", "output": "<?php\n\nnamespace Drupal\\system\\Plugin\\Archiver;\n\nuse Drupal\\Core\\Archiver\\Attribute\\Archiver;\nuse Drupal\\Core\\Archiver\\Zip as BaseZip;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines an archiver implementation for .zip files.\n *\n * @link http://php.net/zip\n */\n#[Archiver(\n  id: 'Zip',\n  title: new TranslatableMarkup('Zip'),\n  description: new TranslatableMarkup('Handles zip files.'),\n  extensions: ['zip']\n)]\nclass Zip extends BaseZip {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/Archiver/Zip.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Zip", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<nav aria-label=\"{{ 'You are here:'|t }}\">\n  <ol{{ attributes.addClass('breadcrumb') }}>\n    {% for item in items %}\n      {% if item.url %}\n        <li class=\"breadcrumb-item\">\n          <a href=\"{{ item.url }}\">{{ item.title }}</a>\n        </li>\n      {% else %}\n        <li class=\"breadcrumb-item active\" aria-current=\"page\">\n          {{ item.title }}\n        </li>\n      {% endif %}\n    {% endfor %}\n  </ol>\n</nav>\n", "metadata": {"source": "repos/bootstrap_components/components/breadcrumb/breadcrumb.twig", "type": "twig_reference"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Image Hotspot Agent", "input": "", "output": "# Image Hotspot Agent\n\n<table>\n<tr>\n<td width=\"60%\" valign=\"top\">\n\nAdds interactive image hotspots to paragraphs. Editors can place clickable hotspots on images with titles, descriptions, image and links.\n\n## Features\n\n- **Interactive Hotspots**: Place clickable hotspots anywhere on images within paragraphs\n- **Multiple Display Variants**: Choose from modal popup, sidebar, full screen, zoom in\n- **Rich Content**: Each hotspot can include:\n  - Title\n  - Description (formatted text)\n  - Optional image\n  - Link with custom text\n- **Customizable Styling**: Configure hotspot colors, sizes, and display options\n- **Access Control**: Granular permissions for creating, editing, and viewing hotspots\n\n</td>\n<td width=\"40%\" valign=\"top\">\n\n![Hotspot Example - Add Hotspots](assets/hotspot-image-one.png)\n\n![Hotspot Example - Hotspots](assets/hotspot-image-two.png)\n\n![Hotspot Example - Sidebar View Open](assets/hotspot-image-three.png)\n\n</td>\n</tr>\n</table>\n\n## Requirements\n\n- Drupal 10 or 11\n- Media module (core)\n- Paragraphs module\n\n## Installation\n\n1. Install the module using Composer:\n   ```bash\n   composer require drupal/image_hotspot_agent\n   ```\n\n   Or download and place the module in `modules/custom/image_hotspot_agent` or `modules/contrib/image_hotspot_agent`.\n\n2. Enable the module:\n   ```bash\n   drush en image_hotspot_agent\n   ```\n\n   Or via the admin interface at `/admin/modules`.\n\n3. Configure permissions at `/admin/people/permissions`:\n   - **Administer hotspots**: Full access to create, edit, and delete hotspots\n   - **Create hotspots**: Create new hotspots\n   - **Edit own hotspots**: Edit hotspots created by the user\n   - **Edit any hotspot**: Edit any hotspot\n   - **Delete own hotspots**: Delete hotspots created by the user\n   - **Delete any hotspot**: Delete any hotspot\n\n## Configuration\n\n### Enable Hotspots on Paragraph Types\n\n1. Go to `/admin/structure/paragraphs_type` and edit a paragraph type\n2. Enable the \"Image Hotspot Agent\" behavior\n3. Configure which image field to use for hotspots\n4. Set default display options (variant, position, colors, sizes)\n\n### Configure Global Settings\n\n1. Go to `admin/config/content/image-hotspot-agent`\n2. Configure available color themes for hotspots\n3. Set available hotspot sizes\n4. Configure default display options\n\n## Usage\n\n### Creating Hotspots\n\n1. Add a paragraph with an image field that has the Image Hotspot Agent behavior enabled\n2. View the content on the frontend\n3. Click the \"Add Hotspot\" button (if you have permission)\n4. Click on the image where you want to place a hotspot\n5. Fill in the hotspot details:\n   - Title (required)\n   - Description (optional, supports formatted text)\n   - Image (optional)\n   - Link URL and text (optional)\n6. Save the hotspot\n\n\n### Editing Hotspots\n\n1. View content with hotspots on the frontend\n2. Click on an existing hotspot\n3. Click \"Edit\" in the hotspot popup\n4. Modify the hotspot details\n5. Save changes\n\n### Display Variants\n\n- **Popup modal**: Opens hotspot content in a modal dialog\n- **Sidebar**: Displays hotspot content in a sidebar panel\n- **Fullscreen modal**: Displays full screen modal\n- **Zoom in**: Zooms in on hotspot point and displays a infobox in corner\n\n### Hotspots Not Appearing\n\n1. Verify the paragraph type has the Image Hotspot Agent behavior enabled\n2. Check that the correct image field is selected in the behavior settings\n3. Ensure you have permission to view hotspots\n4. Clear Drupal cache: `drush cr`\n\n### Editor Not Loading\n\n1. Check browser console for JavaScript errors\n2. Verify the paragraph has a valid image field with content\n3. Ensure the image field is configured correctly in the behavior settings\n\n## Maintainers\n\n- [Your name/username]\n\n## Support\n\nFor bug reports and feature requests, please use the [issue queue](https://www.drupal.org/project/issues/image_hotspot_agent).\n\n## License\n\nThis project is licensed under the GNU General Public License v2.0 or later.\n", "metadata": {"source": "repos/image_hotspots_agent/README.md", "type": "doc_summary", "topic": "Image Hotspot Agent"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nslots:\n  label: Submit\nprops:\n  disabled: false\n  label_visually_hidden: false\n  url: \"https://example.com\"\n", "metadata": {"source": "repos/bootstrap_components/components/button/stories/button.default.story.yml", "type": "yaml_reference", "topic": "button.default.story"}}
{"instruction": "Show me the implementation of the class DateTimeDefaultFormatter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Datetime\\DrupalDateTime;\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Plugin implementation of the 'Default' formatter for 'datetime' fields.\n */\n#[FieldFormatter(\n  id: 'datetime_default',\n  label: new TranslatableMarkup('Default'),\n  field_types: [\n    'datetime',\n  ],\n)]\nclass DateTimeDefaultFormatter extends DateTimeFormatterBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultSettings() {\n    return [\n      'format_type' => 'medium',\n    ] + parent::defaultSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function formatDate($date) {\n    $format_type = $this->getSetting('format_type');\n    $timezone = $this->getSetting('timezone_override') ?: $date->getTimezone()->getName();\n    return $this->dateFormatter->format($date->getTimestamp(), $format_type, '', $timezone != '' ? $timezone : NULL);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsForm(array $form, FormStateInterface $form_state) {\n    $form = parent::settingsForm($form, $form_state);\n\n    $time = new DrupalDateTime();\n    $format_types = $this->dateFormatStorage->loadMultiple();\n    $options = [];\n    foreach ($format_types as $type => $type_info) {\n      $format = $this->dateFormatter->format($time->getTimestamp(), $type);\n      $options[$type] = $type_info->label() . ' (' . $format . ')';\n    }\n\n    $form['format_type'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Date format'),\n      '#description' => $this->t(\"Choose a format for displaying the date. Be sure to set a format appropriate for the field, i.e. omitting time for a field that only has a date.\"),\n      '#options' => $options,\n      '#default_value' => $this->getSetting('format_type'),\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function settingsSummary() {\n    $summary = parent::settingsSummary();\n\n    $date = new DrupalDateTime();\n    $summary[] = $this->t('Format: @display', ['@display' => $this->formatDate($date)]);\n\n    return $summary;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/Field/FieldFormatter/DateTimeDefaultFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateTimeDefaultFormatter", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mautic_content_provider.settings:\n  type: config_object\n  label: 'Mautic Content Provider Settings'\n  mapping:\n    allowed_bundles:\n      type: sequence\n      label: 'Allowed Content Types'\n      sequence:\n        type: string\n    allowed_view_modes:\n      type: sequence\n      label: 'Allowed View Modes'\n      sequence:\n        type: string\n    fallback_view_mode:\n      type: string\n      label: 'Fallback View Mode'\n\n# Schema for the Views Display Plugin\nviews.display.mautic_email_display:\n  type: views_display\n  label: 'Mautic email content'\n", "metadata": {"source": "repos/mautic_content_provider/config/schema/mautic_content_provider.schema.yml", "type": "yaml_reference", "topic": "mautic content provider.schema"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ListRecipes\nSource file: <source_file>\nFile name hint: ListRecipes.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_recipes\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_recipes\\Service\\RecipesService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_recipes_list',\n  label: new TranslatableMarkup('List Recipes'),\n  description: new TranslatableMarkup('List all available Drupal Recipes from site, core, and contrib sources.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'recipes' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Available Recipes'),\n      description: new TranslatableMarkup('List of available recipes with name, label, description, type, source, and path.'),\n    ),\n    'count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Recipe Count'),\n      description: new TranslatableMarkup('Total number of available recipes.'),\n    ),\n    'sources' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Recipe Sources'),\n      description: new TranslatableMarkup('List of directories where recipes were found.'),\n    ),\n  ],\n)]\nclass ListRecipes extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'recipes';\n\n\n  /**\n   * The recipes service.\n   */\n  protected RecipesService $recipesService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->recipesService = $container->get('mcp_tools_recipes.recipes');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->recipesService->listRecipes();\n  }\n\n\n\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_recipes\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_recipes\\Service\\RecipesService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_recipes_list',\n  label: new TranslatableMarkup('List Recipes'),\n  description: new TranslatableMarkup('List all available Drupal Recipes from site, core, and contrib sources.'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'recipes' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Available Recipes'),\n      description: new TranslatableMarkup('List of available recipes with name, label, description, type, source, and path.'),\n    ),\n    'count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Recipe Count'),\n      description: new TranslatableMarkup('Total number of available recipes.'),\n    ),\n    'sources' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Recipe Sources'),\n      description: new TranslatableMarkup('List of directories where recipes were found.'),\n    ),\n  ],\n)]\nclass ListRecipes extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'recipes';\n\n\n  /**\n   * The recipes service.\n   */\n  protected RecipesService $recipesService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->recipesService = $container->get('mcp_tools_recipes.recipes');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->recipesService->listRecipes();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_recipes/src/Plugin/tool/Tool/ListRecipes.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListRecipes", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: token_browser.module\nSource file: <source_file>\nFile name hint: token_browser.module\nCurrent implementation:\n<?php\n\n/**\n * @file\n * Provides alternative token browser element.\n */\n\nuse Drupal\\token_browser\\Hook\\TokenBrowserThemeHooks;\n\n/**\n * Theme a link to a token tree shown as a dialog.\n */\nfunction template_preprocess_token_browser_link(&$variables): void {\n  \\Drupal::service(TokenBrowserThemeHooks::class)->preprocessTokenBrowserLink($variables);\n}", "output": "<?php\n\n/**\n * @file\n * Provides alternative token browser element.\n */\n\nuse Drupal\\token_browser\\Hook\\TokenBrowserThemeHooks;\n\n/**\n * Theme a link to a token tree shown as a dialog.\n */\nfunction template_preprocess_token_browser_link(&$variables): void {\n  \\Drupal::service(TokenBrowserThemeHooks::class)->preprocessTokenBrowserLink($variables);\n}\n", "metadata": {"source": "repos/token_browser/token_browser.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TokenBrowser", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class DefaultSummary in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\style;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsStyle;\n\n/**\n * The default style plugin for summaries.\n *\n * @ingroup views_style_plugins\n */\n#[ViewsStyle(\n  id: \"default_summary\",\n  title: new TranslatableMarkup(\"List\"),\n  help: new TranslatableMarkup(\"Displays the default summary as a list.\"),\n  theme: \"views_view_summary\",\n  display_types: [\"summary\"],\n)]\nclass DefaultSummary extends StylePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n\n    $options['base_path'] = ['default' => ''];\n    $options['count'] = ['default' => TRUE];\n    $options['override'] = ['default' => FALSE];\n    $options['items_per_page'] = ['default' => 25];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    if (!empty($this->options['override'])) {\n      $this->view->setItemsPerPage(intval($this->options['items_per_page']));\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    $form['base_path'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Base path'),\n      '#default_value' => $this->options['base_path'],\n      '#description' => $this->t('Define the base path for links in this summary\n        view, i.e. http://example.com/<strong>your_view_path/archive</strong>.\n        Do not include beginning and ending forward slash. If this value\n        is empty, views will use the first path found as the base path,\n        in page displays, or / if no path could be found.'),\n    ];\n    $form['count'] = [\n      '#type' => 'checkbox',\n      '#default_value' => !empty($this->options['count']),\n      '#title' => $this->t('Display record count with link'),\n    ];\n    $form['override'] = [\n      '#type' => 'checkbox',\n      '#default_value' => !empty($this->options['override']),\n      '#title' => $this->t('Override number of items to display'),\n    ];\n\n    $form['items_per_page'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Items to display'),\n      '#default_value' => $this->options['items_per_page'],\n      '#states' => [\n        'visible' => [\n          ':input[name=\"options[summary][options][' . $this->definition['id'] . '][override]\"]' => ['checked' => TRUE],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render() {\n    $rows = [];\n    foreach ($this->view->result as $row) {\n      // @todo Include separator as an option.\n      $rows[] = $row;\n    }\n\n    return [\n      '#theme' => $this->themeFunctions(),\n      '#view' => $this->view,\n      '#options' => $this->options,\n      '#rows' => $rows,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/style/DefaultSummary.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DefaultSummary", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface SupportsTemporaryTablesInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Database;\n\n/**\n * Adds support for temporary tables.\n *\n * @ingroup database\n */\ninterface SupportsTemporaryTablesInterface {\n\n  /**\n   * Runs a SELECT query and stores its results in a temporary table.\n   *\n   * Use this as a substitute for ->query() when the results need to stored\n   * in a temporary table. Temporary tables exist for the duration of the page\n   * request. User-supplied arguments to the query should be passed in as\n   * separate parameters so that they can be properly escaped to avoid SQL\n   * injection attacks.\n   *\n   * Note that if you need to know how many results were returned, you should do\n   * a SELECT COUNT(*) on the temporary table afterwards.\n   *\n   * @param string $query\n   *   A string containing a normal SELECT SQL query.\n   * @param array $args\n   *   (optional) An array of values to substitute into the query at placeholder\n   *   markers.\n   * @param array $options\n   *   (optional) An associative array of options to control how the query is\n   *   run. See the documentation for DatabaseConnection::defaultOptions() for\n   *   details.\n   *\n   * @return string\n   *   The name of the temporary table.\n   */\n  public function queryTemporary($query, array $args = [], array $options = []);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/SupportsTemporaryTablesInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SupportsTemporaryTablesInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DataEntityRow in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\rest\\Plugin\\views\\row;\n\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Entity\\Render\\EntityTranslationRenderTrait;\nuse Drupal\\views\\Plugin\\views\\row\\RowPluginBase;\n\n/**\n * Plugin which displays entities as raw data.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\n  id: \"data_entity\",\n  title: new TranslatableMarkup(\"Entity\"),\n  help: new TranslatableMarkup(\"Use entities as row data.\"),\n  display_types: [\"data\"]\n)]\nclass DataEntityRow extends RowPluginBase {\n\n  use EntityTranslationRenderTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesOptions = FALSE;\n\n  /**\n   * Contains the entity type of this row plugin instance.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeInterface\n   */\n  protected $entityType;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity repository service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * The entity display repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface\n   */\n  protected $entityDisplayRepository;\n\n  /**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   */\n  protected $languageManager;\n\n  /**\n   * Constructs a new DataEntityRow object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(array $configuration, $plugin_id, array $plugin_definition, EntityTypeManagerInterface $entity_type_manager, LanguageManagerInterface $language_manager, EntityRepositoryInterface $entity_repository) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->entityTypeManager = $entity_type_manager;\n    $this->languageManager = $language_manager;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($row) {\n    return $this->getEntityTranslationByRelationship($row->_entity, $row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEntityTypeId() {\n    return $this->view->getBaseEntityType()->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityTypeManager() {\n    return $this->entityTypeManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityRepository() {\n    return $this->entityRepository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getLanguageManager() {\n    return $this->languageManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getView() {\n    return $this->view;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    parent::query();\n    $this->getEntityTranslationRenderer()->query($this->view->getQuery());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/rest/src/Plugin/views/row/DataEntityRow.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DataEntityRow", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: PintoEntityCompilerPass\nSource file: <source_file>\nFile name hint: PintoEntityCompilerPass.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity\\DependencyInjection;\n\nuse Drupal\\pinto\\PintoMappingFactory;\nuse Drupal\\pinto_entity\\EntityView\\Attribute\\EntityView;\nuse Pinto\\Attribute\\Definition;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\n\n/**\n * @phpstan-type PintoEntityMapping array<array{\n *   \\Drupal\\pinto_entity\\EntityView\\Bundle,\n *   \\Drupal\\pinto_entity\\EntityView\\ViewMode,\n *   string,\n *   string[],\n *   string[],\n * }>\n */\nfinal class PintoEntityCompilerPass implements CompilerPassInterface {\n\n  public function process(ContainerBuilder $container): void {\n    /** @var array<class-string<\\Pinto\\List\\ObjectListInterface>> $enumClasses */\n    $enumClasses = $container->getDefinition(PintoMappingFactory::class)->getArgument('$enumClasses');\n\n    /** @var PintoEntityMapping $mapping */\n    $mapping = [];\n    foreach ($enumClasses as $enumClass) {\n      foreach ($enumClass::cases() as $case) {\n        $rCase = new \\ReflectionEnumUnitCase($case::class, $case->name);\n        $definitionAttr = ($rCase->getAttributes(Definition::class)[0] ?? NULL)?->newInstance();\n        if (NULL !== $definitionAttr) {\n          $componentClass = $definitionAttr->className;\n\n          $rClass = new \\ReflectionClass($componentClass);\n\n          \\array_push($mapping, ...\\iterator_to_array(EntityView::findOnClass($rClass, [$componentClass])));\n        }\n\n      }\n    }\n\n    // Serialize until https://www.drupal.org/project/drupal/issues/3522410 is resolved.\n    $container->setParameter('pinto_entity.mapping', \\serialize($mapping));\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity\\DependencyInjection;\n\nuse Drupal\\pinto\\PintoMappingFactory;\nuse Drupal\\pinto_entity\\EntityView\\Attribute\\EntityView;\nuse Pinto\\Attribute\\Definition;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\n\n/**\n * @phpstan-type PintoEntityMapping array<array{\n *   \\Drupal\\pinto_entity\\EntityView\\Bundle,\n *   \\Drupal\\pinto_entity\\EntityView\\ViewMode,\n *   string,\n *   string[],\n *   string[],\n * }>\n */\nfinal class PintoEntityCompilerPass implements CompilerPassInterface {\n\n  public function process(ContainerBuilder $container): void {\n    /** @var array<class-string<\\Pinto\\List\\ObjectListInterface>> $enumClasses */\n    $enumClasses = $container->getDefinition(PintoMappingFactory::class)->getArgument('$enumClasses');\n\n    /** @var PintoEntityMapping $mapping */\n    $mapping = [];\n    foreach ($enumClasses as $enumClass) {\n      foreach ($enumClass::cases() as $case) {\n        $rCase = new \\ReflectionEnumUnitCase($case::class, $case->name);\n        $definitionAttr = ($rCase->getAttributes(Definition::class)[0] ?? NULL)?->newInstance();\n        if (NULL !== $definitionAttr) {\n          $componentClass = $definitionAttr->className;\n\n          $rClass = new \\ReflectionClass($componentClass);\n\n          \\array_push($mapping, ...\\iterator_to_array(EntityView::findOnClass($rClass, [$componentClass])));\n        }\n\n      }\n    }\n\n    // Serialize until https://www.drupal.org/project/drupal/issues/3522410 is resolved.\n    $container->setParameter('pinto_entity.mapping', \\serialize($mapping));\n  }\n\n}\n", "metadata": {"source": "repos/pinto_entity/src/DependencyInjection/PintoEntityCompilerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PintoEntityCompilerPass", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: RequestProcessing\nSource file: <source_file>\nFile name hint: RequestProcessing.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\api_normalization\\Service\\NormalizationOrchestrator;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Processes API normalization requests from queue.\n *\n * @QueueWorker(\n *   id = \"api_normalization_request_processing\",\n *   title = @Translation(\"Request Processing\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass RequestProcessing extends QueueWorkerBase {\n\n  /**\n   * The normalization orchestrator.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\NormalizationOrchestrator\n   */\n  protected NormalizationOrchestrator $orchestrator;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs a RequestProcessing queue worker.\n   *\n   * @param array $configuration\n   *   Configuration.\n   * @param string $plugin_id\n   *   Plugin ID.\n   * @param mixed $plugin_definition\n   *   Plugin definition.\n   * @param \\Drupal\\api_normalization\\Service\\NormalizationOrchestrator $orchestrator\n   *   The normalization orchestrator.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    NormalizationOrchestrator $orchestrator,\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->orchestrator = $orchestrator;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    if (!isset($data['endpoint_data']) || !is_array($data['endpoint_data'])) {\n      $this->logger->error('Invalid queue item data');\n      return;\n    }\n\n    try {\n      $this->orchestrator->normalize($data['endpoint_data'], $data['options'] ?? []);\n      $this->logger->info('Processed request from queue: @id', [\n        '@id' => $data['request_id'] ?? 'unknown',\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process request from queue: @error', [\n        '@error' => $e->getMessage(),\n      ]);\n      throw $e;\n    }\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\api_normalization\\Service\\NormalizationOrchestrator;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Processes API normalization requests from queue.\n *\n * @QueueWorker(\n *   id = \"api_normalization_request_processing\",\n *   title = @Translation(\"Request Processing\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass RequestProcessing extends QueueWorkerBase {\n\n  /**\n   * The normalization orchestrator.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\NormalizationOrchestrator\n   */\n  protected NormalizationOrchestrator $orchestrator;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs a RequestProcessing queue worker.\n   *\n   * @param array $configuration\n   *   Configuration.\n   * @param string $plugin_id\n   *   Plugin ID.\n   * @param mixed $plugin_definition\n   *   Plugin definition.\n   * @param \\Drupal\\api_normalization\\Service\\NormalizationOrchestrator $orchestrator\n   *   The normalization orchestrator.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    NormalizationOrchestrator $orchestrator,\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->orchestrator = $orchestrator;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    if (!isset($data['endpoint_data']) || !is_array($data['endpoint_data'])) {\n      $this->logger->error('Invalid queue item data');\n      return;\n    }\n\n    try {\n      $this->orchestrator->normalize($data['endpoint_data'], $data['options'] ?? []);\n      $this->logger->info('Processed request from queue: @id', [\n        '@id' => $data['request_id'] ?? 'unknown',\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process request from queue: @error', [\n        '@error' => $e->getMessage(),\n      ]);\n      throw $e;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/QueueWorker/RequestProcessing.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RequestProcessing", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  theme:\n    - stark\nid: stark_local_actions\ntheme: stark\nregion: content\nweight: -10\nprovider: null\nplugin: local_actions_block\nsettings:\n  id: local_actions_block\n  label: 'Primary admin actions'\n  label_display: '0'\n  provider: core\nvisibility: {  }\n", "metadata": {"source": "repos/drupal_core/core/profiles/minimal/config/install/block.block.stark_local_actions.yml", "type": "yaml_reference", "topic": "block.block.stark local actions"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: BreadcrumbAnalyzer.php\nTarget symbol: class BreadcrumbAnalyzer\nNamespace: Drupal\\seo_audit\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BreadcrumbAnalyzer.\n- Include required imports:\n  - Symfony\\Component\\DomCrawler\\Crawler\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n- Ensure these methods exist where relevant:\n  - analyze()\n  - getJsonLdBreadcrumbMarkup()\n  - getVisualBreadcrumbMarkup()\n  - hasJsonLdBreadcrumb()\n  - hasVisualBreadcrumb()", "output": "<?php\n\nnamespace Drupal\\seo_audit;\n\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Analyzes the presence and markup of breadcrumbs on a webpage.\n */\nclass BreadcrumbAnalyzer {\n\n  use StringTranslationTrait;\n\n  /**\n   * Analyzes a webpage for breadcrumb presence and markup.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance for the page.\n   *\n   * @return array\n   *   An associative array containing:\n   *   - has_visual: Whether a visual breadcrumb is found.\n   *   - has_jsonld: Whether a JSON-LD breadcrumb is found.\n   *   - visual_markup: The HTML of visual breadcrumbs.\n   *   - jsonld_markup: The raw JSON-LD breadcrumb scripts.\n   */\n  public function analyze(Crawler $crawler): array {\n    return [\n      'has_visual' => $this->hasVisualBreadcrumb($crawler),\n      'has_jsonld' => $this->hasJsonLdBreadcrumb($crawler),\n      'visual_markup' => $this->getVisualBreadcrumbMarkup($crawler),\n      'jsonld_markup' => $this->getJsonLdBreadcrumbMarkup($crawler),\n    ];\n  }\n\n  /**\n   * Checks if a visual breadcrumb exists.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return string\n   *   'Found' if a visual breadcrumb is detected, otherwise 'Missing'.\n   */\n  private function hasVisualBreadcrumb(Crawler $crawler): string {\n    return $crawler->filter('nav[aria-label=\"breadcrumb\"], [class*=\"breadcrumb\"], [id*=\"breadcrumb\"]')->count() > 0 ? $this->t('Found') : $this->t('Missing');\n  }\n\n  /**\n   * Checks if a JSON-LD breadcrumb exists.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return string\n   *   'Found' if a JSON-LD breadcrumb is detected, otherwise 'Missing'.\n   */\n  private function hasJsonLdBreadcrumb(Crawler $crawler): string {\n    return count($this->getJsonLdBreadcrumbMarkup($crawler)) > 0 ? $this->t('Found') : $this->t('Missing');\n  }\n\n  /**\n   * Gets the HTML markup of visual breadcrumbs.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return array\n   *   An array of HTML strings representing breadcrumb elements.\n   */\n  private function getVisualBreadcrumbMarkup(Crawler $crawler): array {\n    $markup = [];\n    $nodes = $crawler->filter('nav[aria-label=\"breadcrumb\"], [class*=\"breadcrumb\"], [id*=\"breadcrumb\"]');\n\n    foreach ($nodes as $node) {\n      $dom = new \\DOMDocument();\n      @$dom->appendChild($dom->importNode($node, TRUE));\n      $markup[] = trim($dom->saveHTML());\n    }\n\n    return $markup;\n  }\n\n  /**\n   * Gets JSON-LD breadcrumb markup from script tags.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return array\n   *   An array of raw JSON-LD strings representing breadcrumb data.\n   */\n  private function getJsonLdBreadcrumbMarkup(Crawler $crawler): array {\n    $markup = [];\n\n    $crawler->filterXPath('//script[@type=\"application/ld+json\"]')->each(function (Crawler $node) use (&$markup) {\n      $jsonText = $node->text();\n      $json = json_decode($jsonText, TRUE);\n\n      if (json_last_error() !== JSON_ERROR_NONE) {\n        return;\n      }\n\n      $objects = is_array($json) && array_keys($json) === range(0, count($json) - 1) ? $json : [$json];\n\n      foreach ($objects as $obj) {\n        if (($obj['@type'] ?? '') === 'BreadcrumbList') {\n          $markup[] = $jsonText;\n        }\n      }\n    });\n\n    return $markup;\n  }\n\n}\n", "metadata": {"source": "repos/seo_audit/src/BreadcrumbAnalyzer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BreadcrumbAnalyzer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Drupal Accessibility (a11y) Office Hours", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Accessibility](/docs/getting-started/accessibility)\n\n* [Drupal Accessibility Features](/docs/accessibility/drupal-accessibility-features)\n* [Contributed Modules for Extending Accessibility in Drupal](/docs/getting-started/accessibility/contributed-modules-for-extending-accessibility-in-drupal)\n* [How to Ensure Your Contribution is Accessible](/docs/getting-started/accessibility/how-to-ensure-your-contribution-is-accessible)\n* [How to do an accessibility review?](/docs/getting-started/accessibility/how-to-do-an-accessibility-review)\n* [External Accessibility Resources](/docs/accessibility/external-accessibility-resources)\n* [Drupal Accessibility (a11y) Office Hours](/docs/getting-started/accessibility/drupal-accessibility-a11y-office-hours)\n* [Accessibility Coding Standards](https://www.drupal.org/docs/develop/standards/accessibility-coding-standards)\n* [Hide Content Properly](/docs/getting-started/accessibility/hide-content-properly)\n* [Accessibility Conformance Report (ACR) Process](/docs/getting-started/accessibility/accessibility-conformance-report-acr-process)\n\n# Drupal Accessibility (a11y) Office Hours\n\nLast [updated](/node/3107258/discuss) on\n\n18 December 2025\n\nJoin us live on a [Google Meet](http://meet.google.com/sco-rdrc-vjd) on the 3rd Thursday of every month. To accommodate more time zones, it will be at:\n\n* **Beginning of the North America workday: February, April, June, August, October & December** **[15:00 UTC](https://time.is/compare/1600_UTC/CET/UK/ET/PT/Tokyo/Melbourne)**\n* **End of the North America workday: January, March, May, July, September & November**\n  **[20:00 UTC](https://time.is/compare/2100_UTC/CET/UK/ET/PT/Tokyo/Melbourne)**\n\nif you would like to be added to those calendars, please ask on Drupal Slack (the *Accessibility* channel).\n\n* [Drupal Association Calendar](https://calendar.google.com/calendar/u/0/embed?src=drupalcorecalendar@association.drupal.org)\n* [a11y Office Hours Google Meet link](http://meet.google.com/sco-rdrc-vjd)\n* [a11y Office Hours Agenda - bit.ly/drupal-a11y-oh - (editable)](https://docs.google.com/document/d/1JvXK7iUF1XOHCWeRJ4BmepyeSH9prjMK-4jOb2wRlE4/edit?usp=sharing)\n* [a11y Office Meeting Notes](https://docs.google.com/document/d/1T9qz5LD5Qopu86UoBzFdga8dfDLBiFjES_Q0JHiMOLw/edit#heading=h.8u6drsvvk97k)\n\nDuring this time, we will be available to answer questions and review projects, live and in real time, with you.\n\nNote that this event represents office hours that are generally good for North America, though we tried to find a time that might work for the most international range of times possible. We may also try to set up additional office hours that are geared towards other time zones if this will be useful.\n\nPlease feel free to add agenda items\u00a0to the attached Google Doc.\n\nFor more information on accessible contributions, we have added a new guide in the Drupal Core Accessibility documentation: [How to ensure your contribution is accessible](/docs/accessibility/how-to-ensure-your-contribution-is-accessible).\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3107258/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283107258%29%20Drupal%20Accessibility%20%28a11y%29%20Office%20Hours) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/getting-started/accessibility/drupal-accessibility-a11y-office-hours.md", "type": "doc_summary", "topic": "Drupal Accessibility (a11y) Office Hours"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'MCP Tools - Sitemap'\ntype: module\ndescription: 'Simple XML Sitemap integration: manage sitemap variants, settings, entity inclusion, and regeneration.'\npackage: MCP Tools\ncore_version_requirement: ^10.3 || ^11\ndependencies:\n  - mcp_tools:mcp_tools\n  - simple_sitemap:simple_sitemap\nlifecycle: experimental\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_sitemap/mcp_tools_sitemap.info.yml", "type": "yaml_reference", "topic": "mcp tools sitemap.info"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: 1.3. Concept: Themes", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Prerequisite knowledge](/docs/user_guide/en/understanding-themes.html#s-prerequisite-knowledge)\n* [What is a Theme?](/docs/user_guide/en/understanding-themes.html#s-what-is-a-theme)\n* [Related topics](/docs/user_guide/en/understanding-themes.html#s-related-topics)\n* [Additional resources](/docs/user_guide/en/understanding-themes.html#s-additional-resources)\n\n## [Chapter 1. Understanding Drupal](/docs/user_guide/en/understanding-chapter.html)\n\n* [1.1. Concept: Drupal as a Content Management System](/docs/user_guide/en/understanding-drupal.html)\n* [1.2. Concept: Modules](/docs/user_guide/en/understanding-modules.html)\n* [1.3. Concept: Themes](/docs/user_guide/en/understanding-themes.html)\n* [1.4. Concept: Distributions](/docs/user_guide/en/understanding-distributions.html)\n* [1.5. Concept: Types of Data](/docs/user_guide/en/understanding-data.html)\n* [1.6. Concept: The Drupal Project](/docs/user_guide/en/understanding-project.html)\n* [1.7. Concept: Drupal Licensing](/docs/user_guide/en/understanding-gpl.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/understanding-themes.html \"1.3. Concepte: Temes\")\n* [Magyar](/hu/docs/user_guide/hu/understanding-themes.html \"1.3. Alapfogalom: a sminkek\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/understanding-themes.html \"1.3. Concept: Themes\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/understanding-themes.html \"1.3. \u041e\u0441\u043d\u043e\u0432\u0438: \u0422\u0435\u043c\u0438\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/understanding-themes.html \"1.3. \u6982\u5ff5\uff1a\u4e3b\u9898\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/understanding-themes.html \"1.3. Concept : th\u00e8mes\")\n* [Deutsch](/de/docs/user_guide/de/understanding-themes.html \"1.3. Konzept: Themes\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/understanding-themes.html \"1.3. \u0645\u0641\u0647\u0648\u0645: \u0642\u0627\u0644\u0628\u200c\u0647\u0627\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/understanding-themes.html \"1.3. Concept: Themes\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/understanding-themes.html \"1.3. \u6982\u5ff5: \u30c6\u30fc\u30de\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/understanding-themes.html \"1.3. Concept: Themes\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/understanding-themes.html \"1.3. \u041e\u0441\u043d\u043e\u0432\u044b: \u0422\u0435\u043c\u044b \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u044f\")\n\n# 1.3. Concept: Themes\n\nLast [updated](/node/2827286/discuss) on\n\n14 April 2025\n\n### Prerequisite knowledge\n\n[Section\u00a01.1, \u201cConcept: Drupal as a Content Management System\u201d](/docs/user_guide/en/understanding-drupal.html \" Drupal as a Content Management System\")\n\n### What is a Theme?\n\nA theme is a set of files that define the visual look and feel of your site.\nThe core software and modules that run on your site determine which\n*content* (including HTML text and other data stored in the database, uploaded\nimages, and any other asset files) is displayed on the pages of your site. The\ntheme determines the HTML markup and CSS styling that wraps the content.\n\nThe core software provides several basic themes with the core distribution.\nThese themes have largely been designed and built by the community over the last\nseveral years and will all be good choices for building your first sites and\nbecoming more familiar with how the core software works.\n\nDrupal is a well-established CMS so the market for 3rd party themes - both free\nand paid - is very robust.\n\nIf none of the 3rd party options suit your needs, you\u2019ll need to create a custom\ntheme. A custom theme can be as simple as a single CSS file that adds styling to\nthe markup provided by the core software. Guidance for creating custom themes in\nDrupal can be found in the\n[*Drupal.org* community documentation page\n\"Theming Drupal\"](https://www.drupal.org/docs/theming-drupal).\n\n### Related topics\n\n* [Section\u00a011.4, \u201cFinding Themes\u201d](/docs/user_guide/en/extend-theme-find.html \"11.4.\u00a0Finding Themes\")\n* [Section\u00a011.5, \u201cDownloading and Installing a Theme from *Drupal.org*\u201d](/docs/user_guide/en/extend-theme-install.html \"11.5.\u00a0Downloading and Installing a Theme from Drupal.org\")\n* [Section\u00a01.2, \u201cConcept: Modules\u201d](/docs/user_guide/en/understanding-modules.html \" Modules\")\n\n### Additional resources\n\n[*Drupal.org* community documentation page \"Theming Drupal\"](https://www.drupal.org/docs/theming-drupal)\n\n**Attributions**\n\nWritten and edited by [John Grubb](https://www.drupal.org/u/jgrubb) and\n[Jennifer Hodgdon](https://www.drupal.org/u/jhodgdon).\n\nNext [\u2192 1.4. Concept: Distributions](/docs/user_guide/en/understanding-distributions.html)\n\nPrevious [\u2190 1.2. Concept: Modules](/docs/user_guide/en/understanding-modules.html)\n\n##\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: understanding-themes.asciidoc\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2827286/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282827286%29%201.3.%20Concept%3A%20Themes) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/understanding-themes.md", "type": "doc_summary", "topic": "1.3. Concept: Themes"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "ckeditor5.upload_image:\n  path: '/ckeditor5/upload-image/{editor}'\n  defaults:\n    _controller: '\\Drupal\\ckeditor5\\Controller\\CKEditor5ImageController::upload'\n  methods: [POST]\n  requirements:\n    _entity_access: 'editor.use'\n    _custom_access: '\\Drupal\\ckeditor5\\Controller\\CKEditor5ImageController::imageUploadEnabledAccess'\n    _csrf_token: 'TRUE'\n  options:\n    parameters:\n      editor:\n        type: entity:editor\n\nckeditor5.media_entity_metadata:\n  path: '/ckeditor5/{editor}/media-entity-metadata'\n  defaults:\n    _controller: '\\Drupal\\ckeditor5\\Controller\\CKEditor5MediaController::mediaEntityMetadata'\n  methods: [GET]\n  requirements:\n    _entity_access: 'editor.use'\n    _custom_access: '\\Drupal\\ckeditor5\\Controller\\CKEditor5MediaController::access'\n    _csrf_token: 'TRUE'\n  options:\n    parameters:\n      editor:\n        type: entity:editor\n\nckeditor5.entity_link_suggestions:\n  path: '/ckeditor5/{editor}/entity-link-suggestions'\n  defaults:\n    _controller: '\\Drupal\\ckeditor5\\Controller\\EntityLinkSuggestionsController::suggestions'\n  methods: [GET]\n  requirements:\n    _entity_access: 'editor.use'\n    _custom_access: '\\Drupal\\ckeditor5\\Controller\\EntityLinkSuggestionsController::formatUsesEntityLinksFilter'\n    # The returned information relies on entity reference selection plugins ensuring only entities are returned that the\n    # current user is allowed to see.\n    _csrf_token: 'TRUE'\n  options:\n    parameters:\n      editor:\n        type: entity:editor\n    no_cache: TRUE\n    _theme: ajax_base_page\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/ckeditor5.routing.yml", "type": "yaml_reference", "topic": "ckeditor5.routing"}}
{"instruction": "Show me the implementation of the class StatisticsLastUpdated in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\comment\\Plugin\\views\\field;\n\nuse Drupal\\views\\Attribute\\ViewsField;\nuse Drupal\\views\\Plugin\\views\\field\\Date;\n\n/**\n * Field handler to display the newer of last comment / node updated.\n *\n * @ingroup views_field_handlers\n */\n#[ViewsField(\"comment_ces_last_updated\")]\nclass StatisticsLastUpdated extends Date {\n\n  /**\n   * The node table.\n   */\n  // phpcs:ignore Drupal.NamingConventions.ValidVariableName.LowerCamelName\n  protected ?string $node_table;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $this->ensureMyTable();\n    $this->node_table = $this->query->ensureTable('node_field_data', $this->relationship);\n    $this->field_alias = $this->query->addField(NULL, \"GREATEST(\" . $this->node_table . \".changed, \" . $this->tableAlias . \".last_comment_timestamp)\", $this->tableAlias . '_' . $this->field);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/Plugin/views/field/StatisticsLastUpdated.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StatisticsLastUpdated", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: SiteExportCommand\nSource file: <source_file>\nFile name hint: SiteExportCommand.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\drupal_cms_helper\\Drush\\Commands;\n\nuse Composer\\InstalledVersions;\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Recipe\\Recipe;\nuse Drupal\\drupal_cms_helper\\SiteExporter;\nuse Drush\\Commands\\AutowireTrait;\nuse Drush\\Style\\DrushStyle;\nuse Symfony\\Component\\Console\\Attribute\\AsCommand;\nuse Symfony\\Component\\Console\\Command\\Command;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Input\\InputOption;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\n/**\n * @internal\n *   This is an internal part of Drupal CMS and may be changed or removed at any\n *   time without warning. External code should not interact with this class.\n */\n#[AsCommand(\n  name: 'site:export',\n  description: \"Exports the site's configuration and content as a recipe.\",\n  aliases: ['siex', 'six'],\n)]\nfinal class SiteExportCommand extends Command {\n\n  use AutowireTrait;\n\n  public function __construct(private readonly SiteExporter $exporter) {\n    parent::__construct();\n  }\n\n  #[\\Override]\n  protected function configure(): void {\n    $this->addOption('destination', NULL, InputOption::VALUE_REQUIRED, 'The destination directory where the site should be exported. Defaults to the location where Composer installs recipes.');\n  }\n\n  #[\\Override]\n  protected function execute(InputInterface $input, OutputInterface $output): int {\n    $destination = $input->getOption('destination') ?? $this->findDestination();\n    $this->exporter->export($destination);\n\n    (new DrushStyle($input, $output))\n      ->success(\"Recipe created at $destination\");\n    return self::SUCCESS;\n  }\n\n  private function findDestination(): string {\n    ['install_path' => $project_root] = InstalledVersions::getRootPackage();\n    // There's no need to use the realpath() method of FileSystemInterface; its\n    // purpose is to handle stream wrappers, which are irrelevant here.\n    $project_root = realpath($project_root);\n    $data = file_get_contents($project_root . DIRECTORY_SEPARATOR . 'composer.json');\n    $data = Json::decode($data);\n\n    $installer_paths = $data['extra']['installer-paths'] ?? [];\n    foreach ($installer_paths as $path => $criteria) {\n      if (in_array('type:' . Recipe::COMPOSER_PROJECT_TYPE, $criteria, TRUE)) {\n        $path = ltrim($path, '.' . DIRECTORY_SEPARATOR);\n        return str_replace('{$name}', 'site_export', $project_root . DIRECTORY_SEPARATOR . $path);\n      }\n    }\n    throw new \\RuntimeException('Could not determine where Composer installs recipes.');\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper\\Drush\\Commands;\n\nuse Composer\\InstalledVersions;\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Recipe\\Recipe;\nuse Drupal\\drupal_cms_helper\\SiteExporter;\nuse Drush\\Commands\\AutowireTrait;\nuse Drush\\Style\\DrushStyle;\nuse Symfony\\Component\\Console\\Attribute\\AsCommand;\nuse Symfony\\Component\\Console\\Command\\Command;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Input\\InputOption;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\n/**\n * @internal\n *   This is an internal part of Drupal CMS and may be changed or removed at any\n *   time without warning. External code should not interact with this class.\n */\n#[AsCommand(\n  name: 'site:export',\n  description: \"Exports the site's configuration and content as a recipe.\",\n  aliases: ['siex', 'six'],\n)]\nfinal class SiteExportCommand extends Command {\n\n  use AutowireTrait;\n\n  public function __construct(private readonly SiteExporter $exporter) {\n    parent::__construct();\n  }\n\n  #[\\Override]\n  protected function configure(): void {\n    $this->addOption('destination', NULL, InputOption::VALUE_REQUIRED, 'The destination directory where the site should be exported. Defaults to the location where Composer installs recipes.');\n  }\n\n  #[\\Override]\n  protected function execute(InputInterface $input, OutputInterface $output): int {\n    $destination = $input->getOption('destination') ?? $this->findDestination();\n    $this->exporter->export($destination);\n\n    (new DrushStyle($input, $output))\n      ->success(\"Recipe created at $destination\");\n    return self::SUCCESS;\n  }\n\n  private function findDestination(): string {\n    ['install_path' => $project_root] = InstalledVersions::getRootPackage();\n    // There's no need to use the realpath() method of FileSystemInterface; its\n    // purpose is to handle stream wrappers, which are irrelevant here.\n    $project_root = realpath($project_root);\n    $data = file_get_contents($project_root . DIRECTORY_SEPARATOR . 'composer.json');\n    $data = Json::decode($data);\n\n    $installer_paths = $data['extra']['installer-paths'] ?? [];\n    foreach ($installer_paths as $path => $criteria) {\n      if (in_array('type:' . Recipe::COMPOSER_PROJECT_TYPE, $criteria, TRUE)) {\n        $path = ltrim($path, '.' . DIRECTORY_SEPARATOR);\n        return str_replace('{$name}', 'site_export', $project_root . DIRECTORY_SEPARATOR . $path);\n      }\n    }\n    throw new \\RuntimeException('Could not determine where Composer installs recipes.');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/Drush/Commands/SiteExportCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SiteExportCommand", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_webform.webform:\n    class: Drupal\\mcp_tools_webform\\Service\\WebformService\n    arguments:\n      - '@entity_type.manager'\n      - '@mcp_tools.access_manager'\n      - '@mcp_tools.audit_logger'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_webform/mcp_tools_webform.services.yml", "type": "yaml_reference", "topic": "mcp tools webform.services"}}
{"instruction": "Show me the implementation of the class Output in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\DTO;\n\n/**\n * Output DTO for the flowdrop module.\n *\n * This class represents output data from node processors,\n * providing specialized methods for output handling.\n */\nclass Output extends Data implements OutputInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setOutput(string $key, mixed $value, ?callable $validator = NULL): static {\n    if ($validator !== NULL && !$validator($value)) {\n      throw new \\InvalidArgumentException(\"Invalid output value for key: {$key}\");\n    }\n\n    return $this->set($key, $value);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addMetadata(string $key, mixed $value): static {\n    $metadata = $this->get('metadata', []);\n    $metadata[$key] = $value;\n    return $this->set('metadata', $metadata);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(string $key, mixed $default = NULL): mixed {\n    $metadata = $this->get('metadata', []);\n    return $metadata[$key] ?? $default;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setStatus(string $status, ?string $message = NULL): static {\n    $this->set('status', $status);\n    if ($message !== NULL) {\n      $this->set('status_message', $message);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getStatus(): string {\n    return $this->get('status', 'unknown');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isSuccess(): bool {\n    return $this->getStatus() === 'success';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isError(): bool {\n    return $this->getStatus() === 'error';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setError(string $message, ?string $code = NULL): static {\n    $this->setStatus('error', $message);\n    if ($code !== NULL) {\n      $this->set('error_code', $code);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getErrorMessage(): ?string {\n    return $this->get('status_message');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getErrorCode(): ?string {\n    return $this->get('error_code');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setSuccess(?string $message = NULL): static {\n    $this->setStatus('success', $message);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSuccessMessage(): ?string {\n    return $this->getStatus() === 'success' ? $this->get('status_message') : NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addExecutionTime(float $execution_time): static {\n    return $this->set('execution_time', $execution_time);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getExecutionTime(): ?float {\n    return $this->get('execution_time');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAllOutput(): array {\n    return $this->toArray();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasOutputData(): bool {\n    return !$this->isEmpty();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputCount(): int {\n    return count($this->keys());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function mergeOutput(OutputInterface $other): static {\n    $this->data = array_merge($this->data, $other->toArray());\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/src/DTO/Output.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Output", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DataEntityRow\nSource file: <source_file>\nFile name hint: DataEntityRow.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\rest\\Plugin\\views\\row;\n\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Entity\\Render\\EntityTranslationRenderTrait;\nuse Drupal\\views\\Plugin\\views\\row\\RowPluginBase;\n\n/**\n * Plugin which displays entities as raw data.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\n  id: \"data_entity\",\n  title: new TranslatableMarkup(\"Entity\"),\n  help: new TranslatableMarkup(\"Use entities as row data.\"),\n  display_types: [\"data\"]\n)]\nclass DataEntityRow extends RowPluginBase {\n\n  use EntityTranslationRenderTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesOptions = FALSE;\n\n  /**\n   * Contains the entity type of this row plugin instance.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeInterface\n   */\n  protected $entityType;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity repository service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * The entity display repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface\n   */\n  protected $entityDisplayRepository;\n\n  /**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   */\n  protected $languageManager;\n\n  /**\n   * Constructs a new DataEntityRow object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(array $configuration, $plugin_id, array $plugin_definition, EntityTypeManagerInterface $entity_type_manager, LanguageManagerInterface $language_manager, EntityRepositoryInterface $entity_repository) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->entityTypeManager = $entity_type_manager;\n    $this->languageManager = $language_manager;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($row) {\n    return $this->getEntityTranslationByRelationship($row->_entity, $row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEntityTypeId() {\n    return $this->view->getBaseEntityType()->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityTypeManager() {\n    return $this->entityTypeManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityRepository() {\n    return $this->entityRepository;\n  }\n\n  /**", "output": "<?php\n\nnamespace Drupal\\rest\\Plugin\\views\\row;\n\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\nuse Drupal\\views\\Entity\\Render\\EntityTranslationRenderTrait;\nuse Drupal\\views\\Plugin\\views\\row\\RowPluginBase;\n\n/**\n * Plugin which displays entities as raw data.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\n  id: \"data_entity\",\n  title: new TranslatableMarkup(\"Entity\"),\n  help: new TranslatableMarkup(\"Use entities as row data.\"),\n  display_types: [\"data\"]\n)]\nclass DataEntityRow extends RowPluginBase {\n\n  use EntityTranslationRenderTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesOptions = FALSE;\n\n  /**\n   * Contains the entity type of this row plugin instance.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeInterface\n   */\n  protected $entityType;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity repository service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * The entity display repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDisplayRepositoryInterface\n   */\n  protected $entityDisplayRepository;\n\n  /**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   */\n  protected $languageManager;\n\n  /**\n   * Constructs a new DataEntityRow object.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param array $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(array $configuration, $plugin_id, array $plugin_definition, EntityTypeManagerInterface $entity_type_manager, LanguageManagerInterface $language_manager, EntityRepositoryInterface $entity_repository) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n\n    $this->entityTypeManager = $entity_type_manager;\n    $this->languageManager = $language_manager;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($row) {\n    return $this->getEntityTranslationByRelationship($row->_entity, $row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getEntityTypeId() {\n    return $this->view->getBaseEntityType()->id();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityTypeManager() {\n    return $this->entityTypeManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntityRepository() {\n    return $this->entityRepository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getLanguageManager() {\n    return $this->languageManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getView() {\n    return $this->view;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    parent::query();\n    $this->getEntityTranslationRenderer()->query($this->view->getQuery());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/rest/src/Plugin/views/row/DataEntityRow.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DataEntityRow", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: NodeChangeDefaultLanguageInterface\nSource file: <source_file>\nFile name hint: NodeChangeDefaultLanguageInterface.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_change_default_language;\n\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Interface for the Node Change Default Language service.\n */\ninterface NodeChangeDefaultLanguageInterface {\n\n  /**\n   * Changes the default language of a node.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The node entity.\n   * @param string $newLangcode\n   *   The new default language code.\n   *\n   * @return bool\n   *   TRUE if the operation was successful, FALSE otherwise.\n   *\n   * @throws \\InvalidArgumentException\n   *   If the target translation does not exist.\n   */\n  public function changeDefaultLanguage(NodeInterface $node, string $newLangcode): bool;\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_change_default_language;\n\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Interface for the Node Change Default Language service.\n */\ninterface NodeChangeDefaultLanguageInterface {\n\n  /**\n   * Changes the default language of a node.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The node entity.\n   * @param string $newLangcode\n   *   The new default language code.\n   *\n   * @return bool\n   *   TRUE if the operation was successful, FALSE otherwise.\n   *\n   * @throws \\InvalidArgumentException\n   *   If the target translation does not exist.\n   */\n  public function changeDefaultLanguage(NodeInterface $node, string $newLangcode): bool;\n\n}\n", "metadata": {"source": "repos/node_change_default_language/src/NodeChangeDefaultLanguageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "NodeChangeDefaultLanguageInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Views Pretty Path\ndescription: Rewrites URL query parameters into clean URL components for specified views.\ncore_version_requirement: ^10 || ^11\ntype: module\nconfigure: views_pretty_paths.views_pretty_paths_admin_form\ndependencies:\n  - drupal:redirect\n  - drupal:views\n  - drupal:path_alias\n", "metadata": {"source": "repos/views_pretty_paths/views_pretty_paths.info.yml", "type": "yaml_reference", "topic": "views pretty paths.info"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Image\nSource file: <source_file>\nFile name hint: Image.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\media\\Plugin\\media\\Source;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\Display\\EntityViewDisplayInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\File\\FileSystemInterface;\nuse Drupal\\Core\\Image\\ImageFactory;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\media\\Attribute\\MediaSource;\nuse Drupal\\media\\MediaInterface;\nuse Drupal\\media\\MediaTypeInterface;\n\n/**\n * Image entity media source.\n *\n * @see \\Drupal\\Core\\Image\\ImageInterface\n */\n#[MediaSource(\n  id: \"image\",\n  label: new TranslatableMarkup(\"Image\"),\n  description: new TranslatableMarkup(\"A locally hosted image file.\"),\n  allowed_field_types: [\"image\"],\n  default_thumbnail_filename: \"no-thumbnail.png\",\n  thumbnail_alt_metadata_attribute: \"thumbnail_alt_value\"\n)]\nclass Image extends File {\n\n  /**\n   * Key for \"image width\" metadata attribute.\n   *\n   * @var string\n   */\n  const METADATA_ATTRIBUTE_WIDTH = 'width';\n\n  /**\n   * Key for \"image height\" metadata attribute.\n   *\n   * @var string\n   */\n  const METADATA_ATTRIBUTE_HEIGHT = 'height';\n\n  /**\n   * The image factory service.\n   *\n   * @var \\Drupal\\Core\\Image\\ImageFactory\n   */\n  protected $imageFactory;\n\n  /**\n   * The file system service.\n   *\n   * @var \\Drupal\\Core\\File\\FileSystemInterface\n   */\n  protected $fileSystem;\n\n  /**\n   * Constructs a new class instance.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   Entity type manager service.\n   * @param \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $entity_field_manager\n   *   Entity field manager service.\n   * @param \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface $field_type_manager\n   *   The field type plugin manager service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory service.\n   * @param \\Drupal\\Core\\Image\\ImageFactory $image_factory\n   *   The image factory.\n   * @param \\Drupal\\Core\\File\\FileSystemInterface $file_system\n   *   The file system service.\n   */\n  function __construct(array $configuration, $plugin_id, $plugin_definition, EntityTypeManagerInterface $entity_type_manager, EntityFieldManagerInterface $entity_field_manager, FieldTypePluginManagerInterface $field_type_manager, ConfigFactoryInterface $config_factory, ImageFactory $image_factory, FileSystemInterface $file_system) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $entity_type_manager, $entity_field_manager, $field_type_manager, $config_factory);\n\n    $this->imageFactory = $image_factory;\n    $this->fileSystem = $file_system;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadataAttributes() {\n    $attributes = parent::getMetadataAttributes();\n\n    $attributes += [\n      static::METADATA_ATTRIBUTE_WIDTH => $this->t('Width'),\n      static::METADATA_ATTRIBUTE_HEIGHT => $this->t('Height'),\n    ];\n\n    return $attributes;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(MediaInterface $media, $name) {\n    // Get the file and image data.\n    /** @var \\Drupal\\file\\FileInterface $file */\n    $file = $media->get($this->configuration['source_field'])->entity;\n    // If the source field is not required, it may be empty.\n    if (!$file) {\n      return parent::getMetadata($media, $name);\n    }\n\n    $uri = $file->getFileUri();\n    switch ($name) {\n      case static::METADATA_ATTRIBUTE_WIDTH:\n        $image = $this->imageFactory->get($uri);\n        return $image->getWidth() ?: NULL;\n", "output": "<?php\n\nnamespace Drupal\\media\\Plugin\\media\\Source;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\Display\\EntityViewDisplayInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\File\\FileSystemInterface;\nuse Drupal\\Core\\Image\\ImageFactory;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\media\\Attribute\\MediaSource;\nuse Drupal\\media\\MediaInterface;\nuse Drupal\\media\\MediaTypeInterface;\n\n/**\n * Image entity media source.\n *\n * @see \\Drupal\\Core\\Image\\ImageInterface\n */\n#[MediaSource(\n  id: \"image\",\n  label: new TranslatableMarkup(\"Image\"),\n  description: new TranslatableMarkup(\"A locally hosted image file.\"),\n  allowed_field_types: [\"image\"],\n  default_thumbnail_filename: \"no-thumbnail.png\",\n  thumbnail_alt_metadata_attribute: \"thumbnail_alt_value\"\n)]\nclass Image extends File {\n\n  /**\n   * Key for \"image width\" metadata attribute.\n   *\n   * @var string\n   */\n  const METADATA_ATTRIBUTE_WIDTH = 'width';\n\n  /**\n   * Key for \"image height\" metadata attribute.\n   *\n   * @var string\n   */\n  const METADATA_ATTRIBUTE_HEIGHT = 'height';\n\n  /**\n   * The image factory service.\n   *\n   * @var \\Drupal\\Core\\Image\\ImageFactory\n   */\n  protected $imageFactory;\n\n  /**\n   * The file system service.\n   *\n   * @var \\Drupal\\Core\\File\\FileSystemInterface\n   */\n  protected $fileSystem;\n\n  /**\n   * Constructs a new class instance.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   Entity type manager service.\n   * @param \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $entity_field_manager\n   *   Entity field manager service.\n   * @param \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface $field_type_manager\n   *   The field type plugin manager service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory service.\n   * @param \\Drupal\\Core\\Image\\ImageFactory $image_factory\n   *   The image factory.\n   * @param \\Drupal\\Core\\File\\FileSystemInterface $file_system\n   *   The file system service.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, EntityTypeManagerInterface $entity_type_manager, EntityFieldManagerInterface $entity_field_manager, FieldTypePluginManagerInterface $field_type_manager, ConfigFactoryInterface $config_factory, ImageFactory $image_factory, FileSystemInterface $file_system) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $entity_type_manager, $entity_field_manager, $field_type_manager, $config_factory);\n\n    $this->imageFactory = $image_factory;\n    $this->fileSystem = $file_system;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadataAttributes() {\n    $attributes = parent::getMetadataAttributes();\n\n    $attributes += [\n      static::METADATA_ATTRIBUTE_WIDTH => $this->t('Width'),\n      static::METADATA_ATTRIBUTE_HEIGHT => $this->t('Height'),\n    ];\n\n    return $attributes;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(MediaInterface $media, $name) {\n    // Get the file and image data.\n    /** @var \\Drupal\\file\\FileInterface $file */\n    $file = $media->get($this->configuration['source_field'])->entity;\n    // If the source field is not required, it may be empty.\n    if (!$file) {\n      return parent::getMetadata($media, $name);\n    }\n\n    $uri = $file->getFileUri();\n    switch ($name) {\n      case static::METADATA_ATTRIBUTE_WIDTH:\n        $image = $this->imageFactory->get($uri);\n        return $image->getWidth() ?: NULL;\n\n      case static::METADATA_ATTRIBUTE_HEIGHT:\n        $image = $this->imageFactory->get($uri);\n        return $image->getHeight() ?: NULL;\n\n      case 'thumbnail_uri':\n        return $uri;\n\n      case 'thumbnail_alt_value':\n        return $media->get($this->configuration['source_field'])->alt ?? parent::getMetadata($media, $name);\n    }\n\n    return parent::getMetadata($media, $name);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createSourceField(MediaTypeInterface $type) {\n    /** @var \\Drupal\\field\\FieldConfigInterface $field */\n    $field = parent::createSourceField($type);\n\n    // Reset the field to its default settings so that we don't inherit the\n    // settings from the parent class' source field.\n    $settings = $this->fieldTypeManager->getDefaultFieldSettings($field->getType());\n\n    return $field->set('settings', $settings);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareViewDisplay(MediaTypeInterface $type, EntityViewDisplayInterface $display) {\n    parent::prepareViewDisplay($type, $display);\n\n    // Use the `large` image style and do not link the image to anything.\n    // This will prevent the out-of-the-box configuration from outputting very\n    // large raw images. If the `large` image style has been deleted, do not\n    // set an image style.\n    $field_name = $this->getSourceFieldDefinition($type)->getName();\n    $component = $display->getComponent($field_name);\n    $component['settings']['image_link'] = '';\n    $component['settings']['image_style'] = '';\n    if ($this->entityTypeManager->getStorage('image_style')->load('large')) {\n      $component['settings']['image_style'] = 'large';\n    }\n    $display->setComponent($field_name, $component);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Plugin/media/Source/Image.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Image", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class ContentTranslation in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Installation functions for Content Translation module.\n */\n\nuse Drupal\\Core\\Installer\\InstallerKernel;\nuse Drupal\\Core\\Url;\n\n/**\n * Implements hook_install().\n */\nfunction content_translation_install(): void {\n  // Assign a fairly low weight to ensure our implementation of\n  // hook_module_implements_alter() is run among the last ones.\n  module_set_weight('content_translation', 10);\n\n  // Skip the guidance messages about enabling translation features if the\n  // module was installed in the Drupal installation process.\n  if (InstallerKernel::installationAttempted()) {\n    return;\n  }\n\n  // Translation works when at least two languages are added.\n  if (count(\\Drupal::languageManager()->getLanguages()) < 2) {\n    $t_args = [\n      ':language_url' => Url::fromRoute('entity.configurable_language.collection')->toString(),\n    ];\n    $message = t('This site has only a single language enabled. <a href=\":language_url\">Add at least one more language</a> in order to translate content.', $t_args);\n    \\Drupal::messenger()->addWarning($message);\n  }\n  // Point the user to the content translation settings.\n  $t_args = [\n    ':settings_url' => Url::fromRoute('language.content_settings_page')->toString(),\n  ];\n  $message = t('<a href=\":settings_url\">Enable translation</a> for <em>content types</em>, <em>taxonomy vocabularies</em>, <em>accounts</em>, or any other element you wish to translate.', $t_args);\n  \\Drupal::messenger()->addWarning($message);\n}\n\n/**\n * Implements hook_update_last_removed().\n */\nfunction content_translation_update_last_removed(): int {\n  return 8400;\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/content_translation.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContentTranslation", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the interface UnifiedCacheManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\n/**\n * Interface for Unified Cache Manager in AI Agent Orchestra optimization.\n */\ninterface UnifiedCacheManagerInterface {\n\n  /**\n   * Warm cache with critical data patterns.\n   *\n   * @param array $patterns\n   *   Cache patterns to warm. If empty, uses default critical patterns.\n   *\n   * @return array\n   *   Warming results with statistics.\n   */\n  public function warmCache(array $patterns = []): array;\n\n  /**\n   * Optimize cache hierarchy and tag structure.\n   *\n   * @return array\n   *   Optimization results with performance improvements.\n   */\n  public function optimizeCacheHierarchy(): array;\n\n  /**\n   * Get comprehensive performance metrics.\n   *\n   * @return array\n   *   Performance metrics for all cache layers.\n   */\n  public function getPerformanceMetrics(): array;\n\n  /**\n   * Create monitoring dashboard data.\n   *\n   * @return array\n   *   Dashboard data with real-time metrics and trends.\n   */\n  public function createMonitoringDashboard(): array;\n\n  /**\n   * Invalidate cache by tags with cascade support.\n   *\n   * @param array $tags\n   *   Cache tags to invalidate.\n   *\n   * @return int\n   *   Number of tags invalidated successfully.\n   */\n  public function invalidateByTags(array $tags): int;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/UnifiedCacheManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "UnifiedCacheManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SystemAdminMenuBlockAccessCheck in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Menu\\MenuLinkInterface;\nuse Drupal\\Core\\Menu\\MenuLinkManagerInterface;\nuse Drupal\\Core\\Menu\\MenuLinkTreeInterface;\nuse Drupal\\Core\\Menu\\MenuTreeParameters;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\Core\\Routing\\AccessAwareRouter;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Access check for routes implementing _access_admin_menu_block_page.\n *\n * @see \\Drupal\\system\\EventSubscriber\\AccessRouteAlterSubscriber\n * @see \\Drupal\\system\\Controller\\SystemController::systemAdminMenuBlockPage()\n */\nclass SystemAdminMenuBlockAccessCheck implements AccessInterface {\n\n  /**\n   * Constructs a new SystemAdminMenuBlockAccessCheck.\n   *\n   * @param \\Drupal\\Core\\Menu\\MenuLinkTreeInterface $menuLinkTree\n   *   The menu link tree service.\n   * @param \\Drupal\\Core\\Routing\\AccessAwareRouter $router\n   *   The router service.\n   * @param \\Drupal\\Core\\Menu\\MenuLinkManagerInterface $menuLinkManager\n   *   The menu link manager service.\n   */\n  public function __construct(\n    private readonly MenuLinkTreeInterface $menuLinkTree,\n    private readonly AccessAwareRouter $router,\n    private readonly MenuLinkManagerInterface $menuLinkManager,\n  ) {\n  }\n\n  /**\n   * Checks access.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match object to be checked.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The current user.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(RouteMatchInterface $route_match, AccountInterface $account): AccessResultInterface {\n    $parameters = $route_match->getParameters()->all();\n    $route = $route_match->getRouteObject();\n    // Load links in the 'admin' menu matching this route. First, try to find\n    // the menu link using all specified parameters.\n    $links = $this->menuLinkManager->loadLinksByRoute($route_match->getRouteName(), $parameters, 'admin');\n    // If the menu link was not found, try finding it without the parameters\n    // that match the route defaults. Depending on whether the parameter is\n    // specified in the menu item with a value matching the default, or not\n    // specified at all, will change how it is stored in the menu_tree table. In\n    // both cases the route match parameters will always include the default\n    // parameters. This fallback method of finding the menu item is needed so\n    // that menu items will work in either case.\n    // @todo Remove this fallback in https://drupal.org/i/3359511.\n    if (empty($links)) {\n\n      $parameters_without_defaults = array_filter($parameters, fn ($key) => !$route->hasDefault($key) || $route->getDefault($key) !== $parameters[$key], ARRAY_FILTER_USE_KEY);\n      $links = $this->menuLinkManager->loadLinksByRoute($route_match->getRouteName(), $parameters_without_defaults, 'admin');\n    }\n    if (empty($links)) {\n      // If we did not find a link then we have no opinion on access.\n      return AccessResult::neutral();\n    }\n    return $this->hasAccessToChildMenuItems(reset($links), $account)->cachePerPermissions();\n  }\n\n  /**\n   * Check that the given route has access to child routes.\n   *\n   * @param \\Drupal\\Core\\Menu\\MenuLinkInterface $link\n   *   The menu link.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The account.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  protected function hasAccessToChildMenuItems(MenuLinkInterface $link, AccountInterface $account): AccessResultInterface {\n    $parameters = new MenuTreeParameters();\n    $parameters->setRoot($link->getPluginId())\n      ->excludeRoot()\n      ->setTopLevelOnly()\n      ->onlyEnabledLinks();\n\n    $link_url = $link->getUrlObject();\n    if (!$link_url->isRouted()) {\n      // If the link is not routed, we cannot check access to it.\n      return AccessResult::neutral();\n    }\n\n    $route = $this->router->getRouteCollection()->get($link_url->getRouteName());\n    if ($route && empty($route->getRequirement('_access_admin_menu_block_page')) && empty($route->getRequirement('_access_admin_overview_page'))) {\n      return AccessResult::allowed();\n    }\n\n    foreach ($this->menuLinkTree->load(NULL, $parameters) as $element) {\n      // Skip the link if the user does not have access.\n      if (!$element->link->getUrlObject()->access($account)) {\n        continue;\n      }\n\n      // If access is allowed to this element in the tree, check for access to\n      // any of its own children.\n      if ($this->hasAccessToChildMenuItems($element->link, $account)->isAllowed()) {\n        return AccessResult::allowed();\n      }\n    }\n    return AccessResult::neutral();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Access/SystemAdminMenuBlockAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SystemAdminMenuBlockAccessCheck", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Decorator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler;\n\n/**\n * Generic class Decorator.\n */\nclass Decorator {\n\n  /**\n   * The original object to decorate.\n   *\n   * @var object\n   */\n  protected object $object;\n\n  /**\n   * Class constructor.\n   *\n   * @param object $object\n   *   The original object to decorate.\n   */\n  public function __construct(object $object) {\n    $this->object = $object;\n  }\n\n  /**\n   * Return the original (i.e. non-decorated) object.\n   *\n   * @return object\n   *   The original object.\n   */\n  public function getOriginalObject(): object {\n    $object = $this->object;\n    while ($object instanceof Decorator) {\n      $object = $object->getOriginalObject();\n    }\n\n    return $object;\n  }\n\n  /**\n   * Return the object if $method is a PHP callable, FALSE otherwise.\n   *\n   * @param string $method\n   *   The method's name.\n   * @param bool $checkSelf\n   *   TRUE to check this decorator, FALSE to check the original object.\n   *\n   * @return bool|object\n   *   The object if $method is a PHP callable, FALSE otherwise.\n   */\n  public function isCallable(string $method, bool $checkSelf = FALSE): bool|object {\n    // Check the original object.\n    $object = $this->getOriginalObject();\n    if (\\is_callable([$object, $method])) {\n      return $object;\n    }\n\n    // Check Decorators.\n    $object = $checkSelf ? $this : $this->object;\n    while ($object instanceof Decorator) {\n      if (\\is_callable([$object, $method])) {\n        return $object;\n      }\n\n      $object = $this->object;\n    }\n\n    return FALSE;\n  }\n\n  /**\n   * Call a method on the original object, with specific arguments.\n   *\n   * @param string $method\n   *   The method to call.\n   * @param array $args\n   *   The args to pass to the method.\n   *\n   * @return mixed\n   *   The return of the method invocation on the original object.\n   *\n   * @throws \\Exception\n   */\n  public function __call(string $method, array $args): mixed {\n    if ($object = $this->isCallable($method)) {\n      return \\call_user_func_array([$object, $method], $args);\n    }\n\n    throw new \\Exception(\n      'Undefined method - ' . \\get_class($this->getOriginalObject()) . '::' . $method,\n    );\n  }\n\n  /**\n   * Return the value of a property from the original object.\n   *\n   * @param string $property\n   *   The property name.\n   *\n   * @return mixed|null\n   *   The value of a property from the original object or NULL if the property\n   *   doesn't exist on the original object.\n   */\n  public function __get(string $property): mixed {\n    $object = $this->getOriginalObject();\n    if (\\property_exists($object, $property)) {\n      // @phpstan-ignore-next-line\n      return $object->$property;\n    }\n\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Decorator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Decorator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Random in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\sort;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Cache\\UncacheableDependencyTrait;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsSort;\n\n/**\n * Handle a random sort.\n */\n#[ViewsSort(\"random\")]\nclass Random extends SortPluginBase implements CacheableDependencyInterface {\n\n  use UncacheableDependencyTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function usesGroupBy() {\n    return FALSE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $this->query->addOrderBy('rand');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['order']['#access'] = FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/sort/Random.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Random", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GridResponsive in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\style;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsStyle;\n\n/**\n * Style plugin to render each item in a responsive grid cell.\n *\n * @ingroup views_style_plugins\n */\n#[ViewsStyle(\n  id: \"grid_responsive\",\n  title: new TranslatableMarkup(\"Responsive Grid\"),\n  help: new TranslatableMarkup(\"Displays rows in a responsive grid.\"),\n  theme: \"views_view_grid_responsive\",\n  display_types: [\"normal\"],\n)]\nclass GridResponsive extends StylePluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $usesRowPlugin = TRUE;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['columns'] = ['default' => '4'];\n    $options['cell_min_width'] = ['default' => '100'];\n    $options['grid_gutter'] = ['default' => '10'];\n    $options['alignment'] = ['default' => 'horizontal'];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n    $form['columns'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum number of columns'),\n      '#attributes' => ['style' => 'width: 6em;'],\n      '#description' => $this->t('The maximum number of columns that will be displayed within the grid.'),\n      '#default_value' => $this->options['columns'],\n      '#required' => TRUE,\n      '#min' => 1,\n    ];\n    $form['cell_min_width'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Minimum grid cell width'),\n      '#field_suffix' => 'px',\n      '#attributes' => ['style' => 'width: 6em;'],\n      '#description' => $this->t('The minimum width of the grid cells. If the grid container becomes narrow, the grid cells will reflow onto the next row as needed.'),\n      '#default_value' => $this->options['cell_min_width'],\n      '#required' => TRUE,\n      '#min' => 1,\n    ];\n    $form['grid_gutter'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Grid gutter spacing'),\n      '#field_suffix' => 'px',\n      '#attributes' => ['style' => 'width: 6em;'],\n      '#description' => $this->t('The spacing between the grid cells.'),\n      '#default_value' => $this->options['grid_gutter'],\n      '#required' => TRUE,\n      '#min' => 0,\n    ];\n    $form['alignment'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Alignment'),\n      '#options' => ['horizontal' => $this->t('Horizontal'), 'vertical' => $this->t('Vertical')],\n      '#default_value' => $this->options['alignment'],\n      '#description' => $this->t('Horizontal alignment will place items starting in the upper left and moving right. Vertical alignment will place items starting in the upper left and moving down.'),\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/style/GridResponsive.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GridResponsive", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "api_normalization.flowdrop_node_handler.*:\n  type: mapping\n  label: 'FlowDrop Node Handler Configuration'\n  mapping:\n    extract_headers:\n      type: boolean\n      label: 'Extract Headers'\n    extract_query:\n      type: boolean\n      label: 'Extract Query Parameters'\n    extract_body:\n      type: boolean\n      label: 'Extract Request Body'\n    extract_content_type:\n      type: boolean\n      label: 'Extract Content Type'\n", "metadata": {"source": "repos/api_normalization/config/schema/api_normalization.flowdrop_node_handler.schema.yml", "type": "yaml_reference", "topic": "api normalization.flowdrop node handler.schema"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Components", "input": "", "output": "# Components\n\nThis module uses SDC components to ensure an easy, and nice editing experience. The first thing you will need to do is to follow the standard Drupal API documentation on building an SDC. Normally SDC's consist of .twig, .component.yml, .css, and .js files.\n\n## How to build a SDC component that works with this module\n\nOnce you have followed the standard Drupal documentation, now you need to ensure the .twig file follows the PR Builder Component standard. A PR Builder Component twig file is made up of the following:\n\n### A root element.\n\nwhether it be a div, footer, or header, all PR Builder SDC's must be in a single root parent element. This root element must have the following attributes defined\n\n- data-sdc-component, this allows us to keep track of it in the editing experience. To make this easier to implement, we have provided the following twig utility:\n  `{{ sdc_component_attributes(component_name) }}`\n\nThe data-sdc-component should only be on the root element of the component, no other elements should have this attribute.\n\n- data-sdc-no-encapsulate, this attribute prevents the component from being wrapped in a `block-wrapper` div with toolbar controls. Use this for components that are nested within other components (like list items) where you don't want individual encapsulation. Simply add `data-sdc-no-encapsulate` to the root element.\n- data-sdc-no-remove, this attribute prevents the component from being deleted (removes trash icon from toolbar). Useful for components that should always remain in place.\n- data-sdc-no-move, this attribute prevents the component from being moved/reordered (removes move icon and disables drag-and-drop). Useful for components that must stay in a specific position.\n- data-sdc-no-sidebar, this attribute prevents the sidebar settings icon from appearing, even if the component has sidebar fields. Useful for components that should not expose settings UI.\n\n### Required fields for child elements\n\nInside the root element, it is likely you will have content that you want edited inline. The editable elements will need the following attributes:\n\n- data-sdc-field, this is the name of the prop defined in .twig that you want to be able to edit inline.\n- data-sdc-editable, this is used to know if a user can edit it or not. We will pass in a variable \"editable\" if the editing experience is enabled or not\n- data-sdc-type, this is the type of the editing experience that you want to enable. The following are types you can choose from:\n    - Inline Editors\n        - text-editor\n        - html-editor\n    - Sidebar Editors\n        - text-input\n        - number-input\n        - checkbox-toggle (In the twig, it doesn't work if you default to true, ensure you default to false)\n        - image-selector\n        - multi-image-selector\n- data-sdc-sidebar, this is what tells the front-end if this field should pop up in the sidebar and become editable\n- data-nested-container=\"true\", This is what tells the editor that the SDC has nested components. This will normally go on the parent component where you have sdc_component_attributes\n- data-drop-container=\"true\" , this is what tells the editor you can drop components into the nested component.\n- data-block-wrapper-auto=\"true\", on the parent component makes the block-wrapper in the editing view width auto. Typically used for non-full width components\n  In the twig template, in order to make this easier to remember we provide the following utility:\n  `{{ sdc_field_attributes('text', editable|default(false), {'data-sdc-type': 'text-editor'}) }}`\n\n### Restricting which components can be dropped\n\nIf a nested drop zone should only accept specific component types, add the `data-allowed-components` attribute to the element with `data-drop-container=\"true\"`. The value must be a JSON array of fully-qualified component machine names (e.g. `module_name:component_name`).\n\n```twig\n<ul\n  class=\"mse-link-list\"\n  data-drop-container=\"true\"\n  data-allowed-components='[\"mse_sdc_components:link-list-item\"]'>\n  \u2026\n</ul>\n```\n\nWhen present, the PR Builder drag-and-drop logic hides invalid drop targets and blocks drops of disallowed components, whether moving existing blocks or dragging from the toolbar.\n\n### Sidebar field reference\n\nThe JavaScript sidebar renders editors based on the `data-sdc-type` you choose. The handlers live in `sdc_inline_editor/js/src/inline-editor/fieldHandlers/sidebar/`. Common types include:\n\n- `text-input`\n- `number-input`\n- `checkbox-toggle`\n- `select-dropdown`\n- `image-selector`\n- `multi-image-selector`\n- `icon-selector` \u2013 renders the searchable Font Awesome picker. Make sure your Twig highlights the chosen icon with `data-sdc-icon-preview` so live updates work.\n\nSee `components/SDC_ATTRIBUTES_USAGE.md` for helper functions that generate these attributes consistently.\n\n## Thumbnails:\n\nhttps://www.flaticon.com/search?word=code&weight=bold&type=uicon\n", "metadata": {"source": "repos/sdc_inline_editor/components/README.md", "type": "doc_summary", "topic": "Components"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "core.entity_view_display.*.*.*.third_party.layout_builder_restrictions:\n  type: sequence\n  label: 'Layout Builder Restrictions plugin configuration'\n  sequence:\n    type: layout_builder_restrictions.[%key]\n\nlayout_builder_restrictions.entity_view_mode_restriction:\n  type: mapping\n  label: 'Per-view-mode Layout Builder Restrictions settings'\n  mapping:\n    allowed_layouts:\n      type: sequence\n      label: 'Allowed layouts'\n      sequence:\n        type: string\n        label: 'Layout ID'\n    denylisted_blocks:\n      type: sequence\n      label: 'Denylisted blocks by category'\n      sequence:\n        type: sequence\n        label: 'Denylisted blocks'\n        sequence:\n          type: string\n          label: 'Block ID'\n    allowlisted_blocks:\n      type: sequence\n      label: 'Allowlisted blocks by category'\n      sequence:\n        type: sequence\n        label: 'Allowlisted blocks'\n        sequence:\n          type: string\n          label: 'Block ID'\n    restricted_categories:\n      type: sequence\n      label: 'Categories which disallow all blocks'\n      sequence:\n        type: string\n        label: 'Category ID'\n\n\nlayout_builder_restrictions.allowed_block_categories:\n  type: sequence\n  label: 'Categories which have no block restrictions'\n  sequence:\n    type: string\n    label: 'Category machine name'\n\nlayout_builder_restrictions.plugins:\n  type: config_object\n  label: 'Weighting and active status of Layout Builder Restrictions plugins'\n  mapping:\n    plugin_config:\n      type: sequence\n      sequence:\n        type: mapping\n        mapping:\n          enabled:\n            type: boolean\n            label: 'Is the plugin enabled'\n          weight:\n            type: integer\n            label: 'The relative order of the plugin'\n", "metadata": {"source": "repos/layout_builder_restrictions/config/schema/layout_builder_restrictions.schema.yml", "type": "yaml_reference", "topic": "layout builder restrictions.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: default_language\nlabel: Default language\nmigration_tags:\n  - Drupal 6\n  - Drupal 7\n  - Configuration\nsource:\n  plugin: variable\n  variables:\n    - language_default\n  source_module: locale\nprocess:\n  default_langcode:\n    -\n      plugin: default_value\n      source: language_default\n      default_value:\n        'language': 'en'\n    # Encode and decode to turn the default_language variable, which is\n    # an stdClass, into an array so it can be passed to extract.\n    -\n      plugin: callback\n      callable:\n        - '\\Drupal\\Component\\Serialization\\Json'\n        - 'encode'\n    -\n      plugin: callback\n      callable:\n        - '\\Drupal\\Component\\Serialization\\Json'\n        - 'decode'\n    -\n      plugin: extract\n      index:\n        - language\ndestination:\n  plugin: default_langcode\n  config_name: system.site\nmigration_dependencies:\n  required:\n    - language\n", "metadata": {"source": "repos/drupal_core/core/modules/language/migrations/default_language.yml", "type": "yaml_reference", "topic": "default language"}}
{"instruction": "Show me the implementation of the class NoFieldsException in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Query;\n\nuse Drupal\\Core\\Database\\DatabaseException;\n\n/**\n * Exception thrown if an insert query doesn't specify insert or default fields.\n */\nclass NoFieldsException extends \\InvalidArgumentException implements DatabaseException {}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Query/NoFieldsException.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NoFieldsException", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Template file for the theming of announcement_feed admin page.\n *\n * This template will get rendered when the user navigates to the announcements_feed.announcement route.\n *\n * Available variables:\n * - count: Contains the total number of announcements.\n * - featured: A list of featured announcement objects.\n * - standard: A list of non-featured announcement objects.\n *\n * Announcement objects have the following variables:\n * - id: Unique id of the announcement.\n * - title: Title of the standard announcement.\n * - content: Short description of the announcement.\n * - datePublishedTimestamp: Timestamp of the announcement.\n * - url: Learn more link of the standard announcement.\n *\n * @see announcements_feed_theme()\n *\n * @ingroup themeable\n */\n#}\n{{ attach_library('announcements_feed/drupal.announcements_feed.page') }}\n\n{% include '@announcements_feed/announcements.html.twig' %}\n", "metadata": {"source": "repos/drupal_core/core/modules/announcements_feed/templates/announcements-feed-admin.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class LaborTimeTrackerToolbarHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\labor_time_tracker\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Toolbar-related hook implementations.\n */\nclass LaborTimeTrackerToolbarHooks {\n\n  /**\n   * Implements hook_toolbar_alter().\n   *\n   * Attaches the custom admin library to the toolbar.\n   */\n  #[Hook('toolbar_alter')]\n  public function toolbarAlter(&$items): void {\n    $items['administration']['#attached']['library'][] = 'labor_time_tracker/labor_time_tracker.toolbar';\n  }\n\n}\n", "metadata": {"source": "repos/labor_time_tracker/src/Hook/LaborTimeTrackerToolbarHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LaborTimeTrackerToolbarHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: AbstractFilterHandler\nSource file: <source_file>\nFile name hint: AbstractFilterHandler.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views_pretty_paths\\FilterHandlers;\n\nuse Drupal\\Component\\Utility\\UrlHelper;\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Defines AbstractFilterHandler class.\n */\nabstract class AbstractFilterHandler implements ViewsPrettyPathFilterHandlerInterface {\n\n  /**\n   * Database service.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $database;\n\n  /**\n   * Constructs AbstractFilterHandler object.\n   */\n  public function __construct(Connection $connection) {\n    $this->database = $connection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetedFilterPluginIds() {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformPathValueForViewsQuery($filter_value_string, $filter_data) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformSubmittedValueForUrl($value) {\n  }\n\n  /**\n   * Encode multiple words.\n   *\n   * @param string $words_string\n   *   Get words.\n   * @param string $delimiter\n   *   Delimiter to use.\n   */\n  protected function encodeMultipleWordsForUrl($words_string, $delimiter = '-') {\n    $words_array = explode(' ', $words_string);\n    $encoded_words_array = array_map(function ($word) {\n      return $this->encodeWordForUrl($word);\n\n    }, $words_array);\n    return implode($delimiter, $encoded_words_array);\n  }\n\n  /**\n   * Encode a single word.\n   *\n   * @param string $word\n   *   Given word.\n   *\n   * @return string\n   *   Encoded word.\n   */\n  protected function encodeWordForUrl($word) {\n    $processed_word = trim(strtolower($word));\n    $processed_word = implode('-', array_map(function ($word_item) {\n      return UrlHelper::encodePath($word_item);\n    }, explode('-', $processed_word)));\n    return $processed_word;\n  }\n\n  /**\n   * Decode a single word.\n   *\n   * @param string $word\n   *   Given word.\n   *\n   * @return string\n   *   Decoded word.\n   */\n  protected function decodeUrlWord($word) {\n    return urldecode($word);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\views_pretty_paths\\FilterHandlers;\n\nuse Drupal\\Component\\Utility\\UrlHelper;\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Defines AbstractFilterHandler class.\n */\nabstract class AbstractFilterHandler implements ViewsPrettyPathFilterHandlerInterface {\n\n  /**\n   * Database service.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $database;\n\n  /**\n   * Constructs AbstractFilterHandler object.\n   */\n  public function __construct(Connection $connection) {\n    $this->database = $connection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetedFilterPluginIds() {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformPathValueForViewsQuery($filter_value_string, $filter_data) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformSubmittedValueForUrl($value) {\n  }\n\n  /**\n   * Encode multiple words.\n   *\n   * @param string $words_string\n   *   Get words.\n   * @param string $delimiter\n   *   Delimiter to use.\n   */\n  protected function encodeMultipleWordsForUrl($words_string, $delimiter = '-') {\n    $words_array = explode(' ', $words_string);\n    $encoded_words_array = array_map(function ($word) {\n      return $this->encodeWordForUrl($word);\n\n    }, $words_array);\n    return implode($delimiter, $encoded_words_array);\n  }\n\n  /**\n   * Encode a single word.\n   *\n   * @param string $word\n   *   Given word.\n   *\n   * @return string\n   *   Encoded word.\n   */\n  protected function encodeWordForUrl($word) {\n    $processed_word = trim(strtolower($word));\n    $processed_word = implode('-', array_map(function ($word_item) {\n      return UrlHelper::encodePath($word_item);\n    }, explode('-', $processed_word)));\n    return $processed_word;\n  }\n\n  /**\n   * Decode a single word.\n   *\n   * @param string $word\n   *   Given word.\n   *\n   * @return string\n   *   Decoded word.\n   */\n  protected function decodeUrlWord($word) {\n    return urldecode($word);\n  }\n\n}\n", "metadata": {"source": "repos/views_pretty_paths/src/FilterHandlers/AbstractFilterHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AbstractFilterHandler", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Single button: link\"\ndescription: \"While <button> is the recommended control for a dropdown toggle, there might be situations where you have to use an <a> element.\"\nslots:\n  title: \"Dropdown link\"\nprops:\n  variant: dropdown\n  content:\n    - title: \"Action\"\n      url: \"#\"\n    - title: \"Another action\"\n      url: \"#\"\n    - title: \"Something else here\"\n      url: \"#\"\n  button_variant: secondary\n  button_url: \"#\"\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/stories/dropdown.single_button_link.story.yml", "type": "yaml_reference", "topic": "dropdown.single button link.story"}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: LayoutInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Layout;\n\nuse Drupal\\Component\\Plugin\\DerivativeInspectionInterface;\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginInterface;\n\n/**\n * Provides an interface for static Layout plugins.\n */\ninterface LayoutInterface extends PluginInspectionInterface, DerivativeInspectionInterface, ConfigurableInterface, DependentPluginInterface, ContextAwarePluginInterface {\n\n  /**\n   * Build a render array for layout with regions.\n   *\n   * @param array $regions\n   *   An associative array keyed by region name, containing render arrays\n   *   representing the content that should be placed in each region.\n   *\n   * @return array\n   *   Render array for the layout with regions.\n   */\n  function build(array $regions);\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return \\Drupal\\Core\\Layout\\LayoutDefinition\n   *   The layout plugin definition for this plugin.\n   */\n  public function getPluginDefinition();\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Layout;\n\nuse Drupal\\Component\\Plugin\\DerivativeInspectionInterface;\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginInterface;\n\n/**\n * Provides an interface for static Layout plugins.\n */\ninterface LayoutInterface extends PluginInspectionInterface, DerivativeInspectionInterface, ConfigurableInterface, DependentPluginInterface, ContextAwarePluginInterface {\n\n  /**\n   * Build a render array for layout with regions.\n   *\n   * @param array $regions\n   *   An associative array keyed by region name, containing render arrays\n   *   representing the content that should be placed in each region.\n   *\n   * @return array\n   *   Render array for the layout with regions.\n   */\n  public function build(array $regions);\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return \\Drupal\\Core\\Layout\\LayoutDefinition\n   *   The layout plugin definition for this plugin.\n   */\n  public function getPluginDefinition();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Layout/LayoutInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "LayoutInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Known database update issues and workarounds", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [8.6.0](/docs/updating-drupal/known-database-update-issues-and-workarounds#s-860)\n* [Errors logged when viewing recent logs on multilingual sites](/docs/updating-drupal/known-database-update-issues-and-workarounds#s-errors-logged-when-viewing-recent-logs-on-multilingual-sites)\n* [Custom blocks are no longer displayed and no longer appear in the custom block library](/docs/updating-drupal/known-database-update-issues-and-workarounds#s-custom-blocks-are-no-longer-displayed-and-no-longer-appear-in-the-custom-block-library)\n* [Primary language taxonomy terms unpublished](/docs/updating-drupal/known-database-update-issues-and-workarounds#s-primary-language-taxonomy-terms-unpublished)\n\n## [Updating Drupal](/docs/updating-drupal)\n\n* [Overview of options](/docs/updating-drupal/options-for-updating-drupal-core)\n* [Update core via Composer](/docs/updating-drupal/updating-drupal-core-via-composer)\n* [Update core manually](/docs/updating-drupal/updating-drupal-core-manually)\n* [Update modules](/docs/updating-drupal/updating-modules-and-themes-using-composer)\n* [Migrate composer project for Drupal earlier than 8.8.0](/docs/updating-drupal/migrating-the-composer-project-for-drupal-earlier-than-880)\n* [Troubleshooting database updates](/docs/updating-drupal/troubleshooting-database-updates)\n* [Known database update issues and workarounds](/docs/updating-drupal/known-database-update-issues-and-workarounds)\n* [Responding to critical security update advisories](/docs/updating-drupal/responding-to-critical-security-update-advisories)\n* [Automatic Updates](/docs/8/update/automatic-updates)\n* [Drupal updates and deployments](/docs/updating-drupal/deploying-a-drupal-update)\n* [How to back up your Drupal site](/docs/updating-drupal/how-to-back-up-your-drupal-site)\n\n# Known database update issues and workarounds\n\nLast [updated](/node/3279585/discuss) on\n\n16 November 2023\n\nThis documentation **needs work**. See \"Help improve this page\" in the sidebar.\n\n### 8.6.0\n\n#### Errors logged when viewing recent logs on multilingual sites\n\nIf your site logs either a `Illegal string offset 'value'`  or a `Placeholders must have a trailing []` error when viewing /admin/reports/dblog a workaround, using the user interface is available. Read the details at [The view of 'Recent log messages' causes errors on multilingual sites](https://www.drupal.org/node/3279323).\n\n#### Custom blocks are no longer displayed and no longer appear in the custom block library\n\nIf your site has this problem after an upgrade, there are workarounds listed in [#2997898: Custom blocks are no longer displayed and no longer appear in the custom block library](/project/drupal/issues/2997898 \"Status: Closed (cannot reproduce)\").\n\n#### Primary language taxonomy terms unpublished\n\nSome multi-lingual sites reported that taxonomy terms in the default language became unpublished. To publish the taxonomy terms read the 'Proposed resolution' section in [#2998221: Primary language taxonomy terms unpublished during 8.6.0 upgrade](/project/drupal/issues/2998221 \"Status: Closed (outdated)\").\n\n## Related Content\n\n## [Troubleshooting database updates](/docs/updating-drupal/troubleshooting-database-updates)\n\nTroubleshooting steps to take if update.php reports a problem.\n\n## Help improve this page\n\n**Page status:**  Needs work\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3279585/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283279585%29%20Known%20database%20update%20issues%20and%20workarounds) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/updating-drupal/known-database-update-issues-and-workarounds.md", "type": "doc_summary", "topic": "Known database update issues and workarounds"}}
{"instruction": "Show me the implementation of the class ConfigMapperPopulateEvent in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\config_translation\\Event;\n\nuse Drupal\\config_translation\\ConfigMapperInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Provides a class for events related to configuration translation mappers.\n */\nclass ConfigMapperPopulateEvent extends Event {\n\n  /**\n   * The configuration mapper this event is related to.\n   *\n   * @var \\Drupal\\config_translation\\ConfigMapperInterface\n   */\n  protected $mapper;\n\n  /**\n   * The route match this event is related to.\n   *\n   * @var \\Drupal\\Core\\Routing\\RouteMatchInterface\n   */\n  protected $routeMatch;\n\n  /**\n   * Constructs a ConfigMapperPopulateEvent object.\n   *\n   * @param \\Drupal\\config_translation\\ConfigMapperInterface $mapper\n   *   The configuration mapper this event is related to.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match this event is related to.\n   */\n  public function __construct(ConfigMapperInterface $mapper, RouteMatchInterface $route_match) {\n    $this->mapper = $mapper;\n    $this->routeMatch = $route_match;\n  }\n\n  /**\n   * Gets the configuration mapper this event is related to.\n   *\n   * @return \\Drupal\\config_translation\\ConfigMapperInterface\n   *   The configuration mapper this event is related to.\n   */\n  public function getMapper() {\n    return $this->mapper;\n  }\n\n  /**\n   * Gets the route match this event is related to.\n   *\n   * @return \\Drupal\\Core\\Routing\\RouteMatchInterface\n   *   The route match this event is related to.\n   */\n  public function getRouteMatch() {\n    return $this->routeMatch;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/config_translation/src/Event/ConfigMapperPopulateEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigMapperPopulateEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: FormErrorHandlerInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\Core\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Ensure these methods exist where relevant:\n  - handleFormErrors()", "output": "<?php\n\nnamespace Drupal\\Core\\Form;\n\n/**\n * Provides an interface for handling form errors.\n */\ninterface FormErrorHandlerInterface {\n\n  /**\n   * Handles form errors after form validation.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return $this\n   */\n  public function handleFormErrors(array &$form, FormStateInterface $form_state);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Form/FormErrorHandlerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FormErrorHandlerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class FileAccessControlHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\file;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Entity\\EntityAccessControlHandler;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Provides a File access control handler.\n */\nclass FileAccessControlHandler extends EntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account) {\n    /** @var \\Drupal\\file\\FileInterface $entity */\n    if ($operation == 'download' || $operation == 'view') {\n      if (\\Drupal::service('stream_wrapper_manager')->getScheme($entity->getFileUri()) === 'public') {\n        if ($operation === 'download') {\n          return AccessResult::allowed();\n        }\n        else {\n          return AccessResult::allowedIfHasPermission($account, 'access content');\n        }\n      }\n      elseif ($references = $this->getFileReferences($entity)) {\n        foreach ($references as $field_name => $entity_map) {\n          foreach ($entity_map as $referencing_entities) {\n            /** @var \\Drupal\\Core\\Entity\\EntityInterface $referencing_entity */\n            foreach ($referencing_entities as $referencing_entity) {\n              $entity_and_field_access = $referencing_entity->access('view', $account, TRUE)->andIf($referencing_entity->$field_name->access('view', $account, TRUE));\n              if ($entity_and_field_access->isAllowed()) {\n                return $entity_and_field_access;\n              }\n            }\n          }\n        }\n      }\n      elseif ($entity->getOwnerId() == $account->id()) {\n        // This case handles new nodes, or detached files. The user who uploaded\n        // the file can access it even if it's not yet used.\n        if ($account->isAnonymous()) {\n          // For anonymous users, only the browser session that uploaded the\n          // file is positively allowed access to it. See file_save_upload().\n          // @todo Implement \\Drupal\\Core\\Entity\\EntityHandlerInterface so that\n          //   services can be more properly injected.\n          $allowed_fids = \\Drupal::service('session')->get('anonymous_allowed_file_ids', []);\n          if (!empty($allowed_fids[$entity->id()])) {\n            return AccessResult::allowed()->addCacheContexts(['session', 'user']);\n          }\n        }\n        else {\n          return AccessResult::allowed()->addCacheContexts(['user']);\n        }\n      }\n    }\n    elseif ($operation == 'update') {\n      $account = $this->prepareUser($account);\n      $file_uid = $entity->get('uid')->getValue();\n      // Only the file owner can update the file entity.\n      if (isset($file_uid[0]['target_id']) && $account->id() == $file_uid[0]['target_id']) {\n        return AccessResult::allowed();\n      }\n      return AccessResult::forbidden('Only the file owner can update the file entity.');\n    }\n    elseif ($operation == 'delete') {\n      $access = AccessResult::allowedIfHasPermission($account, 'delete any file');\n      if (!$access->isAllowed() && $account->hasPermission('delete own files')) {\n        $access = $access->orIf(AccessResult::allowedIf($account->id() == $entity->getOwnerId()))->cachePerUser()->addCacheableDependency($entity);\n      }\n      return $access;\n    }\n\n    // No opinion.\n    return AccessResult::neutral();\n  }\n\n  /**\n   * Wrapper for file_get_file_references().\n   *\n   * @param \\Drupal\\file\\FileInterface $file\n   *   The file object for which to get references.\n   *\n   * @return array\n   *   A multidimensional array. The keys are field_name, entity_type,\n   *   entity_id and the value is an entity referencing this file.\n   *\n   * @see file_get_file_references()\n   */\n  protected function getFileReferences(FileInterface $file) {\n    return file_get_file_references($file, NULL, EntityStorageInterface::FIELD_LOAD_REVISION, NULL);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkFieldAccess($operation, FieldDefinitionInterface $field_definition, AccountInterface $account, ?FieldItemListInterface $items = NULL) {\n    // Deny access to fields that should only be set on file creation, and\n    // \"status\" which should only be changed based on a file's usage.\n    $create_only_fields = [\n      'uri',\n      'filemime',\n      'filesize',\n    ];\n    // The operation is 'edit' when the entity is being created or updated.\n    // Determine if the entity is being updated by checking if it is new.\n    $field_name = $field_definition->getName();\n    if ($operation === 'edit' && $items && ($entity = $items->getEntity()) && !$entity->isNew() && in_array($field_name, $create_only_fields, TRUE)) {\n      return AccessResult::forbidden();\n    }\n    // Regardless of whether the entity exists access should be denied to the\n    // status field as this is managed via other APIs, for example:\n    // - \\Drupal\\file\\FileUsage\\FileUsageBase::add()\n    // - \\Drupal\\file\\Plugin\\EntityReferenceSelection\\FileSelection::createNewEntity()\n    if ($operation === 'edit' && $field_name === 'status') {\n      return AccessResult::forbidden();\n    }\n    return parent::checkFieldAccess($operation, $field_definition, $account, $items);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkCreateAccess(AccountInterface $account, array $context, $entity_bundle = NULL) {\n    // The file entity has no \"create\" permission because by default Drupal core\n    // does not allow creating file entities independently. It allows you to\n    // create file entities that are referenced from another entity\n    // (e.g. an image for an article). A contributed module is free to alter\n    // this to allow file entities to be created directly.\n    return AccessResult::neutral();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/FileAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileAccessControlHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.rag_search_summary.collection:\n  title: 'RAG Search Summaries'\n  parent: system.admin_config_ai\n  description: 'Manage RAG search summary configurations.'\n  route_name: entity.rag_search_summary.collection\n  weight: 10\n", "metadata": {"source": "repos/ai_rag_search_summary/ai_rag_search_summary.links.menu.yml", "type": "yaml_reference", "topic": "ai rag search summary.links.menu"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Field API", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Field API\n\nSame name and namespace in other branches\n\n1. [10 core/modules/field/field.module](/api/drupal/core%21modules%21field%21field.module/group/field/10) \\field\n2. [9 core/modules/field/field.module](/api/drupal/core%21modules%21field%21field.module/group/field/9) \\field\n3. [7.x modules/field/field.module](/api/drupal/modules%21field%21field.module/group/field/7.x) \\field\n\nAttaches custom data fields to Drupal entities.\n\nThe Field API allows custom data fields to be attached to Drupal entities and\ntakes care of storing, loading, editing, and rendering field data. Any entity\ntype (node, user, etc.) can use the Field API to make itself \"fieldable\" and\nthus allow fields to be attached to it. Other modules can provide a user\ninterface for managing custom fields via a web browser as well as a wide and\nflexible variety of data type, form element, and display format capabilities.\n\nThe Field API defines two primary data structures, FieldStorage and Field,\nand the concept of a Bundle. A FieldStorage defines a particular type of data\nthat can be attached to entities. A Field is attached to a single\nBundle. A Bundle is a set of fields that are treated as a group by the Field\nAttach API and is related to a single fieldable entity type.\n\nFor example, suppose a site administrator wants Article nodes to have a\nsubtitle and photo. Using the Field API or Field UI module, the administrator\ncreates a field named 'subtitle' of type 'text' and a field named 'photo' of\ntype 'image'. The administrator (again, via a UI) creates two Field\nInstances, one attaching the field 'subtitle' to the 'node' bundle 'article'\nand one attaching the field 'photo' to the 'node' bundle 'article'. When the\nnode storage loads an Article node, it loads the values of the\n'subtitle' and 'photo' fields because they are both attached to the 'node'\nbundle 'article'.\n\n* **[Field Types API](/api/drupal/core%21modules%21field%21field.api.php/group/field_types/8.9.x \"Defines field, widget, display formatter, and storage types.\")**: Defines field types, widget\n  types, and display formatters. Field modules use this API to provide field\n  types like Text and Node Reference along with the associated form elements\n  and display formatters.\n\n* **[Field API bulk data deletion](/api/drupal/core%21modules%21field%21field.purge.inc/group/field_purge/8.9.x \"Cleans up after Field API bulk deletion operations.\")**: Cleans up after\n  bulk deletion operations such as deletion of field storage or field.\n\n### File\n\ncore/modules/field/[field.module](/api/drupal/core%21modules%21field%21field.module/8.9.x), line 29\n\n### Functions\n\n| [Title](?order=title&sort=desc \"sort by Title\") | [File name](?order=file_name&sort=asc \"sort by File name\") | Summary |\n| --- | --- | --- |\n| [field\\_cron](/api/drupal/core%21modules%21field%21field.module/function/field_cron/8.9.x) | core/modules/field/[field.module](/api/drupal/core%21modules%21field%21field.module/8.9.x) | Implements hook\\_cron(). |\n| [field\\_entity\\_bundle\\_delete](/api/drupal/core%21modules%21field%21field.module/function/field_entity_bundle_delete/8.9.x) | core/modules/field/[field.module](/api/drupal/core%21modules%21field%21field.module/8.9.x) | Implements hook\\_entity\\_bundle\\_delete(). |\n| [field\\_entity\\_bundle\\_field\\_info](/api/drupal/core%21modules%21field%21field.module/function/field_entity_bundle_field_info/8.9.x) | core/modules/field/[field.module](/api/drupal/core%21modules%21field%21field.module/8.9.x) | Implements hook\\_entity\\_bundle\\_field\\_info(). |\n| [field\\_entity\\_field\\_storage\\_info](/api/drupal/core%21modules%21field%21field.module/function/field_entity_field_storage_info/8.9.x) | core/modules/field/[field.module](/api/drupal/core%21modules%21field%21field.module/8.9.x) | Implements hook\\_entity\\_field\\_storage\\_info(). |\n| [field\\_help](/api/drupal/core%21modules%21field%21field.module/function/field_help/8.9.x) | core/modules/field/[field.module](/api/drupal/core%21modules%21field%21field.module/8.9.x) | Implements hook\\_help(). |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=8.9.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521modules%2521field%2521field.module/group/field/8.9.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21modules%21field%21field.module/group/field/8.9.x.md", "type": "doc_summary", "topic": "Field API"}}
{"instruction": "Show me the implementation of the interface DocumentLoaderInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader\\Plugin;\n\nuse Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderInputInterface;\nuse Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface;\n\n/**\n * Interface for document loader plugins.\n */\ninterface DocumentLoaderInterface {\n\n  /**\n   * Loads a document and returns the output.\n   *\n   * @param \\Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderInputInterface $input\n   *   The input for the document loader.\n   *\n   * @return \\Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface\n   *   The loaded document output.\n   *\n   * @throws \\Exception\n   *   If the document cannot be loaded.\n   */\n  public function load(DocumentLoaderInputInterface $input): DocumentLoaderOutputInterface;\n\n  /**\n   * Gets the supported output types for this loader.\n   *\n   * @return string[]\n   *   An array of supported output type IDs.\n   */\n  public function getSupportedOutputTypes(): array;\n\n  /**\n   * Gets the supported document loader types for this loader.\n   *\n   * @return string[]\n   *   An array of supported document loader type IDs.\n   */\n  public function getSupportedDocumentLoaderTypes(): array;\n\n}\n", "metadata": {"source": "repos/document_loader/src/Plugin/DocumentLoaderInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DocumentLoaderInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface ExtendableInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Query;\n\n/**\n * Interface for extendable query objects.\n *\n * \"Extenders\" follow the \"Decorator\" OOP design pattern.  That is, they wrap\n * and \"decorate\" another object. In our case, they implement the same\n * interface as select queries and wrap a select query, to which they delegate\n * almost all operations. Subclasses of this class may implement additional\n * methods or override existing methods as appropriate. Extenders may also wrap\n * other extender objects, allowing for arbitrarily complex \"enhanced\" queries.\n */\ninterface ExtendableInterface {\n\n  /**\n   * Enhance this object by wrapping it in an extender object.\n   *\n   * @param class-string $extender_name\n   *   The fully-qualified name of the extender class, without the leading '\\'\n   *   (for example, Drupal\\my_module\\myExtenderClass). The extender name will\n   *   be checked against the current database connection to allow\n   *   driver-specific subclasses as well, using the same logic as the query\n   *   objects themselves.\n   *\n   * @return \\Drupal\\Core\\Database\\Query\\ExtendableInterface\n   *   The extender object, which now contains a reference to this object.\n   */\n  public function extend($extender_name);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Query/ExtendableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ExtendableInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "country_block.settings:\n  title: 'Country Block'\n  description: 'Configure which countries to block.'\n  parent: system.admin_config_system\n  route_name: country_block.settings\n", "metadata": {"source": "repos/country_block/country_block.links.menu.yml", "type": "yaml_reference", "topic": "country block.links.menu"}}
{"instruction": "Show me the implementation of the class ByBfsCommunityId in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\zefix\\Services;\n\nuse Drupal\\zefix\\ZefixApiClient;\n\n/**\n * Service to fetch cantonal commercial registry by bfsId.\n */\nclass ByBfsCommunityId {\n\n  /**\n   * The Zefix API client.\n   *\n   * @var \\Drupal\\zefix\\ZefixApiClient\n   */\n  protected ZefixApiClient $api;\n\n  /**\n   * Constructs a ByBfsCommunityId object.\n   *\n   * @param \\Drupal\\zefix\\ZefixApiClient $api\n   *   The Zefix API client.\n   */\n  public function __construct(ZefixApiClient $api) {\n    $this->api = $api;\n  }\n\n  /**\n   * Get the cantonal registry of commerce by the bfsId of a BfsCommunity.\n   *\n   * @link https://www.zefixintg.admin.ch/ZefixPublicREST/swagger-ui/index.html#/RegistryOfCommerce/byBfsCommunityId\n   *\n   * @param string $id\n   *   The bfsId of the BfsCommunity.\n   *\n   * @return array|null\n   *   The registry of commerce data or null on error.\n   */\n  public function byBfsCommunityId(string $id): ?array {\n    return $this->api->get('registryOfCommerce/byBfsCommunityId', $id);\n  }\n\n}\n", "metadata": {"source": "repos/zefix/src/Services/ByBfsCommunityId.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ByBfsCommunityId", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Labor Time Tracker'\ntype: module\ndescription: 'Tracks user enter/exit times and provides a simple time/attendance tracking system.'\npackage: Custom\ncore_version_requirement: ^10.3 || ^11\nconfigure: labor_time_tracker.admin.settings\n\ndependencies:\n  - admin_toolbar:admin_toolbar\n  - honeypot:honeypot\n", "metadata": {"source": "repos/labor_time_tracker/labor_time_tracker.info.yml", "type": "yaml_reference", "topic": "labor time tracker.info"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: UpdateMenuLink.php\nTarget symbol: class UpdateMenuLink\nNamespace: Drupal\\mcp_tools_menus\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for UpdateMenuLink.\n- Include required imports:\n  - Drupal\\mcp_tools_menus\\Service\\MenuService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_menus\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_menus\\Service\\MenuService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_menus_update_menu_link',\n  label: new TranslatableMarkup('Update Menu Link'),\n  description: new TranslatableMarkup('Update an existing menu link\\'s title, URL, weight, or other properties.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'link_id' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Link ID'),\n      description: new TranslatableMarkup('Menu link content entity ID'),\n      required: TRUE,\n    ),\n    'updates' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Updates'),\n      description: new TranslatableMarkup('Fields to update: title, uri, weight, expanded, description'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Link ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass UpdateMenuLink extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'menus';\n\n\n  protected MenuService $menuService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->menuService = $container->get('mcp_tools_menus.menu');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $linkId = $input['link_id'] ?? 0;\n\n    if (empty($linkId)) {\n      return ['success' => FALSE, 'error' => 'Link ID is required.'];\n    }\n\n    $updates = $input['updates'] ?? [];\n\n    if (empty($updates)) {\n      return ['success' => FALSE, 'error' => 'At least one field to update is required.'];\n    }\n\n    return $this->menuService->updateMenuLink((int) $linkId, $updates);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_menus/src/Plugin/tool/Tool/UpdateMenuLink.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UpdateMenuLink", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "ai_provider_openrouter.settings:\n  type: config_object\n  label: 'OpenRouter Provider settings'\n  mapping:\n    api_key:\n      type: string\n      label: 'API key (Key module entry)'\n    base_url:\n      type: string\n      label: 'API base URL'\n    selected_models:\n      type: sequence\n      label: 'Selected OpenRouter models'\n      sequence:\n        - type: string\n", "metadata": {"source": "repos/ai_provider_openrouter/config/schema/ai_provider_openrouter.schema.yml", "type": "yaml_reference", "topic": "ai provider openrouter.schema"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: OrchestratorHelper\nSource file: <source_file>\nFile name hint: OrchestratorHelper.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Orchestrator;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\flowdrop_runtime\\Plugin\\Orchestrator\\OrchestratorPluginInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Helper service for orchestrator-related operations.\n *\n * Centralizes common orchestrator interaction patterns including:\n * - Instance creation with fallback handling\n * - Default orchestrator resolution\n * - Form options building\n * - Orchestrator type validation and detection.\n *\n * This service reduces code duplication across modules and ensures consistent\n * behavior when working with orchestrators.\n *\n * @see \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorHelperInterface\n */\nclass OrchestratorHelper implements OrchestratorHelperInterface {\n\n  /**\n   * The orchestrator plugin manager.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorPluginManager\n   */\n  protected OrchestratorPluginManager $pluginManager;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs a new OrchestratorHelper.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorPluginManager $plugin_manager\n   *   The orchestrator plugin manager.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    OrchestratorPluginManager $plugin_manager,\n    ConfigFactoryInterface $config_factory,\n    LoggerInterface $logger,\n  ) {\n    $this->pluginManager = $plugin_manager;\n    $this->configFactory = $config_factory;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInstance(string $type, ?string $fallback = NULL): OrchestratorPluginInterface {\n    $fallback = $fallback ?? self::ASYNCHRONOUS;\n\n    // Handle \"default\" type by resolving to actual default.\n    if ($type === \"default\") {\n      $type = $this->resolveDefault();\n    }\n\n    // Validate the orchestrator type exists.\n    if (!$this->pluginManager->hasDefinition($type)) {\n      $this->logger->warning(\"Orchestrator type '@type' not available, falling back to '@fallback'.\", [\n        \"@type\" => $type,\n        \"@fallback\" => $fallback,\n      ]);\n      $type = $fallback;\n\n      // If even the fallback doesn't exist, this is a critical error.\n      if (!$this->pluginManager->hasDefinition($type)) {\n        throw new \\RuntimeException(sprintf(\n          \"Neither orchestrator type '%s' nor fallback '%s' is available.\",\n          $type,\n          $fallback\n        ));\n      }\n    }\n\n    return $this->pluginManager->createInstance($type);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInstanceFromSettings(\n    array $settings,\n    ?string $defaultType = NULL,\n  ): OrchestratorPluginInterface {\n    $defaultType = $defaultType ?? self::ASYNCHRONOUS;\n    $type = $settings[\"type\"] ?? $defaultType;\n\n    return $this->getInstance($type, $defaultType);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolveDefault(?string $eventType = NULL): string {\n    // Check for presave events - these must be synchronous.\n    if ($eventType !== NULL && str_contains($eventType, \".presave\")) {\n      return self::SYNCHRONOUS;\n    }", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Orchestrator;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\flowdrop_runtime\\Plugin\\Orchestrator\\OrchestratorPluginInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Helper service for orchestrator-related operations.\n *\n * Centralizes common orchestrator interaction patterns including:\n * - Instance creation with fallback handling\n * - Default orchestrator resolution\n * - Form options building\n * - Orchestrator type validation and detection.\n *\n * This service reduces code duplication across modules and ensures consistent\n * behavior when working with orchestrators.\n *\n * @see \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorHelperInterface\n */\nclass OrchestratorHelper implements OrchestratorHelperInterface {\n\n  /**\n   * The orchestrator plugin manager.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorPluginManager\n   */\n  protected OrchestratorPluginManager $pluginManager;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs a new OrchestratorHelper.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorPluginManager $plugin_manager\n   *   The orchestrator plugin manager.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    OrchestratorPluginManager $plugin_manager,\n    ConfigFactoryInterface $config_factory,\n    LoggerInterface $logger,\n  ) {\n    $this->pluginManager = $plugin_manager;\n    $this->configFactory = $config_factory;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInstance(string $type, ?string $fallback = NULL): OrchestratorPluginInterface {\n    $fallback = $fallback ?? self::ASYNCHRONOUS;\n\n    // Handle \"default\" type by resolving to actual default.\n    if ($type === \"default\") {\n      $type = $this->resolveDefault();\n    }\n\n    // Validate the orchestrator type exists.\n    if (!$this->pluginManager->hasDefinition($type)) {\n      $this->logger->warning(\"Orchestrator type '@type' not available, falling back to '@fallback'.\", [\n        \"@type\" => $type,\n        \"@fallback\" => $fallback,\n      ]);\n      $type = $fallback;\n\n      // If even the fallback doesn't exist, this is a critical error.\n      if (!$this->pluginManager->hasDefinition($type)) {\n        throw new \\RuntimeException(sprintf(\n          \"Neither orchestrator type '%s' nor fallback '%s' is available.\",\n          $type,\n          $fallback\n        ));\n      }\n    }\n\n    return $this->pluginManager->createInstance($type);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInstanceFromSettings(\n    array $settings,\n    ?string $defaultType = NULL,\n  ): OrchestratorPluginInterface {\n    $defaultType = $defaultType ?? self::ASYNCHRONOUS;\n    $type = $settings[\"type\"] ?? $defaultType;\n\n    return $this->getInstance($type, $defaultType);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolveDefault(?string $eventType = NULL): string {\n    // Check for presave events - these must be synchronous.\n    if ($eventType !== NULL && str_contains($eventType, \".presave\")) {\n      return self::SYNCHRONOUS;\n    }\n\n    // Try to get from trigger settings first.\n    $triggerSettings = $this->configFactory->get(\"flowdrop_trigger.settings\");\n    $default = $triggerSettings->get(\"default_orchestrator\");\n\n    if ($default !== NULL && $this->validate($default)) {\n      return $default;\n    }\n\n    // Fall back to general FlowDrop settings.\n    $flowdropSettings = $this->configFactory->get(\"flowdrop.settings\");\n    $default = $flowdropSettings->get(\"execution.default_orchestrator\");\n\n    if ($default !== NULL && $this->validate($default)) {\n      return $default;\n    }\n\n    // Final fallback to asynchronous.\n    return self::ASYNCHRONOUS;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(string $type): bool {\n    // Handle \"default\" as valid - it will be resolved later.\n    if ($type === \"default\") {\n      return TRUE;\n    }\n\n    return $this->pluginManager->hasDefinition($type);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormOptions(bool $includeDefault = FALSE): array {\n    $options = [];\n\n    // Optionally include \"default\" option at the start.\n    if ($includeDefault) {\n      $options[\"default\"] = \"Default (based on event)\";\n    }\n\n    // Get all available orchestrator definitions.\n    $definitions = $this->pluginManager->getDefinitions();\n\n    foreach ($definitions as $id => $definition) {\n      $label = $definition[\"label\"] ?? ucfirst(str_replace(\"_\", \" \", $id));\n\n      // Handle TranslatableMarkup objects.\n      if ($label instanceof \\Stringable) {\n        $label = (string) $label;\n      }\n\n      $options[$id] = $label;\n    }\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOriginalId(string $namespacedId): string {\n    return $this->pluginManager->getOriginalIdFromNamespacedId($namespacedId);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isStateGraph(string $type): bool {\n    $originalId = $this->getOriginalId($type);\n    return $originalId === \"stategraph\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isSynchronous(string $type): bool {\n    $originalId = $this->getOriginalId($type);\n    return $originalId === \"synchronous\" || $originalId === \"synchronous_pipeline\";\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Orchestrator/OrchestratorHelper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OrchestratorHelper", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class InstallerRouteProviderLazyBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Installer;\n\nuse Drupal\\Core\\Routing\\RouteProviderLazyBuilder;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * A Route Provider front-end for use during the installer.\n */\nclass InstallerRouteProviderLazyBuilder extends RouteProviderLazyBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRouteByName($name) {\n    if ($name === '<none>' || $name === '<front>') {\n      // During the installer template_preprocess_page() uses the routing system\n      // to determine the front page. At this point building the router for this\n      // is unnecessary work.\n      return new Route('/');\n    }\n    return parent::getRouteByName($name);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Installer/InstallerRouteProviderLazyBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InstallerRouteProviderLazyBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GetIndexStatus in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_search_api\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_search_api\\Service\\SearchApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_search_api_status',\n  label: new TranslatableMarkup('Get Index Status'),\n  description: new TranslatableMarkup('Get indexing status for a search index (total, indexed, remaining).'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Index ID'),\n      description: new TranslatableMarkup('The machine name of the search index.'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'index_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Index ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'status' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Indexing status'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass GetIndexStatus extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'search_api';\n\n\n  protected SearchApiService $searchApiService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->searchApiService = $container->get('mcp_tools_search_api.search_api_service');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $id = $input['id'] ?? '';\n    if (empty($id)) {\n      return [\n        'success' => FALSE,\n        'error' => 'id is required.',\n        'code' => 'VALIDATION_ERROR',\n      ];\n    }\n\n    return $this->searchApiService->getIndexStatus($id);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_search_api/src/Plugin/tool/Tool/GetIndexStatus.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetIndexStatus", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: ContextualLinkInterface.php", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# ContextualLinkInterface.php\n\nSame filename and directory in other branches\n\n1. [10 core/lib/Drupal/Core/Menu/ContextualLinkInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/10)\n2. [9 core/lib/Drupal/Core/Menu/ContextualLinkInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/9)\n3. [8.9.x core/lib/Drupal/Core/Menu/ContextualLinkInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/8.9.x)\n\n### Namespace\n\n[Drupal\\Core\\Menu](/api/drupal/namespace/Drupal%21Core%21Menu/11.x)\n\n### File\n\n[View on git.drupalcode.org](https://git.drupalcode.org/project/drupal/-/blob/11.x/core/lib/Drupal/Core/Menu/ContextualLinkInterface.php)\n\ncore/lib/Drupal/Core/Menu/[ContextualLinkInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/11.x)\n\nView source\n\n```\n<?php\n\nnamespace Drupal\\Core\\Menu;\n\n/**\n * Defines a contextual link plugin.\n *\n * Contextual links by default are in the module_name.links.contextual.yml\n * file. These YAML files contain a list of contextual link plugin definitions,\n * keyed by the plugin ID. Each definition must define a route_name and a group\n * and might define title, options, and weight. See the getter methods on this\n * interface for an explanation of each.\n *\n * @ingroup menu\n */\ninterface ContextualLinkInterface {\n\n  /**\n   * Returns the localized title to be shown for this contextual link.\n   *\n   * Subclasses may add optional arguments like NodeInterface $node = NULL that\n   * will be supplied by the ControllerResolver.\n   *\n   * @return string\n   *   The title to be shown for this action.\n   *\n   * @see \\Drupal\\Core\\Menu\\ContextualLinksManager::getTitle()\n   */\n  public function getTitle();\n\n  /**\n   * Returns the route name of the contextual link.\n   *\n   * @return string\n   *   The name of the route this contextual link links to.\n   */\n  public function getRouteName();\n\n  /**\n   * Returns the group this contextual link should be rendered in.\n   *\n   * A contextual link group is a set of contextual links that are displayed\n   * together on a certain page. For example, the 'block' group displays all\n   * links related to the block, such as the block instance edit link as well as\n   * the views edit link, if it is a view block.\n   *\n   * @return string\n   *   The contextual links group name.\n   */\n  public function getGroup();\n\n  /**\n   * Returns the link options passed to the link generator.\n   *\n   * @return array\n   *   An associative array of options.\n   */\n  public function getOptions();\n\n  /**\n   * Returns the weight of the contextual link.\n   *\n   * The contextual links in one group are sorted by weight for display.\n   *\n   * @return int\n   *   The weight as positive/negative integer.\n   */\n  public function getWeight();\n\n}\n```\n\n### Interfaces\n\n| Title | Deprecated | Summary |\n| --- | --- | --- |\n| [ContextualLinkInterface](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/interface/ContextualLinkInterface/11.x) |  | Defines a contextual link plugin. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Menu%2521ContextualLinkInterface.php/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/11.x.md", "type": "doc_summary", "topic": "ContextualLinkInterface.php"}}
{"instruction": "Show me the implementation of the class NormalizerRegistry in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface;\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\OpenAINormalizer;\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\AnthropicNormalizer;\nuse Drupal\\api_normalization\\Plugin\\Normalizer\\OllamaNormalizer;\n\n/**\n * Registry for managing provider normalizers.\n *\n * Central registry that maps provider IDs to their specific normalizer\n * implementations. Eliminates duplicate provider detection logic across\n * multiple services.\n */\nclass NormalizerRegistry {\n\n  /**\n   * Registered normalizers keyed by provider ID.\n   *\n   * @var \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface[]\n   */\n  protected array $normalizers = [];\n\n  /**\n   * The provider registry.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\ProviderRegistry\n   */\n  protected ProviderRegistry $providerRegistry;\n\n  /**\n   * Constructs a NormalizerRegistry.\n   *\n   * @param \\Drupal\\api_normalization\\Service\\ProviderRegistry $provider_registry\n   *   The provider registry service.\n   */\n  public function __construct(ProviderRegistry $provider_registry) {\n    $this->providerRegistry = $provider_registry;\n    $this->registerDefaultNormalizers();\n  }\n\n  /**\n   * Register default normalizers for known providers.\n   */\n  protected function registerDefaultNormalizers(): void {\n    $this->registerNormalizer(new OpenAINormalizer());\n    $this->registerNormalizer(new AnthropicNormalizer());\n    $this->registerNormalizer(new OllamaNormalizer());\n  }\n\n  /**\n   * Register a normalizer.\n   *\n   * @param \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface $normalizer\n   *   The normalizer to register.\n   *\n   * @return $this\n   */\n  public function registerNormalizer(NormalizerInterface $normalizer): self {\n    $this->normalizers[$normalizer->getProviderId()] = $normalizer;\n    return $this;\n  }\n\n  /**\n   * Get a normalizer by provider ID.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   *\n   * @return \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface|null\n   *   The normalizer, or NULL if not found.\n   */\n  public function getNormalizer(string $provider_id): ?NormalizerInterface {\n    // Clean provider ID (remove 'provider_' prefix if present).\n    $clean_id = str_replace('provider_', '', $provider_id);\n\n    return $this->normalizers[$clean_id] ?? NULL;\n  }\n\n  /**\n   * Check if a normalizer exists for a provider.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   *\n   * @return bool\n   *   TRUE if a normalizer exists, FALSE otherwise.\n   */\n  public function hasNormalizer(string $provider_id): bool {\n    return $this->getNormalizer($provider_id) !== NULL;\n  }\n\n  /**\n   * Get all registered normalizers.\n   *\n   * @return \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface[]\n   *   Array of normalizers keyed by provider ID.\n   */\n  public function getAllNormalizers(): array {\n    return $this->normalizers;\n  }\n\n  /**\n   * Get normalizer for a provider with automatic detection fallback.\n   *\n   * If no normalizer is found by exact provider ID, attempts to detect\n   * the provider from the given content/context.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   * @param string|null $detection_content\n   *   Optional content for provider detection fallback.\n   *\n   * @return \\Drupal\\api_normalization\\Plugin\\Normalizer\\NormalizerInterface|null\n   *   The normalizer, or NULL if not found.\n   */\n  public function getNormalizerWithFallback(string $provider_id, ?string $detection_content = NULL): ?NormalizerInterface {\n    $normalizer = $this->getNormalizer($provider_id);\n\n    if ($normalizer === NULL && $detection_content !== NULL) {\n      // Try provider detection.\n      $detected_provider = $this->providerRegistry->detectProvider($detection_content);\n      $normalizer = $this->getNormalizer($detected_provider);\n    }\n\n    return $normalizer;\n  }\n\n  /**\n   * Get all provider IDs that have registered normalizers.\n   *\n   * @return array\n   *   Array of provider IDs.\n   */\n  public function getProviderIds(): array {\n    return array_keys($this->normalizers);\n  }\n\n  /**\n   * Check if a normalizer supports a specific operation.\n   *\n   * @param string $provider_id\n   *   The provider ID.\n   * @param string $operation\n   *   The operation name (e.g., 'chat', 'embeddings').\n   *\n   * @return bool\n   *   TRUE if the operation is supported, FALSE otherwise.\n   */\n  public function supportsOperation(string $provider_id, string $operation): bool {\n    $normalizer = $this->getNormalizer($provider_id);\n    return $normalizer ? $normalizer->supports($operation) : FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/NormalizerRegistry.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NormalizerRegistry", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DataReferenceDefinition.php\nTarget symbol: class for\nNamespace: Drupal\\Core\\TypedData\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Ensure these methods exist where relevant:\n  - create()\n  - createFromDataType()\n  - getTargetDefinition()\n  - setTargetDefinition()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\TypedData;\n\n/**\n * A typed data definition class for defining references.\n *\n * Note that this definition class assumes that the data type for referencing\n * a certain target type is named \"{TARGET_TYPE}_reference\".\n *\n * @see \\Drupal\\Core\\TypedData\\DataReferenceBase\n */\nclass DataReferenceDefinition extends DataDefinition implements DataReferenceDefinitionInterface {\n\n  /**\n   * @var \\Drupal\\Core\\TypedData\\DataDefinitionInterface\n   */\n  protected $targetDefinition;\n\n  /**\n   * Creates a new data reference definition.\n   *\n   * @param string $target_data_type\n   *   The data type of the referenced data.\n   *\n   * @return static\n   */\n  public static function create($target_data_type) {\n    // This assumes implementations use a \"TYPE_reference\" naming pattern.\n    $definition = parent::create($target_data_type . '_reference');\n    return $definition->setTargetDefinition(\\Drupal::typedDataManager()->createDataDefinition($target_data_type));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createFromDataType($data_type) {\n    if (!str_ends_with($data_type, '_reference')) {\n      throw new \\InvalidArgumentException('Data type must be of the form \"{TARGET_TYPE}_reference\"');\n    }\n    // Cut of the _reference suffix.\n    return static::create(substr($data_type, 0, strlen($data_type) - strlen('_reference')));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetDefinition() {\n    return $this->targetDefinition;\n  }\n\n  /**\n   * Sets the definition of the referenced data.\n   *\n   * @param \\Drupal\\Core\\TypedData\\DataDefinitionInterface $definition\n   *   The target definition to set.\n   *\n   * @return $this\n   */\n  public function setTargetDefinition(DataDefinitionInterface $definition) {\n    $this->targetDefinition = $definition;\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/DataReferenceDefinition.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DataReferenceDefinition", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class LapostaSubscribeHelpController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\laposta_subscribe\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Url;\nuse Drupal\\laposta_subscribe\\Service\\LapostaSubscribeApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\nclass LapostaSubscribeHelpController extends ControllerBase\n{\n  protected $lapostaSubscribeApiService;\n\n  public function __construct(LapostaSubscribeApiService $laposta_subscribe_api_service)\n  {\n    $this->lapostaSubscribeApiService = $laposta_subscribe_api_service;\n  }\n\n  public static function create(ContainerInterface $container)\n  {\n    return new static(\n      $container->get('laposta_subscribe.api_service')\n    );\n  }\n\n  public function help()\n  {\n    $help_email = 'helpdesk@laposta.nl';\n    $author_email = 'fred@miix.dev';\n\n    // Get API info\n    $api_info = $this->lapostaSubscribeApiService->getApiInfo();\n\n    $build = [\n      '#theme' => 'laposta_subscribe_help',\n      '#content' => [\n        'general_setup' => [\n          'title' => $this->t('General Setup'),\n          'items' => [\n            $this->t('Enter your Laposta API key in the API Key Settings.'),\n            $this->t('Select a list and fetch available fields in the List and Fields Settings.'),\n            $this->t('Configure form display settings in the Form Settings.'),\n          ],\n        ],\n        'field_configuration' => [\n          'title' => $this->t('Field Configuration'),\n          'items' => [\n            $this->t('Enable or disable fields as needed.'),\n            $this->t('Rearrange fields by dragging them in the field table.'),\n            $this->t('Single select fields can be displayed as dropdown or radio buttons (Laposta setting).'),\n          ],\n        ],\n        'form_customization' => [\n          'title' => $this->t('Form Customization'),\n          'items' => [\n            $this->t('Override the list name for display purposes.'),\n            $this->t('Show or hide list remarks.'),\n            $this->t('Customize the submit button text.'),\n          ],\n        ],\n        'preview' => [\n          'title' => $this->t('Preview'),\n          'content' => $this->t('Use the Preview tab to preview your form and ensure it\\'s working correctly.'),\n        ],\n        'adding_form' => [\n          'title' => $this->t('Adding the Subscription Form to Your Website'),\n          'items' => [\n            $this->t('Go to the Structure > Block layout page (@url).', ['@url' => Url::fromRoute('block.admin_display')->toString()]),\n            $this->t('Click \"Place block\" in the region where you want the form to appear.'),\n            $this->t('Find \"Laposta Subscribe Form\" in the list and click \"Place block\".'),\n            $this->t('Configure the block settings as needed (title, visibility rules, etc.).'),\n            $this->t('Click \"Save block\".'),\n            $this->t('The subscription form will now appear in the selected region of your website.'),\n          ],\n        ],\n        'troubleshooting' => [\n          'title' => $this->t('Troubleshooting'),\n          'items' => [\n            $this->t('Clear cache after making configuration changes.'),\n            $this->t('Check Drupal logs for any error messages.'),\n            $this->t('Ensure your Laposta API key is valid and has necessary permissions.'),\n          ],\n        ],\n        'api_status' => [\n          'title' => $this->t('API Connection Status'),\n          'status' => $api_info['status'],\n          'message' => $api_info['message'],\n          'account_name' => $api_info['account_name'] ?? $this->t('Not available'),\n          'account_number' => $api_info['account_number'] ?? $this->t('Not available'),\n        ],\n        'further_assistance' => [\n          'title' => $this->t('Need Further Assistance?'),\n          'content' => $this->t('If you need additional help or have any questions, please don\\'t hesitate to contact the Laposta support team at:'),\n          'email' => $help_email,\n        ],\n        'about_author' => [\n          'title' => $this->t('About the Author'),\n          'content' => $this->t('This module was created by Fred Klopper. For module-specific inquiries or support, you can contact the author at:'),\n          'email' => $author_email,\n        ],\n      ],\n    ];\n\n    $build['#attached']['library'][] = 'laposta_subscribe/admin_styles';\n    $build['#attached']['library'][] = 'laposta_subscribe/copy_account_number';\n\n    return $build;\n  }\n}\n", "metadata": {"source": "repos/laposta_subscribe/src/Controller/LapostaSubscribeHelpController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LapostaSubscribeHelpController", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: MediaLibraryEditorOpener.php\nTarget symbol: class MediaLibraryEditorOpener\nNamespace: Drupal\\media_library\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for MediaLibraryEditorOpener.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Ajax\\AjaxResponse\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\editor\\Ajax\\EditorDialogSave\n- Ensure these methods exist where relevant:\n  - __construct()\n  - checkAccess()\n  - getSelectionResponse()", "output": "<?php\n\nnamespace Drupal\\media_library;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\editor\\Ajax\\EditorDialogSave;\n\n/**\n * The media library opener for text editors.\n *\n * @internal\n *   This is an internal part of Media Library's text editor integration.\n */\nclass MediaLibraryEditorOpener implements MediaLibraryOpenerInterface {\n\n  /**\n   * The text format entity storage.\n   *\n   * @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityStorageInterface\n   */\n  protected $filterStorage;\n\n  /**\n   * The media storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\ContentEntityStorageInterface\n   */\n  protected $mediaStorage;\n\n  /**\n   * The MediaLibraryEditorOpener constructor.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager) {\n    $this->filterStorage = $entity_type_manager->getStorage('filter_format');\n    $this->mediaStorage = $entity_type_manager->getStorage('media');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function checkAccess(MediaLibraryState $state, AccountInterface $account) {\n    $filter_format_id = $state->getOpenerParameters()['filter_format_id'];\n    $filter_format = $this->filterStorage->load($filter_format_id);\n    if (empty($filter_format)) {\n      return AccessResult::forbidden()\n        ->addCacheTags(['filter_format_list'])\n        ->setReason(\"The text format '$filter_format_id' could not be loaded.\");\n    }\n    $filters = $filter_format->filters();\n    return $filter_format->access('use', $account, TRUE)\n      ->andIf(AccessResult::allowedIf($filters->has('media_embed') && $filters->get('media_embed')->status === TRUE));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSelectionResponse(MediaLibraryState $state, array $selected_ids) {\n    $selected_media = $this->mediaStorage->load(reset($selected_ids));\n\n    $response = new AjaxResponse();\n    $values = [\n      'attributes' => [\n        'data-entity-type' => 'media',\n        'data-entity-uuid' => $selected_media->uuid(),\n      ],\n    ];\n    $response->addCommand(new EditorDialogSave($values));\n\n    return $response;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media_library/src/MediaLibraryEditorOpener.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaLibraryEditorOpener", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: Compiler.php\nTarget symbol: class Compiler\nNamespace: Drupal\\compiler\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for Compiler.\n- Include required imports:\n  - Drupal\\Component\\Annotation\\PluginID", "output": "<?php\n\nnamespace Drupal\\compiler\\Annotation;\n\nuse Drupal\\Component\\Annotation\\PluginID;\n\n/**\n * Defines a compiler plugin annotation object.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * @Annotation\n */\nclass Compiler extends PluginID {\n\n}\n", "metadata": {"source": "repos/compiler/src/Annotation/Compiler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Compiler", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class SoapResponseResetEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Event;\n\n/**\n * Event emitted when SOAP selection is cleared/reset.\n *\n * Emitted when a user clears or resets their selection\n * in a SOAP element, returning to initial/undefined state.\n */\nclass SoapResponseResetEvent extends SoapResponseEventBase\n{\n}\n", "metadata": {"source": "repos/soap_client/src/Event/SoapResponseResetEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapResponseResetEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: seo_audit.install\nSource file: <source_file>\nFile name hint: seo_audit.install\nCurrent implementation:\n<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the SEO Audit module.\n */\n\n/**\n * Implements hook_install().\n */\nfunction seo_audit_install() {\n  \\Drupal::database()->schema()->createTable('seo_audit_crawl_result', [\n    'fields' => [\n      'id' => [\n        'type' => 'serial',\n        'not null' => TRUE,\n        'description' => 'Primary key for crawl results',\n      ],\n      'user_id' => [\n        'type' => 'int',\n        'not null' => TRUE,\n        'description' => 'User ID who submitted the crawl',\n      ],\n      'url' => [\n        'type' => 'varchar',\n        'length' => 255,\n        'not null' => TRUE,\n        'description' => 'The URL that was crawled',\n      ],\n      'results' => [\n        'type' => 'text',\n        'mysql_type' => 'mediumtext',\n        'not null' => TRUE,\n        'description' => 'Crawl results',\n      ],\n      'created' => [\n        'type' => 'int',\n        'not null' => TRUE,\n        'description' => 'Timestamp when the crawl was requested',\n      ],\n      'completed' => [\n        'type' => 'int',\n        'not null' => FALSE,\n        'description' => 'Timestamp when the crawl was completed',\n      ],\n      'status' => [\n        'type' => 'varchar',\n        'length' => 20,\n        'not null' => TRUE,\n        'default' => 'pending',\n        'description' => 'Status of the crawl (pending/completed)',\n      ],\n      'checked_options' => [\n        'type' => 'text',\n        'mysql_type' => 'mediumtext',\n        'not null' => TRUE,\n        'description' => 'JSON-encoded array of SEO checks enabled during this crawl',\n      ],\n    ],\n    'primary key' => ['id'],\n  ]);\n\n  \\Drupal::logger('seo_audit')->info(\"Created 'seo_audit_crawl_result' table.\");\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction seo_audit_uninstall() {\n  \\Drupal::database()->schema()->dropTable('seo_audit_crawl_result');\n  \\Drupal::logger('seo_audit')->info(\"Removed 'seo_audit_crawl_result' table.\");\n}", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the SEO Audit module.\n */\n\n/**\n * Implements hook_install().\n */\nfunction seo_audit_install() {\n  \\Drupal::database()->schema()->createTable('seo_audit_crawl_result', [\n    'fields' => [\n      'id' => [\n        'type' => 'serial',\n        'not null' => TRUE,\n        'description' => 'Primary key for crawl results',\n      ],\n      'user_id' => [\n        'type' => 'int',\n        'not null' => TRUE,\n        'description' => 'User ID who submitted the crawl',\n      ],\n      'url' => [\n        'type' => 'varchar',\n        'length' => 255,\n        'not null' => TRUE,\n        'description' => 'The URL that was crawled',\n      ],\n      'results' => [\n        'type' => 'text',\n        'mysql_type' => 'mediumtext',\n        'not null' => TRUE,\n        'description' => 'Crawl results',\n      ],\n      'created' => [\n        'type' => 'int',\n        'not null' => TRUE,\n        'description' => 'Timestamp when the crawl was requested',\n      ],\n      'completed' => [\n        'type' => 'int',\n        'not null' => FALSE,\n        'description' => 'Timestamp when the crawl was completed',\n      ],\n      'status' => [\n        'type' => 'varchar',\n        'length' => 20,\n        'not null' => TRUE,\n        'default' => 'pending',\n        'description' => 'Status of the crawl (pending/completed)',\n      ],\n      'checked_options' => [\n        'type' => 'text',\n        'mysql_type' => 'mediumtext',\n        'not null' => TRUE,\n        'description' => 'JSON-encoded array of SEO checks enabled during this crawl',\n      ],\n    ],\n    'primary key' => ['id'],\n  ]);\n\n  \\Drupal::logger('seo_audit')->info(\"Created 'seo_audit_crawl_result' table.\");\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction seo_audit_uninstall() {\n  \\Drupal::database()->schema()->dropTable('seo_audit_crawl_result');\n  \\Drupal::logger('seo_audit')->info(\"Removed 'seo_audit_crawl_result' table.\");\n}\n", "metadata": {"source": "repos/seo_audit/seo_audit.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SeoAudit", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: MCP Tools\ntype: module\ndescription: 'Batteries-included MCP tools for AI assistants working with Drupal sites.'\npackage: AI\ncore_version_requirement: ^10.3 || ^11\nphp: 8.3\nlifecycle: experimental\n\ndependencies:\n  - tool:tool\n  - drupal:dblog\n  - drupal:update\n\nconfigure: mcp_tools.settings\n", "metadata": {"source": "repos/mcp_tools/mcp_tools.info.yml", "type": "yaml_reference", "topic": "mcp tools.info"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ExternallyDefined\nSource file: <source_file>\nFile name hint: ExternallyDefined.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\PintoLayout\\External;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\pinto_layout\\Attribute\\Regions;\nuse Drupal\\pinto_layout\\Discovery\\FrozenLayoutDefinition;\nuse Drupal\\pinto_layout\\Discovery\\PintoLayoutDiscovery;\n\nfinal class ExternallyDefined {\n\n  /**\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   * @phpstan-param class-string<object> $component\n   */\n  private function __construct(\n    private string $id,\n    private TranslatableMarkup $label,\n    private readonly string $component,\n    private readonly Regions $regions,\n    private \\ReflectionMethod $factoryMethod,\n    public array $forms,\n  ) {\n  }\n\n  /**\n   * @phpstan-param Regions|list<string|\\Drupal\\pinto_layout\\Attribute\\Region> $regions\n   * @phpstan-param callable|callable-string $factoryMethod\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   * @phpstan-param class-string<object> $component\n   */\n  public static function create(\n    string $id,\n    TranslatableMarkup $label,\n    string $component,\n    Regions|array $regions,\n    callable|string $factoryMethod,\n    array $forms = [],\n  ): static {\n    /** @var array|string|\\Closure $factoryMethod */\n    // @phpstan-ignore-next-line varTag.nativeType\n    if ($factoryMethod instanceof \\Closure) {\n      throw new \\Exception('$factoryMethod must be statically callable.');\n    }\n\n    $rMethod = \\is_array($factoryMethod)\n      ? new \\ReflectionMethod($factoryMethod[0], $factoryMethod[1])\n      : \\ReflectionMethod::createFromMethodName($factoryMethod);\n\n    return new static(\n      id: $id,\n      label: $label,\n      component: $component,\n      regions: \\is_array($regions) ? new Regions(regions: $regions) : $regions,\n      factoryMethod: $rMethod,\n      forms: $forms,\n    );\n  }\n\n  /**\n   * @internal\n   */\n  public function freeze(): FrozenLayoutDefinition {\n    $args = PintoLayoutDiscovery::determineFactoryMethod(\n      $this->factoryMethod->getDeclaringClass(),\n      $this->factoryMethod,\n    );\n\n    return new FrozenLayoutDefinition(\n      $this->id,\n      $this->label,\n      $this->component,\n      $this->regions,\n      ...[\n        ...$args,\n        ...['forms' => $this->forms],\n      ],\n    );\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\PintoLayout\\External;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\pinto_layout\\Attribute\\Regions;\nuse Drupal\\pinto_layout\\Discovery\\FrozenLayoutDefinition;\nuse Drupal\\pinto_layout\\Discovery\\PintoLayoutDiscovery;\n\nfinal class ExternallyDefined {\n\n  /**\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   * @phpstan-param class-string<object> $component\n   */\n  private function __construct(\n    private string $id,\n    private TranslatableMarkup $label,\n    private readonly string $component,\n    private readonly Regions $regions,\n    private \\ReflectionMethod $factoryMethod,\n    public array $forms,\n  ) {\n  }\n\n  /**\n   * @phpstan-param Regions|list<string|\\Drupal\\pinto_layout\\Attribute\\Region> $regions\n   * @phpstan-param callable|callable-string $factoryMethod\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   * @phpstan-param class-string<object> $component\n   */\n  public static function create(\n    string $id,\n    TranslatableMarkup $label,\n    string $component,\n    Regions|array $regions,\n    callable|string $factoryMethod,\n    array $forms = [],\n  ): static {\n    /** @var array|string|\\Closure $factoryMethod */\n    // @phpstan-ignore-next-line varTag.nativeType\n    if ($factoryMethod instanceof \\Closure) {\n      throw new \\Exception('$factoryMethod must be statically callable.');\n    }\n\n    $rMethod = \\is_array($factoryMethod)\n      ? new \\ReflectionMethod($factoryMethod[0], $factoryMethod[1])\n      : \\ReflectionMethod::createFromMethodName($factoryMethod);\n\n    return new static(\n      id: $id,\n      label: $label,\n      component: $component,\n      regions: \\is_array($regions) ? new Regions(regions: $regions) : $regions,\n      factoryMethod: $rMethod,\n      forms: $forms,\n    );\n  }\n\n  /**\n   * @internal\n   */\n  public function freeze(): FrozenLayoutDefinition {\n    $args = PintoLayoutDiscovery::determineFactoryMethod(\n      $this->factoryMethod->getDeclaringClass(),\n      $this->factoryMethod,\n    );\n\n    return new FrozenLayoutDefinition(\n      $this->id,\n      $this->label,\n      $this->component,\n      $this->regions,\n      ...[\n        ...$args,\n        ...['forms' => $this->forms],\n      ],\n    );\n  }\n\n}\n", "metadata": {"source": "repos/pinto_layout/src/PintoLayout/External/ExternallyDefined.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExternallyDefined", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class ToolInputNormalizer in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\Core\\Logger\\LoggerChannelInterface;\n\n/**\n * Normalizes and validates tool inputs from LLM outputs.\n */\nclass ToolInputNormalizer {\n\n  public function __construct(\n    private readonly SchemaRegistry $schemaRegistry,\n    private readonly LoggerChannelInterface $logger,\n  ) {}\n\n  /**\n   * Normalize LLM-generated arguments to match tool schema.\n   *\n   * @param array $llmOutput\n   *   Raw output from LLM (may have wrong types, missing fields).\n   * @param object $tool\n   *   The tool object.\n   *\n   * @return array\n   *   Normalized and validated arguments.\n   *\n   * @throws \\InvalidArgumentException\n   *   When validation fails.\n   */\n  public function normalize(array $llmOutput, object $tool): array {\n    $schema = $this->schemaRegistry->getSchema($tool);\n    $normalized = [];\n    $errors = [];\n\n    if (!isset($schema['paths'])) {\n      $this->logger->warning('No schema found for tool, skipping normalization');\n      return $llmOutput;\n    }\n\n    $requestBody = $schema['paths'][array_key_first($schema['paths'])]['post']['requestBody'] ?? NULL;\n    $properties = $requestBody['content']['application/json']['schema']['properties'] ?? [];\n    $required = $requestBody['content']['application/json']['schema']['required'] ?? [];\n\n    // Check required fields.\n    foreach ($required as $field) {\n      if (!isset($llmOutput[$field])) {\n        $errors[] = \"Required field '{$field}' is missing\";\n      }\n    }\n\n    // Normalize each property.\n    foreach ($properties as $key => $property) {\n      $value = $llmOutput[$key] ?? $property['default'] ?? NULL;\n\n      if ($value === NULL && in_array($key, $required)) {\n        // Already handled in required check.\n        continue;\n      }\n\n      // Type coercion.\n      $normalized[$key] = $this->coerceType($value, $property['type'] ?? 'string');\n\n      // Validation.\n      $validationError = $this->validate($normalized[$key], $property);\n      if ($validationError) {\n        $errors[] = \"Field '{$key}': {$validationError}\";\n      }\n    }\n\n    if (!empty($errors)) {\n      throw new \\InvalidArgumentException('Validation failed: ' . implode('; ', $errors));\n    }\n\n    return $normalized;\n  }\n\n  /**\n   * Coerce value to expected type.\n   */\n  protected function coerceType(mixed $value, string $type): mixed {\n    if ($value === NULL) {\n      return NULL;\n    }\n\n    return match ($type) {\n      'integer', 'int' => (int) $value,\n      'number', 'float' => (float) $value,\n      'boolean', 'bool' => (bool) $value,\n      'array' => is_array($value) ? $value : [$value],\n      'object' => is_array($value) ? (object) $value : $value,\n      default => (string) $value,\n    };\n  }\n\n  /**\n   * Validate value against property schema.\n   */\n  protected function validate(mixed $value, array $property): ?string {\n    // Enum validation.\n    if (isset($property['enum']) && !in_array($value, $property['enum'], TRUE)) {\n      return 'Value not in allowed enum values: ' . implode(', ', $property['enum']);\n    }\n\n    // Type validation.\n    $expectedType = $property['type'] ?? 'string';\n    if (!$this->isType($value, $expectedType)) {\n      return \"Expected type '{$expectedType}', got '\" . gettype($value) . \"'\";\n    }\n\n    // String length validation.\n    if ($expectedType === 'string' && isset($property['maxLength'])) {\n      if (strlen((string) $value) > $property['maxLength']) {\n        return \"String exceeds maxLength of {$property['maxLength']}\";\n      }\n    }\n\n    // Number range validation.\n    if (in_array($expectedType, ['integer', 'number']) && isset($property['minimum'])) {\n      if ($value < $property['minimum']) {\n        return \"Value below minimum of {$property['minimum']}\";\n      }\n    }\n\n    if (in_array($expectedType, ['integer', 'number']) && isset($property['maximum'])) {\n      if ($value > $property['maximum']) {\n        return \"Value above maximum of {$property['maximum']}\";\n      }\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Check if value matches type.\n   */\n  protected function isType(mixed $value, string $type): bool {\n    return match ($type) {\n      'string' => is_string($value),\n      'integer', 'int' => is_int($value),\n      'number', 'float' => is_numeric($value),\n      'boolean', 'bool' => is_bool($value),\n      'array' => is_array($value),\n      'object' => is_object($value) || is_array($value),\n      default => TRUE,\n    };\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/ToolInputNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ToolInputNormalizer", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: MapperInterface\nSource file: <source_file>\nFile name hint: MapperInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Component\\Plugin\\Mapper;\n\n/**\n * Plugin mapper interface.\n *\n * Plugin mappers are responsible for mapping a plugin request to its\n * implementation. For example, it might map a cache bin to a memcache bin.\n *\n * Mapper objects incorporate the best practices of retrieving configurations,\n * type information, and factory instantiation.\n */\ninterface MapperInterface {\n\n  /**\n   * Gets or creates a plugin instance that satisfies the given options.\n   *\n   * @param array $options\n   *   An array of options that can be used to determine a suitable plugin to\n   *   instantiate and how to configure it.\n   *\n   * @return object|false\n   *   A fully configured plugin instance. The interface of the plugin instance\n   *   will depend on the plugin type. If no instance can be retrieved, FALSE\n   *   will be returned.\n   */\n  public function getInstance(array $options);\n\n}", "output": "<?php\n\nnamespace Drupal\\Component\\Plugin\\Mapper;\n\n/**\n * Plugin mapper interface.\n *\n * Plugin mappers are responsible for mapping a plugin request to its\n * implementation. For example, it might map a cache bin to a memcache bin.\n *\n * Mapper objects incorporate the best practices of retrieving configurations,\n * type information, and factory instantiation.\n */\ninterface MapperInterface {\n\n  /**\n   * Gets or creates a plugin instance that satisfies the given options.\n   *\n   * @param array $options\n   *   An array of options that can be used to determine a suitable plugin to\n   *   instantiate and how to configure it.\n   *\n   * @return object|false\n   *   A fully configured plugin instance. The interface of the plugin instance\n   *   will depend on the plugin type. If no instance can be retrieved, FALSE\n   *   will be returned.\n   */\n  public function getInstance(array $options);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Plugin/Mapper/MapperInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MapperInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LayoutBuilderFormAlter.php\nTarget symbol: class LayoutBuilderFormAlter\nNamespace: Drupal\\block_description_modifier\\Service\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LayoutBuilderFormAlter.\n- Include required imports:\n  - Drupal\\block_content\\BlockContentInterface\n  - Drupal\\block_description_modifier\\Repository\\InlineBlockConfigRepository\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - alter()\n  - forceHiddenByPath()\n  - forceHiddenTextElement()\n  - resolveInlineBlockBundle()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\block_description_modifier\\Service;\n\nuse Drupal\\block_content\\BlockContentInterface;\nuse Drupal\\block_description_modifier\\Repository\\InlineBlockConfigRepository;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Layout Builder form alter: hide and force labels for configured inline blocks.\n *\n * For selected inline block bundles we:\n * - hide \"Block description (info)\" in inline block entity subform\n * - hide block placement admin label and user-facing title\n * - force \"Display title\" off\n * - ensure the computed label is stored before core submit.\n */\nfinal class LayoutBuilderFormAlter {\n\n  public function __construct(\n    private readonly InlineBlockConfigRepository $repository,\n    private readonly InlineBlockLabelApplier $labelApplier,\n  ) {}\n\n  public function alter(array &$form, FormStateInterface $form_state): void {\n    $bundle = $this->resolveInlineBlockBundle($form, $form_state);\n    if ($bundle === NULL) {\n      return;\n    }\n\n    $bundleConfig = $this->repository->getInline($bundle);\n    if (!$bundleConfig || empty($bundleConfig['hide_label'])) {\n      return;\n    }\n\n    $placeholder = $this->labelApplier->placeholderLabelForBundle($bundle);\n    if ($placeholder === '') {\n      $placeholder = InlineBlockLabelApplier::FALLBACK_CORRUPTED_FIELD;\n    }\n\n    // A) Hide \"Block description\" / administrative label of the block placement\n    // (Layout Builder stores this in settings[admin_label]).\n    if (isset($form['settings']['admin_label']) && is_array($form['settings']['admin_label'])) {\n      $this->forceHiddenTextElement($form['settings']['admin_label'], $form_state, [\n        'settings',\n        'admin_label',\n      ], $placeholder);\n    }\n\n    // B) Hide inline block entity admin label (block_content.info) inside block_form.\n    // Different variants can place it differently.\n    $this->forceHiddenByPath($form, $form_state, ['settings', 'block_form', 'info'], $placeholder);\n    $this->forceHiddenByPath($form, $form_state, ['block_form', 'info'], $placeholder);\n\n    // C) Hide the user-visible title (\"Title (shown to the user)\") and force it to placeholder.\n    foreach (['label', 'title'] as $key) {\n      if (isset($form['settings'][$key]) && is_array($form['settings'][$key])) {\n        $this->forceHiddenTextElement($form['settings'][$key], $form_state, [\n          'settings',\n          $key,\n        ], $placeholder);\n      }\n    }\n\n    // D) Hide \"Display title\" toggle and force it off.\n    foreach (['label_display', 'display_title', 'title_display'] as $key) {\n      if (isset($form['settings'][$key]) && is_array($form['settings'][$key])) {\n        $form['settings'][$key]['#type'] = 'hidden';\n        $form['settings'][$key]['#value'] = 0;\n        $form['settings'][$key]['#default_value'] = 0;\n        // Hide from UI. It is safe here because we also set the value.\n        $form['settings'][$key]['#access'] = FALSE;\n        $form_state->setValue(['settings', $key], 0);\n      }\n    }\n\n    // Ensure LB stores the computed label (especially for provider=field) BEFORE core submit.\n    $form['#validate'] ??= [];\n    $form['#validate'][] = 'block_description_modifier_layout_builder_inline_block_validate';\n  }\n\n  /**\n   * Determines the inline block bundle for both \"add\" and \"update/edit\" forms.\n   */\n  private function resolveInlineBlockBundle(array &$form, FormStateInterface $form_state): ?string {\n    // 1) Prefer embedded inline block entity/block stored by Layout Builder.\n    $block = $form['settings']['block_form']['#block'] ?? NULL;\n    if ($block && method_exists($block, 'bundle')) {\n      return (string) $block->bundle();\n    }\n\n    // 2) Embedded entity on some variants.\n    $entity = $form['settings']['block_form']['#entity'] ?? NULL;\n    if ($entity instanceof BlockContentInterface) {\n      return $entity->bundle();\n    }\n\n    // 3) Add form usually has route parameter plugin_id = inline_block:{bundle}.\n    $routeMatch = \\Drupal::routeMatch();\n    $pluginId = (string) ($routeMatch->getParameter('plugin_id') ?? '');\n    if ($pluginId !== '' && str_starts_with($pluginId, 'inline_block:')) {\n      $bundle = substr($pluginId, strlen('inline_block:'));\n      return $bundle !== '' ? $bundle : NULL;\n    }\n\n    // 4) Sometimes stored in form state.\n    $pluginId = (string) ($form_state->get('plugin_id') ?? '');\n    if ($pluginId !== '' && str_starts_with($pluginId, 'inline_block:')) {\n      $bundle = substr($pluginId, strlen('inline_block:'));\n      return $bundle !== '' ? $bundle : NULL;\n    }\n\n    return NULL;\n  }\n\n  /**\n   * Forces a nested element to hidden and sets submitted value.\n   *\n   * @param list<string> $path\n   */\n  private function forceHiddenByPath(array &$form, FormStateInterface $form_state, array $path, string $value): void {\n    $cursor = &$form;\n    foreach ($path as $segment) {\n      if (!is_array($cursor) || !array_key_exists($segment, $cursor)) {\n        return;\n      }\n      $cursor = &$cursor[$segment];\n    }\n    if (!is_array($cursor)) {\n      return;\n    }\n\n    $this->forceHiddenTextElement($cursor, $form_state, $path, $value);\n  }\n\n  /**\n   * Forces a text element to hidden while preserving a valid submitted value.\n   *\n   * @param array<string, mixed> $element\n   * @param list<string> $path\n   */\n  private function forceHiddenTextElement(array &$element, FormStateInterface $form_state, array $path, string $value): void {\n    $element['#required'] = FALSE;\n    $element['#attributes']['required'] = FALSE;\n    $element['#type'] = 'hidden';\n    $element['#value'] = $value;\n    $element['#default_value'] = $value;\n    unset($element['#title'], $element['#description']);\n    $form_state->setValue($path, $value);\n  }\n\n}\n", "metadata": {"source": "repos/block_description_modifier/src/Service/LayoutBuilderFormAlter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutBuilderFormAlter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class PathProcessorFront in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\PathProcessor;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n\n/**\n * Processes the inbound path by resolving it to the front page if empty.\n */\nclass PathProcessorFront implements InboundPathProcessorInterface {\n\n  /**\n   * A config factory for retrieving required config settings.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $config;\n\n  /**\n   * Constructs a PathProcessorFront object.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config\n   *   A config factory for retrieving the site front page configuration.\n   */\n  public function __construct(ConfigFactoryInterface $config) {\n    $this->config = $config;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processInbound($path, Request $request) {\n    if ($path === '/') {\n      $path = $this->config->get('system.site')->get('page.front');\n      if (empty($path)) {\n        // We have to return a valid path but / does not have a route and config\n        // might be broken so stop execution.\n        throw new NotFoundHttpException();\n      }\n      $components = parse_url($path);\n      // Remove query string and fragment.\n      $path = $components['path'];\n      // Merge query parameters from front page configuration value\n      // with URL query, so that actual URL takes precedence.\n      if (!empty($components['query'])) {\n        parse_str($components['query'], $parameters);\n        $parameters = array_replace($parameters, $request->query->all());\n        $request->query->replace($parameters);\n      }\n    }\n    return $path;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/PathProcessor/PathProcessorFront.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathProcessorFront", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EquivalentUpdate in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Update;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Value object to hold information about an equivalent update.\n *\n * @see module.api.php\n */\nfinal class EquivalentUpdate {\n\n  /**\n   * Constructs a EquivalentUpdate object.\n   *\n   * @param string $module\n   *   The module the update is for.\n   * @param int $future_update\n   *   The equivalent future update.\n   * @param int $ran_update\n   *   The update that already ran and registered the equivalent update.\n   * @param string $future_version\n   *   The future version that has the expected update.\n   */\n  public function __construct(\n    public readonly string $module,\n    public readonly int $future_update,\n    public readonly int $ran_update,\n    public readonly string $future_version,\n  ) {\n  }\n\n  /**\n   * Creates a message to explain why an update has been skipped.\n   *\n   * @return \\Drupal\\Core\\StringTranslation\\TranslatableMarkup\n   *   An message explaining why an update has been skipped.\n   */\n  public function toSkipMessage(): TranslatableMarkup {\n    return new TranslatableMarkup(\n      'Update @number for the @module module has been skipped because the equivalent change was already made in update @ran_update.',\n      ['@number' => $this->future_update, '@module' => $this->module, '@ran_update' => $this->ran_update]\n    );\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Update/EquivalentUpdate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EquivalentUpdate", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EckEntityLabel in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eck\\Plugin\\views\\field;\n\nuse Drupal\\Core\\Entity\\EntityMalformedException;\nuse Drupal\\Core\\Entity\\Exception\\UndefinedLinkTemplateException;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Plugin\\views\\field\\FieldPluginBase;\nuse Drupal\\views\\ResultRow;\n\n/**\n * Field handler to return the ECK entity's label.\n *\n * @ingroup views_field_handlers\n *\n * @ViewsField(\"eck_entity_label\")\n */\nclass EckEntityLabel extends FieldPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['link_to_entity'] = ['default' => FALSE];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    $form['link_to_entity'] = [\n      '#title' => $this->t('Link to entity'),\n      '#description' => $this->t('Make entity label a link to entity page.'),\n      '#type' => 'checkbox',\n      '#default_value' => !empty($this->options['link_to_entity']),\n    ];\n    parent::buildOptionsForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(ResultRow $values) {\n    /** @var \\Drupal\\Core\\Entity\\EntityInterface $entity */\n    $entity = $values->_entity;\n\n    if (!empty($this->options['link_to_entity'])) {\n      try {\n        $this->options['alter']['url'] = $entity->toUrl();\n        $this->options['alter']['make_link'] = TRUE;\n      }\n      catch (UndefinedLinkTemplateException $e) {\n        $this->options['alter']['make_link'] = FALSE;\n      }\n      catch (EntityMalformedException $e) {\n        $this->options['alter']['make_link'] = FALSE;\n      }\n    }\n\n    return $entity->label();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Leave empty to avoid a query on this field.\n  }\n\n}\n", "metadata": {"source": "repos/eck/src/Plugin/views/field/EckEntityLabel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EckEntityLabel", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: EntityStorageSchemaInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\Core\\Entity\\Schema\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityTypeInterface\n  - Drupal\\Core\\Entity\\EntityTypeListenerInterface\n- Ensure these methods exist where relevant:\n  - requiresEntityDataMigration()\n  - requiresEntityStorageSchemaChanges()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Entity\\Schema;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeListenerInterface;\n\n/**\n * Defines the interface for entity storage schema handler classes.\n *\n * An entity type's storage schema handler is responsible for creating the\n * storage backend's schema that the entity type's storage handler needs for\n * storing its entities. For example, if the storage handler is for a SQL\n * backend, then the storage schema handler is responsible for creating the\n * needed tables. During the application lifetime, an entity type's definition\n * can change in a way that requires changes to the storage schema, so this\n * interface defines methods for that as well.\n *\n * @see \\Drupal\\Core\\Entity\\EntityStorageInterface\n */\ninterface EntityStorageSchemaInterface extends EntityTypeListenerInterface {\n\n  /**\n   * Checks if the changes to the entity type requires storage schema changes.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The updated entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The original entity type definition.\n   *\n   * @return bool\n   *   TRUE if storage schema changes are required, FALSE otherwise.\n   */\n  public function requiresEntityStorageSchemaChanges(EntityTypeInterface $entity_type, EntityTypeInterface $original);\n\n  /**\n   * Checks if existing data would be lost if the schema changes were applied.\n   *\n   * If there are no schema changes needed, then no data needs to be migrated,\n   * but it is not the responsibility of this function to recheck what\n   * requiresEntityStorageSchemaChanges() checks. Rather, the meaning of what\n   * this function returns when requiresEntityStorageSchemaChanges() returns\n   * FALSE is undefined. Callers are expected to only call this function when\n   * requiresEntityStorageSchemaChanges() is TRUE.\n   *\n   * This function can return FALSE if any of these conditions apply:\n   * - There are no existing entities for the entity type.\n   * - There are existing entities, but the schema changes can be applied\n   *   without losing their data (e.g., if the schema changes can be performed\n   *   by altering tables rather than dropping and recreating them).\n   * - The only entity data that would be lost are ones that are not valid for\n   *   the new definition (e.g., if changing an entity type from revisionable\n   *   to non-revisionable, then it's okay to drop data for the non-default\n   *   revision).\n   *\n   * When this function returns FALSE, site administrators will be unable to\n   * perform an automated update, and will instead need to perform a site\n   * migration or invoke some custom update process.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The updated entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The original entity type definition.\n   *\n   * @return bool\n   *   TRUE if data migration is required, FALSE otherwise.\n   *\n   * @see self::requiresEntityStorageSchemaChanges()\n   */\n  public function requiresEntityDataMigration(EntityTypeInterface $entity_type, EntityTypeInterface $original);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Schema/EntityStorageSchemaInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityStorageSchemaInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class DecorativeConfigFormAlter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\decorative_images\\Hook;\n\nuse Drupal\\field\\Entity\\FieldConfig;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Manage image field configuration.\n */\nclass DecorativeConfigFormAlter {\n\n  /**\n   * Alters the image field configuration form.\n   */\n  public static function alterForm(array &$form, FormStateInterface $form_state, string $form_id): void {\n    if ($form_id !== 'field_config_edit_form') {\n      return;\n    }\n\n    $field_config = $form_state->getFormObject()?->getEntity();\n    if (!$field_config instanceof FieldConfig || $field_config->getType() !== 'image') {\n      return;\n    }\n\n    // Add custom fields.\n    $form['settings']['decorative_enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Enable the <em>Decorative</em> field'),\n      '#description' => t('The image may have a decorative, presentation-only role.'),\n      '#default_value' => $field_config->getThirdPartySetting('decorative_images', 'decorative_enabled', 0),\n      '#weight' => $form['settings']['alt_field_required']['#weight'] + 1,\n    ];\n    $form['settings']['decorative_or_alternative_required'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Require <em>Alt</em> or <em>Decorative</em>'),\n      '#description' => t('If enabled, either alternative text or the decorative option is required. For use, <em>Decorative</em> must be enabled and <em>Alt</em> cannot be required.'),\n      '#default_value' => $field_config->getThirdPartySetting('decorative_images', 'decorative_or_alternative_required', 0),\n      '#weight' => $form['settings']['alt_field_required']['#weight'] + 2,\n    ];\n\n    // Attach entity builder.\n    $form['#entity_builders'][] = [self::class, 'saveEntitySettings'];\n  }\n\n  /**\n   * Saves third-party settings on the field entity.\n   */\n  public static function saveEntitySettings($entity_type, FieldConfig $entity, array &$form, FormStateInterface $form_state): void {\n    if ($entity->getType() === 'image') {\n      $entity->setThirdPartySetting(\n        'decorative_images',\n        'decorative_enabled',\n        $form_state->getValue(['settings', 'decorative_enabled']) ?? 0\n      );\n      $entity->setThirdPartySetting(\n        'decorative_images',\n        'decorative_or_alternative_required',\n        $form_state->getValue(['settings', 'decorative_or_alternative_required']) ?? 0\n      );\n    }\n  }\n\n}\n", "metadata": {"source": "repos/decorative_images/src/Hook/DecorativeConfigFormAlter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DecorativeConfigFormAlter", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: CompilerPluginBase.php\nTarget symbol: class CompilerPluginBase\nNamespace: Drupal\\compiler\\Plugin\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CompilerPluginBase.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\PluginBase", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\compiler\\Plugin;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\n\n/**\n * The base implementation for a compiler plugin.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n */\nabstract class CompilerPluginBase extends PluginBase implements CompilerPluginInterface {\n\n}\n", "metadata": {"source": "repos/compiler/src/Plugin/CompilerPluginBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CompilerPluginBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class DisplayVariant in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Display\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\Plugin;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines a display variant attribute object.\n *\n * Display variants are used to dictate the output of a given Display, which\n * can be used to control the output of many parts of Drupal.\n *\n * Variants are usually chosen by some selection criteria, and are instantiated\n * directly. Each variant must define its own approach to rendering, and can\n * either load its own data or be injected with data from another Display\n * object.\n *\n * Plugin namespace: Plugin\\DisplayVariant\n *\n * For working examples, see\n * - \\Drupal\\Core\\Render\\Plugin\\DisplayVariant\\SimplePageVariant\n * - \\Drupal\\block\\Plugin\\DisplayVariant\\BlockPageVariant\n *\n * @see \\Drupal\\Core\\Display\\VariantInterface\n * @see \\Drupal\\Core\\Display\\VariantBase\n * @see \\Drupal\\Core\\Display\\VariantManager\n * @see \\Drupal\\Core\\Display\\PageVariantInterface\n * @see plugin_api\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass DisplayVariant extends Plugin {\n\n  /**\n   * Constructs a DisplayVariant plugin attribute object.\n   *\n   * @param string $id\n   *   The plugin ID.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslatableMarkup $admin_label\n   *   The administrative label.\n   * @param class-string|null $deriver\n   *   (optional) The deriver class.\n   */\n  public function __construct(\n    public readonly string $id,\n    public readonly TranslatableMarkup $admin_label,\n    public readonly ?string $deriver = NULL,\n  ) {}\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Display/Attribute/DisplayVariant.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DisplayVariant", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nid: banner_block\nlabel: 'Banner block'\nrevision: false\ndescription: 'A banner block contains a title, summary, link to content and a background image. The background image is scaled to fill the browser''s width.'\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/block_content.type.banner_block.yml", "type": "yaml_reference", "topic": "block content.type.banner block"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set heading_level = heading_level|default(5) %}\n\n<div{{ attributes.addClass('card-body') }}>\n  {% if title %}\n    {% set title_attributes = create_attribute(title_attributes|default({})) %}\n    <h{{ heading_level }}{{ title_attributes.addClass('card-title') }}>{{ title }}</h{{ heading_level }}>\n  {% endif %}\n  {% if subtitle %}\n    {% set subtitle_attributes = create_attribute(subtitle_attributes|default({})) %}\n    <h{{ heading_level + 1 }}{{ subtitle_attributes.addClass('card-subtitle') }}>{{ subtitle }}</h{{ heading_level + 1 }}>\n  {% endif %}\n  {% if text %}\n    {% set text_attributes = create_attribute(text_attributes|default({})) %}\n    <p{{ text_attributes.addClass('card-text') }}>{{ text }}</p>\n  {% endif %}\n  {{ content }}\n  {% if links %}\n    {% if links is iterable %}\n      {{ links|add_class('card-link') }}\n    {% else %}\n      {{ {'#markup': links}|add_class('card-link') }}\n    {% endif %}\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/bootstrap_components/components/card_body/card_body.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class IconExtractorBase in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Theme\\Icon;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Plugin\\PluginWithFormsInterface;\nuse Drupal\\Core\\Plugin\\PluginWithFormsTrait;\nuse Drupal\\Core\\Theme\\Icon\\Exception\\IconPackConfigErrorException;\n\n/**\n * Base class for icon extractor plugins.\n *\n * @internal\n *   This API is experimental.\n */\nabstract class IconExtractorBase extends PluginBase implements IconExtractorInterface, PluginWithFormsInterface {\n\n  use PluginWithFormsTrait;\n\n  // Remove internal values and allow extractor to add any needed values.\n  private const DEFINITION_REMOVE = [\n    'enabled',\n    'template',\n    'description',\n    'links',\n    'config',\n  ];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function label(): string {\n    return (string) $this->pluginDefinition['label'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function description(): string {\n    return (string) $this->pluginDefinition['description'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    if (!isset($this->configuration['settings'])) {\n      return $form;\n    }\n\n    return IconExtractorSettingsForm::generateSettingsForm($this->configuration['settings'], $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateConfigurationForm(array &$form, FormStateInterface $form_state): void {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state): void {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadIcon(array $icon_data): ?IconDefinitionInterface {\n    if (!isset($icon_data['icon_id']) || empty($icon_data['icon_id'])) {\n      return NULL;\n    }\n\n    return $this->createIcon(\n      $icon_data['icon_id'],\n      $icon_data['source'] ?? '',\n      $icon_data['group'] ?? NULL,\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createIcon(string $icon_id, ?string $source = NULL, ?string $group = NULL, ?array $data = NULL): IconDefinitionInterface {\n    if (!isset($this->configuration['template'])) {\n      throw new IconPackConfigErrorException(sprintf('Missing `template` in your definition, extractor %s requires this value.', $this->getPluginId()));\n    }\n\n    // Clean unused pack definition values as they will be passed to the context\n    // of the Twig.\n    $data_definition = array_diff_key($this->configuration, array_flip(self::DEFINITION_REMOVE));\n\n    return IconDefinition::create(\n      $this->configuration['id'],\n      $icon_id,\n      $this->configuration['template'],\n      $source,\n      $group,\n      $data ? array_merge($data, $data_definition) : $data_definition,\n    );\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/Icon/IconExtractorBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "IconExtractorBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: MigrateField\nSource file: <source_file>\nFile name hint: MigrateField.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\migrate_drupal\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a field plugin annotation object.\n *\n * Field plugins are responsible for handling the migration of custom fields\n * (provided by Field API in Drupal 7) to Drupal 8. They are allowed to alter\n * fieldable entity migrations when these migrations are being generated, and\n * can compute destination field types for individual fields during the actual\n * migration process.\n *\n * Plugin Namespace: Plugin\\migrate\\field\n *\n * @Annotation\n */\nclass MigrateField extends Plugin {\n\n  /**\n   * {@inheritdoc}\n   */\n  function __construct($values) {\n    parent::__construct($values);\n    // Provide default value for core property, in case it's missing.\n    if (empty($this->definition['core'])) {\n      $this->definition['core'] = [6];\n    }\n  }\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * Map of D6 and D7 field types to D8 field type plugin IDs.\n   *\n   * @var string[]\n   */\n  public $type_map = [];\n\n  /**\n   * The Drupal core version(s) this plugin applies to.\n   *\n   * @var int[]\n   */\n  public $core;\n\n  /**\n   * Identifies the system providing the data the field plugin will read.\n   *\n   * The source_module is expected to be the name of a Drupal module that must\n   * be installed in the source database.\n   *\n   * @var string\n   */\n  public $source_module;\n\n  /**\n   * Identifies the system handling the data the destination plugin will write.\n   *\n   * The destination_module is expected to be the name of a Drupal module on the\n   * destination site that must be installed.\n   *\n   * @var string\n   */\n  public $destination_module;\n\n  /**\n   * The weight of this plugin relative to other plugins.\n   *\n   * The weight of this plugin relative to other plugins servicing the same\n   * field type and core version.  The lowest weighted applicable plugin will be\n   * used for each field.\n   *\n   * @var int\n   */\n  public $weight = 0;\n\n}", "output": "<?php\n\nnamespace Drupal\\migrate_drupal\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a field plugin annotation object.\n *\n * Field plugins are responsible for handling the migration of custom fields\n * (provided by Field API in Drupal 7) to Drupal 8. They are allowed to alter\n * fieldable entity migrations when these migrations are being generated, and\n * can compute destination field types for individual fields during the actual\n * migration process.\n *\n * Plugin Namespace: Plugin\\migrate\\field\n *\n * @Annotation\n */\nclass MigrateField extends Plugin {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct($values) {\n    parent::__construct($values);\n    // Provide default value for core property, in case it's missing.\n    if (empty($this->definition['core'])) {\n      $this->definition['core'] = [6];\n    }\n  }\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * Map of D6 and D7 field types to D8 field type plugin IDs.\n   *\n   * @var string[]\n   */\n  public $type_map = [];\n\n  /**\n   * The Drupal core version(s) this plugin applies to.\n   *\n   * @var int[]\n   */\n  public $core;\n\n  /**\n   * Identifies the system providing the data the field plugin will read.\n   *\n   * The source_module is expected to be the name of a Drupal module that must\n   * be installed in the source database.\n   *\n   * @var string\n   */\n  public $source_module;\n\n  /**\n   * Identifies the system handling the data the destination plugin will write.\n   *\n   * The destination_module is expected to be the name of a Drupal module on the\n   * destination site that must be installed.\n   *\n   * @var string\n   */\n  public $destination_module;\n\n  /**\n   * The weight of this plugin relative to other plugins.\n   *\n   * The weight of this plugin relative to other plugins servicing the same\n   * field type and core version.  The lowest weighted applicable plugin will be\n   * used for each field.\n   *\n   * @var int\n   */\n  public $weight = 0;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate_drupal/src/Annotation/MigrateField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MigrateField", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nid: image\nlabel: Image\ndescription: \"A locally hosted image file.\"\nsource: image\nqueue_thumbnail_downloads: false\nnew_revision: true\nsource_configuration:\n  source_field: field_media_image\nfield_map: {  }\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/media.type.image.yml", "type": "yaml_reference", "topic": "media.type.image"}}
{"instruction": "Show me the implementation of the class PlaceBlock in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_blocks\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_blocks\\Service\\BlockService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_place_block',\n  label: new TranslatableMarkup('Place Block'),\n  description: new TranslatableMarkup('Place a block in a theme region.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'plugin_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block Plugin ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'region' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme Region'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'theme' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Custom Block ID'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block Label'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'label_display' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label Display (visible/hidden)'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'weight' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Weight'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'visibility' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Visibility Conditions'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'settings' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Block Settings'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'block_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'plugin_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Plugin ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'region' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Region'),\n      description: new TranslatableMarkup(''),\n    ),\n    'theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass PlaceBlock extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'blocks';\n\n\n  protected BlockService $blockService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->blockService = $container->get('mcp_tools_blocks.block');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $pluginId = $input['plugin_id'] ?? '';\n    $region = $input['region'] ?? '';\n\n    if (empty($pluginId) || empty($region)) {\n      return ['success' => FALSE, 'error' => 'Both plugin_id and region are required.'];\n    }\n\n    $options = [];\n\n    if (isset($input['theme'])) {\n      $options['theme'] = $input['theme'];\n    }\n\n    if (isset($input['id'])) {\n      $options['id'] = $input['id'];\n    }\n\n    if (isset($input['label'])) {\n      $options['label'] = $input['label'];\n    }\n\n    if (isset($input['label_display'])) {\n      $options['label_display'] = $input['label_display'];\n    }\n\n    if (isset($input['weight'])) {\n      $options['weight'] = (int) $input['weight'];\n    }\n\n    if (isset($input['visibility'])) {\n      $options['visibility'] = $input['visibility'];\n    }\n\n    if (isset($input['settings'])) {\n      $options['settings'] = $input['settings'];\n    }\n\n    return $this->blockService->placeBlock($pluginId, $region, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_blocks/src/Plugin/tool/Tool/PlaceBlock.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PlaceBlock", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: WorkspaceOperationInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\workspaces\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Ensure these methods exist where relevant:\n  - checkConflictsOnTarget()\n  - getDifferringRevisionIdsOnSource()\n  - getDifferringRevisionIdsOnTarget()\n  - getNumberOfChangesOnSource()\n  - getNumberOfChangesOnTarget()\n  - getSourceLabel()\n  - getTargetLabel()", "output": "<?php\n\nnamespace Drupal\\workspaces;\n\n// cspell:ignore differring\n\n/**\n * Defines an interface for workspace operations.\n *\n * Example operations are publishing, merging and syncing with a remote\n * workspace.\n *\n * @internal\n */\ninterface WorkspaceOperationInterface {\n\n  /**\n   * Returns the human-readable label of the source.\n   *\n   * @return string\n   *   The source label.\n   */\n  public function getSourceLabel();\n\n  /**\n   * Returns the human-readable label of the target.\n   *\n   * @return string\n   *   The target label.\n   */\n  public function getTargetLabel();\n\n  /**\n   * Checks if there are any conflicts between the source and the target.\n   *\n   * @return array\n   *   Returns an array consisting of the number of conflicts between the source\n   *   and the target, keyed by the conflict type constant.\n   */\n  public function checkConflictsOnTarget();\n\n  /**\n   * Gets the revision identifiers for items which have changed on the target.\n   *\n   * @return array\n   *   A multidimensional array of revision identifiers, keyed by entity type\n   *   IDs.\n   */\n  public function getDifferringRevisionIdsOnTarget();\n\n  /**\n   * Gets the revision identifiers for items which have changed on the source.\n   *\n   * @return array\n   *   A multidimensional array of revision identifiers, keyed by entity type\n   *   IDs.\n   */\n  public function getDifferringRevisionIdsOnSource();\n\n  /**\n   * Gets the total number of items which have changed on the target.\n   *\n   * This returns the aggregated changes count across all entity types.\n   * For example, if two nodes and one taxonomy term have changed on the target,\n   * the return value is 3.\n   *\n   * @return int\n   *   The number of different revisions.\n   */\n  public function getNumberOfChangesOnTarget();\n\n  /**\n   * Gets the total number of items which have changed on the source.\n   *\n   * This returns the aggregated changes count across all entity types.\n   * For example, if two nodes and one taxonomy term have changed on the source,\n   * the return value is 3.\n   *\n   * @return int\n   *   The number of different revisions.\n   */\n  public function getNumberOfChangesOnSource();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces/src/WorkspaceOperationInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "WorkspaceOperationInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Decorator\nSource file: <source_file>\nFile name hint: Decorator.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\webprofiler;\n\n/**\n * Generic class Decorator.\n */\nclass Decorator {\n\n  /**\n   * The original object to decorate.\n   *\n   * @var object\n   */\n  protected object $object;\n\n  /**\n   * Class constructor.\n   *\n   * @param object $object\n   *   The original object to decorate.\n   */\n  public function __construct(object $object) {\n    $this->object = $object;\n  }\n\n  /**\n   * Return the original (i.e. non-decorated) object.\n   *\n   * @return object\n   *   The original object.\n   */\n  public function getOriginalObject(): object {\n    $object = $this->object;\n    while ($object instanceof Decorator) {\n      $object = $object->getOriginalObject();\n    }\n\n    return $object;\n  }\n\n  /**\n   * Return the object if $method is a PHP callable, FALSE otherwise.\n   *\n   * @param string $method\n   *   The method's name.\n   * @param bool $checkSelf\n   *   TRUE to check this decorator, FALSE to check the original object.\n   *\n   * @return bool|object\n   *   The object if $method is a PHP callable, FALSE otherwise.\n   */\n  public function isCallable(string $method, bool $checkSelf = FALSE): bool|object {\n    // Check the original object.\n    $object = $this->getOriginalObject();\n    if (\\is_callable([$object, $method])) {\n      return $object;\n    }\n\n    // Check Decorators.\n    $object = $checkSelf ? $this : $this->object;\n    while ($object instanceof Decorator) {\n      if (\\is_callable([$object, $method])) {\n        return $object;\n      }\n\n      $object = $this->object;\n    }\n\n    return FALSE;\n  }\n\n  /**\n   * Call a method on the original object, with specific arguments.\n   *\n   * @param string $method\n   *   The method to call.\n   * @param array $args\n   *   The args to pass to the method.\n   *\n   * @return mixed\n   *   The return of the method invocation on the original object.\n   *\n   * @throws \\Exception\n   */\n  public function __call(string $method, array $args): mixed {\n    if ($object = $this->isCallable($method)) {\n      return \\call_user_func_array([$object, $method], $args);\n    }\n\n    throw new \\Exception(\n      'Undefined method - ' . \\get_class($this->getOriginalObject()) . '::' . $method,\n    );\n  }\n\n  /**\n   * Return the value of a property from the original object.\n   *\n   * @param string $property\n   *   The property name.\n   *\n   * @return mixed|null\n   *   The value of a property from the original object or NULL if the property\n   *   doesn't exist on the original object.\n   */\n  public function __get(string $property): mixed {\n    $object = $this->getOriginalObject();\n    if (\\property_exists($object, $property)) {\n      // @phpstan-ignore-next-line\n      return $object->$property;\n    }\n\n    return NULL;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler;\n\n/**\n * Generic class Decorator.\n */\nclass Decorator {\n\n  /**\n   * The original object to decorate.\n   *\n   * @var object\n   */\n  protected object $object;\n\n  /**\n   * Class constructor.\n   *\n   * @param object $object\n   *   The original object to decorate.\n   */\n  public function __construct(object $object) {\n    $this->object = $object;\n  }\n\n  /**\n   * Return the original (i.e. non-decorated) object.\n   *\n   * @return object\n   *   The original object.\n   */\n  public function getOriginalObject(): object {\n    $object = $this->object;\n    while ($object instanceof Decorator) {\n      $object = $object->getOriginalObject();\n    }\n\n    return $object;\n  }\n\n  /**\n   * Return the object if $method is a PHP callable, FALSE otherwise.\n   *\n   * @param string $method\n   *   The method's name.\n   * @param bool $checkSelf\n   *   TRUE to check this decorator, FALSE to check the original object.\n   *\n   * @return bool|object\n   *   The object if $method is a PHP callable, FALSE otherwise.\n   */\n  public function isCallable(string $method, bool $checkSelf = FALSE): bool|object {\n    // Check the original object.\n    $object = $this->getOriginalObject();\n    if (\\is_callable([$object, $method])) {\n      return $object;\n    }\n\n    // Check Decorators.\n    $object = $checkSelf ? $this : $this->object;\n    while ($object instanceof Decorator) {\n      if (\\is_callable([$object, $method])) {\n        return $object;\n      }\n\n      $object = $this->object;\n    }\n\n    return FALSE;\n  }\n\n  /**\n   * Call a method on the original object, with specific arguments.\n   *\n   * @param string $method\n   *   The method to call.\n   * @param array $args\n   *   The args to pass to the method.\n   *\n   * @return mixed\n   *   The return of the method invocation on the original object.\n   *\n   * @throws \\Exception\n   */\n  public function __call(string $method, array $args): mixed {\n    if ($object = $this->isCallable($method)) {\n      return \\call_user_func_array([$object, $method], $args);\n    }\n\n    throw new \\Exception(\n      'Undefined method - ' . \\get_class($this->getOriginalObject()) . '::' . $method,\n    );\n  }\n\n  /**\n   * Return the value of a property from the original object.\n   *\n   * @param string $property\n   *   The property name.\n   *\n   * @return mixed|null\n   *   The value of a property from the original object or NULL if the property\n   *   doesn't exist on the original object.\n   */\n  public function __get(string $property): mixed {\n    $object = $this->getOriginalObject();\n    if (\\property_exists($object, $property)) {\n      // @phpstan-ignore-next-line\n      return $object->$property;\n    }\n\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Decorator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Decorator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DateFilterHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views_pretty_paths\\FilterHandlers;\n\n/**\n * Defines DateFilterHandler class.\n */\nclass DateFilterHandler extends AbstractFilterHandler implements ViewsPrettyPathFilterHandlerInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTargetedFilterPluginIds() {\n    return [\n      'date',\n      'datetime',\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformPathValueForViewsQuery($filter_value_string, $filter_data) {\n    $return_values = [];\n    if (!empty($filter_value_string)) {\n      $raw_values = explode('+', $filter_value_string);\n      $return_values['min'] = str_replace('-', '/', strtolower($raw_values[0]));\n      $return_values['max'] = str_replace('-', '/', strtolower($raw_values[1]));\n    }\n    return $return_values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transformSubmittedValueForUrl($value) {\n    $min = str_replace('/', '-', strtolower($value['min']));\n    $max = str_replace('/', '-', strtolower($value['max']));\n    return empty($min . $max) ? '' : $min . '+' . $max;\n  }\n\n}\n", "metadata": {"source": "repos/views_pretty_paths/src/FilterHandlers/DateFilterHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateFilterHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Batch in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Queue;\n\n/**\n * Defines a batch queue handler used by the Batch API.\n *\n * This implementation:\n * - Ensures FIFO ordering.\n * - Allows an item to be repeatedly claimed until it is actually deleted (no\n *   notion of lease time or 'expire' date), to allow multipass operations.\n *\n * Stale items from failed batches are cleaned from the {queue} table on cron\n * using the 'created' date.\n *\n * @ingroup queue\n */\nclass Batch extends DatabaseQueue {\n\n  /**\n   * Overrides \\Drupal\\Core\\Queue\\DatabaseQueue::claimItem().\n   *\n   * Unlike \\Drupal\\Core\\Queue\\DatabaseQueue::claimItem(), this method provides\n   * a default lease time of 0 (no expiration) instead of 30. This allows the\n   * item to be claimed repeatedly until it is deleted.\n   */\n  public function claimItem($lease_time = 0) {\n    try {\n      $item = $this->connection->queryRange('SELECT [data], [item_id] FROM {queue} q WHERE [name] = :name ORDER BY [item_id] ASC', 0, 1, [':name' => $this->name])->fetchObject();\n      if ($item) {\n        $item->data = unserialize($item->data);\n        return $item;\n      }\n    }\n    catch (\\Exception $e) {\n      $this->catchException($e);\n    }\n    return FALSE;\n  }\n\n  /**\n   * Retrieves all remaining items in the queue.\n   *\n   * This is specific to Batch API and is not part of the\n   * \\Drupal\\Core\\Queue\\QueueInterface.\n   *\n   * @return array\n   *   An array of queue items.\n   */\n  public function getAllItems() {\n    $result = [];\n    try {\n      $items = $this->connection->select('queue', 'q')\n        ->fields('q', ['data'])\n        ->condition('name', $this->name)\n        ->orderBy('item_id', 'ASC')\n        ->execute()\n        ->fetchAll();\n\n      foreach ($items as $item) {\n        $result[] = unserialize($item->data);\n      }\n    }\n    catch (\\Exception $e) {\n      $this->catchException($e);\n    }\n    return $result;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Queue/Batch.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Batch", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'FlowDrop Runtime'\ntype: module\ndescription: 'Runtime execution engine for FlowDrop workflows with real-time monitoring'\ncore_version_requirement: ^11\npackage: 'FlowDrop'\ndependencies:\n  - flowdrop:flowdrop\n  - flowdrop:flowdrop_workflow\n  - flowdrop:flowdrop_pipeline\n  - flowdrop:flowdrop_job\n  - flowdrop:flowdrop_node_type\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/flowdrop_runtime.info.yml", "type": "yaml_reference", "topic": "flowdrop runtime.info"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: AttachedAssets.php\nTarget symbol: class AttachedAssets\nNamespace: Drupal\\Core\\Asset\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for AttachedAssets.\n- Ensure these methods exist where relevant:\n  - createFromRenderArray()\n  - getAlreadyLoadedLibraries()\n  - getLibraries()\n  - getSettings()\n  - setAlreadyLoadedLibraries()\n  - setLibraries()\n  - setSettings()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Asset;\n\n/**\n * The default attached assets collection.\n */\nclass AttachedAssets implements AttachedAssetsInterface {\n\n  /**\n   * The (ordered) list of asset libraries attached to the current response.\n   *\n   * @var string[]\n   */\n  public $libraries = [];\n\n  /**\n   * The JavaScript settings attached to the current response.\n   *\n   * @var array\n   */\n  public $settings = [];\n\n  /**\n   * The set of asset libraries that the client has already loaded.\n   *\n   * @var string[]\n   */\n  protected $alreadyLoadedLibraries = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createFromRenderArray(array $render_array) {\n    if (!isset($render_array['#attached'])) {\n      throw new \\LogicException('The render array has not yet been rendered, hence not all attachments have been collected yet.');\n    }\n\n    $assets = new static();\n    if (isset($render_array['#attached']['library'])) {\n      $assets->setLibraries($render_array['#attached']['library']);\n    }\n    if (isset($render_array['#attached']['drupalSettings'])) {\n      $assets->setSettings($render_array['#attached']['drupalSettings']);\n    }\n    return $assets;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setLibraries(array $libraries) {\n    $this->libraries = array_unique($libraries);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLibraries() {\n    return $this->libraries;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setSettings(array $settings) {\n    $this->settings = $settings;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSettings() {\n    return $this->settings;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAlreadyLoadedLibraries() {\n    return $this->alreadyLoadedLibraries;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setAlreadyLoadedLibraries(array $libraries) {\n    $this->alreadyLoadedLibraries = $libraries;\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Asset/AttachedAssets.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AttachedAssets", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class EntityWipeEvents in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Event;\n\n/**\n * Defines events for the db_wipe_entity module.\n */\nfinal class EntityWipeEvents {\n\n  /**\n   * Event dispatched before entity wipe operation starts.\n   */\n  const BEFORE_WIPE = 'db_wipe_entity.before_wipe';\n\n  /**\n   * Event dispatched after entity wipe operation completes.\n   */\n  const AFTER_WIPE = 'db_wipe_entity.after_wipe';\n\n  /**\n   * Event dispatched during batch processing.\n   */\n  const BATCH_PROCESS = 'db_wipe_entity.batch_process';\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Event/EntityWipeEvents.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityWipeEvents", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: LightgalleryProfile.php\nTarget symbol: class LightgalleryProfile\nNamespace: Drupal\\lightgallery_formatter\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LightgalleryProfile.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityBase\n- Ensure these methods exist where relevant:\n  - getAllPluginSettings()\n  - getPluginSettings()\n  - getStatus()\n  - setPluginSettings()", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\n\n/**\n * Defines the LightGallery profile configuration entity.\n *\n * @ConfigEntityType(\n *   id = \"lightgallery_profile\",\n *   label = @Translation(\"LightGallery profile\"),\n *   handlers = {\n *     \"list_builder\" = \"Drupal\\lightgallery_formatter\\Controller\\LightgalleryProfileController\",\n *     \"form\" = {\n *       \"add\" = \"Drupal\\lightgallery_formatter\\Form\\LightgalleryProfileForm\",\n *       \"edit\" = \"Drupal\\lightgallery_formatter\\Form\\LightgalleryProfileForm\",\n *       \"delete\" = \"Drupal\\Core\\Entity\\EntityDeleteForm\"\n *     }\n *   },\n *   config_prefix = \"profile\",\n *   admin_permission = \"administer lightgallery_formatter\",\n *   entity_keys = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\"\n *   },\n *   links = {\n *     \"collection\" = \"/admin/structure/lightgallery-profiles\",\n *     \"add-form\" = \"/admin/structure/lightgallery-profiles/add\",\n *     \"edit-form\" = \"/admin/structure/lightgallery-profiles/{lightgallery_profile}\",\n *     \"delete-form\" = \"/admin/structure/lightgallery-profiles/{lightgallery_profile}/delete\"\n *   },\n *   config_export = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\",\n *     \"plugin_settings\" = \"plugin_settings\"\n *   }\n * )\n */\nclass LightgalleryProfile extends ConfigEntityBase implements LightgalleryProfileInterface {\n\n  /**\n   * The machine name of the profile.\n   *\n   * @var string\n   */\n  protected $id;\n\n  /**\n   * The human-readable name of the profile.\n   *\n   * @var string\n   */\n  protected $label;\n\n  /**\n   * Whether the profile is enabled.\n   *\n   * @var bool\n   */\n  protected $status = TRUE;\n\n  /**\n   * Plugin configurations.\n   *\n   * @var array\n   */\n  protected $plugin_settings = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getStatus(): bool {\n    return (bool) $this->status;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginSettings(string $plugin_id): array {\n    return $this->plugin_settings[$plugin_id] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPluginSettings(string $plugin_id, array $settings): LightgalleryProfileInterface {\n    $this->plugin_settings[$plugin_id] = $settings;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAllPluginSettings(): array {\n    return $this->plugin_settings;\n  }\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/Entity/LightgalleryProfile.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryProfile", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface StateAwareProcessorInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_stategraph\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\flowdrop_stategraph\\DTO\\GraphState;\n\n/**\n * Interface for node processors that work with graph state.\n *\n * Processors implementing this interface receive the current graph state\n * before execution and can return state updates to be applied after.\n *\n * This interface is optional - processors can also access state via the\n * `__state__` key in input parameters. This interface provides a cleaner\n * API for state-heavy processors.\n *\n * Example usage:\n * @code\n * class MyStatefulProcessor extends AbstractFlowDropNodeProcessor\n *     implements StateAwareProcessorInterface {\n *\n *   protected ?GraphState $graphState = null;\n *\n *   public function setGraphState(GraphState $state): void {\n *     $this->graphState = $state;\n *   }\n *\n *   public function process(ParameterBagInterface $params): array {\n *     // Access state directly.\n *     $messages = $this->graphState->messages;\n *\n *     // Process and return state update.\n *     return [\n *       \"output\" => \"result\",\n *       \"state_update\" => [\n *         \"messages\" => [new Message(\"assistant\", \"Response\")],\n *       ],\n *     ];\n *   }\n * }\n * @endcode\n *\n * @see \\Drupal\\flowdrop_stategraph\\DTO\\GraphState\n * @see \\Drupal\\flowdrop_stategraph\\DTO\\StateUpdate\n */\ninterface StateAwareProcessorInterface {\n\n  /**\n   * Sets the current graph state.\n   *\n   * This method is called by the StateGraph orchestrator before process()\n   * is invoked.\n   *\n   * @param \\Drupal\\flowdrop_stategraph\\DTO\\GraphState $state\n   *   The current graph state.\n   */\n  public function setGraphState(GraphState $state): void;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_stategraph/src/Plugin/FlowDropNodeProcessor/StateAwareProcessorInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "StateAwareProcessorInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: RegistryOfCommerce\nSource file: <source_file>\nFile name hint: RegistryOfCommerce.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\zefix\\Services;\n\nuse Drupal\\zefix\\ZefixApiClient;\n\n/**\n * Service to list all cantonal registries of commerce.\n */\nclass RegistryOfCommerce {\n\n  /**\n   * The Zefix API client.\n   *\n   * @var \\Drupal\\zefix\\ZefixApiClient\n   */\n  protected ZefixApiClient $api;\n\n  /**\n   * Constructs a RegistryOfCommerce object.\n   *\n   * @param \\Drupal\\zefix\\ZefixApiClient $api\n   *   The Zefix API client.\n   */\n  public function __construct(ZefixApiClient $api) {\n    $this->api = $api;\n  }\n\n  /**\n   * Get a list of the cantonal registries of commerce.\n   *\n   * @link https://www.zefixintg.admin.ch/ZefixPublicREST/swagger-ui/index.html#/RegistryOfCommerce/list\n   *\n   * @return array|null\n   *   The registry of commerce data or null on error.\n   */\n  public function registryOfCommerce(): ?array {\n    return $this->api->get('registryOfCommerce', NULL);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\zefix\\Services;\n\nuse Drupal\\zefix\\ZefixApiClient;\n\n/**\n * Service to list all cantonal registries of commerce.\n */\nclass RegistryOfCommerce {\n\n  /**\n   * The Zefix API client.\n   *\n   * @var \\Drupal\\zefix\\ZefixApiClient\n   */\n  protected ZefixApiClient $api;\n\n  /**\n   * Constructs a RegistryOfCommerce object.\n   *\n   * @param \\Drupal\\zefix\\ZefixApiClient $api\n   *   The Zefix API client.\n   */\n  public function __construct(ZefixApiClient $api) {\n    $this->api = $api;\n  }\n\n  /**\n   * Get a list of the cantonal registries of commerce.\n   *\n   * @link https://www.zefixintg.admin.ch/ZefixPublicREST/swagger-ui/index.html#/RegistryOfCommerce/list\n   *\n   * @return array|null\n   *   The registry of commerce data or null on error.\n   */\n  public function registryOfCommerce(): ?array {\n    return $this->api->get('registryOfCommerce', NULL);\n  }\n\n}\n", "metadata": {"source": "repos/zefix/src/Services/RegistryOfCommerce.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegistryOfCommerce", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class RemoveHook in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Hook\\Attribute;\n\n/**\n * Removes an already existing implementation.\n *\n * The effect of this attribute is independent from the specific class or method\n * on which it is placed.\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS | \\Attribute::TARGET_METHOD | \\Attribute::IS_REPEATABLE)]\nclass RemoveHook implements HookAttributeInterface {\n\n  /**\n   * Constructs a RemoveHook object.\n   *\n   * @param string $hook\n   *   The hook name from which to remove the target implementation.\n   * @param class-string $class\n   *   The class name of the target hook implementation.\n   * @param string $method\n   *   The method name of the target hook implementation.\n   *   If the class instance itself is the listener, this should be '__invoke'.\n   */\n  public function __construct(\n    public readonly string $hook,\n    public readonly string $class,\n    public readonly string $method,\n  ) {}\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Hook/Attribute/RemoveHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RemoveHook", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ListMetatagGroups in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_metatag\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_metatag\\Service\\MetatagService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_metatag_list_groups',\n  label: new TranslatableMarkup('List Metatag Groups'),\n  description: new TranslatableMarkup('List all available metatag groups (basic, open_graph, twitter_cards, etc.).'),\n  operation: ToolOperation::Read,\n  input_definitions: [],\n  output_definitions: [\n    'total' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Groups'),\n      description: new TranslatableMarkup(''),\n    ),\n    'groups' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Metatag Groups'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass ListMetatagGroups extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'metatag';\n\n\n  protected MetatagService $metatagService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->metatagService = $container->get('mcp_tools_metatag.metatag');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    return $this->metatagService->listMetatagGroups();\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_metatag/src/Plugin/tool/Tool/ListMetatagGroups.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListMetatagGroups", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - media\nid: media_delete_action\nlabel: 'Delete media'\ntype: media\nplugin: entity:delete_action:media\nconfiguration: {  }\n", "metadata": {"source": "repos/drupal_core/core/modules/media/config/optional/system.action.media_delete_action.yml", "type": "yaml_reference", "topic": "system.action.media delete action"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: may\nSource file: <source_file>\nFile name hint: CacheableOmission.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\jsonapi\\Normalizer\\Value;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\n\n/**\n * Represents the cacheability associated with the omission of a value.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nfinal class CacheableOmission extends CacheableNormalization {\n\n  /**\n   * CacheableOmission constructor.\n   *\n   * @param \\Drupal\\Core\\Cache\\CacheableDependencyInterface $cacheability\n   *   Cacheability related to the omission of the normalization. For example,\n   *   if a field is omitted because of an access result that varies by the\n   *   `user.permissions` cache context, we need to associate that information\n   *   with the response so that it will appear for a user *with* the\n   *   appropriate permissions for that field.\n   */\n  public function __construct(CacheableDependencyInterface $cacheability) {\n    parent::__construct($cacheability, NULL);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function permanent($no_op = NULL) {\n    return parent::permanent(NULL);\n  }\n\n  /**\n   * A CacheableOmission should never have its normalization retrieved.\n   */\n  public function getNormalization() {\n    throw new \\LogicException('A CacheableOmission should never have its normalization retrieved.');\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\jsonapi\\Normalizer\\Value;\n\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\n\n/**\n * Represents the cacheability associated with the omission of a value.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nfinal class CacheableOmission extends CacheableNormalization {\n\n  /**\n   * CacheableOmission constructor.\n   *\n   * @param \\Drupal\\Core\\Cache\\CacheableDependencyInterface $cacheability\n   *   Cacheability related to the omission of the normalization. For example,\n   *   if a field is omitted because of an access result that varies by the\n   *   `user.permissions` cache context, we need to associate that information\n   *   with the response so that it will appear for a user *with* the\n   *   appropriate permissions for that field.\n   */\n  public function __construct(CacheableDependencyInterface $cacheability) {\n    parent::__construct($cacheability, NULL);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function permanent($no_op = NULL) {\n    return parent::permanent(NULL);\n  }\n\n  /**\n   * A CacheableOmission should never have its normalization retrieved.\n   */\n  public function getNormalization() {\n    throw new \\LogicException('A CacheableOmission should never have its normalization retrieved.');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/Normalizer/Value/CacheableOmission.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CacheableOmission", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FindBrokenLinks\nSource file: <source_file>\nFile name hint: FindBrokenLinks.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\mcp_tools\\Service\\RateLimiter;\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_broken_links',\n  label: new TranslatableMarkup('Find Broken Links'),\n  description: new TranslatableMarkup('Scan content for broken internal links (404s). Checks href attributes in text fields.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup('Maximum number of links to check (1-500, default: 100)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'broken_links' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Broken Links'),\n      description: new TranslatableMarkup('List of broken links found with source information'),\n    ),\n    'total_checked' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Checked'),\n      description: new TranslatableMarkup('Number of links checked'),\n    ),\n    'broken_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Broken Count'),\n      description: new TranslatableMarkup('Number of broken links found'),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup('Recommendations for fixing issues'),\n    ),\n  ],\n)]\nclass FindBrokenLinks extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * Read operation rate limiter.\n   */\n  protected RateLimiter $rateLimiter;\n\n  /**\n   * Config factory.\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    $instance->rateLimiter = $container->get('mcp_tools.rate_limiter');\n    $instance->configFactory = $container->get('config.factory');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $limit = isset($input['limit']) ? (int) $input['limit'] : 100;\n\n    if ($limit < 1 || $limit > 500) {\n      return ['success' => FALSE, 'error' => 'Limit must be between 1 and 500.'];\n    }\n\n    $settings = $this->configFactory->get('mcp_tools.settings');\n    $maxUrlsPerScan = (int) ($settings->get('rate_limits.broken_link_scan.max_urls_per_scan') ?? 500);\n    if ($maxUrlsPerScan > 0) {\n      $limit = min($limit, $maxUrlsPerScan);\n    }\n\n    $rateCheck = $this->rateLimiter->checkReadLimit('broken_link_scan');\n    if (!$rateCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $rateCheck['error'],\n        'code' => $rateCheck['code'] ?? 'RATE_LIMIT_EXCEEDED',\n        'retry_after' => $rateCheck['retry_after'] ?? NULL,\n      ];\n    }\n\n    return $this->analysisService->findBrokenLinks($limit);\n  }\n\n\n\n\n", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_analysis\\Plugin\\tool\\Tool;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\mcp_tools\\Service\\RateLimiter;\nuse Drupal\\mcp_tools_analysis\\Service\\AnalysisService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_analysis_broken_links',\n  label: new TranslatableMarkup('Find Broken Links'),\n  description: new TranslatableMarkup('Scan content for broken internal links (404s). Checks href attributes in text fields.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'limit' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Limit'),\n      description: new TranslatableMarkup('Maximum number of links to check (1-500, default: 100)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'broken_links' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Broken Links'),\n      description: new TranslatableMarkup('List of broken links found with source information'),\n    ),\n    'total_checked' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Checked'),\n      description: new TranslatableMarkup('Number of links checked'),\n    ),\n    'broken_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Broken Count'),\n      description: new TranslatableMarkup('Number of broken links found'),\n    ),\n    'suggestions' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Suggestions'),\n      description: new TranslatableMarkup('Recommendations for fixing issues'),\n    ),\n  ],\n)]\nclass FindBrokenLinks extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'analysis';\n\n\n  /**\n   * The analysis service.\n   */\n  protected AnalysisService $analysisService;\n\n  /**\n   * Read operation rate limiter.\n   */\n  protected RateLimiter $rateLimiter;\n\n  /**\n   * Config factory.\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->analysisService = $container->get('mcp_tools_analysis.analysis');\n    $instance->rateLimiter = $container->get('mcp_tools.rate_limiter');\n    $instance->configFactory = $container->get('config.factory');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $limit = isset($input['limit']) ? (int) $input['limit'] : 100;\n\n    if ($limit < 1 || $limit > 500) {\n      return ['success' => FALSE, 'error' => 'Limit must be between 1 and 500.'];\n    }\n\n    $settings = $this->configFactory->get('mcp_tools.settings');\n    $maxUrlsPerScan = (int) ($settings->get('rate_limits.broken_link_scan.max_urls_per_scan') ?? 500);\n    if ($maxUrlsPerScan > 0) {\n      $limit = min($limit, $maxUrlsPerScan);\n    }\n\n    $rateCheck = $this->rateLimiter->checkReadLimit('broken_link_scan');\n    if (!$rateCheck['allowed']) {\n      return [\n        'success' => FALSE,\n        'error' => $rateCheck['error'],\n        'code' => $rateCheck['code'] ?? 'RATE_LIMIT_EXCEEDED',\n        'retry_after' => $rateCheck['retry_after'] ?? NULL,\n      ];\n    }\n\n    return $this->analysisService->findBrokenLinks($limit);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/src/Plugin/tool/Tool/FindBrokenLinks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FindBrokenLinks", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class RestEndpointTool in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Plugin\\AgentApiTool;\n\nuse Drupal\\api_normalization_agents\\Attribute\\AgentApiTool;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Executes REST API endpoints as agent tools.\n */\n#[AgentApiTool(\n  id: 'rest_endpoint',\n  label: new TranslatableMarkup('REST Endpoint Tool'),\n  description: new TranslatableMarkup('Executes REST API calls from normalized specifications'),\n)]\nfinal class RestEndpointTool extends AgentApiToolBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(array $parameters, array $context): array {\n    if (!isset($context['endpoint_config'])) {\n      return [\n        'success' => FALSE,\n        'data' => NULL,\n        'metadata' => ['error' => 'Missing endpoint configuration'],\n      ];\n    }\n\n    $endpointConfig = $context['endpoint_config'];\n\n    try {\n      // In a real implementation, this would:\n      // 1. Get the api_normalizer service\n      // 2. Build a request using normalized API spec\n      // 3. Execute with inherited rate limiting and failover\n      // 4. Transform response for agent consumption.\n      // Placeholder for now.\n      return [\n        'success' => TRUE,\n        'data' => [\n          'message' => 'REST endpoint executed',\n          'endpoint' => $endpointConfig['path'] ?? 'unknown',\n          'method' => $endpointConfig['method'] ?? 'GET',\n        ],\n        'metadata' => [\n          'api_id' => $endpointConfig['api_id'] ?? NULL,\n          'rate_limit_group' => $endpointConfig['rate_limit_group'] ?? 'default',\n        ],\n      ];\n    }\n    catch (\\Exception $e) {\n      return [\n        'success' => FALSE,\n        'data' => NULL,\n        'metadata' => ['error' => $e->getMessage()],\n      ];\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOssaToolSchema(): array {\n    return [\n      'type' => 'function',\n      'function' => [\n        'name' => 'rest_api_call',\n        'description' => 'Executes a REST API call through the normalization layer',\n        'parameters' => [\n          'type' => 'object',\n          'properties' => [\n            'endpoint' => [\n              'type' => 'string',\n              'description' => 'The API endpoint path',\n            ],\n            'method' => [\n              'type' => 'string',\n              'description' => 'HTTP method (GET, POST, PUT, DELETE)',\n              'enum' => ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],\n            ],\n            'parameters' => [\n              'type' => 'object',\n              'description' => 'Request parameters',\n            ],\n          ],\n          'required' => ['endpoint', 'method'],\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/src/Plugin/AgentApiTool/RestEndpointTool.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RestEndpointTool", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class OrchestratorHelper in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Orchestrator;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\flowdrop_runtime\\Plugin\\Orchestrator\\OrchestratorPluginInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Helper service for orchestrator-related operations.\n *\n * Centralizes common orchestrator interaction patterns including:\n * - Instance creation with fallback handling\n * - Default orchestrator resolution\n * - Form options building\n * - Orchestrator type validation and detection.\n *\n * This service reduces code duplication across modules and ensures consistent\n * behavior when working with orchestrators.\n *\n * @see \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorHelperInterface\n */\nclass OrchestratorHelper implements OrchestratorHelperInterface {\n\n  /**\n   * The orchestrator plugin manager.\n   *\n   * @var \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorPluginManager\n   */\n  protected OrchestratorPluginManager $pluginManager;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs a new OrchestratorHelper.\n   *\n   * @param \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\OrchestratorPluginManager $plugin_manager\n   *   The orchestrator plugin manager.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    OrchestratorPluginManager $plugin_manager,\n    ConfigFactoryInterface $config_factory,\n    LoggerInterface $logger,\n  ) {\n    $this->pluginManager = $plugin_manager;\n    $this->configFactory = $config_factory;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInstance(string $type, ?string $fallback = NULL): OrchestratorPluginInterface {\n    $fallback = $fallback ?? self::ASYNCHRONOUS;\n\n    // Handle \"default\" type by resolving to actual default.\n    if ($type === \"default\") {\n      $type = $this->resolveDefault();\n    }\n\n    // Validate the orchestrator type exists.\n    if (!$this->pluginManager->hasDefinition($type)) {\n      $this->logger->warning(\"Orchestrator type '@type' not available, falling back to '@fallback'.\", [\n        \"@type\" => $type,\n        \"@fallback\" => $fallback,\n      ]);\n      $type = $fallback;\n\n      // If even the fallback doesn't exist, this is a critical error.\n      if (!$this->pluginManager->hasDefinition($type)) {\n        throw new \\RuntimeException(sprintf(\n          \"Neither orchestrator type '%s' nor fallback '%s' is available.\",\n          $type,\n          $fallback\n        ));\n      }\n    }\n\n    return $this->pluginManager->createInstance($type);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInstanceFromSettings(\n    array $settings,\n    ?string $defaultType = NULL,\n  ): OrchestratorPluginInterface {\n    $defaultType = $defaultType ?? self::ASYNCHRONOUS;\n    $type = $settings[\"type\"] ?? $defaultType;\n\n    return $this->getInstance($type, $defaultType);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolveDefault(?string $eventType = NULL): string {\n    // Check for presave events - these must be synchronous.\n    if ($eventType !== NULL && str_contains($eventType, \".presave\")) {\n      return self::SYNCHRONOUS;\n    }\n\n    // Try to get from trigger settings first.\n    $triggerSettings = $this->configFactory->get(\"flowdrop_trigger.settings\");\n    $default = $triggerSettings->get(\"default_orchestrator\");\n\n    if ($default !== NULL && $this->validate($default)) {\n      return $default;\n    }\n\n    // Fall back to general FlowDrop settings.\n    $flowdropSettings = $this->configFactory->get(\"flowdrop.settings\");\n    $default = $flowdropSettings->get(\"execution.default_orchestrator\");\n\n    if ($default !== NULL && $this->validate($default)) {\n      return $default;\n    }\n\n    // Final fallback to asynchronous.\n    return self::ASYNCHRONOUS;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(string $type): bool {\n    // Handle \"default\" as valid - it will be resolved later.\n    if ($type === \"default\") {\n      return TRUE;\n    }\n\n    return $this->pluginManager->hasDefinition($type);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormOptions(bool $includeDefault = FALSE): array {\n    $options = [];\n\n    // Optionally include \"default\" option at the start.\n    if ($includeDefault) {\n      $options[\"default\"] = \"Default (based on event)\";\n    }\n\n    // Get all available orchestrator definitions.\n    $definitions = $this->pluginManager->getDefinitions();\n\n    foreach ($definitions as $id => $definition) {\n      $label = $definition[\"label\"] ?? ucfirst(str_replace(\"_\", \" \", $id));\n\n      // Handle TranslatableMarkup objects.\n      if ($label instanceof \\Stringable) {\n        $label = (string) $label;\n      }\n\n      $options[$id] = $label;\n    }\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOriginalId(string $namespacedId): string {\n    return $this->pluginManager->getOriginalIdFromNamespacedId($namespacedId);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isStateGraph(string $type): bool {\n    $originalId = $this->getOriginalId($type);\n    return $originalId === \"stategraph\";\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isSynchronous(string $type): bool {\n    $originalId = $this->getOriginalId($type);\n    return $originalId === \"synchronous\" || $originalId === \"synchronous_pipeline\";\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Orchestrator/OrchestratorHelper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OrchestratorHelper", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CommerceReferral in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Primary module hooks for Commerce Referral module.\n */\n\n/**\n * Implements hook_entity_base_field_info_alter().\n *\n * @phpstan-ignore-next-line\n */\nfunction commerce_referral_entity_base_field_info_alter(array &$fields, $entity_type_id): void {\n  // Attach our validation to the order coupons field to prevent self-use and\n  // to restrict kickback coupons to the referrer.\n  if ($entity_type_id === 'commerce_order' && isset($fields['coupons'])) {\n    $constraints = $fields['coupons']->getConstraints();\n    $constraints['ReferralCoupon'] = [];\n    $fields['coupons']->setConstraints($constraints);\n  }\n}\n\n/**\n * Implements hook_theme().\n *\n * @phpstan-ignore-next-line\n */\nfunction commerce_referral_theme($existing, $type, $theme, $path): array {\n  return [\n    'commerce_referral_my_referral' => [\n      'variables' => [\n        'referral_code' => NULL,\n        'kickback_code' => NULL,\n      ],\n      'template' => 'commerce-referral-my-referral',\n    ],\n    'commerce_referral_report' => [\n      'variables' => [\n        'stats' => [],\n        'rows' => [],\n      ],\n      'template' => 'commerce-referral-report',\n    ],\n  ];\n}\n", "metadata": {"source": "repos/commerce_referral/commerce_referral.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CommerceReferral", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the class WorkflowController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_ui_agents\\Controller\\Api;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\flowdrop_ui_agents\\Service\\AgentWorkflowMapper;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * API controller for FlowDrop workflow operations.\n *\n * Provides endpoints for loading workflows with different expansion modes.\n */\nfinal class WorkflowController extends ControllerBase {\n\n  /**\n   * The agent workflow mapper service.\n   */\n  protected AgentWorkflowMapper $agentWorkflowMapper;\n\n  /**\n   * Constructs the controller.\n   */\n  public function __construct(AgentWorkflowMapper $agentWorkflowMapper) {\n    $this->agentWorkflowMapper = $agentWorkflowMapper;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('flowdrop_ui_agents.agent_workflow_mapper')\n    );\n  }\n\n  /**\n   * Gets workflow data for an agent with specified expansion mode.\n   *\n   * @param string $agent_id\n   *   The AI Agent ID.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   JSON response with workflow data.\n   */\n  public function getWorkflow(string $agent_id, Request $request): JsonResponse {\n    $expansion = $request->query->get('expansion', 'expanded');\n\n    // Validate expansion mode.\n    $validModes = ['expanded', 'grouped', 'collapsed'];\n    if (!in_array($expansion, $validModes, TRUE)) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => sprintf('Invalid expansion mode \"%s\". Valid modes: %s', $expansion, implode(', ', $validModes)),\n      ], 400);\n    }\n\n    // Load the agent.\n    $storage = $this->entityTypeManager()->getStorage('ai_agent');\n    $agent = $storage->load($agent_id);\n\n    if (!$agent instanceof ConfigEntityInterface) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => sprintf('Agent \"%s\" not found', $agent_id),\n      ], 404);\n    }\n\n    try {\n      // Convert agent to workflow with expansion mode.\n      $workflow = $this->agentWorkflowMapper->agentToWorkflow($agent, $expansion);\n\n      return new JsonResponse([\n        'success' => TRUE,\n        'data' => $workflow,\n        'expansion' => $expansion,\n      ]);\n    }\n    catch (\\Exception $e) {\n      return new JsonResponse([\n        'success' => FALSE,\n        'error' => 'Failed to generate workflow: ' . $e->getMessage(),\n      ], 500);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop_ui_agents/src/Controller/Api/WorkflowController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WorkflowController", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Views overview", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Views overview\n\nSame name and namespace in other branches\n\n1. [11.x core/modules/views/views.api.php](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/11.x) \\views\\_overview\n2. [10 core/modules/views/views.api.php](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/10) \\views\\_overview\n3. [9 core/modules/views/views.api.php](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/9) \\views\\_overview\n\nOverview of the Views module API\n\nThe Views module is a generalized query and display engine, which can be used\nto make views (formatted lists, grids, feeds, and other output) of items\n(often entities, but can be other types of data). Developers can interact\nwith Views in several ways:\n\n* **Provide plugins**: Views plugins govern nearly every aspect of views,\n  including querying (sorting, filtering, etc.) and display (at several\n  levels of granularity, ranging from the entire view to the details of a\n  field). See the [Views plugins topic](/api/drupal/core%21modules%21views%21views.api.php/group/views_plugins/8.9.x \"Overview of views plugins\") for\n  more information.\n* **Provide data**: Data types can be provided to Views by implementing\n  [hook\\_views\\_data](/api/drupal/core%21modules%21views%21views.api.php/function/hook_views_data/8.9.x \"Describe data tables and fields (or the equivalent) to Views.\")(), and data types provided by other modules can be altered\n  by implementing [hook\\_views\\_data\\_alter](/api/drupal/core%21modules%21views%21views.api.php/function/hook_views_data_alter/8.9.x \"Alter the table and field information from hook_views_data().\")(). To provide views data for an\n  entity, create a class implementing\n  [\\Drupal\\views\\EntityViewsDataInterface](/api/drupal/core%21modules%21views%21src%21EntityViewsDataInterface.php/interface/EntityViewsDataInterface/8.9.x \"Provides an interface to integrate an entity type with views.\") and reference this in the\n  \"views\\_data\" annotation in the entity class. You can autogenerate big parts\n  of the integration if you extend the [\\Drupal\\views\\EntityViewsData](/api/drupal/core%21modules%21views%21src%21EntityViewsData.php/class/EntityViewsData/8.9.x \"Provides generic views integration for entities.\") base\n  class. See the [Entity API topic](/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/8.9.x \"Describes how to define and manipulate content and configuration entities.\") for more\n  information about entities.\n* **Implement hooks**: A few operations in Views can be influenced by hooks.\n  See the [Views hooks topic](/api/drupal/core%21modules%21views%21views.api.php/group/views_hooks/8.9.x \"Hooks that allow other modules to implement the Views API.\") for a list.\n* **Theming**: See the [Views templates topic](/api/drupal/core%21modules%21views%21views.theme.inc/group/views_templates/8.9.x \"Describes various views templates & overriding options.\")\n  for more information.\n\n### See also\n\n[\\Drupal\\views\\ViewExecutable](/api/drupal/core%21modules%21views%21src%21ViewExecutable.php/class/ViewExecutable/8.9.x \"Represents a view as a whole.\")\n\n[\\Drupal\\views\\Views](/api/drupal/core%21modules%21views%21src%21Views.php/class/Views/8.9.x \"Static service container wrapper for views.\")\n\n### File\n\ncore/modules/views/[views.api.php](/api/drupal/core%21modules%21views%21views.api.php/8.9.x), line 13\n\n### Sub-Topics\n\n| [Title](?order=title&sort=desc \"sort by Title\") | [File name](?order=file_name&sort=asc \"sort by File name\") | Summary |\n| --- | --- | --- |\n| [Views hooks](/api/drupal/core%21modules%21views%21views.api.php/group/views_hooks/8.9.x) | core/modules/views/[views.api.php](/api/drupal/core%21modules%21views%21views.api.php/8.9.x) | Hooks that allow other modules to implement the Views API. |\n| [Views plugins](/api/drupal/core%21modules%21views%21views.api.php/group/views_plugins/8.9.x) | core/modules/views/[views.api.php](/api/drupal/core%21modules%21views%21views.api.php/8.9.x) | Overview of views plugins |\n| [Views template files](/api/drupal/core%21modules%21views%21views.theme.inc/group/views_templates/8.9.x) | core/modules/views/[views.theme.inc](/api/drupal/core%21modules%21views%21views.theme.inc/8.9.x) | Describes various views templates &amp; overriding options. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=8.9.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521modules%2521views%2521views.api.php/group/views_overview/8.9.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/8.9.x.md", "type": "doc_summary", "topic": "Views overview"}}
{"instruction": "Show me the implementation of the class ChatInput in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Plugin\\FlowDropNodeProcessor;\n\nuse Drupal\\flowdrop\\Attribute\\FlowDropNodeProcessor;\nuse Drupal\\flowdrop\\DTO\\ParameterBagInterface;\nuse Drupal\\flowdrop\\DTO\\ValidationResult;\nuse Drupal\\flowdrop\\Plugin\\FlowDropNodeProcessor\\AbstractFlowDropNodeProcessor;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Executor for Chat Input nodes.\n *\n * Provides chat input functionality for playground workflows.\n * Accepts message content from playground and optionally includes\n * conversation history for context-aware processing.\n */\n#[FlowDropNodeProcessor(\n  id: \"chat_input\",\n  label: new \\Drupal\\Core\\StringTranslation\\TranslatableMarkup(\"Chat Input\"),\n  description: \"Chat input for playground workflows with optional conversation history\",\n  version: \"1.0.0\"\n)]\nclass ChatInput extends AbstractFlowDropNodeProcessor {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(\n    ContainerInterface $container,\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n  ): static {\n    return new static($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateParams(array $params): ValidationResult {\n    // Chat input can accept any inputs or none.\n    // Message content is typically injected via initialData.\n    return ValidationResult::success();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ParameterBagInterface $params): array {\n    // Get message content from parameter\n    // (injected via initialData[nodeId]['message']).\n    $message = $params->get(\"message\", \"\");\n\n    // Get optional conversation history\n    // (injected via initialData[nodeId]['history']).\n    $history = $params->get(\"history\", []);\n    if (!is_array($history)) {\n      $history = [];\n    }\n\n    // Get session and message IDs if available (for tracking).\n    $sessionId = $params->get(\"sessionId\");\n    $messageId = $params->get(\"messageId\");\n\n    // Build output with message and optional history.\n    $output = [\n      \"message\" => $message,\n    ];\n\n    // Include history if provided and not empty.\n    if (!empty($history)) {\n      $output[\"history\"] = $history;\n    }\n\n    // Include metadata if available.\n    if ($sessionId !== NULL) {\n      $output[\"sessionId\"] = $sessionId;\n    }\n    if ($messageId !== NULL) {\n      $output[\"messageId\"] = $messageId;\n    }\n\n    return $output;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"message\" => [\n          \"type\" => \"string\",\n          \"title\" => \"Message\",\n          \"description\" => \"The chat message content (typically injected from playground)\",\n          \"default\" => \"\",\n        ],\n        \"history\" => [\n          \"type\" => \"array\",\n          \"title\" => \"Conversation History\",\n          \"description\" => \"Optional conversation history for context-aware processing\",\n          \"items\" => [\n            \"type\" => \"object\",\n            \"properties\" => [\n              \"role\" => [\n                \"type\" => \"string\",\n                \"description\" => \"Message role (user, assistant)\",\n              ],\n              \"content\" => [\n                \"type\" => \"string\",\n                \"description\" => \"Message content\",\n              ],\n              \"timestamp\" => [\n                \"type\" => \"integer\",\n                \"description\" => \"Message timestamp\",\n              ],\n            ],\n          ],\n        ],\n        \"sessionId\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Session ID\",\n          \"description\" => \"Playground session ID (for tracking)\",\n        ],\n        \"messageId\" => [\n          \"type\" => \"integer\",\n          \"title\" => \"Message ID\",\n          \"description\" => \"Playground message ID (for tracking)\",\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getOutputSchema(): array {\n    return [\n      \"type\" => \"object\",\n      \"properties\" => [\n        \"message\" => [\n          \"type\" => \"string\",\n          \"description\" => \"The chat message content\",\n        ],\n        \"history\" => [\n          \"type\" => \"array\",\n          \"description\" => \"Conversation history (if included)\",\n          \"items\" => [\n            \"type\" => \"object\",\n            \"properties\" => [\n              \"role\" => [\n                \"type\" => \"string\",\n                \"description\" => \"Message role\",\n              ],\n              \"content\" => [\n                \"type\" => \"string\",\n                \"description\" => \"Message content\",\n              ],\n              \"timestamp\" => [\n                \"type\" => \"integer\",\n                \"description\" => \"Message timestamp\",\n              ],\n            ],\n          ],\n        ],\n        \"sessionId\" => [\n          \"type\" => \"integer\",\n          \"description\" => \"Playground session ID\",\n        ],\n        \"messageId\" => [\n          \"type\" => \"integer\",\n          \"description\" => \"Playground message ID\",\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Plugin/FlowDropNodeProcessor/ChatInput.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ChatInput", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: user_profile_field_instance\nlabel: User profile field instance configuration\nmigration_tags:\n  - Drupal 6\n  - Drupal 7\n  - Configuration\nsource:\n  plugin: profile_field\n  constants:\n    entity_type: user\n    bundle: user\nprocess:\n  entity_type: 'constants/entity_type'\n  bundle: 'constants/bundle'\n  label: title\n  description: explanation\n  field_name:\n    -\n      plugin: migration_lookup\n      migration: user_profile_field\n      source: fid\n    -\n      plugin: skip_on_empty\n      method: row\n    -\n      plugin: extract\n      index:\n        - 1\n  required: required\ndestination:\n  plugin: entity:field_config\nmigration_dependencies:\n  required:\n    - user_profile_field\n", "metadata": {"source": "repos/drupal_core/core/modules/user/migrations/user_profile_field_instance.yml", "type": "yaml_reference", "topic": "user profile field instance"}}
{"instruction": "Show me the implementation of the class VisibilityConditionsPanel in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\Condition\\ConditionPluginCollection;\nuse Drupal\\Core\\Executable\\ExecutableManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Form\\SubformState;\nuse Drupal\\Core\\Plugin\\Context\\ContextRepositoryInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\IslandPluginBase;\nuse Drupal\\display_builder\\IslandType;\nuse Drupal\\display_builder\\IslandWithFormInterface;\nuse Drupal\\display_builder\\IslandWithFormTrait;\nuse Drupal\\display_builder\\RenderableAltererInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Visibility conditions island plugin implementation.\n */\n#[Island(\n  id: 'visibility_conditions',\n  label: new TranslatableMarkup('Visibility'),\n  description: new TranslatableMarkup('Set visibility conditions for the active component or block.'),\n  type: IslandType::Contextual,\n  theme: 'admin',\n)]\nclass VisibilityConditionsPanel extends IslandPluginBase implements IslandWithFormInterface, RenderableAltererInterface {\n\n  use IslandWithFormTrait;\n\n  /**\n   * The condition manager.\n   */\n  protected ExecutableManagerInterface $conditionManager;\n\n  /**\n   * The context repository.\n   */\n  protected ContextRepositoryInterface $contextRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->conditionManager = $container->get('plugin.manager.condition');\n    $instance->contextRepository = $container->get('context.repository');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array &$form, FormStateInterface $form_state): void {\n    $form['#tree'] = TRUE;\n\n    $data = $form_state->getBuildInfo()['args'][0];\n    $instance = $data['instance'] ?? [];\n    $conditions = $this->conditionManager->getDefinitions();\n    unset($conditions['response_status']);\n\n    // Gather all available contexts.\n    $gathered_contexts = $form_state->getTemporaryValue('gathered_contexts') ?? [];\n    $form_state->setTemporaryValue('gathered_contexts', $gathered_contexts + $this->contextRepository->getAvailableContexts());\n\n    foreach ($conditions as $condition_id => $definition) {\n      if ($condition_id === 'current_theme') {\n        continue;\n      }\n\n      if (\\str_starts_with($condition_id, 'entity_bundle:')) {\n        continue;\n      }\n\n      /** @var \\Drupal\\Core\\Condition\\ConditionInterface $condition */\n      $condition = $this->conditionManager->createInstance($condition_id, $instance[$condition_id] ?? []);\n      $form_state->set(['conditions', $condition_id], $condition);\n      $condition_form = $condition->buildConfigurationForm([], $form_state);\n      $condition_form['#type'] = 'details';\n      $condition_form['#title'] = (\\is_array($definition) && isset($definition['label'])) ? $definition['label'] : '';\n      $form[$condition_id] = $condition_form;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state): void {\n    // Remove configuration if it matches the defaults.\n    $visibility = new ConditionPluginCollection($this->conditionManager);\n    $conditions = $form_state->get('conditions');\n\n    foreach ($conditions as $condition_id => $condition) {\n      $condition->submitConfigurationForm($form[$condition_id], SubformState::createForSubform($form[$condition_id], $form, $form_state));\n      $visibility->set($condition_id, $condition);\n      $form_state->unsetValue($condition_id);\n    }\n\n    foreach ($visibility->getConfiguration() as $condition_id => $configuration) {\n      $form_state->setValue($condition_id, $configuration);\n    }\n\n    // Those two lines are necessary to prevent the form from being rebuilt.\n    // if rebuilt, the form state values will have both the computed ones\n    // and the raw ones (wrapper key and values).\n    $form_state->setRebuild(FALSE);\n    $form_state->setExecuted();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alterElement(array $element, array $data = []): array {\n    $available_contexts = $this->contextRepository->getAvailableContexts();\n\n    foreach (\\array_keys($data) as $condition_id) {\n      /** @var \\Drupal\\Component\\Plugin\\ContextAwarePluginInterface $condition */\n      $condition = $this->conditionManager->createInstance($condition_id, $data[$condition_id] ?? []);\n\n      // Apply context mapping.\n      $context_mapping = $condition->getContextMapping();\n\n      foreach ($context_mapping as $key => $value) {\n        if (isset($available_contexts[$value])) {\n          $condition->setContextValue($key, $available_contexts[$value]->getContextValue());\n        }\n      }\n\n      /** @var \\Drupal\\Core\\Executable\\ExecutableInterface $condition */\n      if (!$this->conditionManager->execute($condition)) {\n        return [];\n      }\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onAttachToRoot(string $builder_id, string $instance_id): array {\n    return $this->reloadWithInstanceData($builder_id, $instance_id);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onAttachToSlot(string $builder_id, string $instance_id, string $parent_id): array {\n    return $this->reloadWithInstanceData($builder_id, $instance_id);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onActive(string $builder_id, array $data): array {\n    return $this->reloadWithLocalData($builder_id, $data);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onDelete(string $builder_id, string $parent_id): array {\n    return $this->reloadWithLocalData($builder_id, []);\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Plugin/display_builder/Island/VisibilityConditionsPanel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "VisibilityConditionsPanel", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: automated_cron.module\nSource file: <source_file>\nFile name hint: automated_cron.module\nCurrent implementation:\n<?php\n\n/**\n * @file\n */\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form submission handler for system_cron_settings().\n *\n * @deprecated in drupal:11.4.0 and is removed from drupal:13.0.0. Use\n *   AutomatedCronHooks::automatedCronSettingsSubmit() instead.\n *\n * @see https://www.drupal.org/node/3566774\n * @see \\Drupal\\automated_cron\\Hook\\AutomatedCronHooks::automatedCronSettingsSubmit()\n */\nfunction automated_cron_settings_submit(array $form, FormStateInterface $form_state): void {\n  @trigger_error(__FUNCTION__ . '() is deprecated in drupal:11.4.0 and is removed from drupal:13.0.0. There is no replacement. See https://www.drupal.org/node/3566774', E_USER_DEPRECATED);\n  \\Drupal::configFactory()->getEditable('automated_cron.settings')\n    ->set('interval', $form_state->getValue('interval'))\n    ->save();\n}", "output": "<?php\n\n/**\n * @file\n */\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form submission handler for system_cron_settings().\n *\n * @deprecated in drupal:11.4.0 and is removed from drupal:13.0.0. Use\n *   AutomatedCronHooks::automatedCronSettingsSubmit() instead.\n *\n * @see https://www.drupal.org/node/3566774\n * @see \\Drupal\\automated_cron\\Hook\\AutomatedCronHooks::automatedCronSettingsSubmit()\n */\nfunction automated_cron_settings_submit(array $form, FormStateInterface $form_state): void {\n  @trigger_error(__FUNCTION__ . '() is deprecated in drupal:11.4.0 and is removed from drupal:13.0.0. There is no replacement. See https://www.drupal.org/node/3566774', E_USER_DEPRECATED);\n  \\Drupal::configFactory()->getEditable('automated_cron.settings')\n    ->set('interval', $form_state->getValue('interval'))\n    ->save();\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/automated_cron/automated_cron.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AutomatedCron", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EbLogManagerInterface.php\nTarget symbol: interface EbLogManagerInterface\nNamespace: Drupal\\eb\\Service\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for EbLogManagerInterface.\n- Include required imports:\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\eb\\Entity\\EbLogInterface\n- Ensure these methods exist where relevant:\n  - complete()\n  - getByDefinitionId()\n  - getById()\n  - loadLogs()\n  - log()\n  - purge()", "output": "<?php\n\nnamespace Drupal\\eb\\Service;\n\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\eb\\Entity\\EbLogInterface;\n\n/**\n * Interface for EbLog manager service.\n */\ninterface EbLogManagerInterface {\n\n  /**\n   * Creates a new log entry.\n   *\n   * @param array<string, mixed> $fields\n   *   Array of field values. Supported fields:\n   *   - label: (string) Human-readable label.\n   *   - definition_id: (string) Definition entity ID.\n   *   - action: (string) apply, rollback, import.\n   *   - operation_count: (int) Total operations.\n   *   - status: (string) pending, success, partial, failed.\n   *   - started: (int) Unix timestamp when action started.\n   *\n   * @return \\Drupal\\eb\\Entity\\EbLogInterface\n   *   The created log entity.\n   */\n  public function log(array $fields): EbLogInterface;\n\n  /**\n   * Completes a log entry.\n   *\n   * @param \\Drupal\\eb\\Entity\\EbLogInterface $log\n   *   The log entity to complete.\n   * @param string $status\n   *   The final status (success, partial, failed).\n   * @param int $successCount\n   *   The number of successful operations.\n   * @param int $failureCount\n   *   The number of failed operations.\n   */\n  public function complete(EbLogInterface $log, string $status, int $successCount, int $failureCount): void;\n\n  /**\n   * Gets log entries for a definition.\n   *\n   * @param string $definitionId\n   *   The definition entity ID.\n   *\n   * @return array<int, \\Drupal\\eb\\Entity\\EbLogInterface>\n   *   Array of log entities.\n   */\n  public function getByDefinitionId(string $definitionId): array;\n\n  /**\n   * Gets a single log entry by ID.\n   *\n   * @param int $id\n   *   The log entity ID.\n   *\n   * @return \\Drupal\\eb\\Entity\\EbLogInterface|null\n   *   The log entity or NULL if not found.\n   */\n  public function getById(int $id): ?EbLogInterface;\n\n  /**\n   * Loads log entries with optional filtering.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface|null $account\n   *   Optional account to filter by user.\n   * @param array<string, mixed> $options\n   *   Options including:\n   *   - limit: (int) Max records to return.\n   *   - status: (string) Filter by status.\n   *\n   * @return array<int, \\Drupal\\eb\\Entity\\EbLogInterface>\n   *   Array of log entities.\n   */\n  public function loadLogs(?AccountInterface $account = NULL, array $options = []): array;\n\n  /**\n   * Purges old log entries.\n   *\n   * @param int|null $daysOld\n   *   Delete records older than this many days. If NULL, uses config default.\n   *\n   * @return int\n   *   Number of deleted records.\n   */\n  public function purge(?int $daysOld = NULL): int;\n\n}\n", "metadata": {"source": "repos/eb/src/Service/EbLogManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EbLogManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the interface NodeChangeDefaultLanguageInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node_change_default_language;\n\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Interface for the Node Change Default Language service.\n */\ninterface NodeChangeDefaultLanguageInterface {\n\n  /**\n   * Changes the default language of a node.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The node entity.\n   * @param string $newLangcode\n   *   The new default language code.\n   *\n   * @return bool\n   *   TRUE if the operation was successful, FALSE otherwise.\n   *\n   * @throws \\InvalidArgumentException\n   *   If the target translation does not exist.\n   */\n  public function changeDefaultLanguage(NodeInterface $node, string $newLangcode): bool;\n\n}\n", "metadata": {"source": "repos/node_change_default_language/src/NodeChangeDefaultLanguageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "NodeChangeDefaultLanguageInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RegisterSerializationClassesCompilerPass in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\serialization;\n\nuse Symfony\\Component\\DependencyInjection\\Reference;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\n\n/**\n * Adds services tagged 'normalizer' and 'encoder' to the Serializer.\n */\nclass RegisterSerializationClassesCompilerPass implements CompilerPassInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function process(ContainerBuilder $container): void {\n    $definition = $container->getDefinition('serializer');\n\n    // Retrieve registered Normalizers and Encoders from the container.\n    foreach ($container->findTaggedServiceIds('normalizer') as $id => $attributes) {\n      // The 'serializer' service is the public API: mark normalizers private.\n      $container->getDefinition($id)->setPublic(FALSE);\n\n      $priority = $attributes[0]['priority'] ?? 0;\n      $normalizers[$priority][] = new Reference($id);\n    }\n    foreach ($container->findTaggedServiceIds('encoder') as $id => $attributes) {\n      // The 'serializer' service is the public API: mark encoders private.\n      $container->getDefinition($id)->setPublic(FALSE);\n\n      $priority = $attributes[0]['priority'] ?? 0;\n      $encoders[$priority][] = new Reference($id);\n    }\n\n    // Add the registered Normalizers and Encoders to the Serializer.\n    if (!empty($normalizers)) {\n      $definition->replaceArgument(0, $this->sort($normalizers));\n    }\n    if (!empty($encoders)) {\n      $definition->replaceArgument(1, $this->sort($encoders));\n    }\n\n    // Find all serialization formats known.\n    $formats = [];\n    $format_providers = [];\n    foreach ($container->findTaggedServiceIds('encoder') as $service_id => $attributes) {\n      $format = $attributes[0]['format'];\n      $formats[] = $format;\n\n      if ($provider_tag = $container->getDefinition($service_id)->getTag('_provider')) {\n        $format_providers[$format] = $provider_tag[0]['provider'];\n      }\n    }\n    $container->setParameter('serializer.formats', $formats);\n    $container->setParameter('serializer.format_providers', $format_providers);\n  }\n\n  /**\n   * Sorts by priority.\n   *\n   * Order services from highest priority number to lowest (reverse sorting).\n   *\n   * @param array $services\n   *   A nested array keyed on priority number. For each priority number, the\n   *   value is an array of Symfony\\Component\\DependencyInjection\\Reference\n   *   objects, each a reference to a normalizer or encoder service.\n   *\n   * @return array\n   *   A flattened array of Reference objects from $services, ordered from high\n   *   to low priority.\n   */\n  protected function sort($services) {\n    krsort($services);\n    return array_merge(...$services);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/RegisterSerializationClassesCompilerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegisterSerializationClassesCompilerPass", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: MCP Tools - Analysis", "input": "", "output": "# MCP Tools - Analysis\n\nSite health and content analysis tools for MCP Tools. All tools are read-only and provide diagnostic information with actionable suggestions.\n\n## Tools (8)\n\n| Tool | Description |\n|------|-------------|\n| `mcp_analysis_broken_links` | Scan content for broken internal links (404s) |\n| `mcp_analysis_content_audit` | Find stale, orphaned, and draft content |\n| `mcp_analysis_seo` | Analyze SEO for a specific entity (meta tags, headings, alt text) |\n| `mcp_analysis_security` | Review permissions and identify security issues |\n| `mcp_analysis_unused_fields` | Find fields with no data across entities |\n| `mcp_analysis_performance` | Analyze cache settings, errors, and database performance |\n| `mcp_analysis_accessibility` | Check accessibility (WCAG) for a specific entity |\n| `mcp_analysis_duplicates` | Find similar/duplicate content based on field values |\n\n## Requirements\n\n- mcp_tools (base module)\n\n## Installation\n\n```bash\ndrush en mcp_tools_analysis\n```\n\n## Example Usage\n\n### Find Broken Links\n\n```\nUser: \"Check the site for broken internal links\"\n\nAI calls: mcp_analysis_broken_links(\n  limit: 100\n)\n\nResponse includes:\n- List of broken links with source content info\n- Suggestions for fixing issues\n```\n\n### Content Audit\n\n```\nUser: \"Find content that hasn't been updated in over a year\"\n\nAI calls: mcp_analysis_content_audit(\n  stale_days: 365,\n  include_drafts: true\n)\n\nResponse includes:\n- Stale content list with last update dates\n- Orphaned (unpublished) content\n- Draft content awaiting publication\n```\n\n### SEO Analysis\n\n```\nUser: \"Analyze SEO for article node 42\"\n\nAI calls: mcp_analysis_seo(\n  entity_type: \"node\",\n  entity_id: 42\n)\n\nResponse includes:\n- SEO score (0-100)\n- Issues with title, meta description, headings\n- Missing alt text warnings\n- Content length analysis\n```\n\n### Security Audit\n\n```\nUser: \"Run a security audit on the site\"\n\nAI calls: mcp_analysis_security()\n\nResponse includes:\n- Critical issues (dangerous anonymous permissions)\n- Warnings (overly permissive roles)\n- Admin user count\n- Registration mode settings\n```\n\n### Find Unused Fields\n\n```\nUser: \"What fields are not being used?\"\n\nAI calls: mcp_analysis_unused_fields()\n\nResponse includes:\n- List of fields with no data\n- Entity type and bundle info\n- Suggestions for cleanup\n```\n\n### Performance Analysis\n\n```\nUser: \"Check site performance\"\n\nAI calls: mcp_analysis_performance()\n\nResponse includes:\n- Cache configuration status\n- Recent PHP/system errors from watchdog\n- Largest database tables\n- Performance optimization suggestions\n```\n\n### Accessibility Check\n\n```\nUser: \"Check accessibility for the homepage node\"\n\nAI calls: mcp_analysis_accessibility(\n  entity_type: \"node\",\n  entity_id: 1\n)\n\nResponse includes:\n- Accessibility issues with WCAG references\n- Missing alt text\n- Heading hierarchy problems\n- Generic link text warnings\n```\n\n### Find Duplicate Content\n\n```\nUser: \"Find articles with similar titles\"\n\nAI calls: mcp_analysis_duplicates(\n  content_type: \"article\",\n  field: \"title\",\n  threshold: 0.8\n)\n\nResponse includes:\n- Pairs of similar content with similarity percentage\n- Creation dates to identify original vs duplicate\n- Suggestions for handling duplicates\n```\n\n## Analysis Categories\n\n### Content Health\n- **Stale Content**: Content not updated within specified days\n- **Orphaned Content**: Unpublished content with no recent activity\n- **Drafts**: Content stuck in draft state\n\n### SEO Checks\n- Title length (30-60 characters recommended)\n- Meta description presence and length\n- Heading structure (no H1 in body, proper hierarchy)\n- Image alt text\n- Content length (300+ words recommended)\n\n### Security Checks\n- Anonymous user permissions\n- Authenticated user permissions\n- Overly permissive custom roles\n- User registration settings\n- Admin account count\n- PHP Filter module detection\n\n### Accessibility Checks (WCAG)\n- 1.1.1: Images without alt text\n- 1.3.1: Heading hierarchy, tables without headers\n- 1.4.1: Color-only information\n- 2.4.4: Empty or generic link text\n\n### Performance Metrics\n- Page cache max age\n- CSS/JS aggregation status\n- Watchdog error log analysis\n- Database table sizes\n\n## Output Format\n\nAll tools return a consistent structure:\n\n```json\n{\n  \"success\": true,\n  \"data\": {\n    // Tool-specific results\n    \"suggestions\": [\n      \"Actionable recommendation 1\",\n      \"Actionable recommendation 2\"\n    ]\n  }\n}\n```\n\n## Notes\n\n- All tools are read-only and do not modify any data\n- Large site scans may take time - use limit parameters where available\n- Suggestions are informational and should be reviewed before action\n- For comprehensive audits, combine multiple tools\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_analysis/README.md", "type": "doc_summary", "topic": "MCP Tools - Analysis"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  enforced:\n    module:\n      - ai_image_crop\nid: ai_image_crop_determine_focus__system_default\nlabel: 'Default system prompt for determining focus target'\ntype: ai_image_crop_determine_focus\nprompt: |\n  You are an image analysis expert. Your task is to analyze the provided image and determine what the focal point should be.\n\n  Based on the image content and any user guidance provided, describe in one short and concise sentence:\n  1. What specific element or subject you will focus on (be specific - e.g., \"the woman's face in the center\", \"the red car on the left\", \"the mountain peak\").\n\n  Be concise and specific. Your response will be used to guide the focal point positioning process.\n", "metadata": {"source": "repos/ai_image_crop/config/install/ai.ai_prompt.ai_image_crop_determine_focus__system_default.yml", "type": "yaml_reference", "topic": "ai.ai prompt.ai image crop determine focus  system default"}}
{"instruction": "Show me the implementation of the class EntityReference in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\row;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\views\\Attribute\\ViewsRow;\n\n/**\n * EntityReference row plugin.\n *\n * @ingroup views_row_plugins\n */\n#[ViewsRow(\n  id: \"entity_reference\",\n  title: new TranslatableMarkup(\"Entity Reference inline fields\"),\n  help: new TranslatableMarkup(\"Displays the fields with an optional template.\"),\n  theme: \"views_view_fields\",\n  register_theme: FALSE,\n  display_types: [\"entity_reference\"]\n)]\nclass EntityReference extends Fields {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['separator'] = ['default' => '-'];\n\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    parent::buildOptionsForm($form, $form_state);\n\n    // Expand the description of the 'Inline field' checkboxes.\n    $form['inline']['#description'] .= '<br />' . $this->t(\"<strong>Note:</strong> In 'Entity Reference' displays, all fields will be displayed inline unless an explicit selection of inline fields is made here.\");\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender($row) {\n    // Force all fields to be inline by default.\n    if (empty($this->options['inline'])) {\n      $fields = $this->view->getHandlers('field', $this->displayHandler->display['id']);\n      $names = array_keys($fields);\n      $this->options['inline'] = array_combine($names, $names);\n    }\n\n    return parent::preRender($row);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/row/EntityReference.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityReference", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "status: true\ndependencies:\n  module:\n    - flowdrop_pipeline\n  enforced:\n    module:\n      - flowdrop_pipeline\nid: default\nlabel: Default\ndescription: ''\ndefault_max_concurrent_jobs: 5\ndefault_job_priority_strategy: dependency_order\ndefault_retry_strategy: individual\nexecution_timeout: 3600\nmemory_limit: 512\nallowed_workflow_types: {  }\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_pipeline/config/install/flowdrop_pipeline.flowdrop_pipeline_type.default.yml", "type": "yaml_reference", "topic": "flowdrop pipeline.flowdrop pipeline type.default"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: LogsDataCollector\nSource file: <source_file>\nFile name hint: LogsDataCollector.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\monolog\\Logger\\LoggerInterfacesAdapter;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\DataCollector\\LateDataCollectorInterface;\nuse Symfony\\Component\\HttpKernel\\Log\\DebugLoggerInterface;\n\n/**\n * Collects logs data.\n */\nclass LogsDataCollector extends DataCollector implements HasPanelInterface, LateDataCollectorInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * LogsDataCollector constructor.\n   *\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(private readonly LoggerInterface $logger) {\n    $this->data['logs'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'logs';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function lateCollect() {\n    $logger = $this->logger;\n\n    if (\n      $logger instanceof LoggerInterfacesAdapter and\n      ($adapted_logger = $logger->getAdaptedLogger()) instanceof DebugLoggerInterface\n    ) {\n      $this->data['logs'] = \\array_map(\n        static function ($log) {\n          unset($log['context']['exception']);\n          unset($log['context']['backtrace']);\n\n          return $log;\n        },\n        $adapted_logger->getLogs(),\n      );\n    }\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return the number of logs.\n   *\n   * @return int\n   *   The number of logs.\n   */\n  public function getLogsCount(): int {\n    return \\count($this->data['logs']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Priority'),\n          $this->t('Channel'),\n          $this->t('Message'),\n        ],\n        '#rows' => \\array_map(function ($log) {\n          return [\n            $log['priorityName'],\n            $log['channel'],\n            $this->processContext($log['message'], $log['context']),\n          ];\n        }, $this->data['logs']),\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n  /**\n   * Process the context.\n   *\n   * @param string $message\n   *   The message.\n   * @param array $context\n   *   The context.", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\monolog\\Logger\\LoggerInterfacesAdapter;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\DataCollector\\LateDataCollectorInterface;\nuse Symfony\\Component\\HttpKernel\\Log\\DebugLoggerInterface;\n\n/**\n * Collects logs data.\n */\nclass LogsDataCollector extends DataCollector implements HasPanelInterface, LateDataCollectorInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * LogsDataCollector constructor.\n   *\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(private readonly LoggerInterface $logger) {\n    $this->data['logs'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'logs';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function lateCollect() {\n    $logger = $this->logger;\n\n    if (\n      $logger instanceof LoggerInterfacesAdapter and\n      ($adapted_logger = $logger->getAdaptedLogger()) instanceof DebugLoggerInterface\n    ) {\n      $this->data['logs'] = \\array_map(\n        static function ($log) {\n          unset($log['context']['exception']);\n          unset($log['context']['backtrace']);\n\n          return $log;\n        },\n        $adapted_logger->getLogs(),\n      );\n    }\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return the number of logs.\n   *\n   * @return int\n   *   The number of logs.\n   */\n  public function getLogsCount(): int {\n    return \\count($this->data['logs']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Priority'),\n          $this->t('Channel'),\n          $this->t('Message'),\n        ],\n        '#rows' => \\array_map(function ($log) {\n          return [\n            $log['priorityName'],\n            $log['channel'],\n            $this->processContext($log['message'], $log['context']),\n          ];\n        }, $this->data['logs']),\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n  /**\n   * Process the context.\n   *\n   * @param string $message\n   *   The message.\n   * @param array $context\n   *   The context.\n   *\n   * @return string\n   *   The processed context.\n   */\n  private function processContext(string $message, array $context): string {\n    $replacements = [];\n    foreach ($context as $key => $value) {\n      if (\\is_array($value) || \\is_object($value)) {\n        $value = \\json_encode($value);\n      }\n      $replacements['{' . $key . '}'] = $value;\n    }\n\n    return \\strtr($message, $replacements);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/LogsDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LogsDataCollector", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FormatDate\nSource file: <source_file>\nFile name hint: FormatDate.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\Component\\Datetime\\DateTimePlus;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Converts date/datetime from one format to another.\n *\n * Available configuration keys\n * - from_format: The source format string as accepted by\n *   @link http://php.net/manual/datetime.createfromformat.php \\DateTime::createFromFormat. @endlink\n * - to_format: The destination format.\n * - from_timezone: String identifying the required source time zone, see\n *   DateTimePlus::__construct().\n * - to_timezone: String identifying the required destination time zone, see\n *   DateTimePlus::__construct().\n * - settings: keyed array of settings, see DateTimePlus::__construct().\n *\n * Configuration keys from_timezone and to_timezone are both optional. Possible\n * input variants:\n * - Both from_timezone and to_timezone are empty. Date will not be converted\n *   and be treated as date in default timezone.\n * - Only from_timezone is set. Date will be converted from timezone specified\n *   in from_timezone key to the default timezone.\n * - Only to_timezone is set. Date will be converted from the default timezone\n *   to the timezone specified in to_timezone key.\n * - Both from_timezone and to_timezone are set. Date will be converted from\n *   timezone specified in from_timezone key to the timezone specified in\n *   to_timezone key.\n *\n * Examples:\n *\n * Example usage for date only fields\n * (DateTimeItemInterface::DATE_STORAGE_FORMAT):\n * @code\n * process:\n *   field_date:\n *     plugin: format_date\n *     from_format: 'm/d/Y'\n *     to_format: 'Y-m-d'\n *     source: event_date\n * @endcode\n *\n * If the source value was '01/05/1955' the transformed value would be\n * 1955-01-05.\n *\n * Example usage for datetime fields\n * (DateTimeItemInterface::DATETIME_STORAGE_FORMAT):\n * @code\n * process:\n *   field_time:\n *     plugin: format_date\n *     from_format: 'm/d/Y H:i:s'\n *     to_format: 'Y-m-d\\TH:i:s'\n *     source: event_time\n * @endcode\n *\n * If the source value was '01/05/1955 10:43:22' the transformed value would be\n * 1955-01-05T10:43:22.\n *\n * Example usage for datetime fields with a timezone and settings:\n * @code\n * process:\n *   field_time:\n *     plugin: format_date\n *     from_format: 'Y-m-d\\TH:i:sO'\n *     to_format: 'Y-m-d\\TH:i:s'\n *     from_timezone: 'America/Managua'\n *     to_timezone: 'UTC'\n *     settings:\n *       validate_format: false\n *     source: event_time\n * @endcode\n *\n * If the source value was '2004-12-19T10:19:42-0600' the transformed value\n * would be 2004-12-19T10:19:42. Set validate_format to false if your source\n * value is '0000-00-00 00:00:00'.\n *\n * @see \\DateTime::createFromFormat()\n * @see \\Drupal\\Component\\Datetime\\DateTimePlus::__construct()\n * @see \\Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItemInterface\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('format_date')]\nclass FormatDate extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (empty($value) && $value !== '0' && $value !== 0) {\n      return '';\n    }\n\n    // Validate the configuration.\n    if (empty($this->configuration['from_format'])) {\n      throw new MigrateException('Format date plugin is missing from_format configuration.');\n    }\n    if (empty($this->configuration['to_format'])) {\n      throw new MigrateException('Format date plugin is missing to_format configuration.');\n    }\n\n    $fromFormat = $this->configuration['from_format'];\n    $toFormat = $this->configuration['to_format'];\n    $system_timezone = date_default_timezone_get();\n    $default_timezone = !empty($system_timezone) ? $system_timezone : 'UTC';\n    $from_timezone = $this->configuration['from_timezone'] ?? $default_timezone;\n    $to_timezone = $this->configuration['to_timezone'] ?? $default_timezone;\n    $settings = $this->configuration['settings'] ?? [];\n\n    // Older versions of Drupal where omitting certain granularity values (also\n    // known as \"collected date attributes\") resulted in invalid timestamps\n    // getting stored.\n    if ($fromFormat === 'Y-m-d\\TH:i:s') {", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\Component\\Datetime\\DateTimePlus;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Converts date/datetime from one format to another.\n *\n * Available configuration keys\n * - from_format: The source format string as accepted by\n *   @link http://php.net/manual/datetime.createfromformat.php \\DateTime::createFromFormat. @endlink\n * - to_format: The destination format.\n * - from_timezone: String identifying the required source time zone, see\n *   DateTimePlus::__construct().\n * - to_timezone: String identifying the required destination time zone, see\n *   DateTimePlus::__construct().\n * - settings: keyed array of settings, see DateTimePlus::__construct().\n *\n * Configuration keys from_timezone and to_timezone are both optional. Possible\n * input variants:\n * - Both from_timezone and to_timezone are empty. Date will not be converted\n *   and be treated as date in default timezone.\n * - Only from_timezone is set. Date will be converted from timezone specified\n *   in from_timezone key to the default timezone.\n * - Only to_timezone is set. Date will be converted from the default timezone\n *   to the timezone specified in to_timezone key.\n * - Both from_timezone and to_timezone are set. Date will be converted from\n *   timezone specified in from_timezone key to the timezone specified in\n *   to_timezone key.\n *\n * Examples:\n *\n * Example usage for date only fields\n * (DateTimeItemInterface::DATE_STORAGE_FORMAT):\n * @code\n * process:\n *   field_date:\n *     plugin: format_date\n *     from_format: 'm/d/Y'\n *     to_format: 'Y-m-d'\n *     source: event_date\n * @endcode\n *\n * If the source value was '01/05/1955' the transformed value would be\n * 1955-01-05.\n *\n * Example usage for datetime fields\n * (DateTimeItemInterface::DATETIME_STORAGE_FORMAT):\n * @code\n * process:\n *   field_time:\n *     plugin: format_date\n *     from_format: 'm/d/Y H:i:s'\n *     to_format: 'Y-m-d\\TH:i:s'\n *     source: event_time\n * @endcode\n *\n * If the source value was '01/05/1955 10:43:22' the transformed value would be\n * 1955-01-05T10:43:22.\n *\n * Example usage for datetime fields with a timezone and settings:\n * @code\n * process:\n *   field_time:\n *     plugin: format_date\n *     from_format: 'Y-m-d\\TH:i:sO'\n *     to_format: 'Y-m-d\\TH:i:s'\n *     from_timezone: 'America/Managua'\n *     to_timezone: 'UTC'\n *     settings:\n *       validate_format: false\n *     source: event_time\n * @endcode\n *\n * If the source value was '2004-12-19T10:19:42-0600' the transformed value\n * would be 2004-12-19T10:19:42. Set validate_format to false if your source\n * value is '0000-00-00 00:00:00'.\n *\n * @see \\DateTime::createFromFormat()\n * @see \\Drupal\\Component\\Datetime\\DateTimePlus::__construct()\n * @see \\Drupal\\datetime\\Plugin\\Field\\FieldType\\DateTimeItemInterface\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('format_date')]\nclass FormatDate extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (empty($value) && $value !== '0' && $value !== 0) {\n      return '';\n    }\n\n    // Validate the configuration.\n    if (empty($this->configuration['from_format'])) {\n      throw new MigrateException('Format date plugin is missing from_format configuration.');\n    }\n    if (empty($this->configuration['to_format'])) {\n      throw new MigrateException('Format date plugin is missing to_format configuration.');\n    }\n\n    $fromFormat = $this->configuration['from_format'];\n    $toFormat = $this->configuration['to_format'];\n    $system_timezone = date_default_timezone_get();\n    $default_timezone = !empty($system_timezone) ? $system_timezone : 'UTC';\n    $from_timezone = $this->configuration['from_timezone'] ?? $default_timezone;\n    $to_timezone = $this->configuration['to_timezone'] ?? $default_timezone;\n    $settings = $this->configuration['settings'] ?? [];\n\n    // Older versions of Drupal where omitting certain granularity values (also\n    // known as \"collected date attributes\") resulted in invalid timestamps\n    // getting stored.\n    if ($fromFormat === 'Y-m-d\\TH:i:s') {\n      $value = str_replace(['-00-00T', '-00T'], ['-01-01T', '-01T'], $value);\n    }\n\n    // Attempts to transform the supplied date using the defined input format.\n    // DateTimePlus::createFromFormat can throw exceptions, so we need to\n    // explicitly check for problems.\n    try {\n      $transformed = DateTimePlus::createFromFormat($fromFormat, $value, $from_timezone, $settings)->format($toFormat, ['timezone' => $to_timezone]);\n    }\n    catch (\\InvalidArgumentException $e) {\n      throw new MigrateException(sprintf(\"Format date plugin could not transform '%s' using the format '%s'. Error: %s\", $value, $fromFormat, $e->getMessage()), $e->getCode(), $e);\n    }\n    catch (\\UnexpectedValueException $e) {\n      throw new MigrateException(sprintf(\"Format date plugin could not transform '%s' using the format '%s'. Error: %s\", $value, $fromFormat, $e->getMessage()), $e->getCode(), $e);\n    }\n\n    return $transformed;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/FormatDate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FormatDate", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SetCustomize.php\nTarget symbol: class SetCustomize\nNamespace: Drupal\\shortcut\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SetCustomize.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityForm\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\Render\\Element\n  - Drupal\\Core\\Url\n- Ensure these methods exist where relevant:\n  - actions()\n  - form()\n  - save()", "output": "<?php\n\nnamespace Drupal\\shortcut\\Form;\n\nuse Drupal\\Core\\Entity\\EntityForm;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Render\\Element;\nuse Drupal\\Core\\Url;\n\n/**\n * Builds the shortcut set customize form.\n *\n * @internal\n */\nclass SetCustomize extends EntityForm {\n\n  /**\n   * The entity being used by this form.\n   *\n   * @var \\Drupal\\shortcut\\ShortcutSetInterface\n   */\n  protected $entity;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    $form = parent::form($form, $form_state);\n    $form['shortcuts'] = [\n      '#tree' => TRUE,\n      '#weight' => -20,\n    ];\n\n    $form['shortcuts']['links'] = [\n      '#type' => 'table',\n      '#header' => [$this->t('Name'), $this->t('Weight'), $this->t('Operations')],\n      '#empty' => $this->t('No shortcuts available. <a href=\":link\">Add a shortcut</a>', [':link' => Url::fromRoute('shortcut.link_add', ['shortcut_set' => $this->entity->id()])->toString()]),\n      '#attributes' => ['id' => 'shortcuts'],\n      '#tabledrag' => [\n        [\n          'action' => 'order',\n          'relationship' => 'sibling',\n          'group' => 'shortcut-weight',\n        ],\n      ],\n    ];\n\n    foreach ($this->entity->getShortcuts() as $shortcut) {\n      $id = $shortcut->id();\n      $url = $shortcut->getUrl();\n      if (!$url->access()) {\n        continue;\n      }\n      $form['shortcuts']['links'][$id]['#attributes']['class'][] = 'draggable';\n      $form['shortcuts']['links'][$id]['name'] = [\n        '#type' => 'link',\n        '#title' => $shortcut->getTitle(),\n        '#url' => $url,\n        '#options' => $url->getOptions(),\n      ];\n      $form['shortcuts']['links'][$id]['#weight'] = $shortcut->getWeight();\n      $form['shortcuts']['links'][$id]['weight'] = [\n        '#type' => 'weight',\n        '#title' => $this->t('Weight for @title', ['@title' => $shortcut->getTitle()]),\n        '#title_display' => 'invisible',\n        '#default_value' => $shortcut->getWeight(),\n        '#attributes' => ['class' => ['shortcut-weight']],\n      ];\n\n      $links['edit'] = [\n        'title' => $this->t('Edit'),\n        'url' => $shortcut->toUrl(),\n      ];\n      $links['delete'] = [\n        'title' => $this->t('Delete'),\n        'url' => $shortcut->toUrl('delete-form'),\n      ];\n      $form['shortcuts']['links'][$id]['operations'] = [\n        '#type' => 'operations',\n        '#links' => $links,\n        '#access' => $url->access(),\n      ];\n    }\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    // Only includes a Save action for the entity, no direct Delete button.\n    return [\n      'submit' => [\n        '#type' => 'submit',\n        '#value' => $this->t('Save'),\n        '#access' => (bool) Element::getVisibleChildren($form['shortcuts']['links']),\n        '#submit' => ['::submitForm', '::save'],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    foreach ($this->entity->getShortcuts() as $shortcut) {\n      $weight = $form_state->getValue(['shortcuts', 'links', $shortcut->id(), 'weight']);\n      $shortcut->setWeight($weight);\n      $shortcut->save();\n    }\n    $this->messenger()->addStatus($this->t('The shortcut set has been updated.'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/src/Form/SetCustomize.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SetCustomize", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SoapResponseResetEvent.php\nTarget symbol: class SoapResponseResetEvent\nNamespace: Drupal\\soap_client\\Event\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SoapResponseResetEvent.", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Event;\n\n/**\n * Event emitted when SOAP selection is cleared/reset.\n *\n * Emitted when a user clears or resets their selection\n * in a SOAP element, returning to initial/undefined state.\n */\nclass SoapResponseResetEvent extends SoapResponseEventBase\n{\n}\n", "metadata": {"source": "repos/soap_client/src/Event/SoapResponseResetEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapResponseResetEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: OperationEvents\nSource file: <source_file>\nFile name hint: OperationEvents.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\eb\\Event;\n\n/**\n * Defines events for Entity Builder operations.\n */\nfinal class OperationEvents {\n\n  /**\n   * Event dispatched before operation validation.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const PRE_VALIDATE = 'eb.operation.pre_validate';\n\n  /**\n   * Event dispatched after operation validation.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const POST_VALIDATE = 'eb.operation.post_validate';\n\n  /**\n   * Event dispatched before operation execution.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const PRE_EXECUTE = 'eb.operation.pre_execute';\n\n  /**\n   * Event dispatched after operation execution.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const POST_EXECUTE = 'eb.operation.post_execute';\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\eb\\Event;\n\n/**\n * Defines events for Entity Builder operations.\n */\nfinal class OperationEvents {\n\n  /**\n   * Event dispatched before operation validation.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const PRE_VALIDATE = 'eb.operation.pre_validate';\n\n  /**\n   * Event dispatched after operation validation.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const POST_VALIDATE = 'eb.operation.post_validate';\n\n  /**\n   * Event dispatched before operation execution.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const PRE_EXECUTE = 'eb.operation.pre_execute';\n\n  /**\n   * Event dispatched after operation execution.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const POST_EXECUTE = 'eb.operation.post_execute';\n\n}\n", "metadata": {"source": "repos/eb/src/Event/OperationEvents.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OperationEvents", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.menu.collection:\n  title: Menus\n  description: 'Manage menus and menu links.'\n  route_name: entity.menu.collection\n  parent: system.admin_structure\n", "metadata": {"source": "repos/drupal_core/core/modules/menu_ui/menu_ui.links.menu.yml", "type": "yaml_reference", "topic": "menu ui.links.menu"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Setting up Git for Drupal and get GitLab access", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Git version control system](/docs/develop/git)\n\n* [Introduction to Drupal Git](/docs/develop/git/introduction-to-drupal-git)\n* [Setting up Git for Drupal](/docs/develop/git/setting-up-git-for-drupal-and-get-gitlab-access)\n* [Using Git to Contribute to Drupal](/docs/develop/git/using-git-to-contribute-to-drupal)\n* [Using GitLab to Contribute to Drupal](/docs/develop/git/using-gitlab-to-contribute-to-drupal)\n* [Git for Drupal project maintainers](/docs/develop/git/git-for-drupal-project-maintainers)\n* [Common development workflow](/docs/develop/git/common-development-workflow)\n* [Git branching strategy for multiple developers](/docs/develop/git/git-branching-strategy-for-multiple-developers)\n\n# Setting up Git for Drupal and get GitLab access\n\nYou can help improve Drupal via the [GitLab UI Web IDE](https://docs.gitlab.com/user/project/web_ide/) in the browser, or using Git via the command line.\n\nIn both cases, to push code or contribute via merge requests, you need to:\n\n* Get Git access for your drupal.org account (see below).\n* [Get authenticated for drupal.org projects](https://www.drupal.org/drupalorg/docs/user-accounts/git-authentication-for-drupalorg-projects).\n\nTo use Git from the command line:\n\n1. Install Git. See [Git Downloads](https://git-scm.com/downloads) and [Installing Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).\n2. Optionally, install a [Git GUI client](https://git-scm.com/downloads/guis) and/or the [drupalorg-cli CLI tool](https://github.com/mglaman/drupalorg-cli).\n3. Configure Git and/or your Git GUI tool (see below).\n\n## [Obtaining Git access](/docs/develop/git/setting-up-git-for-drupal/obtaining-git-access)\n\nHow to set up your drupal.org account for Git access\n\n## [Configuring Git for Drupal](/docs/develop/git/setting-up-git-for-drupal/configuring-git-for-drupal)\n\nHow to configure Git to work with Drupal\n\n## [Drupal Git usage policies](/docs/develop/git/setting-up-git-for-drupal/drupal-git-usage-policies)\n\nGuidelines and policies for Git usage on Drupal\n\n* [Drupal Git Contributor Agreement & Repository Usage Policy](/docs/develop/git/setting-up-git-for-drupal/drupal-git-usage-policies/drupal-git-contributor-agreement-repository-usage-policy)\n* [Policy on 3rd party assets on Drupal.org](/docs/develop/git/setting-up-git-for-drupal/drupal-git-usage-policies/policy-on-3rd-party-assets-on)\n* [Including 3rd party libraries](/docs/develop/git/setting-up-git-for-drupal/drupal-git-usage-policies/including-3rd-party-libraries)\n* [Contacted by the LWG. Now what?](/docs/develop/git/setting-up-git-for-drupal/drupal-git-usage-policies/contacted-by-the-lwg-now-what)\n\n## Related Content\n\n## [Overview of projects and issues](/docs/develop/issues/overview-of-projects-and-issues)\n\nDescribes projects and issues, in the Drupal community\n\n[issues](/taxonomy/term/193192)\n\n[Issue queue usage](/taxonomy/term/193158)\n\n## [Git Authentication for Drupal.org Projects](/drupalorg/docs/user-accounts/git-authentication-for-drupalorg-projects)\n\nGit Authentication for Drupal.org projects is changing, learn how to authenticate with SSH keys or Token over HTTPS\n\n[Git](/taxonomy/term/187251)\n\n## [Development tools](/docs/develop/development-tools)\n\nCommonly used tools to aid in Drupal development\n\n## [Contributor development and testing tools](/community/contributor-guide/reference-information/quick-info/contributor-development-and-testing-tools)\n\nHow to set up either remote testing or a local development environment for contributing to Drupal projects\n\n[mentoring](/taxonomy/term/194662)\n\n## Tags\n\n[Git](/taxonomy/term/187251)\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/git/setting-up-git-for-drupal-and-get-gitlab-access.md", "type": "doc_summary", "topic": "Setting up Git for Drupal and get GitLab access"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Frontend Libraries", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Decoupled Drupal](/docs/develop/decoupled-drupal)\n\n* [Decoupled Drupal Stacks](/docs/develop/decoupled-drupal/decoupled-drupal-stacks \"A list of completely integrated, documented solutions that make it easy to get started with decoupled Drupal.\")\n* [APIs and useful modules](/docs/develop/decoupled-drupal/apis-and-useful-modules \"Drupal provides multiple API approaches and extension modules for decoupled architectures.\")\n* [Frontend Libraries](/docs/develop/decoupled-drupal/frontend-libraries)\n* [Decoupled Drupal Canvas](/docs/develop/decoupled-drupal/decoupled-drupal-canvas \"Discusses approaches for decoupling Drupal Canvas: Via synched code components or via Canvas External Javascript Components\")\n\n# Frontend Libraries\n\nLast [updated](/node/3557381/discuss) on\n\n12 November 2025\n\n**JSON:API Clients:**\n\n* **[@drupal-api-client/json-api-client](https://www.npmjs.com/package/@drupal-api-client/json-api-client)** - Framework-agnostic, universal JSON:API client. See [#3384390: API Client](/docs/develop/decoupled-drupal/api-client \"Status: Unknown\") for more details.\n* **[drupal-jsonapi-client](https://www.npmjs.com/package/drupal-jsonapi-client)** - Lightweight, object-oriented client with familiar Drupal Entity API syntax.\n\n**Query Builders:**\n\n* **[drupal-jsonapi-params](https://www.npmjs.com/package/drupal-jsonapi-params)** - Essential helper for building complex JSON:API queries with filtering, sorting, includes, and pagination.\n\n**Framework-specific clients:**\n\n* **[next-drupal](https://www.npmjs.com/package/next-drupal)** - Powerful TypeScript client for Next.js with resource fetching, authentication, and built-in Drupal entity types.\n* **[nuxtjs-drupal-ce](https://www.npmjs.com/package/nuxtjs-drupal-ce)** - Nuxt\u00a0module connecting to Drupal via Lupus Custom Elements with routing, authentication, and metadata integration\n\n**Other packages:**\n\n* **[nuxt-component-preview](https://github.com/drunomics/nuxt-component-preview)** - Renders decoupled component previews with Nuxt for Lupus Decoupled Drupal or Custom Elements using Vue teleports.\n* [**Drupal Canvas CLI**](https://www.npmjs.com/package/@drupal-canvas/cli) - A command-line interface for managing Drupal Canvas code components, which are built with standard React and JavaScript.\n\n## Related Content\n\n## [API Client](/docs/develop/decoupled-drupal/api-client)\n\nA client for sourcing data from common Drupal APIs\n\n## [Decoupled menus](/docs/develop/decoupled-drupal/decoupled-menus)\n\nDecoupled menus\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/3557381/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%283557381%29%20Frontend%20Libraries) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/decoupled-drupal/frontend-libraries.md", "type": "doc_summary", "topic": "Frontend Libraries"}}
{"instruction": "Show me the implementation of the interface FormSubmitterInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Form;\n\n/**\n * Provides an interface for processing form submissions.\n */\ninterface FormSubmitterInterface {\n\n  /**\n   * Handles the submitted form, executing callbacks and processing responses.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return null|\\Symfony\\Component\\HttpFoundation\\Response\n   *   If a response was set by a submit handler, or if the form needs to\n   *   redirect, a Response object will be returned.\n   */\n  public function doSubmitForm(&$form, FormStateInterface &$form_state);\n\n  /**\n   * Executes custom submission handlers for a given form.\n   *\n   * Button-specific handlers are checked first. If none exist, the function\n   * falls back to form-level handlers.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form. If the user submitted the form by clicking\n   *   a button with custom handler functions defined, those handlers will be\n   *   stored here.\n   */\n  public function executeSubmitHandlers(&$form, FormStateInterface &$form_state);\n\n  /**\n   * Redirects the user to a URL after a form has been processed.\n   *\n   * After a form is submitted and processed, normally the user should be\n   * redirected to a new destination page. This function figures out what that\n   * destination should be, based on the $form_state and the 'destination'\n   * query string in the request URL, and redirects the user there.\n   *\n   * The result of \\Drupal\\Core\\Form|FormStateInterface::getRedirect()\n   * determines where to redirect the user. See the possible return values\n   * listed there. If the result is FALSE, then the user will not be redirected.\n   *\n   * Here is an example of how to set up a form to redirect to the path 'user':\n   * @code\n   * $form_state->setRedirect('user.page');\n   * @endcode\n   * And here is an example of how to redirect to 'node/123?foo=bar#baz':\n   * @code\n   * $form_state->setRedirect('entity.node.canonical',\n   *   ['node' => 123],\n   *   [\n   *     'query' => [\n   *       'foo' => 'bar',\n   *     ],\n   *     'fragment' => 'baz',\n   *   ],\n   * );\n   * @endcode\n   *\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   The current state of the form.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\RedirectResponse|null\n   *   The HTTP response if the form submission results in a redirect, otherwise\n   *   NULL.\n   *\n   * @see \\Drupal\\Core\\Form\\FormBuilderInterface::processForm()\n   * @see \\Drupal\\Core\\Form\\FormBuilderInterface::buildForm()\n   */\n  public function redirectForm(FormStateInterface $form_state);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Form/FormSubmitterInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FormSubmitterInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SeoAudit in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the SEO Audit module.\n */\n\n/**\n * Implements hook_install().\n */\nfunction seo_audit_install() {\n  \\Drupal::database()->schema()->createTable('seo_audit_crawl_result', [\n    'fields' => [\n      'id' => [\n        'type' => 'serial',\n        'not null' => TRUE,\n        'description' => 'Primary key for crawl results',\n      ],\n      'user_id' => [\n        'type' => 'int',\n        'not null' => TRUE,\n        'description' => 'User ID who submitted the crawl',\n      ],\n      'url' => [\n        'type' => 'varchar',\n        'length' => 255,\n        'not null' => TRUE,\n        'description' => 'The URL that was crawled',\n      ],\n      'results' => [\n        'type' => 'text',\n        'mysql_type' => 'mediumtext',\n        'not null' => TRUE,\n        'description' => 'Crawl results',\n      ],\n      'created' => [\n        'type' => 'int',\n        'not null' => TRUE,\n        'description' => 'Timestamp when the crawl was requested',\n      ],\n      'completed' => [\n        'type' => 'int',\n        'not null' => FALSE,\n        'description' => 'Timestamp when the crawl was completed',\n      ],\n      'status' => [\n        'type' => 'varchar',\n        'length' => 20,\n        'not null' => TRUE,\n        'default' => 'pending',\n        'description' => 'Status of the crawl (pending/completed)',\n      ],\n      'checked_options' => [\n        'type' => 'text',\n        'mysql_type' => 'mediumtext',\n        'not null' => TRUE,\n        'description' => 'JSON-encoded array of SEO checks enabled during this crawl',\n      ],\n    ],\n    'primary key' => ['id'],\n  ]);\n\n  \\Drupal::logger('seo_audit')->info(\"Created 'seo_audit_crawl_result' table.\");\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction seo_audit_uninstall() {\n  \\Drupal::database()->schema()->dropTable('seo_audit_crawl_result');\n  \\Drupal::logger('seo_audit')->info(\"Removed 'seo_audit_crawl_result' table.\");\n}\n", "metadata": {"source": "repos/seo_audit/seo_audit.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SeoAudit", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the class ScrollTopCommand in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * Provides an AJAX command for scrolling to the top of an element.\n *\n * This command is implemented in Drupal.AjaxCommands.prototype.scrollTop.\n */\nclass ScrollTopCommand implements CommandInterface {\n\n  /**\n   * A CSS selector string.\n   *\n   * @var string\n   */\n  protected $selector;\n\n  /**\n   * Constructs a \\Drupal\\Core\\Ajax\\ScrollTopCommand object.\n   *\n   * @param string $selector\n   *   A CSS selector.\n   */\n  public function __construct($selector) {\n    $this->selector = $selector;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(): array {\n    return [\n      'command' => 'scrollTop',\n      'selector' => $this->selector,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Ajax/ScrollTopCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ScrollTopCommand", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ImagePostUpdate in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Post-update functions for Image.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction image_removed_post_updates(): array {\n  return [\n    'image_post_update_image_style_dependencies' => '9.0.0',\n    'image_post_update_scale_and_crop_effect_add_anchor' => '9.0.0',\n    'image_post_update_image_loading_attribute' => '10.0.0',\n  ];\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/image.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImagePostUpdate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  dynamic_page_cache.skip_procedural_hook_scan: true\n\nservices:\n  _defaults:\n    autoconfigure: true\n  cache.dynamic_page_cache:\n    class: Drupal\\Core\\Cache\\CacheBackendInterface\n    tags:\n      - { name: cache.bin }\n    factory: ['@cache_factory', 'get']\n    arguments: [dynamic_page_cache]\n  variation_cache.dynamic_page_cache:\n    class: Drupal\\Core\\Cache\\VariationCacheInterface\n    factory: ['@variation_cache_factory', 'get']\n    arguments: [dynamic_page_cache]\n  dynamic_page_cache_subscriber:\n    class: Drupal\\dynamic_page_cache\\EventSubscriber\\DynamicPageCacheSubscriber\n    arguments: ['@dynamic_page_cache_request_policy', '@dynamic_page_cache_response_policy', '@variation_cache.dynamic_page_cache', '@cache_contexts_manager', '%renderer.config%']\n\n  # Request & response policies.\n  dynamic_page_cache_request_policy:\n    class: Drupal\\dynamic_page_cache\\PageCache\\RequestPolicy\\DefaultRequestPolicy\n    tags:\n      - { name: service_collector, tag: dynamic_page_cache_request_policy, call: addPolicy}\n  dynamic_page_cache_response_policy:\n    class: Drupal\\Core\\PageCache\\ChainResponsePolicy\n    tags:\n      - { name: service_collector, tag: dynamic_page_cache_response_policy, call: addPolicy}\n    lazy: true\n  dynamic_page_cache_deny_admin_routes:\n    class: Drupal\\dynamic_page_cache\\PageCache\\ResponsePolicy\\DenyAdminRoutes\n    arguments: ['@current_route_match']\n    public: false\n    tags:\n      - { name: dynamic_page_cache_response_policy }\n", "metadata": {"source": "repos/drupal_core/core/modules/dynamic_page_cache/dynamic_page_cache.services.yml", "type": "yaml_reference", "topic": "dynamic page cache.services"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ApiResponseReceivedEvent\nSource file: <source_file>\nFile name hint: ApiResponseReceivedEvent.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Event;\n\n/**\n * Event fired when an API response is successfully received.\n */\nclass ApiResponseReceivedEvent extends ApiResponseEvent {\n\n  /**\n   * Event name constant.\n   */\n  const EVENT_NAME = 'api_normalization.response_received';\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Event;\n\n/**\n * Event fired when an API response is successfully received.\n */\nclass ApiResponseReceivedEvent extends ApiResponseEvent {\n\n  /**\n   * Event name constant.\n   */\n  const EVENT_NAME = 'api_normalization.response_received';\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Event/ApiResponseReceivedEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiResponseReceivedEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the enum CommentPreviewMode in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\comment;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Utility\\OptionsEnumTrait;\n\n/**\n * Enumeration for comment preview modes.\n */\nenum CommentPreviewMode: int {\n\n  use OptionsEnumTrait;\n\n  case Disabled = 0;\n  case Optional = 1;\n  case Required = 2;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function label(): string|\\Stringable {\n    return match ($this) {\n      self::Disabled => new TranslatableMarkup('Disabled'),\n      self::Optional => new TranslatableMarkup('Optional'),\n      self::Required => new TranslatableMarkup('Required'),\n    };\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/CommentPreviewMode.php", "type": "code_reference", "symbol_kind": "enum", "symbol_name": "CommentPreviewMode", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: PermissionChecker\nSource file: <source_file>\nFile name hint: PermissionChecker.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Session;\n\n/**\n * Checks permissions for an account.\n */\nclass PermissionChecker implements PermissionCheckerInterface {\n\n  public function __construct(protected AccessPolicyProcessorInterface $processor) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasPermission(string $permission, AccountInterface $account): bool {\n    $item = $this->processor->processAccessPolicies($account)->getItem();\n    return $item && $item->hasPermission($permission);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Session;\n\n/**\n * Checks permissions for an account.\n */\nclass PermissionChecker implements PermissionCheckerInterface {\n\n  public function __construct(protected AccessPolicyProcessorInterface $processor) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasPermission(string $permission, AccountInterface $account): bool {\n    $item = $this->processor->processAccessPolicies($account)->getItem();\n    return $item && $item->hasPermission($permission);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Session/PermissionChecker.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PermissionChecker", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class MachineName in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\Component\\Transliteration\\TransliterationInterface;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\Attribute\\Autowire;\n\n/**\n * Creates a machine name.\n *\n * The machine_name process plugin takes the source value and turns it into a\n * machine-readable name via the following four steps:\n * 1. Language decorations and accents are removed by transliterating the source\n *    value.\n * 2. The resulting value is made lowercase.\n * 3. Any special characters are replaced with an underscore. By default,\n *    anything that is not a number or a letter is replaced, but additional\n *    characters can be allowed or further restricted by using the\n *    replace_pattern configuration as described below.\n * 4. Any duplicate underscores either in the source value or as a result of\n *    replacing special characters are removed.\n *\n * Available configuration keys:\n *   - replace_pattern: (optional) A custom regular expression pattern to\n *     replace special characters with an underscore using preg_replace(). This\n *     can be used to allow additional characters in the machine name.\n *     Defaults to /[^a-z0-9_]+/\n *\n * Example:\n *\n * @code\n * process:\n *   bar:\n *     plugin: machine_name\n *     source: foo\n * @endcode\n *\n * If the value of foo in the source is '\u00e1\u00e9\u00ed!' then the destination value of bar\n * will be 'aei_'.\n *\n * @code\n * process:\n *   bar:\n *     plugin: machine_name\n *     source: foo\n *     replace_pattern: '/[^a-z0-9_.]+/'\n * @endcode\n *\n * Here the replace pattern does not match the '.' character (as it is included\n * in the list of characters not to match) so if the value of foo in the source\n * is '\u00e1\u00e9\u00ed!.jpg' then the destination value of bar will be 'aei_.jpg'.\n *\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('machine_name')]\nclass MachineName extends ProcessPluginBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The transliteration service.\n   *\n   * @var \\Drupal\\Component\\Transliteration\\TransliterationInterface\n   */\n  protected $transliteration;\n\n  /**\n   * The regular expression pattern.\n   *\n   * @var string\n   */\n  protected $replacePattern;\n\n  /**\n   * Constructs a MachineName plugin.\n   *\n   * @param array $configuration\n   *   The plugin configuration.\n   * @param string $plugin_id\n   *   The plugin ID.\n   * @param mixed $plugin_definition\n   *   The plugin definition.\n   * @param \\Drupal\\Component\\Transliteration\\TransliterationInterface $transliteration\n   *   The transliteration service.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    #[Autowire(service: 'transliteration')]\n    TransliterationInterface $transliteration,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->transliteration = $transliteration;\n\n    $this->replacePattern = $this->configuration['replace_pattern'] ?? '/[^a-z0-9_]+/';\n    if (!is_string($this->replacePattern)) {\n      throw new MigrateException('The replace pattern should be a string');\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    $new_value = $this->transliteration->transliterate($value, LanguageInterface::LANGCODE_DEFAULT, '_');\n    $new_value = strtolower($new_value);\n    $new_value = preg_replace($this->replacePattern, '_', $new_value);\n    return preg_replace('/_+/', '_', $new_value);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/MachineName.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MachineName", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class UserHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Hook;\n\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\flowdrop_trigger\\Service\\TriggerManager;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Implements user hooks for FlowDrop ecosystem.\n */\nclass UserHooks {\n\n  /**\n   * Constructs a new UserHooks object.\n   */\n  public function __construct(\n    readonly protected TriggerManager $triggerEvent,\n    readonly protected EntityTypeManagerInterface $entityTypeManager,\n  ) {}\n\n  /**\n   * Implements hook_user_login().\n   */\n  #[Hook('user_login')]\n  public function userLogin(UserInterface $account): void {\n    $this->triggerEvent->processEvent('user.login', $account);\n  }\n\n  /**\n   * Implements hook_user_logout().\n   */\n  #[Hook('user_logout')]\n  public function userLogout(AccountInterface $account): void {\n    $user = $this\n      ->entityTypeManager\n      ->getStorage('user')\n      ->load($account->id());\n    $this->triggerEvent->processEvent('user.logout', $user);\n  }\n\n  /**\n   * Implements hook_user_cancel().\n   */\n  #[Hook('user_cancel')]\n  public function userCancel(array $edit, UserInterface $account, string $method): void {\n    $this->triggerEvent->processEvent('user.cancel', $account);\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Hook/UserHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ExternallyDefined in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_layout\\PintoLayout\\External;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\pinto_layout\\Attribute\\Regions;\nuse Drupal\\pinto_layout\\Discovery\\FrozenLayoutDefinition;\nuse Drupal\\pinto_layout\\Discovery\\PintoLayoutDiscovery;\n\nfinal class ExternallyDefined {\n\n  /**\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   * @phpstan-param class-string<object> $component\n   */\n  private function __construct(\n    private string $id,\n    private TranslatableMarkup $label,\n    private readonly string $component,\n    private readonly Regions $regions,\n    private \\ReflectionMethod $factoryMethod,\n    public array $forms,\n  ) {\n  }\n\n  /**\n   * @phpstan-param Regions|list<string|\\Drupal\\pinto_layout\\Attribute\\Region> $regions\n   * @phpstan-param callable|callable-string $factoryMethod\n   * @phpstan-param array<string, class-string<\\Drupal\\Core\\Plugin\\PluginFormInterface>> $forms\n   * @phpstan-param class-string<object> $component\n   */\n  public static function create(\n    string $id,\n    TranslatableMarkup $label,\n    string $component,\n    Regions|array $regions,\n    callable|string $factoryMethod,\n    array $forms = [],\n  ): static {\n    /** @var array|string|\\Closure $factoryMethod */\n    // @phpstan-ignore-next-line varTag.nativeType\n    if ($factoryMethod instanceof \\Closure) {\n      throw new \\Exception('$factoryMethod must be statically callable.');\n    }\n\n    $rMethod = \\is_array($factoryMethod)\n      ? new \\ReflectionMethod($factoryMethod[0], $factoryMethod[1])\n      : \\ReflectionMethod::createFromMethodName($factoryMethod);\n\n    return new static(\n      id: $id,\n      label: $label,\n      component: $component,\n      regions: \\is_array($regions) ? new Regions(regions: $regions) : $regions,\n      factoryMethod: $rMethod,\n      forms: $forms,\n    );\n  }\n\n  /**\n   * @internal\n   */\n  public function freeze(): FrozenLayoutDefinition {\n    $args = PintoLayoutDiscovery::determineFactoryMethod(\n      $this->factoryMethod->getDeclaringClass(),\n      $this->factoryMethod,\n    );\n\n    return new FrozenLayoutDefinition(\n      $this->id,\n      $this->label,\n      $this->component,\n      $this->regions,\n      ...[\n        ...$args,\n        ...['forms' => $this->forms],\n      ],\n    );\n  }\n\n}\n", "metadata": {"source": "repos/pinto_layout/src/PintoLayout/External/ExternallyDefined.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExternallyDefined", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BcRoute in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Routing;\n\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * A backwards compatibility route.\n *\n * When a route is deprecated for another one, and backwards compatibility is\n * provided, then it's best practice to:\n * - not duplicate all route definition metadata, to instead have an \"as empty\n *   as possible\" route\n * - have an accompanying outbound route processor, that overwrites this empty\n *   route definition with the redirected route's definition.\n *\n * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use route\n * aliases instead.\n *\n * @see https://www.drupal.org/node/3317784\n */\nclass BcRoute extends Route {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct() {\n    parent::__construct('');\n    $this->setOption('bc_route', TRUE);\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use route aliases instead. See https://www.drupal.org/node/3317784', E_USER_DEPRECATED);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Routing/BcRoute.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BcRoute", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BookBreadcrumbBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book;\n\nuse Drupal\\Core\\Breadcrumb\\Breadcrumb;\nuse Drupal\\Core\\Breadcrumb\\BreadcrumbBuilderInterface;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Link;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Provides a breadcrumb builder for nodes in a book.\n */\nclass BookBreadcrumbBuilder implements BreadcrumbBuilderInterface {\n  use StringTranslationTrait;\n\n  /**\n   * The node storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected EntityStorageInterface $nodeStorage;\n\n  /**\n   * Constructs the BookBreadcrumbBuilder.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager service.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The current user account.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entityRepository\n   *   The entity repository service.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $languageManager\n   *   The language manager service.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   */\n  public function __construct(\n    EntityTypeManagerInterface $entity_type_manager,\n    protected AccountInterface $account,\n    protected EntityRepositoryInterface $entityRepository,\n    protected LanguageManagerInterface $languageManager,\n  ) {\n    $this->nodeStorage = $entity_type_manager->getStorage('node');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies(RouteMatchInterface $route_match, ?CacheableMetadata $cacheable_metadata = NULL): bool {\n    // @todo Remove null safe operator after Drupal 12.0.0 becomes the minimum\n    //   requirement, see https://www.drupal.org/project/drupal/issues/3459277.\n    $cacheable_metadata?->addCacheContexts(['route.book_navigation']);\n    $node = $route_match->getParameter('node');\n    return $node instanceof NodeInterface && !empty($node->getBook());\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function build(RouteMatchInterface $route_match): Breadcrumb {\n    $book_nids = [];\n    $breadcrumb = new Breadcrumb();\n\n    $links = [Link::createFromRoute($this->t('Home'), '<front>', [], [\n      'language' => $this->languageManager->getCurrentLanguage(LanguageInterface::TYPE_CONTENT),\n    ]),\n    ];\n    $breadcrumb->addCacheContexts(['languages:' . LanguageInterface::TYPE_CONTENT]);\n    $book = $route_match->getParameter('node')->getBook();\n    $depth = 1;\n    // We skip the current node.\n    while (!empty($book['p' . ($depth + 1)])) {\n      $book_nids[] = $book['p' . $depth];\n      $depth++;\n    }\n    /** @var \\Drupal\\node\\NodeInterface[] $parent_books */\n    $parent_books = $this->nodeStorage->loadMultiple($book_nids);\n    $parent_books = array_map([$this->entityRepository, 'getTranslationFromContext'], $parent_books);\n    if (count($parent_books) > 0) {\n      $depth = 1;\n      while (!empty($book['p' . ($depth + 1)])) {\n        if (!empty($parent_books[$book['p' . $depth]]) && ($parent_book = $parent_books[$book['p' . $depth]])) {\n          $access = $parent_book->access('view', $this->account, TRUE);\n          $breadcrumb->addCacheableDependency($access);\n          if ($access->isAllowed()) {\n            $breadcrumb->addCacheableDependency($parent_book);\n            $links[] = $parent_book->toLink();\n          }\n        }\n        $depth++;\n      }\n    }\n    $breadcrumb->setLinks($links);\n    // @todo Remove after Drupal 12.0.0 becomes the minimum requirement,\n    //   see https://www.drupal.org/project/drupal/issues/3459277.\n    $breadcrumb->addCacheContexts(['route.book_navigation']);\n    return $breadcrumb;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/BookBreadcrumbBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookBreadcrumbBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: DocumentLoaderInterface.php\nTarget symbol: interface DocumentLoaderInterface\nNamespace: Drupal\\document_loader\\Plugin\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for DocumentLoaderInterface.\n- Include required imports:\n  - Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderInputInterface\n  - Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface\n- Ensure these methods exist where relevant:\n  - getSupportedDocumentLoaderTypes()\n  - getSupportedOutputTypes()\n  - load()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\document_loader\\Plugin;\n\nuse Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderInputInterface;\nuse Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface;\n\n/**\n * Interface for document loader plugins.\n */\ninterface DocumentLoaderInterface {\n\n  /**\n   * Loads a document and returns the output.\n   *\n   * @param \\Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderInputInterface $input\n   *   The input for the document loader.\n   *\n   * @return \\Drupal\\document_loader\\DocumentLoaderType\\DocumentLoaderOutputInterface\n   *   The loaded document output.\n   *\n   * @throws \\Exception\n   *   If the document cannot be loaded.\n   */\n  public function load(DocumentLoaderInputInterface $input): DocumentLoaderOutputInterface;\n\n  /**\n   * Gets the supported output types for this loader.\n   *\n   * @return string[]\n   *   An array of supported output type IDs.\n   */\n  public function getSupportedOutputTypes(): array;\n\n  /**\n   * Gets the supported document loader types for this loader.\n   *\n   * @return string[]\n   *   An array of supported document loader type IDs.\n   */\n  public function getSupportedDocumentLoaderTypes(): array;\n\n}\n", "metadata": {"source": "repos/document_loader/src/Plugin/DocumentLoaderInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DocumentLoaderInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class ContactCategory in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\contact\\Plugin\\migrate\\source;\n\nuse Drupal\\migrate\\Row;\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\DrupalSqlBase;\n\n/**\n * Drupal 6/7 contact category source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"contact_category\",\n *   source_module = \"contact\"\n * )\n */\nclass ContactCategory extends DrupalSqlBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $query = $this->select('contact', 'c')\n      ->fields('c', [\n        'cid',\n        'category',\n        'recipients',\n        'reply',\n        'weight',\n        'selected',\n      ]\n    );\n    $query->orderBy('c.cid');\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareRow(Row $row) {\n    $row->setSourceProperty('recipients', explode(',', $row->getSourceProperty('recipients')));\n    return parent::prepareRow($row);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    return [\n      'cid' => $this->t('Primary Key: Unique category ID.'),\n      'category' => $this->t('Category name.'),\n      'recipients' => $this->t('Comma-separated list of recipient email addresses.'),\n      'reply' => $this->t('Text of the auto-reply message.'),\n      'weight' => $this->t(\"The category's weight.\"),\n      'selected' => $this->t('Flag to indicate whether or not category is selected by default. (1 = Yes, 0 = No)'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['cid']['type'] = 'integer';\n    return $ids;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/contact/src/Plugin/migrate/source/ContactCategory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContactCategory", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CategoryAutocompleteController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block\\Controller;\n\nuse Drupal\\Component\\Utility\\Html;\nuse Drupal\\Core\\Block\\BlockManagerInterface;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Returns autocomplete responses for block categories.\n */\nclass CategoryAutocompleteController implements ContainerInjectionInterface {\n\n  /**\n   * The block manager.\n   *\n   * @var \\Drupal\\Core\\Block\\BlockManagerInterface\n   */\n  protected $blockManager;\n\n  /**\n   * Constructs a new CategoryAutocompleteController.\n   *\n   * @param \\Drupal\\Core\\Block\\BlockManagerInterface $block_manager\n   *   The block manager.\n   */\n  public function __construct(BlockManagerInterface $block_manager) {\n    $this->blockManager = $block_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('plugin.manager.block')\n    );\n  }\n\n  /**\n   * Retrieves suggestions for block category autocompletion.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\JsonResponse\n   *   A JSON response containing autocomplete suggestions.\n   */\n  public function autocomplete(Request $request) {\n    $typed_category = $request->query->get('q');\n    $matches = [];\n    foreach ($this->blockManager->getCategories() as $category) {\n      if (stripos($category, $typed_category) === 0) {\n        $matches[] = ['value' => $category, 'label' => Html::escape($category)];\n      }\n    }\n    return new JsonResponse($matches);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block/src/Controller/CategoryAutocompleteController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CategoryAutocompleteController", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SettingsForm.php\nTarget symbol: class SettingsForm\nNamespace: Drupal\\pantheon_si_tokens\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SettingsForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - buildForm()\n  - getEditableConfigNames()\n  - getFormId()\n  - submitForm()\n  - validateForm()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pantheon_si_tokens\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configure Pantheon SI Tokens settings.\n */\nclass SettingsForm extends ConfigFormBase\n{\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array\n  {\n    return ['pantheon_si_tokens.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string\n  {\n    return 'pantheon_si_tokens_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(\n    array $form,\n    FormStateInterface $form_state,\n  ): array {\n    $config = $this->config('pantheon_si_tokens.settings');\n    $constants = $config->get('constants') ?? [];\n\n    $form['description'] = [\n      '#type' => 'markup',\n      '#markup' => $this->t(\n        'Configure which Pantheon Secure Integration PHP ' .\n        'constants to expose as tokens. Constants should be in ' .\n        'the format PANTHEON_SOIP_SERVICENAME.',\n      ),\n    ];\n\n    $form['constants'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('PHP Constants'),\n      '#description' => $this->t(\n        'Enter one PHP constant name per line. Example: PANTHEON_SOIP_LDAP',\n      ),\n      '#default_value' => implode(\"\\n\", $constants),\n      '#rows' => 10,\n    ];\n\n    $form['token_help'] = [\n      '#type' => 'markup',\n      '#markup' => $this->t(\n        '<p><strong>Token format:</strong> Constants will be ' .\n        'available as <code>[pantheon_si_tunnel:' .\n        'constant_name_lowercase]</code></p><p>Example: ' .\n        '<code>PANTHEON_SOIP_LDAP</code> becomes ' .\n        '<code>[pantheon_si_tunnel:pantheon_soip_ldap]</code></p>',\n      ),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(\n    array &$form,\n    FormStateInterface $form_state,\n  ): void {\n    parent::validateForm($form, $form_state);\n\n    $constants_text = $form_state->getValue('constants');\n    $constants = array_filter(\n      array_map('trim', explode(\"\\n\", $constants_text)),\n    );\n\n    foreach ($constants as $constant) {\n      if (!str_starts_with($constant, 'PANTHEON_SOIP_')) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" must start with \"PANTHEON_SOIP_\". ' .\n            'This module only exposes Pantheon Secure Integration ' .\n            'tunnel constants.',\n            ['@constant' => $constant],\n          ),\n        );\n        continue;\n      }\n\n      if (!defined($constant)) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" is not defined. Ensure Pantheon ' .\n            'Secure Integration is configured and the constant name ' .\n            'is spelled correctly.',\n            ['@constant' => $constant],\n          ),\n        );\n        continue;\n      }\n\n      $value = constant($constant);\n\n      if (!is_int($value) && !ctype_digit((string) $value)) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" has value \"@value\" which is not ' .\n            'an integer. Pantheon SI tunnel constants must contain ' .\n            'port numbers.',\n            [\n              '@constant' => $constant,\n              '@value' => is_scalar($value) ? $value : gettype($value),\n            ],\n          ),\n        );\n        continue;\n      }\n\n      $port = (int) $value;\n      if ($port < 1 || $port > 65535) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" has value @port which is outside ' .\n            'the valid port range (1-65535).',\n            [\n              '@constant' => $constant,\n              '@port' => $port,\n            ],\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(\n    array &$form,\n    FormStateInterface $form_state,\n  ): void {\n    $constants_text = $form_state->getValue('constants');\n    $constants = array_filter(\n      array_map('trim', explode(\"\\n\", $constants_text)),\n    );\n\n    $this->config('pantheon_si_tokens.settings')\n      ->set('constants', array_values($constants))\n      ->save();\n\n    \\Drupal::service('cache_tags.invalidator')->invalidateTags([\n      'token_info',\n    ]);\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/pantheon_si_tokens/src/Form/SettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SettingsForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Preview library for LightGallery profile forms.\n# Uses the main React-based gallery library for rendering.\npreview:\n  version: '1.x'\n  css:\n    component:\n      css/lightgallery_formatter.preview.css: { preprocess: false }\n  dependencies:\n    - core/drupal\n    - core/drupal.ajax\n    - lightgallery_formatter/gallery\n", "metadata": {"source": "repos/lightgallery_formatter/modules/lightgallery_formatter_preview/lightgallery_formatter_preview.libraries.yml", "type": "yaml_reference", "topic": "lightgallery formatter preview.libraries"}}
{"instruction": "Show me the implementation of the class SoapServiceForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Form;\n\nuse Drupal\\Core\\Entity\\EntityForm;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form handler for SOAP Service add and edit forms.\n */\nclass SoapServiceForm extends EntityForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(\n    array $form,\n    FormStateInterface $form_state,\n  ): array {\n    $soap_service = $this->entity;\n    $ports = $soap_service->ports();\n    return [\n      ...parent::form($form, $form_state),\n      'label' => [\n        '#type' => 'textfield',\n        '#title' => $this->t('Label'),\n        '#maxlength' => 255,\n        '#default_value' => $soap_service->label(),\n        '#description' => $this->t('Label for the SOAP service.'),\n        '#required' => TRUE,\n      ],\n      'id' => [\n        '#type' => 'machine_name',\n        '#default_value' => $soap_service->id(),\n        '#machine_name' => [\n          'exists' => [\n            '\\Drupal\\soap_client\\Entity\\SoapService',\n            'load',\n          ],\n        ],\n        '#disabled' => !$soap_service->isNew(),\n      ],\n      'endpoint' => [\n        '#type' => 'url',\n        '#title' => $this->t('Endpoint URL'),\n        '#default_value' => $soap_service->endpoint(),\n        '#description' => $this->t('The SOAP service endpoint URL.'),\n        '#required' => TRUE,\n      ],\n      'namespace' => [\n        '#type' => 'textfield',\n        '#title' => $this->t('Namespace'),\n        '#maxlength' => 255,\n        '#default_value' => $soap_service->namespace(),\n        '#description' => $this->t('The target namespace for the service.'),\n      ],\n      'ports' => [\n        '#type' => 'details',\n        '#title' => $this->t('Available Ports'),\n        '#open' => TRUE,\n        ...(!empty($ports)\n          ? [\n            'list' => [\n              '#type' => 'table',\n              '#header' => [\n                $this->t('Port Name'),\n                $this->t('Binding'),\n                $this->t('Endpoint'),\n              ],\n              '#rows' => array_map(\n                fn($port) => [\n                  $port['name'] ?? '',\n                  $port['binding'] ?? '',\n                  $port['endpoint'] ?? '',\n                ],\n                $ports,\n              ),\n            ],\n          ]\n          : [\n            'empty' => [\n              '#markup' => '<p>' . $this->t('No ports defined.') . '</p>',\n            ],\n          ]\n        ),\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state): int {\n    $soap_service = $this->entity;\n    $status = $soap_service->save();\n    $message = $this->t('@verb the %label SOAP service.', [\n      '@verb' => $status === SAVED_NEW ? 'Created' : 'Updated',\n      '%label' => $soap_service->label(),\n    ]);\n    $this->messenger()->addStatus($message);\n    $form_state->setRedirectUrl($soap_service->toUrl('collection'));\n    return $status;\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/src/Form/SoapServiceForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapServiceForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DefaultSingleLazyPluginCollection in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\PluginManagerInterface;\nuse Drupal\\Component\\Plugin\\LazyPluginCollection;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\n\n/**\n * Provides a default plugin collection for a plugin type.\n *\n * A plugin collection usually stores multiple plugins, and is used to lazily\n * instantiate them. When only one plugin is needed, it is still best practice\n * to encapsulate all of the instantiation logic in a plugin collection. This\n * class can be used directly, or subclassed to add further exception handling\n * in self::initializePlugin().\n */\nclass DefaultSingleLazyPluginCollection extends LazyPluginCollection {\n  use DependencySerializationTrait;\n\n  /**\n   * The manager used to instantiate the plugins.\n   *\n   * @var \\Drupal\\Component\\Plugin\\PluginManagerInterface\n   */\n  protected $manager;\n\n  /**\n   * An array of configuration to instantiate the plugin with.\n   *\n   * @var array\n   */\n  protected $configuration;\n\n  /**\n   * The instance ID used for this plugin collection.\n   *\n   * @var string\n   */\n  protected $instanceId;\n\n  /**\n   * Constructs a new DefaultSingleLazyPluginCollection object.\n   *\n   * @param \\Drupal\\Component\\Plugin\\PluginManagerInterface $manager\n   *   The manager to be used for instantiating plugins.\n   * @param string $instance_id\n   *   The ID of the plugin instance.\n   * @param array $configuration\n   *   An array of configuration.\n   */\n  public function __construct(PluginManagerInterface $manager, $instance_id, array $configuration) {\n    $this->manager = $manager;\n    $this->addInstanceId($instance_id, $configuration);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function initializePlugin($instance_id) {\n    $this->set($instance_id, $this->manager->createInstance($instance_id, $this->configuration));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfiguration() {\n    $plugin = $this->get($this->instanceId);\n    if ($plugin instanceof ConfigurableInterface) {\n      return $plugin->getConfiguration();\n    }\n    else {\n      return $this->configuration;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setConfiguration(array $configuration) {\n    $this->configuration = $configuration;\n    $plugin = $this->get($this->instanceId);\n    if ($plugin instanceof ConfigurableInterface) {\n      $plugin->setConfiguration($configuration);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addInstanceId($id, $configuration = NULL) {\n    $this->instanceId = $id;\n    // Reset the list of instance IDs since there can be only one.\n    $this->instanceIds = [];\n    parent::addInstanceId($id, $configuration);\n    if ($configuration !== NULL) {\n      $this->setConfiguration($configuration);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/DefaultSingleLazyPluginCollection.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DefaultSingleLazyPluginCollection", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface CommentItemInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\comment\\Plugin\\Field\\FieldType;\n\n/**\n * Interface definition for Comment items.\n */\ninterface CommentItemInterface {\n\n  /**\n   * Comments for this entity are hidden.\n   */\n  const HIDDEN = 0;\n\n  /**\n   * Comments for this entity are closed.\n   */\n  const CLOSED = 1;\n\n  /**\n   * Comments for this entity are open.\n   */\n  const OPEN = 2;\n\n  /**\n   * Comment form should be displayed on a separate page.\n   */\n  const FORM_SEPARATE_PAGE = 0;\n\n  /**\n   * Comment form should be shown below post or list of comments.\n   */\n  const FORM_BELOW = 1;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/Plugin/Field/FieldType/CommentItemInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CommentItemInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LanguageEditForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\language\\Form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Controller for language edit forms.\n *\n * @internal\n */\nclass LanguageEditForm extends LanguageFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    // @todo Remove in favor of base method.\n    return 'language_admin_edit_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    $this->commonForm($form);\n    return parent::form($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function actions(array $form, FormStateInterface $form_state) {\n    $actions['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Save language'),\n      '#validate' => ['::validateCommon'],\n      '#submit' => ['::submitForm', '::save'],\n    ];\n    return $actions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    parent::save($form, $form_state);\n    $form_state->setRedirectUrl($this->entity->toUrl('collection'));\n    $this->logger('language')\n      ->notice('The %language (%langcode) language has been updated.', [\n        '%language' => $this->entity->label(),\n        '%langcode' => $this->entity->id(),\n      ]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/language/src/Form/LanguageEditForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageEditForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GetRecipe in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_recipes\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_recipes\\Service\\RecipesService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_recipes_get',\n  label: new TranslatableMarkup('Get Recipe'),\n  description: new TranslatableMarkup('Get detailed information about a specific Drupal Recipe including modules, config, and dependencies.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'recipe_name' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Recipe Name'),\n      description: new TranslatableMarkup('The machine name (directory name) of the recipe.'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'name' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Recipe Name'),\n      description: new TranslatableMarkup('Machine name of the recipe.'),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Recipe Label'),\n      description: new TranslatableMarkup('Human-readable name of the recipe.'),\n    ),\n    'description' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Description'),\n      description: new TranslatableMarkup('Recipe description.'),\n    ),\n    'type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Type'),\n      description: new TranslatableMarkup('Recipe type (e.g., Site, Theme).'),\n    ),\n    'path' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Path'),\n      description: new TranslatableMarkup('Filesystem path to the recipe.'),\n    ),\n    'install' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Modules to Install'),\n      description: new TranslatableMarkup('List of modules that will be installed.'),\n    ),\n    'config' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Configuration'),\n      description: new TranslatableMarkup('Configuration imports and actions.'),\n    ),\n    'recipes' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Recipe Dependencies'),\n      description: new TranslatableMarkup('Other recipes this recipe depends on.'),\n    ),\n    'files' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Recipe Files'),\n      description: new TranslatableMarkup('List of files in the recipe directory.'),\n    ),\n  ],\n)]\nclass GetRecipe extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'recipes';\n\n\n  /**\n   * The recipes service.\n   */\n  protected RecipesService $recipesService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->recipesService = $container->get('mcp_tools_recipes.recipes');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $recipeName = $input['recipe_name'] ?? '';\n\n    if (empty($recipeName)) {\n      return [\n        'success' => FALSE,\n        'error' => 'Recipe name is required.',\n      ];\n    }\n\n    return $this->recipesService->getRecipe($recipeName);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_recipes/src/Plugin/tool/Tool/GetRecipe.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GetRecipe", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LayoutDiscoveryHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_discovery\\Hook;\n\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Hook implementations for layout_discovery.\n */\nclass LayoutDiscoveryHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name): ?string {\n    switch ($route_name) {\n      case 'help.page.layout_discovery':\n        $output = '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('Layout Discovery allows modules or themes to register layouts, and for other modules to list the available layouts and render them.') . '</p>';\n        $output .= '<p>' . $this->t('For more information, see the <a href=\":layout-discovery-documentation\">online documentation for the Layout Discovery module</a>.', [\n          ':layout-discovery-documentation' => 'https://www.drupal.org/docs/8/api/layout-api',\n        ]) . '</p>';\n        return $output;\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_discovery/src/Hook/LayoutDiscoveryHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LayoutDiscoveryHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BasicRecursiveValidatorFactory in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Validation;\n\nuse Drupal\\Core\\DependencyInjection\\ClassResolverInterface;\nuse Symfony\\Component\\Validator\\Mapping\\Factory\\LazyLoadingMetadataFactory;\nuse Symfony\\Component\\Validator\\Validator\\RecursiveValidator;\n\n/**\n * A factory for creating Symfony recursive validators.\n */\nclass BasicRecursiveValidatorFactory {\n\n  /**\n   * Constructs a new RecursiveValidatorFactory.\n   *\n   * @param \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface $classResolver\n   *   The class resolver.\n   */\n  public function __construct(\n    protected readonly ClassResolverInterface $classResolver,\n  ) {}\n\n  /**\n   * Creates a new RecursiveValidator.\n   *\n   * @return \\Symfony\\Component\\Validator\\Validator\\RecursiveValidator\n   *   The validator.\n   */\n  public function createValidator(): RecursiveValidator {\n    return new RecursiveValidator(\n      new ExecutionContextFactory(new DrupalTranslator()),\n      new LazyLoadingMetadataFactory(),\n      new ConstraintValidatorFactory($this->classResolver),\n    );\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Validation/BasicRecursiveValidatorFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BasicRecursiveValidatorFactory", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PintoEntityCompilerPass in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity\\DependencyInjection;\n\nuse Drupal\\pinto\\PintoMappingFactory;\nuse Drupal\\pinto_entity\\EntityView\\Attribute\\EntityView;\nuse Pinto\\Attribute\\Definition;\nuse Symfony\\Component\\DependencyInjection\\Compiler\\CompilerPassInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerBuilder;\n\n/**\n * @phpstan-type PintoEntityMapping array<array{\n *   \\Drupal\\pinto_entity\\EntityView\\Bundle,\n *   \\Drupal\\pinto_entity\\EntityView\\ViewMode,\n *   string,\n *   string[],\n *   string[],\n * }>\n */\nfinal class PintoEntityCompilerPass implements CompilerPassInterface {\n\n  public function process(ContainerBuilder $container): void {\n    /** @var array<class-string<\\Pinto\\List\\ObjectListInterface>> $enumClasses */\n    $enumClasses = $container->getDefinition(PintoMappingFactory::class)->getArgument('$enumClasses');\n\n    /** @var PintoEntityMapping $mapping */\n    $mapping = [];\n    foreach ($enumClasses as $enumClass) {\n      foreach ($enumClass::cases() as $case) {\n        $rCase = new \\ReflectionEnumUnitCase($case::class, $case->name);\n        $definitionAttr = ($rCase->getAttributes(Definition::class)[0] ?? NULL)?->newInstance();\n        if (NULL !== $definitionAttr) {\n          $componentClass = $definitionAttr->className;\n\n          $rClass = new \\ReflectionClass($componentClass);\n\n          \\array_push($mapping, ...\\iterator_to_array(EntityView::findOnClass($rClass, [$componentClass])));\n        }\n\n      }\n    }\n\n    // Serialize until https://www.drupal.org/project/drupal/issues/3522410 is resolved.\n    $container->setParameter('pinto_entity.mapping', \\serialize($mapping));\n  }\n\n}\n", "metadata": {"source": "repos/pinto_entity/src/DependencyInjection/PintoEntityCompilerPass.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PintoEntityCompilerPass", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ContextHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin\\Context;\n\nuse Drupal\\Component\\Plugin\\Definition\\ContextAwarePluginDefinitionInterface;\nuse Drupal\\Component\\Plugin\\Exception\\ContextException;\nuse Drupal\\Component\\Plugin\\Exception\\MissingValueContextException;\nuse Drupal\\Core\\Cache\\CacheableDependencyInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginInterface;\n\n/**\n * Provides methods to handle sets of contexts.\n */\nclass ContextHandler implements ContextHandlerInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function filterPluginDefinitionsByContexts(array $contexts, array $definitions) {\n    $checked_requirements = [];\n    return array_filter($definitions, function ($plugin_definition) use ($contexts, &$checked_requirements) {\n      $context_definitions = $this->getContextDefinitions($plugin_definition);\n      if ($context_definitions) {\n        // Generate a unique key for the current context definitions. This will\n        // allow calling checkRequirements() once for all plugins that have the\n        // same context definitions.\n        $context_definitions_key = hash('sha256', serialize($context_definitions));\n        if (!isset($checked_requirements[$context_definitions_key])) {\n          // Check the set of contexts against the requirements.\n          $checked_requirements[$context_definitions_key] = $this->checkRequirements($contexts, $context_definitions);\n        }\n        return $checked_requirements[$context_definitions_key];\n      }\n      // If this plugin doesn't need any context, it is available to use.\n      return TRUE;\n    });\n  }\n\n  /**\n   * Returns the context definitions associated with a plugin definition.\n   *\n   * @param array|\\Drupal\\Component\\Plugin\\Definition\\ContextAwarePluginDefinitionInterface $plugin_definition\n   *   The plugin definition.\n   *\n   * @return \\Drupal\\Component\\Plugin\\Context\\ContextDefinitionInterface[]|null\n   *   The context definitions, or NULL if the plugin definition does not\n   *   support contexts.\n   */\n  protected function getContextDefinitions($plugin_definition) {\n    if ($plugin_definition instanceof ContextAwarePluginDefinitionInterface) {\n      return $plugin_definition->getContextDefinitions();\n    }\n    if (is_array($plugin_definition) && isset($plugin_definition['context_definitions'])) {\n      return $plugin_definition['context_definitions'];\n    }\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function checkRequirements(array $contexts, array $requirements) {\n    foreach ($requirements as $requirement) {\n      if ($requirement->isRequired() && !$this->getMatchingContexts($contexts, $requirement)) {\n        return FALSE;\n      }\n    }\n    return TRUE;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMatchingContexts(array $contexts, ContextDefinitionInterface $definition) {\n    return array_filter($contexts, function (ContextInterface $context) use ($definition) {\n      return $definition->isSatisfiedBy($context);\n    });\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applyContextMapping(ContextAwarePluginInterface $plugin, $contexts, $mappings = []) {\n    /** @var \\Drupal\\Core\\Plugin\\Context\\ContextInterface[] $contexts */\n    $mappings += $plugin->getContextMapping();\n    // Loop through each of the expected contexts.\n\n    $missing_value = [];\n\n    foreach ($plugin->getContextDefinitions() as $plugin_context_id => $plugin_context_definition) {\n      // If this context was given a specific name, use that.\n      $context_id = $mappings[$plugin_context_id] ?? $plugin_context_id;\n      if (!empty($contexts[$context_id])) {\n        // This assignment has been used, remove it.\n        unset($mappings[$plugin_context_id]);\n\n        // Plugins have their on context objects, only the value is applied.\n        // They also need to know about the cacheability metadata of where that\n        // value is coming from, so pass them through to those objects.\n        $plugin_context = $plugin->getContext($plugin_context_id);\n        if ($plugin_context instanceof ContextInterface && $contexts[$context_id] instanceof CacheableDependencyInterface) {\n          $plugin_context->addCacheableDependency($contexts[$context_id]);\n        }\n\n        // Pass the value to the plugin if there is one.\n        if ($contexts[$context_id]->hasContextValue()) {\n          $plugin->setContext($plugin_context_id, $contexts[$context_id]);\n        }\n        elseif ($plugin_context_definition->isRequired()) {\n          // Collect required contexts that exist but are missing a value.\n          $missing_value[] = $plugin_context_id;\n        }\n\n        // Proceed to the next definition.\n        continue;\n      }\n\n      try {\n        $context = $plugin->getContext($context_id);\n      }\n      catch (ContextException) {\n        $context = NULL;\n      }\n\n      if ($context && $context->hasContextValue()) {\n        // Ignore mappings if the plugin has a value for a missing context.\n        unset($mappings[$plugin_context_id]);\n        continue;\n      }\n\n      if ($plugin_context_definition->isRequired()) {\n        // Collect required contexts that are missing.\n        $missing_value[] = $plugin_context_id;\n        continue;\n      }\n\n      // Ignore mappings for optional missing context.\n      unset($mappings[$plugin_context_id]);\n    }\n\n    // If there are any mappings that were not satisfied, throw an exception.\n    // This is a more severe problem than missing values, so check and throw\n    // this first.\n    if (!empty($mappings)) {\n      throw new ContextException('Assigned contexts were not satisfied: ' . implode(',', array_keys($mappings)));\n    }\n\n    // If there are any required contexts without a value, throw an exception.\n    if ($missing_value) {\n      throw new MissingValueContextException($missing_value);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/Context/ContextHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContextHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ApiToAgentContextService\nSource file: <source_file>\nFile name hint: ApiToAgentContextService.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Service;\n\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse GuzzleHttp\\ClientInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Converts API responses to agent-consumable context.\n */\nfinal class ApiToAgentContextService {\n\n  /**\n   * Constructs an ApiToAgentContextService object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\GuzzleHttp\\ClientInterface $httpClient\n   *   The HTTP client.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger channel.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly ClientInterface $httpClient,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * Transforms API response data for agent consumption.\n   *\n   * @param array<string, mixed> $responseData\n   *   The raw API response data.\n   * @param string $format\n   *   The desired output format (text, json, structured).\n   * @param int $maxTokens\n   *   Maximum tokens to include in output.\n   *\n   * @return array<string, mixed>\n   *   Transformed data suitable for agent context.\n   */\n  public function transformResponse(array $responseData, string $format = 'structured', int $maxTokens = 2000): array {\n    try {\n      return match ($format) {\n        'text' => $this->transformToText($responseData, $maxTokens),\n        'json' => $this->transformToJson($responseData, $maxTokens),\n        'structured' => $this->transformToStructured($responseData, $maxTokens),\n        default => ['error' => 'Unknown format'],\n      };\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to transform response: @message', [\n        '@message' => $e->getMessage(),\n      ]);\n      return ['error' => $e->getMessage()];\n    }\n  }\n\n  /**\n   * Transforms response to plain text format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   Text-formatted response.\n   */\n  private function transformToText(array $data, int $maxTokens): array {\n    $text = $this->flattenArray($data);\n    $text = $this->truncateToTokenLimit($text, $maxTokens);\n\n    return [\n      'format' => 'text',\n      'content' => $text,\n      'tokens_estimate' => $this->estimateTokens($text),\n    ];\n  }\n\n  /**\n   * Transforms response to JSON format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   JSON-formatted response.\n   */\n  private function transformToJson(array $data, int $maxTokens): array {\n    $json = json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES);\n    $json = $this->truncateToTokenLimit($json, $maxTokens);\n\n    return [\n      'format' => 'json',\n      'content' => $json,\n      'tokens_estimate' => $this->estimateTokens($json),\n    ];\n  }\n\n  /**\n   * Transforms response to structured format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   Structured response.\n   */\n  private function transformToStructured(array $data, int $maxTokens): array {\n    return [\n      'format' => 'structured',\n      'content' => $data,", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Service;\n\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse GuzzleHttp\\ClientInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Converts API responses to agent-consumable context.\n */\nfinal class ApiToAgentContextService {\n\n  /**\n   * Constructs an ApiToAgentContextService object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\GuzzleHttp\\ClientInterface $httpClient\n   *   The HTTP client.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger channel.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly ClientInterface $httpClient,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * Transforms API response data for agent consumption.\n   *\n   * @param array<string, mixed> $responseData\n   *   The raw API response data.\n   * @param string $format\n   *   The desired output format (text, json, structured).\n   * @param int $maxTokens\n   *   Maximum tokens to include in output.\n   *\n   * @return array<string, mixed>\n   *   Transformed data suitable for agent context.\n   */\n  public function transformResponse(array $responseData, string $format = 'structured', int $maxTokens = 2000): array {\n    try {\n      return match ($format) {\n        'text' => $this->transformToText($responseData, $maxTokens),\n        'json' => $this->transformToJson($responseData, $maxTokens),\n        'structured' => $this->transformToStructured($responseData, $maxTokens),\n        default => ['error' => 'Unknown format'],\n      };\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to transform response: @message', [\n        '@message' => $e->getMessage(),\n      ]);\n      return ['error' => $e->getMessage()];\n    }\n  }\n\n  /**\n   * Transforms response to plain text format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   Text-formatted response.\n   */\n  private function transformToText(array $data, int $maxTokens): array {\n    $text = $this->flattenArray($data);\n    $text = $this->truncateToTokenLimit($text, $maxTokens);\n\n    return [\n      'format' => 'text',\n      'content' => $text,\n      'tokens_estimate' => $this->estimateTokens($text),\n    ];\n  }\n\n  /**\n   * Transforms response to JSON format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   JSON-formatted response.\n   */\n  private function transformToJson(array $data, int $maxTokens): array {\n    $json = json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES);\n    $json = $this->truncateToTokenLimit($json, $maxTokens);\n\n    return [\n      'format' => 'json',\n      'content' => $json,\n      'tokens_estimate' => $this->estimateTokens($json),\n    ];\n  }\n\n  /**\n   * Transforms response to structured format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   Structured response.\n   */\n  private function transformToStructured(array $data, int $maxTokens): array {\n    return [\n      'format' => 'structured',\n      'content' => $data,\n      'tokens_estimate' => $this->estimateTokens(json_encode($data)),\n    ];\n  }\n\n  /**\n   * Flattens array to text representation.\n   *\n   * @param array<string, mixed> $array\n   *   The array to flatten.\n   * @param string $prefix\n   *   Key prefix for nested values.\n   *\n   * @return string\n   *   Flattened text.\n   */\n  private function flattenArray(array $array, string $prefix = ''): string {\n    $result = '';\n\n    foreach ($array as $key => $value) {\n      $fullKey = $prefix === '' ? (string) $key : \"{$prefix}.{$key}\";\n\n      if (is_array($value)) {\n        $result .= $this->flattenArray($value, $fullKey);\n      }\n      else {\n        $result .= \"{$fullKey}: {$value}\\n\";\n      }\n    }\n\n    return $result;\n  }\n\n  /**\n   * Truncates text to token limit.\n   *\n   * @param string $text\n   *   The text to truncate.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return string\n   *   Truncated text.\n   */\n  private function truncateToTokenLimit(string $text, int $maxTokens): string {\n    // Rough estimate: 1 token \u2248 4 characters.\n    $maxChars = $maxTokens * 4;\n\n    if (strlen($text) <= $maxChars) {\n      return $text;\n    }\n\n    return substr($text, 0, $maxChars) . \"\\n... (truncated)\";\n  }\n\n  /**\n   * Estimates token count from text.\n   *\n   * @param string $text\n   *   The text.\n   *\n   * @return int\n   *   Estimated token count.\n   */\n  private function estimateTokens(string $text): int {\n    // Rough estimate: 1 token \u2248 4 characters.\n    return (int) ceil(strlen($text) / 4);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/src/Service/ApiToAgentContextService.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiToAgentContextService", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class PipelineEventSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_orchestration_connector\\EventSubscriber;\n\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\orchestration\\Webhooks;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\EventDispatcher\\GenericEvent;\n\n/**\n * Event subscriber for FlowDrop pipeline completion events.\n *\n * Listens to FlowDrop's real-time events and dispatches webhooks to registered\n * external platforms when workflows complete. This enables external automation\n * platforms to receive notifications about FlowDrop workflow execution results.\n *\n * Webhook registration:\n * - Platforms register webhooks via POST /orchestration/webhook/register\n * - Webhooks identified by ID (e.g., \"flowdrop::my_workflow__node_abc\")\n * - When a workflow completes, this subscriber dispatches to matching webhooks\n *\n * @see \\Drupal\\orchestration\\Webhooks\n * @see \\Drupal\\flowdrop_runtime\\Service\\RealTime\\EventBroadcaster\n */\nclass PipelineEventSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new PipelineEventSubscriber.\n   *\n   * @param \\Drupal\\orchestration\\Webhooks $webhooks\n   *   The orchestration webhooks service.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger service.\n   */\n  public function __construct(\n    protected Webhooks $webhooks,\n    protected EntityTypeManagerInterface $entityTypeManager,\n    protected LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      \"flowdrop_runtime.real_time_event\" => [\"onRealTimeEvent\", 0],\n    ];\n  }\n\n  /**\n   * Handle FlowDrop real-time events.\n   *\n   * @param \\Symfony\\Component\\EventDispatcher\\GenericEvent $event\n   *   The event containing real-time event data.\n   */\n  public function onRealTimeEvent(GenericEvent $event): void {\n    $type = $event->getArgument(\"type\");\n    $eventName = $event->getArgument(\"event\");\n    $executionId = $event->getArgument(\"execution_id\");\n    $data = $event->getArgument(\"data\");\n\n    // Only process execution-level completion events.\n    if ($type !== \"execution\") {\n      return;\n    }\n\n    // Handle completion events (completed, failed).\n    if ($eventName === \"completed\" || $eventName === \"failed\") {\n      $this->dispatchWebhook($executionId, $eventName, $data);\n    }\n  }\n\n  /**\n   * Dispatch a webhook for pipeline completion.\n   *\n   * @param string $executionId\n   *   The execution ID (usually pipeline ID).\n   * @param string $status\n   *   The completion status (completed, failed).\n   * @param array<string, mixed> $data\n   *   Additional event data.\n   */\n  protected function dispatchWebhook(string $executionId, string $status, array $data): void {\n    // Try to load the pipeline to get workflow and trigger info.\n    $pipelineStorage = $this->entityTypeManager->getStorage(\"flowdrop_pipeline\");\n\n    // Extract pipeline ID from execution ID if it follows our format.\n    $pipelineId = $this->extractPipelineId($executionId);\n    if ($pipelineId === NULL) {\n      return;\n    }\n\n    $pipeline = $pipelineStorage->load($pipelineId);\n    if ($pipeline === NULL) {\n      return;\n    }\n\n    // Get workflow ID for webhook routing.\n    /** @var \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline */\n    $workflowId = $pipeline->getWorkflowId();\n\n    // Check if this pipeline was triggered via orchestration.\n    // Look for orchestration source in execution context or input data.\n    $inputData = $pipeline->getInputData();\n    $triggerConfigId = $inputData[\"trigger_config_id\"] ?? NULL;\n\n    if ($triggerConfigId === NULL) {\n      // Not an orchestration-triggered pipeline.\n      return;\n    }\n\n    // Build webhook ID - matches what external platforms register.\n    $webhookId = \"flowdrop::{$triggerConfigId}\";\n\n    // Build payload for the webhook.\n    $payload = [\n      \"event\" => \"workflow.{$status}\",\n      \"timestamp\" => time(),\n      \"execution_id\" => $executionId,\n      \"pipeline_id\" => $pipelineId,\n      \"workflow_id\" => $workflowId,\n      \"trigger_config_id\" => $triggerConfigId,\n      \"status\" => $status,\n      \"output\" => $pipeline->getOutputData(),\n      \"error\" => $status === \"failed\" ? ($pipeline->getErrorMessage() ?: ($data[\"error\"] ?? NULL)) : NULL,\n      \"execution_time\" => $data[\"execution_time\"] ?? NULL,\n    ];\n\n    $this->logger->info(\"Dispatching webhook @webhook for pipeline @pipeline (@status)\", [\n      \"@webhook\" => $webhookId,\n      \"@pipeline\" => $pipelineId,\n      \"@status\" => $status,\n    ]);\n\n    // Dispatch to the registered webhook URL.\n    $this->webhooks->dispatch($webhookId, $payload);\n  }\n\n  /**\n   * Extract pipeline ID from execution ID.\n   *\n   * Execution IDs may follow different formats. This method attempts to\n   * extract the pipeline ID from common patterns.\n   *\n   * @param string $executionId\n   *   The execution ID.\n   *\n   * @return string|null\n   *   The pipeline ID or NULL if not extractable.\n   */\n  protected function extractPipelineId(string $executionId): ?string {\n    // Pattern: pipeline_workflowid_timestamp or similar.\n    // If the execution ID is numeric, it's likely the pipeline ID directly.\n    if (is_numeric($executionId)) {\n      return $executionId;\n    }\n\n    // Try to extract from pattern: pipeline_X_Y or exec_X.\n    if (preg_match(\"/^pipeline_(\\d+)/\", $executionId, $matches)) {\n      return $matches[1];\n    }\n\n    // The execution ID might be the pipeline ID itself.\n    // Check if it exists in the database.\n    return $executionId;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_orchestration_connector/src/EventSubscriber/PipelineEventSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PipelineEventSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class MetatagAiGenerate in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Install, update and uninstall functions for Metatag AI Generate.\n */\n\n/**\n * Implements hook_install().\n */\nfunction metatag_ai_generate_install($is_syncing): void {\n  // Ne pas afficher de message lors d'une importation de config.\n  if ($is_syncing) {\n    return;\n  }\n\n  // Note: La route n'existe pas encore, mais le message guide l'admin.\n  // La route sera creee dans une phase ulterieure (Phase 5: Configuration).\n  \\Drupal::messenger()->addStatus(t(\n    'Metatag AI Generate has been installed. Configure the module at <em>Configuration > Search and metadata > Metatag AI Generate</em> when the settings page is available.',\n  ));\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction metatag_ai_generate_uninstall($is_syncing): void {\n  // Nettoyer les etats si necessaire.\n  \\Drupal::state()->delete('metatag_ai_generate.last_generation');\n}\n", "metadata": {"source": "repos/metatag_ai_generate/metatag_ai_generate.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MetatagAiGenerate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: MCP Tools - Image Styles", "input": "", "output": "# MCP Tools - Image Styles\n\nManage Drupal image styles and effects via MCP.\n\n## Tools (7)\n\n| Tool | Description |\n|------|-------------|\n| `mcp_image_styles_list` | List all image styles with their effects |\n| `mcp_image_styles_get` | Get details of a specific image style |\n| `mcp_image_styles_create` | Create a new image style |\n| `mcp_image_styles_delete` | Delete an image style |\n| `mcp_image_styles_add_effect` | Add an effect to an image style |\n| `mcp_image_styles_remove_effect` | Remove an effect from an image style |\n| `mcp_image_styles_list_effects` | List available image effect plugins |\n\n## Requirements\n\n- mcp_tools (base module)\n- drupal:image (core)\n\n## Usage Examples\n\n### Create a thumbnail style with scale effect\n\n```\n1. mcp_image_styles_create(id: \"thumbnail\", label: \"Thumbnail\")\n2. mcp_image_styles_add_effect(\n     style_id: \"thumbnail\",\n     effect_id: \"image_scale\",\n     configuration: {width: 150, height: 150, upscale: false}\n   )\n```\n\n### Add crop effect to existing style\n\n```\nmcp_image_styles_add_effect(\n  style_id: \"medium\",\n  effect_id: \"image_scale_and_crop\",\n  configuration: {width: 400, height: 300}\n)\n```\n\n### Common image effects\n\n| Effect ID | Description | Configuration |\n|-----------|-------------|---------------|\n| `image_scale` | Scale maintaining aspect ratio | `{width, height, upscale}` |\n| `image_scale_and_crop` | Scale and center crop | `{width, height}` |\n| `image_crop` | Crop to exact dimensions | `{width, height, anchor}` |\n| `image_resize` | Resize without maintaining ratio | `{width, height}` |\n| `image_rotate` | Rotate image | `{degrees, bgcolor, random}` |\n| `image_desaturate` | Convert to grayscale | `{}` |\n| `image_convert` | Convert image format | `{extension}` |\n\n## Security\n\n- All write operations require appropriate scope\n- All changes are audit logged\n- Usage checking prevents deleting styles in use (unless force=true)\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_image_styles/README.md", "type": "doc_summary", "topic": "MCP Tools - Image Styles"}}
{"instruction": "Show me the implementation of the class ScaffoldOptions in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold;\n\n/**\n * Per-project options from the 'extras' section of the composer.json file.\n *\n * Projects that describe scaffold files do so via their scaffold options. This\n * data is pulled from the 'drupal-scaffold' portion of the extras section of\n * the project data.\n *\n * @internal\n */\nclass ScaffoldOptions {\n\n  /**\n   * The raw data from the 'extras' section of the top-level composer.json file.\n   *\n   * @var array\n   */\n  protected $options = [];\n\n  /**\n   * ScaffoldOptions constructor.\n   *\n   * @param array $options\n   *   The scaffold options taken from the 'drupal-scaffold' section.\n   */\n  protected function __construct(array $options) {\n    $this->options = $options + [\n      \"allowed-packages\" => [],\n      \"locations\" => [],\n      \"symlink\" => FALSE,\n      \"file-mapping\" => [],\n    ];\n\n    // Define any default locations.\n    $this->options['locations'] += [\n      'project-root' => '.',\n      'web-root' => '.',\n    ];\n  }\n\n  /**\n   * Determines if the provided 'extras' section has scaffold options.\n   *\n   * @param array $extras\n   *   The contents of the 'extras' section.\n   *\n   * @return bool\n   *   True if scaffold options have been declared\n   */\n  public static function hasOptions(array $extras) {\n    return array_key_exists('drupal-scaffold', $extras);\n  }\n\n  /**\n   * Creates a scaffold options object.\n   *\n   * @param array $extras\n   *   The contents of the 'extras' section.\n   *\n   * @return self\n   *   The scaffold options object representing the provided scaffold options\n   */\n  public static function create(array $extras) {\n    $options = static::hasOptions($extras) ? $extras['drupal-scaffold'] : [];\n    return new self($options);\n  }\n\n  /**\n   * Creates a new scaffold options object with some values overridden.\n   *\n   * @param array $options\n   *   Override values.\n   *\n   * @return self\n   *   The scaffold options object representing the provided scaffold options\n   */\n  protected function override(array $options) {\n    return new self($options + $this->options);\n  }\n\n  /**\n   * Creates a new scaffold options object with an overridden 'symlink' value.\n   *\n   * @param bool $symlink\n   *   Whether symlinking should be enabled or not.\n   *\n   * @return self\n   *   The scaffold options object representing the provided scaffold options\n   */\n  public function overrideSymlink($symlink) {\n    return $this->override(['symlink' => $symlink]);\n  }\n\n  /**\n   * Determines whether any allowed packages were defined.\n   *\n   * @return bool\n   *   Whether there are allowed packages\n   */\n  public function hasAllowedPackages() {\n    return !empty($this->allowedPackages());\n  }\n\n  /**\n   * Gets allowed packages from these options.\n   *\n   * @return array\n   *   The list of allowed packages\n   */\n  public function allowedPackages() {\n    return $this->options['allowed-packages'];\n  }\n\n  /**\n   * Gets the location mapping table, e.g. 'webroot' => './'.\n   *\n   * @return array\n   *   A map of name : location values\n   */\n  public function locations() {\n    return $this->options['locations'];\n  }\n\n  /**\n   * Determines whether a given named location is defined.\n   *\n   * @param string $name\n   *   The location name to search for.\n   *\n   * @return bool\n   *   True if the specified named location exist.\n   */\n  protected function hasLocation($name) {\n    return array_key_exists($name, $this->locations());\n  }\n\n  /**\n   * Gets a specific named location.\n   *\n   * @param string $name\n   *   The name of the location to fetch.\n   *\n   * @return string\n   *   The value of the provided named location\n   */\n  public function getLocation($name) {\n    return $this->hasLocation($name) ? $this->locations()[$name] : FALSE;\n  }\n\n  /**\n   * Determines if symlink mode is set.\n   *\n   * @return bool\n   *   Whether or not 'symlink' mode\n   */\n  public function symlink() {\n    return $this->options['symlink'];\n  }\n\n  /**\n   * Determines if there are file mappings.\n   *\n   * @return bool\n   *   Whether or not the scaffold options contain any file mappings\n   */\n  public function hasFileMapping() {\n    return !empty($this->fileMapping());\n  }\n\n  /**\n   * Returns the actual file mappings.\n   *\n   * @return array\n   *   File mappings for just this config type.\n   */\n  public function fileMapping() {\n    return $this->options['file-mapping'];\n  }\n\n  /**\n   * Determines if there is defined a value for the 'gitignore' option.\n   *\n   * @return bool\n   *   Whether or not there is a 'gitignore' option setting\n   */\n  public function hasGitIgnore() {\n    return isset($this->options['gitignore']);\n  }\n\n  /**\n   * Gets the value of the 'gitignore' option.\n   *\n   * @return bool\n   *   The 'gitignore' option, or TRUE if undefined.\n   */\n  public function gitIgnore() {\n    return $this->hasGitIgnore() ? $this->options['gitignore'] : TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/ScaffoldOptions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ScaffoldOptions", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: function hook\\_local\\_tasks\\_alter", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# function hook\\_local\\_tasks\\_alter\n\nSame name and namespace in other branches\n\n1. [10 core/lib/Drupal/Core/Menu/menu.api.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/10) \\hook\\_local\\_tasks\\_alter()\n2. [9 core/lib/Drupal/Core/Menu/menu.api.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/9) \\hook\\_local\\_tasks\\_alter()\n3. [8.9.x core/lib/Drupal/Core/Menu/menu.api.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/8.9.x) \\hook\\_local\\_tasks\\_alter()\n\nAlter local tasks plugins.\n\n### Parameters\n\n**array $local\\_tasks**:\nThe array of local tasks plugin definitions, keyed by plugin ID.\n\n### See also\n\n[\\Drupal\\Core\\Menu\\LocalTaskInterface](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21LocalTaskInterface.php/interface/LocalTaskInterface/11.x \"Defines an interface for menu local tasks.\")\n\n[\\Drupal\\Core\\Menu\\LocalTaskManager](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21LocalTaskManager.php/class/LocalTaskManager/11.x \"Provides the default local task manager using YML as primary definition.\")\n\n[hook\\_menu\\_local\\_tasks\\_alter](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_menu_local_tasks_alter/11.x \"Alter local tasks displayed on the page before they are rendered.\")()\n\n### Related topics\n\n[Menu system](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/group/menu/11.x)\n:   Define the navigation menus, local actions and tasks, and contextual links.\n\n[Hooks](/api/drupal/core%21core.api.php/group/hooks/11.x)\n:   Define functions that alter the behavior of Drupal core.\n\n5 functions implement *hook\\_local\\_tasks\\_alter()*\n\nNote: the procedural functions in this list are found by pattern matching, so the list may include some functions that are not actually implementations of this hook.\n\n[FieldUiHooks::localTasksAlter](/api/drupal/core%21modules%21field_ui%21src%21Hook%21FieldUiHooks.php/function/FieldUiHooks%3A%3AlocalTasksAlter/11.x) in core/modules/field\\_ui/src/Hook/[FieldUiHooks.php](/api/drupal/core%21modules%21field_ui%21src%21Hook%21FieldUiHooks.php/11.x)\n:   Implements [hook\\_local\\_tasks\\_alter](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/11.x \"Alter local tasks plugins.\")().\n\n[MediaLibraryHooks::localTasksAlter](/api/drupal/core%21modules%21media_library%21src%21Hook%21MediaLibraryHooks.php/function/MediaLibraryHooks%3A%3AlocalTasksAlter/11.x) in core/modules/media\\_library/src/Hook/[MediaLibraryHooks.php](/api/drupal/core%21modules%21media_library%21src%21Hook%21MediaLibraryHooks.php/11.x)\n:   Implements [hook\\_local\\_tasks\\_alter](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/11.x \"Alter local tasks plugins.\")().\n\n[NodeMenuHooks::localTasksAlter](/api/drupal/core%21modules%21node%21src%21Hook%21NodeMenuHooks.php/function/NodeMenuHooks%3A%3AlocalTasksAlter/11.x) in core/modules/node/src/Hook/[NodeMenuHooks.php](/api/drupal/core%21modules%21node%21src%21Hook%21NodeMenuHooks.php/11.x)\n:   Implements [hook\\_local\\_tasks\\_alter](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/11.x \"Alter local tasks plugins.\")().\n\n[TaxonomyHooks::localTasksAlter](/api/drupal/core%21modules%21taxonomy%21src%21Hook%21TaxonomyHooks.php/function/TaxonomyHooks%3A%3AlocalTasksAlter/11.x) in core/modules/taxonomy/src/Hook/[TaxonomyHooks.php](/api/drupal/core%21modules%21taxonomy%21src%21Hook%21TaxonomyHooks.php/11.x)\n:   Implements [hook\\_local\\_tasks\\_alter](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/11.x \"Alter local tasks plugins.\")().\n\n[ViewsHooks::localTasksAlter](/api/drupal/core%21modules%21views%21src%21Hook%21ViewsHooks.php/function/ViewsHooks%3A%3AlocalTasksAlter/11.x) in core/modules/views/src/Hook/[ViewsHooks.php](/api/drupal/core%21modules%21views%21src%21Hook%21ViewsHooks.php/11.x)\n:   Implements [hook\\_local\\_tasks\\_alter](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/11.x \"Alter local tasks plugins.\")().\n\n1 invocation of *hook\\_local\\_tasks\\_alter()*\n\n[LocalTaskManager::\\_\\_construct](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21LocalTaskManager.php/function/LocalTaskManager%3A%3A__construct/11.x) in core/lib/Drupal/Core/Menu/[LocalTaskManager.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21LocalTaskManager.php/11.x)\n:   Constructs a [\\Drupal\\Core\\Menu\\LocalTaskManager](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21LocalTaskManager.php/class/LocalTaskManager/11.x \"Provides the default local task manager using YML as primary definition.\") object.\n\n### File\n\ncore/lib/Drupal/Core/Menu/[menu.api.php](/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/11.x), line 362\n\n### Code\n\n```\nfunction hook_local_tasks_alter(&$local_tasks) {\n  // Remove a specified local task plugin.\n  unset($local_tasks['example_plugin_id']);\n}\n```\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Menu%2521menu.api.php/function/hook_local_tasks_alter/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/function/hook_local_tasks_alter/11.x.md", "type": "doc_summary", "topic": "function hook\\_local\\_tasks\\_alter"}}
{"instruction": "Show me the implementation of the class SettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pantheon_si_tokens\\Form;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configure Pantheon SI Tokens settings.\n */\nclass SettingsForm extends ConfigFormBase\n{\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames(): array\n  {\n    return ['pantheon_si_tokens.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId(): string\n  {\n    return 'pantheon_si_tokens_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(\n    array $form,\n    FormStateInterface $form_state,\n  ): array {\n    $config = $this->config('pantheon_si_tokens.settings');\n    $constants = $config->get('constants') ?? [];\n\n    $form['description'] = [\n      '#type' => 'markup',\n      '#markup' => $this->t(\n        'Configure which Pantheon Secure Integration PHP ' .\n        'constants to expose as tokens. Constants should be in ' .\n        'the format PANTHEON_SOIP_SERVICENAME.',\n      ),\n    ];\n\n    $form['constants'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('PHP Constants'),\n      '#description' => $this->t(\n        'Enter one PHP constant name per line. Example: PANTHEON_SOIP_LDAP',\n      ),\n      '#default_value' => implode(\"\\n\", $constants),\n      '#rows' => 10,\n    ];\n\n    $form['token_help'] = [\n      '#type' => 'markup',\n      '#markup' => $this->t(\n        '<p><strong>Token format:</strong> Constants will be ' .\n        'available as <code>[pantheon_si_tunnel:' .\n        'constant_name_lowercase]</code></p><p>Example: ' .\n        '<code>PANTHEON_SOIP_LDAP</code> becomes ' .\n        '<code>[pantheon_si_tunnel:pantheon_soip_ldap]</code></p>',\n      ),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(\n    array &$form,\n    FormStateInterface $form_state,\n  ): void {\n    parent::validateForm($form, $form_state);\n\n    $constants_text = $form_state->getValue('constants');\n    $constants = array_filter(\n      array_map('trim', explode(\"\\n\", $constants_text)),\n    );\n\n    foreach ($constants as $constant) {\n      if (!str_starts_with($constant, 'PANTHEON_SOIP_')) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" must start with \"PANTHEON_SOIP_\". ' .\n            'This module only exposes Pantheon Secure Integration ' .\n            'tunnel constants.',\n            ['@constant' => $constant],\n          ),\n        );\n        continue;\n      }\n\n      if (!defined($constant)) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" is not defined. Ensure Pantheon ' .\n            'Secure Integration is configured and the constant name ' .\n            'is spelled correctly.',\n            ['@constant' => $constant],\n          ),\n        );\n        continue;\n      }\n\n      $value = constant($constant);\n\n      if (!is_int($value) && !ctype_digit((string) $value)) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" has value \"@value\" which is not ' .\n            'an integer. Pantheon SI tunnel constants must contain ' .\n            'port numbers.',\n            [\n              '@constant' => $constant,\n              '@value' => is_scalar($value) ? $value : gettype($value),\n            ],\n          ),\n        );\n        continue;\n      }\n\n      $port = (int) $value;\n      if ($port < 1 || $port > 65535) {\n        $form_state->setErrorByName(\n          'constants',\n          $this->t(\n            'Constant \"@constant\" has value @port which is outside ' .\n            'the valid port range (1-65535).',\n            [\n              '@constant' => $constant,\n              '@port' => $port,\n            ],\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(\n    array &$form,\n    FormStateInterface $form_state,\n  ): void {\n    $constants_text = $form_state->getValue('constants');\n    $constants = array_filter(\n      array_map('trim', explode(\"\\n\", $constants_text)),\n    );\n\n    $this->config('pantheon_si_tokens.settings')\n      ->set('constants', array_values($constants))\n      ->save();\n\n    \\Drupal::service('cache_tags.invalidator')->invalidateTags([\n      'token_info',\n    ]);\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/pantheon_si_tokens/src/Form/SettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Using XAMPP", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Windows development environment](/docs/develop/local-server-setup/windows-development-environment)\n\n* [Installing Drupal on Windows for local usage](/docs/develop/local-server-setup/windows-development-environment/installing-drupal-on-windows-for-local-usage)\n* [Installing Drupal with DDEV in WSL2 on Windows](/docs/develop/local-server-setup/windows-development-environment/installing-drupal-with-ddev-in-wsl2-on-windows)\n* [Running on a USB Drive with USBWebserver](/docs/develop/local-server-setup/windows-development-environment/running-drupal-on-a-usb-drive-with-usbwebserver)\n* [Using XAMPP](/docs/develop/local-server-setup/windows-development-environment/using-xampp)\n\n# Using XAMPP\n\nIt is not recommended to use XAMPP for local Drupal development.\n\nThe recommended Drupal local development environment for Linux, macOS, and Windows is [DDEV](https://ddev.readthedocs.io/en/stable/). Follow the instructions to [install Drupal using DDEV for local development](https://www.drupal.org/docs/getting-started/installing-drupal/install-drupal-using-ddev-for-local-development) or use the [Installing Drupal with DDEV in WSL2 on Windows](https://www.drupal.org/docs/develop/local-server-setup/windows-development-environment/installing-drupal-with-ddev-in-wsl2-on-windows) tutorial.\n\nDocumentation for using XAMPP for Drupal development.\n\n## [Quick install Drupal with XAMPP on Windows](/docs/develop/local-server-setup/windows-development-environment/using-xampp/quick-install-drupal-with-xampp-on-windows)\n\nHow to install XAMPP on Windows to use as a development environment for Drupal\n\n## [Configuring XAMPP on Windows](/docs/develop/local-server-setup/windows-development-environment/using-xampp/configuring-xampp-on-windows)\n\nConfiguring virtual hosts and clean URLs for XAMPP on Windows.\n\n## [Sub directory based multisite using XAMPP](/docs/develop/local-server-setup/windows-development-environment/using-xampp/sub-directory-based-multisite-using-xampp)\n\nConfiguring sub directory based multisite using XAMPP on Windows.\n\n## [Skype interferes with XAMPP on port 80](/docs/develop/local-server-setup/windows/skype-interferes-with-xampp-and-wamp-on-port-80)\n\nHow to fix issues with port 80 interference\n\n## Guide maintainers\n\n[![hansfn's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-40521-1628754049.jpg?itok=ajPf510v)](/user/40521 \"View hansfn's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/local-server-setup/windows-development-environment/using-xampp.md", "type": "doc_summary", "topic": "Using XAMPP"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: EntityUserRole.php\nTarget symbol: class EntityUserRole\nNamespace: Drupal\\user\\Plugin\\migrate\\destination\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for EntityUserRole.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Entity\\EntityStorageInterface\n  - Drupal\\Core\\Language\\LanguageManagerInterface\n  - Drupal\\migrate\\Attribute\\MigrateDestination\n  - Drupal\\migrate\\Plugin\\migrate\\destination\\EntityConfigBase\n  - Drupal\\migrate\\Plugin\\MigrationInterface\n  - Drupal\\migrate\\Row\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - import()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\user\\Plugin\\migrate\\destination;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\migrate\\Attribute\\MigrateDestination;\nuse Drupal\\migrate\\Plugin\\migrate\\destination\\EntityConfigBase;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a destination plugin for migrating user role entities.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533565\n */\n#[MigrateDestination('entity:user_role')]\nclass EntityUserRole extends EntityConfigBase {\n\n  /**\n   * All permissions on the destination site.\n   *\n   * @var string[]\n   */\n  protected $destinationPermissions = [];\n\n  /**\n   * Builds a user role entity destination.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationInterface $migration\n   *   The migration.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $storage\n   *   The storage for this entity type.\n   * @param array $bundles\n   *   The list of bundles this entity type has.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The configuration factory.\n   * @param array $destination_permissions\n   *   All available permissions.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, MigrationInterface $migration, EntityStorageInterface $storage, array $bundles, LanguageManagerInterface $language_manager, ConfigFactoryInterface $config_factory, array $destination_permissions) {\n    @trigger_error(__CLASS__ . '() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533565', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $migration, $storage, $bundles, $language_manager, $config_factory);\n    $this->destinationPermissions = $destination_permissions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition, ?MigrationInterface $migration = NULL) {\n    $entity_type_id = static::getEntityTypeId($plugin_id);\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $migration,\n      $container->get('entity_type.manager')->getStorage($entity_type_id),\n      array_keys($container->get('entity_type.bundle.info')->getBundleInfo($entity_type_id)),\n      $container->get('language_manager'),\n      $container->get('config.factory'),\n      array_keys($container->get('user.permissions')->getPermissions()),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function import(Row $row, array $old_destination_id_values = []): array|bool {\n    $permissions = $row->getDestinationProperty('permissions') ?? [];\n\n    // Get permissions that do not exist on the destination.\n    $invalid_permissions = array_diff($permissions, $this->destinationPermissions);\n    if ($invalid_permissions) {\n      sort($invalid_permissions);\n      // Log the message in the migration message table.\n      $message = \"Permission(s) '\" . implode(\"', '\", $invalid_permissions) . \"' not found.\";\n      $this->migration->getIdMap()\n        ->saveMessage($row->getSourceIdValues(), $message, MigrationInterface::MESSAGE_WARNING);\n    }\n\n    $valid_permissions = array_intersect($permissions, $this->destinationPermissions);\n    $row->setDestinationProperty('permissions', $valid_permissions);\n    return parent::import($row, $old_destination_id_values);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/migrate/destination/EntityUserRole.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityUserRole", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class EntityDelete in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\n\n/**\n * Event type for entity delete events.\n *\n * Triggers when an entity is deleted from the database.\n * This event fires after the entity has been successfully deleted.\n * The entity data is captured before deletion for use in workflows.\n */\n#[FlowDropEventType(\n  id: \"entity.delete\",\n  label: new TranslatableMarkup(\"Entity Delete\"),\n  description: new TranslatableMarkup(\"Triggered when an entity is deleted\"),\n  category: \"entity\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [],\n)]\nclass EntityDelete extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for entity delete events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add delete-specific data.\n    $data[\"is_new\"] = FALSE;\n    $data[\"operation\"] = \"delete\";\n    $data[\"deleted\"] = TRUE;\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    $baseSchema = parent::getParameterSchema();\n\n    // Entity delete doesn't need additional configuration beyond base.\n    return $baseSchema;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/EntityDelete.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityDelete", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait RequirementsTrait in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mysql;\n\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Extension\\Requirement\\RequirementSeverity;\nuse Drupal\\Core\\Render\\Markup;\n\n/**\n * Runtime requirements trait.\n *\n * The mysql and the mysqli drivers share the same requirements; this trait\n * helps sharing them.\n */\ntrait RequirementsTrait {\n\n  /**\n   * Returns runtime requirements.\n   */\n  public function getRuntimeRequirements(Connection $connection): array {\n    $requirements = [];\n\n    // Transaction isolation level.\n    $query = $connection->isMariaDb() ? 'SELECT @@SESSION.tx_isolation' : 'SELECT @@SESSION.transaction_isolation';\n    $isolation_level = $connection->query($query)->fetchField();\n\n    // Tables missing primary key.\n    $tables_missing_primary_key = [];\n    $tables = $connection->schema()->findTables('%');\n    foreach ($tables as $table) {\n      $primary_key_column = $connection->query(\"SHOW KEYS FROM {\" . $table . \"} WHERE Key_name = 'PRIMARY'\")->fetchAllAssoc('Column_name');\n      if (empty($primary_key_column)) {\n        $tables_missing_primary_key[] = $table;\n      }\n    }\n\n    $description = [];\n    if ($isolation_level == 'READ-COMMITTED') {\n      if (empty($tables_missing_primary_key)) {\n        $severity_level = RequirementSeverity::OK;\n      }\n      else {\n        $severity_level = RequirementSeverity::Error;\n      }\n    }\n    else {\n      if ($isolation_level == 'REPEATABLE-READ') {\n        $severity_level = RequirementSeverity::Warning;\n      }\n      else {\n        $severity_level = RequirementSeverity::Error;\n        $description[] = $this->t('This is not supported by Drupal.');\n      }\n      $description[] = $this->t('The recommended level for Drupal is \"READ COMMITTED\".');\n    }\n\n    if (!empty($tables_missing_primary_key)) {\n      $description[] = $this->t('For this to work correctly, all tables must have a primary key. The following table(s) do not have a primary key: @tables.', ['@tables' => implode(', ', $tables_missing_primary_key)]);\n    }\n\n    $description[] = $this->t('See the <a href=\":performance_doc\">setting MySQL transaction isolation level</a> page for more information.', [\n      ':performance_doc' => 'https://www.drupal.org/docs/system-requirements/setting-the-mysql-transaction-isolation-level',\n    ]);\n\n    $requirements['mysql_transaction_level'] = [\n      'title' => $this->t('Transaction isolation level'),\n      'severity' => $severity_level,\n      'value' => $isolation_level,\n      'description' => Markup::create(implode(' ', $description)),\n    ];\n\n    return $requirements;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/mysql/src/RequirementsTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "RequirementsTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class WipePluginManager in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\db_wipe\\Annotation\\WipePlugin;\n\n/**\n * Plugin manager for Wipe plugins.\n */\nclass WipePluginManager extends DefaultPluginManager {\n\n  public function __construct(\n    \\Traversable $namespaces,\n    CacheBackendInterface $cache_backend,\n    ModuleHandlerInterface $module_handler,\n  ) {\n    parent::__construct(\n      'Plugin/Wipe',\n      $namespaces,\n      $module_handler,\n      'Drupal\\db_wipe\\Plugin\\WipePluginInterface',\n      WipePlugin::class\n    );\n\n    $this->alterInfo('wipe_plugin_info');\n    $this->setCacheBackend($cache_backend, 'wipe_plugins');\n  }\n\n  /**\n   * Gets all available plugins sorted by weight and label.\n   */\n  public function getAvailablePlugins(): array {\n    $definitions = $this->getDefinitions();\n\n    // Sort by weight and then by label.\n    uasort($definitions, function ($a, $b) {\n      $weight_diff = ($a['weight'] ?? 0) <=> ($b['weight'] ?? 0);\n      if ($weight_diff !== 0) {\n        return $weight_diff;\n      }\n      return strcmp($a['label'], $b['label']);\n    });\n\n    return $definitions;\n  }\n\n  /**\n   * Gets plugins in a specific category.\n   */\n  public function getPluginsByCategory(string $category): array {\n    $definitions = $this->getDefinitions();\n    return array_filter($definitions, function ($definition) use ($category) {\n      return ($definition['category'] ?? 'general') === $category;\n    });\n  }\n\n  /**\n   * Finds a plugin that supports the target.\n   */\n  public function getPluginForTarget($target): ?object {\n    foreach ($this->getAvailablePlugins() as $plugin_id => $definition) {\n      $plugin = $this->createInstance($plugin_id);\n      if ($plugin->supports($target)) {\n        return $plugin;\n      }\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/src/WipePluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WipePluginManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BlockContentTypeDeleteForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block_content\\Form;\n\nuse Drupal\\Core\\Entity\\EntityDeleteForm;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Provides a confirmation form for deleting a block type entity.\n *\n * @internal\n */\nclass BlockContentTypeDeleteForm extends EntityDeleteForm {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $block_count = $this->entityTypeManager->getStorage('block_content')->getQuery()\n      ->accessCheck(FALSE)\n      ->condition('type', $this->entity->id())\n      ->count()\n      ->execute();\n    if ($block_count) {\n      $caption = '<p>' . $this->formatPlural($block_count, '%label is used by 1 content block on your site. You can not remove this block type until you have removed all of the %label blocks.', '%label is used by @count content blocks on your site. You may not remove %label until you have removed all of the %label content blocks.', ['%label' => $this->entity->label()]) . '</p>';\n      $form['description'] = ['#markup' => $caption];\n      return $form;\n    }\n    else {\n      return parent::buildForm($form, $form_state);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block_content/src/Form/BlockContentTypeDeleteForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockContentTypeDeleteForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class NodeMapping in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\DTO\\Compiler;\n\n/**\n * Represents a node's mapping to a processor plugin.\n */\nclass NodeMapping {\n\n  public function __construct(\n    private readonly string $nodeId,\n    private readonly string $processorId,\n    private readonly array $config,\n    private readonly array $metadata,\n  ) {}\n\n  /**\n   * Get the node ID.\n   *\n   * @return string\n   *   The node ID.\n   */\n  public function getNodeId(): string {\n    return $this->nodeId;\n  }\n\n  /**\n   * Get the processor plugin ID.\n   *\n   * @return string\n   *   The processor plugin ID.\n   */\n  public function getProcessorId(): string {\n    return $this->processorId;\n  }\n\n  /**\n   * Get the node configuration.\n   *\n   * @return array\n   *   The node configuration.\n   */\n  public function getConfig(): array {\n    return $this->config;\n  }\n\n  /**\n   * Get the metadata.\n   *\n   * @return array\n   *   The metadata.\n   */\n  public function getMetadata(): array {\n    return $this->metadata;\n  }\n\n  /**\n   * Get the node label.\n   *\n   * @return string\n   *   The node label.\n   */\n  public function getLabel(): string {\n    return $this->metadata['label'] ?? $this->nodeId;\n  }\n\n  /**\n   * Get the node description.\n   *\n   * @return string\n   *   The node description.\n   */\n  public function getDescription(): string {\n    return $this->metadata['description'] ?? '';\n  }\n\n  /**\n   * Convert to array for serialization.\n   *\n   * @return array\n   *   Array representation of the node mapping.\n   */\n  public function toArray(): array {\n    return [\n      'node_id' => $this->nodeId,\n      'processor_id' => $this->processorId,\n      'config' => $this->config,\n      'metadata' => $this->metadata,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/DTO/Compiler/NodeMapping.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeMapping", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_dashboard:\n  version: 1.0.0\n  js:\n    js/mcp_client.js: {}\n  dependencies:\n    - core/drupal\n    - core/drupalSettings\n    - core/jquery\n    - core/jquery.once\n    - core/drupal.ajax\n", "metadata": {"source": "repos/ai_nl_test/ai_nl_test.libraries.yml", "type": "yaml_reference", "topic": "ai nl test.libraries"}}
{"instruction": "Show me the implementation of the class ProtectionRule in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\nuse Drupal\\Core\\Entity\\EntityWithPluginCollectionInterface;\nuse Drupal\\db_wipe_entity\\ProtectionRuleInterface;\nuse Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection;\n\n/**\n * Defines the Protection Rule configuration entity.\n *\n * @ConfigEntityType(\n *   id = \"protection_rule\",\n *   label = @Translation(\"Protection Rule\"),\n *   label_collection = @Translation(\"Protection Rules\"),\n *   label_singular = @Translation(\"protection rule\"),\n *   label_plural = @Translation(\"protection rules\"),\n *   label_count = @PluralTranslation(\n *     singular = \"@count protection rule\",\n *     plural = \"@count protection rules\",\n *   ),\n *   handlers = {\n *     \"list_builder\" = \"Drupal\\db_wipe_entity\\ProtectionRuleListBuilder\",\n *     \"form\" = {\n *       \"add\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleForm\",\n *       \"edit\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleForm\",\n *       \"delete\" = \"Drupal\\Core\\Entity\\EntityDeleteForm\",\n *       \"toggle-status\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleToggleStatusForm\",\n *     },\n *     \"route_provider\" = {\n *       \"html\" = \"Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider\",\n *     },\n *   },\n *   config_prefix = \"protection_rule\",\n *   admin_permission = \"administer protection rules\",\n *   entity_keys = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\",\n *     \"weight\" = \"weight\",\n *   },\n *   config_export = {\n *     \"id\",\n *     \"label\",\n *     \"description\",\n *     \"status\",\n *     \"weight\",\n *     \"plugin\",\n *     \"configuration\",\n *   },\n *   links = {\n *     \"collection\" = \"/admin/config/development/db-wipe/entity/protection\",\n *     \"add-form\" = \"/admin/config/development/db-wipe/entity/protection/add\",\n *     \"edit-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}\",\n *     \"delete-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}/delete\",\n *     \"toggle-status-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}/toggle-status\",\n *   }\n * )\n */\nclass ProtectionRule extends ConfigEntityBase implements ProtectionRuleInterface, EntityWithPluginCollectionInterface {\n\n  /**\n   * The protection rule ID.\n   *\n   * @var string\n   */\n  protected string $id;\n\n  /**\n   * The protection rule label.\n   *\n   * @var string\n   */\n  protected string $label;\n\n  /**\n   * The protection rule description.\n   *\n   * @var string\n   */\n  protected string $description = '';\n\n  /**\n   * The protection rule weight.\n   *\n   * @var int\n   */\n  protected int $weight = 0;\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  protected string $plugin = '';\n\n  /**\n   * The plugin configuration.\n   *\n   * @var array\n   */\n  protected array $configuration = [];\n\n  /**\n   * The plugin collection.\n   *\n   * @var \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection|null\n   */\n  protected ?ProtectionRulePluginCollection $pluginCollection = NULL;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    return $this->description;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setDescription(string $description): ProtectionRuleInterface {\n    $this->description = $description;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getWeight(): int {\n    return $this->weight;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setWeight(int $weight): ProtectionRuleInterface {\n    $this->weight = $weight;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginId(): string {\n    return $this->plugin;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPluginId(string $plugin_id): ProtectionRuleInterface {\n    $this->plugin = $plugin_id;\n    $this->pluginCollection = NULL;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginConfiguration(): array {\n    return $this->configuration;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPluginConfiguration(array $configuration): ProtectionRuleInterface {\n    $this->configuration = $configuration;\n    $this->pluginCollection = NULL;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPlugin(): object {\n    return $this->getPluginCollection()->get($this->plugin);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginCollections(): array {\n    // Don't return a plugin collection if no plugin is set yet.\n    if (empty($this->plugin)) {\n      return [];\n    }\n    return [\n      'configuration' => $this->getPluginCollection(),\n    ];\n  }\n\n  /**\n   * Gets the plugin collection.\n   *\n   * @return \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection\n   *   The plugin collection.\n   */\n  protected function getPluginCollection(): ProtectionRulePluginCollection {\n    if ($this->pluginCollection === NULL) {\n      $this->pluginCollection = new ProtectionRulePluginCollection(\n        \\Drupal::service('plugin.manager.protection_rule'),\n        $this->plugin,\n        $this->configuration\n      );\n    }\n    return $this->pluginCollection;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Entity/ProtectionRule.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProtectionRule", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  ai_image_crop.service:\n    class: Drupal\\ai_image_crop\\Service\\AiImageCropService\n    arguments:\n      - '@ai.provider'\n      - '@entity_type.manager'\n      - '@image.factory'\n      - '@file_system'\n      - '@config.factory'\n      - '@logger.factory'\n", "metadata": {"source": "repos/ai_image_crop/ai_image_crop.services.yml", "type": "yaml_reference", "topic": "ai image crop.services"}}
{"instruction": "Show me the implementation of the class History in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n */\n\n/**\n * Entities changed before this time are always shown as read.\n *\n * Entities changed within this time may be marked as new, updated, or read,\n * depending on their state for the current user. Defaults to 30 days ago.\n *\n * @todo Remove when https://www.drupal.org/node/2006632 lands.\n */\ndefine('HISTORY_READ_LIMIT', ((int) $_SERVER['REQUEST_TIME']) - 30 * 24 * 60 * 60);\n\n/**\n * Retrieves the timestamp for the current user's last view of a specified node.\n *\n * @param int $nid\n *   A node ID.\n *\n * @return int\n *   If a node has been previously viewed by the user, the timestamp in seconds\n *   of when the last view occurred; otherwise, zero.\n */\nfunction history_read($nid) {\n  $history = history_read_multiple([$nid]);\n  return $history[$nid];\n}\n\n/**\n * Retrieves the last viewed timestamp for each of the passed node IDs.\n *\n * @param array $nids\n *   An array of node IDs.\n *\n * @return array\n *   Array of timestamps keyed by node ID. If a node has been previously viewed\n *   by the user, the timestamp in seconds of when the last view occurred;\n *   otherwise, zero.\n */\nfunction history_read_multiple($nids): array {\n  $history = &drupal_static(__FUNCTION__, []);\n\n  $return = [];\n\n  $nodes_to_read = [];\n  foreach ($nids as $nid) {\n    if (isset($history[$nid])) {\n      $return[$nid] = $history[$nid];\n    }\n    else {\n      // Initialize value if current user has not viewed the node.\n      $nodes_to_read[$nid] = 0;\n    }\n  }\n\n  if (empty($nodes_to_read)) {\n    return $return;\n  }\n\n  $result = \\Drupal::database()->select('history', 'h')\n    ->fields('h', ['nid', 'timestamp'])\n    ->condition('uid', \\Drupal::currentUser()->id())\n    ->condition('nid', array_keys($nodes_to_read), 'IN')\n    ->execute();\n  foreach ($result as $row) {\n    $nodes_to_read[$row->nid] = (int) $row->timestamp;\n  }\n  $history += $nodes_to_read;\n\n  return $return + $nodes_to_read;\n}\n\n/**\n * Updates 'last viewed' timestamp of the specified entity for the current user.\n *\n * @param string|int|null $nid\n *   The node ID that has been read.\n * @param \\Drupal\\user\\UserInterface $account\n *   (optional) The user account to update the history for. Defaults to the\n *   current user.\n */\nfunction history_write($nid, $account = NULL): void {\n\n  if (!isset($account)) {\n    $account = \\Drupal::currentUser();\n  }\n\n  if ($account->isAuthenticated()) {\n    $request_time = \\Drupal::time()->getRequestTime();\n    \\Drupal::database()->merge('history')\n      ->keys([\n        'uid' => $account->id(),\n        'nid' => $nid,\n      ])\n      ->fields(['timestamp' => $request_time])\n      ->execute();\n    // Update static cache.\n    $history = &drupal_static('history_read_multiple', []);\n    $history[$nid] = $request_time;\n  }\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/history/history.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "History", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Show me the implementation of the interface WorkspaceInformationInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\workspaces;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\n\n/**\n * Provides an interface for workspace-support information.\n */\ninterface WorkspaceInformationInterface {\n\n  /**\n   * Determines whether an entity can belong to a workspace.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity to check.\n   *\n   * @return bool\n   *   TRUE if the entity can belong to a workspace, FALSE otherwise.\n   */\n  public function isEntitySupported(EntityInterface $entity): bool;\n\n  /**\n   * Determines whether an entity type can belong to a workspace.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type to check.\n   *\n   * @return bool\n   *   TRUE if the entity type can belong to a workspace, FALSE otherwise.\n   */\n  public function isEntityTypeSupported(EntityTypeInterface $entity_type): bool;\n\n  /**\n   * Returns an array of entity types that can belong to workspaces.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityTypeInterface[]\n   *   An array of entity type definition objects.\n   */\n  public function getSupportedEntityTypes(): array;\n\n  /**\n   * Determines whether CRUD operations for an entity are allowed.\n   *\n   * CRUD operations for an ignored entity are allowed in a workspace, but their\n   * revisions are not tracked.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity to check.\n   *\n   * @return bool\n   *   TRUE if CRUD operations of an entity type can safely be done inside a\n   *   workspace, without impacting the Live site, FALSE otherwise.\n   */\n  public function isEntityIgnored(EntityInterface $entity): bool;\n\n  /**\n   * Determines whether CRUD operations for an entity type are allowed.\n   *\n   * CRUD operations for an ignored entity type are allowed in a workspace, but\n   * their revisions are not tracked.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type to check.\n   *\n   * @return bool\n   *   TRUE if CRUD operations of an entity type can safely be done inside a\n   *   workspace, without impacting the Live site, FALSE otherwise.\n   */\n  public function isEntityTypeIgnored(EntityTypeInterface $entity_type): bool;\n\n  /**\n   * Determines whether an entity can be deleted in the given workspace.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity object which needs to be checked.\n   * @param \\Drupal\\workspaces\\WorkspaceInterface $workspace\n   *   The workspace in which the entity needs to be checked.\n   *\n   * @return bool\n   *   TRUE if the entity can be deleted, FALSE otherwise.\n   */\n  public function isEntityDeletable(EntityInterface $entity, WorkspaceInterface $workspace): bool;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces/src/WorkspaceInformationInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "WorkspaceInformationInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: UniqueLabelInListConstraint.php\nTarget symbol: class UniqueLabelInListConstraint\nNamespace: Drupal\\ckeditor5\\Plugin\\Validation\\Constraint\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for UniqueLabelInListConstraint.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\Validation\\Attribute\\Constraint\n  - Symfony\\Component\\Validator\\Attribute\\HasNamedArguments\n  - Symfony\\Component\\Validator\\Constraint as SymfonyConstraint\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getRequiredOptions()", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Uniquely labeled list item constraint.\n *\n * @internal\n */\n#[Constraint(\n  id: 'UniqueLabelInList',\n  label: new TranslatableMarkup('Unique label in list', [], ['context' => 'Validation'])\n)]\nclass UniqueLabelInListConstraint extends SymfonyConstraint {\n\n  /**\n   * The key of the label that this validation constraint should check.\n   *\n   * @var null|string\n   */\n  public $labelKey = NULL;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?string $labelKey = NULL,\n    public $message = 'The label %label is not unique.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->labelKey = $labelKey ?? $this->labelKey;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRequiredOptions(): array {\n    return ['labelKey'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Plugin/Validation/Constraint/UniqueLabelInListConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UniqueLabelInListConstraint", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: CachedStrategy\nSource file: <source_file>\nFile name hint: CachedStrategy.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\Core\\Render\\Placeholder;\n\nuse Drupal\\Core\\Render\\RenderCacheInterface;\n\n/**\n * Looks up placeholders in the render cache and returns those we could find.\n */\nclass CachedStrategy implements PlaceholderStrategyInterface {\n\n  public function __construct(\n    protected readonly PlaceholderStrategyInterface $placeholderStrategy,\n    protected readonly RenderCacheInterface $renderCache,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processPlaceholders(array $placeholders) {\n    $return = $this->renderCache->getMultiple($placeholders);\n    if ($return) {\n      $return = $this->processNestedPlaceholders($return);\n    }\n\n    return $return;\n  }\n\n  /**\n   * Fetch any nested placeholders from cache.\n   *\n   * Placeholders returned from cache may have placeholders in #attached, which\n   * can themselves be fetched from the cache. By recursively processing the\n   * placeholders here, we're able to use multiple cache get to fetch the cache\n   * items at each level of recursion.\n   */\n  private function processNestedPlaceholders(array $placeholders): array {\n    $sets = [];\n    foreach ($placeholders as $key => $placeholder) {\n      if (!empty($placeholder['#attached']['placeholders'])) {\n        $sets[] = $placeholder['#attached']['placeholders'];\n      }\n    }\n    if ($sets) {\n      $cached = $this->renderCache->getMultiple(...array_merge($sets));\n      if ($cached) {\n        $cached = $this->processNestedPlaceholders($cached);\n        foreach ($placeholders as $key => $placeholder) {\n          if (!empty($placeholder['#attached']['placeholders'])) {\n            $placeholders[$key]['#attached']['placeholders'] = array_replace($placeholder['#attached']['placeholders'], $cached);\n          }\n        }\n      }\n    }\n    return $placeholders;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Render\\Placeholder;\n\nuse Drupal\\Core\\Render\\RenderCacheInterface;\n\n/**\n * Looks up placeholders in the render cache and returns those we could find.\n */\nclass CachedStrategy implements PlaceholderStrategyInterface {\n\n  public function __construct(\n    protected readonly PlaceholderStrategyInterface $placeholderStrategy,\n    protected readonly RenderCacheInterface $renderCache,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processPlaceholders(array $placeholders) {\n    $return = $this->renderCache->getMultiple($placeholders);\n    if ($return) {\n      $return = $this->processNestedPlaceholders($return);\n    }\n\n    return $return;\n  }\n\n  /**\n   * Fetch any nested placeholders from cache.\n   *\n   * Placeholders returned from cache may have placeholders in #attached, which\n   * can themselves be fetched from the cache. By recursively processing the\n   * placeholders here, we're able to use multiple cache get to fetch the cache\n   * items at each level of recursion.\n   */\n  private function processNestedPlaceholders(array $placeholders): array {\n    $sets = [];\n    foreach ($placeholders as $key => $placeholder) {\n      if (!empty($placeholder['#attached']['placeholders'])) {\n        $sets[] = $placeholder['#attached']['placeholders'];\n      }\n    }\n    if ($sets) {\n      $cached = $this->renderCache->getMultiple(...array_merge($sets));\n      if ($cached) {\n        $cached = $this->processNestedPlaceholders($cached);\n        foreach ($placeholders as $key => $placeholder) {\n          if (!empty($placeholder['#attached']['placeholders'])) {\n            $placeholders[$key]['#attached']['placeholders'] = array_replace($placeholder['#attached']['placeholders'], $cached);\n          }\n        }\n      }\n    }\n    return $placeholders;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Placeholder/CachedStrategy.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CachedStrategy", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Responsive behaviors\"\nslots:\n  brand:\n    - theme: image\n      uri: \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNDA4Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImJzLWxvZ28tYSIgeDE9Ijc2LjA3OSIgeDI9IjUyMy40OCIgeTE9IjEwLjc5OCIgeTI9IjM2NS45NDUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBzdG9wLWNvbG9yPSIjOTAxM2ZlIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjYxMGYyIi8+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImJzLWxvZ28tYiIgeDE9IjE5My41MDgiIHgyPSIyOTMuNTE0IiB5MT0iMTA5Ljc0IiB5Mj0iMjc4Ljg3MiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiNmZmYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmMWU1ZmMiLz48L2xpbmVhckdyYWRpZW50PjxmaWx0ZXIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBpZD0iYnMtbG9nby1jIiB3aWR0aD0iMTk3IiBoZWlnaHQ9IjI0OSIgeD0iMTYxLjkwMSIgeT0iODMuNDU3IiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz48ZmVPZmZzZXQgZHk9IjQiLz48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4Ii8+PGZlQ29sb3JNYXRyaXggdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwLjE1IDAiLz48ZmVCbGVuZCBpbjI9IkJhY2tncm91bmRJbWFnZUZpeCIgcmVzdWx0PSJlZmZlY3QxX2Ryb3BTaGFkb3ciLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJlZmZlY3QxX2Ryb3BTaGFkb3ciIHJlc3VsdD0ic2hhcGUiLz48L2ZpbHRlcj48L2RlZnM+PHBhdGggZmlsbD0idXJsKCNicy1sb2dvLWEpIiBkPSJNNTYuNDgxIDUzLjMyQzU1LjUxNSAyNS41OCA3Ny4xMjggMCAxMDYuMzQyIDBoMjk5LjM1M2MyOS4yMTQgMCA1MC44MjcgMjUuNTggNDkuODYxIDUzLjMyLS45MjggMjYuNjQ3LjI3NyA2MS4xNjUgOC45NjQgODkuMzEgOC43MTUgMjguMjMyIDIzLjQxMSA0Ni4wNzcgNDcuNDggNDguMzd2MjZjLTI0LjA2OSAyLjI5My0zOC43NjUgMjAuMTM4LTQ3LjQ4IDQ4LjM3LTguNjg3IDI4LjE0NS05Ljg5MiA2Mi42NjMtOC45NjQgODkuMzExLjk2NiAyNy43MzktMjAuNjQ3IDUzLjMxOS00OS44NjEgNTMuMzE5SDEwNi4zNDJjLTI5LjIxNCAwLTUwLjgyNy0yNS41OC00OS44Ni01My4zMTkuOTI3LTI2LjY0OC0uMjc4LTYxLjE2Ni04Ljk2Ni04OS4zMTFDMzguODAyIDIzNy4xMzggMjQuMDcgMjE5LjI5MyAwIDIxN3YtMjZjMjQuMDY5LTIuMjkzIDM4LjgwMi0yMC4xMzggNDcuNTE2LTQ4LjM3IDguNjg4LTI4LjE0NSA5Ljg5My02Mi42NjMgOC45NjUtODkuMzF6Ii8+PHBhdGggZmlsbD0idXJsKCNicy1sb2dvLWIpIiBmaWx0ZXI9InVybCgjYnMtbG9nby1jKSIgc3Ryb2tlPSIjZmZmIiBkPSJNMjY3LjEwMyAzMTIuNDU3YzQ3LjI5NyAwIDc1Ljc5OC0yMy4xNTggNzUuNzk4LTYxLjM1NSAwLTI4Ljg3My0yMC4zMzYtNDkuNzc2LTUwLjUzMi01My4wODV2LTEuMjAzYzIyLjE4NS0zLjYwOSAzOS41OTQtMjQuMjExIDM5LjU5NC00Ny4yMTkgMC0zMi43ODMtMjUuODgyLTU0LjEzOC02NS4zMjItNTQuMTM4aC04OC43NHYyMTdoODkuMjAyem0tNTQuNjkyLTE4OS40OGg0NS45MTFjMjQuOTU4IDAgMzkuMTMxIDExLjEyOCAzOS4xMzEgMzEuMjc5IDAgMjEuNTA1LTE2LjQ4NCAzMy41MzUtNDYuMzcyIDMzLjUzNWgtMzguNjd2LTY0LjgxNHptMCAxNjEuOTYxdi03MS40MzFoNDUuNjAyYzMyLjY2MSAwIDQ5LjYwOCAxMi4wMyA0OS42MDggMzUuNDkgMCAyMy40NTktMTYuNDg0IDM1Ljk0MS00Ny42MDUgMzUuOTQxaC00Ny42MDV6Ii8+PC9zdmc+Cg==\"\n      attributes:\n        width: 40px\n        height: 32px\n    - type: html_tag\n      tag: a\n      attributes:\n        href: \"#\"\n      value: Brand\n  navigation:\n    type: html_tag\n    tag: span\n    attributes:\n      class:\n        - navbar-text\n    value: Text\n  navigation_collapsible:\n    type: component\n    component: \"bootstrap_components:navbar_nav\"\n    props:\n      variant: default\n      attributes:\n        class:\n          - me-auto\n      items:\n        - title: Home\n          url: \"#\"\n          link_attributes:\n            class:\n              - active\n        - title: Link\n          url: \"#\"\n        - title: Dropdown\n          url: \"#\"\n          below:\n            - title: \"Action\"\n              url: \"#\"\n            - title: \"Another action\"\n              url: \"#\"\n            - {}\n            - title: \"Something else here\"\n              url: \"#\"\n        - title: Disabled\n          url: \"#\"\n          link_attributes:\n            class:\n              - disabled\nprops:\n  attributes:\n    class:\n      - bg-body-tertiary\n  toggler_position: end\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/stories/navbar.responsive.story.yml", "type": "yaml_reference", "topic": "navbar.responsive.story"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Dropdown options: offset\"\nslots:\n  title: \"Offset\"\nprops:\n  variant: dropdown\n  content:\n    - title: \"Action\"\n      url: \"#\"\n    - title: \"Another action\"\n      url: \"#\"\n    - title: \"Something else here\"\n      url: \"#\"\n  button_variant: secondary\n  button_attributes:\n    data-bs-offset: \"10,20\"\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/stories/dropdown.options_offset.story.yml", "type": "yaml_reference", "topic": "dropdown.options offset.story"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Best practices for developers", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Best practices for developers\n\nSame name and namespace in other branches\n\n1. [11.x core/core.api.php](/api/drupal/core%21core.api.php/group/best_practices/11.x) \\best\\_practices\n2. [10 core/core.api.php](/api/drupal/core%21core.api.php/group/best_practices/10) \\best\\_practices\n3. [8.9.x core/core.api.php](/api/drupal/core%21core.api.php/group/best_practices/8.9.x) \\best\\_practices\n\nOverview of standards and best practices for developers\n\nIdeally, all code that is included in Drupal Core and contributed modules,\nthemes, and distributions will be secure, internationalized, maintainable,\nand efficient. In order to facilitate this, the Drupal community has\ndeveloped a set of guidelines and standards for developers to follow. Most of\nthese standards can be found under\n[Best practices on Drupal.org](https://www.drupal.org/developing/best-practices)\n\nStandards and best practices that developers should be aware of include:\n\n* **Security**: <https://www.drupal.org/writing-secure-code> and the\n  Sanitization functions topic\n* **Coding standards**: <https://www.drupal.org/coding-standards>\n  and <https://www.drupal.org/coding-standards/docs>\n* **Accessibility**: <https://www.drupal.org/node/1637990> (modules) and\n  <https://www.drupal.org/node/464472> (themes)\n* **Usability**: <https://www.drupal.org/ui-standards>\n* **Internationalization**: [Internationalization topic](/api/drupal/core%21lib%21Drupal%21Core%21Language%21language.api.php/group/i18n/9 \"Internationalization and translation\")\n* **Automated testing**: [Automated tests topic](/api/drupal/core%21core.api.php/group/testing/9 \"Overview of PHPUnit and Nightwatch automated tests.\")\n\n### File\n\ncore/[core.api.php](/api/drupal/core%21core.api.php/9), line 1555\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=9-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521core.api.php/group/best_practices/9%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21core.api.php/group/best_practices/9.md", "type": "doc_summary", "topic": "Best practices for developers"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: book_settings\nlabel: Book configuration\nmigration_tags:\n  - Drupal 6\n  - Drupal 7\n  - Configuration\nsource:\n  plugin: variable\n  variables:\n    - book_child_type\n    - book_allowed_types\n  source_module: book\nprocess:\n  allowed_types:\n    plugin: callback\n    callable: Drupal\\book\\Migrate\\BookSettingsMigration::convertAllowedTypes\n    source: book_allowed_types\ndestination:\n  plugin: config\n  config_name: book.settings\n", "metadata": {"source": "repos/livre/book/migrations/book_settings.yml", "type": "yaml_reference", "topic": "book settings"}}
{"instruction": "Show me the implementation of the class PublishMultiple in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_batch\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_batch\\Service\\BatchService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_batch_publish',\n  label: new TranslatableMarkup('Batch Publish/Unpublish Content'),\n  description: new TranslatableMarkup('Publish or unpublish multiple content items at once. Maximum 50 items per operation.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'ids' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Node IDs'),\n      description: new TranslatableMarkup('Array of node IDs to publish or unpublish.'),\n      required: TRUE,\n    ),\n    'publish' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Publish'),\n      description: new TranslatableMarkup('If true, publish the content. If false, unpublish. Default is true.'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'action' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Action Performed'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_requested' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Requested'),\n      description: new TranslatableMarkup(''),\n    ),\n    'processed_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Processed Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'unchanged_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Unchanged Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'error_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Error Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'processed' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Processed Items'),\n      description: new TranslatableMarkup(''),\n    ),\n    'unchanged' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Unchanged Items'),\n      description: new TranslatableMarkup(''),\n    ),\n    'errors' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Errors'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass PublishMultiple extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'batch';\n\n\n  protected BatchService $batchService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->batchService = $container->get('mcp_tools_batch.batch');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $ids = $input['ids'] ?? [];\n    $publish = $input['publish'] ?? TRUE;\n\n    if (empty($ids)) {\n      return ['success' => FALSE, 'error' => 'Node IDs array is required.'];\n    }\n\n    return $this->batchService->publishMultiple($ids, (bool) $publish);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_batch/src/Plugin/tool/Tool/PublishMultiple.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PublishMultiple", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for API provider configurations.\napi_normalization.providers:\n  type: config_object\n  label: 'API Provider Configuration'\n  mapping:\n    providers:\n      type: sequence\n      label: 'Providers'\n      sequence:\n        type: mapping\n        label: 'Provider'\n        mapping:\n          id:\n            type: string\n            label: 'Provider ID'\n          label:\n            type: string\n            label: 'Provider Label'\n          description:\n            type: string\n            label: 'Provider Description'\n          normalization_class:\n            type: string\n            label: 'Normalization Class'\n          request_mapper:\n            type: string\n            label: 'Request Mapper Method'\n          response_mapper:\n            type: string\n            label: 'Response Mapper Method'\n          detection_patterns:\n            type: sequence\n            label: 'Detection Patterns'\n            sequence:\n              type: string\n              label: 'Regex Pattern'\n          default_settings:\n            type: mapping\n            label: 'Default Settings'\n            mapping:\n              model:\n                type: string\n                label: 'Default Model'\n              timeout:\n                type: integer\n                label: 'Request Timeout (seconds)'\n              max_tokens:\n                type: integer\n                label: 'Maximum Tokens'\n              temperature:\n                type: float\n                label: 'Temperature'\n              requires_auth:\n                type: boolean\n                label: 'Requires Authentication'\n              auth_header:\n                type: string\n                label: 'Authentication Header Name'\n              option_mappings:\n                type: sequence\n                label: 'Option Mappings'\n                sequence:\n                  type: mapping\n                  label: 'Mapping'\n                  mapping:\n                    source:\n                      type: string\n                      label: 'Source Field'\n                    target:\n                      type: string\n                      label: 'Target Field'\n              response_mappings:\n                type: mapping\n                label: 'Response Field Mappings'\n                mapping:\n                  message_field:\n                    type: string\n                    label: 'Message Field Path'\n                  usage_field:\n                    type: string\n                    label: 'Usage Field Path'\n                  model_field:\n                    type: string\n                    label: 'Model Field Path'\n", "metadata": {"source": "repos/api_normalization/config/schema/api_normalization.providers.schema.yml", "type": "yaml_reference", "topic": "api normalization.providers.schema"}}
{"instruction": "Show me the implementation of the class JsonSchemaValidator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Service;\n\nuse JsonSchema\\Validator;\nuse JsonSchema\\Constraints\\Constraint;\n\n/**\n * Service for validating data against JSON Schema.\n *\n * Uses justinrainbow/json-schema library for validation.\n * Supports both strict and soft validation modes.\n */\nclass JsonSchemaValidator {\n\n  /**\n   * Validate data against a JSON Schema.\n   *\n   * @param mixed $data\n   *   The data to validate.\n   * @param array<string, mixed> $schema\n   *   The JSON Schema definition.\n   * @param string $mode\n   *   Validation mode: \"strict\" or \"soft\".\n   *   - strict: Throws exception on validation failure.\n   *   - soft: Returns validation result without throwing.\n   *\n   * @return array{valid: bool, errors: array<int, array{property: string, message: string}>}\n   *   Validation result with valid flag and array of errors.\n   *\n   * @throws \\InvalidArgumentException\n   *   When validation fails in strict mode.\n   */\n  public function validate(mixed $data, array $schema, string $mode = \"soft\"): array {\n    // If no schema provided, consider it valid.\n    if (empty($schema)) {\n      return [\n        \"valid\" => TRUE,\n        \"errors\" => [],\n      ];\n    }\n\n    // Convert PHP array to object for json-schema library.\n    $dataObject = $this->convertToObject($data);\n    $schemaObject = $this->convertToObject($schema);\n\n    // Create validator and validate.\n    $validator = new Validator();\n    $validator->validate(\n      $dataObject,\n      $schemaObject,\n      Constraint::CHECK_MODE_TYPE_CAST\n    );\n\n    // Collect errors.\n    $errors = [];\n    if (!$validator->isValid()) {\n      foreach ($validator->getErrors() as $error) {\n        $errors[] = [\n          \"property\" => $error[\"property\"] ?? \"\",\n          \"message\" => $error[\"message\"] ?? \"Unknown validation error\",\n        ];\n      }\n    }\n\n    $isValid = $validator->isValid();\n\n    // In strict mode, throw exception if invalid.\n    if ($mode === \"strict\" && !$isValid) {\n      $errorMessages = array_map(\n        fn(array $err): string => sprintf(\"[%s] %s\", $err[\"property\"], $err[\"message\"]),\n        $errors\n      );\n      throw new \\InvalidArgumentException(\n        sprintf(\"Schema validation failed: %s\", implode(\"; \", $errorMessages))\n      );\n    }\n\n    return [\n      \"valid\" => $isValid,\n      \"errors\" => $errors,\n    ];\n  }\n\n  /**\n   * Convert PHP array to object recursively for json-schema validation.\n   *\n   * The json-schema library expects stdClass objects for object validation.\n   *\n   * @param mixed $data\n   *   The data to convert.\n   *\n   * @return mixed\n   *   The converted data with arrays as stdClass where appropriate.\n   */\n  protected function convertToObject(mixed $data): mixed {\n    if (!is_array($data)) {\n      return $data;\n    }\n\n    // Check if this is an associative array (object) or sequential array.\n    if ($this->isAssociativeArray($data)) {\n      $object = new \\stdClass();\n      foreach ($data as $key => $value) {\n        $object->{$key} = $this->convertToObject($value);\n      }\n      return $object;\n    }\n\n    // Sequential array - convert items but keep as array.\n    return array_map([$this, \"convertToObject\"], $data);\n  }\n\n  /**\n   * Check if an array is associative (has string keys).\n   *\n   * @param array<mixed> $array\n   *   The array to check.\n   *\n   * @return bool\n   *   TRUE if associative, FALSE if sequential.\n   */\n  protected function isAssociativeArray(array $array): bool {\n    if (empty($array)) {\n      return FALSE;\n    }\n\n    return array_keys($array) !== range(0, count($array) - 1);\n  }\n\n  /**\n   * Generate a default schema from sample data.\n   *\n   * This is a helper method for users to generate initial schemas.\n   *\n   * @param mixed $data\n   *   The sample data.\n   *\n   * @return array<string, mixed>\n   *   A basic JSON Schema derived from the data.\n   */\n  public function generateSchemaFromData(mixed $data): array {\n    return $this->inferSchema($data);\n  }\n\n  /**\n   * Infer schema from data recursively.\n   *\n   * @param mixed $data\n   *   The data to infer schema from.\n   *\n   * @return array<string, mixed>\n   *   The inferred schema.\n   */\n  protected function inferSchema(mixed $data): array {\n    if ($data === NULL) {\n      return [\"type\" => \"null\"];\n    }\n\n    if (is_bool($data)) {\n      return [\"type\" => \"boolean\"];\n    }\n\n    if (is_int($data)) {\n      return [\"type\" => \"integer\"];\n    }\n\n    if (is_float($data)) {\n      return [\"type\" => \"number\"];\n    }\n\n    if (is_string($data)) {\n      return [\"type\" => \"string\"];\n    }\n\n    if (is_array($data)) {\n      // Check if sequential or associative.\n      if (empty($data)) {\n        return [\"type\" => \"array\", \"items\" => []];\n      }\n\n      if ($this->isAssociativeArray($data)) {\n        $properties = [];\n        foreach ($data as $key => $value) {\n          $properties[$key] = $this->inferSchema($value);\n        }\n        return [\n          \"type\" => \"object\",\n          \"properties\" => $properties,\n        ];\n      }\n\n      // Sequential array - infer from first item.\n      return [\n        \"type\" => \"array\",\n        \"items\" => $this->inferSchema($data[0]),\n      ];\n    }\n\n    if (is_object($data)) {\n      $properties = [];\n      foreach (get_object_vars($data) as $key => $value) {\n        $properties[$key] = $this->inferSchema($value);\n      }\n      return [\n        \"type\" => \"object\",\n        \"properties\" => $properties,\n      ];\n    }\n\n    return [\"type\" => \"mixed\"];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Service/JsonSchemaValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "JsonSchemaValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: LanguageEditForm.php\nTarget symbol: class LanguageEditForm\nNamespace: Drupal\\language\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LanguageEditForm.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - actions()\n  - form()\n  - getFormId()\n  - save()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\language\\Form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Controller for language edit forms.\n *\n * @internal\n */\nclass LanguageEditForm extends LanguageFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    // @todo Remove in favor of base method.\n    return 'language_admin_edit_form';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    $this->commonForm($form);\n    return parent::form($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function actions(array $form, FormStateInterface $form_state) {\n    $actions['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Save language'),\n      '#validate' => ['::validateCommon'],\n      '#submit' => ['::submitForm', '::save'],\n    ];\n    return $actions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    parent::save($form, $form_state);\n    $form_state->setRedirectUrl($this->entity->toUrl('collection'));\n    $this->logger('language')\n      ->notice('The %language (%langcode) language has been updated.', [\n        '%language' => $this->entity->label(),\n        '%langcode' => $this->entity->id(),\n      ]);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/language/src/Form/LanguageEditForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageEditForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - core.entity_view_mode.node.rss\n    - field.field.node.article.field_body\n    - field.field.node.article.field_media_image\n    - field.field.node.article.field_tags\n    - field.field.node.article.layout_builder__layout\n    - node.type.article\n  module:\n    - user\nid: node.article.rss\ntargetEntityType: node\nbundle: article\nmode: rss\ncontent:\n  links:\n    weight: 100\n    region: content\nhidden:\n  content_moderation_control: true\n  field_body: true\n  field_media_image: true\n  field_tags: true\n  langcode: true\n  layout_builder__layout: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/core.entity_view_display.node.article.rss.yml", "type": "yaml_reference", "topic": "core.entity view display.node.article.rss"}}
{"instruction": "Show me the implementation of the class LogsDataCollector in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\DataCollector;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\monolog\\Logger\\LoggerInterfacesAdapter;\nuse Psr\\Log\\LoggerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\DataCollector\\LateDataCollectorInterface;\nuse Symfony\\Component\\HttpKernel\\Log\\DebugLoggerInterface;\n\n/**\n * Collects logs data.\n */\nclass LogsDataCollector extends DataCollector implements HasPanelInterface, LateDataCollectorInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * LogsDataCollector constructor.\n   *\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(private readonly LoggerInterface $logger) {\n    $this->data['logs'] = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'logs';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function collect(Request $request, Response $response, ?\\Throwable $exception = NULL): void {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function lateCollect() {\n    $logger = $this->logger;\n\n    if (\n      $logger instanceof LoggerInterfacesAdapter and\n      ($adapted_logger = $logger->getAdaptedLogger()) instanceof DebugLoggerInterface\n    ) {\n      $this->data['logs'] = \\array_map(\n        static function ($log) {\n          unset($log['context']['exception']);\n          unset($log['context']['backtrace']);\n\n          return $log;\n        },\n        $adapted_logger->getLogs(),\n      );\n    }\n  }\n\n  /**\n   * Reset the collected data.\n   */\n  public function reset(): void {\n    $this->data = [];\n  }\n\n  /**\n   * Return the number of logs.\n   *\n   * @return int\n   *   The number of logs.\n   */\n  public function getLogsCount(): int {\n    return \\count($this->data['logs']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPanel(): array {\n    return [\n      '#theme' => 'webprofiler_dashboard_section',\n      '#data' => [\n        '#type' => 'table',\n        '#header' => [\n          $this->t('Priority'),\n          $this->t('Channel'),\n          $this->t('Message'),\n        ],\n        '#rows' => \\array_map(function ($log) {\n          return [\n            $log['priorityName'],\n            $log['channel'],\n            $this->processContext($log['message'], $log['context']),\n          ];\n        }, $this->data['logs']),\n        '#attributes' => [\n          'class' => [\n            'webprofiler__table',\n          ],\n        ],\n        '#sticky' => TRUE,\n      ],\n    ];\n  }\n\n  /**\n   * Process the context.\n   *\n   * @param string $message\n   *   The message.\n   * @param array $context\n   *   The context.\n   *\n   * @return string\n   *   The processed context.\n   */\n  private function processContext(string $message, array $context): string {\n    $replacements = [];\n    foreach ($context as $key => $value) {\n      if (\\is_array($value) || \\is_object($value)) {\n        $value = \\json_encode($value);\n      }\n      $replacements['{' . $key . '}'] = $value;\n    }\n\n    return \\strtr($message, $replacements);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/DataCollector/LogsDataCollector.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LogsDataCollector", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class GroupByNumeric in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\filter;\n\nuse Drupal\\views\\Attribute\\ViewsFilter;\n\n/**\n * Simple filter to handle greater than/less than filters.\n *\n * @ingroup views_filter_handlers\n */\n#[ViewsFilter(\"groupby_numeric\")]\nclass GroupByNumeric extends NumericFilter {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    $this->ensureMyTable();\n    $field = $this->getField();\n\n    $info = $this->operators();\n    if (!empty($info[$this->operator]['method'])) {\n      $this->{$info[$this->operator]['method']}($field);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function opBetween($field) {\n    $placeholder_min = $this->placeholder();\n    $placeholder_max = $this->placeholder();\n    if ($this->operator == 'between') {\n      $this->query->addHavingExpression($this->options['group'], \"$field >= $placeholder_min\", [$placeholder_min => $this->value['min']]);\n      $this->query->addHavingExpression($this->options['group'], \"$field <= $placeholder_max\", [$placeholder_max => $this->value['max']]);\n    }\n    else {\n      $this->query->addHavingExpression($this->options['group'], \"$field < $placeholder_min OR $field > $placeholder_max\", [\n        $placeholder_min => $this->value['min'],\n        $placeholder_max => $this->value['max'],\n      ]);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function opSimple($field) {\n    $placeholder = $this->placeholder();\n    $this->query->addHavingExpression($this->options['group'], \"$field $this->operator $placeholder\", [$placeholder => $this->value['value']]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function opEmpty($field) {\n    if ($this->operator == 'empty') {\n      $operator = \"IS NULL\";\n    }\n    else {\n      $operator = \"IS NOT NULL\";\n    }\n\n    $this->query->addHavingExpression($this->options['group'], \"$field $operator\");\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function adminLabel($short = FALSE) {\n    return $this->getField(parent::adminLabel($short));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function canGroup() {\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/filter/GroupByNumeric.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "GroupByNumeric", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Recipe Code Installer'\ndescription: 'Allows Drupal Recipes to package and install bundled code as custom module that becomes part of a project\u2019s codebase.'\npackage: Development\ntype: module\ncore_version_requirement: ^10.4.0 || ^11.1.0\n", "metadata": {"source": "repos/recipe_code_installer/recipe_code_installer.info.yml", "type": "yaml_reference", "topic": "recipe code installer.info"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CreateRedirect.php\nTarget symbol: class CreateRedirect\nNamespace: Drupal\\mcp_tools_redirect\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CreateRedirect.\n- Include required imports:\n  - Drupal\\mcp_tools_redirect\\Service\\RedirectService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_redirect\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_redirect\\Service\\RedirectService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_redirect_create',\n  label: new TranslatableMarkup('Create Redirect'),\n  description: new TranslatableMarkup('Create a new URL redirect. This is a write operation.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'source' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Path'),\n      description: new TranslatableMarkup('The source path to redirect from (e.g., \"old-page\" or \"/old-page\").'),\n      required: TRUE,\n    ),\n    'destination' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Destination'),\n      description: new TranslatableMarkup('The destination path or URL to redirect to (e.g., \"/new-page\" or \"https://example.com\").'),\n      required: TRUE,\n    ),\n    'status_code' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Status Code'),\n      description: new TranslatableMarkup('HTTP redirect status code: 301 (permanent), 302 (temporary), 303, or 307. Default: 301.'),\n      required: FALSE,\n    ),\n    'language' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Language'),\n      description: new TranslatableMarkup('Language code for language-specific redirect (e.g., \"en\", \"de\"). Leave empty for language-neutral.'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'redirect' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Created Redirect'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CreateRedirect extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'redirect';\n\n\n  protected RedirectService $redirectService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->redirectService = $container->get('mcp_tools_redirect.redirect');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $source = $input['source'] ?? '';\n    $destination = $input['destination'] ?? '';\n    $statusCode = $input['status_code'] ?? 301;\n    $language = $input['language'] ?? NULL;\n\n    if (empty($source)) {\n      return ['success' => FALSE, 'error' => 'Source path is required.'];\n    }\n\n    if (empty($destination)) {\n      return ['success' => FALSE, 'error' => 'Destination is required.'];\n    }\n\n    return $this->redirectService->createRedirect($source, $destination, (int) $statusCode, $language);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_redirect/src/Plugin/tool/Tool/CreateRedirect.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CreateRedirect", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: DisplayRouterInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views\\Plugin\\views\\display;\n\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Defines an interface for displays that can collect routes.\n *\n * In addition to implementing the interface, specify 'uses_route' in the\n * plugin definition.\n */\ninterface DisplayRouterInterface extends DisplayPluginInterface {\n\n  /**\n   * Adds the route entry of a view to the collection.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   A collection of routes that should be registered for this resource.\n   */\n  public function collectRoutes(RouteCollection $collection);\n\n  /**\n   * Alters a collection of routes and replaces definitions to the view.\n   *\n   * Most of the collections won't have the needed route, so by the return value\n   * the method can specify to break the search.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   The route collection.\n   *\n   * @return array\n   *   Returns a list of \"$view_id.$display_id\" elements which got overridden.\n   */\n  public function alterRoutes(RouteCollection $collection);\n\n  /**\n   * Generates a URL to this display.\n   *\n   * @return \\Drupal\\Core\\Url\n   *   A URL object for the display.\n   */\n  public function getUrlInfo();\n\n  /**\n   * Returns the route name for the display.\n   *\n   * The default route name for a display is views.$view_id.$display_id. Some\n   * displays may override existing routes; in these cases, the route that is\n   * overridden is returned instead.\n   *\n   * @return string\n   *   The name of the route\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::alterRoutes()\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::getAlteredRouteNames()\n   */\n  public function getRouteName();\n\n  /**\n   * Returns the list of routes overridden by Views.\n   *\n   * @return string[]\n   *   An array of overridden route names. The keys are in the form\n   *   view_id.display_id and the values are the route names.\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::alterRoutes()\n   */\n  public function getAlteredRouteNames();\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\display;\n\nuse Symfony\\Component\\Routing\\RouteCollection;\n\n/**\n * Defines an interface for displays that can collect routes.\n *\n * In addition to implementing the interface, specify 'uses_route' in the\n * plugin definition.\n */\ninterface DisplayRouterInterface extends DisplayPluginInterface {\n\n  /**\n   * Adds the route entry of a view to the collection.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   A collection of routes that should be registered for this resource.\n   */\n  public function collectRoutes(RouteCollection $collection);\n\n  /**\n   * Alters a collection of routes and replaces definitions to the view.\n   *\n   * Most of the collections won't have the needed route, so by the return value\n   * the method can specify to break the search.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   The route collection.\n   *\n   * @return array\n   *   Returns a list of \"$view_id.$display_id\" elements which got overridden.\n   */\n  public function alterRoutes(RouteCollection $collection);\n\n  /**\n   * Generates a URL to this display.\n   *\n   * @return \\Drupal\\Core\\Url\n   *   A URL object for the display.\n   */\n  public function getUrlInfo();\n\n  /**\n   * Returns the route name for the display.\n   *\n   * The default route name for a display is views.$view_id.$display_id. Some\n   * displays may override existing routes; in these cases, the route that is\n   * overridden is returned instead.\n   *\n   * @return string\n   *   The name of the route\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::alterRoutes()\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::getAlteredRouteNames()\n   */\n  public function getRouteName();\n\n  /**\n   * Returns the list of routes overridden by Views.\n   *\n   * @return string[]\n   *   An array of overridden route names. The keys are in the form\n   *   view_id.display_id and the values are the route names.\n   *\n   * @see \\Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface::alterRoutes()\n   */\n  public function getAlteredRouteNames();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/display/DisplayRouterInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "DisplayRouterInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class ViewsMenuLink in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Drupal\\views\\Plugin\\views\\display\\DisplayMenuInterface;\nuse Drupal\\views\\Views;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides menu links for Views.\n *\n * @see \\Drupal\\views\\Plugin\\Menu\\ViewsMenuLink\n */\nclass ViewsMenuLink extends DeriverBase implements ContainerDeriverInterface {\n\n  /**\n   * The view storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected $viewStorage;\n\n  /**\n   * Constructs a \\Drupal\\views\\Plugin\\Derivative\\ViewsLocalTask instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $view_storage\n   *   The view storage.\n   */\n  public function __construct(EntityStorageInterface $view_storage) {\n    $this->viewStorage = $view_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $container->get('entity_type.manager')->getStorage('view')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    $links = [];\n    $views = Views::getApplicableViews('uses_menu_links');\n\n    foreach ($views as $data) {\n      [$view_id, $display_id] = $data;\n      /** @var \\Drupal\\views\\ViewExecutable $executable */\n      $executable = $this->viewStorage->load($view_id)->getExecutable();\n      $executable->initDisplay();\n      $display = $executable->displayHandlers->get($display_id);\n\n      if (($display instanceof DisplayMenuInterface) && ($result = $display->getMenuLinks())) {\n        foreach ($result as $link_id => $link) {\n          $links[$link_id] = $link + $base_plugin_definition;\n        }\n      }\n    }\n\n    return $links;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/Derivative/ViewsMenuLink.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsMenuLink", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Responsive Images", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Usage](/docs/develop/mobile-drupal-sites/responsive-images#s-usage)\n\n## [Mobile Drupal sites](/docs/develop/mobile-drupal-sites)\n\n* [Front-end performance](/docs/develop/mobile-drupal-sites/front-end-performance)\n* [Mobile Testing Tools](/docs/develop/mobile-drupal-sites/mobile-testing-tools)\n* [Mobile-specific website](/docs/mobile-drupal-sites/mobile-specific-website)\n* [Native mobile apps](/docs/mobile-drupal-sites/native-mobile-application-development)\n* [Related mobile technologies](/docs/mobile-drupal-sites/related-mobile-technologies)\n* [Responsive Design + Server-side Components (RESS)](/docs/mobile-drupal-sites/responsive-design-server-side-components-ress)\n* [Responsive Images](/docs/develop/mobile-drupal-sites/responsive-images)\n* [Responsive web design](/docs/develop/mobile-drupal-sites/responsive-web-design)\n* [Web-based mobile apps](/docs/mobile-drupal-sites/web-based-mobile-apps)\n\n# Responsive Images\n\nLast [updated](/node/2352725/discuss) on\n\n25 July 2025\n\n**Note: This page could use some more information!**\n\nUsing responsive images means loading images that have been specifically sized for the user screen based on\u00a0breakpoints. This practice makes websites load faster on mobile devices because image sizes are optimized for mobile devices. This is different than fluid images when large images are scaled down with CSS.\n\nResponsive images transmit less data than fluid images by sending the smallest image necessary for the receiving device.\u00a0 Whereas fluid transmits one size, perhaps the largest size, then forces the device to scale it down.\u00a0 As you can imagine, sending a 1MB fluid image takes far longer than a 100KB responsive image, especially over slow cellular signals.\u00a0 Also consider the cost of data on the site visitor, who might not visit again because of that cost.\n\nUse both, responsive images and fluid image css. Because of the large number of screen sizes, site editors can't possibly store all screen size variations.\u00a0 But they could store two, three and maybe even four sizes of each image.\u00a0 Only one of these stored images (the roughly right size one) gets transmitted to the device.\u00a0 Then css fluid image adjusts the image to fit the exact device size to make it look good.\n\nOk, for the discerning reader, an image is an image, whereas the words responsive and fluid describe the processing of that image. Responsive image sizes get processed by a site editor, whereas fluid gets processed by a browser.\n\nThe Responsive Image module in Drupal 8 and later versions provides an image formatter and breakpoint mappings to output responsive images using the HTML5 picture tag. Responsive image includes a fallback support for Internet Explorer 8. To get images in IE 8 that aren't mobile sized, you'll need to configure the fallback in your display to use your desktop image size rather than 'automatic'.\n\n### Usage\n\nPrerequisites\n:   Make sure both *Breakpoint* and *Responsive image* modules are enabled. These modules are available as Drupal 8 core modules.\n\nDefining responsive image styles\n:   By creating responsive image mappings you define the image styles that are being used to output images at certain breakpoints. On the Responsive image mappings admin page `/admin/config/media/responsive-image-style`\u00a0click *Add responsive image style* to create a new style. First, select a label and a breakpoint group and click Save. After that, you can choose the image styles that will be used for each breakpoint. Image styles can be defined on the Image styles page that is provided by the Image module. Breakpoints are defined in the configuration files of the theme; see [Working with breakpoints in Drupal 8](https://www.drupal.org/documentation/modules/breakpoint) for more about breakpoints.\n\nUsing responsive image styles in Image fields\n:   After defining responsive image styles, you can use them in the display settings for your Image fields, so that the site displays responsive images using the HTML5 picture tag. Open the Manage display page for the entity type (content type, taxonomy vocabulary, etc.) that the Image field is attached to. Choose the *Responsive image*\u00a0format, click the Edit icon, and select one of the responsive image mappings that you have created.\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2352725/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282352725%29%20Responsive%20Images) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/mobile-drupal-sites/responsive-images.md", "type": "doc_summary", "topic": "Responsive Images"}}
{"instruction": "Show me the implementation of the interface EntityStorageSchemaInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Schema;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeListenerInterface;\n\n/**\n * Defines the interface for entity storage schema handler classes.\n *\n * An entity type's storage schema handler is responsible for creating the\n * storage backend's schema that the entity type's storage handler needs for\n * storing its entities. For example, if the storage handler is for a SQL\n * backend, then the storage schema handler is responsible for creating the\n * needed tables. During the application lifetime, an entity type's definition\n * can change in a way that requires changes to the storage schema, so this\n * interface defines methods for that as well.\n *\n * @see \\Drupal\\Core\\Entity\\EntityStorageInterface\n */\ninterface EntityStorageSchemaInterface extends EntityTypeListenerInterface {\n\n  /**\n   * Checks if the changes to the entity type requires storage schema changes.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The updated entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The original entity type definition.\n   *\n   * @return bool\n   *   TRUE if storage schema changes are required, FALSE otherwise.\n   */\n  public function requiresEntityStorageSchemaChanges(EntityTypeInterface $entity_type, EntityTypeInterface $original);\n\n  /**\n   * Checks if existing data would be lost if the schema changes were applied.\n   *\n   * If there are no schema changes needed, then no data needs to be migrated,\n   * but it is not the responsibility of this function to recheck what\n   * requiresEntityStorageSchemaChanges() checks. Rather, the meaning of what\n   * this function returns when requiresEntityStorageSchemaChanges() returns\n   * FALSE is undefined. Callers are expected to only call this function when\n   * requiresEntityStorageSchemaChanges() is TRUE.\n   *\n   * This function can return FALSE if any of these conditions apply:\n   * - There are no existing entities for the entity type.\n   * - There are existing entities, but the schema changes can be applied\n   *   without losing their data (e.g., if the schema changes can be performed\n   *   by altering tables rather than dropping and recreating them).\n   * - The only entity data that would be lost are ones that are not valid for\n   *   the new definition (e.g., if changing an entity type from revisionable\n   *   to non-revisionable, then it's okay to drop data for the non-default\n   *   revision).\n   *\n   * When this function returns FALSE, site administrators will be unable to\n   * perform an automated update, and will instead need to perform a site\n   * migration or invoke some custom update process.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The updated entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The original entity type definition.\n   *\n   * @return bool\n   *   TRUE if data migration is required, FALSE otherwise.\n   *\n   * @see self::requiresEntityStorageSchemaChanges()\n   */\n  public function requiresEntityDataMigration(EntityTypeInterface $entity_type, EntityTypeInterface $original);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Schema/EntityStorageSchemaInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityStorageSchemaInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class UpdateSettings in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\update\\Plugin\\migrate\\source;\n\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\Variable;\n\n/**\n * Drupal 6/7 Update settings source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate_drupal\\Plugin\\migrate\\source\\Variable\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"update_settings\",\n *   source_module = \"update\"\n * )\n */\nclass UpdateSettings extends Variable {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function values() {\n    $values = parent::values();\n    if (empty($values['update_fetch_url']) || str_contains($values['update_fetch_url'], 'http://updates.drupal.org/release-history')) {\n      $values['update_fetch_url'] = 'https://updates.drupal.org/release-history';\n    }\n    return $values;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/update/src/Plugin/migrate/source/UpdateSettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UpdateSettings", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "mcp_tools use menus:\n  title: 'Use MCP menu tools'\n  description: 'Create, delete menus and manage menu links via MCP.'\n  restrict access: true\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_menus/mcp_tools_menus.permissions.yml", "type": "yaml_reference", "topic": "mcp tools menus.permissions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: d6_node_settings\nlabel: Node configuration\nmigration_tags:\n  - Drupal 6\n  - Configuration\nsource:\n  plugin: variable\n  variables:\n    - node_admin_theme\n  source_module: node\nprocess:\n  use_admin_theme: node_admin_theme\ndestination:\n  plugin: config\n  config_name: node.settings\n", "metadata": {"source": "repos/drupal_core/core/modules/node/migrations/d6_node_settings.yml", "type": "yaml_reference", "topic": "d6 node settings"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: BookBreadcrumbBuilder\nSource file: <source_file>\nFile name hint: BookBreadcrumbBuilder.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\book;\n\nuse Drupal\\Core\\Breadcrumb\\Breadcrumb;\nuse Drupal\\Core\\Breadcrumb\\BreadcrumbBuilderInterface;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Link;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Provides a breadcrumb builder for nodes in a book.\n */\nclass BookBreadcrumbBuilder implements BreadcrumbBuilderInterface {\n  use StringTranslationTrait;\n\n  /**\n   * The node storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected EntityStorageInterface $nodeStorage;\n\n  /**\n   * Constructs the BookBreadcrumbBuilder.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager service.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The current user account.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entityRepository\n   *   The entity repository service.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $languageManager\n   *   The language manager service.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   */\n  function __construct(\n    EntityTypeManagerInterface $entity_type_manager,\n    protected AccountInterface $account,\n    protected EntityRepositoryInterface $entityRepository,\n    protected LanguageManagerInterface $languageManager,\n  ) {\n    $this->nodeStorage = $entity_type_manager->getStorage('node');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies(RouteMatchInterface $route_match, ?CacheableMetadata $cacheable_metadata = NULL): bool {\n    // @todo Remove null safe operator after Drupal 12.0.0 becomes the minimum\n    //   requirement, see https://www.drupal.org/project/drupal/issues/3459277.\n    $cacheable_metadata?->addCacheContexts(['route.book_navigation']);\n    $node = $route_match->getParameter('node');\n    return $node instanceof NodeInterface && !empty($node->getBook());\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function build(RouteMatchInterface $route_match): Breadcrumb {\n    $book_nids = [];\n    $breadcrumb = new Breadcrumb();\n\n    $links = [Link::createFromRoute($this->t('Home'), '<front>', [], [\n      'language' => $this->languageManager->getCurrentLanguage(LanguageInterface::TYPE_CONTENT),\n    ]),\n    ];\n    $breadcrumb->addCacheContexts(['languages:' . LanguageInterface::TYPE_CONTENT]);\n    $book = $route_match->getParameter('node')->getBook();\n    $depth = 1;\n    // We skip the current node.\n    while (!empty($book['p' . ($depth + 1)])) {\n      $book_nids[] = $book['p' . $depth];\n      $depth++;\n    }\n    /** @var \\Drupal\\node\\NodeInterface[] $parent_books */\n    $parent_books = $this->nodeStorage->loadMultiple($book_nids);\n    $parent_books = array_map([$this->entityRepository, 'getTranslationFromContext'], $parent_books);\n    if (count($parent_books) > 0) {\n      $depth = 1;\n      while (!empty($book['p' . ($depth + 1)])) {\n        if (!empty($parent_books[$book['p' . $depth]]) && ($parent_book = $parent_books[$book['p' . $depth]])) {\n          $access = $parent_book->access('view', $this->account, TRUE);\n          $breadcrumb->addCacheableDependency($access);\n          if ($access->isAllowed()) {\n            $breadcrumb->addCacheableDependency($parent_book);\n            $links[] = $parent_book->toLink();\n          }\n        }\n        $depth++;\n      }\n    }\n    $breadcrumb->setLinks($links);\n    // @todo Remove after Drupal 12.0.0 becomes the minimum requirement,\n    //   see https://www.drupal.org/project/drupal/issues/3459277.\n    $breadcrumb->addCacheContexts(['route.book_navigation']);\n    return $breadcrumb;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\book;\n\nuse Drupal\\Core\\Breadcrumb\\Breadcrumb;\nuse Drupal\\Core\\Breadcrumb\\BreadcrumbBuilderInterface;\nuse Drupal\\Core\\Cache\\CacheableMetadata;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Link;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\node\\NodeInterface;\n\n/**\n * Provides a breadcrumb builder for nodes in a book.\n */\nclass BookBreadcrumbBuilder implements BreadcrumbBuilderInterface {\n  use StringTranslationTrait;\n\n  /**\n   * The node storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   */\n  protected EntityStorageInterface $nodeStorage;\n\n  /**\n   * Constructs the BookBreadcrumbBuilder.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager service.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The current user account.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entityRepository\n   *   The entity repository service.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $languageManager\n   *   The language manager service.\n   *\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException\n   * @throws \\Drupal\\Component\\Plugin\\Exception\\PluginNotFoundException\n   */\n  public function __construct(\n    EntityTypeManagerInterface $entity_type_manager,\n    protected AccountInterface $account,\n    protected EntityRepositoryInterface $entityRepository,\n    protected LanguageManagerInterface $languageManager,\n  ) {\n    $this->nodeStorage = $entity_type_manager->getStorage('node');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies(RouteMatchInterface $route_match, ?CacheableMetadata $cacheable_metadata = NULL): bool {\n    // @todo Remove null safe operator after Drupal 12.0.0 becomes the minimum\n    //   requirement, see https://www.drupal.org/project/drupal/issues/3459277.\n    $cacheable_metadata?->addCacheContexts(['route.book_navigation']);\n    $node = $route_match->getParameter('node');\n    return $node instanceof NodeInterface && !empty($node->getBook());\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityMalformedException\n   */\n  public function build(RouteMatchInterface $route_match): Breadcrumb {\n    $book_nids = [];\n    $breadcrumb = new Breadcrumb();\n\n    $links = [Link::createFromRoute($this->t('Home'), '<front>', [], [\n      'language' => $this->languageManager->getCurrentLanguage(LanguageInterface::TYPE_CONTENT),\n    ]),\n    ];\n    $breadcrumb->addCacheContexts(['languages:' . LanguageInterface::TYPE_CONTENT]);\n    $book = $route_match->getParameter('node')->getBook();\n    $depth = 1;\n    // We skip the current node.\n    while (!empty($book['p' . ($depth + 1)])) {\n      $book_nids[] = $book['p' . $depth];\n      $depth++;\n    }\n    /** @var \\Drupal\\node\\NodeInterface[] $parent_books */\n    $parent_books = $this->nodeStorage->loadMultiple($book_nids);\n    $parent_books = array_map([$this->entityRepository, 'getTranslationFromContext'], $parent_books);\n    if (count($parent_books) > 0) {\n      $depth = 1;\n      while (!empty($book['p' . ($depth + 1)])) {\n        if (!empty($parent_books[$book['p' . $depth]]) && ($parent_book = $parent_books[$book['p' . $depth]])) {\n          $access = $parent_book->access('view', $this->account, TRUE);\n          $breadcrumb->addCacheableDependency($access);\n          if ($access->isAllowed()) {\n            $breadcrumb->addCacheableDependency($parent_book);\n            $links[] = $parent_book->toLink();\n          }\n        }\n        $depth++;\n      }\n    }\n    $breadcrumb->setLinks($links);\n    // @todo Remove after Drupal 12.0.0 becomes the minimum requirement,\n    //   see https://www.drupal.org/project/drupal/issues/3459277.\n    $breadcrumb->addCacheContexts(['route.book_navigation']);\n    return $breadcrumb;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/BookBreadcrumbBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BookBreadcrumbBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: UserNameUnique.php\nTarget symbol: class UserNameUnique\nNamespace: Drupal\\user\\Plugin\\Validation\\Constraint\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for UserNameUnique.\n- Include required imports:\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\Core\\Validation\\Attribute\\Constraint\n  - Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint\\UniqueFieldConstraint\n  - Symfony\\Component\\Validator\\Attribute\\HasNamedArguments\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\user\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint\\UniqueFieldConstraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\n\n/**\n * Checks if a user name is unique on the site.\n */\n#[Constraint(\n  id: 'UserNameUnique',\n  label: new TranslatableMarkup('User name unique', [], ['context' => 'Validation'])\n)]\nclass UserNameUnique extends UniqueFieldConstraint {\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?bool $caseSensitive = NULL,\n    $message = 'The username %value is already taken.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $caseSensitive, $message, $groups, $payload);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/Validation/Constraint/UserNameUnique.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UserNameUnique", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: CKEditor5PluginConfigurableInterface.php\nBroken snippet:\n<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Defines an interface for configurable CKEditor 5 plugins.\n *\n * This allows a CKEditor 5 plugin to define a settings form. These settings can\n * then be automatically passed on to the corresponding CKEditor 5 instance via\n * CKEditor5PluginInterface::getDynamicPluginConfig().\n *\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginConfigurableTrait\n * @see \\Drupal\\ckeditor5\\CKEditor5PluginInterface\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginBase\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginManagerInterface\n * @see \\Drupal\\ckeditor5\\Annotation\\CKEditor5Plugin\n * @see plugin_api\n */\ninterface CKEditor5PluginConfigurableInterface extends CKEditor5PluginInterface, ConfigurableInterface, PluginFormInterface {\n\n}\n// BUG: ensure this implementation follows Drupal 11 and PHP 8.3.", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Defines an interface for configurable CKEditor 5 plugins.\n *\n * This allows a CKEditor 5 plugin to define a settings form. These settings can\n * then be automatically passed on to the corresponding CKEditor 5 instance via\n * CKEditor5PluginInterface::getDynamicPluginConfig().\n *\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginConfigurableTrait\n * @see \\Drupal\\ckeditor5\\CKEditor5PluginInterface\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginBase\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginManagerInterface\n * @see \\Drupal\\ckeditor5\\Annotation\\CKEditor5Plugin\n * @see plugin_api\n */\ninterface CKEditor5PluginConfigurableInterface extends CKEditor5PluginInterface, ConfigurableInterface, PluginFormInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Plugin/CKEditor5PluginConfigurableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CKEditor5PluginConfigurableInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class DayDate in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a day.\n */\n#[ViewsArgument(\n  id: 'datetime_day',\n)]\nclass DayDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'd';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/views/argument/DayDate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DayDate", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Getting Started", "input": "", "output": "# Getting Started\n\n**Quick start guide for API Normalization module**\n\n---\n\n## Overview\n\nThis guide will help you get started with the API Normalization module in 5 minutes.\n\n---\n\n## Step 1: Import an OpenAPI Schema\n\nThe module can import and validate OpenAPI 3.1 schemas:\n\n```bash\ndrush api-normalization:import-schema /path/to/openapi.yaml\n```\n\nOr via the admin UI at `/admin/config/services/api_normalization/import`\n\n---\n\n## Step 2: Normalize API Data\n\nUse the normalization service to normalize API responses:\n\n```php\nuse Drupal\\api_normalization\\Service\\NormalizationOrchestrator;\n\n$orchestrator = \\Drupal::service('api_normalization.orchestrator');\n$normalized = $orchestrator->normalize($api_response_data);\n```\n\n---\n\n## Step 3: Transform Data (Optional)\n\nApply transformations using plugins:\n\n```php\nuse Drupal\\api_normalization\\Service\\TransformationEngine;\n\n$engine = \\Drupal::service('api_normalization.transformation_engine');\n$transformed = $engine->transform($normalized_data, [\n  'case' => 'snake_case',\n  'date_format' => 'Y-m-d',\n]);\n```\n\n---\n\n## Step 4: Generate Entities\n\nCreate Drupal entities from normalized data:\n\n```php\nuse Drupal\\api_normalization\\Service\\EntityGenerator;\n\n$generator = \\Drupal::service('api_normalization.entity_generator');\n$entity = $generator->generateEntity(\n  $transformed_data,\n  'entity_type',\n  'bundle_name'\n);\n```\n\n---\n\n## Common Use Cases\n\n### Use Case 1: Import External API Data\n\n```php\n// 1. Fetch API data\n$response = \\Drupal::httpClient()->get('https://api.example.com/data');\n\n// 2. Normalize\n$orchestrator = \\Drupal::service('api_normalization.orchestrator');\n$normalized = $orchestrator->normalize(json_decode($response->getBody()));\n\n// 3. Generate entity\n$generator = \\Drupal::service('api_normalization.entity_generator');\n$entity = $generator->generateEntity($normalized, 'node', 'article');\n$entity->save();\n```\n\n### Use Case 2: ECA Workflow Integration\n\nCreate an ECA workflow that:\n1. Listens for API webhook events\n2. Normalizes incoming data\n3. Transforms data\n4. Generates entities\n5. Triggers notifications\n\nSee [Integration Guide](./integration.md) for ECA examples.\n\n### Use Case 3: FlowDrop Visual Workflow\n\nUse FlowDrop's visual interface to:\n1. Create API request nodes\n2. Add normalization nodes\n3. Add transformation nodes\n4. Add entity generation nodes\n\nSee [Integration Guide](./integration.md) for FlowDrop examples.\n\n---\n\n## Next Steps\n\n- [User Guide](./userGuide.md) - Complete documentation\n- [API Reference](./apiReference.md) - Developer API\n- [Examples](./examples.md) - More examples\n- [Drush Commands](./drushCommands.md) - Command-line reference\n", "metadata": {"source": "repos/api_normalization/docs/gettingStarted.md", "type": "doc_summary", "topic": "Getting Started"}}
{"instruction": "Show me the implementation of the class HelpPostUpdate in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Post update functions for the Help module.\n */\n\n/**\n * Implements hook_removed_post_updates().\n */\nfunction help_removed_post_updates(): array {\n  return [\n    'help_post_update_help_topics_search' => '11.0.0',\n    'help_post_update_help_topics_uninstall' => '11.0.0',\n    'help_post_update_add_permissions_to_roles' => '11.0.0',\n  ];\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/help/help.post_update.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpPostUpdate", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_theme.theme:\n    class: Drupal\\mcp_tools_theme\\Service\\ThemeService\n    arguments:\n      - '@theme_handler'\n      - '@theme.manager'\n      - '@config.factory'\n      - '@extension.list.theme'\n      - '@mcp_tools.access_manager'\n      - '@mcp_tools.audit_logger'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_theme/mcp_tools_theme.services.yml", "type": "yaml_reference", "topic": "mcp tools theme.services"}}
{"instruction": "Show me the implementation of the interface SodiumKeyPairRepositoryInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\Sodium;\n\n/**\n * Provides access to sodium key pairs used for encryption and decryption.\n */\ninterface SodiumKeyPairRepositoryInterface {\n\n  /**\n   * Returns a key pair by its identifier.\n   *\n   * Implementations MAY omit the private key when the current environment is\n   * not allowed to perform decryption.\n   *\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairNotFoundException\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n   */\n  public function getKeyPairById(string $id): SodiumKeyPair;\n\n  /**\n   * Generates and persists a key pair for the given identifier.\n   *\n   * This method MUST:\n   * - Generate a cryptographically secure libsodium key pair.\n   * - Persist the public key.\n   * - Persist the private key where appropriate for the environment.\n   *\n   * This method MUST NOT change which key pair is active.\n   *\n   * @param string $id\n   *   The key pair identifier to generate.\n   *\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n   *   Thrown if generation or persistence fails.\n   */\n  public function generateKeyPair(string $id): void;\n\n  /**\n   * Returns identifiers for all stored key pairs.\n   *\n   * Implementations MUST return identifiers for all key pairs known to\n   * the repository, regardless of whether the corresponding private\n   * keys are available in the current environment.\n   *\n   * @return string[]\n   *   An array of key pair identifiers.\n   */\n  public function listKeyPairIds(): array;\n\n  /**\n   * Deletes a key pair by its identifier.\n   *\n   * Implementations MUST refuse to delete the currently active key pair.\n   * Callers SHOULD rotate to a new active key pair before attempting to\n   * delete an older one.\n   *\n   * @param string $id\n   *   The key pair identifier to delete.\n   *\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n   *   Thrown if the key pair is active, or if deletion fails due to a\n   *   storage or permissions error.\n   */\n  public function deleteKeyPair(string $id): void;\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/Sodium/SodiumKeyPairRepositoryInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SodiumKeyPairRepositoryInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a link to a file.\n *\n * Available variables:\n * - attributes: The HTML attributes for the containing element.\n * - link: A link to the file.\n * - icon: The icon image representing the file type.\n * - file_size: The size of the file.\n *\n * @see \\Drupal\\file\\Hook\\FileThemeHooks::preprocessFileLink()\n */\n#}\n{{ attach_library('umami/classy.file') }}\n<span{{ attributes }}>{{ icon }} {{ link }}</span>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/components/field/file-link.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "modal:\n  version: 1.x\n  js:\n    js/fancybox/fancybox.js: { }\n  css:\n    theme:\n      css/fancybox/fancybox.css: { }\n\nslider:\n  version: 1.x\n  css:\n    theme:\n      css/slider-gallery.css: { }\n  js:\n    js/slider-gallery.js: { }\n  dependencies:\n    - core/drupal\n\nfancybox:\n  css:\n    theme:\n      css/fancybox/fancybox.css: { }\n  js:\n    js/fancybox/fancybox.js: { }\n    js/fancybox-init.js: { }\n\n  dependencies:\n    - core/drupal\n", "metadata": {"source": "repos/slider_gallery/slider_gallery.libraries.yml", "type": "yaml_reference", "topic": "slider gallery.libraries"}}
{"instruction": "Show me the implementation of the class NodeModuleHooks in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\node\\Hook;\n\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Module hook implementations for node.\n */\nclass NodeModuleHooks {\n\n  public function __construct(\n    private readonly ModuleHandlerInterface $moduleHandler,\n  ) {\n\n  }\n\n  /**\n   * Implements hook_modules_installed().\n   */\n  #[Hook('modules_installed')]\n  public function modulesInstalled(array $modules): void {\n    // Check if any of the newly enabled modules require the node_access table\n    // to be rebuilt.\n    if (!node_access_needs_rebuild() && $this->moduleHandler->hasImplementations('node_grants', $modules)) {\n      node_access_needs_rebuild(TRUE);\n    }\n  }\n\n  /**\n   * Implements hook_modules_uninstalled().\n   */\n  #[Hook('modules_uninstalled')]\n  public function modulesUninstalled($modules): void {\n    // Check whether any of the disabled modules implemented hook_node_grants(),\n    // in which case the node access table needs to be rebuilt.\n    foreach ($modules as $module) {\n      // At this point, the module is already disabled, but its code is still\n      // loaded in memory. Module functions must no longer be called. We only\n      // check whether a hook implementation function exists and do not invoke\n      // it. Node access also needs to be rebuilt if language module is disabled\n      // to remove any language-specific grants.\n      if (!node_access_needs_rebuild() && ($this->moduleHandler->hasImplementations('node_grants', $module) || $module == 'language')) {\n        node_access_needs_rebuild(TRUE);\n      }\n    }\n    // If there remains no more node_access module, rebuilding will be\n    // straightforward, we can do it right now.\n    if (node_access_needs_rebuild() && !$this->moduleHandler->hasImplementations('node_grants')) {\n      node_access_rebuild();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/node/src/Hook/NodeModuleHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NodeModuleHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "---\nlabel: 'Changing basic site settings'\ntop_level: true\nrelated:\n  - user.security_account_settings\n---\n{% set regional_link_text %}{% trans %}Regional settings{% endtrans %}{% endset %}\n{% set regional_link = render_var(help_route_link(regional_link_text, 'system.regional_settings')) %}\n{% set information_link_text %}{% trans %}Basic site settings{% endtrans %}{% endset %}\n{% set information_link = render_var(help_route_link(information_link_text, 'system.site_information_settings')) %}\n{% set datetime_link_text %}{% trans %}Date and time formats{% endtrans %}{% endset %}\n{% set datetime_link = render_var(help_route_link(datetime_link_text, 'entity.date_format.collection')) %}\n<h2>{% trans %}Goal{% endtrans %}</h2>\n<p>{% trans %}Configure the basic settings of your site, including the site name, slogan, main email address, default time zone, default country, and the date formats to use.{% endtrans %}</p>\n<h2>{% trans %}Steps{% endtrans %}</h2>\n<ol>\n  <li>{% trans %}In the <em>Manage</em> administrative menu, navigate to <em>Configuration</em> &gt; <em>System</em> &gt; <em>{{ information_link }}</em>.{% endtrans %}</li>\n  <li>{% trans %}Enter the site name, slogan, and main email address for your site. {% endtrans %}</li>\n  <li>{% trans %}Click <em>Save configuration</em>. You should see a message indicating that the settings were saved.{% endtrans %}</li>\n  <li>{% trans %}In the <em>Manage</em> administrative menu, navigate to <em>Configuration</em> &gt; <em>Region and language</em> &gt; <em>{{ regional_link }}</em>.{% endtrans %}</li>\n  <li>{% trans %}Select the default country and default time zone for your site.{% endtrans %}</li>\n  <li>{% trans %}Click <em>Save configuration</em>. You should see a message indicating that the settings were saved.{% endtrans %}</li>\n  <li>{% trans %}In the <em>Manage</em> administrative menu, navigate to <em>Configuration</em> &gt; <em>Region and language</em> &gt; <em>{{ datetime_link }}</em>.{% endtrans %}</li>\n  <li>{% trans %}Look at the <em>Patterns</em> for the Default long, medium, and short date formats. If any of them does not match the date format you want to use on your site, click <em>Edit</em> in that row to edit the format.{% endtrans %}</li>\n  <li>{% trans %}Adjust the <em>Format string</em> until the <em>Displayed</em> format matches what you want. (Date format strings are composed of PHP date format codes.){% endtrans %}</li>\n  <li>{% trans %}Click <em>Save format</em>. You should see a message indicating that the format was saved.{% endtrans %}</li>\n  <li>{% trans %}Repeat the previous three steps for any other date formats that need to be changed.{% endtrans %}</li>\n</ol>\n<h2>{% trans %}Additional resources{% endtrans %}</h2>\n<p>{% trans %}<a href=\"https://www.php.net/manual/datetime.format.php#refsect1-datetime.format-parameters\">PHP date format codes reference</a>{% endtrans %}</p>\n", "metadata": {"source": "repos/drupal_core/core/modules/system/help_topics/system.config_basic.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class BundleEntityFormBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\n/**\n * Class BundleEntityFormBase is a base form for bundle config entities.\n */\nclass BundleEntityFormBase extends EntityForm {\n\n  /**\n   * Protects the bundle entity's ID property's form element against changes.\n   *\n   * This method is assumed to be called on a completely built entity form,\n   * including a form element for the bundle config entity's ID property.\n   *\n   * @param array $form\n   *   The completely built entity bundle form array.\n   *\n   * @return array\n   *   The updated entity bundle form array.\n   */\n  protected function protectBundleIdElement(array $form) {\n    $entity = $this->getEntity();\n    $id_key = $entity->getEntityType()->getKey('id');\n    assert(isset($form[$id_key]));\n    $element = &$form[$id_key];\n\n    // Make sure the element is not accidentally re-enabled if it has already\n    // been disabled.\n    if (empty($element['#disabled'])) {\n      $element['#disabled'] = !$entity->isNew();\n    }\n    return $form;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/BundleEntityFormBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BundleEntityFormBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for status report general info.\n *\n * Available variables:\n * - drupal: The status of Drupal installation:\n *   - value: The current status of Drupal installation.\n *   - description: The description for current status of Drupal installation.\n * - cron: The status of cron:\n *   - value: The current status of cron.\n *   - description: The description for current status of cron.\n *   - cron.run_cron: An array to render a button for running cron.\n * - database_system: The status of database system:\n *   - value: The current status of database system.\n *   - description: The description for current status of cron.\n * - database_system_version: The info about current database version:\n *   - value: The current version of database.\n *   - description: The description for current version of database.\n * - php: The current version of PHP:\n *   - value: The status of currently installed PHP version.\n *   - description: The description for current installed PHP version.\n * - php_memory_limit: The info about current PHP memory limit:\n *   - value: The status of currently set PHP memory limit.\n *   - description: The description for currently set PHP memory limit.\n * - webserver: The info about currently installed web server:\n *   - value: The status of currently installed web server.\n *   - description: The description for the status of currently installed web\n *     server.\n */\n#}\n<div class=\"system-status-general-info\">\n  <h2 class=\"system-status-general-info__header\">{{ 'General System Information'|t }}</h2>\n  <div class=\"system-status-general-info__items\">\n    <div class=\"system-status-general-info__item card\">\n      <span class=\"system-status-general-info__item-icon system-status-general-info__item-icon--drupal\"></span>\n      <div class=\"system-status-general-info__item-details\">\n        <h3 class=\"system-status-general-info__item-title\">{{ 'Drupal Version'|t }}</h3>\n        {{ drupal.value }}\n        {% if drupal.description %}\n          <div class=\"description\">{{ drupal.description }}</div>\n        {% endif %}\n      </div>\n    </div>\n\n    <div class=\"system-status-general-info__item card\">\n      <span class=\"system-status-general-info__item-icon system-status-general-info__item-icon--server\"></span>\n      <div class=\"system-status-general-info__item-details\">\n        <h3 class=\"system-status-general-info__item-title\">{{ 'Web Server'|t }}</h3>\n        {{ webserver.value }}\n        {% if webserver.description %}\n          <div class=\"description\">{{ webserver.description }}</div>\n        {% endif %}\n      </div>\n    </div>\n    <div class=\"system-status-general-info__item card\">\n      <span class=\"system-status-general-info__item-icon system-status-general-info__item-icon--clock\"></span>\n      <div class=\"system-status-general-info__item-details\">\n        <h3 class=\"system-status-general-info__item-title\">{{ 'Last Cron Run'|t }}</h3>\n        {{ cron.value }}\n        {% if cron.run_cron %}\n          <div class=\"system-status-general-info__run-cron\">{{ cron.run_cron }}</div>\n        {% endif %}\n        {% if cron.description %}\n          <div class=\"system-status-general-info__description\">{{ cron.description }}</div>\n        {% endif %}\n      </div>\n    </div>\n    <div class=\"system-status-general-info__item card\">\n      <span class=\"system-status-general-info__item-icon system-status-general-info__item-icon--php\"></span>\n      <div class=\"system-status-general-info__item-details\">\n        <h3 class=\"system-status-general-info__item-title\">{{ 'PHP'|t }}</h3>\n        <h4 class=\"system-status-general-info__sub-item-title\">{{ 'Version'|t }}</h4>{{ php.value }}\n        {% if php.description %}\n          <div class=\"description\">{{ php.description }}</div>\n        {% endif %}\n\n        <h4 class=\"system-status-general-info__sub-item-title\">{{ 'Memory limit'|t }}</h4>{{ php_memory_limit.value }}\n        {% if php_memory_limit.description %}\n          <div class=\"description\">{{ php_memory_limit.description }}</div>\n        {% endif %}\n      </div>\n    </div>\n    <div class=\"system-status-general-info__item card\">\n      <span class=\"system-status-general-info__item-icon system-status-general-info__item-icon--database\"></span>\n      <div class=\"system-status-general-info__item-details\">\n        <h3 class=\"system-status-general-info__item-title\">{{ 'Database'|t }}</h3>\n        <h4 class=\"system-status-general-info__sub-item-title\">{{ 'Version'|t }}</h4>{{ database_system_version.value }}\n        {% if database_system_version.description %}\n          <div class=\"description\">{{ database_system_version.description }}</div>\n        {% endif %}\n\n        <h4 class=\"system-status-general-info__sub-item-title\">{{ 'System'|t }}</h4>{{ database_system.value }}\n        {% if database_system.description %}\n          <div class=\"description\">{{ database_system.description }}</div>\n        {% endif %}\n      </div>\n    </div>\n  </div>\n</div>\n", "metadata": {"source": "repos/drupal_core/core/themes/claro/templates/status-report-general-info.html.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ViewsRelationship\nSource file: <source_file>\nFile name hint: ViewsRelationship.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views relationship handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\relationship\\RelationshipPluginBase\n *\n * @ingroup views_relationship_handlers\n *\n * @Annotation\n */\nclass ViewsRelationship extends ViewsHandlerAnnotationBase {\n\n}", "output": "<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views relationship handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\relationship\\RelationshipPluginBase\n *\n * @ingroup views_relationship_handlers\n *\n * @Annotation\n */\nclass ViewsRelationship extends ViewsHandlerAnnotationBase {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Annotation/ViewsRelationship.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsRelationship", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class RegistryOfCommerce in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\zefix\\Services;\n\nuse Drupal\\zefix\\ZefixApiClient;\n\n/**\n * Service to list all cantonal registries of commerce.\n */\nclass RegistryOfCommerce {\n\n  /**\n   * The Zefix API client.\n   *\n   * @var \\Drupal\\zefix\\ZefixApiClient\n   */\n  protected ZefixApiClient $api;\n\n  /**\n   * Constructs a RegistryOfCommerce object.\n   *\n   * @param \\Drupal\\zefix\\ZefixApiClient $api\n   *   The Zefix API client.\n   */\n  public function __construct(ZefixApiClient $api) {\n    $this->api = $api;\n  }\n\n  /**\n   * Get a list of the cantonal registries of commerce.\n   *\n   * @link https://www.zefixintg.admin.ch/ZefixPublicREST/swagger-ui/index.html#/RegistryOfCommerce/list\n   *\n   * @return array|null\n   *   The registry of commerce data or null on error.\n   */\n  public function registryOfCommerce(): ?array {\n    return $this->api->get('registryOfCommerce', NULL);\n  }\n\n}\n", "metadata": {"source": "repos/zefix/src/Services/RegistryOfCommerce.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RegistryOfCommerce", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ConfigCollectionInfo in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Config;\n\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Gets information on all the possible configuration collections.\n */\nclass ConfigCollectionInfo extends Event {\n\n  /**\n   * Configuration collection information keyed by collection name.\n   *\n   * The value is either the configuration factory override that is responsible\n   * for the collection or null if there is not one.\n   *\n   * @var array\n   */\n  protected $collections = [];\n\n  /**\n   * Adds a collection to the list of possible collections.\n   *\n   * @param string $collection\n   *   Collection name to add.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryOverrideInterface $override_service\n   *   (optional) The configuration factory override service responsible for the\n   *   collection.\n   *\n   * @throws \\InvalidArgumentException\n   *   Exception thrown if $collection is equal to\n   *   \\Drupal\\Core\\Config\\StorageInterface::DEFAULT_COLLECTION.\n   */\n  public function addCollection($collection, ?ConfigFactoryOverrideInterface $override_service = NULL) {\n    if ($collection == StorageInterface::DEFAULT_COLLECTION) {\n      throw new \\InvalidArgumentException('Can not add the default collection to the ConfigCollectionInfo object');\n    }\n    $this->collections[$collection] = $override_service;\n  }\n\n  /**\n   * Gets the list of possible collection names.\n   *\n   * @param bool $include_default\n   *   (Optional) Include the default collection. Defaults to TRUE.\n   *\n   * @return array\n   *   The list of possible collection names.\n   */\n  public function getCollectionNames($include_default = TRUE) {\n    $collection_names = array_keys($this->collections);\n    sort($collection_names);\n    if ($include_default) {\n      array_unshift($collection_names, StorageInterface::DEFAULT_COLLECTION);\n    }\n    return $collection_names;\n  }\n\n  /**\n   * Gets the config factory override service responsible for the collection.\n   *\n   * @param string $collection\n   *   The configuration collection.\n   *\n   * @return \\Drupal\\Core\\Config\\ConfigFactoryOverrideInterface|null\n   *   The override service responsible for the collection if one exists. NULL\n   *   if not.\n   */\n  public function getOverrideService($collection) {\n    return $this->collections[$collection] ?? NULL;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/ConfigCollectionInfo.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigCollectionInfo", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  # Main service for executing workflows programmatically.\n  flowdrop_workflow_executor.service:\n    class: Drupal\\flowdrop_workflow_executor\\Service\\WorkflowExecutionService\n    arguments:\n      - \"@entity_type.manager\"\n      - \"@flowdrop_playground.service\"\n      - \"@flowdrop.entity_serializer\"\n      - \"@state\"\n      - \"@queue\"\n      - \"@logger.factory\"\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_workflow_executor/flowdrop_workflow_executor.services.yml", "type": "yaml_reference", "topic": "flowdrop workflow executor.services"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EntityAccess.php\nTarget symbol: class for\nNamespace: Drupal\\workspaces\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Access\\AccessResultInterface\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Hook\\Attribute\\Hook\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\workspaces\\WorkspaceInformationInterface\n  - Drupal\\workspaces\\WorkspaceManagerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - bypassAccessResult()\n  - entityAccess()\n  - entityCreateAccess()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\workspaces\\Hook;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\workspaces\\WorkspaceInformationInterface;\nuse Drupal\\workspaces\\WorkspaceManagerInterface;\n\n/**\n * Defines a class for reacting to entity access control hooks.\n */\nclass EntityAccess {\n\n  public function __construct(\n    protected EntityTypeManagerInterface $entityTypeManager,\n    protected WorkspaceManagerInterface $workspaceManager,\n    protected WorkspaceInformationInterface $workspaceInfo,\n  ) {}\n\n  /**\n   * Implements hook_entity_access().\n   */\n  #[Hook('entity_access')]\n  public function entityAccess(EntityInterface $entity, $operation, AccountInterface $account): AccessResultInterface {\n    // Workspaces themselves are handled by their own access handler and we\n    // should not try to do any access checks for entity types that can not\n    // belong to a workspace.\n    if (!$this->workspaceInfo->isEntitySupported($entity) || !$this->workspaceManager->hasActiveWorkspace()) {\n      return AccessResult::neutral();\n    }\n\n    // Prevent the deletion of entities with a published default revision.\n    if ($operation === 'delete') {\n      $active_workspace = $this->workspaceManager->getActiveWorkspace();\n      $is_deletable = $this->workspaceInfo->isEntityDeletable($entity, $active_workspace);\n\n      return AccessResult::forbiddenIf(!$is_deletable)\n        ->addCacheableDependency($entity)\n        ->addCacheableDependency($active_workspace);\n    }\n\n    return $this->bypassAccessResult($account);\n  }\n\n  /**\n   * Implements hook_entity_create_access().\n   */\n  #[Hook('entity_create_access')]\n  public function entityCreateAccess(AccountInterface $account, array $context, $entity_bundle): AccessResultInterface {\n    // Workspaces themselves are handled by their own access handler and we\n    // should not try to do any access checks for entity types that can not\n    // belong to a workspace.\n    $entity_type = $this->entityTypeManager->getDefinition($context['entity_type_id']);\n    if (!$this->workspaceInfo->isEntityTypeSupported($entity_type) || !$this->workspaceManager->hasActiveWorkspace()) {\n      return AccessResult::neutral();\n    }\n\n    return $this->bypassAccessResult($account);\n  }\n\n  /**\n   * Checks the 'bypass' permissions.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The user account making the to check access for.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The result of the access check.\n   */\n  protected function bypassAccessResult(AccountInterface $account): AccessResultInterface {\n    // This approach assumes that the current \"global\" active workspace is\n    // correct, i.e. if you're \"in\" a given workspace then you get ALL THE PERMS\n    // to ALL THE THINGS! That's why this is a dangerous permission.\n    $active_workspace = $this->workspaceManager->getActiveWorkspace();\n\n    return AccessResult::allowedIf($active_workspace->getOwnerId() == $account->id())->cachePerUser()->addCacheableDependency($active_workspace)\n      ->andIf(AccessResult::allowedIfHasPermission($account, 'bypass entity access own workspace'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/workspaces/src/Hook/EntityAccess.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityAccess", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  display_builder_views.display_builder_subscriber:\n    class: Drupal\\display_builder_views\\EventSubscriber\\DisplayBuilderSubscriber\n    arguments:\n      - '@entity_type.manager'\n    tags:\n      - { name: 'event_subscriber' }\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/display_builder_views.services.yml", "type": "yaml_reference", "topic": "display builder views.services"}}
{"instruction": "Show me the implementation of the class Concat in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateException;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Concatenates a set of strings.\n *\n * The concat plugin is used to concatenate strings. For example, imploding a\n * set of strings into a single string.\n *\n * Available configuration keys:\n * - delimiter: (optional) A delimiter, or glue string, to insert between the\n *   strings.\n *\n * Examples:\n *\n * @code\n * process:\n *   new_text_field:\n *     plugin: concat\n *     source:\n *       - foo\n *       - bar\n * @endcode\n *\n * This will set new_text_field to the concatenation of the 'foo' and 'bar'\n * source values. For example, if the 'foo' property is \"Rosa\" and the 'bar'\n * property is \"Parks\", new_text_field will be \"RosaParks\".\n *\n * You can also specify a delimiter.\n *\n * @code\n * process:\n *   new_text_field:\n *     plugin: concat\n *     source:\n *       - foo\n *       - bar\n *     delimiter: /\n * @endcode\n *\n * This will set new_text_field to the concatenation of the 'foo' source value,\n * the delimiter and the 'bar' source value. For example, using the values above\n * and \"/\" as the delimiter, if the 'foo' property is \"Rosa\" and the 'bar'\n * property is \"Rosa\", new_text_field will be \"Rosa/Parks\".\n *\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess(\n  id: \"concat\",\n  handle_multiples: TRUE,\n)]\nclass Concat extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    if (is_array($value)) {\n      $delimiter = $this->configuration['delimiter'] ?? '';\n      return implode($delimiter, $value);\n    }\n    else {\n      throw new MigrateException(sprintf('%s is not an array', var_export($value, TRUE)));\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/Concat.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Concat", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ContentTranslationPermissions in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\content_translation;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides dynamic permissions for the content_translation module.\n */\nclass ContentTranslationPermissions implements ContainerInjectionInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity bundle info.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface\n   */\n  protected $entityTypeBundleInfo;\n\n  /**\n   * The content translation manager.\n   *\n   * @var \\Drupal\\content_translation\\ContentTranslationManagerInterface\n   */\n  protected $contentTranslationManager;\n\n  /**\n   * Constructs a ContentTranslationPermissions instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\content_translation\\ContentTranslationManagerInterface $content_translation_manager\n   *   The content translation manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeBundleInfoInterface $entity_type_bundle_info\n   *   The entity type bundle info.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager, ContentTranslationManagerInterface $content_translation_manager, EntityTypeBundleInfoInterface $entity_type_bundle_info) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->contentTranslationManager = $content_translation_manager;\n    $this->entityTypeBundleInfo = $entity_type_bundle_info;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('entity_type.manager'),\n      $container->get('content_translation.manager'),\n      $container->get('entity_type.bundle.info')\n    );\n  }\n\n  /**\n   * Returns an array of content translation permissions.\n   *\n   * @return array\n   *   An associative array of permissions keyed by permission name.\n   */\n  public function contentPermissions() {\n    $permissions = [];\n    // Create a translate permission for each enabled entity type and\n    // (optionally) bundle.\n    foreach ($this->entityTypeManager->getDefinitions() as $entity_type_id => $entity_type) {\n      if ($permission_granularity = $entity_type->getPermissionGranularity()) {\n        switch ($permission_granularity) {\n          case 'bundle':\n            foreach ($this->entityTypeBundleInfo->getBundleInfo($entity_type_id) as $bundle => $bundle_info) {\n              if ($this->contentTranslationManager->isEnabled($entity_type_id, $bundle)) {\n                $permissions[\"translate $bundle $entity_type_id\"] = $this->buildBundlePermission($entity_type, $bundle, $bundle_info);\n              }\n            }\n            break;\n\n          case 'entity_type':\n            if ($this->contentTranslationManager->isEnabled($entity_type_id)) {\n              $permissions[\"translate $entity_type_id\"] = [\n                'title' => $this->t('Translate @entity_label', ['@entity_label' => $entity_type->getSingularLabel()]),\n                'dependencies' => ['module' => [$entity_type->getProvider()]],\n              ];\n            }\n            break;\n        }\n      }\n    }\n\n    return $permissions;\n  }\n\n  /**\n   * Builds a content translation permission array for a bundle.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string $bundle\n   *   The bundle to build the translation permission for.\n   * @param array $bundle_info\n   *   The bundle info.\n   *\n   * @return array\n   *   The permission details, keyed by 'title' and 'dependencies'.\n   */\n  private function buildBundlePermission(EntityTypeInterface $entity_type, string $bundle, array $bundle_info) {\n    $permission = [\n      'title' => $this->t('Translate %bundle_label @entity_label', [\n        '@entity_label' => $entity_type->getSingularLabel(),\n        '%bundle_label' => $bundle_info['label'] ?? $bundle,\n      ]),\n    ];\n\n    // If the entity type uses bundle entities, add a dependency on the bundle.\n    $bundle_entity_type = $entity_type->getBundleEntityType();\n    if ($bundle_entity_type && $bundle_entity = $this->entityTypeManager->getStorage($bundle_entity_type)->load($bundle)) {\n      $permission['dependencies'][$bundle_entity->getConfigDependencyKey()][] = $bundle_entity->getConfigDependencyName();\n    }\n    else {\n      $permission['dependencies']['module'][] = $entity_type->getProvider();\n    }\n    return $permission;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/content_translation/src/ContentTranslationPermissions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContentTranslationPermissions", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: BeforeEntityWipeEvent.php\nTarget symbol: class BeforeEntityWipeEvent\nNamespace: Drupal\\db_wipe_entity\\Event\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for BeforeEntityWipeEvent.\n- Include required imports:\n  - Drupal\\Core\\Entity\\Query\\QueryInterface\n  - Symfony\\Contracts\\EventDispatcher\\Event\n- Ensure these methods exist where relevant:\n  - __construct()\n  - getBundle()\n  - getCount()\n  - getEntityTypeId()\n  - getQuery()\n  - isDryRun()\n  - isWipePrevented()\n  - preventWipe()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\db_wipe_entity\\Event;\n\nuse Drupal\\Core\\Entity\\Query\\QueryInterface;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event dispatched before entity wipe operation.\n */\nclass BeforeEntityWipeEvent extends Event {\n\n  /**\n   * Whether the wipe operation should be prevented.\n   *\n   * @var bool\n   */\n  protected bool $preventWipe = FALSE;\n\n  /**\n   * Constructs a BeforeEntityWipeEvent object.\n   *\n   * @param string $entityTypeId\n   *   The entity type ID.\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryInterface $query\n   *   The entity query.\n   * @param int $count\n   *   Total count of entities to be deleted.\n   * @param string|null $bundle\n   *   The bundle name.\n   * @param bool $dryRun\n   *   Whether this is a dry run.\n   */\n  public function __construct(\n    protected readonly string $entityTypeId,\n    protected readonly QueryInterface $query,\n    protected readonly int $count,\n    protected readonly ?string $bundle = NULL,\n    protected readonly bool $dryRun = FALSE,\n  ) {}\n\n  /**\n   * Gets the entity type ID.\n   *\n   * @return string\n   *   The entity type ID.\n   */\n  public function getEntityTypeId(): string {\n    return $this->entityTypeId;\n  }\n\n  /**\n   * Gets the query object.\n   *\n   * @return \\Drupal\\Core\\Entity\\Query\\QueryInterface\n   *   The entity query.\n   */\n  public function getQuery(): QueryInterface {\n    return $this->query;\n  }\n\n  /**\n   * Gets the total count of entities to be deleted.\n   *\n   * @return int\n   *   The count of entities.\n   */\n  public function getCount(): int {\n    return $this->count;\n  }\n\n  /**\n   * Gets the bundle name.\n   *\n   * @return string|null\n   *   The bundle name or NULL.\n   */\n  public function getBundle(): ?string {\n    return $this->bundle;\n  }\n\n  /**\n   * Checks if this is a dry run.\n   *\n   * @return bool\n   *   TRUE if dry run, FALSE otherwise.\n   */\n  public function isDryRun(): bool {\n    return $this->dryRun;\n  }\n\n  /**\n   * Prevents the wipe operation.\n   */\n  public function preventWipe(): void {\n    $this->preventWipe = TRUE;\n  }\n\n  /**\n   * Checks if wipe should be prevented.\n   *\n   * @return bool\n   *   TRUE if prevented, FALSE otherwise.\n   */\n  public function isWipePrevented(): bool {\n    return $this->preventWipe;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Event/BeforeEntityWipeEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BeforeEntityWipeEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Card styles: border\"\nslots:\n  header: \"Header\"\n  content:\n    - type: component\n      component: \"bootstrap_components:card_body\"\n      slots:\n        title: \"Card title\"\n        text: \"Some quick example text to build on the card title and make up the bulk of the card's content.\"\nprops:\n  variant: default\nlibrary_wrapper: >\n  {% set examples = [\n    'primary',\n    'secondary',\n    'success',\n    'danger',\n    'warning',\n    'info',\n    'light',\n    'dark',\n  ] %}\n  {% for example in examples %}\n    {% set example_props = {'#props': _story['#props']|merge({'attributes': create_attribute({\n      style: 'width: 18rem;',\n      class: [\n        'mb-3',\n        'border-' ~example,\n      ]\n    })})} %}\n\n    {% set example_story = _story %}\n    {{ example_story|merge(example_props) }}\n  {% endfor %}\n", "metadata": {"source": "repos/bootstrap_components/components/card/stories/card.styles_border.story.yml", "type": "yaml_reference", "topic": "card.styles border.story"}}
{"instruction": "Show me the implementation of the class InstallerServiceProvider in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Installer;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderInterface;\nuse Drupal\\Core\\DependencyInjection\\ServiceModifierInterface;\nuse Symfony\\Component\\DependencyInjection\\Reference;\n\n/**\n * Service provider for the early installer environment.\n *\n * This class is manually added by install_begin_request() via\n * $conf['container_service_providers'] and required to prevent various services\n * from trying to retrieve data from storages that do not exist yet.\n */\nclass InstallerServiceProvider extends NormalInstallerServiceProvider implements ServiceProviderInterface, ServiceModifierInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function register(ContainerBuilder $container) {\n    // Inject the special configuration storage for the installer.\n    // This special implementation MUST NOT be used anywhere else than the early\n    // installer environment.\n    $container->register('config.storage', 'Drupal\\Core\\Config\\InstallStorage');\n\n    // Replace services with in-memory implementations.\n    $container\n      ->register('keyvalue', 'Drupal\\Core\\KeyValueStore\\KeyValueMemoryFactory');\n    $container\n      ->register('keyvalue.expirable', 'Drupal\\Core\\KeyValueStore\\KeyValueNullExpirableFactory');\n\n    // Replace services with no-op implementations.\n    $container\n      ->register('url_generator', 'Drupal\\Core\\Routing\\NullGenerator')\n      ->addArgument(new Reference('request_stack'));\n    $container\n      ->register('path_processor_manager', 'Drupal\\Core\\PathProcessor\\NullPathProcessorManager');\n    $container\n      ->register('router.dumper', 'Drupal\\Core\\Routing\\NullMatcherDumper');\n\n    // Replace the route builder with an empty implementation.\n    // @todo Convert installer steps into routes; add an installer.routing.yml.\n    $definition = $container->getDefinition('router.builder');\n    $definition->setClass('Drupal\\Core\\Installer\\InstallerRouteBuilder')\n      // The core router builder, but there is no reason here to be lazy, so\n      // we don't need to ship with a custom proxy class.\n      ->setLazy(FALSE);\n\n    parent::register($container);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alter(ContainerBuilder $container) {\n    // Disable Twig cache (php storage does not exist yet).\n    $twig_config = $container->getParameter('twig.config');\n    $twig_config['cache'] = FALSE;\n    $container->setParameter('twig.config', $twig_config);\n\n    // No service may persist when the early installer kernel is rebooted into\n    // the production environment.\n    // @todo The DrupalKernel reboot performed by drupal_install_system() is\n    //   actually not a \"regular\" reboot (like ModuleInstaller::install()), so\n    //   services are not actually persisted.\n    foreach ($container->findTaggedServiceIds('persist') as $id => $tags) {\n      $definition = $container->getDefinition($id);\n      $definition->clearTag('persist');\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Installer/InstallerServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InstallerServiceProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: LanguageSelect.php\nTarget symbol: class LanguageSelect\nNamespace: Drupal\\Core\\Render\\Element\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LanguageSelect.\n- Include required imports:\n  - Drupal\\Core\\Language\\LanguageInterface\n  - Drupal\\Core\\Render\\Attribute\\FormElement\n- Ensure these methods exist where relevant:\n  - getInfo()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Render\\Attribute\\FormElement;\n\n/**\n * Provides a form element for selecting a language.\n *\n * This does not render an actual form element, but always returns the value of\n * the default language. It is then extended by Language module via\n * language_element_info_alter() to provide a proper language selector.\n *\n * @see language_element_info_alter()\n */\n#[FormElement('language_select')]\nclass LanguageSelect extends FormElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#input' => TRUE,\n      '#default_value' => LanguageInterface::LANGCODE_NOT_SPECIFIED,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/LanguageSelect.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageSelect", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class CompilerPluginBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\compiler\\Plugin;\n\nuse Drupal\\Component\\Plugin\\PluginBase;\n\n/**\n * The base implementation for a compiler plugin.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n */\nabstract class CompilerPluginBase extends PluginBase implements CompilerPluginInterface {\n\n}\n", "metadata": {"source": "repos/compiler/src/Plugin/CompilerPluginBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CompilerPluginBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Why does Drupal filter on output?", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Security](/docs/develop/security)\n\n* [Handle user input with care](/docs/develop/security/handle-user-input-with-care)\n* [Why does Drupal filter on output?](/docs/develop/security/why-does-drupal-filter-on-output)\n* [HMAC best practices](/docs/develop/security/hmac-best-practices)\n* [Information disclosure in error messages not a weakness (Path disclosure, SQL error messages, etc.)](/docs/develop/security/information-disclosure-in-error-messages-not-a-weakness-path-disclosure-sql)\n* [Your Drupal site got hacked. Now what?](/docs/develop/security/your-drupal-site-got-hacked-now-what)\n\n# Why does Drupal filter on output?\n\nLast [updated](/node/263002/discuss) on\n\n17 December 2025\n\nSome web applications process/filter the user input in the name of security before storing it in the database. Historically, Drupal has preserved user input as is, and filter it on output only. This is occasionally debated within the Drupal community.\n\n[Steven Wittens'](http://drupal.org/user/10) excellent article [Safe string theory for the web](http://acko.net/blog/safe-string-theory-for-the-web) provides a full technical explanation of why it is best to preserve the original user input. The type of filtering needed depends on the output context. Acting on input can be quite problematic because you do not know what characters are forbidden without knowing the context in which they will appear.\n\nTo make things even trickier, a certain string could appear in more than one context at one time. For example, the same string might be used as HTML text, and as an HTML attribute too:\n`<a title=\"$node->title\">$node->title</a>`\n\nIf you attempt to strip all \"special\" characters from this string, you'll be unable to output meaningful text in an HTML page. Encoding those characters won't help either. In addition, encoding creates another problem, in that processing the escaped or encoded text is very cumbersome (for example, consider the difficulty of extracting a teaser from an HTML-escaped node body).\n\nThe best choice is to store the user input unchanged, and perform proper escaping upon output. As much as possible, variables should be escaped prior to the theme layer in a way appropriate for their most likely use.\n\nFor information on which functions to sanitizing output with, look at <http://api.drupal.org/api/drupal/includes!common.inc/group/sanitization/7>\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/263002/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%28263002%29%20Why%20does%20Drupal%20filter%20on%20output%3F) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/security/why-does-drupal-filter-on-output.md", "type": "doc_summary", "topic": "Why does Drupal filter on output?"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ViewsJoin.php\nTarget symbol: class ViewsJoin\nNamespace: Drupal\\views\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ViewsJoin.", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views join plugins.\n *\n * @see \\Drupal\\views\\Plugin\\views\\join\\JoinPluginBase\n *\n * @ingroup views_join_handlers\n *\n * @Annotation\n */\nclass ViewsJoin extends ViewsHandlerAnnotationBase {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Annotation/ViewsJoin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsJoin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Component\ndescription: A component has children.\nslots:\n  title: Lorem ipsum\n  children:\n    - type: component\n      component: 'display_builder:layer'\n      slots:\n        title: Block 1\n    - type: component\n      component: 'display_builder:layer'\n      slots:\n        title: Block 2\n    - type: component\n      component: 'display_builder:layer'\n      slots:\n        title: Component 1\n        children:\n          type: component\n          component: 'display_builder:layer'\n          slots:\n            title: Block 3\n      props:\n        variant: component\n", "metadata": {"source": "repos/display_builder/components/layer/stories/layer.component.story.yml", "type": "yaml_reference", "topic": "layer.component.story"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "include:\n  - project: $_GITLAB_TEMPLATES_REPO\n    ref: $_GITLAB_TEMPLATES_REF\n    file:\n      - '/includes/include.drupalci.main.yml'\n      - '/includes/include.drupalci.variables.yml'\n      - '/includes/include.drupalci.workflows.yml'\n\nvariables:\n  OPT_IN_TEST_PREVIOUS_MINOR: 1\n  OPT_IN_TEST_NEXT_MINOR: 1\n  _SHOW_ENVIRONMENT_VARIABLES: 1\n\nphpcs:\n  allow_failure: false\n\nphpstan:\n  allow_failure: false\n\nstylelint:\n  allow_failure: false\n\neslint:\n  allow_failure: false\n\nphpunit:\n  allow_failure: false\n", "metadata": {"source": "repos/webprofiler/.gitlab-ci.yml", "type": "yaml_reference", "topic": ".gitlab-ci"}}
{"instruction": "Show me the implementation of the class ResourceObjectData in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\JsonApiResource;\n\nuse Drupal\\Component\\Assertion\\Inspector;\nuse Drupal\\jsonapi\\Exception\\EntityAccessDeniedHttpException;\n\n/**\n * Represents the primary data for individual and collection documents.\n *\n * @internal JSON:API maintains no PHP API. The API is the HTTP API. This class\n *   may change at any time and could break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n */\nclass ResourceObjectData extends Data implements TopLevelDataInterface {\n\n  /**\n   * ResourceObjectData constructor.\n   *\n   * @param \\Drupal\\jsonapi\\JsonApiResource\\ResourceObject[]|\\Drupal\\jsonapi\\Exception\\EntityAccessDeniedHttpException[] $data\n   *   Resource objects that are the primary data for the response.\n   * @param int $cardinality\n   *   The number of resources that this collection may contain.\n   *\n   * @see \\Drupal\\jsonapi\\JsonApiResource\\Data::__construct\n   */\n  public function __construct($data, $cardinality = -1) {\n    assert(Inspector::assertAllObjects($data, ResourceObject::class, EntityAccessDeniedHttpException::class));\n    parent::__construct($data, $cardinality);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getData() {\n    return $this->getAccessible();\n  }\n\n  /**\n   * Gets only data to be exposed.\n   *\n   * @return static\n   */\n  public function getAccessible() {\n    $accessible_data = [];\n    foreach ($this->data as $resource_object) {\n      if (!$resource_object instanceof EntityAccessDeniedHttpException) {\n        $accessible_data[] = $resource_object;\n      }\n    }\n    return new static($accessible_data, $this->cardinality);\n  }\n\n  /**\n   * Gets only data to be omitted.\n   *\n   * @return static\n   */\n  public function getOmissions() {\n    $omitted_data = [];\n    foreach ($this->data as $resource_object) {\n      if ($resource_object instanceof EntityAccessDeniedHttpException) {\n        $omitted_data[] = $resource_object;\n      }\n    }\n    return new OmittedData($omitted_data);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMergedLinks(LinkCollection $top_level_links) {\n    return $top_level_links;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMergedMeta(array $top_level_meta) {\n    return $top_level_meta;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/JsonApiResource/ResourceObjectData.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ResourceObjectData", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: BcRoute\nSource file: <source_file>\nFile name hint: BcRoute.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Routing;\n\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * A backwards compatibility route.\n *\n * When a route is deprecated for another one, and backwards compatibility is\n * provided, then it's best practice to:\n * - not duplicate all route definition metadata, to instead have an \"as empty\n *   as possible\" route\n * - have an accompanying outbound route processor, that overwrites this empty\n *   route definition with the redirected route's definition.\n *\n * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use route\n * aliases instead.\n *\n * @see https://www.drupal.org/node/3317784\n */\nclass BcRoute extends Route {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct() {\n    parent::__construct('');\n    $this->setOption('bc_route', TRUE);\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use route aliases instead. See https://www.drupal.org/node/3317784', E_USER_DEPRECATED);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Routing;\n\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * A backwards compatibility route.\n *\n * When a route is deprecated for another one, and backwards compatibility is\n * provided, then it's best practice to:\n * - not duplicate all route definition metadata, to instead have an \"as empty\n *   as possible\" route\n * - have an accompanying outbound route processor, that overwrites this empty\n *   route definition with the redirected route's definition.\n *\n * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use route\n * aliases instead.\n *\n * @see https://www.drupal.org/node/3317784\n */\nclass BcRoute extends Route {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct() {\n    parent::__construct('');\n    $this->setOption('bc_route', TRUE);\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. Use route aliases instead. See https://www.drupal.org/node/3317784', E_USER_DEPRECATED);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Routing/BcRoute.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BcRoute", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: KeyGenerator.php\nTarget symbol: class is\nNamespace: Drupal\\easy_encryption\\KeyManagement\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for is.\n- Include required imports:\n  - Drupal\\Component\\Uuid\\UuidInterface\n  - Drupal\\easy_encryption\\Encryption\\EncryptionKeyId\n  - Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface\n  - Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n  - Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface\n  - Psr\\Log\\LoggerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - generate()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\Component\\Uuid\\UuidInterface;\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\nuse Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface;\nuse Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Coordinates encryption key generation and activation.\n *\n * @internal This class is not part of the module's public programming API.\n */\nfinal class KeyGenerator implements KeyGeneratorInterface {\n\n  public function __construct(\n    private readonly SodiumKeyPairRepositoryInterface $repository,\n    private readonly MutableKeyRegistryInterface $keyRegistry,\n    private readonly UuidInterface $uuid,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function generate(?EncryptionKeyId $keyId = NULL): EncryptionKeyId {\n    if ($keyId === NULL) {\n      $keyId = EncryptionKeyId::fromUserInput($this->uuid->generate());\n    }\n\n    try {\n      $this->repository->generateKeyPair($keyId->value);\n      $this->keyRegistry->register($keyId);\n    }\n    catch (SodiumKeyPairOperationException $e) {\n      throw KeyGeneratorException::generationFailed($keyId->value, $e);\n    }\n\n    $this->logger->notice('Generated encryption key {id}.', ['id' => $keyId->value]);\n    return $keyId;\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyGenerator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyGenerator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'FlowDrop UI Agents'\ntype: module\ndescription: 'Provides FlowDrop visual editor integration for AI Agents using Modeler API.'\npackage: FlowDrop\ncore_version_requirement: ^11\ndependencies:\n  - ai:ai\n  - ai_agents:ai_agents\n  - modeler_api:modeler_api\n  - flowdrop:flowdrop_ui\n", "metadata": {"source": "repos/flowdrop_ui_agents/flowdrop_ui_agents.info.yml", "type": "yaml_reference", "topic": "flowdrop ui agents.info"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% block toolbar %}\n    {% set icon %}\n        {{ include('@webprofiler/Icon/drupal-10.svg') }}\n\n        <span class=\"sf-toolbar-value sf-toolbar-ajax-request-counter\">\n            Loading&hellip;\n        </span>\n    {% endset %}\n\n    {% set text %}\n        <div class=\"sf-toolbar-info-piece\">\n            <b>Loading the Webprofiler toolbar&hellip;</b>\n        </div>\n        <div class=\"sf-toolbar-info-piece\">\n            Attempt #<span id=\"sfLoadCounter-{{ token }}\"></span>\n        </div>\n        <div class=\"sf-toolbar-info-piece\">\n            <b>\n                <button class=\"sf-cancel-button\" type=\"button\" id=\"sfLoadCancel-{{ token }}\" title=\"Cancel loading\">Cancel</button>\n            </b>\n        </div>\n    {% endset %}\n\n    {{ include('@webprofiler/Profiler/toolbar_item.html.twig', { link: profiler_url }) }}\n{% endblock %}\n", "metadata": {"source": "repos/webprofiler/templates/Profiler/cancel.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class Module in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Updater;\n\n/**\n * Defines a class for updating modules.\n *\n * Uses Drupal\\Core\\FileTransfer\\FileTransfer classes via authorize.php.\n *\n * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. There is no\n *   replacement. Use composer to manage the code for your site.\n *\n * @see https://www.drupal.org/node/3512364\n */\nclass Module extends Updater implements UpdaterInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct($source, $root) {\n    @trigger_error('The ' . __NAMESPACE__ . '\\Module class is deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. There is no replacement. Use composer to manage the code for your site. See https://www.drupal.org/node/3512364', E_USER_DEPRECATED);\n    parent::__construct($source, $root);\n  }\n\n  /**\n   * Returns the directory where a module should be installed.\n   *\n   * If the module is already installed, ModuleExtensionList::getPath() will\n   * return a valid path and we should install it there. If we're installing a\n   * new module, we always want it to go into /modules, since that's where all\n   * the documentation recommends users install their modules, and there's no\n   * way that can conflict on a multi-site installation, since the Update\n   * manager won't let you install a new module if it's already found on your\n   * system, and if there was a copy in the top-level we'd see it.\n   *\n   * @return string\n   *   The absolute path of the directory.\n   */\n  public function getInstallDirectory() {\n    if ($this->isInstalled() && ($relative_path = \\Drupal::service('extension.list.module')->getPath($this->name))) {\n      // The return value of ExtensionList::getPath() is always relative to the\n      // site, so prepend DRUPAL_ROOT.\n      return DRUPAL_ROOT . '/' . dirname($relative_path);\n    }\n    else {\n      // When installing a new module, prepend the requested root directory.\n      return $this->root . '/' . $this->getRootDirectoryRelativePath();\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getRootDirectoryRelativePath() {\n    return 'modules';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isInstalled() {\n    // Check if the module exists in the file system, regardless of whether it\n    // is enabled or not.\n    /** @var \\Drupal\\Core\\Extension\\ExtensionList $module_extension_list */\n    $module_extension_list = \\Drupal::service('extension.list.module');\n    return $module_extension_list->exists($this->name);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function canUpdateDirectory($directory) {\n    $info = static::getExtensionInfo($directory);\n\n    return (isset($info['type']) && $info['type'] == 'module');\n  }\n\n  /**\n   * Determines whether this class can update the specified project.\n   *\n   * @param string $project_name\n   *   The project to check.\n   *\n   * @return bool\n   *   TRUE if the the project can be updated, FALSE otherwise.\n   */\n  public static function canUpdate($project_name) {\n    return (bool) \\Drupal::service('extension.list.module')->getPath($project_name);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function postUpdateTasks() {\n    // We don't want to check for DB updates here, we do that once for all\n    // updated modules on the landing page.\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Updater/Module.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Module", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait WorkspaceSafeFormTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\Form;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\workspaces\\WorkspaceInformationInterface;\n\n/**\n * Provides helpers for checking whether objects in forms are workspace-safe.\n */\ntrait WorkspaceSafeFormTrait {\n\n  /**\n   * The workspace information service.\n   */\n  protected ?WorkspaceInformationInterface $workspaceInfo = NULL;\n\n  /**\n   * Determines whether an entity used in a form is workspace-safe.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   An entity object.\n   *\n   * @return bool\n   *   TRUE if the entity is workspace-safe, FALSE otherwise.\n   */\n  protected function isWorkspaceSafeEntity(EntityInterface $entity): bool {\n    if (!\\Drupal::hasService('workspaces.information')) {\n      return FALSE;\n    }\n\n    $is_supported = $this->getWorkspaceInfo()->isEntitySupported($entity);\n    $is_ignored = $this->getWorkspaceInfo()->isEntityIgnored($entity);\n\n    return $is_supported || $is_ignored;\n  }\n\n  /**\n   * Determines whether an entity type used in a form is workspace-safe.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   An entity type object.\n   *\n   * @return bool\n   *   TRUE if the entity type is workspace-safe, FALSE otherwise.\n   */\n  protected function isWorkspaceSafeEntityType(EntityTypeInterface $entity_type): bool {\n    if (!\\Drupal::hasService('workspaces.information')) {\n      return FALSE;\n    }\n\n    $is_supported = $this->getWorkspaceInfo()->isEntityTypeSupported($entity_type);\n    $is_ignored = $this->getWorkspaceInfo()->isEntityTypeIgnored($entity_type);\n\n    return $is_supported || $is_ignored;\n  }\n\n  /**\n   * Retrieves the workspace information service.\n   *\n   * @return \\Drupal\\workspaces\\WorkspaceInformationInterface\n   *   The workspace information service.\n   */\n  protected function getWorkspaceInfo(): WorkspaceInformationInterface {\n    if (!$this->workspaceInfo) {\n      $this->workspaceInfo = \\Drupal::service('workspaces.information');\n    }\n\n    return $this->workspaceInfo;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/Form/WorkspaceSafeFormTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "WorkspaceSafeFormTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface LayoutInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Layout;\n\nuse Drupal\\Component\\Plugin\\DerivativeInspectionInterface;\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Plugin\\ContextAwarePluginInterface;\n\n/**\n * Provides an interface for static Layout plugins.\n */\ninterface LayoutInterface extends PluginInspectionInterface, DerivativeInspectionInterface, ConfigurableInterface, DependentPluginInterface, ContextAwarePluginInterface {\n\n  /**\n   * Build a render array for layout with regions.\n   *\n   * @param array $regions\n   *   An associative array keyed by region name, containing render arrays\n   *   representing the content that should be placed in each region.\n   *\n   * @return array\n   *   Render array for the layout with regions.\n   */\n  public function build(array $regions);\n\n  /**\n   * {@inheritdoc}\n   *\n   * @return \\Drupal\\Core\\Layout\\LayoutDefinition\n   *   The layout plugin definition for this plugin.\n   */\n  public function getPluginDefinition();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Layout/LayoutInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "LayoutInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'Require Revision'\ntype: module\ndescription: 'Allows admins to configure which entity types require revisions and revision log messages.'\ncore_version_requirement: ^10.2 || ^11\npackage: 'Content Authoring'\nconfigure: require_revision.settings\ndependencies:\n  - drupal:block_content\n  - drupal:node\n  - drupal:taxonomy\n", "metadata": {"source": "repos/require_revision/require_revision.info.yml", "type": "yaml_reference", "topic": "require revision.info"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  system.skip_procedural_hook_scan: false\n\nservices:\n  _defaults:\n    autoconfigure: true\n  access_check.cron:\n    class: Drupal\\system\\Access\\CronAccessCheck\n    tags:\n      - { name: access_check, applies_to: _access_system_cron }\n  access_check.db_update:\n    class: Drupal\\system\\Access\\DbUpdateAccessCheck\n    tags:\n      - { name: access_check, applies_to: _access_system_update }\n  access_check.admin_menu_block_page:\n    class: Drupal\\system\\Access\\SystemAdminMenuBlockAccessCheck\n    arguments: ['@menu.link_tree', '@router', '@plugin.manager.menu.link']\n    tags:\n      - { name: access_check, applies_to: _access_admin_menu_block_page }\n  access_check.admin_overview_page:\n    class: Drupal\\system\\Access\\SystemAdminMenuBlockAccessCheck\n    arguments: ['@menu.link_tree', '@router', '@plugin.manager.menu.link' ]\n    tags:\n      - { name: access_check, applies_to: _access_admin_overview_page }\n  system.manager:\n    class: Drupal\\system\\SystemManager\n    arguments: ['@module_handler', '@request_stack', '@menu.link_tree', '@menu.active_trail']\n  Drupal\\system\\SystemManager: '@system.manager'\n  system.breadcrumb.default:\n    class: Drupal\\system\\PathBasedBreadcrumbBuilder\n    arguments: ['@router.request_context', '@access_manager', '@router', '@path_processor_manager', '@config.factory',  '@title_resolver', '@current_user', '@path.current', '@path.matcher']\n    tags:\n      - { name: breadcrumb_builder, priority: 0 }\n  path_processor.files:\n    class: Drupal\\system\\PathProcessor\\PathProcessorFiles\n    tags:\n      - { name: path_processor_inbound, priority: 200 }\n  system.admin_path.route_subscriber:\n    class: Drupal\\system\\EventSubscriber\\AdminRouteSubscriber\n  theme.negotiator.system.batch:\n    class: Drupal\\system\\Theme\\BatchNegotiator\n    arguments: ['@batch.storage', '@request_stack']\n    tags:\n      - { name: theme_negotiator, priority: 1000 }\n  theme.negotiator.system.db_update:\n    class: Drupal\\system\\Theme\\DbUpdateNegotiator\n    arguments: ['@config.factory', '@theme_handler']\n    tags:\n      - { name: theme_negotiator, priority: 100 }\n  Drupal\\system\\Theme\\SystemAdminThemePreprocess:\n    class: Drupal\\system\\Theme\\SystemAdminThemePreprocess\n    autowire: true\n  system.config_subscriber:\n    class: Drupal\\system\\SystemConfigSubscriber\n    arguments: ['@router.builder']\n  system.config_cache_tag:\n    class: Drupal\\system\\EventSubscriber\\ConfigCacheTag\n    arguments: ['@theme_handler', '@cache_tags.invalidator', '@theme.registry']\n  system.timezone_resolver:\n    class: Drupal\\system\\TimeZoneResolver\n    arguments: ['@current_user', '@config.factory']\n  system.file_event.subscriber:\n    class: Drupal\\system\\EventSubscriber\\SecurityFileUploadEventSubscriber\n    arguments: ['@config.factory']\n  logger.channel.system:\n    parent: logger.channel_base\n    arguments: ['system']\n  system.sa_fetcher:\n    class: Drupal\\system\\SecurityAdvisories\\SecurityAdvisoriesFetcher\n    arguments: ['@config.factory', '@keyvalue.expirable', '@http_client', '@extension.list.module', '@extension.list.theme', '@extension.list.profile', '@logger.channel.system', '@settings']\n  Drupal\\system\\SecurityAdvisories\\SecurityAdvisoriesFetcher: '@system.sa_fetcher'\n  system.advisories_config_subscriber:\n    class: Drupal\\system\\EventSubscriber\\AdvisoriesConfigSubscriber\n    arguments: ['@system.sa_fetcher']\n  Drupal\\system\\Routing\\MenuLinksetRoutes: '@system.menus.route_subscriber'\n  system.menus.route_subscriber:\n    class: Drupal\\system\\Routing\\MenuLinksetRoutes\n    arguments: ['%authentication_providers%', '@config.factory', '@router.builder']\n  Drupal\\system\\ModuleAdminLinksHelper: '@system.module_admin_links_helper'\n  system.module_admin_links_helper:\n    class: Drupal\\system\\ModuleAdminLinksHelper\n    arguments: ['@menu.link_tree', '@cache.memory']\n  system.module_admin_links_memory_cache:\n    class: Drupal\\Core\\Cache\\MemoryCache\\MemoryCache\n    arguments: ['@datetime.time']\n    deprecated: The \"%service_id%\" service is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Inject \"cache.memory\" instead. See https://www.drupal.org/node/3047289\n  system.access_route_alter_subscriber:\n    class: Drupal\\system\\EventSubscriber\\AccessRouteAlterSubscriber\n", "metadata": {"source": "repos/drupal_core/core/modules/system/system.services.yml", "type": "yaml_reference", "topic": "system.services"}}
{"instruction": "Show me the implementation of the class DatabaseEvent in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Event;\n\nuse Drupal\\Component\\EventDispatcher\\Event;\n\n/**\n * Represents a database event.\n */\nabstract class DatabaseEvent extends Event {\n\n  /**\n   * The time of the event.\n   */\n  public readonly float $time;\n\n  /**\n   * Constructs a DatabaseEvent object.\n   */\n  public function __construct() {\n    $this->time = microtime(TRUE);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Event/DatabaseEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DatabaseEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DynamicSchemaEndpoint in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\DTO\\ConfigEdit;\n\n/**\n * Value object for dynamic schema endpoint configuration.\n *\n * Represents the configuration for fetching a node's config schema\n * dynamically from a REST endpoint at runtime. This is useful when:\n * - Config options depend on external data (e.g., available models, API keys)\n * - Options change based on user authentication or permissions\n * - Schema needs to be refreshed periodically.\n *\n * @see config-edit.md for full specification\n */\nfinal class DynamicSchemaEndpoint {\n\n  /**\n   * Constructs a DynamicSchemaEndpoint.\n   *\n   * @param string $url\n   *   The URL endpoint to fetch the schema from.\n   *   Supports template variables like {nodeTypeId}, {instanceId}.\n   * @param string $method\n   *   HTTP method to use (GET, POST). Defaults to GET.\n   * @param array<string, string> $parameterMapping\n   *   Maps URL template variables to node data paths.\n   *   Example: [\"nodeTypeId\" => \"metadata.id\", \"instanceId\" => \"id\"].\n   * @param array<string, string> $headers\n   *   Additional HTTP headers to include in the request.\n   * @param bool $cacheSchema\n   *   Whether to cache the fetched schema. Default TRUE.\n   *   Set to FALSE if schema varies by dynamic parameters.\n   * @param int $timeout\n   *   Request timeout in milliseconds. Default 10000 (10 seconds).\n   */\n  public function __construct(\n    public readonly string $url,\n    public readonly string $method = \"GET\",\n    public readonly array $parameterMapping = [],\n    public readonly array $headers = [],\n    public readonly bool $cacheSchema = TRUE,\n    public readonly int $timeout = 10000,\n  ) {}\n\n  /**\n   * Creates an instance from an array.\n   *\n   * @param array<string, mixed> $data\n   *   The array data to create the instance from.\n   *\n   * @return self\n   *   The created instance.\n   */\n  public static function fromArray(array $data): self {\n    return new self(\n      url: $data[\"url\"] ?? \"\",\n      method: $data[\"method\"] ?? \"GET\",\n      parameterMapping: $data[\"parameterMapping\"] ?? [],\n      headers: $data[\"headers\"] ?? [],\n      cacheSchema: $data[\"cacheSchema\"] ?? TRUE,\n      timeout: $data[\"timeout\"] ?? 10000,\n    );\n  }\n\n  /**\n   * Converts the object to an array suitable for JSON serialization.\n   *\n   * @return array<string, mixed>\n   *   The array representation.\n   */\n  public function toArray(): array {\n    return [\n      \"url\" => $this->url,\n      \"method\" => $this->method,\n      \"parameterMapping\" => $this->parameterMapping,\n      \"headers\" => $this->headers,\n      \"cacheSchema\" => $this->cacheSchema,\n      \"timeout\" => $this->timeout,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/src/DTO/ConfigEdit/DynamicSchemaEndpoint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DynamicSchemaEndpoint", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# business_identity/config/schema/business_identity.schema.yml\n# Schema for configuration files of the Business Identity module.\n\nbusiness_identity.settings:\n  type: config_object\n  label: 'Business identity settings'\n  mapping:\n    company_name:\n      type: string\n      label: 'Company name'\n    slogan:\n      type: string\n      label: 'Slogan'\n    description:\n      type: string\n      label: 'Description'\n    logo:\n      type: sequence\n      label: 'Logo file ID'\n      sequence:\n        type: integer\n        label: 'File ID'\n    address:\n      type: mapping\n      label: 'Business address'\n      mapping:\n        country_code:\n          type: string\n          label: 'Country code'\n        administrative_area:\n          type: string\n          label: 'Administrative area'\n        locality:\n          type: string\n          label: 'Locality'\n        dependent_locality:\n          type: string\n          label: 'Dependent locality'\n        postal_code:\n          type: string\n          label: 'Postal code'\n        sorting_code:\n          type: string\n          label: 'Sorting code'\n        address_line1:\n          type: string\n          label: 'Address line 1'\n        address_line2:\n          type: string\n          label: 'Address line 2'\n        organization:\n          type: string\n          label: 'Organization'\n        given_name:\n          type: string\n          label: 'Given name'\n        additional_name:\n          type: string\n          label: 'Additional name'\n        family_name:\n          type: string\n          label: 'Family name'\n    address_simple:\n      type: string\n      label: 'Simple address'\n    phone:\n      type: string\n      label: 'Phone number'\n    support_email:\n      type: string\n      label: 'Customer support email'\n    support_phone:\n      type: string\n      label: 'Customer support phone'\n    headquarters_address:\n      type: address\n      label: 'Headquarters address'\n    point_of_sale_address:\n      type: address\n      label: 'Point of sale address'\n    email:\n      type: string\n      label: 'Email'\n    contact_email:\n      type: string\n      label: 'Contact email'\n    legal_name:\n      type: string\n      label: 'Legal name'\n    tax_id:\n      type: string\n      label: 'Tax ID'\n    company_registration:\n      type: string\n      label: 'Company registration number'\n    legal_form:\n      type: string\n      label: 'Legal form'\n    registered_capital:\n      type: float\n      label: 'Registered capital'\n    website:\n      type: string\n      label: 'Website'\n    social_links:\n      type: mapping\n      label: 'Social links'\n      mapping:\n        facebook:\n          type: string\n          label: 'Facebook URL'\n        twitter:\n          type: string\n          label: 'Twitter URL'\n        linkedin:\n          type: string\n          label: 'LinkedIn URL'\n        instagram:\n          type: string\n          label: 'Instagram URL'\n        youtube:\n          type: string\n          label: 'YouTube URL'\n        pinterest:\n          type: string\n          label: 'Pinterest URL'\n        tiktok:\n          type: string\n          label: 'TikTok URL'\n    privacy_policy:\n      type: string\n      label: 'Privacy policy URL'\n    terms_conditions:\n      type: string\n      label: 'Terms and conditions URL'\n    business_sector:\n      type: string\n      label: 'Business sector'\n    founding_year:\n      type: integer\n      label: 'Founding year'\n    employees_range:\n      type: string\n      label: 'Employees range'\n    opening_hours:\n      type: sequence\n      label: 'Opening hours'\n    measurement_unit:\n      type: string\n      label: 'Measurement unit'\n    currency:\n      type: string\n      label: 'Currency'\n    date_format:\n      type: string\n      label: 'Date format'\n    time_format:\n      type: string\n      label: 'Time format'\n    timezone:\n      type: string\n      label: 'Timezone'\n    meta_title:\n      type: string\n      label: 'Meta title'\n    meta_description:\n      type: string\n      label: 'Meta description'\n    keywords:\n      type: string\n      label: 'Keywords'\n    primary_color:\n      type: string\n      label: 'Primary color'\n    secondary_color:\n      type: string\n      label: 'Secondary color'\n    accent_color:\n      type: string\n      label: 'Accent color'\n    font_family:\n      type: string\n      label: 'Font family'\n    maintenance_message:\n      type: string\n      label: 'Maintenance message'\n    google_maps_key:\n      type: string\n      label: 'Google Maps API key'\n    recaptcha_site_key:\n      type: string\n      label: 'reCAPTCHA site key'\n    recaptcha_secret_key:\n      type: string\n      label: 'reCAPTCHA secret key'\n    headquarters_lat:\n      type: string\n      label: 'Headquarters latitude'\n    headquarters_lng:\n      type: string\n      label: 'Headquarters longitude'\n    point_of_sale_lat:\n      type: string\n      label: 'Point of sale latitude'\n    point_of_sale_lng:\n      type: string\n      label: 'Point of sale longitude'\n", "metadata": {"source": "repos/business_identity/config/schema/business_identity.schema.yml", "type": "yaml_reference", "topic": "business identity.schema"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% set attributes = image ? attributes.addClass('card-image') : attributes.addClass('card-basic') %}\n<sl-card {{ attributes }}>\n  {{ image|set_attribute('slot', 'image') }}\n  {% if header %}\n  <div slot=\"header\">\n  {{ header }}\n  </div>\n  {% endif %}\n  {{ content }}\n  {% if footer %}\n  <div slot=\"footer\">\n  {{ footer }}\n  </div>\n  {% endif %}\n</sl-card>\n", "metadata": {"source": "repos/display_builder/components/shoelace/card/card.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "ai_revision_assistant.settings:\n  title: 'AI Revision Assistant'\n  description: 'Configure AI-powered revision analysis and regression detection.'\n  parent: ai.admin_settings\n  route_name: ai_revision_assistant.settings\n  weight: 10\n", "metadata": {"source": "repos/ai_revision_assistant/ai_revision_assistant.links.menu.yml", "type": "yaml_reference", "topic": "ai revision assistant.links.menu"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ApiNormalizationAccessChecker.php\nTarget symbol: class ApiNormalizationAccessChecker\nNamespace: Drupal\\api_normalization\\Access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ApiNormalizationAccessChecker.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Routing\\Access\\AccessInterface\n  - Drupal\\Core\\Session\\AccountInterface\n- Ensure these methods exist where relevant:\n  - access()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Access checker for API Normalizer operations.\n */\nclass ApiNormalizationAccessChecker implements AccessInterface {\n\n  /**\n   * Check access for API Normalizer operations.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The currently logged in account.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(AccountInterface $account) {\n    // Allow access to users with 'administer api normalizer' permission\n    // or users with 'administer site configuration' permission.\n    if ($account->hasPermission('administer api normalizer') ||\n        $account->hasPermission('administer site configuration')) {\n      return AccessResult::allowed();\n    }\n\n    return AccessResult::forbidden();\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Access/ApiNormalizationAccessChecker.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiNormalizationAccessChecker", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  config:\n    - node.type.article\n  module:\n    - content_translation\nthird_party_settings:\n  content_translation:\n    enabled: true\nid: node.article\ntarget_entity_type_id: node\ntarget_bundle: article\ndefault_langcode: site_default\nlanguage_alterable: true\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/language.content_settings.node.article.yml", "type": "yaml_reference", "topic": "language.content settings.node.article"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override to display a node.\n *\n * Available variables:\n * - node: The node entity with limited access to object properties and methods.\n *   Only method names starting with \"get\", \"has\", or \"is\" and a few common\n *   methods such as \"id\", \"label\", and \"bundle\" are available. For example:\n *   - node.getCreatedTime() will return the node creation timestamp.\n *   - node.hasField('field_example') returns TRUE if the node bundle includes\n *     field_example. (This does not indicate the presence of a value in this\n *     field.)\n *   - node.isPublished() will return whether the node is published or not.\n *   Calling other methods, such as node.delete(), will result in an exception.\n *   See \\Drupal\\node\\Entity\\Node for a full list of public properties and\n *   methods for the node object.\n * - label: (optional) The title of the node.\n * - content: All node items. Use {{ content }} to print them all,\n *   or print a subset such as {{ content.field_example }}. Use\n *   {{ content|without('field_example') }} to temporarily suppress the printing\n *   of a given child element.\n * - author_picture: The node author user entity, rendered using the \"compact\"\n *   view mode.\n * - date: (optional) Themed creation date field.\n * - author_name: (optional) Themed author name field.\n * - url: Direct URL of the current node.\n * - display_submitted: Whether submission information should be displayed.\n * - attributes: HTML attributes for the containing element.\n *   The attributes.class element may contain one or more of the following\n *   classes:\n *   - node: The current template type (also known as a \"theming hook\").\n *   - node--type-[type]: The current node type. For example, if the node is an\n *     \"Article\" it would result in \"node--type-article\". Note that the machine\n *     name will often be in a short form of the human readable label.\n *   - node--view-mode-[view_mode]: The View Mode of the node; for example, a\n *     teaser would result in: \"node--view-mode-teaser\", and\n *     full: \"node--view-mode-full\".\n *   The following are controlled through the node publishing options.\n *   - node--promoted: Appears on nodes promoted to the front page.\n *   - node--sticky: Appears on nodes ordered above other non-sticky nodes in\n *     teaser listings.\n *   - node--unpublished: Appears on unpublished nodes visible only to site\n *     admins.\n * - title_attributes: Same as attributes, except applied to the main title\n *   tag that appears in the template.\n * - content_attributes: Same as attributes, except applied to the main\n *   content tag that appears in the template.\n * - author_attributes: Same as attributes, except applied to the author of\n *   the node tag that appears in the template.\n * - title_prefix: Additional output populated by modules, intended to be\n *   displayed in front of the main title tag that appears in the template.\n * - title_suffix: Additional output populated by modules, intended to be\n *   displayed after the main title tag that appears in the template.\n * - view_mode: View mode; for example, \"teaser\" or \"full\".\n * - teaser: Flag for the teaser state. Will be true if view_mode is 'teaser'.\n *\n * @see \\Drupal\\node\\Hook\\NodeThemeHooks::preprocessNode()\n *\n */\n#}\n{%\n  set classes = [\n    'node',\n    'node--type-' ~ node.bundle|clean_class,\n    node.isPromoted() ? 'node--promoted',\n    node.isSticky() ? 'node--sticky',\n    not node.isPublished() ? 'node--unpublished',\n    view_mode ? 'node--view-mode-' ~ view_mode|clean_class,\n  ]\n%}\n{{ attach_library('claro/classy.node') }}\n<article{{ attributes.addClass(classes) }}>\n\n  {{ title_prefix }}\n  {% if label and view_mode != \"full\" %}\n    <h2{{ title_attributes }}>\n      <a href=\"{{ url }}\" rel=\"bookmark\">{{ label }}</a>\n    </h2>\n  {% endif %}\n  {{ title_suffix }}\n\n  {% if display_submitted %}\n    <footer class=\"node__meta\">\n      {{ author_picture }}\n      <div{{ author_attributes.addClass('node__submitted') }}>\n        {% trans %}Submitted by {{ author_name }} on {{ date }}{% endtrans %}\n        {{ metadata }}\n      </div>\n    </footer>\n  {% endif %}\n\n  <div{{ content_attributes.addClass('node__content') }}>\n    {{ content }}\n  </div>\n\n</article>\n", "metadata": {"source": "repos/drupal_core/core/themes/claro/templates/classy/content/node.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'MCP Tools - Pathauto'\ntype: module\ndescription: 'URL alias pattern management: create, update, delete, and generate URL aliases using Pathauto patterns.'\npackage: MCP Tools\ncore_version_requirement: ^10.3 || ^11\ndependencies:\n  - mcp_tools:mcp_tools\n  - pathauto:pathauto\nlifecycle: experimental\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_pathauto/mcp_tools_pathauto.info.yml", "type": "yaml_reference", "topic": "mcp tools pathauto.info"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: LocaleServiceProvider.php\nTarget symbol: class LocaleServiceProvider\nNamespace: Drupal\\locale\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for LocaleServiceProvider.\n- Include required imports:\n  - Drupal\\Core\\Config\\BootstrapConfigStorageFactory\n  - Drupal\\Core\\DependencyInjection\\ContainerBuilder\n  - Drupal\\Core\\DependencyInjection\\ServiceProviderBase\n- Ensure these methods exist where relevant:\n  - alter()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\locale;\n\nuse Drupal\\Core\\Config\\BootstrapConfigStorageFactory;\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderBase;\n\n/**\n * Overrides the language_manager service to point to language's module one.\n */\nclass LocaleServiceProvider extends ServiceProviderBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alter(ContainerBuilder $container): void {\n    if ($container->hasParameter('language.translate_english')) {\n      $config_storage = BootstrapConfigStorageFactory::get();\n      $config = $config_storage->read('locale.settings');\n      if ($config) {\n        $container->setParameter('language.translate_english', $config['translate_english'] ?? TRUE);\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/src/LocaleServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LocaleServiceProvider", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: RouteBuilderInterface.php", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# RouteBuilderInterface.php\n\nSame filename and directory in other branches\n\n1. [10 core/lib/Drupal/Core/Routing/RouteBuilderInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Routing%21RouteBuilderInterface.php/10)\n2. [9 core/lib/Drupal/Core/Routing/RouteBuilderInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Routing%21RouteBuilderInterface.php/9)\n3. [8.9.x core/lib/Drupal/Core/Routing/RouteBuilderInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Routing%21RouteBuilderInterface.php/8.9.x)\n\n### Namespace\n\n[Drupal\\Core\\Routing](/api/drupal/namespace/Drupal%21Core%21Routing/11.x)\n\n### File\n\n[View on git.drupalcode.org](https://git.drupalcode.org/project/drupal/-/blob/11.x/core/lib/Drupal/Core/Routing/RouteBuilderInterface.php)\n\ncore/lib/Drupal/Core/Routing/[RouteBuilderInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Routing%21RouteBuilderInterface.php/11.x)\n\nView source\n\n```\n<?php\n\nnamespace Drupal\\Core\\Routing;\n\n/**\n * Rebuilds the route information and dumps it.\n *\n * Rebuilding the route information is the process of gathering all routing data\n * from .routing.yml files, creating a\n * \\Symfony\\Component\\Routing\\RouteCollection object out of it, and dispatching\n * that object as a \\Drupal\\Core\\Routing\\RouteBuildEvent to all registered\n * listeners. After that, the \\Symfony\\Component\\Routing\\RouteCollection object\n * is used to dump the data. Examples of a dump include filling up the routing\n * table, auto-generating Apache mod_rewrite rules, or auto-generating a PHP\n * matcher class.\n *\n * @see \\Drupal\\Core\\Routing\\MatcherDumperInterface\n * @see \\Drupal\\Core\\Routing\\RouteProviderInterface\n *\n * @ingroup routing\n */\ninterface RouteBuilderInterface {\n\n  /**\n   * Rebuilds the route information and dumps it.\n   *\n   * @return bool\n   *   Returns TRUE if the rebuild succeeds, FALSE otherwise.\n   */\n  public function rebuild();\n\n  /**\n   * Rebuilds the route information if necessary, and dumps it.\n   *\n   * @return bool\n   *   Returns TRUE if the rebuild occurs, FALSE otherwise.\n   */\n  public function rebuildIfNeeded();\n\n  /**\n   * Sets the router to be rebuilt next time rebuildIfNeeded() is called.\n   */\n  public function setRebuildNeeded();\n\n}\n```\n\n### Interfaces\n\n| Title | Deprecated | Summary |\n| --- | --- | --- |\n| [RouteBuilderInterface](/api/drupal/core%21lib%21Drupal%21Core%21Routing%21RouteBuilderInterface.php/interface/RouteBuilderInterface/11.x) |  | Rebuilds the route information and dumps it. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Routing%2521RouteBuilderInterface.php/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21lib%21Drupal%21Core%21Routing%21RouteBuilderInterface.php/11.x.md", "type": "doc_summary", "topic": "RouteBuilderInterface.php"}}
{"instruction": "Show me the implementation of the class CountryBlockSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\country_block\\EventSubscriber;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\HttpKernel\\Event\\RequestEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException;\nuse Symfony\\Component\\HttpKernel\\KernelEvents;\n\n/**\n * Blocks users from specific countries based on IP address.\n *\n * This subscriber listens to kernel requests and denies access to users\n * from countries defined in the module's configuration.\n */\nfinal class CountryBlockSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new CountryBlockSubscriber.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $currentUser\n   *   The current user.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory.\n   */\n  public function __construct(\n    private readonly AccountInterface $currentUser,\n    private readonly ConfigFactoryInterface $configFactory,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      KernelEvents::REQUEST => ['checkCountryBlock'],\n    ];\n  }\n\n  /**\n   * Checks the user's country and blocks them if they are from a blocked\n   * country.\n   *\n   * This method is called for every kernel request.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\RequestEvent $event\n   *   The dispatched event.\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException\n   *   Thrown when the user's country is in the blocked list.\n   */\n  public function checkCountryBlock(RequestEvent $event): void {\n    // Do not block users with permission to administer site configuration.\n    if ($this->currentUser->hasPermission('administer site configuration')) {\n      return;\n    }\n\n    $config = $this->configFactory->get('country_block.settings');\n    $blocked_countries = $config->get('blocked_countries') ?? [];\n\n    if (empty($blocked_countries)) {\n      return;\n    }\n\n    // Current visitor location.\n    /** @var \\Drupal\\smart_ip\\SmartIpLocation $locationService */\n    $locationService = \\Drupal::service('smart_ip.smart_ip_location');\n    $location = $locationService->getData();\n    if (empty($location)) {\n      return;\n    }\n\n    $country_code = $location->get('countryCode');\n\n    if ($country_code !== NULL && in_array($country_code, $blocked_countries, TRUE)) {\n      $message = $config->get('message') ?? 'Access from your country is not permitted.';\n      throw new AccessDeniedHttpException($message);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/country_block/src/EventSubscriber/CountryBlockSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CountryBlockSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"External content\"\nprops:\n  attributes:\n    class:\n      - bg-dark\n    data-bs-theme: dark\n  toggler_position: start\n  navbar_id: \"navbarToggleExternalContent\"\nlibrary_wrapper: >\n  <div class=\"collapse\" id=\"navbarToggleExternalContent\" data-bs-theme=\"dark\">\n    <div class=\"bg-dark p-4\">\n      <h5 class=\"text-body-emphasis h4\">Collapsed content</h5>\n      <span class=\"text-body-secondary\">Toggleable via the navbar brand.</span>\n    </div>\n  </div>\n  {{ _story }}\n", "metadata": {"source": "repos/bootstrap_components/components/navbar/stories/navbar.external_content.story.yml", "type": "yaml_reference", "topic": "navbar.external content.story"}}
{"instruction": "Show me the implementation of the class EntityRevisionParamConverter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\ParamConverter;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityRepositoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Entity\\TranslatableInterface;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Parameter converter for upcasting entity revision IDs to full objects.\n *\n * This is useful for pages which want to show a specific revision, like\n * \"/entity_example/{entity_example}/revision/{entity_example_revision}\".\n *\n *\n * In order to use it you should specify some additional options in your route:\n * @code\n * example.route:\n *   path: /foo/{entity_example_revision}\n *   options:\n *     parameters:\n *       entity_example_revision:\n *         type: entity_revision:entity_example\n * @endcode\n */\nclass EntityRevisionParamConverter implements ParamConverterInterface {\n\n  use DynamicEntityTypeParamConverterTrait;\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n  /**\n   * The entity repository.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityRepositoryInterface\n   */\n  protected $entityRepository;\n\n  /**\n   * Creates a new EntityRevisionParamConverter instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\Core\\Entity\\EntityRepositoryInterface $entity_repository\n   *   The entity repository.\n   */\n  public function __construct(EntityTypeManagerInterface $entity_type_manager, EntityRepositoryInterface $entity_repository) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->entityRepository = $entity_repository;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function convert($value, $definition, $name, array $defaults) {\n    $entity_type_id = $this->getEntityTypeFromDefaults($definition, $name, $defaults);\n    /** @var \\Drupal\\Core\\Entity\\RevisionableStorageInterface $storage */\n    $storage = $this->entityTypeManager->getStorage($entity_type_id);\n    $entity = $storage->loadRevision($value);\n\n    // If the entity type is translatable, ensure we return the proper\n    // translation object for the current context.\n    if ($entity instanceof EntityInterface && $entity instanceof TranslatableInterface) {\n      $entity = $this->entityRepository->getTranslationFromContext($entity, NULL, ['operation' => 'entity_upcast']);\n    }\n\n    return $entity;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies($definition, $name, Route $route) {\n    return isset($definition['type']) && str_contains($definition['type'], 'entity_revision:');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/ParamConverter/EntityRevisionParamConverter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityRevisionParamConverter", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Broken in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\area;\n\nuse Drupal\\views\\Attribute\\ViewsArea;\nuse Drupal\\views\\Plugin\\views\\BrokenHandlerTrait;\n\n/**\n * A special handler to take the place of missing or broken handlers.\n *\n * @ingroup views_area_handlers\n */\n#[ViewsArea(\"broken\")]\nclass Broken extends AreaPluginBase {\n  use BrokenHandlerTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render($empty = FALSE) {\n    // Simply render nothing by returning an empty render array.\n    return [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/area/Broken.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Broken", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: display_builder_views.install\nSource file: <source_file>\nFile name hint: display_builder_views.install\nCurrent implementation:\n<?php\n\n/**\n * @file\n * Contains install file.\n */\n\ndeclare(strict_types=1);\n\n/**\n * Implements hook_install().\n */\nfunction display_builder_views_install(): void {\n  $config = Drupal::service('config.factory')->getEditable('views.settings');\n  /** @var array $display_extenders */\n  $display_extenders = $config->get('display_extenders') ?: [];\n  $display_extenders[] = 'display_builder';\n  $config->set('display_extenders', $display_extenders);\n  $config->save();\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction display_builder_views_uninstall(): void {\n  $config = Drupal::service('config.factory')->getEditable('views.settings');\n  /** @var array $display_extenders */\n  $display_extenders = $config->get('display_extenders') ?: [];\n  $key = \\array_search('display_builder', $display_extenders, TRUE);\n\n  if ($key !== FALSE) {\n    unset($display_extenders[$key]);\n    $config->set('display_extenders', $display_extenders);\n    $config->save();\n  }\n}", "output": "<?php\n\n/**\n * @file\n * Contains install file.\n */\n\ndeclare(strict_types=1);\n\n/**\n * Implements hook_install().\n */\nfunction display_builder_views_install(): void {\n  $config = Drupal::service('config.factory')->getEditable('views.settings');\n  /** @var array $display_extenders */\n  $display_extenders = $config->get('display_extenders') ?: [];\n  $display_extenders[] = 'display_builder';\n  $config->set('display_extenders', $display_extenders);\n  $config->save();\n}\n\n/**\n * Implements hook_uninstall().\n */\nfunction display_builder_views_uninstall(): void {\n  $config = Drupal::service('config.factory')->getEditable('views.settings');\n  /** @var array $display_extenders */\n  $display_extenders = $config->get('display_extenders') ?: [];\n  $key = \\array_search('display_builder', $display_extenders, TRUE);\n\n  if ($key !== FALSE) {\n    unset($display_extenders[$key]);\n    $config->set('display_extenders', $display_extenders);\n    $config->save();\n  }\n}\n", "metadata": {"source": "repos/display_builder/modules/display_builder_views/display_builder_views.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DisplayBuilderViews", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DynamicEntityReferenceFieldBuilder\nSource file: <source_file>\nFile name hint: DynamicEntityReferenceFieldBuilder.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\ai_context\\Plugin\\diff\\Field;\n\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\diff\\FieldDiffBuilderBase;\n\n/**\n * Plugin to diff dynamic entity reference fields.\n *\n * @FieldDiffBuilder(\n *   id = \"dynamic_entity_reference_field_diff_builder\",\n *   label = @Translation(\"Dynamic Entity Reference Field Diff\"),\n *   field_types = {\n *     \"dynamic_entity_reference\"\n *   },\n * )\n */\nclass DynamicEntityReferenceFieldBuilder extends FieldDiffBuilderBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function build(FieldItemListInterface $field_items) {\n    $result = [];\n\n    foreach ($field_items as $field_key => $field_item) {\n      if (!$field_item->isEmpty()) {\n        $values = $field_item->getValue();\n        $entity = $field_item->entity;\n\n        if ($entity) {\n          if ($this->configuration['compare_entity_reference'] == 'label') {\n            $result[$field_key][] = $entity->getEntityTypeId() . ': ' . $entity->label();\n          }\n          else {\n            $result[$field_key][] = $this->t('@type ID: @id', [\n              '@type' => $values['target_type'],\n              '@id' => $values['target_id'],\n            ]);\n          }\n        }\n      }\n    }\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state) {\n    $form['compare_entity_reference'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Compare'),\n      '#options' => [\n        'id' => $this->t('Entity type and ID'),\n        'label' => $this->t('Entity type and label'),\n      ],\n      '#default_value' => $this->configuration['compare_entity_reference'],\n    ];\n\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state) {\n    $this->configuration['compare_entity_reference'] = $form_state->getValue('compare_entity_reference');\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration() {\n    return [\n      'compare_entity_reference' => 'label',\n    ] + parent::defaultConfiguration();\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\ai_context\\Plugin\\diff\\Field;\n\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\diff\\FieldDiffBuilderBase;\n\n/**\n * Plugin to diff dynamic entity reference fields.\n *\n * @FieldDiffBuilder(\n *   id = \"dynamic_entity_reference_field_diff_builder\",\n *   label = @Translation(\"Dynamic Entity Reference Field Diff\"),\n *   field_types = {\n *     \"dynamic_entity_reference\"\n *   },\n * )\n */\nclass DynamicEntityReferenceFieldBuilder extends FieldDiffBuilderBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(FieldItemListInterface $field_items) {\n    $result = [];\n\n    foreach ($field_items as $field_key => $field_item) {\n      if (!$field_item->isEmpty()) {\n        $values = $field_item->getValue();\n        $entity = $field_item->entity;\n\n        if ($entity) {\n          if ($this->configuration['compare_entity_reference'] == 'label') {\n            $result[$field_key][] = $entity->getEntityTypeId() . ': ' . $entity->label();\n          }\n          else {\n            $result[$field_key][] = $this->t('@type ID: @id', [\n              '@type' => $values['target_type'],\n              '@id' => $values['target_id'],\n            ]);\n          }\n        }\n      }\n    }\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state) {\n    $form['compare_entity_reference'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Compare'),\n      '#options' => [\n        'id' => $this->t('Entity type and ID'),\n        'label' => $this->t('Entity type and label'),\n      ],\n      '#default_value' => $this->configuration['compare_entity_reference'],\n    ];\n\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state) {\n    $this->configuration['compare_entity_reference'] = $form_state->getValue('compare_entity_reference');\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration() {\n    return [\n      'compare_entity_reference' => 'label',\n    ] + parent::defaultConfiguration();\n  }\n\n}\n", "metadata": {"source": "repos/ai_context/src/Plugin/diff/Field/DynamicEntityReferenceFieldBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DynamicEntityReferenceFieldBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for displaying translation status information.\n *\n * Displays translation status information per language.\n *\n * Available variables:\n * - modules: A list of modules names that have available translation updates.\n * - updates: A list of available translation updates.\n * - not_found: A list of modules missing translation updates.\n *\n * @see \\Drupal\\locale\\Hook\\LocaleThemeHooks::preprocessLocaleTranslationUpdateInfo()\n *\n * @ingroup themeable\n */\n#}\n<div class=\"locale-translation-update__wrapper\" tabindex=\"0\" role=\"button\">\n  <span class=\"locale-translation-update__prefix visually-hidden\">Show description</span>\n  {% if modules %}\n    {% set module_list = modules|safe_join(', ') %}\n    <span class=\"locale-translation-update__message\">{% trans %}Updates for: {{ module_list }}{% endtrans %}</span>\n  {% elseif not_found %}\n    <span class=\"locale-translation-update__message\">\n      {%- trans -%}\n        Missing translations for one project\n      {%- plural not_found|length -%}\n        Missing translations for @count projects\n      {%- endtrans -%}\n    </span>\n  {% endif %}\n  {% if updates or not_found %}\n    <div class=\"locale-translation-update__details\">\n      {% if updates %}\n        <ul>\n          {% for update in updates %}\n            <li>{{ update.name }} ({{ update.timestamp|format_date('html_date') }})</li>\n          {% endfor %}\n        </ul>\n      {% endif %}\n      {% if not_found %}\n        {#\n          Prefix the missing updates list if there is an available updates lists\n          before it.\n        #}\n        {% if updates %}\n          {{ 'Missing translations for:'|t }}\n        {% endif %}\n        {% if not_found %}\n          <ul>\n            {% for update in not_found %}\n              <li>{{ update.name }} ({{ update.version|default('no version'|t) }}). {{ update.info }}</li>\n            {% endfor %}\n          </ul>\n        {% endif %}\n      {% endif %}\n    </div>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/templates/locale-translation-update-info.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Dark\ndescription: \"Normal and disabled state.\"\nprops:\n  variant: dark\n  disabled: false\n  aria_label: Close\nlibrary_wrapper: >\n  <div class=\"bg-dark p-3 rounded-1 d-inline-flex\">\n    {{ _story }}\n  </div>\n", "metadata": {"source": "repos/bootstrap_components/components/close_button/stories/close_button.dark.story.yml", "type": "yaml_reference", "topic": "close button.dark.story"}}
{"instruction": "Show me the implementation of the interface PreviewAwarePluginInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\n/**\n * Provides an interface to support preview mode injection in plugins.\n *\n * Block and layout plugins can implement this interface to be informed when\n * preview mode is being used in Layout Builder.\n *\n * @see \\Drupal\\layout_builder\\Event\\SectionComponentBuildRenderArrayEvent\n * @see \\Drupal\\layout_builder\\Section::toRenderArray()\n */\ninterface PreviewAwarePluginInterface {\n\n  /**\n   * Set preview mode for the plugin.\n   *\n   * @param bool $in_preview\n   *   TRUE if the plugin should be set to preview mode, FALSE otherwise.\n   */\n  public function setInPreview(bool $in_preview): void;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/PreviewAwarePluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PreviewAwarePluginInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class MarkupNormalizer in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\serialization\\Normalizer;\n\nuse Drupal\\Component\\Render\\MarkupInterface;\n\n/**\n * Normalizes MarkupInterface objects into a string.\n */\nclass MarkupNormalizer extends NormalizerBase {\n\n  use SchematicNormalizerTrait;\n  use JsonSchemaReflectionTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function doNormalize($object, $format = NULL, array $context = []): array|string|int|float|bool|\\ArrayObject|NULL {\n    return (string) $object;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getNormalizationSchema(mixed $object, array $context = []): array {\n    return $this->getJsonSchemaForMethod(\n      $object,\n      '__toString',\n      [\n        'type' => 'string',\n        'description' => 'May contain HTML markup.',\n      ]\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      MarkupInterface::class => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/Normalizer/MarkupNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MarkupNormalizer", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Get in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\zefix\\Services;\n\nuse Drupal\\zefix\\ZefixApiClient;\n\n/**\n * Service to search publications in the SOGC by publication number (SOGC-ID).\n */\nclass Get {\n\n  /**\n   * The Zefix API client.\n   *\n   * @var \\Drupal\\zefix\\ZefixApiClient\n   */\n  protected ZefixApiClient $api;\n\n  /**\n   * Constructs a Get object.\n   *\n   * @param \\Drupal\\zefix\\ZefixApiClient $api\n   *   The Zefix API client.\n   */\n  public function __construct(ZefixApiClient $api) {\n    $this->api = $api;\n  }\n\n  /**\n   * Search publication in the SOGC by publication number (SOGC-ID).\n   *\n   * @link https://www.zefixintg.admin.ch/ZefixPublicREST/swagger-ui/index.html#/SOGC/get\n   *\n   * @param string $id\n   *   The SOGC-ID of the publication.\n   *\n   * @return array|null\n   *   The SOGC data or null on error.\n   */\n  public function get(string $id): ?array {\n    return $this->api->get('sogc', $id);\n  }\n\n}\n", "metadata": {"source": "repos/zefix/src/Services/Get.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Get", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface RefineableCompilerContextInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\compiler;\n\n/**\n * A refineable compiler context interface.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n */\ninterface RefineableCompilerContextInterface extends \\ArrayAccess, CompilerContextInterface {\n\n  /**\n   * Set the machine name of the compiler plugin to use for this context.\n   *\n   * @param string $compiler\n   *   The machine name of the compiler plugin to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setCompiler(string $compiler): self;\n\n  /**\n   * Set the user-defined data to use for this context.\n   *\n   * @param mixed $data\n   *   The user-defined data to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setData($data): self;\n\n  /**\n   * Set a specific option to use for this context.\n   *\n   * @param string $name\n   *   The name of the option to set.\n   * @param mixed $value\n   *   The value to set for the option.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setOption(string $name, $value): self;\n\n  /**\n   * Set the options to use for this context.\n   *\n   * @param array $options\n   *   The options to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setOptions(array $options): self;\n\n}\n", "metadata": {"source": "repos/compiler/src/RefineableCompilerContextInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "RefineableCompilerContextInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ThemeLocalTask.php\nTarget symbol: class ThemeLocalTask\nNamespace: Drupal\\system\\Plugin\\Derivative\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ThemeLocalTask.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\Derivative\\DeriverBase\n  - Drupal\\Core\\Extension\\ThemeHandlerInterface\n  - Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - getDerivativeDefinitions()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\system\\Plugin\\Derivative;\n\nuse Drupal\\Component\\Plugin\\Derivative\\DeriverBase;\nuse Drupal\\Core\\Extension\\ThemeHandlerInterface;\nuse Drupal\\Core\\Plugin\\Discovery\\ContainerDeriverInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides dynamic tabs based on active themes.\n */\nclass ThemeLocalTask extends DeriverBase implements ContainerDeriverInterface {\n\n  /**\n   * The theme handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ThemeHandlerInterface\n   */\n  protected $themeHandler;\n\n  /**\n   * Constructs a new ThemeLocalTask instance.\n   *\n   * @param \\Drupal\\Core\\Extension\\ThemeHandlerInterface $theme_handler\n   *   The theme handler.\n   */\n  public function __construct(ThemeHandlerInterface $theme_handler) {\n    $this->themeHandler = $theme_handler;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, $base_plugin_id) {\n    return new static(\n      $container->get('theme_handler')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDerivativeDefinitions($base_plugin_definition) {\n    foreach ($this->themeHandler->listInfo() as $theme_name => $theme) {\n      if ($this->themeHandler->hasUi($theme_name)) {\n        $this->derivatives[$theme_name] = $base_plugin_definition;\n        $this->derivatives[$theme_name]['title'] = $theme->info['name'];\n        $this->derivatives[$theme_name]['route_parameters'] = ['theme' => $theme_name];\n      }\n    }\n    return $this->derivatives;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Plugin/Derivative/ThemeLocalTask.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ThemeLocalTask", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface ConfigurableSearchPluginInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\search\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Provides an interface for a configurable Search plugin.\n */\ninterface ConfigurableSearchPluginInterface extends ConfigurableInterface, DependentPluginInterface, PluginFormInterface, SearchInterface {\n\n  /**\n   * Sets the ID for the search page using this plugin.\n   *\n   * @param string $search_page_id\n   *   The search page ID.\n   *\n   * @return static\n   */\n  public function setSearchPageId($search_page_id);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/src/Plugin/ConfigurableSearchPluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfigurableSearchPluginInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% if variant and variant == 'horizontal' %}\n  {% set row_attributes = create_attribute(row_attributes|default({})) %}\n  {% set image_col_attributes = create_attribute(image_col_attributes|default({})) %}\n  {% set content_col_attributes = create_attribute(content_col_attributes|default({})) %}\n\n  {# Default classes. #}\n  {% if not row_attributes.storage() %}\n    {% set row_attributes = row_attributes.addClass('g-0') %}\n  {% endif %}\n  {% if not image_col_attributes.storage() %}\n    {% set image_col_attributes = image_col_attributes.addClass('col-lg-4') %}\n  {% endif %}\n  {% if not content_col_attributes.storage() %}\n    {% set content_col_attributes = content_col_attributes.addClass('col-lg-8') %}\n  {% endif %}\n\n  <div{{ attributes.addClass('card') }}>\n    <div{{ row_attributes.addClass('row') }}>\n      <div{{ image_col_attributes }}>\n        {% if image %}\n          {{ image|add_class('img-fluid rounded-start') }}\n        {% endif %}\n      </div>\n      <div{{ content_col_attributes }}>\n        {% if header %}\n          {% set header_attributes = create_attribute(header_attributes|default({})) %}\n          <div{{ header_attributes.addClass('card-header') }}>\n            {{ header }}\n          </div>\n        {% endif %}\n        {{ content }}\n        {% if footer %}\n          {% set footer_attributes = create_attribute(footer_attributes|default({})) %}\n          <div{{ footer_attributes.addClass('card-footer') }}>\n            {{ footer }}\n          </div>\n        {% endif %}\n      </div>\n    </div>\n  </div>\n{% else %}\n  <div{{ attributes.addClass('card') }}>\n    {% if image and image_position != 'bottom' %}\n      {{ image|add_class('card-img-top') }}\n    {% endif %}\n    {% if header %}\n      {% set header_attributes = create_attribute(header_attributes|default({})) %}\n      <div{{ header_attributes.addClass('card-header') }}>{{ header }}</div>\n    {% endif %}\n    {{ content }}\n    {% if footer %}\n      {% set footer_attributes = create_attribute(footer_attributes|default({})) %}\n      <div{{ footer_attributes.addClass('card-footer') }}>{{ footer }}</div>\n    {% endif %}\n    {% if image and image_position == 'bottom' %}\n      {{ image|add_class('card-img-bottom') }}\n    {% endif %}\n  </div>\n{% endif %}\n", "metadata": {"source": "repos/bootstrap_components/components/card/card.twig", "type": "twig_reference"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: StringLabelProvider.php\nTarget symbol: class StringLabelProvider\nNamespace: Drupal\\block_description_modifier\\Provider\\LabelProvider\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for StringLabelProvider.\n- Include required imports:\n  - Drupal\\block_content\\BlockContentInterface\n  - Drupal\\block_description_modifier\\Service\\InlineBlockLabelApplier\n- Ensure these methods exist where relevant:\n  - id()\n  - label()\n  - provide()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\block_description_modifier\\Provider\\LabelProvider;\n\nuse Drupal\\block_content\\BlockContentInterface;\nuse Drupal\\block_description_modifier\\Service\\InlineBlockLabelApplier;\n\n/**\n * Uses a fixed string from configuration.\n */\nfinal class StringLabelProvider implements LabelProviderInterface {\n\n  public function id(): string {\n    return 'string';\n  }\n\n  public function label(): string {\n    return 'String';\n  }\n\n  public function provide(BlockContentInterface $block, string $bundle, array $bundleConfig): string {\n    $value = (string) ($bundleConfig['string_value'] ?? '');\n    if ($value === '') {\n      return InlineBlockLabelApplier::FALLBACK_CORRUPTED_FIELD;\n    }\n    return $value;\n  }\n\n}\n", "metadata": {"source": "repos/block_description_modifier/src/Provider/LabelProvider/StringLabelProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StringLabelProvider", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - taxonomy\nid: taxonomy_term.full\nlabel: 'Taxonomy term page'\ndescription: ''\ntargetEntityType: taxonomy_term\ncache: true\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/config/install/core.entity_view_mode.taxonomy_term.full.yml", "type": "yaml_reference", "topic": "core.entity view mode.taxonomy term.full"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ViewPageController.php\nTarget symbol: class ViewPageController\nNamespace: Drupal\\views\\Routing\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ViewPageController.\n- Include required imports:\n  - Drupal\\Component\\Utility\\Xss\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\views\\Plugin\\views\\display\\Page\n  - Drupal\\views\\Render\\ViewsRenderPipelineMarkup\n  - Drupal\\views\\Views\n- Ensure these methods exist where relevant:\n  - getTitle()\n  - handle()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\views\\Routing;\n\nuse Drupal\\Component\\Utility\\Xss;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\views\\Plugin\\views\\display\\Page;\nuse Drupal\\views\\Render\\ViewsRenderPipelineMarkup;\nuse Drupal\\views\\Views;\n\n/**\n * Defines a page controller to execute and render a view.\n */\nclass ViewPageController {\n\n  /**\n   * Handler a response for a given view and display.\n   *\n   * @param string $view_id\n   *   The ID of the view.\n   * @param string $display_id\n   *   The ID of the display.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   *\n   * @return array|\\Symfony\\Component\\HttpFoundation\\Response\n   *   A render array or a Response object.\n   */\n  public function handle($view_id, $display_id, RouteMatchInterface $route_match) {\n    $args = [];\n    $route = $route_match->getRouteObject();\n    $map = $route->hasOption('_view_argument_map') ? $route->getOption('_view_argument_map') : [];\n\n    foreach ($map as $attribute => $parameter_name) {\n      // Allow parameters be pulled from the request.\n      // The map stores the actual name of the parameter in the request. Views\n      // which override existing controller, use for example 'node' instead of\n      // arg_nid as name.\n      if (isset($map[$attribute])) {\n        $attribute = $map[$attribute];\n      }\n      if ($arg = $route_match->getRawParameter($attribute)) {\n      }\n      else {\n        $arg = $route_match->getParameter($attribute);\n      }\n\n      if (isset($arg)) {\n        $args[] = $arg;\n      }\n    }\n\n    $class = $route->getOption('_view_display_plugin_class');\n    if ($route->getOption('returns_response')) {\n      /** @var \\Drupal\\views\\Plugin\\views\\display\\ResponseDisplayPluginInterface $class */\n      return $class::buildResponse($view_id, $display_id, $args);\n    }\n    else {\n      /** @var \\Drupal\\views\\Plugin\\views\\display\\Page $class */\n      $build = $class::buildBasicRenderable($view_id, $display_id, $args, $route);\n      Page::setPageRenderArray($build);\n\n      views_add_contextual_links($build, 'page', $display_id, $build);\n\n      return $build;\n    }\n  }\n\n  /**\n   * Gets the title of the given view's display.\n   *\n   * @param string $view_id\n   *   The id of the view.\n   * @param string $display_id\n   *   The id of the display from the view.\n   *\n   * @return string|\\Drupal\\Component\\Render\\MarkupInterface\n   *   The title of the display of the view.\n   */\n  public function getTitle($view_id, $display_id = 'default') {\n    $view = Views::getView($view_id);\n    $view->setDisplay($display_id);\n\n    return ViewsRenderPipelineMarkup::create(Xss::filter($view->getTitle()));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Routing/ViewPageController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewPageController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class OperationEvents in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\eb\\Event;\n\n/**\n * Defines events for Entity Builder operations.\n */\nfinal class OperationEvents {\n\n  /**\n   * Event dispatched before operation validation.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const PRE_VALIDATE = 'eb.operation.pre_validate';\n\n  /**\n   * Event dispatched after operation validation.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const POST_VALIDATE = 'eb.operation.post_validate';\n\n  /**\n   * Event dispatched before operation execution.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const PRE_EXECUTE = 'eb.operation.pre_execute';\n\n  /**\n   * Event dispatched after operation execution.\n   *\n   * @Event\n   *\n   * @var string\n   */\n  public const POST_EXECUTE = 'eb.operation.post_execute';\n\n}\n", "metadata": {"source": "repos/eb/src/Event/OperationEvents.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OperationEvents", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nid: es\nlabel: Spanish\ndirection: ltr\nweight: 1\nlocked: false\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/language.entity.es.yml", "type": "yaml_reference", "topic": "language.entity.es"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "available_routes: \"<front>|Default (Frontpage)\"\nrespect_destination_parameter: true\nfieldset_weight: 10\nfieldset_title: 'Login redirect preference'\nfield_title: 'Preferred login redirect destination'\nfield_description: 'Select where you would like to be redirected after logging in.'\n", "metadata": {"source": "repos/user_preference_login_redirect/config/install/user_preference_login_redirect.settings.yml", "type": "yaml_reference", "topic": "user preference login redirect.settings"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Single button: button\"\nslots:\n  title: \"Dropdown button\"\nprops:\n  variant: dropdown\n  content:\n    - title: \"Action\"\n      url: \"#\"\n    - title: \"Another action\"\n      url: \"#\"\n    - title: \"Something else here\"\n      url: \"#\"\n  button_variant: secondary\n", "metadata": {"source": "repos/bootstrap_components/components/dropdown/stories/dropdown.single_button_button.story.yml", "type": "yaml_reference", "topic": "dropdown.single button button.story"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Views overview", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Views overview\n\nSame name and namespace in other branches\n\n1. [10 core/modules/views/views.api.php](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/10) \\views\\_overview\n2. [9 core/modules/views/views.api.php](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/9) \\views\\_overview\n3. [8.9.x core/modules/views/views.api.php](/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/8.9.x) \\views\\_overview\n\nOverview of the Views module API\n\nThe Views module is a generalized query and display engine, which can be used\nto make views (formatted lists, grids, feeds, and other output) of items\n(often entities, but can be other types of data). Developers can interact\nwith Views in several ways:\n\n* **Provide plugins**: Views plugins govern nearly every aspect of views,\n  including querying (sorting, filtering, etc.) and display (at several\n  levels of granularity, ranging from the entire view to the details of a\n  field). See the [Views plugins topic](/api/drupal/core%21modules%21views%21views.api.php/group/views_plugins/11.x \"Overview of views plugins\") for\n  more information.\n* **Provide data**: Data types can be provided to Views by implementing\n  [hook\\_views\\_data](/api/drupal/core%21modules%21views%21views.api.php/function/hook_views_data/11.x \"Describe data tables and fields (or the equivalent) to Views.\")(), and data types provided by other modules can be altered\n  by implementing [hook\\_views\\_data\\_alter](/api/drupal/core%21modules%21views%21views.api.php/function/hook_views_data_alter/11.x \"Alter the table and field information from hook_views_data().\")(). To provide views data for an\n  entity, create a class implementing\n  [\\Drupal\\views\\EntityViewsDataInterface](/api/drupal/core%21modules%21views%21src%21EntityViewsDataInterface.php/interface/EntityViewsDataInterface/11.x \"Provides an interface to integrate an entity type with views.\") and reference this in the\n  \"views\\_data\" annotation in the entity class. You can autogenerate big parts\n  of the integration if you extend the [\\Drupal\\views\\EntityViewsData](/api/drupal/core%21modules%21views%21src%21EntityViewsData.php/class/EntityViewsData/11.x \"Provides generic views integration for entities.\") base\n  class. See the [Entity API topic](/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/11.x \"Describes how to define and manipulate content and configuration entities.\") for more\n  information about entities.\n* **Implement hooks**: A few operations in Views can be influenced by hooks.\n  See the Views hooks topic for a list.\n* **Theming**: See the [Views templates topic](/api/drupal/core%21modules%21views%21views.api.php/group/views_templates/11.x \"Describes various views templates & overriding options.\")\n  for more information.\n\n### See also\n\n[\\Drupal\\views\\ViewExecutable](/api/drupal/core%21modules%21views%21src%21ViewExecutable.php/class/ViewExecutable/11.x \"Represents a view as a whole.\")\n\n[\\Drupal\\views\\Views](/api/drupal/core%21modules%21views%21src%21Views.php/class/Views/11.x \"Static service container wrapper for views.\")\n\n### File\n\ncore/modules/views/[views.api.php](/api/drupal/core%21modules%21views%21views.api.php/11.x), line 19\n\n### Sub-Topics\n\n| [Title](?order=title&sort=desc \"sort by Title\") | [File name](?order=file_name&sort=asc \"sort by File name\") | Summary |\n| --- | --- | --- |\n| [Views plugins](/api/drupal/core%21modules%21views%21views.api.php/group/views_plugins/11.x) | core/modules/views/[views.api.php](/api/drupal/core%21modules%21views%21views.api.php/11.x) | Overview of views plugins |\n| [Views template files](/api/drupal/core%21modules%21views%21views.api.php/group/views_templates/11.x) | core/modules/views/[views.api.php](/api/drupal/core%21modules%21views%21views.api.php/11.x) | Describes various views templates &amp; overriding options. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521modules%2521views%2521views.api.php/group/views_overview/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21modules%21views%21views.api.php/group/views_overview/11.x.md", "type": "doc_summary", "topic": "Views overview"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "drupal.config_translation.admin:\n  version: VERSION\n  css:\n    theme:\n      css/config_translation.admin.css: {}\n", "metadata": {"source": "repos/drupal_core/core/modules/config_translation/config_translation.libraries.yml", "type": "yaml_reference", "topic": "config translation.libraries"}}
{"instruction": "Show me the implementation of the class FileImageDimensionsConstraintValidator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\file\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Image\\ImageFactory;\nuse Drupal\\Core\\Messenger\\MessengerInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Validator for the FileImageDimensionsConstraint.\n *\n * This validator will resize the image if exceeds the limits.\n */\nclass FileImageDimensionsConstraintValidator extends BaseFileConstraintValidator implements ContainerInjectionInterface {\n\n  use StringTranslationTrait;\n\n  /**\n   * Creates a new FileImageDimensionsConstraintValidator.\n   *\n   * @param \\Drupal\\Core\\Image\\ImageFactory $imageFactory\n   *   The image factory.\n   * @param \\Drupal\\Core\\Messenger\\MessengerInterface $messenger\n   *   The messenger.\n   */\n  public function __construct(\n    protected ImageFactory $imageFactory,\n    protected MessengerInterface $messenger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('image.factory'),\n      $container->get('messenger'),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validate(mixed $value, Constraint $constraint): void {\n    $file = $this->assertValueIsFile($value);\n    if (!$constraint instanceof FileImageDimensionsConstraint) {\n      throw new UnexpectedTypeException($constraint, FileImageDimensionsConstraint::class);\n    }\n\n    $image = $this->imageFactory->get($file->getFileUri());\n    if (!$image->isValid()) {\n      return;\n    }\n\n    $scaling = FALSE;\n    $maxDimensions = $constraint->maxDimensions;\n    if ($maxDimensions) {\n      // Check that it is smaller than the given dimensions.\n      [$width, $height] = explode('x', $maxDimensions);\n      if ($image->getWidth() > $width || $image->getHeight() > $height) {\n        // Try to resize the image to fit the dimensions.\n        if ($image->scale($width, $height)) {\n          $scaling = TRUE;\n          $image->save();\n          $file->setSize($image->getFileSize());\n          if (!empty($width) && !empty($height)) {\n            $this->messenger->addStatus($this->t('The image was resized to fit within the maximum allowed dimensions of %dimensions pixels. The new dimensions of the resized image are %new_widthx%new_height pixels.',\n              [\n                '%dimensions' => $maxDimensions,\n                '%new_width' => $image->getWidth(),\n                '%new_height' => $image->getHeight(),\n              ]));\n          }\n          elseif (empty($width)) {\n            $this->messenger->addStatus($this->t('The image was resized to fit within the maximum allowed height of %height pixels. The new dimensions of the resized image are %new_widthx%new_height pixels.',\n              [\n                '%height' => $height,\n                '%new_width' => $image->getWidth(),\n                '%new_height' => $image->getHeight(),\n              ]));\n          }\n          elseif (empty($height)) {\n            $this->messenger->addStatus($this->t('The image was resized to fit within the maximum allowed width of %width pixels. The new dimensions of the resized image are %new_widthx%new_height pixels.',\n              [\n                '%width' => $width,\n                '%new_width' => $image->getWidth(),\n                '%new_height' => $image->getHeight(),\n              ]));\n          }\n        }\n        else {\n          $this->context->addViolation($constraint->messageResizeFailed);\n        }\n      }\n    }\n\n    $minDimensions = $constraint->minDimensions;\n    if ($minDimensions) {\n      // Check that it is larger than the given dimensions.\n      [$width, $height] = explode('x', $minDimensions);\n      if ($image->getWidth() < $width || $image->getHeight() < $height) {\n        if ($scaling) {\n          $this->context->addViolation($constraint->messageResizedImageTooSmall,\n            [\n              '%dimensions' => $minDimensions,\n              '%width' => $image->getWidth(),\n              '%height' => $image->getHeight(),\n            ]);\n          return;\n        }\n        $this->context->addViolation($constraint->messageImageTooSmall,\n          [\n            '%dimensions' => $minDimensions,\n            '%width' => $image->getWidth(),\n            '%height' => $image->getHeight(),\n          ]);\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Validation/Constraint/FileImageDimensionsConstraintValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileImageDimensionsConstraintValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class InvokeCommand in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Ajax;\n\n/**\n * AJAX command for invoking an arbitrary jQuery method.\n *\n * The 'invoke' command will instruct the client to invoke the given jQuery\n * method with the supplied arguments on the elements matched by the given\n * selector. Intended for simple jQuery commands, such as attr(), addClass(),\n * removeClass(), toggleClass(), etc.\n *\n * This command is implemented by Drupal.AjaxCommands.prototype.invoke()\n * defined in misc/ajax.js.\n *\n * @ingroup ajax\n */\nclass InvokeCommand implements CommandInterface {\n\n  /**\n   * A CSS selector string.\n   *\n   * If the command is a response to a request from an #ajax form element then\n   * this value can be NULL.\n   *\n   * @var string\n   */\n  protected $selector;\n\n  /**\n   * A jQuery method to invoke.\n   *\n   * @var string\n   */\n  protected $method;\n\n  /**\n   * An optional list of arguments to pass to the method.\n   *\n   * @var array\n   */\n  protected $arguments;\n\n  /**\n   * Constructs an InvokeCommand object.\n   *\n   * @param string $selector\n   *   A jQuery selector.\n   * @param string $method\n   *   The name of a jQuery method to invoke.\n   * @param array $arguments\n   *   An optional array of arguments to pass to the method.\n   */\n  public function __construct($selector, $method, array $arguments = []) {\n    $this->selector = $selector;\n    $this->method = $method;\n    $this->arguments = $arguments;\n  }\n\n  /**\n   * Implements Drupal\\Core\\Ajax\\CommandInterface:render().\n   */\n  public function render() {\n\n    return [\n      'command' => 'invoke',\n      'selector' => $this->selector,\n      'method' => $this->method,\n      'args' => $this->arguments,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Ajax/InvokeCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InvokeCommand", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: wp_tags\nlabel: 'WordPress Tags'\nmigration_tags:\n  - WordPress\n  - 'WordPress Taxonomy'\nsource:\n  plugin: wp_terms\n  taxonomy: post_tag\nprocess:\n  vid:\n    plugin: default_value\n    default_value: tags\n  name: name\n  description/value: description\n  description/format:\n    plugin: default_value\n    default_value: basic_html\n  weight:\n    plugin: default_value\n    default_value: 0\ndestination:\n  plugin: entity:taxonomy_term\nmigration_dependencies:\n  required: {}\n", "metadata": {"source": "repos/wp_drupal_migrate/migrations/wp_tags.yml", "type": "yaml_reference", "topic": "wp tags"}}
{"instruction": "Show me the implementation of the class SupportedImageSwiperFormatter in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\supported_image_swiper_formatter\\Plugin\\Field\\FieldFormatter;\n\nuse Drupal\\Core\\Field\\Attribute\\FieldFormatter;\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\supported_image\\Plugin\\Field\\FieldFormatter\\SupportedImageFormatterTrait;\nuse Drupal\\supported_image\\Plugin\\Field\\FieldType\\SupportedImageItem;\nuse Drupal\\swiper_formatter\\Plugin\\Field\\FieldFormatter\\SwiperImages;\n\n/**\n * Plugin implementation of the 'supported_image_swiper' formatter.\n */\n#[FieldFormatter(\n  id: 'supported_image_swiper',\n  label: new TranslatableMarkup('Swiper images'),\n  description: new TranslatableMarkup('Images rendered as a Swiper.'),\n  field_types: [\n    'supported_image',\n  ],\n)]\nclass SupportedImageSwiperFormatter extends SwiperImages {\n\n  use SupportedImageFormatterTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getItemRenderThemeHook(): string {\n    return 'supported_image_formatter';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function viewElements(FieldItemListInterface $items, $langcode): array {\n    $elements = parent::viewElements($items, $langcode);\n\n    foreach ($items as $delta => $item) {\n      if (isset($elements['#content'][$delta]['#slide']['#item']) && $elements['#content'][$delta]['#slide']['#item'] instanceof SupportedImageItem) {\n        // Render this slide's image field item as a supported image.\n        $elements['#content'][$delta]['#slide']['#theme'] = $this->getItemRenderThemeHook();\n        $elements['#content'][$delta]['#slide']['#display_caption'] = $this\n          ->getSetting('display_caption');\n        $elements['#content'][$delta]['#slide']['#display_attribution'] = $this\n          ->getSetting('display_attribution');\n      }\n    }\n\n    return $elements;\n  }\n\n}\n", "metadata": {"source": "repos/supported_image_swiper_formatter/src/Plugin/Field/FieldFormatter/SupportedImageSwiperFormatter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SupportedImageSwiperFormatter", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LightgalleryProfile in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\lightgallery_formatter\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\n\n/**\n * Defines the LightGallery profile configuration entity.\n *\n * @ConfigEntityType(\n *   id = \"lightgallery_profile\",\n *   label = @Translation(\"LightGallery profile\"),\n *   handlers = {\n *     \"list_builder\" = \"Drupal\\lightgallery_formatter\\Controller\\LightgalleryProfileController\",\n *     \"form\" = {\n *       \"add\" = \"Drupal\\lightgallery_formatter\\Form\\LightgalleryProfileForm\",\n *       \"edit\" = \"Drupal\\lightgallery_formatter\\Form\\LightgalleryProfileForm\",\n *       \"delete\" = \"Drupal\\Core\\Entity\\EntityDeleteForm\"\n *     }\n *   },\n *   config_prefix = \"profile\",\n *   admin_permission = \"administer lightgallery_formatter\",\n *   entity_keys = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\"\n *   },\n *   links = {\n *     \"collection\" = \"/admin/structure/lightgallery-profiles\",\n *     \"add-form\" = \"/admin/structure/lightgallery-profiles/add\",\n *     \"edit-form\" = \"/admin/structure/lightgallery-profiles/{lightgallery_profile}\",\n *     \"delete-form\" = \"/admin/structure/lightgallery-profiles/{lightgallery_profile}/delete\"\n *   },\n *   config_export = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\",\n *     \"plugin_settings\" = \"plugin_settings\"\n *   }\n * )\n */\nclass LightgalleryProfile extends ConfigEntityBase implements LightgalleryProfileInterface {\n\n  /**\n   * The machine name of the profile.\n   *\n   * @var string\n   */\n  protected $id;\n\n  /**\n   * The human-readable name of the profile.\n   *\n   * @var string\n   */\n  protected $label;\n\n  /**\n   * Whether the profile is enabled.\n   *\n   * @var bool\n   */\n  protected $status = TRUE;\n\n  /**\n   * Plugin configurations.\n   *\n   * @var array\n   */\n  protected $plugin_settings = [];\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getStatus(): bool {\n    return (bool) $this->status;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginSettings(string $plugin_id): array {\n    return $this->plugin_settings[$plugin_id] ?? [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPluginSettings(string $plugin_id, array $settings): LightgalleryProfileInterface {\n    $this->plugin_settings[$plugin_id] = $settings;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getAllPluginSettings(): array {\n    return $this->plugin_settings;\n  }\n\n}\n", "metadata": {"source": "repos/lightgallery_formatter/src/Entity/LightgalleryProfile.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LightgalleryProfile", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Note: ai_context_item is a content entity and uses field storage schema\n# instead of config schema. Field schemas are automatically generated.\n\nai_context.ai_context_item_type.*:\n  type: config_entity\n  label: 'AI Context Item Type'\n  mapping:\n    id:\n      type: string\n      label: 'Machine name'\n    label:\n      type: label\n      label: 'Label'\n    description:\n      type: text\n      label: 'Description'\n    new_revision:\n      type: boolean\n      label: 'Create new revision by default'\n    default_status:\n      type: boolean\n      label: 'Published by default'\n\nai_context.settings:\n  type: config_object\n  label: 'AI Context settings'\n  mapping:\n    strategy:\n      type: string\n      label: 'Selection strategy'\n    max_context_items:\n      type: integer\n      label: 'Max context items to inject'\n    max_global_items:\n      type: integer\n      label: 'Max global context items'\n    max_tokens:\n      type: integer\n      label: 'Max token budget'\n    provider_id:\n      type: string\n      label: 'Provider ID (LLM strategy)'\n    model_id:\n      type: string\n      label: 'Model ID (LLM strategy)'\n    show_overview_page:\n      type: boolean\n      label: 'Show overview page'\n    target_entity_types:\n      type: sequence\n      label: 'Allowed entity types for targeting'\n      sequence:\n        type: string\n        label: 'Entity type ID'\n\nai_context.agent_pools:\n  type: config_object\n  label: 'AI Context agent pools'\n  mapping:\n    agents:\n      type: sequence\n      sequence:\n        type: mapping\n        mapping:\n          id:\n            type: string\n            label: 'Agent ID'\n          context_items:\n            type: sequence\n            sequence:\n              type: string\n              label: 'AI Context Item ID'\n          always_include:\n            type: sequence\n            label: 'Always-include context item IDs'\n            sequence:\n              type: string\n              label: 'AI Context Item ID'\n", "metadata": {"source": "repos/ai_context/config/schema/ai_context.schema.yml", "type": "yaml_reference", "topic": "ai context.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# FlowDrop Pipeline Menu Links\n\nflowdrop.pipelines:\n  title: 'Pipelines'\n  description: 'View and manage pipeline instances'\n  route_name: flowdrop.pipelines\n  parent: flowdrop.dashboard\n  weight: 20\n\nflowdrop.structure.pipeline_types:\n  title: 'Pipeline Types'\n  description: 'Manage pipeline type bundles'\n  route_name: flowdrop.structure.pipeline_types\n  parent: flowdrop.structure\n  weight: 10\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_pipeline/flowdrop_pipeline.links.menu.yml", "type": "yaml_reference", "topic": "flowdrop pipeline.links.menu"}}
{"instruction": "Show me the implementation of the class FileEncodingConstraint in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\file\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Defines an encoding constraint for files.\n */\n#[Constraint(\n  id: 'FileEncoding',\n  label: new TranslatableMarkup('File encoding', [], ['context' => 'Validation'])\n)]\nclass FileEncodingConstraint extends SymfonyConstraint {\n\n  /**\n   * The allowed file encodings.\n   *\n   * @var array\n   */\n  public array $encodings;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?array $encodings = NULL,\n    public string $message = \"The file is encoded with %detected. It must be encoded with %encoding\",\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->encodings = $encodings ?? $this->encodings;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/file/src/Plugin/Validation/Constraint/FileEncodingConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileEncodingConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Quick Start Guide: Queue-Based Translation Processing", "input": "", "output": "# Quick Start Guide: Queue-Based Translation Processing\n\n## TL;DR\n\nTranslation jobs are now processed asynchronously via Drupal's queue system during cron runs.\n\n## 5-Minute Setup\n\n### 1. Test It\n```bash\n# Submit a translation job (via UI)\n# Check queue\nddev drush queue:list\n\n# Run cron\nddev drush cron\n\n# Check results\nddev drush watchdog:show --type=tmgmt_laratranslate\n```\n\n## How It Works\n\n```\nTranslation Job \u2192 Queue \u2192 Cron \u2192 Process \u2192 Complete\n                    \u2193\n              (Automatic Retry if Failed)\n```\n\n## Troubleshooting\n\n### Queue items not processing?\n```bash\n# Check if cron is running\nddev drush core:cron\n\n# Check queue\nddev drush queue:list\n```\n\n### Timeouts or processing issues?\nCheck the logs and adjust cron frequency if needed.\n\n## Monitoring\n\n### Check Queue Status\n**CLI**: `ddev drush queue:list`\n\n### View Logs\n**UI**: `/admin/reports/dblog` \u2192 Filter by \"tmgmt_laratranslate\"\n**CLI**: `ddev drush watchdog:show --type=tmgmt_laratranslate`\n\n### Log Messages You'll See\n\n\u2705 **Success**:\n```\nProcessing job item 123 from queue\nJob 456 completed successfully\n```\n\n\u274c **Error**:\n```\nFailed to process job item 123: Translation quota exceeded\n```\n\n## Key Benefits\n\n- \u2705 **Non-blocking**: Content saves immediately\n- \u2705 **Reliable**: Automatic retry on failure\n- \u2705 **Transparent**: Clear logs and status\n\n## Need Help?\n\nSee detailed documentation:\n- `doc/QUEUE_IMPLEMENTATION.md` - Queue architecture and implementation notes\n\n---\n\nThat's it! Your translation system is now queue-based and production-ready. \ud83d\ude80\n", "metadata": {"source": "repos/tmgmt_laratranslate/doc/QUICK_START.md", "type": "doc_summary", "topic": "Quick Start Guide: Queue-Based Translation Processing"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Frequently Asked Questions", "input": "", "output": "# Frequently Asked Questions\n\n## Why my SDC component doesn't work well with Display Builder?\n\nDisplay Builder is not doing anything anything specific with your SDC. It is only an user interface upon UI Patterns 2.\n\nUI Patterns 2 is not expecting you to change your SDC component in order to be compatible.\n\nHowever, if your component has definitions or templating issues, it will be harder for UI Patterns 2.x to connect it to Drupal API\n\nYou can check your component with [sdc_devel](https://www.drupal.org/project/sdc_devel) which provides automatic audits.\n\nA component without error must be compatible with UI Patterns 2.x and Display Builder.\n\n## Why my preprocess hook is not triggered anymore?\n\nDisplay Builder is avoiding as much as possible to interact with `ThemeManager::render()`:\n\n- By design, Entity View Display integration is sometimes bypassing `node.html.twig`, `user.html.twig`, `media.html.twig`, `field.html.twig`...\n- By design, Page Layout integration is sometimes bypassing `page.html.twig` and `region.html.twig`\n- By design, Views integration is sometimes bypassing `views-view.html.twig`, `views-view-field.html.twig`...\n\nSo, your preprocess and suggestions related to those templates will not be executed.\n\n## What is the relationship with UI Patterns and UI Suite?\n\nThis is a display building tool made by a team specialized in design systems and display building since 2017: [UI Suite](https://www.drupal.org/project/ui_suite) people.\n\nThis project is new but it is only a thin layer upon APIs we are building for many years, and which are already used, tested and loved by many: [UI Patterns](https://www.drupal.org/project/ui_patterns).\n\n## Is it related to Canvas (Experience Builder)?\n\nLike Canvas, this project is a next generation display building tool for Drupal.\n\nHowever, the 2 projects are different. Display Builder is currently targeting a wider **horizontal** scope (more display building coverage):\n\n|                             | Canvas                               | Display Builder               |\n| --------------------------- | ------------------------------------ | ----------------------------- |\n| Layout builder replacement  | \u2705 Config & content overrides        | \u2705 Config & content overrides |\n| Page layout replacement     | \u26a0\ufe0f Yes, but each region is a builder | \u2705 Full page support          |\n| View (displays) replacement | \u274c Out of scope                      | \u2705                            |\n| Entity form modes           | \u274c Out of scope                      | \u26a0\ufe0f Planned                    |\n\nBut Canvas is currently targeting a deeper <strong>vertical</strong> scope (before and after display building):\n\n|                     | Canvas                   | Display Builder                         |\n| ------------------- | ------------------------ | --------------------------------------- |\n| Content editing     | \u2705 the main feature      | \u26a0\ufe0f Planned                              |\n| Component authoring | \u2705 the \"code components\" | \u274c Out of scope, we promote SDC instead |\n\nVisual explanation:\n\n![XB](images/xb.webp)\n\nBoth share more or less the same feature set:\n\n|                         | Canvas              | Display Builder     |\n| ----------------------- | ------------------- | ------------------- |\n| Pattern presets         | \u2705 as config entity | \u2705 as config entity |\n| History, undo, redo     | \u2705                  | \u2705                  |\n| Real-time collaboration | \u274c                  | \u2705                  |\n\nAnd they also differ by the technical and strategic choices. For example, Canvas is a complete ReactJS app, aside of Drupal, when Display Builder is just an usual Drupal module using HTMX.\n\nSo we are going in 2 different directions and our friendly competition will be only on the shared subset of our scopes. So, not such a big deal.\n\nWe hope both will be usable in a same project if this is needed by a team. Anyway, we are actively collaborating to provide same or compatible low level API and to improve Drupal Core together. So it is a win-win situation.\n\n## Comparison with Layout Builder\n\n### What is the equivalent of [Layout Builder Restrictions](https://www.drupal.org/project/layout_builder_restrictions)?\n\n`layout_builder_restrictions` provides a configurable UI for restricting blocks and layouts. Sites can allow all options from a certain provider, or restrict all options by provider, or specify individual allowed blocks & layouts.\n\n`layout_builder_restrictions_by_role` allows restricting what roles can place what blocks or use what layout (so, what component).\n\nThis is doable with Display Builder by creating different Display builder profiles by role and [to configure](configuration.md) the _Components library_ and _Block library panels_ differently.\n\n### What is the equivalent of [Layout Builder Lock](https://www.drupal.org/project/layout_builder_lock)?\n\nLayout Builder Lock allows administrators to lock sections of a default layout so users can't perform certain actions when overriding the layout for an individual entity.\n\nThis feature is planned for [#3551232](https://www.drupal.org/i/3551232)\n", "metadata": {"source": "repos/display_builder/docs/faq.md", "type": "doc_summary", "topic": "Frequently Asked Questions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Views Blocks with Lazy Builder.\ntype: module\ndescription: Provide a way to add lazy builder behavior to views blocks.\npackage: Other\ncore_version_requirement: ^9 || ^10 || ^11\ndependencies:\n  - drupal:views\n  - drupal:block\n", "metadata": {"source": "repos/views_block_with_lazy_builder/views_block_with_lazy_builder.info.yml", "type": "yaml_reference", "topic": "views block with lazy builder.info"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Shortcut\nSource file: <source_file>\nFile name hint: Shortcut.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\shortcut\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ContentEntityType;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Entity\\ContentEntityBase;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Field\\BaseFieldDefinition;\nuse Drupal\\link\\LinkItemInterface;\nuse Drupal\\link\\LinkTitleVisibility;\nuse Drupal\\shortcut\\Form\\ShortcutDeleteForm;\nuse Drupal\\shortcut\\ShortcutAccessControlHandler;\nuse Drupal\\shortcut\\ShortcutForm;\nuse Drupal\\shortcut\\ShortcutInterface;\n\n/**\n * Defines the shortcut entity class.\n *\n * @property \\Drupal\\link\\LinkItemInterface $link\n */\n#[ContentEntityType(\n  id: 'shortcut',\n  label: new TranslatableMarkup('Shortcut link'),\n  label_collection: new TranslatableMarkup('Shortcut links'),\n  label_singular: new TranslatableMarkup('shortcut link'),\n  label_plural: new TranslatableMarkup('shortcut links'),\n  entity_keys: [\n    'id' => 'id',\n    'uuid' => 'uuid',\n    'bundle' => 'shortcut_set',\n    'label' => 'title',\n    'langcode' => 'langcode',\n  ],\n  handlers: [\n    'access' => ShortcutAccessControlHandler::class,\n    'form' => [\n      'default' => ShortcutForm::class,\n      'add' => ShortcutForm::class,\n      'edit' => ShortcutForm::class,\n      'delete' => ShortcutDeleteForm::class,\n    ],\n    'link_target' => ['view' => ShortcutLinkTarget::class],\n  ],\n  links: [\n    'canonical' => '/admin/config/user-interface/shortcut/link/{shortcut}',\n    'delete-form' => '/admin/config/user-interface/shortcut/link/{shortcut}/delete',\n    'edit-form' => '/admin/config/user-interface/shortcut/link/{shortcut}',\n  ],\n  bundle_entity_type: 'shortcut_set',\n  bundle_label: new TranslatableMarkup('Shortcut set'),\n  base_table: 'shortcut',\n  data_table: 'shortcut_field_data',\n  translatable: TRUE,\n  label_count: [\n    'singular' => '@count shortcut link',\n    'plural' => '@count shortcut links',\n  ],\n  list_cache_tags: [\n    'config:shortcut_set_list',\n  ],\n)]\nclass Shortcut extends ContentEntityBase implements ShortcutInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTitle() {\n    return $this->get('title')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setTitle($link_title) {\n    $this->set('title', $link_title);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getWeight() {\n    return $this->get('weight')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setWeight($weight) {\n    $this->set('weight', $weight);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getUrl() {\n    return $this->link->first()->getUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function postSave(EntityStorageInterface $storage, $update = TRUE) {\n    parent::postSave($storage, $update);\n\n    // EntityBase::postSave() calls EntityBase::invalidateTagsOnSave(), which\n    // only handles the regular cases. The Shortcut entity has one special case:\n    // a newly created shortcut is *also* added to a shortcut set, so we must\n    // invalidate the associated shortcut set's cache tag.\n    if (!$update) {\n      Cache::invalidateTags($this->getCacheTagsToInvalidate());\n    }\n  }\n\n  /**\n   * {@inheritdoc}", "output": "<?php\n\nnamespace Drupal\\shortcut\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ContentEntityType;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Cache\\Cache;\nuse Drupal\\Core\\Entity\\ContentEntityBase;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Field\\BaseFieldDefinition;\nuse Drupal\\link\\LinkItemInterface;\nuse Drupal\\link\\LinkTitleVisibility;\nuse Drupal\\shortcut\\Form\\ShortcutDeleteForm;\nuse Drupal\\shortcut\\ShortcutAccessControlHandler;\nuse Drupal\\shortcut\\ShortcutForm;\nuse Drupal\\shortcut\\ShortcutInterface;\n\n/**\n * Defines the shortcut entity class.\n *\n * @property \\Drupal\\link\\LinkItemInterface $link\n */\n#[ContentEntityType(\n  id: 'shortcut',\n  label: new TranslatableMarkup('Shortcut link'),\n  label_collection: new TranslatableMarkup('Shortcut links'),\n  label_singular: new TranslatableMarkup('shortcut link'),\n  label_plural: new TranslatableMarkup('shortcut links'),\n  entity_keys: [\n    'id' => 'id',\n    'uuid' => 'uuid',\n    'bundle' => 'shortcut_set',\n    'label' => 'title',\n    'langcode' => 'langcode',\n  ],\n  handlers: [\n    'access' => ShortcutAccessControlHandler::class,\n    'form' => [\n      'default' => ShortcutForm::class,\n      'add' => ShortcutForm::class,\n      'edit' => ShortcutForm::class,\n      'delete' => ShortcutDeleteForm::class,\n    ],\n    'link_target' => ['view' => ShortcutLinkTarget::class],\n  ],\n  links: [\n    'canonical' => '/admin/config/user-interface/shortcut/link/{shortcut}',\n    'delete-form' => '/admin/config/user-interface/shortcut/link/{shortcut}/delete',\n    'edit-form' => '/admin/config/user-interface/shortcut/link/{shortcut}',\n  ],\n  bundle_entity_type: 'shortcut_set',\n  bundle_label: new TranslatableMarkup('Shortcut set'),\n  base_table: 'shortcut',\n  data_table: 'shortcut_field_data',\n  translatable: TRUE,\n  label_count: [\n    'singular' => '@count shortcut link',\n    'plural' => '@count shortcut links',\n  ],\n  list_cache_tags: [\n    'config:shortcut_set_list',\n  ],\n)]\nclass Shortcut extends ContentEntityBase implements ShortcutInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTitle() {\n    return $this->get('title')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setTitle($link_title) {\n    $this->set('title', $link_title);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getWeight() {\n    return $this->get('weight')->value;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setWeight($weight) {\n    $this->set('weight', $weight);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getUrl() {\n    return $this->link->first()->getUrl();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function postSave(EntityStorageInterface $storage, $update = TRUE) {\n    parent::postSave($storage, $update);\n\n    // EntityBase::postSave() calls EntityBase::invalidateTagsOnSave(), which\n    // only handles the regular cases. The Shortcut entity has one special case:\n    // a newly created shortcut is *also* added to a shortcut set, so we must\n    // invalidate the associated shortcut set's cache tag.\n    if (!$update) {\n      Cache::invalidateTags($this->getCacheTagsToInvalidate());\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function baseFieldDefinitions(EntityTypeInterface $entity_type) {\n    /** @var \\Drupal\\Core\\Field\\BaseFieldDefinition[] $fields */\n    $fields = parent::baseFieldDefinitions($entity_type);\n\n    $fields['id']->setDescription(t('The ID of the shortcut.'));\n\n    $fields['uuid']->setDescription(t('The UUID of the shortcut.'));\n\n    $fields['shortcut_set']->setLabel(t('Shortcut set'))\n      ->setDescription(t('The bundle of the shortcut.'));\n\n    $fields['langcode']->setDescription(t('The language code of the shortcut.'));\n\n    $fields['title'] = BaseFieldDefinition::create('string')\n      ->setLabel(t('Name'))\n      ->setDescription(t('The name of the shortcut.'))\n      ->setRequired(TRUE)\n      ->setTranslatable(TRUE)\n      ->setSetting('max_length', 255)\n      ->setDisplayOptions('form', [\n        'type' => 'string_textfield',\n        'weight' => -10,\n        'settings' => [\n          'size' => 40,\n        ],\n      ]);\n\n    $fields['weight'] = BaseFieldDefinition::create('integer')\n      ->setLabel(t('Weight'))\n      ->setDescription(t('Weight among shortcuts in the same shortcut set.'));\n\n    $fields['link'] = BaseFieldDefinition::create('link')\n      ->setLabel(t('Path'))\n      ->setDescription(t('The location this shortcut points to.'))\n      ->setRequired(TRUE)\n      ->setSettings([\n        'link_type' => LinkItemInterface::LINK_INTERNAL,\n        'title' => LinkTitleVisibility::Disabled->value,\n      ])\n      ->setDisplayOptions('form', [\n        'type' => 'link_default',\n        'weight' => 0,\n      ])\n      ->setDisplayConfigurable('form', TRUE);\n\n    return $fields;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheTagsToInvalidate() {\n    return $this->shortcut_set->entity->getCacheTags();\n  }\n\n  /**\n   * Sort shortcut objects.\n   *\n   * Callback for uasort().\n   *\n   * @param \\Drupal\\shortcut\\ShortcutInterface $a\n   *   First item for comparison.\n   * @param \\Drupal\\shortcut\\ShortcutInterface $b\n   *   Second item for comparison.\n   *\n   * @return int\n   *   The comparison result for uasort().\n   */\n  public static function sort(ShortcutInterface $a, ShortcutInterface $b) {\n    $a_weight = $a->getWeight();\n    $b_weight = $b->getWeight();\n    if ($a_weight == $b_weight) {\n      return strnatcasecmp($a->getTitle(), $b->getTitle());\n    }\n    return $a_weight <=> $b_weight;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/src/Entity/Shortcut.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Shortcut", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ScaffoldOptions.php\nTarget symbol: class ScaffoldOptions\nNamespace: Drupal\\Composer\\Plugin\\Scaffold\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ScaffoldOptions.\n- Ensure these methods exist where relevant:\n  - __construct()\n  - allowedPackages()\n  - create()\n  - fileMapping()\n  - getLocation()\n  - gitIgnore()\n  - hasAllowedPackages()\n  - hasFileMapping()\n  - hasGitIgnore()\n  - hasLocation()\n  - hasOptions()\n  - locations()", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold;\n\n/**\n * Per-project options from the 'extras' section of the composer.json file.\n *\n * Projects that describe scaffold files do so via their scaffold options. This\n * data is pulled from the 'drupal-scaffold' portion of the extras section of\n * the project data.\n *\n * @internal\n */\nclass ScaffoldOptions {\n\n  /**\n   * The raw data from the 'extras' section of the top-level composer.json file.\n   *\n   * @var array\n   */\n  protected $options = [];\n\n  /**\n   * ScaffoldOptions constructor.\n   *\n   * @param array $options\n   *   The scaffold options taken from the 'drupal-scaffold' section.\n   */\n  protected function __construct(array $options) {\n    $this->options = $options + [\n      \"allowed-packages\" => [],\n      \"locations\" => [],\n      \"symlink\" => FALSE,\n      \"file-mapping\" => [],\n    ];\n\n    // Define any default locations.\n    $this->options['locations'] += [\n      'project-root' => '.',\n      'web-root' => '.',\n    ];\n  }\n\n  /**\n   * Determines if the provided 'extras' section has scaffold options.\n   *\n   * @param array $extras\n   *   The contents of the 'extras' section.\n   *\n   * @return bool\n   *   True if scaffold options have been declared\n   */\n  public static function hasOptions(array $extras) {\n    return array_key_exists('drupal-scaffold', $extras);\n  }\n\n  /**\n   * Creates a scaffold options object.\n   *\n   * @param array $extras\n   *   The contents of the 'extras' section.\n   *\n   * @return self\n   *   The scaffold options object representing the provided scaffold options\n   */\n  public static function create(array $extras) {\n    $options = static::hasOptions($extras) ? $extras['drupal-scaffold'] : [];\n    return new self($options);\n  }\n\n  /**\n   * Creates a new scaffold options object with some values overridden.\n   *\n   * @param array $options\n   *   Override values.\n   *\n   * @return self\n   *   The scaffold options object representing the provided scaffold options\n   */\n  protected function override(array $options) {\n    return new self($options + $this->options);\n  }\n\n  /**\n   * Creates a new scaffold options object with an overridden 'symlink' value.\n   *\n   * @param bool $symlink\n   *   Whether symlinking should be enabled or not.\n   *\n   * @return self\n   *   The scaffold options object representing the provided scaffold options\n   */\n  public function overrideSymlink($symlink) {\n    return $this->override(['symlink' => $symlink]);\n  }\n\n  /**\n   * Determines whether any allowed packages were defined.\n   *\n   * @return bool\n   *   Whether there are allowed packages\n   */\n  public function hasAllowedPackages() {\n    return !empty($this->allowedPackages());\n  }\n\n  /**\n   * Gets allowed packages from these options.\n   *\n   * @return array\n   *   The list of allowed packages\n   */\n  public function allowedPackages() {\n    return $this->options['allowed-packages'];\n  }\n\n  /**\n   * Gets the location mapping table, e.g. 'webroot' => './'.\n   *\n   * @return array\n   *   A map of name : location values\n   */\n  public function locations() {\n    return $this->options['locations'];\n  }\n\n  /**\n   * Determines whether a given named location is defined.\n   *\n   * @param string $name\n   *   The location name to search for.\n   *\n   * @return bool\n   *   True if the specified named location exist.\n   */\n  protected function hasLocation($name) {\n    return array_key_exists($name, $this->locations());\n  }\n\n  /**\n   * Gets a specific named location.\n   *\n   * @param string $name\n   *   The name of the location to fetch.\n   *\n   * @return string\n   *   The value of the provided named location\n   */\n  public function getLocation($name) {\n    return $this->hasLocation($name) ? $this->locations()[$name] : FALSE;\n  }\n\n  /**\n   * Determines if symlink mode is set.\n   *\n   * @return bool\n   *   Whether or not 'symlink' mode\n   */\n  public function symlink() {\n    return $this->options['symlink'];\n  }\n\n  /**\n   * Determines if there are file mappings.\n   *\n   * @return bool\n   *   Whether or not the scaffold options contain any file mappings\n   */\n  public function hasFileMapping() {\n    return !empty($this->fileMapping());\n  }\n\n  /**\n   * Returns the actual file mappings.\n   *\n   * @return array\n   *   File mappings for just this config type.\n   */\n  public function fileMapping() {\n    return $this->options['file-mapping'];\n  }\n\n  /**\n   * Determines if there is defined a value for the 'gitignore' option.\n   *\n   * @return bool\n   *   Whether or not there is a 'gitignore' option setting\n   */\n  public function hasGitIgnore() {\n    return isset($this->options['gitignore']);\n  }\n\n  /**\n   * Gets the value of the 'gitignore' option.\n   *\n   * @return bool\n   *   The 'gitignore' option, or TRUE if undefined.\n   */\n  public function gitIgnore() {\n    return $this->hasGitIgnore() ? $this->options['gitignore'] : TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/ScaffoldOptions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ScaffoldOptions", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class SetCustomize in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\shortcut\\Form;\n\nuse Drupal\\Core\\Entity\\EntityForm;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Render\\Element;\nuse Drupal\\Core\\Url;\n\n/**\n * Builds the shortcut set customize form.\n *\n * @internal\n */\nclass SetCustomize extends EntityForm {\n\n  /**\n   * The entity being used by this form.\n   *\n   * @var \\Drupal\\shortcut\\ShortcutSetInterface\n   */\n  protected $entity;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    $form = parent::form($form, $form_state);\n    $form['shortcuts'] = [\n      '#tree' => TRUE,\n      '#weight' => -20,\n    ];\n\n    $form['shortcuts']['links'] = [\n      '#type' => 'table',\n      '#header' => [$this->t('Name'), $this->t('Weight'), $this->t('Operations')],\n      '#empty' => $this->t('No shortcuts available. <a href=\":link\">Add a shortcut</a>', [':link' => Url::fromRoute('shortcut.link_add', ['shortcut_set' => $this->entity->id()])->toString()]),\n      '#attributes' => ['id' => 'shortcuts'],\n      '#tabledrag' => [\n        [\n          'action' => 'order',\n          'relationship' => 'sibling',\n          'group' => 'shortcut-weight',\n        ],\n      ],\n    ];\n\n    foreach ($this->entity->getShortcuts() as $shortcut) {\n      $id = $shortcut->id();\n      $url = $shortcut->getUrl();\n      if (!$url->access()) {\n        continue;\n      }\n      $form['shortcuts']['links'][$id]['#attributes']['class'][] = 'draggable';\n      $form['shortcuts']['links'][$id]['name'] = [\n        '#type' => 'link',\n        '#title' => $shortcut->getTitle(),\n        '#url' => $url,\n        '#options' => $url->getOptions(),\n      ];\n      $form['shortcuts']['links'][$id]['#weight'] = $shortcut->getWeight();\n      $form['shortcuts']['links'][$id]['weight'] = [\n        '#type' => 'weight',\n        '#title' => $this->t('Weight for @title', ['@title' => $shortcut->getTitle()]),\n        '#title_display' => 'invisible',\n        '#default_value' => $shortcut->getWeight(),\n        '#attributes' => ['class' => ['shortcut-weight']],\n      ];\n\n      $links['edit'] = [\n        'title' => $this->t('Edit'),\n        'url' => $shortcut->toUrl(),\n      ];\n      $links['delete'] = [\n        'title' => $this->t('Delete'),\n        'url' => $shortcut->toUrl('delete-form'),\n      ];\n      $form['shortcuts']['links'][$id]['operations'] = [\n        '#type' => 'operations',\n        '#links' => $links,\n        '#access' => $url->access(),\n      ];\n    }\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    // Only includes a Save action for the entity, no direct Delete button.\n    return [\n      'submit' => [\n        '#type' => 'submit',\n        '#value' => $this->t('Save'),\n        '#access' => (bool) Element::getVisibleChildren($form['shortcuts']['links']),\n        '#submit' => ['::submitForm', '::save'],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    foreach ($this->entity->getShortcuts() as $shortcut) {\n      $weight = $form_state->getValue(['shortcuts', 'links', $shortcut->id(), 'weight']);\n      $shortcut->setWeight($weight);\n      $shortcut->save();\n    }\n    $this->messenger()->addStatus($this->t('The shortcut set has been updated.'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/shortcut/src/Form/SetCustomize.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SetCustomize", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "ai_context.overview:\n  title: 'Context Control Center'\n  description: 'Manage reusable AI context items.'\n  route_name: ai_context.context_redirect\n  parent: system.admin\n  weight: -9\n", "metadata": {"source": "repos/ai_context/ai_context.links.menu.yml", "type": "yaml_reference", "topic": "ai context.links.menu"}}
{"instruction": "Show me the implementation of the class PintoEntityServiceProvider in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderInterface;\nuse Drupal\\pinto_entity\\DependencyInjection\\PintoEntityCompilerPass;\n\nfinal class PintoEntityServiceProvider implements ServiceProviderInterface {\n\n  public function register(ContainerBuilder $container): void {\n    $container->addCompilerPass(new PintoEntityCompilerPass());\n  }\n\n}\n", "metadata": {"source": "repos/pinto_entity/src/PintoEntityServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PintoEntityServiceProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ViewDuplicateForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views_ui;\n\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Form controller for the Views duplicate form.\n *\n * @internal\n */\nclass ViewDuplicateForm extends ViewFormBase {\n\n  /**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   */\n  protected LanguageManagerInterface $languageManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('module_handler'),\n      $container->get('language_manager')\n    );\n  }\n\n  /**\n   * Constructs a ViewDuplicateForm.\n   *\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $moduleHandler\n   *   Drupal's module handler.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   */\n  public function __construct(ModuleHandlerInterface $moduleHandler, LanguageManagerInterface $language_manager) {\n    $this->setModuleHandler($moduleHandler);\n    $this->languageManager = $language_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function prepareEntity() {\n    // Do not prepare the entity while it is being added.\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    parent::form($form, $form_state);\n\n    $form['#title'] = $this->t('Duplicate of @label', ['@label' => $this->entity->label()]);\n\n    $form['label'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('View name'),\n      '#required' => TRUE,\n      '#size' => 32,\n      '#maxlength' => 255,\n      '#default_value' => $this->t('Duplicate of @label', ['@label' => $this->entity->label()]),\n    ];\n    $form['id'] = [\n      '#type' => 'machine_name',\n      '#maxlength' => 128,\n      '#machine_name' => [\n        'exists' => '\\Drupal\\views\\Views::getView',\n        'source' => ['label'],\n      ],\n      '#default_value' => '',\n      '#description' => $this->t('A unique machine-readable name for this View. It must only contain lowercase letters, numbers, and underscores.'),\n    ];\n\n    return $form;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function actions(array $form, FormStateInterface $form_state) {\n    $actions['submit'] = [\n      '#type' => 'submit',\n      '#value' => $this->t('Duplicate'),\n    ];\n    return $actions;\n  }\n\n  /**\n   * Form submission handler for the 'clone' action.\n   *\n   * @param array $form\n   *   An associative array containing the structure of the form.\n   * @param \\Drupal\\Core\\Form\\FormStateInterface $form_state\n   *   A reference to a keyed array containing the current state of the form.\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    // The original ID gets set to NULL when duplicating, so we need to store it\n    // here.\n    $original_id = $this->entity->id();\n    $this->entity = $this->entity->createDuplicate();\n    $this->entity->set('label', $form_state->getValue('label'));\n    $this->entity->set('id', $form_state->getValue('id'));\n    $this->entity->save();\n    $this->copyTranslations($original_id);\n\n    // Redirect the user to the view admin form.\n    $form_state->setRedirectUrl($this->entity->toUrl('edit-form'));\n  }\n\n  /**\n   * Copies all translations that existed on the original View.\n   *\n   * @param string $original_id\n   *   The original View ID.\n   */\n  private function copyTranslations(string $original_id): void {\n    if (!$this->moduleHandler->moduleExists('config_translation')) {\n      return;\n    }\n    $current_langcode = $this->languageManager->getConfigOverrideLanguage()\n      ->getId();\n    $languages = $this->languageManager->getLanguages();\n    $original_name = 'views.view.' . $original_id;\n    $duplicate_name = 'views.view.' . $this->entity->id();\n    foreach ($languages as $language) {\n      $langcode = $language->getId();\n      if ($langcode !== $current_langcode) {\n        $original_translation = $this->languageManager->getLanguageConfigOverride($langcode, $original_name)\n          ->get();\n        if ($original_translation) {\n          $duplicate_translation = $this->languageManager->getLanguageConfigOverride($langcode, $duplicate_name);\n          $duplicate_translation->setData($original_translation);\n          $duplicate_translation->save();\n        }\n      }\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views_ui/src/ViewDuplicateForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewDuplicateForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: ProtectionRule\nSource file: <source_file>\nFile name hint: ProtectionRule.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\db_wipe_entity\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\nuse Drupal\\Core\\Entity\\EntityWithPluginCollectionInterface;\nuse Drupal\\db_wipe_entity\\ProtectionRuleInterface;\nuse Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection;\n\n/**\n * Defines the Protection Rule configuration entity.\n *\n * @ConfigEntityType(\n *   id = \"protection_rule\",\n *   label = @Translation(\"Protection Rule\"),\n *   label_collection = @Translation(\"Protection Rules\"),\n *   label_singular = @Translation(\"protection rule\"),\n *   label_plural = @Translation(\"protection rules\"),\n *   label_count = @PluralTranslation(\n *     singular = \"@count protection rule\",\n *     plural = \"@count protection rules\",\n *   ),\n *   handlers = {\n *     \"list_builder\" = \"Drupal\\db_wipe_entity\\ProtectionRuleListBuilder\",\n *     \"form\" = {\n *       \"add\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleForm\",\n *       \"edit\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleForm\",\n *       \"delete\" = \"Drupal\\Core\\Entity\\EntityDeleteForm\",\n *       \"toggle-status\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleToggleStatusForm\",\n *     },\n *     \"route_provider\" = {\n *       \"html\" = \"Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider\",\n *     },\n *   },\n *   config_prefix = \"protection_rule\",\n *   admin_permission = \"administer protection rules\",\n *   entity_keys = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\",\n *     \"weight\" = \"weight\",\n *   },\n *   config_export = {\n *     \"id\",\n *     \"label\",\n *     \"description\",\n *     \"status\",\n *     \"weight\",\n *     \"plugin\",\n *     \"configuration\",\n *   },\n *   links = {\n *     \"collection\" = \"/admin/config/development/db-wipe/entity/protection\",\n *     \"add-form\" = \"/admin/config/development/db-wipe/entity/protection/add\",\n *     \"edit-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}\",\n *     \"delete-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}/delete\",\n *     \"toggle-status-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}/toggle-status\",\n *   }\n * )\n */\nclass ProtectionRule extends ConfigEntityBase implements ProtectionRuleInterface, EntityWithPluginCollectionInterface {\n\n  /**\n   * The protection rule ID.\n   *\n   * @var string\n   */\n  protected string $id;\n\n  /**\n   * The protection rule label.\n   *\n   * @var string\n   */\n  protected string $label;\n\n  /**\n   * The protection rule description.\n   *\n   * @var string\n   */\n  protected string $description = '';\n\n  /**\n   * The protection rule weight.\n   *\n   * @var int\n   */\n  protected int $weight = 0;\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  protected string $plugin = '';\n\n  /**\n   * The plugin configuration.\n   *\n   * @var array\n   */\n  protected array $configuration = [];\n\n  /**\n   * The plugin collection.\n   *\n   * @var \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection|null\n   */\n  protected ?ProtectionRulePluginCollection $pluginCollection = NULL;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    return $this->description;\n  }\n\n  /**\n   * {@inheritdoc}", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Entity;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\nuse Drupal\\Core\\Entity\\EntityWithPluginCollectionInterface;\nuse Drupal\\db_wipe_entity\\ProtectionRuleInterface;\nuse Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection;\n\n/**\n * Defines the Protection Rule configuration entity.\n *\n * @ConfigEntityType(\n *   id = \"protection_rule\",\n *   label = @Translation(\"Protection Rule\"),\n *   label_collection = @Translation(\"Protection Rules\"),\n *   label_singular = @Translation(\"protection rule\"),\n *   label_plural = @Translation(\"protection rules\"),\n *   label_count = @PluralTranslation(\n *     singular = \"@count protection rule\",\n *     plural = \"@count protection rules\",\n *   ),\n *   handlers = {\n *     \"list_builder\" = \"Drupal\\db_wipe_entity\\ProtectionRuleListBuilder\",\n *     \"form\" = {\n *       \"add\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleForm\",\n *       \"edit\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleForm\",\n *       \"delete\" = \"Drupal\\Core\\Entity\\EntityDeleteForm\",\n *       \"toggle-status\" = \"Drupal\\db_wipe_entity\\Form\\ProtectionRuleToggleStatusForm\",\n *     },\n *     \"route_provider\" = {\n *       \"html\" = \"Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider\",\n *     },\n *   },\n *   config_prefix = \"protection_rule\",\n *   admin_permission = \"administer protection rules\",\n *   entity_keys = {\n *     \"id\" = \"id\",\n *     \"label\" = \"label\",\n *     \"status\" = \"status\",\n *     \"weight\" = \"weight\",\n *   },\n *   config_export = {\n *     \"id\",\n *     \"label\",\n *     \"description\",\n *     \"status\",\n *     \"weight\",\n *     \"plugin\",\n *     \"configuration\",\n *   },\n *   links = {\n *     \"collection\" = \"/admin/config/development/db-wipe/entity/protection\",\n *     \"add-form\" = \"/admin/config/development/db-wipe/entity/protection/add\",\n *     \"edit-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}\",\n *     \"delete-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}/delete\",\n *     \"toggle-status-form\" = \"/admin/config/development/db-wipe/entity/protection/{protection_rule}/toggle-status\",\n *   }\n * )\n */\nclass ProtectionRule extends ConfigEntityBase implements ProtectionRuleInterface, EntityWithPluginCollectionInterface {\n\n  /**\n   * The protection rule ID.\n   *\n   * @var string\n   */\n  protected string $id;\n\n  /**\n   * The protection rule label.\n   *\n   * @var string\n   */\n  protected string $label;\n\n  /**\n   * The protection rule description.\n   *\n   * @var string\n   */\n  protected string $description = '';\n\n  /**\n   * The protection rule weight.\n   *\n   * @var int\n   */\n  protected int $weight = 0;\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  protected string $plugin = '';\n\n  /**\n   * The plugin configuration.\n   *\n   * @var array\n   */\n  protected array $configuration = [];\n\n  /**\n   * The plugin collection.\n   *\n   * @var \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection|null\n   */\n  protected ?ProtectionRulePluginCollection $pluginCollection = NULL;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDescription(): string {\n    return $this->description;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setDescription(string $description): ProtectionRuleInterface {\n    $this->description = $description;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getWeight(): int {\n    return $this->weight;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setWeight(int $weight): ProtectionRuleInterface {\n    $this->weight = $weight;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginId(): string {\n    return $this->plugin;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPluginId(string $plugin_id): ProtectionRuleInterface {\n    $this->plugin = $plugin_id;\n    $this->pluginCollection = NULL;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginConfiguration(): array {\n    return $this->configuration;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPluginConfiguration(array $configuration): ProtectionRuleInterface {\n    $this->configuration = $configuration;\n    $this->pluginCollection = NULL;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPlugin(): object {\n    return $this->getPluginCollection()->get($this->plugin);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPluginCollections(): array {\n    // Don't return a plugin collection if no plugin is set yet.\n    if (empty($this->plugin)) {\n      return [];\n    }\n    return [\n      'configuration' => $this->getPluginCollection(),\n    ];\n  }\n\n  /**\n   * Gets the plugin collection.\n   *\n   * @return \\Drupal\\db_wipe_entity\\Plugin\\ProtectionRulePluginCollection\n   *   The plugin collection.\n   */\n  protected function getPluginCollection(): ProtectionRulePluginCollection {\n    if ($this->pluginCollection === NULL) {\n      $this->pluginCollection = new ProtectionRulePluginCollection(\n        \\Drupal::service('plugin.manager.protection_rule'),\n        $this->plugin,\n        $this->configuration\n      );\n    }\n    return $this->pluginCollection;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Entity/ProtectionRule.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProtectionRule", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class ApiKeyAccessControlHandler in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\llm\\Access\\ConfigurableEntityAccessControlHandler;\n\n/**\n * Access controller for the API Key entity.\n *\n * Uses DRY base class with owner-based access control.\n * Users can view, edit, and delete their own API keys.\n * Administrators can manage all API keys.\n */\n/**\n * Access control handler for apikey.\n *\n * @ingroup api_normalization\n */\nclass ApiKeyAccessControlHandler extends ConfigurableEntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected string $entityLabel = 'api normalizer keys';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected string $adminPermission = 'administer api normalizer keys';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account): AccessResultInterface {\n    /** @var \\Drupal\\api_normalization\\Entity\\ApiKey $entity */\n\n    // Admin permission grants full access.\n    $admin_result = $this->checkAdminAccess($account);\n    if ($admin_result->isAllowed()) {\n      return $admin_result;\n    }\n\n    // Users can manage their own API keys for all operations.\n    if ($entity->get('uid')->target_id == $account->id()) {\n      return AccessResult::allowed()\n        ->cachePerUser()\n        ->addCacheableDependency($entity);\n    }\n\n    return AccessResult::neutral()\n      ->cachePerUser()\n      ->addCacheableDependency($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkCreateAccess(AccountInterface $account, array $context, $entity_bundle = NULL): AccessResultInterface {\n    return AccessResult::allowedIfHasPermission($account, 'create api normalizer keys')\n      ->orIf($this->checkAdminAccess($account));\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Access/ApiKeyAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiKeyAccessControlHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface CountryManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Locale;\n\n/**\n * Defines a common interface for country managers.\n */\ninterface CountryManagerInterface {\n\n  /**\n   * Returns a list of country code => country name pairs.\n   *\n   * @return array\n   *   An array of country code => country name pairs.\n   */\n  public function getList();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Locale/CountryManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CountryManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: PostPackageEventListenerInterface.php\nTarget symbol: interface PostPackageEventListenerInterface\nNamespace: Drupal\\Composer\\Plugin\\Scaffold\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for PostPackageEventListenerInterface.\n- Include required imports:\n  - Composer\\Installer\\PackageEvent\n- Ensure these methods exist where relevant:\n  - event()", "output": "<?php\n\nnamespace Drupal\\Composer\\Plugin\\Scaffold;\n\nuse Composer\\Installer\\PackageEvent;\n\n/**\n * Interface for post package event listeners.\n *\n * @see \\Drupal\\Composer\\Plugin\\Scaffold\\Handler::onPostPackageEvent\n *\n * @internal\n */\ninterface PostPackageEventListenerInterface {\n\n  /**\n   * Handles package events during a 'composer require' operation.\n   *\n   * @param \\Composer\\Installer\\PackageEvent $event\n   *   Composer package event sent on install/update/remove.\n   */\n  public function event(PackageEvent $event);\n\n}\n", "metadata": {"source": "repos/drupal_core/composer/Plugin/Scaffold/PostPackageEventListenerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "PostPackageEventListenerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "security_advisories_nl.fetch:\n  route_name: security_advisories_nl.fetch\n  title: 'Fetch All Sources Now'\n  appears_on:\n    - security_advisories_nl.overview\n    - security_advisories_nl.settings\n\nsecurity_advisories_nl.source_add:\n  route_name: security_advisories_nl.source_add\n  title: 'Add Source'\n  appears_on:\n    - security_advisories_nl.sources\n", "metadata": {"source": "repos/security_advisories_nl/security_advisories_nl.links.action.yml", "type": "yaml_reference", "topic": "security advisories nl.links.action"}}
{"instruction": "Show me the implementation of the class EntityUserRole in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\migrate\\destination;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityStorageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\migrate\\Attribute\\MigrateDestination;\nuse Drupal\\migrate\\Plugin\\migrate\\destination\\EntityConfigBase;\nuse Drupal\\migrate\\Plugin\\MigrationInterface;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a destination plugin for migrating user role entities.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533565\n */\n#[MigrateDestination('entity:user_role')]\nclass EntityUserRole extends EntityConfigBase {\n\n  /**\n   * All permissions on the destination site.\n   *\n   * @var string[]\n   */\n  protected $destinationPermissions = [];\n\n  /**\n   * Builds a user role entity destination.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\migrate\\Plugin\\MigrationInterface $migration\n   *   The migration.\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $storage\n   *   The storage for this entity type.\n   * @param array $bundles\n   *   The list of bundles this entity type has.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The configuration factory.\n   * @param array $destination_permissions\n   *   All available permissions.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, MigrationInterface $migration, EntityStorageInterface $storage, array $bundles, LanguageManagerInterface $language_manager, ConfigFactoryInterface $config_factory, array $destination_permissions) {\n    @trigger_error(__CLASS__ . '() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533565', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $migration, $storage, $bundles, $language_manager, $config_factory);\n    $this->destinationPermissions = $destination_permissions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition, ?MigrationInterface $migration = NULL) {\n    $entity_type_id = static::getEntityTypeId($plugin_id);\n    return new static(\n      $configuration,\n      $plugin_id,\n      $plugin_definition,\n      $migration,\n      $container->get('entity_type.manager')->getStorage($entity_type_id),\n      array_keys($container->get('entity_type.bundle.info')->getBundleInfo($entity_type_id)),\n      $container->get('language_manager'),\n      $container->get('config.factory'),\n      array_keys($container->get('user.permissions')->getPermissions()),\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function import(Row $row, array $old_destination_id_values = []): array|bool {\n    $permissions = $row->getDestinationProperty('permissions') ?? [];\n\n    // Get permissions that do not exist on the destination.\n    $invalid_permissions = array_diff($permissions, $this->destinationPermissions);\n    if ($invalid_permissions) {\n      sort($invalid_permissions);\n      // Log the message in the migration message table.\n      $message = \"Permission(s) '\" . implode(\"', '\", $invalid_permissions) . \"' not found.\";\n      $this->migration->getIdMap()\n        ->saveMessage($row->getSourceIdValues(), $message, MigrationInterface::MESSAGE_WARNING);\n    }\n\n    $valid_permissions = array_intersect($permissions, $this->destinationPermissions);\n    $row->setDestinationProperty('permissions', $valid_permissions);\n    return parent::import($row, $old_destination_id_values);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/migrate/destination/EntityUserRole.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityUserRole", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Default theme implementation for an 'input' #type form element.\n *\n * Available variables:\n * - attributes: A list of HTML attributes for the input element.\n * - children: Optional additional rendered elements.\n *\n * @see\\Drupal\\Core\\Form\\FormPreprocess::preprocessInput()\n *\n * @ingroup themeable\n */\n#}\n<input{{ attributes }} />{{ children }}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/templates/input.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Grid\nstatus: stable\ndescription: 'A responsive grid layout component for organizing cards with consistent responsive behavior. Used for stat cards, action links, and content cards.'\ngroup: FlowDrop\n\nprops:\n  type: object\n  properties:\n    variant:\n      type: string\n      title: Variant\n      description: 'Grid layout variant. stats/actions have identical behavior (280px min-width), cards uses wider minimum (320px) for richer content.'\n      enum:\n        - stats\n        - actions\n        - cards\n      default: actions\n    gap:\n      type: string\n      title: Gap Size\n      description: 'Gap between grid items'\n      enum:\n        - sm\n        - md\n        - lg\n      default: md\n    stagger:\n      type: boolean\n      title: Stagger Animation\n      description: 'Enable staggered entrance animation for grid items'\n      default: false\n    min_item_width:\n      type: string\n      title: Minimum Item Width\n      description: 'CSS value for minimum item width (e.g., \"280px\", \"320px\")'\n    columns:\n      type: integer\n      title: Fixed Columns\n      description: 'Optional fixed number of columns (overrides auto-fit behavior)'\n      minimum: 1\n      maximum: 6\n\nslots:\n  default:\n    title: Grid Items\n    description: 'The grid items to display (stat cards, action links, etc.)'\n\nlibraryOverrides:\n  css:\n    component:\n      grid.css: {}\n  dependencies:\n    - flowdrop_ui_components/theme-layer\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/grid/grid.component.yml", "type": "yaml_reference", "topic": "grid.component"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: can\nSource file: <source_file>\nFile name hint: DefaultSingleLazyPluginCollection.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\PluginManagerInterface;\nuse Drupal\\Component\\Plugin\\LazyPluginCollection;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\n\n/**\n * Provides a default plugin collection for a plugin type.\n *\n * A plugin collection usually stores multiple plugins, and is used to lazily\n * instantiate them. When only one plugin is needed, it is still best practice\n * to encapsulate all of the instantiation logic in a plugin collection. This\n * class can be used directly, or subclassed to add further exception handling\n * in self::initializePlugin().\n */\nclass DefaultSingleLazyPluginCollection extends LazyPluginCollection {\n  use DependencySerializationTrait;\n\n  /**\n   * The manager used to instantiate the plugins.\n   *\n   * @var \\Drupal\\Component\\Plugin\\PluginManagerInterface\n   */\n  protected $manager;\n\n  /**\n   * An array of configuration to instantiate the plugin with.\n   *\n   * @var array\n   */\n  protected $configuration;\n\n  /**\n   * The instance ID used for this plugin collection.\n   *\n   * @var string\n   */\n  protected $instanceId;\n\n  /**\n   * Constructs a new DefaultSingleLazyPluginCollection object.\n   *\n   * @param \\Drupal\\Component\\Plugin\\PluginManagerInterface $manager\n   *   The manager to be used for instantiating plugins.\n   * @param string $instance_id\n   *   The ID of the plugin instance.\n   * @param array $configuration\n   *   An array of configuration.\n   */\n  public function __construct(PluginManagerInterface $manager, $instance_id, array $configuration) {\n    $this->manager = $manager;\n    $this->addInstanceId($instance_id, $configuration);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function initializePlugin($instance_id) {\n    $this->set($instance_id, $this->manager->createInstance($instance_id, $this->configuration));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfiguration() {\n    $plugin = $this->get($this->instanceId);\n    if ($plugin instanceof ConfigurableInterface) {\n      return $plugin->getConfiguration();\n    }\n    else {\n      return $this->configuration;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setConfiguration(array $configuration) {\n    $this->configuration = $configuration;\n    $plugin = $this->get($this->instanceId);\n    if ($plugin instanceof ConfigurableInterface) {\n      $plugin->setConfiguration($configuration);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addInstanceId($id, $configuration = NULL) {\n    $this->instanceId = $id;\n    // Reset the list of instance IDs since there can be only one.\n    $this->instanceIds = [];\n    parent::addInstanceId($id, $configuration);\n    if ($configuration !== NULL) {\n      $this->setConfiguration($configuration);\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\PluginManagerInterface;\nuse Drupal\\Component\\Plugin\\LazyPluginCollection;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\n\n/**\n * Provides a default plugin collection for a plugin type.\n *\n * A plugin collection usually stores multiple plugins, and is used to lazily\n * instantiate them. When only one plugin is needed, it is still best practice\n * to encapsulate all of the instantiation logic in a plugin collection. This\n * class can be used directly, or subclassed to add further exception handling\n * in self::initializePlugin().\n */\nclass DefaultSingleLazyPluginCollection extends LazyPluginCollection {\n  use DependencySerializationTrait;\n\n  /**\n   * The manager used to instantiate the plugins.\n   *\n   * @var \\Drupal\\Component\\Plugin\\PluginManagerInterface\n   */\n  protected $manager;\n\n  /**\n   * An array of configuration to instantiate the plugin with.\n   *\n   * @var array\n   */\n  protected $configuration;\n\n  /**\n   * The instance ID used for this plugin collection.\n   *\n   * @var string\n   */\n  protected $instanceId;\n\n  /**\n   * Constructs a new DefaultSingleLazyPluginCollection object.\n   *\n   * @param \\Drupal\\Component\\Plugin\\PluginManagerInterface $manager\n   *   The manager to be used for instantiating plugins.\n   * @param string $instance_id\n   *   The ID of the plugin instance.\n   * @param array $configuration\n   *   An array of configuration.\n   */\n  public function __construct(PluginManagerInterface $manager, $instance_id, array $configuration) {\n    $this->manager = $manager;\n    $this->addInstanceId($instance_id, $configuration);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function initializePlugin($instance_id) {\n    $this->set($instance_id, $this->manager->createInstance($instance_id, $this->configuration));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConfiguration() {\n    $plugin = $this->get($this->instanceId);\n    if ($plugin instanceof ConfigurableInterface) {\n      return $plugin->getConfiguration();\n    }\n    else {\n      return $this->configuration;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setConfiguration(array $configuration) {\n    $this->configuration = $configuration;\n    $plugin = $this->get($this->instanceId);\n    if ($plugin instanceof ConfigurableInterface) {\n      $plugin->setConfiguration($configuration);\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addInstanceId($id, $configuration = NULL) {\n    $this->instanceId = $id;\n    // Reset the list of instance IDs since there can be only one.\n    $this->instanceIds = [];\n    parent::addInstanceId($id, $configuration);\n    if ($configuration !== NULL) {\n      $this->setConfiguration($configuration);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/DefaultSingleLazyPluginCollection.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DefaultSingleLazyPluginCollection", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Options for updating Drupal core", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n### On this page\n\n* [Before you begin](/docs/updating-drupal/options-for-updating-drupal-core#s-before-you-begin)\n* [Update Drupal Core](/docs/updating-drupal/options-for-updating-drupal-core#s-update-drupal-core)\n\n## [Updating Drupal](/docs/updating-drupal)\n\n* [Overview of options](/docs/updating-drupal/options-for-updating-drupal-core)\n* [Update core via Composer](/docs/updating-drupal/updating-drupal-core-via-composer)\n* [Update core manually](/docs/updating-drupal/updating-drupal-core-manually)\n* [Update modules](/docs/updating-drupal/updating-modules-and-themes-using-composer)\n* [Migrate composer project for Drupal earlier than 8.8.0](/docs/updating-drupal/migrating-the-composer-project-for-drupal-earlier-than-880)\n* [Troubleshooting database updates](/docs/updating-drupal/troubleshooting-database-updates)\n* [Known database update issues and workarounds](/docs/updating-drupal/known-database-update-issues-and-workarounds)\n* [Responding to critical security update advisories](/docs/updating-drupal/responding-to-critical-security-update-advisories)\n* [Automatic Updates](/docs/8/update/automatic-updates)\n* [Drupal updates and deployments](/docs/updating-drupal/deploying-a-drupal-update)\n* [How to back up your Drupal site](/docs/updating-drupal/how-to-back-up-your-drupal-site)\n\n# Options for updating Drupal core\n\nLast [updated](/node/2920624/discuss) on\n\n21 October 2025\n\n## Before you begin\n\nThis guide covers **minor and** **patch version site updates**. (For example, updating from Drupal 11.2.3 to 11.2.5, or 11.1.8 to 11.2.5.)\n\n**Additional steps are required for major version upgrades.** Refer to the guides [upgrading from Drupal 6 or 7 to 10 (or later)](/docs/upgrading-drupal/upgrading-from-drupal-6-or-drupal-7/overview) or [upgrading from Drupal 8 (or later)](/docs/upgrading-drupal/upgrading-from-drupal-8-or-later).\n\n## Update Drupal Core\n\nThere are two options to updating Drupal core:\n\n| **Method** | **Audience** |\n| --- | --- |\n| [Composer](/docs/updating-drupal/update-drupal-core-via-composer)  *Recommended* | * Familiar with command lines * Has a shell access * Interested in using Composer command lines operations |\n| [Manual](/docs/updating-drupal/update-core-manually) | * Unfamiliar with command lines * Not interested in learning Drush or Composer * Without shell access |\n\n## Related Content\n\n## [Introduction](/docs/7/update/introduction)\n\nOverview of your options to choose from to update Drupal 7\n\n## Help improve this page\n\n**Page status:**  No known problems\n\n**You can:**\n\n* Log in, click * Log in, click [Discuss](/node/2920624/discuss), update the Page status value, and suggest an improvement\n* Log in and [create a Documentation issue](/node/add/project-issue/documentation?title=Suggestion%20for%3A%20%282920624%29%20Options%20for%20updating%20Drupal%20core) with your suggestion\n", "metadata": {"source": "docs/www_drupal_org/docs/updating-drupal/options-for-updating-drupal-core.md", "type": "doc_summary", "topic": "Options for updating Drupal core"}}
{"instruction": "Show me the implementation of the class MauticRequestAccessCheck in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mautic_content_provider\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\views\\Views;\n\n/**\n * Custom access checker for Mautic content endpoints.\n */\nclass MauticRequestAccessCheck implements AccessInterface {\n\n  /**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   */\n  protected $moduleHandler;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * Constructs a new instance of this class.\n   *\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   */\n  public function __construct(ModuleHandlerInterface $module_handler, ConfigFactoryInterface $config_factory) {\n    $this->moduleHandler = $module_handler;\n    $this->configFactory = $config_factory;\n  }\n\n  /**\n   * Access callback for our routes.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The current route match.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(RouteMatchInterface $route_match) {\n    // Default to allowed for API endpoints.\n    $access_result = AccessResult::allowed();\n    $context = [];\n\n    // If node related route.\n    if ($route_match->getRouteName() === 'mautic_content_provider.render_node') {\n      $context['node'] = $route_match->getParameter('node');\n      $access_result = AccessResult::forbidden('Node not found.');\n      if ($context['node'] instanceof NodeInterface) {\n        $access_result = $context['node']->access('view') ? AccessResult::allowed() : $access_result;\n\n        // Also check if the bundle is allowed by our config.\n        $config = $this->configFactory->get('mautic_content_provider.settings');\n        $allowed_bundles = $config->get('allowed_bundles') ?: [];\n        if (!empty($allowed_bundles) && !in_array($context['node']->bundle(), $allowed_bundles)) {\n          $access_result = AccessResult::forbidden('Content type not allowed');\n        }\n\n        $access_result = $access_result->addCacheableDependency($context['node'])->addCacheableDependency($config);\n      }\n    }\n\n    // If view related route.\n    if ($route_match->getRouteName() === 'mautic_content_provider.render_view') {\n      $view_id = $route_match->getParameter('view_id');\n      $display_id = $route_match->getParameter('display_id');\n      $access_result = AccessResult::forbidden('View or Display not found.');\n      if ($view_id && $display_id) {\n        $context['view'] = Views::getView($view_id);\n        if ($context['view'] && $context['view']->setDisplay($display_id) && $context['view']->getDisplay()->getPluginId() === 'mautic_email_display') {\n          $access_result = $context['view']->access($display_id) ? AccessResult::allowed() : AccessResult::forbidden();\n          $access_result = $access_result->addCacheableDependency($context['view']);\n        }\n      }\n    }\n\n    // Allow modules to alter. Passing context for node or view.\n    $this->moduleHandler->alter('mautic_content_provider_access', $access_result, $context);\n\n    return $access_result;\n  }\n\n}\n", "metadata": {"source": "repos/mautic_content_provider/src/Access/MauticRequestAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MauticRequestAccessCheck", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class DashboardController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Controller;\n\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\HtmlCommand;\nuse Drupal\\Core\\Ajax\\InvokeCommand;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\webprofiler\\DataCollector\\HasPanelInterface;\nuse Drupal\\webprofiler\\Profiler\\TemplateManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\DataCollector\\DataCollectorInterface;\nuse Symfony\\Component\\HttpKernel\\Profiler\\Profiler;\n\n/**\n * Controller for the Webprofiler dashboard.\n */\nclass DashboardController extends ControllerBase {\n\n  /**\n   * The Profiler service.\n   *\n   * @var \\Symfony\\Component\\HttpKernel\\Profiler\\Profiler\n   */\n  private Profiler $profiler;\n\n  /**\n   * The Template manager service.\n   *\n   * @var \\Drupal\\webprofiler\\Profiler\\TemplateManager\n   */\n  private TemplateManager $templateManager;\n\n  /**\n   * DashboardController constructor.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profiler $profiler\n   *   The Profiler service.\n   * @param \\Drupal\\webprofiler\\Profiler\\TemplateManager $templateManager\n   *   The Template manager service.\n   */\n  final public function __construct(\n    Profiler $profiler,\n    TemplateManager $templateManager,\n  ) {\n    $this->profiler = $profiler;\n    $this->templateManager = $templateManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): DashboardController {\n    return new static(\n      $container->get('webprofiler.profiler'),\n      $container->get('webprofiler.template_manager'),\n    );\n  }\n\n  /**\n   * Controller for the whole dashboard page.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   A Request.\n   *\n   * @return array\n   *   A render array for webprofiler_dashboard theme.\n   */\n  public function dashboard(Request $request): array {\n    $this->profiler->disable();\n\n    $token = $request->get('token');\n\n    $profile = $this->profiler->loadProfile($token);\n\n    if ($profile == NULL) {\n      return [];\n    }\n\n    $collectors = \\array_filter($profile->getCollectors(), static function (DataCollectorInterface $el) {\n      return $el instanceof HasPanelInterface;\n    });\n\n    return [\n      '#theme' => 'webprofiler_dashboard',\n      '#collectors' => $collectors,\n      '#token' => $token,\n      '#profile' => $profile,\n      '#attached' => [\n        'library' => [\n          'webprofiler/dashboard',\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Renders a profiler panel for the given token and type.\n   *\n   * @param string $token\n   *   The profiler token.\n   * @param string $name\n   *   The panel name to render.\n   *\n   * @return \\Drupal\\Core\\Ajax\\AjaxResponse\n   *   An ajax response.\n   */\n  public function panel(string $token, string $name): AjaxResponse {\n    $this->profiler->disable();\n\n    if ('empty' === $token) {\n      return new AjaxResponse('');\n    }\n\n    $profile = $this->profiler->loadProfile($token);\n\n    if ($profile == NULL) {\n      return new AjaxResponse('');\n    }\n\n    $collector = $profile->getCollector($name);\n    if (!($collector instanceof HasPanelInterface)) {\n      return new AjaxResponse('');\n    }\n\n    $response = new AjaxResponse();\n    $response->addCommand(\n      new HtmlCommand(\n        '#js-webprofiler-panel',\n      [\n        '#theme' => 'webprofiler_dashboard_panel',\n        '#name' => $name,\n        '#template' => $this->templateManager->getName($profile, $name),\n        '#profile' => $profile,\n      ]),\n    );\n    $response->addCommand(new InvokeCommand('.webprofiler__collector', 'removeClass', ['active']));\n    $response->addCommand(new InvokeCommand('.webprofiler__collector-' . $name, 'addClass', ['active']));\n\n    return $response;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Controller/DashboardController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DashboardController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "protection_rule.add:\n  route_name: entity.protection_rule.add_form\n  title: 'Add protection rule'\n  appears_on:\n    - entity.protection_rule.collection\n  options:\n    attributes:\n      class:\n        - use-ajax\n      data-dialog-type: modal\n      data-dialog-options: '{\"width\":700,\"title\":\"Add protection rule\"}'\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/db_wipe_entity.links.action.yml", "type": "yaml_reference", "topic": "db wipe entity.links.action"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: DashboardController.php\nTarget symbol: class DashboardController\nNamespace: Drupal\\webprofiler\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DashboardController.\n- Include required imports:\n  - Drupal\\Core\\Ajax\\AjaxResponse\n  - Drupal\\Core\\Ajax\\HtmlCommand\n  - Drupal\\Core\\Ajax\\InvokeCommand\n  - Drupal\\Core\\Controller\\ControllerBase\n  - Drupal\\webprofiler\\DataCollector\\HasPanelInterface\n  - Drupal\\webprofiler\\Profiler\\TemplateManager\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Symfony\\Component\\HttpFoundation\\Request\n- Ensure these methods exist where relevant:\n  - __construct()\n  - create()\n  - dashboard()\n  - panel()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Controller;\n\nuse Drupal\\Core\\Ajax\\AjaxResponse;\nuse Drupal\\Core\\Ajax\\HtmlCommand;\nuse Drupal\\Core\\Ajax\\InvokeCommand;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\webprofiler\\DataCollector\\HasPanelInterface;\nuse Drupal\\webprofiler\\Profiler\\TemplateManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\DataCollector\\DataCollectorInterface;\nuse Symfony\\Component\\HttpKernel\\Profiler\\Profiler;\n\n/**\n * Controller for the Webprofiler dashboard.\n */\nclass DashboardController extends ControllerBase {\n\n  /**\n   * The Profiler service.\n   *\n   * @var \\Symfony\\Component\\HttpKernel\\Profiler\\Profiler\n   */\n  private Profiler $profiler;\n\n  /**\n   * The Template manager service.\n   *\n   * @var \\Drupal\\webprofiler\\Profiler\\TemplateManager\n   */\n  private TemplateManager $templateManager;\n\n  /**\n   * DashboardController constructor.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Profiler\\Profiler $profiler\n   *   The Profiler service.\n   * @param \\Drupal\\webprofiler\\Profiler\\TemplateManager $templateManager\n   *   The Template manager service.\n   */\n  final public function __construct(\n    Profiler $profiler,\n    TemplateManager $templateManager,\n  ) {\n    $this->profiler = $profiler;\n    $this->templateManager = $templateManager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): DashboardController {\n    return new static(\n      $container->get('webprofiler.profiler'),\n      $container->get('webprofiler.template_manager'),\n    );\n  }\n\n  /**\n   * Controller for the whole dashboard page.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   A Request.\n   *\n   * @return array\n   *   A render array for webprofiler_dashboard theme.\n   */\n  public function dashboard(Request $request): array {\n    $this->profiler->disable();\n\n    $token = $request->get('token');\n\n    $profile = $this->profiler->loadProfile($token);\n\n    if ($profile == NULL) {\n      return [];\n    }\n\n    $collectors = \\array_filter($profile->getCollectors(), static function (DataCollectorInterface $el) {\n      return $el instanceof HasPanelInterface;\n    });\n\n    return [\n      '#theme' => 'webprofiler_dashboard',\n      '#collectors' => $collectors,\n      '#token' => $token,\n      '#profile' => $profile,\n      '#attached' => [\n        'library' => [\n          'webprofiler/dashboard',\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Renders a profiler panel for the given token and type.\n   *\n   * @param string $token\n   *   The profiler token.\n   * @param string $name\n   *   The panel name to render.\n   *\n   * @return \\Drupal\\Core\\Ajax\\AjaxResponse\n   *   An ajax response.\n   */\n  public function panel(string $token, string $name): AjaxResponse {\n    $this->profiler->disable();\n\n    if ('empty' === $token) {\n      return new AjaxResponse('');\n    }\n\n    $profile = $this->profiler->loadProfile($token);\n\n    if ($profile == NULL) {\n      return new AjaxResponse('');\n    }\n\n    $collector = $profile->getCollector($name);\n    if (!($collector instanceof HasPanelInterface)) {\n      return new AjaxResponse('');\n    }\n\n    $response = new AjaxResponse();\n    $response->addCommand(\n      new HtmlCommand(\n        '#js-webprofiler-panel',\n      [\n        '#theme' => 'webprofiler_dashboard_panel',\n        '#name' => $name,\n        '#template' => $this->templateManager->getName($profile, $name),\n        '#profile' => $profile,\n      ]),\n    );\n    $response->addCommand(new InvokeCommand('.webprofiler__collector', 'removeClass', ['active']));\n    $response->addCommand(new InvokeCommand('.webprofiler__collector-' . $name, 'addClass', ['active']));\n\n    return $response;\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Controller/DashboardController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DashboardController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "icon_base_uri: 'public://media-icons/generic'\niframe_domain: ~\noembed_providers_url: 'https://oembed.com/providers.json'\nstandalone_url: false\n", "metadata": {"source": "repos/drupal_core/core/modules/media/config/install/media.settings.yml", "type": "yaml_reference", "topic": "media.settings"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: ViewsRelationship.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\views\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\PluginID;\n\n/**\n * Defines a Plugin attribute class for views relationship handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\relationship\\RelationshipPluginBase\n *\n * @ingroup views_relationship_handlers\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass ViewsRelationship extends PluginID {\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\views\\Attribute;\n\nuse Drupal\\Component\\Plugin\\Attribute\\PluginID;\n\n/**\n * Defines a Plugin attribute class for views relationship handlers.\n *\n * @see \\Drupal\\views\\Plugin\\views\\relationship\\RelationshipPluginBase\n *\n * @ingroup views_relationship_handlers\n */\n#[\\Attribute(\\Attribute::TARGET_CLASS)]\nclass ViewsRelationship extends PluginID {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Attribute/ViewsRelationship.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsRelationship", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: AiImageCropGraphicalLibraryBase.php\nTarget symbol: class for\nNamespace: Drupal\\ai_image_crop\\ImageToolkit\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\File\\FileSystemInterface\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\ai_image_crop\\ImageToolkit;\n\nuse Drupal\\Core\\File\\FileSystemInterface;\n\n/**\n * Abstract base class for graphical library services.\n */\nabstract class AiImageCropGraphicalLibraryBase implements AiImageCropGraphicalLibraryInterface {\n\n  /**\n   * The constructor.\n   */\n  public function __construct(\n    protected FileSystemInterface $fileSystem,\n  ) {\n  }\n\n}\n", "metadata": {"source": "repos/ai_image_crop/src/ImageToolkit/AiImageCropGraphicalLibraryBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AiImageCropGraphicalLibraryBase", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ConfigRenameEvent in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Config;\n\n/**\n * Configuration event fired when renaming a configuration object.\n */\nclass ConfigRenameEvent extends ConfigCrudEvent {\n\n  /**\n   * The old configuration object name.\n   *\n   * @var string\n   */\n  protected $oldName;\n\n  /**\n   * Constructs the config rename event.\n   *\n   * @param \\Drupal\\Core\\Config\\StorableConfigBase $config\n   *   The configuration that has been renamed.\n   * @param string $old_name\n   *   The old configuration object name.\n   */\n  public function __construct(StorableConfigBase $config, $old_name) {\n    $this->config = $config;\n    $this->oldName = $old_name;\n  }\n\n  /**\n   * Gets the old configuration object name.\n   *\n   * @return string\n   *   The old configuration object name.\n   */\n  public function getOldName() {\n    return $this->oldName;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/ConfigRenameEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ConfigRenameEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class KeyRotationResult in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\n\n/**\n * Result of rotating the active encryption key and optionally re-encrypting.\n *\n * @immutable\n */\nfinal class KeyRotationResult {\n\n  public function __construct(\n    public readonly ?EncryptionKeyId $oldActiveKeyId,\n    public readonly EncryptionKeyId $newActiveKeyId,\n    public readonly int $updated = 0,\n    public readonly int $skipped = 0,\n    public readonly int $failed = 0,\n  ) {}\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyRotationResult.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyRotationResult", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: RefineableCompilerContextInterface\nSource file: <source_file>\nFile name hint: RefineableCompilerContextInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\compiler;\n\n/**\n * A refineable compiler context interface.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n */\ninterface RefineableCompilerContextInterface extends \\ArrayAccess, CompilerContextInterface {\n\n  /**\n   * Set the machine name of the compiler plugin to use for this context.\n   *\n   * @param string $compiler\n   *   The machine name of the compiler plugin to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setCompiler(string $compiler): self;\n\n  /**\n   * Set the user-defined data to use for this context.\n   *\n   * @param mixed $data\n   *   The user-defined data to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setData($data): self;\n\n  /**\n   * Set a specific option to use for this context.\n   *\n   * @param string $name\n   *   The name of the option to set.\n   * @param mixed $value\n   *   The value to set for the option.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setOption(string $name, $value): self;\n\n  /**\n   * Set the options to use for this context.\n   *\n   * @param array $options\n   *   The options to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setOptions(array $options): self;\n\n}", "output": "<?php\n\nnamespace Drupal\\compiler;\n\n/**\n * A refineable compiler context interface.\n *\n * Copyright (C) 2021  Library Solutions, LLC (et al.).\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n */\ninterface RefineableCompilerContextInterface extends \\ArrayAccess, CompilerContextInterface {\n\n  /**\n   * Set the machine name of the compiler plugin to use for this context.\n   *\n   * @param string $compiler\n   *   The machine name of the compiler plugin to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setCompiler(string $compiler): self;\n\n  /**\n   * Set the user-defined data to use for this context.\n   *\n   * @param mixed $data\n   *   The user-defined data to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setData($data): self;\n\n  /**\n   * Set a specific option to use for this context.\n   *\n   * @param string $name\n   *   The name of the option to set.\n   * @param mixed $value\n   *   The value to set for the option.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setOption(string $name, $value): self;\n\n  /**\n   * Set the options to use for this context.\n   *\n   * @param array $options\n   *   The options to use for this context.\n   *\n   * @return static\n   *   The object itself for chaining.\n   */\n  public function setOptions(array $options): self;\n\n}\n", "metadata": {"source": "repos/compiler/src/RefineableCompilerContextInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "RefineableCompilerContextInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "sdc_inline_editor.settings:\n  type: config_object\n  label: 'SDC Inline Editor settings'\n  cache_tags:\n    - 'config:sdc_inline_editor.settings'\n  mapping:\n    accessible_components:\n      type: sequence\n      label: 'Global Accessible Components'\n      sequence:\n        type: string\n        label: 'Component Name'\n    enable_all_components:\n      type: boolean\n      label: 'Enable All Components Globally'\n    media_browser:\n      type: string\n      label: 'Media Browser Type'\n    content_type_settings:\n      type: mapping\n      label: 'Content Type Specific Settings'\n      mapping:\n        '*':\n          type: mapping\n          label: 'Content Type Configuration'\n          mapping:\n            accessible_components:\n              type: sequence\n              label: 'Accessible Components for this Content Type'\n              sequence:\n                type: string\n                label: 'Component Name'\n            enable_all_components:\n              type: boolean\n              label: 'Enable All Components for this Content Type'\n", "metadata": {"source": "repos/sdc_inline_editor/config/schema/sdc_inline_editor.schema.yml", "type": "yaml_reference", "topic": "sdc inline editor.schema"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<div{{ attributes.addClass('footer-block') }}>\n  <div class=\"footer-block__wrapper\">\n    {% block image %}\n      {% if image %}\n        <div class=\"footer-block__media\">\n          {{~ image ~}}\n        </div>\n      {% endif %}\n    {% endblock %}\n    <div class=\"footer-block__content\">\n      {% block content %}{% endblock %}\n    </div>\n  </div>\n</div>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/components/footer-block/footer-block.twig", "type": "twig_reference"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: MediaLinkTargetStandaloneWhenAvailable\nSource file: <source_file>\nFile name hint: MediaLinkTargetStandaloneWhenAvailable.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\media\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\GeneratedUrl;\nuse Drupal\\media\\MediaInterface;\n\n/**\n * Provides a Media link target handler that prefers the standalone URL.\n *\n * @see \\Drupal\\media\\Entity\\MediaLinkTarget\n */\nclass MediaLinkTargetStandaloneWhenAvailable extends MediaLinkTarget {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl {\n    assert($entity instanceof MediaInterface);\n\n    // Default to the standalone URL if it is enabled.\n    // @see media_entity_type_alter()\n    if (\\Drupal::config('media.settings')->get('standalone_url')) {\n      return $entity->toUrl('canonical')->toString(TRUE);\n    }\n\n    return parent::getLinkTarget($entity);\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\media\\Entity;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\GeneratedUrl;\nuse Drupal\\media\\MediaInterface;\n\n/**\n * Provides a Media link target handler that prefers the standalone URL.\n *\n * @see \\Drupal\\media\\Entity\\MediaLinkTarget\n */\nclass MediaLinkTargetStandaloneWhenAvailable extends MediaLinkTarget {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLinkTarget(EntityInterface $entity): GeneratedUrl {\n    assert($entity instanceof MediaInterface);\n\n    // Default to the standalone URL if it is enabled.\n    // @see media_entity_type_alter()\n    if (\\Drupal::config('media.settings')->get('standalone_url')) {\n      return $entity->toUrl('canonical')->toString(TRUE);\n    }\n\n    return parent::getLinkTarget($entity);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Entity/MediaLinkTargetStandaloneWhenAvailable.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MediaLinkTargetStandaloneWhenAvailable", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Configuring", "input": "", "output": "# Configuring\n\nYou need `display_builder_ui`.\n\nPermissions:\n\n- \"Administer display builder\"\n\n## List of Display builder profiles\n\n`/admin/structure/display-builder`\n\n![Display builder profiles](images/configs.webp)\n\n## Configuration of a single Display builder profile (config entity)\n\nEach Display builder profile is a configuration entity with:\n\n- Metadata: a label and a description\n- The islands configuration, by type\n\nThere are 5 type of islands:\n\n- `View` panels: They are displayed tabbed in the center of the toolbar, or as buttons in the start of the toolbar\n- `Button`s: they a re displayed as buttons in the end of the toolbar\n- `Library` panels: They are displayed tabbed into the Library View panel\n- `Menu` items: they are displayed in the contextual menu triggered with right-click\n- `Contextual` panels: They are displayed tabbed into the contextual sidebar\n\nVisual positioning:\n\n![Islands region](images/islands-regions.webp)\n\nEach island can be:\n\n- enabled or not\n- ordered relatively to the other ones of a same type\n- configured one by one\n\nFor example, here is the configuration of Toolbar buttons, where some are configurable:\n\n![Islands configuration](images/config-1.webp)\n\nConfiguration happens in a modal:\n\n![Islands modal](images/config-modal.webp)\n\nView panels have an extra feature, they can be moved between 2 different regions:\n\n- tabbed in the center of the toolbar\n- or as buttons in the start of the toolbar\n\n![Islands configuration](images/config-2.webp)\n\n> \ud83d\udea7 2025-11-05: This mechanism may be made generic. See [#3555920](https://www.drupal.org/i/3555920)\n\n## Access & permissions\n\nEach Display builder profile is associated to a permission:\n\n![Permissions](images/permissions.webp)\n\nThis is conditioning the builders available in the selector for a specific user:\n\n![Configuration selector](images/selector.webp)\n", "metadata": {"source": "repos/display_builder/docs/configuration.md", "type": "doc_summary", "topic": "Configuring"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Blockquote\ndescription: \"For quoting blocks of content from another source within your document.\"\ngroup: Typography\nlinks:\n  - \"https://getbootstrap.com/docs/5.3/content/typography/#blockquotes\"\nslots:\n  content:\n    title: Content\n    description: \"The quote.\"\n  footer:\n    title: Footer\n    description: \"For identifying the source. Wrap the name of the source work in <cite>.\"\nprops:\n  type: object\n  properties: {}\n# Fake library for extension/override in sub-themes.\nlibraryOverrides:\n  css: {}\n", "metadata": {"source": "repos/bootstrap_components/components/blockquote/blockquote.component.yml", "type": "yaml_reference", "topic": "blockquote.component"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "business_identity.settings_tab:\n  route_name: business_identity.settings\n  title: 'Business Identity'\n  base_route: business_identity.settings\n", "metadata": {"source": "repos/business_identity/business_identity.links.task.yml", "type": "yaml_reference", "topic": "business identity.links.task"}}
{"instruction": "Show me the implementation of the class BigPipeHooks in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\big_pipe\\Hook;\n\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\Url;\nuse Drupal\\big_pipe\\Render\\Placeholder\\BigPipeStrategy;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Hook\\Attribute\\Hook;\n\n/**\n * Hook implementations for big_pipe.\n */\nclass BigPipeHooks {\n\n  use StringTranslationTrait;\n\n  /**\n   * Implements hook_help().\n   */\n  #[Hook('help')]\n  public function help($route_name, RouteMatchInterface $route_match): ?string {\n    switch ($route_name) {\n      case 'help.page.big_pipe':\n        $output = '<h2>' . $this->t('About') . '</h2>';\n        $output .= '<p>' . $this->t('The BigPipe module sends pages with dynamic content in a way that allows browsers to show them much faster. For more information, see the <a href=\":big_pipe-documentation\">online documentation for the BigPipe module</a>.', [\n          ':big_pipe-documentation' => 'https://www.drupal.org/documentation/modules/big_pipe',\n        ]) . '</p>';\n        $output .= '<h2>' . $this->t('Uses') . '</h2>';\n        $output .= '<dl>';\n        $output .= '<dt>' . $this->t('Speeding up your site') . '</dt>';\n        $output .= '<dd>' . $this->t('The module requires no configuration. Every part of the page contains metadata that allows BigPipe to figure this out on its own.') . '</dd>';\n        $output .= '</dl>';\n        return $output;\n    }\n    return NULL;\n  }\n\n  /**\n   * Implements hook_page_attachments().\n   *\n   * @see \\Drupal\\big_pipe\\Controller\\BigPipeController::setNoJsCookie()\n   */\n  #[Hook('page_attachments')]\n  public function pageAttachments(array &$page): void {\n    // Routes that don't use BigPipe also don't need no-JS detection.\n    if (\\Drupal::routeMatch()->getRouteObject()->getOption('_no_big_pipe')) {\n      return;\n    }\n    $request = \\Drupal::request();\n    // BigPipe is only used when there is an actual session, so only add the\n    // no-JS detection when there actually is a session. @see\n    // \\Drupal\\big_pipe\\Render\\Placeholder\\BigPipeStrategy.\n    $session_exists = \\Drupal::service('session_configuration')->hasSession($request);\n    $page['#cache']['contexts'][] = 'session.exists';\n    // Only do the no-JS detection while we don't know if there's no JS support:\n    // avoid endless redirect loops.\n    $has_big_pipe_nojs_cookie = $request->cookies->has(BigPipeStrategy::NOJS_COOKIE);\n    $page['#cache']['contexts'][] = 'cookies:' . BigPipeStrategy::NOJS_COOKIE;\n    if ($session_exists) {\n      if (!$has_big_pipe_nojs_cookie) {\n        // Let server set the BigPipe no-JS cookie.\n        $page['#attached']['html_head'][] = [\n          [\n            // Redirect through a 'Refresh' meta tag if JavaScript is disabled.\n            '#tag' => 'meta',\n            '#noscript' => TRUE,\n            '#attributes' => [\n              'http-equiv' => 'Refresh',\n              'content' => '0; URL=' . Url::fromRoute('big_pipe.nojs', [], [\n                'query' => \\Drupal::service('redirect.destination')->getAsArray(),\n              ])->toString(),\n            ],\n          ],\n          'big_pipe_detect_nojs',\n        ];\n      }\n      else {\n        // Let client delete the BigPipe no-JS cookie.\n        $page['#attached']['html_head'][] = [\n          [\n            '#tag' => 'script',\n            '#value' => 'document.cookie = \"' . BigPipeStrategy::NOJS_COOKIE . '=1; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT\"',\n          ],\n          'big_pipe_detect_js',\n        ];\n      }\n    }\n  }\n\n  /**\n   * Implements hook_theme().\n   */\n  #[Hook('theme')]\n  public function theme() : array {\n    return [\n      'big_pipe_interface_preview' => [\n        'variables' => [\n          'callback' => NULL,\n          'arguments' => NULL,\n          'preview' => NULL,\n        ],\n      ],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/big_pipe/src/Hook/BigPipeHooks.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BigPipeHooks", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Image in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\media\\Plugin\\media\\Source;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\Display\\EntityViewDisplayInterface;\nuse Drupal\\Core\\Entity\\EntityFieldManagerInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Field\\FieldTypePluginManagerInterface;\nuse Drupal\\Core\\File\\FileSystemInterface;\nuse Drupal\\Core\\Image\\ImageFactory;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\media\\Attribute\\MediaSource;\nuse Drupal\\media\\MediaInterface;\nuse Drupal\\media\\MediaTypeInterface;\n\n/**\n * Image entity media source.\n *\n * @see \\Drupal\\Core\\Image\\ImageInterface\n */\n#[MediaSource(\n  id: \"image\",\n  label: new TranslatableMarkup(\"Image\"),\n  description: new TranslatableMarkup(\"A locally hosted image file.\"),\n  allowed_field_types: [\"image\"],\n  default_thumbnail_filename: \"no-thumbnail.png\",\n  thumbnail_alt_metadata_attribute: \"thumbnail_alt_value\"\n)]\nclass Image extends File {\n\n  /**\n   * Key for \"image width\" metadata attribute.\n   *\n   * @var string\n   */\n  const METADATA_ATTRIBUTE_WIDTH = 'width';\n\n  /**\n   * Key for \"image height\" metadata attribute.\n   *\n   * @var string\n   */\n  const METADATA_ATTRIBUTE_HEIGHT = 'height';\n\n  /**\n   * The image factory service.\n   *\n   * @var \\Drupal\\Core\\Image\\ImageFactory\n   */\n  protected $imageFactory;\n\n  /**\n   * The file system service.\n   *\n   * @var \\Drupal\\Core\\File\\FileSystemInterface\n   */\n  protected $fileSystem;\n\n  /**\n   * Constructs a new class instance.\n   *\n   * @param array $configuration\n   *   A configuration array containing information about the plugin instance.\n   * @param string $plugin_id\n   *   The plugin ID for the plugin instance.\n   * @param mixed $plugin_definition\n   *   The plugin implementation definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   Entity type manager service.\n   * @param \\Drupal\\Core\\Entity\\EntityFieldManagerInterface $entity_field_manager\n   *   Entity field manager service.\n   * @param \\Drupal\\Core\\Field\\FieldTypePluginManagerInterface $field_type_manager\n   *   The field type plugin manager service.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory service.\n   * @param \\Drupal\\Core\\Image\\ImageFactory $image_factory\n   *   The image factory.\n   * @param \\Drupal\\Core\\File\\FileSystemInterface $file_system\n   *   The file system service.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, EntityTypeManagerInterface $entity_type_manager, EntityFieldManagerInterface $entity_field_manager, FieldTypePluginManagerInterface $field_type_manager, ConfigFactoryInterface $config_factory, ImageFactory $image_factory, FileSystemInterface $file_system) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition, $entity_type_manager, $entity_field_manager, $field_type_manager, $config_factory);\n\n    $this->imageFactory = $image_factory;\n    $this->fileSystem = $file_system;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadataAttributes() {\n    $attributes = parent::getMetadataAttributes();\n\n    $attributes += [\n      static::METADATA_ATTRIBUTE_WIDTH => $this->t('Width'),\n      static::METADATA_ATTRIBUTE_HEIGHT => $this->t('Height'),\n    ];\n\n    return $attributes;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMetadata(MediaInterface $media, $name) {\n    // Get the file and image data.\n    /** @var \\Drupal\\file\\FileInterface $file */\n    $file = $media->get($this->configuration['source_field'])->entity;\n    // If the source field is not required, it may be empty.\n    if (!$file) {\n      return parent::getMetadata($media, $name);\n    }\n\n    $uri = $file->getFileUri();\n    switch ($name) {\n      case static::METADATA_ATTRIBUTE_WIDTH:\n        $image = $this->imageFactory->get($uri);\n        return $image->getWidth() ?: NULL;\n\n      case static::METADATA_ATTRIBUTE_HEIGHT:\n        $image = $this->imageFactory->get($uri);\n        return $image->getHeight() ?: NULL;\n\n      case 'thumbnail_uri':\n        return $uri;\n\n      case 'thumbnail_alt_value':\n        return $media->get($this->configuration['source_field'])->alt ?? parent::getMetadata($media, $name);\n    }\n\n    return parent::getMetadata($media, $name);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createSourceField(MediaTypeInterface $type) {\n    /** @var \\Drupal\\field\\FieldConfigInterface $field */\n    $field = parent::createSourceField($type);\n\n    // Reset the field to its default settings so that we don't inherit the\n    // settings from the parent class' source field.\n    $settings = $this->fieldTypeManager->getDefaultFieldSettings($field->getType());\n\n    return $field->set('settings', $settings);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function prepareViewDisplay(MediaTypeInterface $type, EntityViewDisplayInterface $display) {\n    parent::prepareViewDisplay($type, $display);\n\n    // Use the `large` image style and do not link the image to anything.\n    // This will prevent the out-of-the-box configuration from outputting very\n    // large raw images. If the `large` image style has been deleted, do not\n    // set an image style.\n    $field_name = $this->getSourceFieldDefinition($type)->getName();\n    $component = $display->getComponent($field_name);\n    $component['settings']['image_link'] = '';\n    $component['settings']['image_style'] = '';\n    if ($this->entityTypeManager->getStorage('image_style')->load('large')) {\n      $component['settings']['image_style'] = 'large';\n    }\n    $display->setComponent($field_name, $component);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/Plugin/media/Source/Image.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Image", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: AjaxBasePageNegotiator.php\nTarget symbol: class AjaxBasePageNegotiator\nNamespace: Drupal\\Core\\Theme\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for AjaxBasePageNegotiator.\n- Include required imports:\n  - Drupal\\Core\\Access\\CsrfTokenGenerator\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Symfony\\Component\\HttpFoundation\\RequestStack\n- Ensure these methods exist where relevant:\n  - __construct()\n  - applies()\n  - determineActiveTheme()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Theme;\n\nuse Drupal\\Core\\Access\\CsrfTokenGenerator;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * Defines a theme negotiator that deals with the active theme on ajax requests.\n *\n * Many different pages can invoke an Ajax request to a generic Ajax path. It is\n * almost always desired for an Ajax response to be rendered using the same\n * theme as the base page, because most themes are built with the assumption\n * that they control the entire page, so if the CSS for two themes are both\n * loaded for a given page, they may conflict with each other. For example,\n * Olivero is Drupal's default theme, and Claro is Drupal's default\n * administration theme. Depending on whether the \"Use the administration theme\n * when editing or creating content\" checkbox is checked, the node edit form may\n * be displayed in either theme, but the Ajax response to the Field module's\n * \"Add another item\" button should be rendered using the same theme as the rest\n * of the page.\n */\nclass AjaxBasePageNegotiator implements ThemeNegotiatorInterface {\n\n  /**\n   * The CSRF token generator.\n   *\n   * @var \\Drupal\\Core\\Access\\CsrfTokenGenerator\n   */\n  protected $csrfGenerator;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * The request stack.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   */\n  protected $requestStack;\n\n  /**\n   * Constructs a new AjaxBasePageNegotiator.\n   *\n   * @param \\Drupal\\Core\\Access\\CsrfTokenGenerator $token_generator\n   *   The CSRF token generator.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Symfony\\Component\\HttpFoundation\\RequestStack $request_stack\n   *   The request stack used to retrieve the current request.\n   */\n  public function __construct(CsrfTokenGenerator $token_generator, ConfigFactoryInterface $config_factory, RequestStack $request_stack) {\n    $this->csrfGenerator = $token_generator;\n    $this->configFactory = $config_factory;\n    $this->requestStack = $request_stack;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies(RouteMatchInterface $route_match) {\n    $ajax_page_state = $this->requestStack->getCurrentRequest()->attributes->get('ajax_page_state');\n    return !empty($ajax_page_state['theme']) && isset($ajax_page_state['theme_token']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function determineActiveTheme(RouteMatchInterface $route_match) {\n    $ajax_page_state = $this->requestStack->getCurrentRequest()->attributes->get('ajax_page_state');\n    $theme = $ajax_page_state['theme'];\n    $token = $ajax_page_state['theme_token'];\n\n    // Prevent a request forgery from giving a person access to a theme they\n    // shouldn't be otherwise allowed to see. However, since everyone is\n    // allowed to see the default theme, token validation isn't required for\n    // that, and bypassing it allows most use-cases to work even when accessed\n    // from the page cache.\n    if ($theme === $this->configFactory->get('system.theme')->get('default') || $this->csrfGenerator->validate($token, $theme)) {\n      return $theme;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/AjaxBasePageNegotiator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AjaxBasePageNegotiator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a fieldset element and its children.\n *\n * Available variables:\n * - attributes: HTML attributes for the fieldset element.\n * - errors: (optional) Any errors for this fieldset element, may not be set.\n * - required: Boolean indicating whether the fieldset element is required.\n * - legend: The legend element containing the following properties:\n *   - title: Title of the fieldset, intended for use as the text of the legend.\n *   - attributes: HTML attributes to apply to the legend.\n * - description: The description element containing the following properties:\n *   - content: The description content of the fieldset.\n *   - attributes: HTML attributes to apply to the description container.\n * - description_display: Description display setting. It can have these values:\n *   - before: The description is output before the element.\n *   - after: The description is output after the element (default).\n *   - invisible: The description is output after the element, hidden visually\n *     but available to screen readers.\n * - children: The rendered child elements of the fieldset.\n * - prefix: The content to add before the fieldset children.\n * - suffix: The content to add after the fieldset children.\n *\n * @see\\Drupal\\Core\\Form\\FormPreprocess::preprocessFieldset()\n */\n#}\n{%\n  set classes = [\n    'js-form-item',\n    'form-item',\n    'js-form-wrapper',\n    'form-wrapper',\n  ]\n%}\n<fieldset{{ attributes.addClass(classes) }}>\n  {%\n    set legend_span_classes = [\n      'fieldset-legend',\n      required ? 'js-form-required',\n      required ? 'form-required',\n    ]\n  %}\n  {# Always wrap fieldset legends in a <span> for CSS positioning. #}\n  <legend{{ legend.attributes }}>\n    <span{{ legend_span.attributes.addClass(legend_span_classes) }}>{{ legend.title }}</span>\n  </legend>\n  <div class=\"fieldset-wrapper\">\n    {% if description_display == 'before' and description.content %}\n      <div{{ description.attributes.addClass('description') }}>{{ description.content }}</div>\n    {% endif %}\n    {% if errors %}\n      <div class=\"form-item--error-message form-item-errors\">\n        {{ errors }}\n      </div>\n    {% endif %}\n    {% if prefix %}\n      <span class=\"field-prefix\">{{ prefix }}</span>\n    {% endif %}\n    {{ children }}\n    {% if suffix %}\n      <span class=\"field-suffix\">{{ suffix }}</span>\n    {% endif %}\n    {% if description_display in ['after', 'invisible'] and description.content %}\n      <div{{ description.attributes.addClass('description') }}>{{ description.content }}</div>\n    {% endif %}\n  </div>\n</fieldset>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/form/fieldset.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class DeprecatedArray in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Component\\Utility;\n\n/**\n * An array that triggers a deprecation warning when accessed.\n */\nclass DeprecatedArray extends \\ArrayObject {\n\n  /**\n   * The deprecation message.\n   *\n   * @var string\n   */\n  protected $message;\n\n  /**\n   * DeprecatedArray constructor.\n   *\n   * @param array $values\n   *   The array values.\n   * @param string $message\n   *   The deprecation message.\n   */\n  public function __construct(array $values, $message) {\n    $this->message = $message;\n    parent::__construct($values);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function offsetExists($offset): bool {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    return parent::offsetExists($offset);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function offsetGet($offset): mixed {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    return parent::offsetGet($offset);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function offsetSet($offset, $value): void {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    parent::offsetSet($offset, $value);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function offsetUnset($offset): void {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    parent::offsetUnset($offset);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIterator(): \\ArrayIterator {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    return parent::getIterator();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function unserialize($serialized): void {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    parent::unserialize($serialized);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function serialize(): string {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    return parent::serialize();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function count(): int {\n    @trigger_error($this->message, E_USER_DEPRECATED);\n    return parent::count();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Component/Utility/DeprecatedArray.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DeprecatedArray", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Search for *getTriggeringElement*", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# Search for *getTriggeringElement*\n\n1. [Search 7.x for *getTriggeringElement*](/api/drupal/7.x/search/getTriggeringElement)\n2. [Search 9.5.x for *getTriggeringElement*](/api/drupal/9/search/getTriggeringElement)\n3. [Search 8.9.x for *getTriggeringElement*](/api/drupal/8.9.x/search/getTriggeringElement)\n4. [Search 10.3.x for *getTriggeringElement*](/api/drupal/10/search/getTriggeringElement)\n5. [Other projects](https://api.drupal.org/api/projects)\n\nObject Type\n\nSort by\nTitleObject typeFile name\n\nOrder\nAscDesc\n\n| Title | Object type | File name | Summary |\n| --- | --- | --- | --- |\n| [FormState::getTriggeringElement](/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormState.php/function/FormState%3A%3AgetTriggeringElement/11.x) | function | core/lib/Drupal/Core/Form/[FormState.php](/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormState.php/11.x) | Gets the form element that triggered submission. |\n| [FormStateDecoratorBase::getTriggeringElement](/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormStateDecoratorBase.php/function/FormStateDecoratorBase%3A%3AgetTriggeringElement/11.x) | function | core/lib/Drupal/Core/Form/[FormStateDecoratorBase.php](/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormStateDecoratorBase.php/11.x) | Gets the form element that triggered submission. |\n| [FormStateDecoratorBaseTest::testGetTriggeringElement](/api/drupal/core%21tests%21Drupal%21Tests%21Core%21Form%21FormStateDecoratorBaseTest.php/function/FormStateDecoratorBaseTest%3A%3AtestGetTriggeringElement/11.x) | function | core/tests/Drupal/Tests/Core/Form/[FormStateDecoratorBaseTest.php](/api/drupal/core%21tests%21Drupal%21Tests%21Core%21Form%21FormStateDecoratorBaseTest.php/11.x) | Tests get triggering element. |\n| [FormStateInterface::getTriggeringElement](/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormStateInterface.php/function/FormStateInterface%3A%3AgetTriggeringElement/11.x) | function | core/lib/Drupal/Core/Form/[FormStateInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormStateInterface.php/11.x) | Gets the form element that triggered submission. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/11.x/search/getTriggeringElement%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/11.x/search/getTriggeringElement.md", "type": "doc_summary", "topic": "Search for *getTriggeringElement*"}}
{"instruction": "Show me the implementation of the class LanguageNegotiationUserAdmin in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user\\Plugin\\LanguageNegotiation;\n\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\PathProcessor\\PathProcessorManager;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\Routing\\AdminContext;\nuse Drupal\\Core\\Routing\\StackedRouteMatchInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\language\\Attribute\\LanguageNegotiation;\nuse Drupal\\language\\LanguageNegotiationMethodBase;\nuse Drupal\\Core\\Routing\\RouteObjectInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Exception\\HttpException;\nuse Symfony\\Component\\Routing\\Exception\\ExceptionInterface;\nuse Symfony\\Component\\Routing\\Matcher\\UrlMatcherInterface;\n\n/**\n * Identifies admin language from the user preferences.\n */\n#[LanguageNegotiation(\n  id: LanguageNegotiationUserAdmin::METHOD_ID,\n  name: new TranslatableMarkup('Account administration pages'),\n  types: [LanguageInterface::TYPE_INTERFACE],\n  weight: -10,\n  description: new TranslatableMarkup('Account administration pages language setting.')\n)]\nclass LanguageNegotiationUserAdmin extends LanguageNegotiationMethodBase implements ContainerFactoryPluginInterface {\n\n  /**\n   * The language negotiation method id.\n   */\n  const METHOD_ID = 'language-user-admin';\n\n  /**\n   * The admin context.\n   *\n   * @var \\Drupal\\Core\\Routing\\AdminContext\n   */\n  protected $adminContext;\n\n  /**\n   * The router.\n   *\n   * This is only used when called from an event subscriber, before the request\n   * has been populated with the route info.\n   *\n   * @var \\Symfony\\Component\\Routing\\Matcher\\UrlMatcherInterface\n   */\n  protected $router;\n\n  /**\n   * The path processor manager.\n   *\n   * @var \\Drupal\\Core\\PathProcessor\\PathProcessorManager\n   */\n  protected $pathProcessorManager;\n\n  /**\n   * The stacked route match.\n   *\n   * @var \\Drupal\\Core\\Routing\\StackedRouteMatchInterface\n   */\n  protected $stackedRouteMatch;\n\n  /**\n   * Constructs a new LanguageNegotiationUserAdmin instance.\n   *\n   * @param \\Drupal\\Core\\Routing\\AdminContext $admin_context\n   *   The admin context.\n   * @param \\Symfony\\Component\\Routing\\Matcher\\UrlMatcherInterface $router\n   *   The router.\n   * @param \\Drupal\\Core\\PathProcessor\\PathProcessorManager $path_processor_manager\n   *   The path processor manager.\n   * @param \\Drupal\\Core\\Routing\\StackedRouteMatchInterface $stacked_route_match\n   *   The stacked route match.\n   */\n  public function __construct(AdminContext $admin_context, UrlMatcherInterface $router, PathProcessorManager $path_processor_manager, StackedRouteMatchInterface $stacked_route_match) {\n    $this->adminContext = $admin_context;\n    $this->router = $router;\n    $this->pathProcessorManager = $path_processor_manager;\n    $this->stackedRouteMatch = $stacked_route_match;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static(\n      $container->get('router.admin_context'),\n      $container->get('router'),\n      $container->get('path_processor_manager'),\n      $container->get('current_route_match')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getLangcode(?Request $request = NULL) {\n    $langcode = NULL;\n\n    // User preference (only for administrators).\n    if (($this->currentUser->hasPermission('access administration pages') || $this->currentUser->hasPermission('view the administration theme')) && ($preferred_admin_langcode = $this->currentUser->getPreferredAdminLangcode(FALSE)) && $this->isAdminPath($request)) {\n      $langcode = $preferred_admin_langcode;\n    }\n\n    // Not an admin, no admin language preference or not on an admin path.\n    return $langcode;\n  }\n\n  /**\n   * Checks whether the given path is an administrative one.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   *\n   * @return bool\n   *   TRUE if the path is administrative, FALSE otherwise.\n   */\n  protected function isAdminPath(Request $request) {\n    $result = FALSE;\n    if ($request && $this->adminContext) {\n      // If called from an event subscriber, the request may not have the route\n      // object yet (it is still being built), so use the router to look up\n      // based on the path.\n      $route_match = $this->stackedRouteMatch->getRouteMatchFromRequest($request);\n      if ($route_match && !$route_object = $route_match->getRouteObject()) {\n        try {\n          // Some inbound path processors make changes to the request. Make a\n          // copy as we're not actually routing the request so we do not want to\n          // make changes.\n          $cloned_request = clone $request;\n          // Process the path as an inbound path. This will remove any language\n          // prefixes and other path components that inbound processing would\n          // clear out, so we can attempt to load the route clearly.\n          $path = $this->pathProcessorManager->processInbound(urldecode(rtrim($cloned_request->getPathInfo(), '/')), $cloned_request);\n          $attributes = $this->router->match($path);\n        }\n        catch (ExceptionInterface | HttpException) {\n          return FALSE;\n        }\n        $route_object = $attributes[RouteObjectInterface::ROUTE_OBJECT];\n      }\n      $result = $this->adminContext->isAdminRoute($route_object);\n    }\n    return $result;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/Plugin/LanguageNegotiation/LanguageNegotiationUserAdmin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LanguageNegotiationUserAdmin", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Configuration schema for Entity Builder Field Group submodule.\n\n# Operation-specific configuration schemas.\n\neb.plugin.operation.create_field_group:\n  type: mapping\n  label: 'Create Field Group operation configuration'\n  mapping:\n    group_name:\n      type: string\n      label: 'Group Name'\n    entity_type:\n      type: string\n      label: 'Entity Type'\n    bundle:\n      type: string\n      label: 'Bundle'\n    display_type:\n      type: string\n      label: 'Display Type (form or view)'\n    display_id:\n      type: string\n      label: 'Display ID (mode)'\n    label:\n      type: string\n      label: 'Label'\n    format_type:\n      type: string\n      label: 'Format Type'\n    format_settings:\n      type: mapping\n      label: 'Format Settings'\n    children:\n      type: sequence\n      label: 'Children'\n      sequence:\n        type: string\n    parent:\n      type: string\n      label: 'Parent Group Name'\n    weight:\n      type: integer\n      label: 'Weight'\n\neb.plugin.operation.update_field_group:\n  type: mapping\n  label: 'Update Field Group operation configuration'\n  mapping:\n    group_name:\n      type: string\n      label: 'Group Name'\n    entity_type:\n      type: string\n      label: 'Entity Type'\n    bundle:\n      type: string\n      label: 'Bundle'\n    display_type:\n      type: string\n      label: 'Display Type (form or view)'\n    display_id:\n      type: string\n      label: 'Display ID (mode)'\n    label:\n      type: string\n      label: 'Label'\n    format_type:\n      type: string\n      label: 'Format Type'\n    format_settings:\n      type: mapping\n      label: 'Format Settings'\n    children:\n      type: sequence\n      label: 'Children'\n      sequence:\n        type: string\n    parent:\n      type: string\n      label: 'Parent Group Name'\n    weight:\n      type: integer\n      label: 'Weight'\n\neb.plugin.operation.delete_field_group:\n  type: mapping\n  label: 'Delete Field Group operation configuration'\n  mapping:\n    group_name:\n      type: string\n      label: 'Group Name'\n    entity_type:\n      type: string\n      label: 'Entity Type'\n    bundle:\n      type: string\n      label: 'Bundle'\n    display_type:\n      type: string\n      label: 'Display Type (form or view)'\n    display_id:\n      type: string\n      label: 'Display ID (mode)'\n", "metadata": {"source": "repos/eb_field_group/config/schema/eb_field_group.schema.yml", "type": "yaml_reference", "topic": "eb field group.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'FlowDrop Job'\ntype: module\ndescription: 'Provides job entity type for individual workflow node execution.'\npackage: 'FlowDrop'\ncore_version_requirement: ^11\ndependencies:\n  - drupal:options\n  - drupal:text\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_job/flowdrop_job.info.yml", "type": "yaml_reference", "topic": "flowdrop job.info"}}
{"instruction": "Show me the implementation of the class SetDefaultImage in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper\\Plugin\\ConfigAction;\n\nuse Drupal\\Core\\Config\\Action\\Attribute\\ConfigAction;\nuse Drupal\\Core\\Config\\Action\\ConfigActionPluginInterface;\nuse Drupal\\Core\\Config\\ConfigManagerInterface;\nuse Drupal\\Core\\DependencyInjection\\AutowiredInstanceTrait;\nuse Drupal\\Core\\Field\\FieldConfigBase;\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\field\\FieldStorageConfigInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Sets the default image of an image field.\n *\n * This is needed because, by default, core will invalidate the default image\n * of an image field if it refers to a file entity that doesn't exist. However,\n * this situation can easily be encountered while applying a recipe, since\n * you could use a config action to set the default image to a file entity\n * that the recipe ships, but doesn't exist when config actions are applied.\n *\n * An example of using this in a recipe:\n * @code\n * field.field.node.article.field_image:\n *   # This is the UUID of a file entity that may or may not exist yet.\n *   setDefaultImage: 059dcb1d-3f0d-4390-89d7-6ebe2bc0d833\n * @endcode\n *\n * @api\n *   This is part of Drupal CMS's developer-facing API and may be relied upon.\n */\n#[ConfigAction(\n  id: 'setDefaultImage',\n  admin_label: new TranslatableMarkup('Set default image'),\n  entity_types: [\n    'base_field_override',\n    'field_config',\n    'field_storage_config',\n  ],\n)]\nfinal readonly class SetDefaultImage implements ConfigActionPluginInterface, ContainerFactoryPluginInterface {\n\n  use AutowiredInstanceTrait;\n\n  public function __construct(\n    private ConfigManagerInterface $configManager,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): self {\n    return self::createInstanceAutowired($container);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function apply(string $configName, mixed $value): void {\n    $field = $this->configManager->loadConfigEntityByName($configName);\n\n    // Check assumptions...\n    assert(\n      // We need to be working on an entity that supports changing settings.\n      ($field instanceof FieldConfigBase || $field instanceof FieldStorageConfigInterface) &&\n      // And it must be an image field.\n      $field->getType() === 'image' &&\n      // The value is the UUID of a file entity, but it need not exist yet.\n      is_string($value)\n    );\n    $field->setSetting('default_image', ['uuid' => $value] + $field->getSetting('default_image'))\n      // We need to mark the field as syncing so that the default image won't\n      // be changed to NULL if the file doesn't exist yet.\n      // @see \\Drupal\\image\\Hook\\ImageHooks::entityPresave()\n      ->setSyncing(TRUE)\n      ->save();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/Plugin/ConfigAction/SetDefaultImage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SetDefaultImage", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: ListNormalizer.php\nTarget symbol: class extends\nNamespace: Drupal\\serialization\\Normalizer\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for extends.\n- Include required imports:\n  - Drupal\\Core\\TypedData\\ListInterface\n- Ensure these methods exist where relevant:\n  - getSupportedTypes()\n  - normalize()", "output": "<?php\n\nnamespace Drupal\\serialization\\Normalizer;\n\nuse Drupal\\Core\\TypedData\\ListInterface;\n\n/**\n * Converts list objects to arrays.\n *\n * Ordinarily, this would be handled automatically by Serializer, but since\n * there is a TypedDataNormalizer and the Field class extends TypedData, any\n * Field will be handled by that Normalizer instead of being traversed. This\n * class ensures that TypedData classes that also implement ListInterface are\n * traversed instead of simply returning getValue().\n */\nclass ListNormalizer extends NormalizerBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function normalize($object, $format = NULL, array $context = []): array|string|int|float|bool|\\ArrayObject|NULL {\n    $attributes = [];\n    foreach ($object as $fieldItem) {\n      $attributes[] = $this->serializer->normalize($fieldItem, $format, $context);\n    }\n    return $attributes;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      ListInterface::class => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/Normalizer/ListNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ListNormalizer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Display Builder", "input": "", "output": "# Display Builder\n\nA display building tool by the [UI Suite](https://www.drupal.org/project/ui_suite) team.\n\n## Installation\n\nInstall as you would normally install a contributed Drupal module.\nSee: [Installing Modules](https://www.drupal.org/docs/extending-drupal/installing-modules) for further information.\n\n!!!warning \"Beta stage and Drupal 11.3+\"\n  The module is still in development and [some extra steps may be needed](./docs/install.md).\n\n## Contributing\n\nJoin us on slack [#display_builder](https://drupal.slack.com/archives/C092EUNPCRW).\n\nSee [documentation](./docs/contributing.md).\n\n## Documentation (Work in progress)\n\nSee [online documentation](https://project.pages.drupalcode.org/display_builder) or local [docs/index.md](./docs/index.md).\n\n## Maintainers\n\nCurrent maintainers:\n\n- Jean Valverde - Lead - [mogtofu33](https://www.drupal.org/u/mogtofu33)\n- Mikael Meulle - Maintainer - [just_like_good_vibes](https://www.drupal.org/u/just_like_good_vibes)\n- Pierre Dureau - Project manager - [pdureau](https://www.drupal.org/u/pdureau)\n\nSupporting organizations:\n\n- [Beyris](https://www.drupal.org/beyris) - We are leading impactful open-source\n  projects and we are providing coding, training, audit and consulting.\n- You want to support us? Contact us on slack [#display_builder](https://drupal.slack.com/archives/C092EUNPCRW)\n", "metadata": {"source": "repos/display_builder/README.md", "type": "doc_summary", "topic": "Display Builder"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for configuration files of the Field module.\n\nfield.settings:\n  type: config_object\n  label: 'Field settings'\n  constraints:\n    FullyValidatable: ~\n  mapping:\n    purge_batch_size:\n      type: integer\n      label: 'Maximum number of field data records to purge'\n      constraints:\n        NotNull: []\n        Range:\n          min: 1\n\nfield.storage.*.*:\n  type: config_entity\n  label: 'Field'\n  mapping:\n    id:\n      type: string\n      label: 'ID'\n    field_name:\n      type: string\n      label: 'Field name'\n    entity_type:\n      type: string\n      label: 'Entity type'\n    type:\n      type: string\n      label: 'Type'\n      constraints:\n        PluginExists:\n          manager: plugin.manager.field.field_type\n          interface: '\\Drupal\\Core\\Field\\FieldItemInterface'\n    settings:\n      type: field.storage_settings.[%parent.type]\n    module:\n      type: string\n      label: 'Module'\n    locked:\n      type: boolean\n      label: 'Locked'\n    cardinality:\n      type: integer\n      label: 'Maximum number of values users can enter'\n    translatable:\n      type: boolean\n      label: 'Translatable'\n    indexes:\n      type: sequence\n      label: 'Indexes'\n      sequence:\n        type: sequence\n        label: 'Indexes'\n        sequence:\n          type: ignore\n          label: 'Index'\n    persist_with_no_fields:\n      type: boolean\n      label: 'Persist field storage with no fields'\n    custom_storage:\n      type: boolean\n      label: 'Enable custom storage'\n\nfield.field.*.*.*:\n  type: field_config_base\n  label: 'Field'\n  constraints:\n    FullyValidatable: ~\n", "metadata": {"source": "repos/drupal_core/core/modules/field/config/schema/field.schema.yml", "type": "yaml_reference", "topic": "field.schema"}}
{"instruction": "Show me the implementation of the class Runner in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Queue;\n\nuse Drupal\\Core\\Queue\\DelayableQueueInterface;\nuse Drupal\\Core\\Queue\\DelayedRequeueException;\nuse Drupal\\Core\\Queue\\QueueGarbageCollectionInterface;\nuse Drupal\\Core\\Queue\\QueueInterface;\nuse Drupal\\Core\\Queue\\QueueWorkerInterface;\nuse Drupal\\Core\\Queue\\RequeueException;\nuse Psr\\Clock\\ClockInterface;\n\n/**\n * {@selfdoc}\n *\n * @todo Create a test for this.\n */\nfinal readonly class Runner {\n\n  /**\n   * {@selfdoc}\n   */\n  public function __construct(\n    private ClockInterface $clock,\n  ) {}\n\n  /**\n   * Processes a queue.\n   *\n   * @param positive-int $time_limit\n   *   The maximum number of seconds allowed to run the queue.\n   *\n   * @throws \\Drupal\\Core\\Queue\\SuspendQueueException\n   *\n   * @see \\Drupal\\Core\\Cron::processQueue\n   */\n  public function run(QueueInterface $queue, QueueWorkerInterface $worker, int $time_limit): void {\n    $finish = $this->clock->now()->getTimestamp() + $time_limit;\n    while ($this->clock->now()->getTimestamp() < $finish) {\n      if (!$item = self::claimItem($queue)) {\n        return;\n      }\n      try {\n        $worker->processItem($item->data);\n        $queue->deleteItem($item);\n      }\n      catch (DelayedRequeueException $exception) {\n        // The worker requested the task not be immediately re-queued.\n        // - If the queue doesn't support ::delayItem(), we should leave the\n        // item's current expiry time alone.\n        // - If the queue does support ::delayItem(), we should allow the\n        // queue to update the item's expiry using the requested delay.\n        if ($queue instanceof DelayableQueueInterface) {\n          // This queue can handle a custom delay; use the duration provided\n          // by the exception.\n          $queue->delayItem($item, $exception->getDelay());\n        }\n      }\n      catch (RequeueException) {\n        // The worker requested the task be immediately requeued.\n        $queue->releaseItem($item);\n      }\n      // Do not catch SuspendQueueException. It's up to consumer to hande it.\n    }\n  }\n\n  /**\n   * @return object{data: mixed, item_id: string, created: numeric-string}|false\n   */\n  private static function claimItem(QueueInterface $queue): false|object {\n    if ($item = $queue->claimItem()) {\n      // @phpstan-ignore return.type\n      return $item;\n    }\n\n    if (!$queue instanceof QueueGarbageCollectionInterface) {\n      return FALSE;\n    }\n\n    if ($queue->numberOfItems() === 0) {\n      return FALSE;\n    }\n\n    // Clean queue garbage and try to claim item again.\n    $queue->garbageCollection();\n    if ($item = $queue->claimItem()) {\n      // @phpstan-ignore return.type\n      return $item;\n    }\n\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/src/Queue/Runner.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Runner", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: MauticRequestAccessCheck\nSource file: <source_file>\nFile name hint: MauticRequestAccessCheck.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mautic_content_provider\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\views\\Views;\n\n/**\n * Custom access checker for Mautic content endpoints.\n */\nclass MauticRequestAccessCheck implements AccessInterface {\n\n  /**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   */\n  protected $moduleHandler;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * Constructs a new instance of this class.\n   *\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   */\n  public function __construct(ModuleHandlerInterface $module_handler, ConfigFactoryInterface $config_factory) {\n    $this->moduleHandler = $module_handler;\n    $this->configFactory = $config_factory;\n  }\n\n  /**\n   * Access callback for our routes.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The current route match.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(RouteMatchInterface $route_match) {\n    // Default to allowed for API endpoints.\n    $access_result = AccessResult::allowed();\n    $context = [];\n\n    // If node related route.\n    if ($route_match->getRouteName() === 'mautic_content_provider.render_node') {\n      $context['node'] = $route_match->getParameter('node');\n      $access_result = AccessResult::forbidden('Node not found.');\n      if ($context['node'] instanceof NodeInterface) {\n        $access_result = $context['node']->access('view') ? AccessResult::allowed() : $access_result;\n\n        // Also check if the bundle is allowed by our config.\n        $config = $this->configFactory->get('mautic_content_provider.settings');\n        $allowed_bundles = $config->get('allowed_bundles') ?: [];\n        if (!empty($allowed_bundles) && !in_array($context['node']->bundle(), $allowed_bundles)) {\n          $access_result = AccessResult::forbidden('Content type not allowed');\n        }\n\n        $access_result = $access_result->addCacheableDependency($context['node'])->addCacheableDependency($config);\n      }\n    }\n\n    // If view related route.\n    if ($route_match->getRouteName() === 'mautic_content_provider.render_view') {\n      $view_id = $route_match->getParameter('view_id');\n      $display_id = $route_match->getParameter('display_id');\n      $access_result = AccessResult::forbidden('View or Display not found.');\n      if ($view_id && $display_id) {\n        $context['view'] = Views::getView($view_id);\n        if ($context['view'] && $context['view']->setDisplay($display_id) && $context['view']->getDisplay()->getPluginId() === 'mautic_email_display') {\n          $access_result = $context['view']->access($display_id) ? AccessResult::allowed() : AccessResult::forbidden();\n          $access_result = $access_result->addCacheableDependency($context['view']);\n        }\n      }\n    }\n\n    // Allow modules to alter. Passing context for node or view.\n    $this->moduleHandler->alter('mautic_content_provider_access', $access_result, $context);\n\n    return $access_result;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mautic_content_provider\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\Access\\AccessInterface;\nuse Drupal\\node\\NodeInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\views\\Views;\n\n/**\n * Custom access checker for Mautic content endpoints.\n */\nclass MauticRequestAccessCheck implements AccessInterface {\n\n  /**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   */\n  protected $moduleHandler;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * Constructs a new instance of this class.\n   *\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   */\n  public function __construct(ModuleHandlerInterface $module_handler, ConfigFactoryInterface $config_factory) {\n    $this->moduleHandler = $module_handler;\n    $this->configFactory = $config_factory;\n  }\n\n  /**\n   * Access callback for our routes.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The current route match.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(RouteMatchInterface $route_match) {\n    // Default to allowed for API endpoints.\n    $access_result = AccessResult::allowed();\n    $context = [];\n\n    // If node related route.\n    if ($route_match->getRouteName() === 'mautic_content_provider.render_node') {\n      $context['node'] = $route_match->getParameter('node');\n      $access_result = AccessResult::forbidden('Node not found.');\n      if ($context['node'] instanceof NodeInterface) {\n        $access_result = $context['node']->access('view') ? AccessResult::allowed() : $access_result;\n\n        // Also check if the bundle is allowed by our config.\n        $config = $this->configFactory->get('mautic_content_provider.settings');\n        $allowed_bundles = $config->get('allowed_bundles') ?: [];\n        if (!empty($allowed_bundles) && !in_array($context['node']->bundle(), $allowed_bundles)) {\n          $access_result = AccessResult::forbidden('Content type not allowed');\n        }\n\n        $access_result = $access_result->addCacheableDependency($context['node'])->addCacheableDependency($config);\n      }\n    }\n\n    // If view related route.\n    if ($route_match->getRouteName() === 'mautic_content_provider.render_view') {\n      $view_id = $route_match->getParameter('view_id');\n      $display_id = $route_match->getParameter('display_id');\n      $access_result = AccessResult::forbidden('View or Display not found.');\n      if ($view_id && $display_id) {\n        $context['view'] = Views::getView($view_id);\n        if ($context['view'] && $context['view']->setDisplay($display_id) && $context['view']->getDisplay()->getPluginId() === 'mautic_email_display') {\n          $access_result = $context['view']->access($display_id) ? AccessResult::allowed() : AccessResult::forbidden();\n          $access_result = $access_result->addCacheableDependency($context['view']);\n        }\n      }\n    }\n\n    // Allow modules to alter. Passing context for node or view.\n    $this->moduleHandler->alter('mautic_content_provider_access', $access_result, $context);\n\n    return $access_result;\n  }\n\n}\n", "metadata": {"source": "repos/mautic_content_provider/src/Access/MauticRequestAccessCheck.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "MauticRequestAccessCheck", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\ndependencies:\n  module:\n    - responsive_image\n  enforced:\n    module:\n      - responsive_image\nname: max_2600x2600\nlabel: 'Max 2600x2600'\neffects:\n  9b311dd1-0351-45a1-9500-cd069e4670cb:\n    uuid: 9b311dd1-0351-45a1-9500-cd069e4670cb\n    id: image_scale\n    weight: 1\n    data:\n      width: 2600\n      height: 2600\n      upscale: false\n  3c42f186-7beb-4dbf-b720-bff9dfeaa677:\n    uuid: 3c42f186-7beb-4dbf-b720-bff9dfeaa677\n    id: image_convert_avif\n    weight: 2\n    data:\n      extension: webp\n", "metadata": {"source": "repos/drupal_core/core/profiles/standard/config/optional/image.style.max_2600x2600.yml", "type": "yaml_reference", "topic": "image.style.max 2600x2600"}}
{"instruction": "Show me the implementation of the class AutomatedCron in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n */\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Form submission handler for system_cron_settings().\n *\n * @deprecated in drupal:11.4.0 and is removed from drupal:13.0.0. Use\n *   AutomatedCronHooks::automatedCronSettingsSubmit() instead.\n *\n * @see https://www.drupal.org/node/3566774\n * @see \\Drupal\\automated_cron\\Hook\\AutomatedCronHooks::automatedCronSettingsSubmit()\n */\nfunction automated_cron_settings_submit(array $form, FormStateInterface $form_state): void {\n  @trigger_error(__FUNCTION__ . '() is deprecated in drupal:11.4.0 and is removed from drupal:13.0.0. There is no replacement. See https://www.drupal.org/node/3566774', E_USER_DEPRECATED);\n  \\Drupal::configFactory()->getEditable('automated_cron.settings')\n    ->set('interval', $form_state->getValue('interval'))\n    ->save();\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/automated_cron/automated_cron.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AutomatedCron", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: RenderElement.php\nTarget symbol: class for\nNamespace: Drupal\\Core\\Render\\Element\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - preRenderAjaxForm()\n  - preRenderGroup()\n  - processAjaxForm()\n  - processGroup()\n  - setAttributes()", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Provides a base class for render element plugins.\n *\n * @deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use\n *   \\Drupal\\Core\\Render\\Element\\RenderElementBase instead.\n *\n * @see https://www.drupal.org/node/3436275\n */\nabstract class RenderElement extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\RenderElement is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\RenderElementBase instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function setAttributes(&$element, $class = []) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\RenderElement::setAttributes() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\RenderElementBase::setAttributes() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    parent::setAttributes($element, $class);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function preRenderGroup($element) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\RenderElement::preRenderGroup() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\RenderElementBase::preRenderGroup() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::preRenderGroup($element);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function processAjaxForm(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\RenderElement::processAjaxForm() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\RenderElementBase::processAjaxForm() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::processAjaxForm($element, $form_state, $complete_form);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function preRenderAjaxForm($element) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\RenderElement::preRenderAjaxForm() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\RenderElementBase::preRenderAjaxForm() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::preRenderAjaxForm($element);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function processGroup(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\RenderElement::processGroup() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\RenderElementBase::processGroup() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::processGroup($element, $form_state, $complete_form);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/RenderElement.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RenderElement", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: PublishMultiple\nSource file: <source_file>\nFile name hint: PublishMultiple.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_batch\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_batch\\Service\\BatchService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_batch_publish',\n  label: new TranslatableMarkup('Batch Publish/Unpublish Content'),\n  description: new TranslatableMarkup('Publish or unpublish multiple content items at once. Maximum 50 items per operation.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'ids' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Node IDs'),\n      description: new TranslatableMarkup('Array of node IDs to publish or unpublish.'),\n      required: TRUE,\n    ),\n    'publish' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Publish'),\n      description: new TranslatableMarkup('If true, publish the content. If false, unpublish. Default is true.'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'action' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Action Performed'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_requested' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Requested'),\n      description: new TranslatableMarkup(''),\n    ),\n    'processed_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Processed Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'unchanged_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Unchanged Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'error_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Error Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'processed' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Processed Items'),\n      description: new TranslatableMarkup(''),\n    ),\n    'unchanged' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Unchanged Items'),\n      description: new TranslatableMarkup(''),\n    ),\n    'errors' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Errors'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass PublishMultiple extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'batch';\n\n\n  protected BatchService $batchService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->batchService = $container->get('mcp_tools_batch.batch');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $ids = $input['ids'] ?? [];\n    $publish = $input['publish'] ?? TRUE;\n\n    if (empty($ids)) {\n      return ['success' => FALSE, 'error' => 'Node IDs array is required.'];\n    }\n\n    return $this->batchService->publishMultiple($ids, (bool) $publish);\n  }\n\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_batch\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_batch\\Service\\BatchService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_batch_publish',\n  label: new TranslatableMarkup('Batch Publish/Unpublish Content'),\n  description: new TranslatableMarkup('Publish or unpublish multiple content items at once. Maximum 50 items per operation.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'ids' => new InputDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Node IDs'),\n      description: new TranslatableMarkup('Array of node IDs to publish or unpublish.'),\n      required: TRUE,\n    ),\n    'publish' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Publish'),\n      description: new TranslatableMarkup('If true, publish the content. If false, unpublish. Default is true.'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'action' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Action Performed'),\n      description: new TranslatableMarkup(''),\n    ),\n    'total_requested' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Total Requested'),\n      description: new TranslatableMarkup(''),\n    ),\n    'processed_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Processed Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'unchanged_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Unchanged Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'error_count' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Error Count'),\n      description: new TranslatableMarkup(''),\n    ),\n    'processed' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Processed Items'),\n      description: new TranslatableMarkup(''),\n    ),\n    'unchanged' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Unchanged Items'),\n      description: new TranslatableMarkup(''),\n    ),\n    'errors' => new ContextDefinition(\n      data_type: 'list',\n      label: new TranslatableMarkup('Errors'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass PublishMultiple extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'batch';\n\n\n  protected BatchService $batchService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->batchService = $container->get('mcp_tools_batch.batch');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $ids = $input['ids'] ?? [];\n    $publish = $input['publish'] ?? TRUE;\n\n    if (empty($ids)) {\n      return ['success' => FALSE, 'error' => 'Node IDs array is required.'];\n    }\n\n    return $this->batchService->publishMultiple($ids, (bool) $publish);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_batch/src/Plugin/tool/Tool/PublishMultiple.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PublishMultiple", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class BootstrapFiveLayoutsUpdateBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\bootstrap_five_layouts\\Plugin\\BootstrapFiveLayouts;\n\nuse Drupal\\bootstrap_five_layouts\\BootstrapFiveLayout;\nuse Drupal\\bootstrap_five_layouts\\BootstrapFiveLayoutsManager;\nuse Drupal\\Core\\Plugin\\PluginBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n *\n */\nclass BootstrapFiveLayoutsUpdateBase extends PluginBase implements BootstrapFiveLayoutsUpdateInterface {\n\n  /**\n   * The path to the provider.\n   *\n   * @var string\n   */\n  protected $path;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, ?ContainerInterface $container = NULL) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    if (!isset($container)) {\n      $container = \\Drupal::getContainer();\n    }\n    $this->setContainer($container);\n\n    // Retrieve the path to provider.\n    $this->path = \\Drupal::service('extension.list.module')->getPath($this->pluginDefinition['provider']) ?: \\Drupal::service('extension.list.theme')->getPath($this->pluginDefinition['provider']);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    return new static($configuration, $plugin_id, $plugin_definition, $container);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPath() {\n    return $this->path;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function update(BootstrapFiveLayoutsManager $manager, array $data = [], $display_messages = TRUE) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processExistingLayout(BootstrapFiveLayout $layout, array $data = [], $display_messages = TRUE) {\n  }\n\n}\n", "metadata": {"source": "repos/bootstrap_five_layouts/src/Plugin/BootstrapFiveLayouts/BootstrapFiveLayoutsUpdateBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BootstrapFiveLayoutsUpdateBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: DecorativeConfigFormAlter\nSource file: <source_file>\nFile name hint: DecorativeConfigFormAlter.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\decorative_images\\Hook;\n\nuse Drupal\\field\\Entity\\FieldConfig;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Manage image field configuration.\n */\nclass DecorativeConfigFormAlter {\n\n  /**\n   * Alters the image field configuration form.\n   */\n  public static function alterForm(array &$form, FormStateInterface $form_state, string $form_id): void {\n    if ($form_id !== 'field_config_edit_form') {\n      return;\n    }\n\n    $field_config = $form_state->getFormObject()?->getEntity();\n    if (!$field_config instanceof FieldConfig || $field_config->getType() !== 'image') {\n      return;\n    }\n\n    // Add custom fields.\n    $form['settings']['decorative_enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Enable the <em>Decorative</em> field'),\n      '#description' => t('The image may have a decorative, presentation-only role.'),\n      '#default_value' => $field_config->getThirdPartySetting('decorative_images', 'decorative_enabled', 0),\n      '#weight' => $form['settings']['alt_field_required']['#weight'] + 1,\n    ];\n    $form['settings']['decorative_or_alternative_required'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Require <em>Alt</em> or <em>Decorative</em>'),\n      '#description' => t('If enabled, either alternative text or the decorative option is required. For use, <em>Decorative</em> must be enabled and <em>Alt</em> cannot be required.'),\n      '#default_value' => $field_config->getThirdPartySetting('decorative_images', 'decorative_or_alternative_required', 0),\n      '#weight' => $form['settings']['alt_field_required']['#weight'] + 2,\n    ];\n\n    // Attach entity builder.\n    $form['#entity_builders'][] = [self::class, 'saveEntitySettings'];\n  }\n\n  /**\n   * Saves third-party settings on the field entity.\n   */\n  public static function saveEntitySettings($entity_type, FieldConfig $entity, array &$form, FormStateInterface $form_state): void {\n    if ($entity->getType() === 'image') {\n      $entity->setThirdPartySetting(\n        'decorative_images',\n        'decorative_enabled',\n        $form_state->getValue(['settings', 'decorative_enabled']) ?? 0\n      );\n      $entity->setThirdPartySetting(\n        'decorative_images',\n        'decorative_or_alternative_required',\n        $form_state->getValue(['settings', 'decorative_or_alternative_required']) ?? 0\n      );\n    }\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\decorative_images\\Hook;\n\nuse Drupal\\field\\Entity\\FieldConfig;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Manage image field configuration.\n */\nclass DecorativeConfigFormAlter {\n\n  /**\n   * Alters the image field configuration form.\n   */\n  public static function alterForm(array &$form, FormStateInterface $form_state, string $form_id): void {\n    if ($form_id !== 'field_config_edit_form') {\n      return;\n    }\n\n    $field_config = $form_state->getFormObject()?->getEntity();\n    if (!$field_config instanceof FieldConfig || $field_config->getType() !== 'image') {\n      return;\n    }\n\n    // Add custom fields.\n    $form['settings']['decorative_enabled'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Enable the <em>Decorative</em> field'),\n      '#description' => t('The image may have a decorative, presentation-only role.'),\n      '#default_value' => $field_config->getThirdPartySetting('decorative_images', 'decorative_enabled', 0),\n      '#weight' => $form['settings']['alt_field_required']['#weight'] + 1,\n    ];\n    $form['settings']['decorative_or_alternative_required'] = [\n      '#type' => 'checkbox',\n      '#title' => t('Require <em>Alt</em> or <em>Decorative</em>'),\n      '#description' => t('If enabled, either alternative text or the decorative option is required. For use, <em>Decorative</em> must be enabled and <em>Alt</em> cannot be required.'),\n      '#default_value' => $field_config->getThirdPartySetting('decorative_images', 'decorative_or_alternative_required', 0),\n      '#weight' => $form['settings']['alt_field_required']['#weight'] + 2,\n    ];\n\n    // Attach entity builder.\n    $form['#entity_builders'][] = [self::class, 'saveEntitySettings'];\n  }\n\n  /**\n   * Saves third-party settings on the field entity.\n   */\n  public static function saveEntitySettings($entity_type, FieldConfig $entity, array &$form, FormStateInterface $form_state): void {\n    if ($entity->getType() === 'image') {\n      $entity->setThirdPartySetting(\n        'decorative_images',\n        'decorative_enabled',\n        $form_state->getValue(['settings', 'decorative_enabled']) ?? 0\n      );\n      $entity->setThirdPartySetting(\n        'decorative_images',\n        'decorative_or_alternative_required',\n        $form_state->getValue(['settings', 'decorative_or_alternative_required']) ?? 0\n      );\n    }\n  }\n\n}\n", "metadata": {"source": "repos/decorative_images/src/Hook/DecorativeConfigFormAlter.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DecorativeConfigFormAlter", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% block toolbar %}\n  {% set icon %}\n    {{ include('@webprofiler/Icon/time.svg') }}\n    <span class=\"sf-toolbar-value\" id=\"wp--frontend__toolbar\">0</span>\n  {% endset %}\n\n  {% set text %}\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'DNS lookup'|t }}</b>\n      <span id=\"wp--frontend__dns\"></span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'TCP handshake'|t }}</b>\n      <span id=\"wp--frontend__tcp\"></span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'TTFB' }}</b>\n      <span id=\"wp--frontend__ttfb\"></span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'Data download'|t }}</b>\n      <span id=\"wp--frontend__data\"></span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'DOM building'|t }}</b>\n      <span id=\"wp--frontend__dom\"></span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'CLS'|t }}</b>\n      <span id=\"wp--frontend__cls\">{{ 'n/a'|t }}</span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'FID'|t }}</b>\n      <span id=\"wp--frontend__fid\">{{ 'n/a'|t }}</span>\n    </div>\n    <div class=\"sf-toolbar-info-piece\">\n      <b>{{ 'LCP'|t }}</b>\n      <span id=\"wp--frontend__lcp\">{{ 'n/a'|t }}</span>\n    </div>\n  {% endset %}\n\n  <script>\n    const navigation = performance.getEntriesByType('navigation')[0],\n      dns = navigation.domainLookupEnd - navigation.domainLookupStart,\n      tcp = navigation.connectEnd - navigation.connectEnd,\n      ttfb = navigation.responseStart - navigation.connectEnd,\n      data = navigation.responseEnd - navigation.responseStart,\n      dom = navigation.loadEventStart - navigation.responseEnd;\n\n    document.getElementById('wp--frontend__toolbar').innerHTML = ttfb.toFixed(2) + ' ms';\n    document.getElementById('wp--frontend__dns').innerHTML = dns.toFixed(2) + ' ms';\n    document.getElementById('wp--frontend__tcp').innerHTML = tcp.toFixed(2) + ' ms';\n    document.getElementById('wp--frontend__ttfb').innerHTML = ttfb.toFixed(2) + ' ms';\n    document.getElementById('wp--frontend__data').innerHTML = data.toFixed(2) + ' ms';\n    document.getElementById('wp--frontend__dom').innerHTML = dom.toFixed(2) + ' ms';\n\n    const payload = JSON.stringify(\n      {\n        'navigation': navigation,\n        'timeOrigin': performance.timeOrigin\n      }\n    );\n\n    navigator.sendBeacon('{{ url(\"webprofiler.frontend.navigation\", {profile: token}) }}', payload);\n\n    const script = document.createElement('script');\n    script.src = 'https://unpkg.com/web-vitals@3/dist/web-vitals.attribution.iife.js';\n    script.onload = function () {\n      const queue = new Set();\n\n      function addToQueue(metric) {\n        switch(metric.name) {\n          case 'LCP':\n            document.getElementById('wp--frontend__lcp').innerHTML = metric.value.toFixed(2) + ' ms';\n            break;\n          case 'FID':\n            document.getElementById('wp--frontend__fid').innerHTML = metric.value.toFixed(2) + ' ms';\n            break;\n          case 'CLS':\n            document.getElementById('wp--frontend__cls').innerHTML = metric.value.toFixed(4);\n            break;\n        }\n        queue.add(metric);\n      }\n\n      function flushQueue() {\n        if (queue.size > 0) {\n          // Replace with whatever serialization method you prefer.\n          // Note: JSON.stringify will likely include more data than you need.\n          const body = JSON.stringify([...queue]);\n\n          navigator.sendBeacon('{{ url(\"webprofiler.frontend.cwv\", {profile: token}) }}', body)\n\n          queue.clear();\n        }\n      }\n\n      webVitals.onLCP(addToQueue);\n      webVitals.onFID(addToQueue);\n      webVitals.onCLS(addToQueue);\n\n      // Report all available metrics whenever the page is backgrounded or unloaded.\n      addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'hidden') {\n          flushQueue();\n        }\n      });\n\n      // NOTE: Safari does not reliably fire the `visibilitychange` event when the\n      // page is being unloaded. If Safari support is needed, you should also flush\n      // the queue in the `pagehide` event.\n      addEventListener('pagehide', flushQueue);\n    }\n    document.head.appendChild(script);\n  </script>\n\n  {{ include('@webprofiler/Profiler/toolbar_item.html.twig', { link: profiler_url }) }}\n{% endblock %}\n\n{% block panel %}\n  {{ collector.panel() }}\n{% endblock %}\n", "metadata": {"source": "repos/webprofiler/templates/Collector/frontend.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class FullDate in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a full date (CCYYMMDD).\n */\n#[ViewsArgument(\n  id: 'datetime_full_date',\n)]\nclass FullDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'Ymd';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/views/argument/FullDate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FullDate", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  jsonapi_security_tfa.enforcement_subscriber:\n    class: Drupal\\jsonapi_security_tfa\\EventSubscriber\\TfaEnforcementSubscriber\n    arguments:\n      - '@current_user'\n      - '@plugin.manager.tfa.validation'\n      - '@user.data'\n      - '@request_stack'\n      - '@jsonapi_security.helper'\n    tags:\n      - { name: event_subscriber }\n", "metadata": {"source": "repos/jsonapi_security/modules/jsonapi_security_tfa/jsonapi_security_tfa.services.yml", "type": "yaml_reference", "topic": "jsonapi security tfa.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  php:\n    # Specify the version of Drupal you wish to use for Tugboat below.\n    image: tugboatqa/drupal:11\n    default: true\n    http: false\n    depends: mysql\n    commands:\n      update: |\n        set -eux\n        # Check out a branch using the unique Tugboat ID for this repository, to\n        # ensure we don't clobber an existing branch.\n        git checkout -b $TUGBOAT_REPO_ID\n        # Composer is hungry. You need a Tugboat project with a pretty sizeable\n        # chunk of memory.\n        export COMPOSER_MEMORY_LIMIT=-1\n        # This is an environment variable we added in the Dockerfile that\n        # provides the path to Drupal composer root (not the web root).\n        cd $DRUPAL_COMPOSER_ROOT\n        # If you need to change the minimum stability due to downstream\n        # dependencies, you can modify 'stable' below to your needs:\n        # see https://getcomposer.org/doc/04-schema.md#minimum-stability\n        composer config minimum-stability stable\n        # We configure the Drupal project to use the checkout of the module as a\n        # Composer package repository.\n        composer config repositories.tugboat vcs $TUGBOAT_ROOT\n        # Now we can require this module, specifying the branch name we created\n        # above that uses the $TUGBOAT_REPO_ID environment variable.\n        composer require drupal/user_preference_login_redirect:dev-$TUGBOAT_REPO_ID\n\n        # Install Drupal on the site.\n        vendor/bin/drush \\\n          --yes \\\n          --db-url=mysql://tugboat:tugboat@mysql:3306/tugboat \\\n          --site-name=\"Live preview for ${TUGBOAT_PREVIEW_NAME}\" \\\n          --account-pass=admin \\\n          site:install standard\n        # Add tugboat URLs to the Drupal trusted host patterns.\n        echo \"\\$settings['trusted_host_patterns'] = ['\\.tugboatqa\\.com\\$'];\" >> $DOCROOT/sites/default/settings.php\n        # Set up the files directory permissions.\n        mkdir -p $DRUPAL_DOCROOT/sites/default/files\n        chgrp -R www-data $DRUPAL_DOCROOT/sites/default/files\n        chmod 2775 $DRUPAL_DOCROOT/sites/default/files\n        chmod -R g+w $DRUPAL_DOCROOT/sites/default/files\n        # Enable the module:\n        vendor/bin/drush --yes pm:enable user_preference_login_redirect\n        # Enable helpful core modules:\n        vendor/bin/drush --yes pm:enable navigation\n      build: |\n        set -eux\n        # Delete and re-check out this branch in case this is built from a Base Preview.\n        git branch -D $TUGBOAT_REPO_ID && git checkout -b $TUGBOAT_REPO_ID || true\n        export COMPOSER_MEMORY_LIMIT=-1\n        cd $DRUPAL_COMPOSER_ROOT\n        composer install --optimize-autoloader\n        # Update this module, including all dependencies.\n        composer update drupal/user_preference_login_redirect --with-all-dependencies\n        vendor/bin/drush --yes updb\n        vendor/bin/drush cache:rebuild\n  mysql:\n    image: tugboatqa/mariadb\n", "metadata": {"source": "repos/user_preference_login_redirect/.tugboat/config.yml", "type": "yaml_reference", "topic": "config"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: Runner\nSource file: <source_file>\nFile name hint: Runner.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\queue_manager\\Queue;\n\nuse Drupal\\Core\\Queue\\DelayableQueueInterface;\nuse Drupal\\Core\\Queue\\DelayedRequeueException;\nuse Drupal\\Core\\Queue\\QueueGarbageCollectionInterface;\nuse Drupal\\Core\\Queue\\QueueInterface;\nuse Drupal\\Core\\Queue\\QueueWorkerInterface;\nuse Drupal\\Core\\Queue\\RequeueException;\nuse Psr\\Clock\\ClockInterface;\n\n/**\n * {@selfdoc}\n *\n * @todo Create a test for this.\n */\nfinal readonly class Runner {\n\n  /**\n   * {@selfdoc}\n   */\n  public function __construct(\n    private ClockInterface $clock,\n  ) {}\n\n  /**\n   * Processes a queue.\n   *\n   * @param positive-int $time_limit\n   *   The maximum number of seconds allowed to run the queue.\n   *\n   * @throws \\Drupal\\Core\\Queue\\SuspendQueueException\n   *\n   * @see \\Drupal\\Core\\Cron::processQueue\n   */\n  public function run(QueueInterface $queue, QueueWorkerInterface $worker, int $time_limit): void {\n    $finish = $this->clock->now()->getTimestamp() + $time_limit;\n    while ($this->clock->now()->getTimestamp() < $finish) {\n      if (!$item = self::claimItem($queue)) {\n        return;\n      }\n      try {\n        $worker->processItem($item->data);\n        $queue->deleteItem($item);\n      }\n      catch (DelayedRequeueException $exception) {\n        // The worker requested the task not be immediately re-queued.\n        // - If the queue doesn't support ::delayItem(), we should leave the\n        // item's current expiry time alone.\n        // - If the queue does support ::delayItem(), we should allow the\n        // queue to update the item's expiry using the requested delay.\n        if ($queue instanceof DelayableQueueInterface) {\n          // This queue can handle a custom delay; use the duration provided\n          // by the exception.\n          $queue->delayItem($item, $exception->getDelay());\n        }\n      }\n      catch (RequeueException) {\n        // The worker requested the task be immediately requeued.\n        $queue->releaseItem($item);\n      }\n      // Do not catch SuspendQueueException. It's up to consumer to hande it.\n    }\n  }\n\n  /**\n   * @return object{data: mixed, item_id: string, created: numeric-string}|false\n   */\n  private static function claimItem(QueueInterface $queue): false|object {\n    if ($item = $queue->claimItem()) {\n      // @phpstan-ignore return.type\n      return $item;\n    }\n\n    if (!$queue instanceof QueueGarbageCollectionInterface) {\n      return FALSE;\n    }\n\n    if ($queue->numberOfItems() === 0) {\n      return FALSE;\n    }\n\n    // Clean queue garbage and try to claim item again.\n    $queue->garbageCollection();\n    if ($item = $queue->claimItem()) {\n      // @phpstan-ignore return.type\n      return $item;\n    }\n\n    return FALSE;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\queue_manager\\Queue;\n\nuse Drupal\\Core\\Queue\\DelayableQueueInterface;\nuse Drupal\\Core\\Queue\\DelayedRequeueException;\nuse Drupal\\Core\\Queue\\QueueGarbageCollectionInterface;\nuse Drupal\\Core\\Queue\\QueueInterface;\nuse Drupal\\Core\\Queue\\QueueWorkerInterface;\nuse Drupal\\Core\\Queue\\RequeueException;\nuse Psr\\Clock\\ClockInterface;\n\n/**\n * {@selfdoc}\n *\n * @todo Create a test for this.\n */\nfinal readonly class Runner {\n\n  /**\n   * {@selfdoc}\n   */\n  public function __construct(\n    private ClockInterface $clock,\n  ) {}\n\n  /**\n   * Processes a queue.\n   *\n   * @param positive-int $time_limit\n   *   The maximum number of seconds allowed to run the queue.\n   *\n   * @throws \\Drupal\\Core\\Queue\\SuspendQueueException\n   *\n   * @see \\Drupal\\Core\\Cron::processQueue\n   */\n  public function run(QueueInterface $queue, QueueWorkerInterface $worker, int $time_limit): void {\n    $finish = $this->clock->now()->getTimestamp() + $time_limit;\n    while ($this->clock->now()->getTimestamp() < $finish) {\n      if (!$item = self::claimItem($queue)) {\n        return;\n      }\n      try {\n        $worker->processItem($item->data);\n        $queue->deleteItem($item);\n      }\n      catch (DelayedRequeueException $exception) {\n        // The worker requested the task not be immediately re-queued.\n        // - If the queue doesn't support ::delayItem(), we should leave the\n        // item's current expiry time alone.\n        // - If the queue does support ::delayItem(), we should allow the\n        // queue to update the item's expiry using the requested delay.\n        if ($queue instanceof DelayableQueueInterface) {\n          // This queue can handle a custom delay; use the duration provided\n          // by the exception.\n          $queue->delayItem($item, $exception->getDelay());\n        }\n      }\n      catch (RequeueException) {\n        // The worker requested the task be immediately requeued.\n        $queue->releaseItem($item);\n      }\n      // Do not catch SuspendQueueException. It's up to consumer to hande it.\n    }\n  }\n\n  /**\n   * @return object{data: mixed, item_id: string, created: numeric-string}|false\n   */\n  private static function claimItem(QueueInterface $queue): false|object {\n    if ($item = $queue->claimItem()) {\n      // @phpstan-ignore return.type\n      return $item;\n    }\n\n    if (!$queue instanceof QueueGarbageCollectionInterface) {\n      return FALSE;\n    }\n\n    if ($queue->numberOfItems() === 0) {\n      return FALSE;\n    }\n\n    // Clean queue garbage and try to claim item again.\n    $queue->garbageCollection();\n    if ($item = $queue->claimItem()) {\n      // @phpstan-ignore return.type\n      return $item;\n    }\n\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/queue_manager/src/Queue/Runner.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Runner", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DayDate\nSource file: <source_file>\nFile name hint: DayDate.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a day.\n */\n[ViewsArgument(\n  id: 'datetime_day',\n)]\nclass DayDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'd';\n\n}", "output": "<?php\n\nnamespace Drupal\\datetime\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Argument handler for a day.\n */\n#[ViewsArgument(\n  id: 'datetime_day',\n)]\nclass DayDate extends Date {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $argFormat = 'd';\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/datetime/src/Plugin/views/argument/DayDate.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DayDate", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: MediaTypeInterface.php\nTarget symbol: interface defining\nNamespace: Drupal\\media\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for defining.\n- Include required imports:\n  - Drupal\\Core\\Config\\Entity\\ConfigEntityInterface\n  - Drupal\\Core\\Entity\\EntityDescriptionInterface\n  - Drupal\\Core\\Entity\\RevisionableEntityBundleInterface\n- Ensure these methods exist where relevant:\n  - getFieldMap()\n  - getSource()\n  - setFieldMap()\n  - setNewRevision()\n  - setQueueThumbnailDownloadsStatus()\n  - thumbnailDownloadsAreQueued()", "output": "<?php\n\nnamespace Drupal\\media;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Entity\\EntityDescriptionInterface;\nuse Drupal\\Core\\Entity\\RevisionableEntityBundleInterface;\n\n/**\n * Provides an interface defining a media type entity.\n *\n * Media types are bundles for media items. They are used to group media with\n * the same semantics. Media types are not about where media comes from. They\n * are about the semantics that media has in the context of a given Drupal site.\n *\n * Media sources, on the other hand, are aware where media comes from and know\n * how to represent and handle it in Drupal's context. They are aware of the low\n * level details, while the media types don't care about them at all. That said,\n * media types can not exist without media sources.\n *\n * Consider the following examples:\n * - oEmbed media source which can represent any oEmbed resource. Media types\n *   that could be used with this source are \"Videos\", \"Charts\", \"Music\", etc.\n *   All of them are retrieved using the same protocol, but they represent very\n *   different things.\n * - Media sources that represent files could be used with media types like\n *   \"Invoices\", \"Subtitles\", \"Meeting notes\", etc. They are all files stored on\n *   some kind of storage, but their meaning and uses in a Drupal site are\n *   different.\n *\n * @see \\Drupal\\media\\MediaSourceInterface\n */\ninterface MediaTypeInterface extends ConfigEntityInterface, EntityDescriptionInterface, RevisionableEntityBundleInterface {\n\n  /**\n   * Returns whether thumbnail downloads are queued.\n   *\n   * When using remote media sources, the thumbnail generation could be a slow\n   * process. Using a queue allows for this process to be handled in the\n   * background.\n   *\n   * @return bool\n   *   TRUE if thumbnails are queued for download later, FALSE if they should be\n   *   downloaded now.\n   */\n  public function thumbnailDownloadsAreQueued();\n\n  /**\n   * Sets a flag to indicate that thumbnails should be downloaded via a queue.\n   *\n   * @param bool $queue_thumbnail_downloads\n   *   The queue downloads flag.\n   *\n   * @return $this\n   */\n  public function setQueueThumbnailDownloadsStatus($queue_thumbnail_downloads);\n\n  /**\n   * Returns the media source plugin.\n   *\n   * @return \\Drupal\\media\\MediaSourceInterface\n   *   The media source.\n   */\n  public function getSource();\n\n  /**\n   * Sets whether new revisions should be created by default.\n   *\n   * @param bool $new_revision\n   *   TRUE if media items of this type should create new revisions by default.\n   *\n   * @return $this\n   */\n  public function setNewRevision($new_revision);\n\n  /**\n   * Returns the metadata field map.\n   *\n   * Field mapping allows site builders to map media item-related metadata to\n   * entity fields. This information will be used when saving a given media item\n   * and if metadata values will be available they are going to be automatically\n   * copied to the corresponding entity fields.\n   *\n   * @return array\n   *   Field mapping array provided by media source with metadata attribute\n   *   names as keys and entity field names as values.\n   */\n  public function getFieldMap();\n\n  /**\n   * Sets the metadata field map.\n   *\n   * @param array $map\n   *   Field mapping array with metadata attribute names as keys and entity\n   *   field names as values.\n   *\n   * @return $this\n   */\n  public function setFieldMap(array $map);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/MediaTypeInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MediaTypeInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: LapostaSubscribeHelpController\nSource file: <source_file>\nFile name hint: LapostaSubscribeHelpController.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\laposta_subscribe\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Url;\nuse Drupal\\laposta_subscribe\\Service\\LapostaSubscribeApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\nclass LapostaSubscribeHelpController extends ControllerBase\n{\n  protected $lapostaSubscribeApiService;\n\n  function __construct(LapostaSubscribeApiService $laposta_subscribe_api_service)\n  {\n    $this->lapostaSubscribeApiService = $laposta_subscribe_api_service;\n  }\n\n  public static function create(ContainerInterface $container)\n  {\n    return new static(\n      $container->get('laposta_subscribe.api_service')\n    );\n  }\n\n  public function help()\n  {\n    $help_email = 'helpdesk@laposta.nl';\n    $author_email = 'fred@miix.dev';\n\n    // Get API info\n    $api_info = $this->lapostaSubscribeApiService->getApiInfo();\n\n    $build = [\n      '#theme' => 'laposta_subscribe_help',\n      '#content' => [\n        'general_setup' => [\n          'title' => $this->t('General Setup'),\n          'items' => [\n            $this->t('Enter your Laposta API key in the API Key Settings.'),\n            $this->t('Select a list and fetch available fields in the List and Fields Settings.'),\n            $this->t('Configure form display settings in the Form Settings.'),\n          ],\n        ],\n        'field_configuration' => [\n          'title' => $this->t('Field Configuration'),\n          'items' => [\n            $this->t('Enable or disable fields as needed.'),\n            $this->t('Rearrange fields by dragging them in the field table.'),\n            $this->t('Single select fields can be displayed as dropdown or radio buttons (Laposta setting).'),\n          ],\n        ],\n        'form_customization' => [\n          'title' => $this->t('Form Customization'),\n          'items' => [\n            $this->t('Override the list name for display purposes.'),\n            $this->t('Show or hide list remarks.'),\n            $this->t('Customize the submit button text.'),\n          ],\n        ],\n        'preview' => [\n          'title' => $this->t('Preview'),\n          'content' => $this->t('Use the Preview tab to preview your form and ensure it\\'s working correctly.'),\n        ],\n        'adding_form' => [\n          'title' => $this->t('Adding the Subscription Form to Your Website'),\n          'items' => [\n            $this->t('Go to the Structure > Block layout page (@url).', ['@url' => Url::fromRoute('block.admin_display')->toString()]),\n            $this->t('Click \"Place block\" in the region where you want the form to appear.'),\n            $this->t('Find \"Laposta Subscribe Form\" in the list and click \"Place block\".'),\n            $this->t('Configure the block settings as needed (title, visibility rules, etc.).'),\n            $this->t('Click \"Save block\".'),\n            $this->t('The subscription form will now appear in the selected region of your website.'),\n          ],\n        ],\n        'troubleshooting' => [\n          'title' => $this->t('Troubleshooting'),\n          'items' => [\n            $this->t('Clear cache after making configuration changes.'),\n            $this->t('Check Drupal logs for any error messages.'),\n            $this->t('Ensure your Laposta API key is valid and has necessary permissions.'),\n          ],\n        ],\n        'api_status' => [\n          'title' => $this->t('API Connection Status'),\n          'status' => $api_info['status'],\n          'message' => $api_info['message'],\n          'account_name' => $api_info['account_name'] ?? $this->t('Not available'),\n          'account_number' => $api_info['account_number'] ?? $this->t('Not available'),\n        ],\n        'further_assistance' => [\n          'title' => $this->t('Need Further Assistance?'),\n          'content' => $this->t('If you need additional help or have any questions, please don\\'t hesitate to contact the Laposta support team at:'),\n          'email' => $help_email,\n        ],\n        'about_author' => [\n          'title' => $this->t('About the Author'),\n          'content' => $this->t('This module was created by Fred Klopper. For module-specific inquiries or support, you can contact the author at:'),\n          'email' => $author_email,\n        ],\n      ],\n    ];\n\n    $build['#attached']['library'][] = 'laposta_subscribe/admin_styles';\n    $build['#attached']['library'][] = 'laposta_subscribe/copy_account_number';\n\n    return $build;\n  }\n}", "output": "<?php\n\nnamespace Drupal\\laposta_subscribe\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Url;\nuse Drupal\\laposta_subscribe\\Service\\LapostaSubscribeApiService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\nclass LapostaSubscribeHelpController extends ControllerBase\n{\n  protected $lapostaSubscribeApiService;\n\n  public function __construct(LapostaSubscribeApiService $laposta_subscribe_api_service)\n  {\n    $this->lapostaSubscribeApiService = $laposta_subscribe_api_service;\n  }\n\n  public static function create(ContainerInterface $container)\n  {\n    return new static(\n      $container->get('laposta_subscribe.api_service')\n    );\n  }\n\n  public function help()\n  {\n    $help_email = 'helpdesk@laposta.nl';\n    $author_email = 'fred@miix.dev';\n\n    // Get API info\n    $api_info = $this->lapostaSubscribeApiService->getApiInfo();\n\n    $build = [\n      '#theme' => 'laposta_subscribe_help',\n      '#content' => [\n        'general_setup' => [\n          'title' => $this->t('General Setup'),\n          'items' => [\n            $this->t('Enter your Laposta API key in the API Key Settings.'),\n            $this->t('Select a list and fetch available fields in the List and Fields Settings.'),\n            $this->t('Configure form display settings in the Form Settings.'),\n          ],\n        ],\n        'field_configuration' => [\n          'title' => $this->t('Field Configuration'),\n          'items' => [\n            $this->t('Enable or disable fields as needed.'),\n            $this->t('Rearrange fields by dragging them in the field table.'),\n            $this->t('Single select fields can be displayed as dropdown or radio buttons (Laposta setting).'),\n          ],\n        ],\n        'form_customization' => [\n          'title' => $this->t('Form Customization'),\n          'items' => [\n            $this->t('Override the list name for display purposes.'),\n            $this->t('Show or hide list remarks.'),\n            $this->t('Customize the submit button text.'),\n          ],\n        ],\n        'preview' => [\n          'title' => $this->t('Preview'),\n          'content' => $this->t('Use the Preview tab to preview your form and ensure it\\'s working correctly.'),\n        ],\n        'adding_form' => [\n          'title' => $this->t('Adding the Subscription Form to Your Website'),\n          'items' => [\n            $this->t('Go to the Structure > Block layout page (@url).', ['@url' => Url::fromRoute('block.admin_display')->toString()]),\n            $this->t('Click \"Place block\" in the region where you want the form to appear.'),\n            $this->t('Find \"Laposta Subscribe Form\" in the list and click \"Place block\".'),\n            $this->t('Configure the block settings as needed (title, visibility rules, etc.).'),\n            $this->t('Click \"Save block\".'),\n            $this->t('The subscription form will now appear in the selected region of your website.'),\n          ],\n        ],\n        'troubleshooting' => [\n          'title' => $this->t('Troubleshooting'),\n          'items' => [\n            $this->t('Clear cache after making configuration changes.'),\n            $this->t('Check Drupal logs for any error messages.'),\n            $this->t('Ensure your Laposta API key is valid and has necessary permissions.'),\n          ],\n        ],\n        'api_status' => [\n          'title' => $this->t('API Connection Status'),\n          'status' => $api_info['status'],\n          'message' => $api_info['message'],\n          'account_name' => $api_info['account_name'] ?? $this->t('Not available'),\n          'account_number' => $api_info['account_number'] ?? $this->t('Not available'),\n        ],\n        'further_assistance' => [\n          'title' => $this->t('Need Further Assistance?'),\n          'content' => $this->t('If you need additional help or have any questions, please don\\'t hesitate to contact the Laposta support team at:'),\n          'email' => $help_email,\n        ],\n        'about_author' => [\n          'title' => $this->t('About the Author'),\n          'content' => $this->t('This module was created by Fred Klopper. For module-specific inquiries or support, you can contact the author at:'),\n          'email' => $author_email,\n        ],\n      ],\n    ];\n\n    $build['#attached']['library'][] = 'laposta_subscribe/admin_styles';\n    $build['#attached']['library'][] = 'laposta_subscribe/copy_account_number';\n\n    return $build;\n  }\n}\n", "metadata": {"source": "repos/laposta_subscribe/src/Controller/LapostaSubscribeHelpController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LapostaSubscribeHelpController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EntityDelete.php\nTarget symbol: class EntityDelete\nNamespace: Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for EntityDelete.\n- Include required imports:\n  - Drupal\\Core\\Entity\\EntityInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType\n  - Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface\n  - Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase\n- Ensure these methods exist where relevant:\n  - extractTriggerData()\n  - getParameterSchema()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventType;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\flowdrop_trigger\\Attribute\\FlowDropEventType;\nuse Drupal\\flowdrop_trigger\\FlowDropEventTypeInterface;\nuse Drupal\\flowdrop_trigger\\Plugin\\FlowDropEventTypeBase;\n\n/**\n * Event type for entity delete events.\n *\n * Triggers when an entity is deleted from the database.\n * This event fires after the entity has been successfully deleted.\n * The entity data is captured before deletion for use in workflows.\n */\n#[FlowDropEventType(\n  id: \"entity.delete\",\n  label: new TranslatableMarkup(\"Entity Delete\"),\n  description: new TranslatableMarkup(\"Triggered when an entity is deleted\"),\n  category: \"entity\",\n  defaultOrchestrator: \"flowdrop_runtime:asynchronous\",\n  defaultExecutionMode: \"async\",\n  supportedEntityTypes: [],\n)]\nclass EntityDelete extends FlowDropEventTypeBase implements FlowDropEventTypeInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array {\n    if ($entity === NULL) {\n      throw new \\InvalidArgumentException(\"Entity cannot be NULL for entity delete events.\");\n    }\n\n    $data = $this->getBaseTriggerData($entity);\n\n    // Add delete-specific data.\n    $data[\"is_new\"] = FALSE;\n    $data[\"operation\"] = \"delete\";\n    $data[\"deleted\"] = TRUE;\n\n    return $data;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getParameterSchema(): array {\n    $baseSchema = parent::getParameterSchema();\n\n    // Entity delete doesn't need additional configuration beyond base.\n    return $baseSchema;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/Plugin/FlowDropEventType/EntityDelete.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityDelete", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: VisibilityConditionsPanel\nSource file: <source_file>\nFile name hint: VisibilityConditionsPanel.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\Condition\\ConditionPluginCollection;\nuse Drupal\\Core\\Executable\\ExecutableManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Form\\SubformState;\nuse Drupal\\Core\\Plugin\\Context\\ContextRepositoryInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\IslandPluginBase;\nuse Drupal\\display_builder\\IslandType;\nuse Drupal\\display_builder\\IslandWithFormInterface;\nuse Drupal\\display_builder\\IslandWithFormTrait;\nuse Drupal\\display_builder\\RenderableAltererInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Visibility conditions island plugin implementation.\n */\n#[Island(\n  id: 'visibility_conditions',\n  label: new TranslatableMarkup('Visibility'),\n  description: new TranslatableMarkup('Set visibility conditions for the active component or block.'),\n  type: IslandType::Contextual,\n  theme: 'admin',\n)]\nclass VisibilityConditionsPanel extends IslandPluginBase implements IslandWithFormInterface, RenderableAltererInterface {\n\n  use IslandWithFormTrait;\n\n  /**\n   * The condition manager.\n   */\n  protected ExecutableManagerInterface $conditionManager;\n\n  /**\n   * The context repository.\n   */\n  protected ContextRepositoryInterface $contextRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->conditionManager = $container->get('plugin.manager.condition');\n    $instance->contextRepository = $container->get('context.repository');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array &$form, FormStateInterface $form_state): void {\n    $form['#tree'] = TRUE;\n\n    $data = $form_state->getBuildInfo()['args'][0];\n    $instance = $data['instance'] ?? [];\n    $conditions = $this->conditionManager->getDefinitions();\n    unset($conditions['response_status']);\n\n    // Gather all available contexts.\n    $gathered_contexts = $form_state->getTemporaryValue('gathered_contexts') ?? [];\n    $form_state->setTemporaryValue('gathered_contexts', $gathered_contexts + $this->contextRepository->getAvailableContexts());\n\n    foreach ($conditions as $condition_id => $definition) {\n      if ($condition_id === 'current_theme') {\n        continue;\n      }\n\n      if (\\str_starts_with($condition_id, 'entity_bundle:')) {\n        continue;\n      }\n\n      /** @var \\Drupal\\Core\\Condition\\ConditionInterface $condition */\n      $condition = $this->conditionManager->createInstance($condition_id, $instance[$condition_id] ?? []);\n      $form_state->set(['conditions', $condition_id], $condition);\n      $condition_form = $condition->buildConfigurationForm([], $form_state);\n      $condition_form['#type'] = 'details';\n      $condition_form['#title'] = (\\is_array($definition) && isset($definition['label'])) ? $definition['label'] : '';\n      $form[$condition_id] = $condition_form;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state): void {\n    // Remove configuration if it matches the defaults.\n    $visibility = new ConditionPluginCollection($this->conditionManager);\n    $conditions = $form_state->get('conditions');\n\n    foreach ($conditions as $condition_id => $condition) {\n      $condition->submitConfigurationForm($form[$condition_id], SubformState::createForSubform($form[$condition_id], $form, $form_state));\n      $visibility->set($condition_id, $condition);\n      $form_state->unsetValue($condition_id);\n    }\n\n    foreach ($visibility->getConfiguration() as $condition_id => $configuration) {\n      $form_state->setValue($condition_id, $configuration);\n    }\n\n    // Those two lines are necessary to prevent the form from being rebuilt.\n    // if rebuilt, the form state values will have both the computed ones\n    // and the raw ones (wrapper key and values).\n    $form_state->setRebuild(FALSE);\n    $form_state->setExecuted();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alterElement(array $element, array $data = []): array {\n    $available_contexts = $this->contextRepository->getAvailableContexts();\n", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder\\Plugin\\display_builder\\Island;\n\nuse Drupal\\Core\\Condition\\ConditionPluginCollection;\nuse Drupal\\Core\\Executable\\ExecutableManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Form\\SubformState;\nuse Drupal\\Core\\Plugin\\Context\\ContextRepositoryInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\display_builder\\Attribute\\Island;\nuse Drupal\\display_builder\\IslandPluginBase;\nuse Drupal\\display_builder\\IslandType;\nuse Drupal\\display_builder\\IslandWithFormInterface;\nuse Drupal\\display_builder\\IslandWithFormTrait;\nuse Drupal\\display_builder\\RenderableAltererInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Visibility conditions island plugin implementation.\n */\n#[Island(\n  id: 'visibility_conditions',\n  label: new TranslatableMarkup('Visibility'),\n  description: new TranslatableMarkup('Set visibility conditions for the active component or block.'),\n  type: IslandType::Contextual,\n  theme: 'admin',\n)]\nclass VisibilityConditionsPanel extends IslandPluginBase implements IslandWithFormInterface, RenderableAltererInterface {\n\n  use IslandWithFormTrait;\n\n  /**\n   * The condition manager.\n   */\n  protected ExecutableManagerInterface $conditionManager;\n\n  /**\n   * The context repository.\n   */\n  protected ContextRepositoryInterface $contextRepository;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->conditionManager = $container->get('plugin.manager.condition');\n    $instance->contextRepository = $container->get('context.repository');\n\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array &$form, FormStateInterface $form_state): void {\n    $form['#tree'] = TRUE;\n\n    $data = $form_state->getBuildInfo()['args'][0];\n    $instance = $data['instance'] ?? [];\n    $conditions = $this->conditionManager->getDefinitions();\n    unset($conditions['response_status']);\n\n    // Gather all available contexts.\n    $gathered_contexts = $form_state->getTemporaryValue('gathered_contexts') ?? [];\n    $form_state->setTemporaryValue('gathered_contexts', $gathered_contexts + $this->contextRepository->getAvailableContexts());\n\n    foreach ($conditions as $condition_id => $definition) {\n      if ($condition_id === 'current_theme') {\n        continue;\n      }\n\n      if (\\str_starts_with($condition_id, 'entity_bundle:')) {\n        continue;\n      }\n\n      /** @var \\Drupal\\Core\\Condition\\ConditionInterface $condition */\n      $condition = $this->conditionManager->createInstance($condition_id, $instance[$condition_id] ?? []);\n      $form_state->set(['conditions', $condition_id], $condition);\n      $condition_form = $condition->buildConfigurationForm([], $form_state);\n      $condition_form['#type'] = 'details';\n      $condition_form['#title'] = (\\is_array($definition) && isset($definition['label'])) ? $definition['label'] : '';\n      $form[$condition_id] = $condition_form;\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state): void {\n    // Remove configuration if it matches the defaults.\n    $visibility = new ConditionPluginCollection($this->conditionManager);\n    $conditions = $form_state->get('conditions');\n\n    foreach ($conditions as $condition_id => $condition) {\n      $condition->submitConfigurationForm($form[$condition_id], SubformState::createForSubform($form[$condition_id], $form, $form_state));\n      $visibility->set($condition_id, $condition);\n      $form_state->unsetValue($condition_id);\n    }\n\n    foreach ($visibility->getConfiguration() as $condition_id => $configuration) {\n      $form_state->setValue($condition_id, $configuration);\n    }\n\n    // Those two lines are necessary to prevent the form from being rebuilt.\n    // if rebuilt, the form state values will have both the computed ones\n    // and the raw ones (wrapper key and values).\n    $form_state->setRebuild(FALSE);\n    $form_state->setExecuted();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function alterElement(array $element, array $data = []): array {\n    $available_contexts = $this->contextRepository->getAvailableContexts();\n\n    foreach (\\array_keys($data) as $condition_id) {\n      /** @var \\Drupal\\Component\\Plugin\\ContextAwarePluginInterface $condition */\n      $condition = $this->conditionManager->createInstance($condition_id, $data[$condition_id] ?? []);\n\n      // Apply context mapping.\n      $context_mapping = $condition->getContextMapping();\n\n      foreach ($context_mapping as $key => $value) {\n        if (isset($available_contexts[$value])) {\n          $condition->setContextValue($key, $available_contexts[$value]->getContextValue());\n        }\n      }\n\n      /** @var \\Drupal\\Core\\Executable\\ExecutableInterface $condition */\n      if (!$this->conditionManager->execute($condition)) {\n        return [];\n      }\n    }\n\n    return $element;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onAttachToRoot(string $builder_id, string $instance_id): array {\n    return $this->reloadWithInstanceData($builder_id, $instance_id);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onAttachToSlot(string $builder_id, string $instance_id, string $parent_id): array {\n    return $this->reloadWithInstanceData($builder_id, $instance_id);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onActive(string $builder_id, array $data): array {\n    return $this->reloadWithLocalData($builder_id, $data);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function onDelete(string $builder_id, string $parent_id): array {\n    return $this->reloadWithLocalData($builder_id, []);\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/Plugin/display_builder/Island/VisibilityConditionsPanel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "VisibilityConditionsPanel", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class ImageStyleRoutes in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\image\\Routing;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\StreamWrapper\\StreamWrapperManagerInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * Defines a route subscriber to register a URL for serving image styles.\n */\nclass ImageStyleRoutes implements ContainerInjectionInterface {\n\n  /**\n   * The stream wrapper manager service.\n   *\n   * @var \\Drupal\\Core\\StreamWrapper\\StreamWrapperManagerInterface\n   */\n  protected $streamWrapperManager;\n\n  /**\n   * Constructs a new ImageStyleRoutes object.\n   *\n   * @param \\Drupal\\Core\\StreamWrapper\\StreamWrapperManagerInterface $stream_wrapper_manager\n   *   The stream wrapper manager service.\n   */\n  public function __construct(StreamWrapperManagerInterface $stream_wrapper_manager) {\n    $this->streamWrapperManager = $stream_wrapper_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('stream_wrapper_manager')\n    );\n  }\n\n  /**\n   * Returns an array of route objects.\n   *\n   * @return \\Symfony\\Component\\Routing\\Route[]\n   *   An array of route objects.\n   */\n  public function routes() {\n    $routes = [];\n    // Generate image derivatives of publicly available files. If clean URLs are\n    // disabled image derivatives will always be served through the menu system.\n    // If clean URLs are enabled and the image derivative already exists, PHP\n    // will be bypassed.\n    $directory_path = $this->streamWrapperManager->getViaScheme('public')->getDirectoryPath();\n\n    $routes['image.style_public'] = new Route(\n      '/' . $directory_path . '/styles/{image_style}/{scheme}',\n      [\n        '_controller' => 'Drupal\\image\\Controller\\ImageStyleDownloadController::deliver',\n        'required_derivative_scheme' => 'public',\n      ],\n      [\n        '_access' => 'TRUE',\n      ]\n    );\n    return $routes;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/image/src/Routing/ImageStyleRoutes.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageStyleRoutes", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: StoreToEntity.php\nTarget symbol: class for\nNamespace: Drupal\\api_normalization\\Plugin\\Action\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Action\\Attribute\\Action\n  - Drupal\\Core\\Entity\\EntityTypeManagerInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\eca\\Attribute\\EcaAction\n  - Drupal\\eca\\Plugin\\Action\\ConfigurableActionBase\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - buildConfigurationForm()\n  - create()\n  - defaultConfiguration()\n  - execute()\n  - externallyAvailable()\n  - getEntityTypeOptions()\n  - submitConfigurationForm()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\Action;\n\nuse Drupal\\Core\\Action\\Attribute\\Action;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\eca\\Attribute\\EcaAction;\nuse Drupal\\eca\\Plugin\\Action\\ConfigurableActionBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Stores normalized API data to a Drupal entity.\n */\n#[Action(\n  id: 'api_normalization_store_to_entity',\n  label: new TranslatableMarkup('Store to Entity'),\n  type: 'system',\n)]\n#[EcaAction(\n  description: new TranslatableMarkup('Store normalized API data to a Drupal entity with field mapping.'),\n  version_introduced: '1.0.0',\n)]\n/**\n * Entity class for StoreToEntity.\n *\n * @ingroup api_normalization\n */\nclass StoreToEntity extends ConfigurableActionBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function externallyAvailable(): bool {\n    return TRUE;\n  }\n\n  /**\n   * The entity type manager.\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): static {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->entityTypeManager = $container->get('entity_type.manager');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute(): void {\n    $data = $this->getTokenValue('normalized_data', []);\n    $entity_type = $this->configuration['entity_type'];\n    $bundle = $this->configuration['bundle'];\n    $field_mapping = $this->configuration['field_mapping'] ?? [];\n\n    $storage = $this->entityTypeManager->getStorage($entity_type);\n    $values = ['type' => $bundle];\n\n    foreach ($field_mapping as $api_field => $entity_field) {\n      if (isset($data[$api_field])) {\n        $values[$entity_field] = $data[$api_field];\n      }\n    }\n\n    $entity = $storage->create($values);\n    $entity->save();\n\n    $this->tokenService->addTokenData('created_entity', $entity);\n    $this->tokenService->addTokenData('entity_id', $entity->id());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration(): array {\n    return [\n      'entity_type' => 'node',\n      'bundle' => '',\n      'field_mapping' => [],\n    ] + parent::defaultConfiguration();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state): array {\n    $form['entity_type'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Entity Type'),\n      '#options' => $this->getEntityTypeOptions(),\n      '#default_value' => $this->configuration['entity_type'],\n      '#required' => TRUE,\n    ];\n\n    $form['bundle'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Bundle'),\n      '#default_value' => $this->configuration['bundle'],\n      '#required' => TRUE,\n    ];\n\n    $form['field_mapping'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Field Mapping (JSON)'),\n      '#default_value' => json_encode($this->configuration['field_mapping'], JSON_PRETTY_PRINT),\n      '#description' => $this->t('JSON object mapping API fields to entity fields. Example: {\"api_title\": \"title\", \"api_body\": \"body\"}'),\n    ];\n\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state): void {\n    $this->configuration['entity_type'] = $form_state->getValue('entity_type');\n    $this->configuration['bundle'] = $form_state->getValue('bundle');\n    $mapping_json = $form_state->getValue('field_mapping');\n    $decoded = json_decode($mapping_json, TRUE);\n    $this->configuration['field_mapping'] = (json_last_error() === JSON_ERROR_NONE) ? $decoded : [];\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * Gets entity type options.\n   */\n  protected function getEntityTypeOptions(): array {\n    $options = [];\n    foreach ($this->entityTypeManager->getDefinitions() as $id => $definition) {\n      if ($definition->hasKey('bundle')) {\n        $options[$id] = $definition->getLabel();\n      }\n    }\n    return $options;\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/Action/StoreToEntity.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StoreToEntity", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# cspell:ignore objectid\nid: d7_field_instance_label_description_translation\nlabel: Field label and description translation\nmigration_tags:\n  - Drupal 7\n  - Configuration\n  - Multilingual\nclass: Drupal\\migrate_drupal\\Plugin\\migrate\\FieldMigration\nfield_plugin_method: alterFieldInstanceMigration\nsource:\n  plugin: d7_field_instance_label_description_translation\nprocess:\n  langcode:\n    plugin: skip_on_empty\n    source: language\n    method: row\n  translation:\n    plugin: skip_on_empty\n    source: translation\n    method: row\n  entity_type_exists:\n    plugin: skip_on_empty\n    source: entity_type\n    method: row\n  objectid_exists:\n    plugin: skip_on_empty\n    source: objectid\n    method: row\n  type_exists:\n    plugin: skip_on_empty\n    source: type\n    method: row\n  exists:\n    -\n      plugin: migration_lookup\n      migration: d7_field_instance\n      source:\n        - entity_type\n        - objectid\n        - type\n    -\n      plugin: skip_on_empty\n      method: row\n  bundle: objectid\n  property:\n    plugin: static_map\n    source: property\n    bypass: true\n    map:\n      label: label\n      description: description\n      title_value: label\n  entity_type: entity_type\n  field_name: type\ndestination:\n  plugin: entity:field_config\n  translations: true\nmigration_dependencies:\n  required:\n    - language\n    - d7_field_instance\n  optional:\n    - d7_node_type\n    - d7_comment_type\n    - d7_taxonomy_vocabulary\n", "metadata": {"source": "repos/drupal_core/core/modules/config_translation/migrations/d7_field_instance_label_description_translation.yml", "type": "yaml_reference", "topic": "d7 field instance label description translation"}}
{"instruction": "Show me the implementation of the class PluginFormFactory in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Plugin;\n\nuse Drupal\\Component\\Plugin\\Exception\\InvalidPluginDefinitionException;\nuse Drupal\\Component\\Plugin\\PluginAwareInterface;\nuse Drupal\\Core\\DependencyInjection\\ClassResolverInterface;\n\n/**\n * Provides form discovery capabilities for plugins.\n */\nclass PluginFormFactory implements PluginFormFactoryInterface {\n\n  /**\n   * The class resolver.\n   *\n   * @var \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface\n   */\n  protected $classResolver;\n\n  /**\n   * PluginFormFactory constructor.\n   *\n   * @param \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface $class_resolver\n   *   The class resolver.\n   */\n  public function __construct(ClassResolverInterface $class_resolver) {\n    $this->classResolver = $class_resolver;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createInstance(PluginWithFormsInterface $plugin, $operation, $fallback_operation = NULL) {\n    if (!$plugin->hasFormClass($operation)) {\n      // Use the default form class if no form is specified for this operation.\n      if ($fallback_operation && $plugin->hasFormClass($fallback_operation)) {\n        $operation = $fallback_operation;\n      }\n      else {\n        throw new InvalidPluginDefinitionException($plugin->getPluginId(), sprintf('The \"%s\" plugin did not specify a \"%s\" form class', $plugin->getPluginId(), $operation));\n      }\n    }\n\n    $form_class = $plugin->getFormClass($operation);\n\n    // If the form specified is the plugin itself, use it directly.\n    if (ltrim(get_class($plugin), '\\\\') === ltrim($form_class, '\\\\')) {\n      $form_object = $plugin;\n    }\n    else {\n      $form_object = $this->classResolver->getInstanceFromDefinition($form_class);\n    }\n\n    // Ensure the resulting object is a plugin form.\n    if (!$form_object instanceof PluginFormInterface) {\n      throw new InvalidPluginDefinitionException($plugin->getPluginId(), sprintf('The \"%s\" plugin did not specify a valid \"%s\" form class, must implement \\Drupal\\Core\\Plugin\\PluginFormInterface', $plugin->getPluginId(), $operation));\n    }\n\n    if ($form_object instanceof PluginAwareInterface) {\n      $form_object->setPlugin($plugin);\n    }\n\n    return $form_object;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Plugin/PluginFormFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PluginFormFactory", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ApiResponseReceivedEvent in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Event;\n\n/**\n * Event fired when an API response is successfully received.\n */\nclass ApiResponseReceivedEvent extends ApiResponseEvent {\n\n  /**\n   * Event name constant.\n   */\n  const EVENT_NAME = 'api_normalization.response_received';\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Event/ApiResponseReceivedEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiResponseReceivedEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CloneEntity.php\nTarget symbol: class CloneEntity\nNamespace: Drupal\\mcp_tools_entity_clone\\Plugin\\tool\\Tool\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CloneEntity.\n- Include required imports:\n  - Drupal\\mcp_tools_entity_clone\\Service\\EntityCloneService\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n  - Drupal\\Core\\Plugin\\Context\\ContextDefinition\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n  - Drupal\\mcp_tools\\Tool\\McpToolsToolBase\n  - Drupal\\tool\\Attribute\\Tool\n  - Drupal\\tool\\Tool\\ToolOperation\n  - Drupal\\tool\\TypedData\\InputDefinition\n- Ensure these methods exist where relevant:\n  - create()\n  - executeLegacy()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_entity_clone\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_entity_clone\\Service\\EntityCloneService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_entity_clone_clone',\n  label: new TranslatableMarkup('Clone Entity'),\n  description: new TranslatableMarkup('Clone a single entity with optional title prefix/suffix and child paragraph handling.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'entity_type' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup('The entity type to clone (e.g., node, media, paragraph)'),\n      required: TRUE,\n    ),\n    'entity_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity ID'),\n      description: new TranslatableMarkup('The ID of the entity to clone'),\n      required: TRUE,\n    ),\n    'title_prefix' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title Prefix'),\n      description: new TranslatableMarkup('Prefix to add to the cloned entity title'),\n      required: FALSE,\n    ),\n    'title_suffix' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title Suffix'),\n      description: new TranslatableMarkup('Suffix to add to the cloned entity title (default: \" (Clone)\")'),\n      required: FALSE,\n    ),\n    'clone_children' => new InputDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Clone Children'),\n      description: new TranslatableMarkup('Whether to clone child paragraphs (default: true)'),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'entity_type' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Entity Type'),\n      description: new TranslatableMarkup(''),\n    ),\n    'source_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Entity ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'clone_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Cloned Entity ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'clone_uuid' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Cloned Entity UUID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'label' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Cloned Entity Label'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass CloneEntity extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'entity_clone';\n\n\n  protected EntityCloneService $entityCloneService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->entityCloneService = $container->get('mcp_tools_entity_clone.entity_clone');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $entityType = $input['entity_type'] ?? '';\n    $entityId = $input['entity_id'] ?? '';\n\n    if (empty($entityType) || empty($entityId)) {\n      return ['success' => FALSE, 'error' => 'Both entity_type and entity_id are required.'];\n    }\n\n    $options = [];\n    if (isset($input['title_prefix'])) {\n      $options['title_prefix'] = $input['title_prefix'];\n    }\n    if (isset($input['title_suffix'])) {\n      $options['title_suffix'] = $input['title_suffix'];\n    }\n    if (isset($input['clone_children'])) {\n      $options['clone_children'] = (bool) $input['clone_children'];\n    }\n\n    return $this->entityCloneService->cloneEntity($entityType, $entityId, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_entity_clone/src/Plugin/tool/Tool/CloneEntity.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CloneEntity", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: StatementEvent.php\nTarget symbol: enum StatementEvent\nNamespace: Drupal\\Core\\Database\\Event\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete enum implementation for StatementEvent.\n- Ensure these methods exist where relevant:\n  - all()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Database\\Event;\n\n/**\n * Enumeration of the statement related database events.\n */\nenum StatementEvent: string {\n\n  case ExecutionStart = StatementExecutionStartEvent::class;\n  case ExecutionEnd = StatementExecutionEndEvent::class;\n  case ExecutionFailure = StatementExecutionFailureEvent::class;\n\n  /**\n   * Returns an array with all statement related events.\n   *\n   * @return list<class-string<\\Drupal\\Core\\Database\\Event\\DatabaseEvent>>\n   *   An array with all statement related events.\n   */\n  public static function all(): array {\n    return array_map(fn(self $case) => $case->value, self::cases());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Event/StatementEvent.php", "type": "code_reference", "symbol_kind": "enum", "symbol_name": "StatementEvent", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  user_preference_login_redirect.commands:\n    class: \\Drupal\\user_preference_login_redirect\\Commands\\UserPreferenceLoginRedirectCommands\n    arguments: ['@user.data', '@entity_type.manager', '@config.factory', '@user_preference_login_redirect.route_parser']\n    tags:\n      - { name: drush.command }\n", "metadata": {"source": "repos/user_preference_login_redirect/drush.services.yml", "type": "yaml_reference", "topic": "drush.services"}}
{"instruction": "Show me the implementation of the class Query in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\KeyValueStore\\Query;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Query\\QueryBase;\nuse Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface;\n\n/**\n * Defines the entity query for entities stored in a key value backend.\n */\nclass Query extends QueryBase {\n\n  /**\n   * The key value factory.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface\n   */\n  protected $keyValueFactory;\n\n  /**\n   * Constructs a new Query.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string $conjunction\n   *   - AND: all of the conditions on the query need to match.\n   *   - OR: at least one of the conditions on the query need to match.\n   * @param array $namespaces\n   *   List of potential namespaces of the classes belonging to this query.\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface $key_value_factory\n   *   The key value factory.\n   */\n  public function __construct(EntityTypeInterface $entity_type, $conjunction, array $namespaces, KeyValueFactoryInterface $key_value_factory) {\n    parent::__construct($entity_type, $conjunction, $namespaces);\n    $this->keyValueFactory = $key_value_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    // Load the relevant records.\n    $records = $this->keyValueFactory->get('entity_storage__' . $this->entityTypeId)->getAll();\n\n    // Apply conditions.\n    $result = $this->condition->compile($records);\n\n    // Apply sort settings.\n    foreach ($this->sort as $sort) {\n      $direction = $sort['direction'] == 'ASC' ? -1 : 1;\n      $field = $sort['field'];\n      uasort($result, function ($a, $b) use ($field, $direction) {\n        return ($a[$field] <= $b[$field]) ? $direction : -$direction;\n      });\n    }\n\n    // Let the pager do its work.\n    $this->initializePager();\n\n    if ($this->range) {\n      $result = array_slice($result, $this->range['start'], $this->range['length'], TRUE);\n    }\n    if ($this->count) {\n      return count($result);\n    }\n\n    // Create the expected structure of entity_id => entity_id.\n    $entity_ids = array_keys($result);\n    return array_combine($entity_ids, $entity_ids);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/KeyValueStore/Query/Query.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Query", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Merge in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\sqlite\\Driver\\Database\\sqlite;\n\nuse Drupal\\Core\\Database\\Query\\Merge as QueryMerge;\n\n@trigger_error('Extending from \\Drupal\\sqlite\\Driver\\Database\\sqlite\\Merge is deprecated in drupal:11.0.0 and is removed from drupal:12.0.0. Extend from the base class instead. See https://www.drupal.org/node/3256524', E_USER_DEPRECATED);\n\n/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Query\\Merge.\n */\nclass Merge extends QueryMerge {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/sqlite/src/Driver/Database/sqlite/Merge.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Merge", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n\n  soap_client.soap_service.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'soap_service'\n\n  soap_client.soap_operation.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'soap_operation'\n\n  soap_client.soap_response.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'soap_response'\n\n  soap_client.soap_connection_profile.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'soap_connection_profile'\n\n  soap_client.file.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'file'\n\n  soap_client.feed.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'feeds_feed'\n\n  logger.channel.soap_client:\n    parent: logger.channel_base\n    arguments:\n      - 'soap_client'\n\n  soap_client.wsdl_parser:\n    class: Drupal\\soap_client\\WsdlParser\n    arguments:\n      - '@soap_client.soap_operation.storage'\n      - '@soap_client.soap_service.storage'\n      - '@logger.channel.soap_client'\n\n  soap_client.settings.config:\n    class: Drupal\\Core\\Config\\ImmutableConfig\n    factory: ['@config.factory', get]\n    arguments:\n      - 'soap_client.settings'\n\n  soap_client.view.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'view'\n\n  soap_client.soap_client:\n    class: Drupal\\soap_client\\SoapClient\n    arguments:\n      - '@soap_client.soap_response.storage'\n      - '@logger.channel.soap_client'\n      - '@soap_client.settings.config'\n\n  soap_client.entity_form_display.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'entity_form_display'\n\n  soap_client.entity_view_display.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'entity_view_display'\n\n  soap_client.field_storage_config.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'field_storage_config'\n\n  soap_client.field_config.storage:\n    class: Drupal\\Core\\Entity\\EntityStorageInterface\n    factory: ['@entity_type.manager', getStorage]\n    arguments:\n      - 'field_config'\n\n  soap_client.wsdl_importer:\n    class: Drupal\\soap_client\\WsdlImporter\n    arguments:\n      - '@soap_client.wsdl_parser'\n      - '@soap_client.soap_service.storage'\n      - '@soap_client.soap_operation.storage'\n      - '@messenger'\n      - '@string_translation'\n      - '@soap_client.entity_form_display.storage'\n      - '@soap_client.entity_view_display.storage'\n      - '@soap_client.field_storage_config.storage'\n      - '@soap_client.field_config.storage'\n      - '@plugin.manager.entity_generator'\n      - '@logger.channel.soap_client'\n\n  plugin.manager.operation_dispatcher:\n    class: Drupal\\soap_client\\Plugin\\OperationDispatcherManager\n    parent: default_plugin_manager\n\n  soap_client.installer:\n    class: Drupal\\soap_client\\Installer\n    arguments:\n      - '@soap_client.wsdl_importer'\n      - '@plugin.manager.entity_generator'\n", "metadata": {"source": "repos/soap_client/soap_client.services.yml", "type": "yaml_reference", "topic": "soap client.services"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "image_hotspot_agent.settings:\n  type: config_object\n  label: \"Image Hotspot Agent settings\"\n  mapping:\n    description_format:\n      type: string\n      label: \"Description text format\"\n      description: \"The text format ID to use for hotspot descriptions (e.g., 'basic_html', 'full_html').\"\n    hotspot_colors:\n      type: string\n      label: \"Hotspot colors\"\n      description: \"Color options for hotspot dots. Format: key|Label|#hexcolor (one per line).\"\n    info_bg_colors:\n      type: string\n      label: \"Info panel background colors\"\n      description: \"Background color options for hotspot info panels. Format: key|Label|#hexcolor (one per line).\"\n    button_colors:\n      type: string\n      label: \"Button colors\"\n      description: \"Color options for link buttons in hotspot info panels. Format: key|Label|#hexcolor (one per line).\"\n    size_small:\n      type: integer\n      label: \"Small hotspot size\"\n      description: \"Size in pixels for small hotspot dots.\"\n    size_medium:\n      type: integer\n      label: \"Medium hotspot size\"\n      description: \"Size in pixels for medium hotspot dots.\"\n    size_large:\n      type: integer\n      label: \"Large hotspot size\"\n      description: \"Size in pixels for large hotspot dots.\"\n", "metadata": {"source": "repos/image_hotspots_agent/config/schema/image_hotspot_agent.schema.yml", "type": "yaml_reference", "topic": "image hotspot agent.schema"}}
{"instruction": "Show me the implementation of the class SchemaRegistry in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\n\n/**\n * Registry for tool schemas with caching.\n */\nclass SchemaRegistry {\n\n  public function __construct(\n    private readonly ToolSchemaGenerator $schemaGenerator,\n    private readonly CacheBackendInterface $cache,\n    private readonly ModuleHandlerInterface $moduleHandler,\n  ) {}\n\n  /**\n   * Get OpenAPI schema for a tool.\n   *\n   * @param object $tool\n   *   The tool object.\n   * @param bool $useCache\n   *   Whether to use cached schema.\n   *\n   * @return array\n   *   OpenAPI schema array.\n   */\n  public function getSchema(object $tool, bool $useCache = TRUE): array {\n    $toolId = $this->getToolId($tool);\n    $cid = \"tool_schema:{$toolId}\";\n\n    if ($useCache) {\n      $cached = $this->cache->get($cid);\n      if ($cached) {\n        return $cached->data;\n      }\n    }\n\n    $schema = $this->schemaGenerator->generateOpenApiSchema($tool);\n    $this->cache->set($cid, $schema, time() + 3600, ['tool_schema', \"tool_schema:{$toolId}\"]);\n\n    return $schema;\n  }\n\n  /**\n   * Invalidate schema cache for a tool.\n   */\n  public function invalidateSchema(object $tool): void {\n    $toolId = $this->getToolId($tool);\n    $this->cache->invalidate(\"tool_schema:{$toolId}\");\n    $this->cache->invalidateTags([\"tool_schema:{$toolId}\"]);\n  }\n\n  /**\n   * Get all registered tool schemas.\n   *\n   * @return array\n   *   Array of tool_id => schema.\n   */\n  public function getAllSchemas(): array {\n    // This would need integration with Tool API to discover all tools.\n    // For now, return empty array.\n    return [];\n  }\n\n  /**\n   * Get tool ID.\n   */\n  protected function getToolId(object $tool): string {\n    if (method_exists($tool, 'getId')) {\n      return $tool->getId();\n    }\n    if (method_exists($tool, 'getPluginId')) {\n      return $tool->getPluginId();\n    }\n    if (isset($tool->id)) {\n      return $tool->id;\n    }\n    return 'unknown_tool';\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/SchemaRegistry.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SchemaRegistry", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ProfileAccessControlHandler in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\display_builder;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Entity\\EntityAccessControlHandler;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Defines the access control handler for the instance entity type.\n */\nfinal class ProfileAccessControlHandler extends EntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account): AccessResultInterface {\n    /** @var \\Drupal\\display_builder\\Entity\\Profile $entity */\n    $access = parent::checkAccess($entity, $operation, $account);\n\n    if ($access->isAllowed()) {\n      // Permission to administer profiles gives permission to use all profiles.\n      return $access;\n    }\n\n    if ($operation === 'view') {\n      return AccessResult::allowedIfHasPermission($account, $entity->getPermissionName());\n    }\n\n    return AccessResult::forbidden();\n  }\n\n}\n", "metadata": {"source": "repos/display_builder/src/ProfileAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProfileAccessControlHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "dependencies: {  }\nid: range\nlabel: 'Range'\ndescription: 'Generate a numeric sequence (e.g., 1 to 10)'\ncategory: tools\nicon: 'mdi:ray-start-end'\nplugin_version: 1.0.0\nenabled: true\nparameters:\n  start:\n    configurable: true\n    connectable: true\n    required: false\n  end:\n    configurable: true\n    connectable: true\n    required: true\n  step:\n    configurable: true\n    connectable: true\n    required: false\noutputs:\n  items:\n    exposed: true\n  count:\n    exposed: true\n  start:\n    exposed: true\n  end:\n    exposed: true\n  step:\n    exposed: true\ntags: {  }\nexecutor_plugin: 'flowdrop_node_processor:range'\nvisual_type: default\nsupported_visual_types:\n  - default\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/config/install/flowdrop_node_type.flowdrop_node_type.range.yml", "type": "yaml_reference", "topic": "flowdrop node type.flowdrop node type.range"}}
{"instruction": "Show me the implementation of the class KeyGenerator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\nuse Drupal\\Component\\Uuid\\UuidInterface;\nuse Drupal\\easy_encryption\\Encryption\\EncryptionKeyId;\nuse Drupal\\easy_encryption\\KeyManagement\\Port\\MutableKeyRegistryInterface;\nuse Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException;\nuse Drupal\\easy_encryption\\Sodium\\SodiumKeyPairRepositoryInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Coordinates encryption key generation and activation.\n *\n * @internal This class is not part of the module's public programming API.\n */\nfinal class KeyGenerator implements KeyGeneratorInterface {\n\n  public function __construct(\n    private readonly SodiumKeyPairRepositoryInterface $repository,\n    private readonly MutableKeyRegistryInterface $keyRegistry,\n    private readonly UuidInterface $uuid,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function generate(?EncryptionKeyId $keyId = NULL): EncryptionKeyId {\n    if ($keyId === NULL) {\n      $keyId = EncryptionKeyId::fromUserInput($this->uuid->generate());\n    }\n\n    try {\n      $this->repository->generateKeyPair($keyId->value);\n      $this->keyRegistry->register($keyId);\n    }\n    catch (SodiumKeyPairOperationException $e) {\n      throw KeyGeneratorException::generationFailed($keyId->value, $e);\n    }\n\n    $this->logger->notice('Generated encryption key {id}.', ['id' => $keyId->value]);\n    return $keyId;\n  }\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyGenerator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyGenerator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class Condition in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Condition\\Annotation;\n\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a condition plugin annotation object.\n *\n * Condition plugins provide generalized conditions for use in other\n * operations, such as conditional block placement.\n *\n * Plugin Namespace: Plugin\\Condition\n *\n * For a working example, see \\Drupal\\user\\Plugin\\Condition\\UserRole.\n *\n * @see \\Drupal\\Core\\Condition\\ConditionManager\n * @see \\Drupal\\Core\\Condition\\ConditionInterface\n * @see \\Drupal\\Core\\Condition\\ConditionPluginBase\n * @see block_api\n *\n * @ingroup plugin_api\n *\n * @Annotation\n */\nclass Condition extends Plugin {\n\n  /**\n   * The condition plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The human-readable name of the condition.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $label;\n\n  /**\n   * The name of the module providing the type.\n   *\n   * @var string\n   */\n  public $module;\n\n  /**\n   * An array of context definitions describing the context used by the plugin.\n   *\n   * The array is keyed by context names.\n   *\n   * @var \\Drupal\\Core\\Annotation\\ContextDefinition[]\n   */\n  public $context_definitions = [];\n\n  /**\n   * The category under which the condition should listed in the UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $category;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Condition/Annotation/Condition.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Condition", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class BeforeEntityWipeEvent in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\db_wipe_entity\\Event;\n\nuse Drupal\\Core\\Entity\\Query\\QueryInterface;\nuse Symfony\\Contracts\\EventDispatcher\\Event;\n\n/**\n * Event dispatched before entity wipe operation.\n */\nclass BeforeEntityWipeEvent extends Event {\n\n  /**\n   * Whether the wipe operation should be prevented.\n   *\n   * @var bool\n   */\n  protected bool $preventWipe = FALSE;\n\n  /**\n   * Constructs a BeforeEntityWipeEvent object.\n   *\n   * @param string $entityTypeId\n   *   The entity type ID.\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryInterface $query\n   *   The entity query.\n   * @param int $count\n   *   Total count of entities to be deleted.\n   * @param string|null $bundle\n   *   The bundle name.\n   * @param bool $dryRun\n   *   Whether this is a dry run.\n   */\n  public function __construct(\n    protected readonly string $entityTypeId,\n    protected readonly QueryInterface $query,\n    protected readonly int $count,\n    protected readonly ?string $bundle = NULL,\n    protected readonly bool $dryRun = FALSE,\n  ) {}\n\n  /**\n   * Gets the entity type ID.\n   *\n   * @return string\n   *   The entity type ID.\n   */\n  public function getEntityTypeId(): string {\n    return $this->entityTypeId;\n  }\n\n  /**\n   * Gets the query object.\n   *\n   * @return \\Drupal\\Core\\Entity\\Query\\QueryInterface\n   *   The entity query.\n   */\n  public function getQuery(): QueryInterface {\n    return $this->query;\n  }\n\n  /**\n   * Gets the total count of entities to be deleted.\n   *\n   * @return int\n   *   The count of entities.\n   */\n  public function getCount(): int {\n    return $this->count;\n  }\n\n  /**\n   * Gets the bundle name.\n   *\n   * @return string|null\n   *   The bundle name or NULL.\n   */\n  public function getBundle(): ?string {\n    return $this->bundle;\n  }\n\n  /**\n   * Checks if this is a dry run.\n   *\n   * @return bool\n   *   TRUE if dry run, FALSE otherwise.\n   */\n  public function isDryRun(): bool {\n    return $this->dryRun;\n  }\n\n  /**\n   * Prevents the wipe operation.\n   */\n  public function preventWipe(): void {\n    $this->preventWipe = TRUE;\n  }\n\n  /**\n   * Checks if wipe should be prevented.\n   *\n   * @return bool\n   *   TRUE if prevented, FALSE otherwise.\n   */\n  public function isWipePrevented(): bool {\n    return $this->preventWipe;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_entity/src/Event/BeforeEntityWipeEvent.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BeforeEntityWipeEvent", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface FlowDropEventTypeInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_trigger;\n\nuse Drupal\\Component\\Plugin\\PluginInspectionInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\n\n/**\n * Interface for FlowDrop Event Type plugins.\n *\n * Event type plugins define different types of events that can trigger\n * workflow execution. Each plugin specifies:\n * - The event identifier (e.g., \"entity.insert\")\n * - Default orchestration settings\n * - How to extract data from the event context.\n */\ninterface FlowDropEventTypeInterface extends PluginInspectionInterface {\n\n  /**\n   * Get the event type ID.\n   *\n   * @return string\n   *   The event type ID (e.g., \"entity.insert\", \"user.login\").\n   */\n  public function getEventId(): string;\n\n  /**\n   * Get the human-readable label.\n   *\n   * @return string\n   *   The label for this event type.\n   */\n  public function getLabel(): string;\n\n  /**\n   * Get the event description.\n   *\n   * @return string\n   *   A description of when this event fires.\n   */\n  public function getDescription(): string;\n\n  /**\n   * Get the event category.\n   *\n   * @return string\n   *   The category (entity, user, system).\n   */\n  public function getCategory(): string;\n\n  /**\n   * Get the default orchestrator for this event type.\n   *\n   * @return string\n   *   The orchestrator type (synchronous, asynchronous).\n   */\n  public function getDefaultOrchestrator(): string;\n\n  /**\n   * Get the default execution mode.\n   *\n   * @return string\n   *   The execution mode (sync, async).\n   */\n  public function getDefaultExecutionMode(): string;\n\n  /**\n   * Get supported entity types for this event.\n   *\n   * @return array<string>\n   *   Array of supported entity type IDs, or empty for all.\n   */\n  public function getSupportedEntityTypes(): array;\n\n  /**\n   * Check if this event type supports the given entity type.\n   *\n   * @param string $entityType\n   *   The entity type ID.\n   *\n   * @return bool\n   *   TRUE if supported, FALSE otherwise.\n   */\n  public function supportsEntityType(string $entityType): bool;\n\n  /**\n   * Extract trigger data from the event context.\n   *\n   * This method extracts relevant data from the entity and event\n   * context to be passed to the workflow execution.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface|null $entity\n   *   The entity involved in the event, or NULL for non-entity events.\n   * @param \\Drupal\\Core\\Entity\\EntityInterface|null $originalEntity\n   *   The original entity state (for updates), or NULL.\n   * @param array<string, mixed> $context\n   *   Additional context data.\n   *\n   * @return array<string, mixed>\n   *   The extracted trigger data.\n   */\n  public function extractTriggerData(\n    ?EntityInterface $entity,\n    ?EntityInterface $originalEntity = NULL,\n    array $context = [],\n  ): array;\n\n  /**\n   * Get the unified parameter schema for this event type.\n   *\n   * Returns a JSON Schema describing the parameters\n   * available for triggers using this event type.\n   *\n   * @return array<string, mixed>\n   *   The JSON schema for parameters.\n   */\n  public function getParameterSchema(): array;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/src/FlowDropEventTypeInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "FlowDropEventTypeInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ProxyBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\ProxyBuilder;\n\nuse Drupal\\Component\\ProxyBuilder\\ProxyBuilder as BaseProxyBuilder;\n\n/**\n * Extend the component proxy builder by using the DependencySerializationTrait.\n */\nclass ProxyBuilder extends BaseProxyBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function buildUseStatements() {\n    $output = parent::buildUseStatements();\n\n    $output .= 'use \\Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;' . \"\\n\\n\";\n\n    return $output;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/ProxyBuilder/ProxyBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ProxyBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: ContentEntityNullStorage\nSource file: <source_file>\nFile name hint: ContentEntityNullStorage.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\n\n/**\n * Defines a null entity storage.\n *\n * Used for content entity types that have no storage.\n */\nclass ContentEntityNullStorage extends ContentEntityStorageBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function loadMultiple(?array $ids = NULL) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doLoadMultiple(?array $ids = NULL) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function load($id) {\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadRevision($revision_id) {\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadMultipleRevisions(array $revision_ids) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteRevision($revision_id) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadByProperties(array $values = []) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete(array $entities) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doDelete($entities) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(EntityInterface $entity) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getQueryServiceName() {\n    return 'entity.query.null';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doLoadMultipleRevisionsFieldItems($revision_ids) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doSaveFieldItems(ContentEntityInterface $entity, array $names = []) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doDeleteFieldItems($entities) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doDeleteRevisionFieldItems(ContentEntityInterface $revision) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function readFieldItemsToPurge(FieldDefinitionInterface $field_definition, $batch_size) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\n\n/**\n * Defines a null entity storage.\n *\n * Used for content entity types that have no storage.\n */\nclass ContentEntityNullStorage extends ContentEntityStorageBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadMultiple(?array $ids = NULL) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doLoadMultiple(?array $ids = NULL) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function load($id) {\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadRevision($revision_id) {\n    return NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadMultipleRevisions(array $revision_ids) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteRevision($revision_id) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function loadByProperties(array $values = []) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete(array $entities) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doDelete($entities) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(EntityInterface $entity) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getQueryServiceName() {\n    return 'entity.query.null';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doLoadMultipleRevisionsFieldItems($revision_ids) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doSaveFieldItems(ContentEntityInterface $entity, array $names = []) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doDeleteFieldItems($entities) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doDeleteRevisionFieldItems(ContentEntityInterface $revision) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function readFieldItemsToPurge(FieldDefinitionInterface $field_definition, $batch_size) {\n    return [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function purgeFieldItems(ContentEntityInterface $entity, FieldDefinitionInterface $field_definition) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function doSave($id, EntityInterface $entity) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function has($id, EntityInterface $entity) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function countFieldData($storage_definition, $as_bool = FALSE) {\n    return $as_bool ? FALSE : 0;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasData() {\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/ContentEntityNullStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ContentEntityNullStorage", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: SoapOperation\nSource file: <source_file>\nFile name hint: SoapOperation.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Plugin\\OperationDispatcher;\n\nuse Drupal\\soap_client\\Plugin\\OperationDispatcherBase;\n\n/**\n * Provides the default SoapOperation dispatcher plugin.\n *\n * @OperationDispatcher(\n *   id = \"soap_operation\",\n * )\n */\nclass SoapOperation extends OperationDispatcherBase {}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Plugin\\OperationDispatcher;\n\nuse Drupal\\soap_client\\Plugin\\OperationDispatcherBase;\n\n/**\n * Provides the default SoapOperation dispatcher plugin.\n *\n * @OperationDispatcher(\n *   id = \"soap_operation\",\n * )\n */\nclass SoapOperation extends OperationDispatcherBase {}\n", "metadata": {"source": "repos/soap_client/src/Plugin/OperationDispatcher/SoapOperation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapOperation", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class FileLinkFormatterFactory in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Debug;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\n\n/**\n * Factory class to create FileLinkFormatter service instances.\n */\nclass FileLinkFormatterFactory {\n\n  /**\n   * Return a FileLinkFormatter configured with WebProfiler settings.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory service.\n   *\n   * @return \\Drupal\\webprofiler\\Debug\\FileLinkFormatter\n   *   A FileLinkFormatter configured with WebProfiler settings.\n   */\n  final public static function getFileLinkFormatter(\n    ConfigFactoryInterface $configFactory,\n  ): FileLinkFormatter {\n    $settings = $configFactory->get('webprofiler.settings');\n    $ide = $settings->get('ide') ?? '';\n    $ide_remote_path = $settings->get('ide_remote_path') ?? '';\n    $ide_local_path = $settings->get('ide_local_path') ?? '';\n\n    return new FileLinkFormatter($ide, $ide_remote_path, $ide_local_path);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Debug/FileLinkFormatterFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileLinkFormatterFactory", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: FieldInstanceSettings\nSource file: <source_file>\nFile name hint: FieldInstanceSettings.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\field\\Plugin\\migrate\\process\\d7;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n// cspell:ignore entityreference\n\n/**\n * Determines the field instance settings.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess(\n id: \"d7_field_instance_settings\"\n)]\nclass FieldInstanceSettings extends ProcessPluginBase {\n\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    [$instance_settings, $widget_settings, $field_definition] = $value;\n    $widget_type = $widget_settings['type'];\n\n    $field_data = unserialize($field_definition['data']);\n\n    // Get taxonomy term reference handler settings from allowed values.\n    if ($row->getSourceProperty('type') == 'taxonomy_term_reference') {\n      $instance_settings['handler_settings']['sort'] = [\n        'field' => '_none',\n      ];\n      $allowed_values = $row->get('@allowed_values');\n      foreach ($allowed_values as $allowed_value) {\n        foreach ($allowed_value as $vocabulary) {\n          $instance_settings['handler_settings']['target_bundles'][$vocabulary] = $vocabulary;\n        }\n      }\n    }\n\n    // Get entityreference handler settings from source field configuration.\n    if ($row->getSourceProperty('type') == \"entityreference\") {\n      $field_settings = $field_data['settings'];\n      $instance_settings['handler'] = 'default:' . $field_settings['target_type'];\n      // Transform the sort settings to D8 structure.\n      $sort = [\n        'field' => '_none',\n        'direction' => 'ASC',\n      ];\n      if (!empty(array_filter($field_settings['handler_settings']['sort']))) {\n        if ($field_settings['handler_settings']['sort']['type'] == \"property\") {\n          $sort = [\n            'field' => $field_settings['handler_settings']['sort']['property'],\n            'direction' => $field_settings['handler_settings']['sort']['direction'],\n          ];\n        }\n        elseif ($field_settings['handler_settings']['sort']['type'] == \"field\") {\n          $sort = [\n            'field' => $field_settings['handler_settings']['sort']['field'],\n            'direction' => $field_settings['handler_settings']['sort']['direction'],\n          ];\n        }\n      }\n      if (empty($field_settings['handler_settings']['target_bundles'])) {\n        $field_settings['handler_settings']['target_bundles'] = NULL;\n      }\n      $field_settings['handler_settings']['sort'] = $sort;\n      $instance_settings['handler_settings'] = $field_settings['handler_settings'];\n    }\n\n    if ($row->getSourceProperty('type') == 'node_reference') {\n      $instance_settings['handler'] = 'default:node';\n\n      $instance_settings['handler_settings'] = [\n        'sort' => [\n          'field' => '_none',\n          'direction' => 'ASC',\n        ],\n        'target_bundles' => array_filter($field_data['settings']['referenceable_types'] ?? []),\n      ];\n    }\n\n    if ($row->getSourceProperty('type') == 'user_reference') {\n      $instance_settings['handler'] = 'default:user';\n\n      $instance_settings['handler_settings'] = [\n        'include_anonymous' => TRUE,\n        'filter' => [\n          'type' => '_none',\n        ],\n        'sort' => [\n          'field' => '_none',\n          'direction' => 'ASC',\n        ],\n        'auto_create' => FALSE,\n      ];\n\n      if ($row->hasSourceProperty('roles')) {\n        $instance_settings['handler_settings']['filter']['type'] = 'role';\n        foreach ($row->get('roles') as $role) {\n          $instance_settings['handler_settings']['filter']['role'] = [\n            $role['name'] => $role['name'],\n          ];\n        }\n      }\n    }\n\n    // Get the labels for the list_boolean type.\n    if ($row->getSourceProperty('type') === 'list_boolean') {", "output": "<?php\n\nnamespace Drupal\\field\\Plugin\\migrate\\process\\d7;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n// cspell:ignore entityreference\n\n/**\n * Determines the field instance settings.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess(\n id: \"d7_field_instance_settings\"\n)]\nclass FieldInstanceSettings extends ProcessPluginBase {\n\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    [$instance_settings, $widget_settings, $field_definition] = $value;\n    $widget_type = $widget_settings['type'];\n\n    $field_data = unserialize($field_definition['data']);\n\n    // Get taxonomy term reference handler settings from allowed values.\n    if ($row->getSourceProperty('type') == 'taxonomy_term_reference') {\n      $instance_settings['handler_settings']['sort'] = [\n        'field' => '_none',\n      ];\n      $allowed_values = $row->get('@allowed_values');\n      foreach ($allowed_values as $allowed_value) {\n        foreach ($allowed_value as $vocabulary) {\n          $instance_settings['handler_settings']['target_bundles'][$vocabulary] = $vocabulary;\n        }\n      }\n    }\n\n    // Get entityreference handler settings from source field configuration.\n    if ($row->getSourceProperty('type') == \"entityreference\") {\n      $field_settings = $field_data['settings'];\n      $instance_settings['handler'] = 'default:' . $field_settings['target_type'];\n      // Transform the sort settings to D8 structure.\n      $sort = [\n        'field' => '_none',\n        'direction' => 'ASC',\n      ];\n      if (!empty(array_filter($field_settings['handler_settings']['sort']))) {\n        if ($field_settings['handler_settings']['sort']['type'] == \"property\") {\n          $sort = [\n            'field' => $field_settings['handler_settings']['sort']['property'],\n            'direction' => $field_settings['handler_settings']['sort']['direction'],\n          ];\n        }\n        elseif ($field_settings['handler_settings']['sort']['type'] == \"field\") {\n          $sort = [\n            'field' => $field_settings['handler_settings']['sort']['field'],\n            'direction' => $field_settings['handler_settings']['sort']['direction'],\n          ];\n        }\n      }\n      if (empty($field_settings['handler_settings']['target_bundles'])) {\n        $field_settings['handler_settings']['target_bundles'] = NULL;\n      }\n      $field_settings['handler_settings']['sort'] = $sort;\n      $instance_settings['handler_settings'] = $field_settings['handler_settings'];\n    }\n\n    if ($row->getSourceProperty('type') == 'node_reference') {\n      $instance_settings['handler'] = 'default:node';\n\n      $instance_settings['handler_settings'] = [\n        'sort' => [\n          'field' => '_none',\n          'direction' => 'ASC',\n        ],\n        'target_bundles' => array_filter($field_data['settings']['referenceable_types'] ?? []),\n      ];\n    }\n\n    if ($row->getSourceProperty('type') == 'user_reference') {\n      $instance_settings['handler'] = 'default:user';\n\n      $instance_settings['handler_settings'] = [\n        'include_anonymous' => TRUE,\n        'filter' => [\n          'type' => '_none',\n        ],\n        'sort' => [\n          'field' => '_none',\n          'direction' => 'ASC',\n        ],\n        'auto_create' => FALSE,\n      ];\n\n      if ($row->hasSourceProperty('roles')) {\n        $instance_settings['handler_settings']['filter']['type'] = 'role';\n        foreach ($row->get('roles') as $role) {\n          $instance_settings['handler_settings']['filter']['role'] = [\n            $role['name'] => $role['name'],\n          ];\n        }\n      }\n    }\n\n    // Get the labels for the list_boolean type.\n    if ($row->getSourceProperty('type') === 'list_boolean') {\n      if (isset($field_data['settings']['allowed_values'][1])) {\n        $instance_settings['on_label'] = $field_data['settings']['allowed_values'][1];\n      }\n      if (isset($field_data['settings']['allowed_values'][0])) {\n        $instance_settings['off_label'] = $field_data['settings']['allowed_values'][0];\n      }\n    }\n\n    switch ($widget_type) {\n      case 'image_image':\n      case 'image_miw':\n        $settings = $instance_settings;\n        $settings['default_image'] = [\n          'alt' => '',\n          'title' => '',\n          'width' => NULL,\n          'height' => NULL,\n          'uuid' => '',\n        ];\n        break;\n\n      default:\n        $settings = $instance_settings;\n    }\n\n    return $settings;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/field/src/Plugin/migrate/process/d7/FieldInstanceSettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldInstanceSettings", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# FlowDrop default settings.\nlogging:\n  # Verbosity level: silent, minimal, standard, verbose, debug\n  verbosity: standard\n  # Whether to log to Drupal watchdog\n  log_to_watchdog: true\n\nexecution:\n  # Default orchestrator: flowdrop_runtime:synchronous, flowdrop_runtime:asynchronous\n  default_orchestrator: flowdrop_runtime:synchronous\n  # Maximum node execution time in seconds (0 = no limit)\n  max_execution_time: 300\n\nrealtime:\n  # Enable real-time status updates\n  enabled: true\n  # Polling interval in milliseconds for fallback\n  polling_interval: 2000\n\nui:\n  # Enable Iconify icon picker for enhanced icon selection\n  # When enabled, icon fields in node category and node type forms\n  # will show an interactive picker powered by vanilla-icon-picker\n  icon_picker_enabled: true\n", "metadata": {"source": "repos/flowdrop/config/install/flowdrop.settings.yml", "type": "yaml_reference", "topic": "flowdrop.settings"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "parameters:\n  responsive_image.skip_procedural_hook_scan: true\nservices:\n  logger.responsive_image:\n    parent: logger.channel_base\n    arguments: ['responsive_image']\n  Drupal\\responsive_image\\ResponsiveImageBuilder:\n    autowire: true\n", "metadata": {"source": "repos/drupal_core/core/modules/responsive_image/responsive_image.services.yml", "type": "yaml_reference", "topic": "responsive image.services"}}
{"instruction": "Show me the implementation of the class ThemeHandler in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Extension;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Extension\\Exception\\UnknownExtensionException;\n\n/**\n * Default theme handler using the config system to store installation statuses.\n */\nclass ThemeHandler implements ThemeHandlerInterface {\n\n  /**\n   * A list of all currently available themes.\n   *\n   * @var array\n   */\n  protected $list;\n\n  /**\n   * The config factory to get the installed themes.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * An extension discovery instance.\n   *\n   * @var \\Drupal\\Core\\Extension\\ThemeExtensionList\n   */\n  protected $themeList;\n\n  /**\n   * The app root.\n   *\n   * @var string\n   */\n  protected $root;\n\n  /**\n   * Constructs a new ThemeHandler.\n   *\n   * @param string $root\n   *   The app root.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory to get the installed themes.\n   * @param \\Drupal\\Core\\Extension\\ThemeExtensionList $theme_list\n   *   An extension discovery instance.\n   */\n  public function __construct($root, ConfigFactoryInterface $config_factory, ThemeExtensionList $theme_list) {\n    $this->root = $root;\n    $this->configFactory = $config_factory;\n    $this->themeList = $theme_list;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getDefault() {\n    return $this->configFactory->get('system.theme')->get('default');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function listInfo() {\n    if (!isset($this->list)) {\n      $this->list = [];\n      $installed_themes = array_keys($this->configFactory->get('core.extension')->get('theme'));\n      if (!empty($installed_themes)) {\n        $list = $this->themeList->getList();\n        foreach ($installed_themes as $theme) {\n          // Do not add installed themes that cannot be found by the\n          // extension.list.theme service. If a theme does go missing from the\n          // file system any call to ::getTheme() will result in an exception\n          // and an error being logged. Ignoring the problem here allows the\n          // theme system to fix itself while updating.\n          if (isset($list[$theme])) {\n            $this->addTheme($list[$theme]);\n          }\n        }\n      }\n    }\n    return $this->list;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function addTheme(Extension $theme) {\n    if (!empty($theme->info['libraries'])) {\n      foreach ($theme->info['libraries'] as $library => $name) {\n        $theme->libraries[$library] = $name;\n      }\n    }\n    if (isset($theme->info['engine'])) {\n      $theme->engine = $theme->info['engine'];\n    }\n    if (isset($theme->info['base theme'])) {\n      $theme->base_theme = $theme->info['base theme'];\n    }\n    $this->list[$theme->getName()] = $theme;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function refreshInfo() {\n    $installed = $this->configFactory->get('core.extension')->get('theme');\n    // Only refresh the info if a theme has been installed. Modules are\n    // installed before themes by the installer and this method is called during\n    // module installation.\n    if (empty($installed) && empty($this->list)) {\n      return;\n    }\n    $this->reset();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function reset() {\n    $this->themeList->reset();\n    $this->list = NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function rebuildThemeData() {\n    @trigger_error(\"\\Drupal\\Core\\Extension\\ThemeHandlerInterface::rebuildThemeData() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal::service('extension.list.theme')->reset()->getList() instead. See https://www.drupal.org/node/3413196\", E_USER_DEPRECATED);\n    return $this->themeList->reset()->getList();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getBaseThemes(array $themes, $theme) {\n    @trigger_error(\"\\Drupal\\Core\\Extension\\ThemeHandlerInterface::getBaseThemes() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. There is no direct replacement. See https://www.drupal.org/node/3413187\", E_USER_DEPRECATED);\n    return $this->themeList->getBaseThemes($themes, $theme);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName($theme) {\n    return $this->themeList->getName($theme);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getThemeDirectories() {\n    $dirs = [];\n    foreach ($this->listInfo() as $name => $theme) {\n      $dirs[$name] = $this->root . '/' . $theme->getPath();\n    }\n    return $dirs;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function themeExists($theme) {\n    $themes = $this->listInfo();\n    return isset($themes[$theme]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getTheme($name) {\n    $themes = $this->listInfo();\n    if (isset($themes[$name])) {\n      return $themes[$name];\n    }\n    throw new UnknownExtensionException(sprintf('The theme %s does not exist.', $name));\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function hasUi($name) {\n    $themes = $this->listInfo();\n    if (isset($themes[$name])) {\n      if (!empty($themes[$name]->info['hidden'])) {\n        $theme_config = $this->configFactory->get('system.theme');\n        return $name == $theme_config->get('default') || $name == $theme_config->get('admin');\n      }\n      return TRUE;\n    }\n    return FALSE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Extension/ThemeHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ThemeHandler", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CircuitBreakerStatusController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Controller;\n\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\api_normalization\\Service\\CircuitBreakerService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Controller for circuit breaker status page.\n */\nclass CircuitBreakerStatusController extends ControllerBase {\n\n  /**\n   * The circuit breaker service.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\CircuitBreakerService\n   */\n  protected CircuitBreakerService $circuitBreaker;\n\n  /**\n   * Constructs a CircuitBreakerStatusController.\n   *\n   * @param \\Drupal\\api_normalization\\Service\\CircuitBreakerService $circuit_breaker\n   *   The circuit breaker service.\n   */\n  public function __construct(CircuitBreakerService $circuit_breaker) {\n    $this->circuitBreaker = $circuit_breaker;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('api_normalization.circuit_breaker')\n    );\n  }\n\n  /**\n   * Displays circuit breaker status.\n   *\n   * @return array\n   *   A render array.\n   */\n  public function status(): array {\n    $all_states = $this->circuitBreaker->getAllStates();\n\n    $rows = [];\n    foreach ($all_states as $endpoint => $state) {\n      $stats = $this->circuitBreaker->getStatistics($endpoint);\n\n      $state_class = match ($state) {\n        CircuitBreakerService::STATE_CLOSED => 'color-success',\n        CircuitBreakerService::STATE_HALF_OPEN => 'color-warning',\n        CircuitBreakerService::STATE_OPEN => 'color-error',\n        default => '',\n      };\n\n      $rows[] = [\n        'endpoint' => $endpoint,\n        'state' => [\n          'data' => [\n            '#markup' => '<strong class=\"' . $state_class . '\">' . strtoupper($state) . '</strong>',\n          ],\n        ],\n        'failure_count' => $stats['failure_count'] ?? 0,\n        'last_failure' => $stats['last_failure_time'] ? date('Y-m-d H:i:s', $stats['last_failure_time']) : 'Never',\n        'last_success' => $stats['last_success_time'] ? date('Y-m-d H:i:s', $stats['last_success_time']) : 'Never',\n        'last_error' => $stats['last_error'] ?? 'None',\n        'operations' => [\n          'data' => [\n            '#type' => 'operations',\n            '#links' => [\n              'reset' => [\n                'title' => $this->t('Reset'),\n                'url' => Url::fromRoute('api_normalization.circuit_breaker.reset', [\n                  'endpoint' => base64_encode($endpoint),\n                ]),\n              ],\n            ],\n          ],\n        ],\n      ];\n    }\n\n    $build = [\n      '#type' => 'container',\n      '#attributes' => ['class' => ['circuit-breaker-status']],\n    ];\n\n    $build['summary'] = [\n      '#type' => 'html_tag',\n      '#tag' => 'div',\n      '#attributes' => ['class' => ['circuit-breaker-summary']],\n      '#value' => $this->t('Monitoring @count endpoint(s)', ['@count' => count($all_states)]),\n    ];\n\n    $build['table'] = [\n      '#type' => 'table',\n      '#header' => [\n        $this->t('Endpoint'),\n        $this->t('State'),\n        $this->t('Failures'),\n        $this->t('Last Failure'),\n        $this->t('Last Success'),\n        $this->t('Last Error'),\n        $this->t('Operations'),\n      ],\n      '#rows' => $rows,\n      '#empty' => $this->t('No circuit breakers configured.'),\n      '#cache' => [\n        'max-age' => 30,\n        'contexts' => ['url'],\n      ],\n    ];\n\n    $build['#attached']['library'][] = 'api_normalization/circuit-breaker-status';\n\n    return $build;\n  }\n\n  /**\n   * Resets a circuit breaker.\n   *\n   * @param string $endpoint\n   *   Base64 encoded endpoint identifier.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\RedirectResponse\n   *   Redirect response.\n   */\n  public function reset(string $endpoint) {\n    $endpoint = base64_decode($endpoint);\n    $this->circuitBreaker->reset($endpoint);\n\n    $this->messenger()->addStatus($this->t('Circuit breaker for @endpoint has been reset.', [\n      '@endpoint' => $endpoint,\n    ]));\n\n    return $this->redirect('api_normalization.circuit_breaker.status');\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Controller/CircuitBreakerStatusController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CircuitBreakerStatusController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "drupal.update.admin:\n  version: VERSION\n  css:\n    theme:\n      css/update.admin.theme.css: {}\n", "metadata": {"source": "repos/drupal_core/core/modules/update/update.libraries.yml", "type": "yaml_reference", "topic": "update.libraries"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "api_normalization_agents.settings:\n  type: config_object\n  label: 'API Normalization Agents settings'\n  mapping:\n    auto_discovery_enabled:\n      type: boolean\n      label: 'Enable automatic tool discovery from OpenAPI specs'\n    max_context_tokens:\n      type: integer\n      label: 'Maximum tokens for agent context'\n    cache_ttl:\n      type: integer\n      label: 'Cache TTL for agent tool definitions (seconds)'\n\napi_normalization_agents.mapping.*:\n  type: config_entity\n  label: 'Agent API Mapping'\n  mapping:\n    id:\n      type: string\n      label: 'Machine name'\n    label:\n      type: label\n      label: 'Human-readable name'\n    api_normalization_id:\n      type: string\n      label: 'Parent API Normalization config ID'\n    enabled_endpoints:\n      type: sequence\n      label: 'Enabled API endpoints for agent access'\n      sequence:\n        type: mapping\n        mapping:\n          path:\n            type: string\n            label: 'Endpoint path'\n          method:\n            type: string\n            label: 'HTTP method'\n          agent_tool_name:\n            type: string\n            label: 'Tool name exposed to agents'\n          parameter_mapping:\n            type: mapping\n            label: 'Parameter mapping rules'\n          response_processing:\n            type: mapping\n            label: 'Response transformation rules'\n    ossa_agent_types:\n      type: sequence\n      label: 'OSSA agent types that can access this API'\n      sequence:\n        type: string\n    context_injection:\n      type: mapping\n      label: 'Context injection settings'\n      mapping:\n        include_schema:\n          type: boolean\n          label: 'Include OpenAPI schema in agent context'\n        include_examples:\n          type: boolean\n          label: 'Include example requests/responses'\n        max_response_tokens:\n          type: integer\n          label: 'Maximum response tokens to include in context'\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/config/schema/api_normalization_agents.schema.yml", "type": "yaml_reference", "topic": "api normalization agents.schema"}}
{"instruction": "Show me the implementation of the class BreadcrumbAnalyzer in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\seo_audit;\n\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\n\n/**\n * Analyzes the presence and markup of breadcrumbs on a webpage.\n */\nclass BreadcrumbAnalyzer {\n\n  use StringTranslationTrait;\n\n  /**\n   * Analyzes a webpage for breadcrumb presence and markup.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance for the page.\n   *\n   * @return array\n   *   An associative array containing:\n   *   - has_visual: Whether a visual breadcrumb is found.\n   *   - has_jsonld: Whether a JSON-LD breadcrumb is found.\n   *   - visual_markup: The HTML of visual breadcrumbs.\n   *   - jsonld_markup: The raw JSON-LD breadcrumb scripts.\n   */\n  public function analyze(Crawler $crawler): array {\n    return [\n      'has_visual' => $this->hasVisualBreadcrumb($crawler),\n      'has_jsonld' => $this->hasJsonLdBreadcrumb($crawler),\n      'visual_markup' => $this->getVisualBreadcrumbMarkup($crawler),\n      'jsonld_markup' => $this->getJsonLdBreadcrumbMarkup($crawler),\n    ];\n  }\n\n  /**\n   * Checks if a visual breadcrumb exists.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return string\n   *   'Found' if a visual breadcrumb is detected, otherwise 'Missing'.\n   */\n  private function hasVisualBreadcrumb(Crawler $crawler): string {\n    return $crawler->filter('nav[aria-label=\"breadcrumb\"], [class*=\"breadcrumb\"], [id*=\"breadcrumb\"]')->count() > 0 ? $this->t('Found') : $this->t('Missing');\n  }\n\n  /**\n   * Checks if a JSON-LD breadcrumb exists.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return string\n   *   'Found' if a JSON-LD breadcrumb is detected, otherwise 'Missing'.\n   */\n  private function hasJsonLdBreadcrumb(Crawler $crawler): string {\n    return count($this->getJsonLdBreadcrumbMarkup($crawler)) > 0 ? $this->t('Found') : $this->t('Missing');\n  }\n\n  /**\n   * Gets the HTML markup of visual breadcrumbs.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return array\n   *   An array of HTML strings representing breadcrumb elements.\n   */\n  private function getVisualBreadcrumbMarkup(Crawler $crawler): array {\n    $markup = [];\n    $nodes = $crawler->filter('nav[aria-label=\"breadcrumb\"], [class*=\"breadcrumb\"], [id*=\"breadcrumb\"]');\n\n    foreach ($nodes as $node) {\n      $dom = new \\DOMDocument();\n      @$dom->appendChild($dom->importNode($node, TRUE));\n      $markup[] = trim($dom->saveHTML());\n    }\n\n    return $markup;\n  }\n\n  /**\n   * Gets JSON-LD breadcrumb markup from script tags.\n   *\n   * @param \\Symfony\\Component\\DomCrawler\\Crawler $crawler\n   *   The DOM crawler instance.\n   *\n   * @return array\n   *   An array of raw JSON-LD strings representing breadcrumb data.\n   */\n  private function getJsonLdBreadcrumbMarkup(Crawler $crawler): array {\n    $markup = [];\n\n    $crawler->filterXPath('//script[@type=\"application/ld+json\"]')->each(function (Crawler $node) use (&$markup) {\n      $jsonText = $node->text();\n      $json = json_decode($jsonText, TRUE);\n\n      if (json_last_error() !== JSON_ERROR_NONE) {\n        return;\n      }\n\n      $objects = is_array($json) && array_keys($json) === range(0, count($json) - 1) ? $json : [$json];\n\n      foreach ($objects as $obj) {\n        if (($obj['@type'] ?? '') === 'BreadcrumbList') {\n          $markup[] = $jsonText;\n        }\n      }\n    });\n\n    return $markup;\n  }\n\n}\n", "metadata": {"source": "repos/seo_audit/src/BreadcrumbAnalyzer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BreadcrumbAnalyzer", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait JobSkippingTrait in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Orchestrator\\Trait;\n\nuse Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface;\nuse Drupal\\flowdrop_runtime\\Service\\Storage\\JobStorageInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Provides common job skipping logic for orchestrators.\n *\n * This trait marks remaining idle and pending jobs as skipped when a workflow\n * completes or fails. This is necessary for conditional workflows where only\n * one branch is taken (e.g., in an if-else workflow, the untaken branch's\n * jobs should be marked as skipped).\n *\n * Requirements for using this trait:\n * - The class must implement getJobSkippingLogger() returning LoggerInterface\n * - The class must implement getJobSkippingStorage() returning JobStorageInterface\n *\n * @see \\Drupal\\flowdrop_runtime\\Service\\Orchestrator\\InterruptHandlingTrait\n */\ntrait JobSkippingTrait {\n\n  /**\n   * Marks all remaining idle and pending jobs as skipped.\n   *\n   * Called when a workflow completes or fails to mark jobs that were\n   * never executed due to conditional branching or early termination.\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline containing the jobs.\n   */\n  protected function markRemainingJobsAsSkipped(\n    FlowDropPipelineInterface $pipeline,\n  ): void {\n    $skippedCount = 0;\n    $jobStorage = $this->getJobSkippingStorage();\n\n    // Mark all idle jobs as skipped.\n    $idleJobs = $pipeline->getJobsByStatus(\"idle\");\n    foreach ($idleJobs as $job) {\n      $job->markAsSkipped();\n      $jobStorage->save($job);\n      $skippedCount++;\n    }\n\n    // Mark all pending jobs as skipped.\n    // These are jobs that became ready but were never executed because\n    // the workflow completed before they could run.\n    $pendingJobs = $pipeline->getJobsByStatus(\"pending\");\n    foreach ($pendingJobs as $job) {\n      $job->markAsSkipped();\n      $jobStorage->save($job);\n      $skippedCount++;\n    }\n\n    if ($skippedCount > 0) {\n      $this->getJobSkippingLogger()->info(\"Marked @count remaining jobs as skipped\", [\n        \"@count\" => $skippedCount,\n      ]);\n    }\n  }\n\n  /**\n   * Gets the logger for job skipping operations.\n   *\n   * @return \\Psr\\Log\\LoggerInterface\n   *   The logger service.\n   */\n  abstract protected function getJobSkippingLogger(): LoggerInterface;\n\n  /**\n   * Gets the job storage service for job skipping operations.\n   *\n   * @return \\Drupal\\flowdrop_runtime\\Service\\Storage\\JobStorageInterface\n   *   The job storage service.\n   */\n  abstract protected function getJobSkippingStorage(): JobStorageInterface;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Orchestrator/Trait/JobSkippingTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "JobSkippingTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: InstallerRouteProviderLazyBuilder.php\nTarget symbol: class InstallerRouteProviderLazyBuilder\nNamespace: Drupal\\Core\\Installer\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for InstallerRouteProviderLazyBuilder.\n- Include required imports:\n  - Drupal\\Core\\Routing\\RouteProviderLazyBuilder\n  - Symfony\\Component\\Routing\\Route\n- Ensure these methods exist where relevant:\n  - getRouteByName()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Installer;\n\nuse Drupal\\Core\\Routing\\RouteProviderLazyBuilder;\nuse Symfony\\Component\\Routing\\Route;\n\n/**\n * A Route Provider front-end for use during the installer.\n */\nclass InstallerRouteProviderLazyBuilder extends RouteProviderLazyBuilder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRouteByName($name) {\n    if ($name === '<none>' || $name === '<front>') {\n      // During the installer template_preprocess_page() uses the routing system\n      // to determine the front page. At this point building the router for this\n      // is unnecessary work.\n      return new Route('/');\n    }\n    return parent::getRouteByName($name);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Installer/InstallerRouteProviderLazyBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InstallerRouteProviderLazyBuilder", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: UnifiedCacheManagerInterface.php\nTarget symbol: interface UnifiedCacheManagerInterface\nNamespace: Drupal\\api_normalization\\Service\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for UnifiedCacheManagerInterface.\n- Ensure these methods exist where relevant:\n  - createMonitoringDashboard()\n  - getPerformanceMetrics()\n  - invalidateByTags()\n  - optimizeCacheHierarchy()\n  - warmCache()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\n/**\n * Interface for Unified Cache Manager in AI Agent Orchestra optimization.\n */\ninterface UnifiedCacheManagerInterface {\n\n  /**\n   * Warm cache with critical data patterns.\n   *\n   * @param array $patterns\n   *   Cache patterns to warm. If empty, uses default critical patterns.\n   *\n   * @return array\n   *   Warming results with statistics.\n   */\n  public function warmCache(array $patterns = []): array;\n\n  /**\n   * Optimize cache hierarchy and tag structure.\n   *\n   * @return array\n   *   Optimization results with performance improvements.\n   */\n  public function optimizeCacheHierarchy(): array;\n\n  /**\n   * Get comprehensive performance metrics.\n   *\n   * @return array\n   *   Performance metrics for all cache layers.\n   */\n  public function getPerformanceMetrics(): array;\n\n  /**\n   * Create monitoring dashboard data.\n   *\n   * @return array\n   *   Dashboard data with real-time metrics and trends.\n   */\n  public function createMonitoringDashboard(): array;\n\n  /**\n   * Invalidate cache by tags with cascade support.\n   *\n   * @param array $tags\n   *   Cache tags to invalidate.\n   *\n   * @return int\n   *   Number of tags invalidated successfully.\n   */\n  public function invalidateByTags(array $tags): int;\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/UnifiedCacheManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "UnifiedCacheManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class Fieldset in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\n\n/**\n * Provides a render element for a group of form elements.\n *\n * Usage example:\n * @code\n * $form['author'] = [\n *   '#type' => 'fieldset',\n *   '#title' => $this->t('Author'),\n * ];\n *\n * $form['author']['name'] = [\n *   '#type' => 'textfield',\n *   '#title' => $this->t('Name'),\n * ];\n * @endcode\n *\n * @see \\Drupal\\Core\\Render\\Element\\Fieldgroup\n * @see \\Drupal\\Core\\Render\\Element\\Details\n */\n#[RenderElement('fieldset')]\nclass Fieldset extends RenderElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#process' => [\n        [static::class, 'processGroup'],\n        [static::class, 'processAjaxForm'],\n      ],\n      '#pre_render' => [\n        [static::class, 'preRenderGroup'],\n      ],\n      '#value' => NULL,\n      '#theme_wrappers' => ['fieldset'],\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/Fieldset.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Fieldset", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ViewsCache in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Annotation;\n\n/**\n * Defines a Plugin annotation object for views cache plugins.\n *\n * @see \\Drupal\\views\\Plugin\\views\\cache\\CachePluginBase\n *\n * @ingroup views_cache_plugins\n *\n * @Annotation\n */\nclass ViewsCache extends ViewsPluginAnnotationBase {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The plugin title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $title = '';\n\n  /**\n   * An optional short title used in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $short_title = '';\n\n  /**\n   * A short help string; this is displayed in the views UI.\n   *\n   * @var \\Drupal\\Core\\Annotation\\Translation\n   *\n   * @ingroup plugin_translatable\n   */\n  public $help = '';\n\n  /**\n   * The types of the display this plugin can be used with.\n   *\n   * For example the Feed display defines the type 'feed', so only rss style\n   * and row plugins can be used in the views UI.\n   *\n   * @var array\n   */\n  public $display_types;\n\n  /**\n   * The base tables on which this cache plugin can be used.\n   *\n   * If no base table is specified the plugin can be used with all tables.\n   *\n   * @var array\n   */\n  public $base;\n\n  /**\n   * Whether the plugin should be not selectable in the UI.\n   *\n   * If it's set to TRUE, you can still use it via the API in config files.\n   *\n   * @var bool\n   */\n  public $no_ui;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Annotation/ViewsCache.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ViewsCache", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "administer flowdrop triggers:\n  title: 'Administer FlowDrop triggers'\n  description: 'Create, edit, and delete trigger configurations.'\n  restrict access: true\n\nview flowdrop triggers:\n  title: 'View FlowDrop triggers'\n  description: 'View trigger configuration list and details.'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_trigger/flowdrop_trigger.permissions.yml", "type": "yaml_reference", "topic": "flowdrop trigger.permissions"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "toolbar-warning:\n  css:\n    component:\n      css/toolbar-warning.css: {}\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/demo_umami.libraries.yml", "type": "yaml_reference", "topic": "demo umami.libraries"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: UpdateBackend\nSource file: <source_file>\nFile name hint: UpdateBackend.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Update;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Cache\\NullBackend;\n\n/**\n * Defines a cache backend for use during Drupal database updates.\n *\n * Passes on deletes to another backend while extending the NullBackend to avoid\n * using anything cached prior to running updates.\n */\nclass UpdateBackend extends NullBackend {\n\n  /**\n   * The regular runtime cache backend.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   */\n  protected $backend;\n\n  /**\n   * UpdateBackend constructor.\n   *\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $backend\n   *   The regular runtime cache backend.\n   */\n  public function __construct(CacheBackendInterface $backend) {\n    $this->backend = $backend;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete($cid) {\n    $this->backend->delete($cid);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteMultiple(array $cids) {\n    $this->backend->deleteMultiple($cids);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteAll() {\n    $this->backend->deleteAll();\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Update;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Cache\\NullBackend;\n\n/**\n * Defines a cache backend for use during Drupal database updates.\n *\n * Passes on deletes to another backend while extending the NullBackend to avoid\n * using anything cached prior to running updates.\n */\nclass UpdateBackend extends NullBackend {\n\n  /**\n   * The regular runtime cache backend.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   */\n  protected $backend;\n\n  /**\n   * UpdateBackend constructor.\n   *\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $backend\n   *   The regular runtime cache backend.\n   */\n  public function __construct(CacheBackendInterface $backend) {\n    $this->backend = $backend;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function delete($cid) {\n    $this->backend->delete($cid);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteMultiple(array $cids) {\n    $this->backend->deleteMultiple($cids);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function deleteAll() {\n    $this->backend->deleteAll();\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Update/UpdateBackend.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UpdateBackend", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: PlaceBlock\nSource file: <source_file>\nFile name hint: PlaceBlock.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\mcp_tools_blocks\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_blocks\\Service\\BlockService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_place_block',\n  label: new TranslatableMarkup('Place Block'),\n  description: new TranslatableMarkup('Place a block in a theme region.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'plugin_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block Plugin ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'region' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme Region'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'theme' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Custom Block ID'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block Label'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'label_display' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label Display (visible/hidden)'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'weight' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Weight'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'visibility' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Visibility Conditions'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'settings' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Block Settings'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'block_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'plugin_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Plugin ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'region' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Region'),\n      description: new TranslatableMarkup(''),\n    ),\n    'theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass PlaceBlock extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'blocks';\n\n\n  protected BlockService $blockService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->blockService = $container->get('mcp_tools_blocks.block');\n    return $instance;\n  }\n", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_blocks\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_blocks\\Service\\BlockService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_place_block',\n  label: new TranslatableMarkup('Place Block'),\n  description: new TranslatableMarkup('Place a block in a theme region.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'plugin_id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block Plugin ID'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'region' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme Region'),\n      description: new TranslatableMarkup(''),\n      required: TRUE,\n    ),\n    'theme' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'id' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Custom Block ID'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'label' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block Label'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'label_display' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Label Display (visible/hidden)'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'weight' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Weight'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'visibility' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Visibility Conditions'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n    'settings' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Block Settings'),\n      description: new TranslatableMarkup(''),\n      required: FALSE,\n    ),\n  ],\n  output_definitions: [\n    'block_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Block ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'plugin_id' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Plugin ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'region' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Region'),\n      description: new TranslatableMarkup(''),\n    ),\n    'theme' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Theme'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass PlaceBlock extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'blocks';\n\n\n  protected BlockService $blockService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->blockService = $container->get('mcp_tools_blocks.block');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $pluginId = $input['plugin_id'] ?? '';\n    $region = $input['region'] ?? '';\n\n    if (empty($pluginId) || empty($region)) {\n      return ['success' => FALSE, 'error' => 'Both plugin_id and region are required.'];\n    }\n\n    $options = [];\n\n    if (isset($input['theme'])) {\n      $options['theme'] = $input['theme'];\n    }\n\n    if (isset($input['id'])) {\n      $options['id'] = $input['id'];\n    }\n\n    if (isset($input['label'])) {\n      $options['label'] = $input['label'];\n    }\n\n    if (isset($input['label_display'])) {\n      $options['label_display'] = $input['label_display'];\n    }\n\n    if (isset($input['weight'])) {\n      $options['weight'] = (int) $input['weight'];\n    }\n\n    if (isset($input['visibility'])) {\n      $options['visibility'] = $input['visibility'];\n    }\n\n    if (isset($input['settings'])) {\n      $options['settings'] = $input['settings'];\n    }\n\n    return $this->blockService->placeBlock($pluginId, $region, $options);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_blocks/src/Plugin/tool/Tool/PlaceBlock.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PlaceBlock", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: SchemaRegistry\nSource file: <source_file>\nFile name hint: SchemaRegistry.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\n\n/**\n * Registry for tool schemas with caching.\n */\nclass SchemaRegistry {\n\n  public function __construct(\n    private readonly ToolSchemaGenerator $schemaGenerator,\n    private readonly CacheBackendInterface $cache,\n    private readonly ModuleHandlerInterface $moduleHandler,\n  ) {}\n\n  /**\n   * Get OpenAPI schema for a tool.\n   *\n   * @param object $tool\n   *   The tool object.\n   * @param bool $useCache\n   *   Whether to use cached schema.\n   *\n   * @return array\n   *   OpenAPI schema array.\n   */\n  public function getSchema(object $tool, bool $useCache = TRUE): array {\n    $toolId = $this->getToolId($tool);\n    $cid = \"tool_schema:{$toolId}\";\n\n    if ($useCache) {\n      $cached = $this->cache->get($cid);\n      if ($cached) {\n        return $cached->data;\n      }\n    }\n\n    $schema = $this->schemaGenerator->generateOpenApiSchema($tool);\n    $this->cache->set($cid, $schema, time() + 3600, ['tool_schema', \"tool_schema:{$toolId}\"]);\n\n    return $schema;\n  }\n\n  /**\n   * Invalidate schema cache for a tool.\n   */\n  public function invalidateSchema(object $tool): void {\n    $toolId = $this->getToolId($tool);\n    $this->cache->invalidate(\"tool_schema:{$toolId}\");\n    $this->cache->invalidateTags([\"tool_schema:{$toolId}\"]);\n  }\n\n  /**\n   * Get all registered tool schemas.\n   *\n   * @return array\n   *   Array of tool_id => schema.\n   */\n  public function getAllSchemas(): array {\n    // This would need integration with Tool API to discover all tools.\n    // For now, return empty array.\n    return [];\n  }\n\n  /**\n   * Get tool ID.\n   */\n  protected function getToolId(object $tool): string {\n    if (method_exists($tool, 'getId')) {\n      return $tool->getId();\n    }\n    if (method_exists($tool, 'getPluginId')) {\n      return $tool->getPluginId();\n    }\n    if (isset($tool->id)) {\n      return $tool->id;\n    }\n    return 'unknown_tool';\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Service;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\n\n/**\n * Registry for tool schemas with caching.\n */\nclass SchemaRegistry {\n\n  public function __construct(\n    private readonly ToolSchemaGenerator $schemaGenerator,\n    private readonly CacheBackendInterface $cache,\n    private readonly ModuleHandlerInterface $moduleHandler,\n  ) {}\n\n  /**\n   * Get OpenAPI schema for a tool.\n   *\n   * @param object $tool\n   *   The tool object.\n   * @param bool $useCache\n   *   Whether to use cached schema.\n   *\n   * @return array\n   *   OpenAPI schema array.\n   */\n  public function getSchema(object $tool, bool $useCache = TRUE): array {\n    $toolId = $this->getToolId($tool);\n    $cid = \"tool_schema:{$toolId}\";\n\n    if ($useCache) {\n      $cached = $this->cache->get($cid);\n      if ($cached) {\n        return $cached->data;\n      }\n    }\n\n    $schema = $this->schemaGenerator->generateOpenApiSchema($tool);\n    $this->cache->set($cid, $schema, time() + 3600, ['tool_schema', \"tool_schema:{$toolId}\"]);\n\n    return $schema;\n  }\n\n  /**\n   * Invalidate schema cache for a tool.\n   */\n  public function invalidateSchema(object $tool): void {\n    $toolId = $this->getToolId($tool);\n    $this->cache->invalidate(\"tool_schema:{$toolId}\");\n    $this->cache->invalidateTags([\"tool_schema:{$toolId}\"]);\n  }\n\n  /**\n   * Get all registered tool schemas.\n   *\n   * @return array\n   *   Array of tool_id => schema.\n   */\n  public function getAllSchemas(): array {\n    // This would need integration with Tool API to discover all tools.\n    // For now, return empty array.\n    return [];\n  }\n\n  /**\n   * Get tool ID.\n   */\n  protected function getToolId(object $tool): string {\n    if (method_exists($tool, 'getId')) {\n      return $tool->getId();\n    }\n    if (method_exists($tool, 'getPluginId')) {\n      return $tool->getPluginId();\n    }\n    if (isset($tool->id)) {\n      return $tool->id;\n    }\n    return 'unknown_tool';\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Service/SchemaRegistry.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SchemaRegistry", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "entity.mcp_server.collection:\n  path: '/admin/structure/mcp-server'\n  defaults:\n    _entity_list: 'mcp_server'\n    _title: 'MCP Server configuration'\n  requirements:\n    _permission: 'administer mcp_server'\n\nentity.mcp_server.add_form:\n  path: '/admin/structure/mcp_server/add'\n  defaults:\n    _entity_form: 'mcp_server.add'\n    _title: 'Add a MCP Server'\n  requirements:\n    _permission: 'administer mcp_server'\n\nentity.mcp_server.edit_form:\n  path: '/admin/structure/mcp-server/{mcp_server}'\n  defaults:\n    _entity_form: 'mcp_server.edit'\n    _title: 'Edit a MCP Server'\n  requirements:\n    _permission: 'administer mcp_server'\n\nentity.mcp_server.delete_form:\n  path: '/admin/structure/mcp-server/{mcp_server}/delete'\n  defaults:\n    _entity_form: 'mcp_server.delete'\n    _title: 'Delete a MCP Server'\n  requirements:\n    _permission: 'administer mcp_server'\n", "metadata": {"source": "repos/mcp_client/mcp_client.routing.yml", "type": "yaml_reference", "topic": "mcp client.routing"}}
{"instruction": "Show me the implementation of the class FileStorageFactory in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Config;\n\nuse Drupal\\Core\\Site\\Settings;\n\n/**\n * Provides a factory for creating config file storage objects.\n */\nclass FileStorageFactory {\n\n  /**\n   * Returns a FileStorage object working with the sync config directory.\n   *\n   * @return \\Drupal\\Core\\Config\\FileStorage\n   *   The file storage object for the configuration sync directory.\n   *\n   * @throws \\Drupal\\Core\\Config\\ConfigDirectoryNotDefinedException\n   *   In case the sync directory does not exist or is not defined in\n   *   $settings['config_sync_directory'].\n   */\n  public static function getSync() {\n    $directory = Settings::get('config_sync_directory', FALSE);\n    if ($directory === FALSE) {\n      throw new ConfigDirectoryNotDefinedException('The config sync directory is not defined in $settings[\"config_sync_directory\"]');\n    }\n    return new FileStorage($directory);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Config/FileStorageFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileStorageFactory", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies: {  }\nid: api_endpoint\nname: 'API Endpoint'\ntype: api_endpoint\ndescription: 'An API endpoint imported from OpenAPI specifications. Supports automatic entity generation and ECA workflow integration.'\nhelp: 'Create and manage API endpoints with automatic field mapping and entity generation capabilities.'\nnew_revision: true\npreview_mode: 1\ndisplay_submitted: false\n", "metadata": {"source": "repos/api_normalization/config/install.disabled/node.type.api_endpoint.yml", "type": "yaml_reference", "topic": "node.type.api endpoint"}}
{"instruction": "Show me the implementation of the class Psr7RequestValueResolver in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Controller\\ArgumentResolver;\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Controller\\ValueResolverInterface;\nuse Symfony\\Component\\HttpKernel\\ControllerMetadata\\ArgumentMetadata;\n\n/**\n * Yields a PSR7 request object based on the request object passed along.\n */\nfinal class Psr7RequestValueResolver implements ValueResolverInterface {\n\n  /**\n   * The PSR-7 converter.\n   *\n   * @var \\Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface\n   */\n  protected $httpMessageFactory;\n\n  /**\n   * Constructs a new ControllerResolver.\n   *\n   * @param \\Symfony\\Bridge\\PsrHttpMessage\\HttpMessageFactoryInterface $http_message_factory\n   *   The PSR-7 converter.\n   */\n  public function __construct(HttpMessageFactoryInterface $http_message_factory) {\n    $this->httpMessageFactory = $http_message_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function resolve(Request $request, ArgumentMetadata $argument): array {\n    return $argument->getType() === ServerRequestInterface::class ? [$this->httpMessageFactory->createRequest($request)] : [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/ArgumentResolver/Psr7RequestValueResolver.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Psr7RequestValueResolver", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: EntityConstraintViolationListInterface.php\nTarget symbol: interface EntityConstraintViolationListInterface\nNamespace: Drupal\\Core\\Entity\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for EntityConstraintViolationListInterface.\n- Include required imports:\n  - Drupal\\Core\\Session\\AccountInterface\n  - Symfony\\Component\\Validator\\ConstraintViolationListInterface\n- Ensure these methods exist where relevant:\n  - filterByFieldAccess()\n  - filterByFields()\n  - findByCodes()\n  - getByField()\n  - getByFields()\n  - getEntity()\n  - getEntityViolations()\n  - getFieldNames()", "output": "<?php\n\nnamespace Drupal\\Core\\Entity;\n\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Symfony\\Component\\Validator\\ConstraintViolationListInterface;\n\n/**\n * Interface for the result of entity validation.\n *\n * The Symfony violation list is extended with methods that allow filtering\n * violations by fields and field access. Forms leverage that to skip possibly\n * pre-existing violations that cannot be caused or fixed by the form.\n */\ninterface EntityConstraintViolationListInterface extends ConstraintViolationListInterface {\n\n  /**\n   * Gets violations flagged on entity level, not associated with any field.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityConstraintViolationListInterface\n   *   A list of violations on the entity level.\n   */\n  public function getEntityViolations();\n\n  /**\n   * Gets the violations of the given field.\n   *\n   * @param string $field_name\n   *   The name of the field to get violations for.\n   *\n   * @return \\Symfony\\Component\\Validator\\ConstraintViolationListInterface\n   *   The violations of the given field.\n   */\n  public function getByField($field_name);\n\n  /**\n   * Gets the violations of the given fields.\n   *\n   * When violations should be displayed for a sub-set of visible fields only,\n   * this method may be used to filter the set of visible violations first.\n   *\n   * @param string[] $field_names\n   *   The names of the fields to get violations for.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityConstraintViolationListInterface\n   *   A list of violations of the given fields.\n   */\n  public function getByFields(array $field_names);\n\n  /**\n   * Filters this violation list by the given error codes.\n   *\n   * Copied from Symfony parent class\n   * \\Symfony\\Component\\Validator\\ConstraintViolationList.\n   *\n   * @param string|string[] $codes\n   *   The codes to find.\n   *\n   * @return \\Drupal\\Core\\Entity\\EntityConstraintViolationListInterface\n   *   A list of violations of the given fields.\n   */\n  public function findByCodes(string|array $codes): static;\n\n  /**\n   * Filters this violation list by the given fields.\n   *\n   * Violations for the provided fields are removed so the returned object just\n   * has the remaining violations.\n   *\n   * @param string[] $field_names\n   *   The names of the fields to filter violations for.\n   *\n   * @return $this\n   */\n  public function filterByFields(array $field_names);\n\n  /**\n   * Filters this violation list to apply for accessible fields only.\n   *\n   * Violations for inaccessible fields are removed so the returned object just\n   * has the remaining violations.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user for which to check access, or NULL to check access\n   *   for the current user. Defaults to NULL.\n   *\n   * @return $this\n   */\n  public function filterByFieldAccess(?AccountInterface $account = NULL);\n\n  /**\n   * Returns the names of all violated fields.\n   *\n   * @return string[]\n   *   An array of field names.\n   */\n  public function getFieldNames();\n\n  /**\n   * The entity which has been validated.\n   *\n   * @return \\Drupal\\Core\\Entity\\FieldableEntityInterface\n   *   The entity object.\n   */\n  public function getEntity();\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/EntityConstraintViolationListInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EntityConstraintViolationListInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ConfigurableSearchPluginInterface.php\nTarget symbol: interface for\nNamespace: Drupal\\search\\Plugin\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for for.\n- Include required imports:\n  - Drupal\\Component\\Plugin\\ConfigurableInterface\n  - Drupal\\Component\\Plugin\\DependentPluginInterface\n  - Drupal\\Core\\Plugin\\PluginFormInterface\n- Ensure these methods exist where relevant:\n  - setSearchPageId()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\search\\Plugin;\n\nuse Drupal\\Component\\Plugin\\ConfigurableInterface;\nuse Drupal\\Component\\Plugin\\DependentPluginInterface;\nuse Drupal\\Core\\Plugin\\PluginFormInterface;\n\n/**\n * Provides an interface for a configurable Search plugin.\n */\ninterface ConfigurableSearchPluginInterface extends ConfigurableInterface, DependentPluginInterface, PluginFormInterface, SearchInterface {\n\n  /**\n   * Sets the ID for the search page using this plugin.\n   *\n   * @param string $search_page_id\n   *   The search page ID.\n   *\n   * @return static\n   */\n  public function setSearchPageId($search_page_id);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/search/src/Plugin/ConfigurableSearchPluginInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ConfigurableSearchPluginInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ThemeEngineExtensionList in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Extension;\n\n/**\n * Provides a list of available theme engines.\n *\n * @internal\n *   This class is not yet stable and therefore there are no guarantees that the\n *   internal implementations including constructor signature and protected\n *   properties / methods will not change over time. This will be reviewed after\n *   https://www.drupal.org/project/drupal/issues/2940481\n */\nclass ThemeEngineExtensionList extends ExtensionList {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected $defaults = [\n    'dependencies' => [],\n    'description' => '',\n    'package' => 'Other',\n    'version' => NULL,\n    'php' => \\Drupal::MINIMUM_PHP,\n  ];\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getInstalledExtensionNames() {\n    // Theme engines do not have an 'install' state, so return names of all\n    // discovered theme engines.\n    return array_keys($this->extensions);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Extension/ThemeEngineExtensionList.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ThemeEngineExtensionList", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: NavigationMenuLinkTreeManipulators.php\nTarget symbol: class NavigationMenuLinkTreeManipulators\nNamespace: Drupal\\navigation\\Menu\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for NavigationMenuLinkTreeManipulators.\n- Include required imports:\n  - Drupal\\Core\\Menu\\MenuLinkDefault\n  - Drupal\\Core\\Menu\\MenuLinkTreeElement\n  - Drupal\\Core\\Menu\\StaticMenuLinkOverridesInterface\n  - Drupal\\Core\\Routing\\RouteProviderInterface\n  - Drupal\\Core\\StringTranslation\\StringTranslationTrait\n  - Drupal\\Core\\StringTranslation\\TranslationInterface\n  - Drupal\\system\\Controller\\SystemController\n  - Symfony\\Component\\Routing\\Exception\\RouteNotFoundException\n- Ensure these methods exist where relevant:\n  - __construct()\n  - addOverviewLink()\n  - addSecondLevelOverviewLinks()\n  - isEnabledAndAccessible()\n  - shouldAddOverviewLink()", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\navigation\\Menu;\n\nuse Drupal\\Core\\Menu\\MenuLinkDefault;\nuse Drupal\\Core\\Menu\\MenuLinkTreeElement;\nuse Drupal\\Core\\Menu\\StaticMenuLinkOverridesInterface;\nuse Drupal\\Core\\Routing\\RouteProviderInterface;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\Core\\StringTranslation\\TranslationInterface;\nuse Drupal\\system\\Controller\\SystemController;\nuse Symfony\\Component\\Routing\\Exception\\RouteNotFoundException;\n\n/**\n * Provides a menu link tree manipulator for the navigation menu block.\n */\nclass NavigationMenuLinkTreeManipulators {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    protected readonly RouteProviderInterface $routeProvider,\n    protected readonly StaticMenuLinkOverridesInterface $overrides,\n    TranslationInterface $translation,\n  ) {\n    $this->setStringTranslation($translation);\n  }\n\n  /**\n   * Adds an \"overview\" child link to second level menu links with children.\n   *\n   * In the navigation menu, a second-level menu item is a link if it does not\n   * have children, but if it does, it instead becomes a button that opens\n   * its child menu. To provide a way to access the page a second-level menu\n   * item links to, add an \"overview\" link that links to the page as a child\n   * (third-level) menu item.\n   *\n   * @param \\Drupal\\Core\\Menu\\MenuLinkTreeElement[] $tree\n   *   The menu link tree to manipulate.\n   *\n   * @return \\Drupal\\Core\\Menu\\MenuLinkTreeElement[]\n   *   The manipulated menu link tree.\n   */\n  public function addSecondLevelOverviewLinks(array $tree): array {\n    if (!$tree) {\n      return [];\n    }\n\n    foreach ($tree as $item) {\n      if (!$this->isEnabledAndAccessible($item)) {\n        continue;\n      }\n      foreach ($item->subtree as $sub_item) {\n        if ($this->shouldAddOverviewLink($sub_item)) {\n          $this->addOverviewLink($sub_item);\n        }\n      }\n    }\n\n    return $tree;\n  }\n\n  /**\n   * Whether a menu tree element should have an overview link added to it.\n   *\n   * @param \\Drupal\\Core\\Menu\\MenuLinkTreeElement $element\n   *   The menu link tree element to check.\n   *\n   * @return bool\n   *   TRUE if menu tree element should have a child overview link added.\n   */\n  protected function shouldAddOverviewLink(MenuLinkTreeElement $element): bool {\n    if (empty($element->subtree) || !$this->isEnabledAndAccessible($element)) {\n      return FALSE;\n    }\n\n    $route_name = $element->link->getRouteName();\n    if (in_array($route_name, ['<nolink>', '<button>'])) {\n      return FALSE;\n    }\n\n    $has_visible_children = FALSE;\n    foreach ($element->subtree as $sub_element) {\n      // Do not add overview link if there are no accessible or enabled\n      // children.\n      if ($this->isEnabledAndAccessible($sub_element)) {\n        $has_visible_children = TRUE;\n      }\n\n      // Do not add overview link if there is already a child linking to the\n      // same URL.\n      if ($sub_element->link->getRouteName() === $route_name) {\n        return FALSE;\n      }\n    }\n\n    if (!$has_visible_children) {\n      return FALSE;\n    }\n\n    // The systemAdminMenuBlockPage() method in SystemController returns a list\n    // of child menu links for the page. If the second-level menu item link's\n    // route uses that controller, do not add the overview link, because that\n    // duplicates what is already in the navigation menu.\n    try {\n      $controller = ltrim($this->routeProvider->getRouteByName($route_name)->getDefault('_controller') ?? '', \"\\\\\");\n      return $controller !== SystemController::class . '::systemAdminMenuBlockPage';\n    }\n    catch (RouteNotFoundException) {\n      return TRUE;\n    }\n  }\n\n  /**\n   * Checks whether the menu link tree element is accessible and enabled.\n   *\n   * Generally, the 'checkAccess' manipulator should run before this manipulator\n   * does, so the access objects should be set on all the links, but if it is\n   * not, treat the link as accessible for the purpose of adding the overview\n   * child link.\n   *\n   * @param \\Drupal\\Core\\Menu\\MenuLinkTreeElement $element\n   *   The menu link tree element to be checked.\n   *\n   * @return bool\n   *   TRUE if the menu link tree element is enabled and has access allowed.\n   */\n  protected function isEnabledAndAccessible(MenuLinkTreeElement $element): bool {\n    return $element->link->isEnabled() && (!isset($element->access) || $element->access->isAllowed());\n  }\n\n  /**\n   * Adds \"overview\" menu tree element as child of a menu tree element.\n   *\n   * @param \\Drupal\\Core\\Menu\\MenuLinkTreeElement $element\n   *   The menu link tree element to add the overview child element to.\n   */\n  protected function addOverviewLink(MenuLinkTreeElement $element): void {\n    // Copy the menu link for the menu link element to a new menu link\n    // definition, except with overrides to make 'Overview' the title, set the\n    // parent to the original menu link, and set weight to a low number so that\n    // it likely goes to the top.\n    $definition = [\n      'title' => $this->t('Overview', [\n        '@title' => $element->link->getTitle(),\n      ]),\n      'parent' => $element->link->getPluginId(),\n      'provider' => 'navigation',\n      'weight' => -1000,\n    ] + $element->link->getPluginDefinition();\n    $link = new MenuLinkDefault([], $element->link->getPluginId() . '.navigation_overview', $definition, $this->overrides);\n    $overview_element = new MenuLinkTreeElement($link, FALSE, $element->depth + 1, $element->inActiveTrail, []);\n    $overview_element->access = $element->access ? clone $element->access : NULL;\n    $element->subtree[$element->link->getPluginId() . '.navigation_overview'] = $overview_element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/navigation/src/Menu/NavigationMenuLinkTreeManipulators.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "NavigationMenuLinkTreeManipulators", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class OrderSubscriber in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\commerce_referral\\EventSubscriber;\n\nuse Drupal\\commerce_order\\Entity\\OrderInterface;\nuse Drupal\\commerce_referral\\ReferralManager;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Logger\\LoggerChannelInterface;\nuse Drupal\\state_machine\\Event\\WorkflowTransitionEvent;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Subscribes to order events to award referral kickbacks.\n */\nclass OrderSubscriber implements EventSubscriberInterface {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected EntityTypeManagerInterface $entityTypeManager;\n\n  /**\n   * The logger.\n   *\n   * @var \\Drupal\\Core\\Logger\\LoggerChannelInterface\n   */\n  protected LoggerChannelInterface $logger;\n\n  /**\n   * The referral manager.\n   *\n   * @var \\Drupal\\commerce_referral\\ReferralManager\n   */\n  protected ReferralManager $referralManager;\n\n  /**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected ConfigFactoryInterface $configFactory;\n\n  public function __construct(\n    EntityTypeManagerInterface $entity_type_manager,\n    LoggerChannelInterface $logger,\n    ReferralManager $referral_manager,\n    ConfigFactoryInterface $config_factory,\n  ) {\n    $this->entityTypeManager = $entity_type_manager;\n    $this->logger = $logger;\n    $this->referralManager = $referral_manager;\n    $this->configFactory = $config_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    // Note: We cannot read config in a static method, so we subscribe to both\n    // possible events and determine which one to process in the handler method.\n    return [\n      'commerce_order.place.post_transition' => 'onOrderTransition',\n      'commerce_order.paid.post_transition' => 'onOrderTransition',\n    ];\n  }\n\n  /**\n   * Awards the kickback to referrers when a referral coupon was used.\n   */\n  public function onOrderTransition(WorkflowTransitionEvent $event): void {\n    // Check if this is the configured event to award kickbacks.\n    $config = $this->configFactory->get('commerce_referral.settings');\n    $kickback_event = $config->get('kickback_event') ?? 'place';\n    $transition_id = $event->getTransition()->getId();\n\n    // Only process if this is the configured transition.\n    if ($transition_id !== $kickback_event) {\n      return;\n    }\n\n    /** @var \\Drupal\\commerce_order\\Entity\\OrderInterface $order */\n    $order = $event->getEntity();\n    /** @var ?\\Drupal\\commerce_promotion\\Entity\\CouponInterface[] $coupons */\n    $coupons = $order->get('coupons')->referencedEntities();\n    if (empty($coupons)) {\n      return;\n    }\n\n    $customer = $order->getCustomer();\n\n    foreach ($coupons as $coupon) {\n      // Check if this coupon corresponds to a referral entity.\n      $referral = $this->referralManager->loadReferralByCouponId((string) $coupon->id());\n      if (!$referral) {\n        continue;\n      }\n\n      // If the order customer is the referrer, skip (self-use should already\n      // be blocked by validation but double-check).\n      $referrer_uid = (int) $referral->get('referrer_user')->target_id;\n      $customer_uid = (int) $customer->id();\n      if ($referrer_uid && $customer_uid && $referrer_uid === $customer_uid) {\n        continue;\n      }\n\n      // If referee_user not set, set it now.\n      if ($referral->get('referee_user')->isEmpty()) {\n        $referral->set('referee_user', $customer->id());\n      }\n\n      // Ensure kickback not already awarded for this referral.\n      if (!$referral->get('kickback_coupon')->isEmpty()) {\n        $referral->save();\n        continue;\n      }\n\n      try {\n        /** @var ?\\Drupal\\user\\UserInterface $referrer */\n        $referrer = $this->entityTypeManager->getStorage('user')->load($referrer_uid);\n        if ($referrer) {\n          $this->referralManager->awardKickback($referral, $referrer);\n          $this->logger->info('Awarded kickback coupon for referral @rid to user @uid.', [\n            '@rid' => $referral->id(),\n            '@uid' => $referrer_uid,\n          ]);\n        }\n      }\n      catch (\\Throwable $e) {\n        $this->logger->error('Failed awarding kickback for referral @rid: @msg', [\n          '@rid' => $referral->id(),\n          '@msg' => $e->getMessage(),\n        ]);\n      }\n\n      $referral->save();\n    }\n  }\n\n}\n", "metadata": {"source": "repos/commerce_referral/src/EventSubscriber/OrderSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "OrderSubscriber", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class VocabularyStorage in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\taxonomy;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityStorage;\n\n/**\n * Defines a storage handler class for taxonomy vocabularies.\n */\nclass VocabularyStorage extends ConfigEntityStorage implements VocabularyStorageInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getToplevelTids($vids) {\n    $tids = \\Drupal::entityQuery('taxonomy_term')\n      ->accessCheck(TRUE)\n      ->condition('vid', $vids, 'IN')\n      ->condition('parent.target_id', 0)\n      ->execute();\n\n    return array_values($tids);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/taxonomy/src/VocabularyStorage.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "VocabularyStorage", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class LocaleTranslation in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\locale;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\nuse Drupal\\Core\\DestructableInterface;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Drupal\\Core\\Language\\LanguageManagerInterface;\nuse Drupal\\Core\\Lock\\LockBackendInterface;\nuse Drupal\\Core\\StringTranslation\\Translator\\TranslatorInterface;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * String translator using the locale module.\n *\n * Full featured translation system using locale's string storage and\n * database caching.\n */\nclass LocaleTranslation implements TranslatorInterface, DestructableInterface {\n\n  use DependencySerializationTrait {\n    __sleep as traitSleep;\n  }\n\n  /**\n   * Storage for strings.\n   *\n   * @var \\Drupal\\locale\\StringStorageInterface\n   */\n  protected $storage;\n\n  /**\n   * The configuration factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * Cached translations.\n   *\n   * @var array\n   *   Array of \\Drupal\\locale\\LocaleLookup objects indexed by language code\n   *   and context.\n   */\n  protected $translations = [];\n\n  /**\n   * The cache backend that should be used.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   */\n  protected $cache;\n\n  /**\n   * The lock backend that should be used.\n   *\n   * @var \\Drupal\\Core\\Lock\\LockBackendInterface\n   */\n  protected $lock;\n\n  /**\n   * The translate english configuration value.\n   *\n   * @var bool\n   */\n  protected $translateEnglish;\n\n  /**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   */\n  protected $languageManager;\n\n  /**\n   * The request stack.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   */\n  protected $requestStack;\n\n  /**\n   * Constructs a translator using a string storage.\n   *\n   * @param \\Drupal\\locale\\StringStorageInterface $storage\n   *   Storage to use when looking for new translations.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache\n   *   The cache backend.\n   * @param \\Drupal\\Core\\Lock\\LockBackendInterface $lock\n   *   The lock backend.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   * @param \\Symfony\\Component\\HttpFoundation\\RequestStack $request_stack\n   *   The request stack.\n   */\n  public function __construct(StringStorageInterface $storage, CacheBackendInterface $cache, LockBackendInterface $lock, ConfigFactoryInterface $config_factory, LanguageManagerInterface $language_manager, RequestStack $request_stack) {\n    $this->storage = $storage;\n    $this->cache = $cache;\n    $this->lock = $lock;\n    $this->configFactory = $config_factory;\n    $this->languageManager = $language_manager;\n    $this->requestStack = $request_stack;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getStringTranslation($langcode, $string, $context) {\n    // If the language is not suitable for locale module, just return.\n    if ($langcode == LanguageInterface::LANGCODE_SYSTEM || ($langcode == 'en' && !$this->canTranslateEnglish())) {\n      return FALSE;\n    }\n    // Strings are cached by langcode, context and roles, using instances of the\n    // LocaleLookup class to handle string lookup and caching.\n    if (!isset($this->translations[$langcode][$context])) {\n      $this->translations[$langcode][$context] = new LocaleLookup($langcode, $context, $this->storage, $this->cache, $this->lock, $this->configFactory, $this->languageManager, $this->requestStack);\n    }\n    $translation = $this->translations[$langcode][$context]->get($string);\n    // If the translation is TRUE, no translation exists, but that string needs\n    // to be stored in the persistent cache for performance reasons (so for\n    // example, we don't have hundreds of queries to locale tables on each\n    // request). That cache is persisted when the request ends, and the lookup\n    // service is destroyed.\n    return $translation === TRUE ? FALSE : $translation;\n  }\n\n  /**\n   * Gets translate english configuration value.\n   *\n   * @return bool\n   *   TRUE if english should be translated, FALSE if not.\n   */\n  protected function canTranslateEnglish() {\n    if (!isset($this->translateEnglish)) {\n      $this->translateEnglish = $this->configFactory->get('locale.settings')->get('translate_english');\n    }\n    return $this->translateEnglish;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function reset() {\n    unset($this->translateEnglish);\n    $this->translations = [];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function destruct() {\n    foreach ($this->translations as $context) {\n      foreach ($context as $lookup) {\n        if ($lookup instanceof DestructableInterface) {\n          $lookup->destruct();\n        }\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __sleep(): array {\n    // ::$translations is an array of LocaleLookup objects, which have the\n    // database service injected and therefore cannot be serialized safely.\n    return array_diff($this->traitSleep(), ['translations']);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/locale/src/LocaleTranslation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "LocaleTranslation", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: \"Default\"\nslots:\n  content:\n    - type: html_tag\n      tag: p\n      value: \"A well-known quote, contained in a blockquote element.\"\n", "metadata": {"source": "repos/bootstrap_components/components/blockquote/stories/blockquote.default.story.yml", "type": "yaml_reference", "topic": "blockquote.default.story"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SodiumKeyPairRepositoryInterface.php\nTarget symbol: interface SodiumKeyPairRepositoryInterface\nNamespace: Drupal\\easy_encryption\\Sodium\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for SodiumKeyPairRepositoryInterface.\n- Ensure these methods exist where relevant:\n  - deleteKeyPair()\n  - generateKeyPair()\n  - getKeyPairById()\n  - listKeyPairIds()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\Sodium;\n\n/**\n * Provides access to sodium key pairs used for encryption and decryption.\n */\ninterface SodiumKeyPairRepositoryInterface {\n\n  /**\n   * Returns a key pair by its identifier.\n   *\n   * Implementations MAY omit the private key when the current environment is\n   * not allowed to perform decryption.\n   *\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairNotFoundException\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n   */\n  public function getKeyPairById(string $id): SodiumKeyPair;\n\n  /**\n   * Generates and persists a key pair for the given identifier.\n   *\n   * This method MUST:\n   * - Generate a cryptographically secure libsodium key pair.\n   * - Persist the public key.\n   * - Persist the private key where appropriate for the environment.\n   *\n   * This method MUST NOT change which key pair is active.\n   *\n   * @param string $id\n   *   The key pair identifier to generate.\n   *\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n   *   Thrown if generation or persistence fails.\n   */\n  public function generateKeyPair(string $id): void;\n\n  /**\n   * Returns identifiers for all stored key pairs.\n   *\n   * Implementations MUST return identifiers for all key pairs known to\n   * the repository, regardless of whether the corresponding private\n   * keys are available in the current environment.\n   *\n   * @return string[]\n   *   An array of key pair identifiers.\n   */\n  public function listKeyPairIds(): array;\n\n  /**\n   * Deletes a key pair by its identifier.\n   *\n   * Implementations MUST refuse to delete the currently active key pair.\n   * Callers SHOULD rotate to a new active key pair before attempting to\n   * delete an older one.\n   *\n   * @param string $id\n   *   The key pair identifier to delete.\n   *\n   * @throws \\Drupal\\easy_encryption\\Sodium\\Exception\\SodiumKeyPairOperationException\n   *   Thrown if the key pair is active, or if deletion fails due to a\n   *   storage or permissions error.\n   */\n  public function deleteKeyPair(string $id): void;\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/Sodium/SodiumKeyPairRepositoryInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SodiumKeyPairRepositoryInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class DblogClearLogConfirmForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\dblog\\Form;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Database\\Connection;\nuse Drupal\\Core\\Form\\ConfirmFormBase;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a confirmation form before clearing out the logs.\n *\n * @internal\n */\nclass DblogClearLogConfirmForm extends ConfirmFormBase {\n\n  /**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   */\n  protected $connection;\n\n  /**\n   * Constructs a new DblogClearLogConfirmForm.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection.\n   */\n  public function __construct(Connection $connection) {\n    $this->connection = $connection;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('database')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'dblog_confirm';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getQuestion() {\n    return $this->t('Are you sure you want to delete the recent logs?');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCancelUrl() {\n    return new Url('dblog.overview');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $this->getRequest()->getSession()->remove('dblog_overview_filter');\n    $this->connection->truncate('watchdog')->execute();\n    $this->messenger()->addStatus($this->t('Database log cleared.'));\n    $form_state->setRedirectUrl($this->getCancelUrl());\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/dblog/src/Form/DblogClearLogConfirmForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DblogClearLogConfirmForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface JobStorageInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Storage;\n\nuse Drupal\\flowdrop_job\\FlowDropJobInterface;\nuse Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface;\n\n/**\n * Interface for job storage operations.\n *\n * This interface abstracts job persistence, allowing different storage\n * backends (Drupal entities, in-memory, Redis, etc.) to be used interchangeably.\n *\n * Implementations:\n * - DrupalJobStorage: Persistent storage using Drupal entities\n * - InMemoryJobStorage: Fast ephemeral storage for synchronous execution\n * - (Future) RedisJobStorage: Fast persistent storage\n */\ninterface JobStorageInterface {\n\n  /**\n   * Creates a new job.\n   *\n   * @param array $data\n   *   The job data with the following keys:\n   *   - label: (string) Human-readable label\n   *   - bundle: (string) Bundle/type (default: 'default')\n   *   - node_id: (string) The workflow node ID\n   *   - pipeline_id: (string|int) The parent pipeline ID\n   *   - metadata: (array|string) Job metadata (JSON encoded if string)\n   *   - status: (string) Initial status (default: 'idle')\n   *   - priority: (int) Job priority\n   *   - max_retries: (int) Maximum retry count\n   *   - dependent_jobs: (array) IDs of jobs this job depends on\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface\n   *   The created job (not yet saved).\n   */\n  public function create(array $data): FlowDropJobInterface;\n\n  /**\n   * Loads a job by ID.\n   *\n   * @param string|int $id\n   *   The job ID.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface|null\n   *   The job entity, or NULL if not found.\n   */\n  public function load(string|int $id): ?FlowDropJobInterface;\n\n  /**\n   * Loads multiple jobs by ID.\n   *\n   * @param array $ids\n   *   Array of job IDs.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of job entities keyed by ID.\n   */\n  public function loadMultiple(array $ids): array;\n\n  /**\n   * Saves a job.\n   *\n   * @param \\Drupal\\flowdrop_job\\FlowDropJobInterface $job\n   *   The job to save.\n   */\n  public function save(FlowDropJobInterface $job): void;\n\n  /**\n   * Deletes a job.\n   *\n   * @param \\Drupal\\flowdrop_job\\FlowDropJobInterface $job\n   *   The job to delete.\n   */\n  public function delete(FlowDropJobInterface $job): void;\n\n  /**\n   * Gets all jobs for a pipeline.\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of job entities.\n   */\n  public function getByPipeline(FlowDropPipelineInterface $pipeline): array;\n\n  /**\n   * Gets jobs for a pipeline filtered by status.\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline.\n   * @param string $status\n   *   The status to filter by (e.g., 'idle', 'pending', 'completed', 'failed').\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of job entities with the specified status.\n   */\n  public function getByPipelineAndStatus(FlowDropPipelineInterface $pipeline, string $status): array;\n\n  /**\n   * Gets jobs that are ready to run.\n   *\n   * A job is ready when:\n   * - Its status is 'pending' OR\n   * - Its status is 'idle' AND all dependent jobs are completed\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of ready job entities.\n   */\n  public function getReadyJobs(FlowDropPipelineInterface $pipeline): array;\n\n  /**\n   * Resets the storage cache.\n   *\n   * For entity-based storage, this clears the static entity cache.\n   * For in-memory storage, this may be a no-op.\n   *\n   * @param array|null $ids\n   *   Optional array of job IDs to reset. If NULL, reset all.\n   */\n  public function resetCache(?array $ids = NULL): void;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Storage/JobStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "JobStorageInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class FindBySource in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_redirect\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_redirect\\Service\\RedirectService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_redirect_find',\n  label: new TranslatableMarkup('Find Redirect by Source'),\n  description: new TranslatableMarkup('Find a redirect by its source path.'),\n  operation: ToolOperation::Read,\n  input_definitions: [\n    'source' => new InputDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Source Path'),\n      description: new TranslatableMarkup('The source path to search for (e.g., \"old-page\" or \"/old-page\").'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'found' => new ContextDefinition(\n      data_type: 'boolean',\n      label: new TranslatableMarkup('Redirect Found'),\n      description: new TranslatableMarkup(''),\n    ),\n    'redirect' => new ContextDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Redirect Details'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass FindBySource extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'redirect';\n\n\n  protected RedirectService $redirectService;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->redirectService = $container->get('mcp_tools_redirect.redirect');\n    return $instance;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function executeLegacy(array $input): array {\n    $source = $input['source'] ?? '';\n\n    if (empty($source)) {\n      return ['success' => FALSE, 'error' => 'Source path is required.'];\n    }\n\n    return $this->redirectService->findBySource($source);\n  }\n\n\n\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_redirect/src/Plugin/tool/Tool/FindBySource.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FindBySource", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: <h3>Phase 6: Security, Governance & Enterprise Hardening</h3>", "input": "", "output": "<h3>Phase 6: Security, Governance & Enterprise Hardening</h3>\n<p>\nPhase 6 focuses on ensuring FlowDrop meets enterprise-grade standards for security, compliance, governance, and operational reliability. With workflows potentially spanning AI processing, external integrations, and large-scale automation, this phase establishes the policies, auditing, and operational guardrails necessary for production deployment in secure and regulated environments.\n</p>\n\n<h4>Goals</h4>\n<ul>\n  <li>Implement comprehensive security measures for workflows, nodes, and integrations.</li>\n  <li>Provide governance controls and auditing capabilities for workflow management.</li>\n  <li>Ensure high availability, disaster recovery, and multi-environment support.</li>\n  <li>Meet enterprise compliance and data protection requirements.</li>\n</ul>\n\n<h3>Phase 6.1: Security Framework</h3>\n<p>\nHarden FlowDrop at every layer to protect against unauthorized access, data leaks, and misconfiguration risks.\n</p>\n\n<h4>Tasks</h4>\n<ul>\n  <li><strong>6.1.1: Authentication & Authorization</strong>\n    <ul>\n      <li>Integrate workflow-level access control using Drupal's roles and permissions system.</li>\n      <li>Support fine-grained permissions for workflow creation, execution, and node management.</li>\n      <li>Implement optional Single Sign-On (SSO) and two-factor authentication for enterprise use.</li>\n    </ul>\n  </li>\n  <li><strong>6.1.2: Data Security & Encryption</strong>\n    <ul>\n      <li>Encrypt sensitive workflow configuration and stored credentials in the database.</li>\n      <li>Implement secure storage and rotation mechanisms for API keys and tokens.</li>\n      <li>Ensure secure communication between nodes and external systems via TLS/HTTPS.</li>\n    </ul>\n  </li>\n  <li><strong>6.1.3: Secure Node Execution</strong>\n    <ul>\n      <li>Introduce execution sandboxing to prevent malicious code from affecting Drupal.</li>\n      <li>Enforce node-level resource limits for memory, execution time, and API requests.</li>\n      <li>Implement audit logging for all node executions and data transformations.</li>\n    </ul>\n  </li>\n</ul>\n\n<h3>Phase 6.2: Governance & Compliance</h3>\n<p>\nEstablish governance controls to ensure workflows are auditable, compliant with regulations, and safely managed in multi-user environments.\n</p>\n\n<h4>Tasks</h4>\n<ul>\n  <li><strong>6.2.1: Workflow Auditing & Logging</strong>\n    <ul>\n      <li>Maintain immutable audit logs of workflow changes, node executions, and user actions.</li>\n      <li>Provide visual dashboards for workflow activity and data lineage tracking.</li>\n      <li>Enable integration with enterprise SIEM tools via syslog or API.</li>\n    </ul>\n  </li>\n  <li><strong>6.2.2: Versioning & Change Management</strong>\n    <ul>\n      <li>Introduce workflow versioning with the ability to rollback to prior states.</li>\n      <li>Support staged promotion from development to staging and production environments.</li>\n      <li>Allow export/import of workflow configurations with checksums for integrity verification.</li>\n    </ul>\n  </li>\n  <li><strong>6.2.3: Regulatory Compliance Alignment</strong>\n    <ul>\n      <li>Ensure workflows adhere to GDPR, HIPAA, or industry-specific requirements when applicable.</li>\n      <li>Provide configurable data retention and deletion policies for sensitive logs.</li>\n      <li>Offer optional anonymization and masking features for PII during processing.</li>\n    </ul>\n  </li>\n</ul>\n\n<h3>Phase 6.3: Enterprise Hardening & Reliability</h3>\n<p>\nPrepare FlowDrop for mission-critical enterprise deployments with high availability, observability, and disaster recovery.\n</p>\n\n<h4>Tasks</h4>\n<ul>\n  <li><strong>6.3.1: High Availability & Failover</strong>\n    <ul>\n      <li>Ensure the job execution engine supports multi-server or containerized scaling.</li>\n      <li>Introduce failover strategies for running workflows if a node or server goes down.</li>\n      <li>Optionally integrate with Redis or database replication for queue persistence.</li>\n    </ul>\n  </li>\n  <li><strong>6.3.2: Observability & Metrics</strong>\n    <ul>\n      <li>Provide Prometheus-compatible metrics for workflow performance and system health.</li>\n      <li>Enable alerting on execution failures, node timeouts, or resource exhaustion.</li>\n      <li>Visualize long-running workflows and bottlenecks through extended monitoring dashboards.</li>\n    </ul>\n  </li>\n  <li><strong>6.3.3: Backup & Disaster Recovery</strong>\n    <ul>\n      <li>Offer automated backup of workflows, logs, and configurations.</li>\n      <li>Allow restoration of workflows and associated job states in case of failure.</li>\n      <li>Document best practices for deploying FlowDrop in redundant environments.</li>\n    </ul>\n  </li>\n</ul>\n\n<h3>Phase 6 Outcome</h3>\n<p>\nBy completing Phase 6, FlowDrop achieves enterprise readiness with full security, governance, and operational hardening. Workflows can safely operate in multi-tenant or highly regulated environments, ensuring that organizations can adopt FlowDrop at scale with confidence.\n</p>\n", "metadata": {"source": "repos/flowdrop/docs/pm/phase6.md", "type": "doc_summary", "topic": "<h3>Phase 6: Security, Governance & Enterprise Hardening</h3>"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: SessionManagerInterface.php\nTarget symbol: interface SessionManagerInterface\nNamespace: Drupal\\Core\\Session\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for SessionManagerInterface.\n- Include required imports:\n  - Symfony\\Component\\HttpFoundation\\Session\\Storage\\SessionStorageInterface\n- Ensure these methods exist where relevant:\n  - delete()\n  - destroy()\n  - setWriteSafeHandler()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\Session;\n\nuse Symfony\\Component\\HttpFoundation\\Session\\Storage\\SessionStorageInterface;\n\n/**\n * Defines the session manager interface.\n */\ninterface SessionManagerInterface extends SessionStorageInterface {\n\n  /**\n   * Ends a specific user's session(s).\n   *\n   * @param int $uid\n   *   User ID.\n   */\n  public function delete($uid);\n\n  /**\n   * Destroys the current session and removes session cookies.\n   */\n  public function destroy();\n\n  /**\n   * Sets the write safe session handler.\n   *\n   * @todo This should be removed once all database queries are removed from\n   *   the session manager class.\n   *\n   * @var \\Drupal\\Core\\Session\\WriteSafeSessionHandlerInterface\n   */\n  public function setWriteSafeHandler(WriteSafeSessionHandlerInterface $handler);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Session/SessionManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "SessionManagerInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface KeyValueStoreExpirableInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\KeyValueStore;\n\n/**\n * Defines the interface for expiring data in a key/value store.\n */\ninterface KeyValueStoreExpirableInterface extends KeyValueStoreInterface {\n\n  /**\n   * Saves a value for a given key with a time to live.\n   *\n   * @param string $key\n   *   The key of the data to store.\n   * @param mixed $value\n   *   The data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  public function setWithExpire($key, $value, $expire);\n\n  /**\n   * Sets a value for a given key with a time to live if it does not yet exist.\n   *\n   * If a key is expired it also does not exists.\n   *\n   * @param string $key\n   *   The key of the data to store.\n   * @param mixed $value\n   *   The data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   *\n   * @return bool\n   *   TRUE if the data was set, or FALSE if it already existed.\n   */\n  public function setWithExpireIfNotExists($key, $value, $expire);\n\n  /**\n   * Saves an array of values with a time to live.\n   *\n   * @param array $data\n   *   An array of data to store.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  public function setMultipleWithExpire(array $data, $expire);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/KeyValueStore/KeyValueStoreExpirableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "KeyValueStoreExpirableInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface EbLogManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eb\\Service;\n\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\eb\\Entity\\EbLogInterface;\n\n/**\n * Interface for EbLog manager service.\n */\ninterface EbLogManagerInterface {\n\n  /**\n   * Creates a new log entry.\n   *\n   * @param array<string, mixed> $fields\n   *   Array of field values. Supported fields:\n   *   - label: (string) Human-readable label.\n   *   - definition_id: (string) Definition entity ID.\n   *   - action: (string) apply, rollback, import.\n   *   - operation_count: (int) Total operations.\n   *   - status: (string) pending, success, partial, failed.\n   *   - started: (int) Unix timestamp when action started.\n   *\n   * @return \\Drupal\\eb\\Entity\\EbLogInterface\n   *   The created log entity.\n   */\n  public function log(array $fields): EbLogInterface;\n\n  /**\n   * Completes a log entry.\n   *\n   * @param \\Drupal\\eb\\Entity\\EbLogInterface $log\n   *   The log entity to complete.\n   * @param string $status\n   *   The final status (success, partial, failed).\n   * @param int $successCount\n   *   The number of successful operations.\n   * @param int $failureCount\n   *   The number of failed operations.\n   */\n  public function complete(EbLogInterface $log, string $status, int $successCount, int $failureCount): void;\n\n  /**\n   * Gets log entries for a definition.\n   *\n   * @param string $definitionId\n   *   The definition entity ID.\n   *\n   * @return array<int, \\Drupal\\eb\\Entity\\EbLogInterface>\n   *   Array of log entities.\n   */\n  public function getByDefinitionId(string $definitionId): array;\n\n  /**\n   * Gets a single log entry by ID.\n   *\n   * @param int $id\n   *   The log entity ID.\n   *\n   * @return \\Drupal\\eb\\Entity\\EbLogInterface|null\n   *   The log entity or NULL if not found.\n   */\n  public function getById(int $id): ?EbLogInterface;\n\n  /**\n   * Loads log entries with optional filtering.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface|null $account\n   *   Optional account to filter by user.\n   * @param array<string, mixed> $options\n   *   Options including:\n   *   - limit: (int) Max records to return.\n   *   - status: (string) Filter by status.\n   *\n   * @return array<int, \\Drupal\\eb\\Entity\\EbLogInterface>\n   *   Array of log entities.\n   */\n  public function loadLogs(?AccountInterface $account = NULL, array $options = []): array;\n\n  /**\n   * Purges old log entries.\n   *\n   * @param int|null $daysOld\n   *   Delete records older than this many days. If NULL, uses config default.\n   *\n   * @return int\n   *   Number of deleted records.\n   */\n  public function purge(?int $daysOld = NULL): int;\n\n}\n", "metadata": {"source": "repos/eb/src/Service/EbLogManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "EbLogManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EntityLink in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\comment\\Plugin\\views\\field;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Attribute\\ViewsField;\nuse Drupal\\views\\Plugin\\views\\field\\FieldPluginBase;\nuse Drupal\\views\\ResultRow;\n\n/**\n * Handler for showing comment module's entity links.\n *\n * @ingroup views_field_handlers\n */\n#[ViewsField(\"comment_entity_link\")]\nclass EntityLink extends FieldPluginBase {\n\n  /**\n   * Stores the result of parent entities build for all rows to reuse it later.\n   *\n   * @var array\n   */\n  protected $build;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['teaser'] = ['default' => FALSE];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    $form['teaser'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Show teaser-style link'),\n      '#default_value' => $this->options['teaser'],\n      '#description' => $this->t('Show the comment link in the form used on standard entity teasers, rather than the full entity form.'),\n    ];\n\n    parent::buildOptionsForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public function preRender(&$values) {\n    // Render all nodes, so you can grep the comment links.\n    $entities = [];\n    foreach ($values as $row) {\n      $entity = $row->_entity;\n      $entities[$entity->id()] = $entity;\n    }\n    if ($entities) {\n      $entityTypeId = reset($entities)->getEntityTypeId();\n      $viewMode = $this->options['teaser'] ? 'teaser' : 'full';\n      $this->build = \\Drupal::entityTypeManager()\n        ->getViewBuilder($entityTypeId)\n        ->viewMultiple($entities, $viewMode);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(ResultRow $values) {\n    $entity = $this->getEntity($values);\n\n    // Only render the links, if they are defined.\n    if (!$entity || empty($this->build[$entity->id()]['links']['comment__comment'])) {\n      return '';\n    }\n    return \\Drupal::service('renderer')->render($this->build[$entity->id()]['links']['comment__comment']);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/src/Plugin/views/field/EntityLink.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityLink", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface CompositeConstraintInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Validation;\n\n/**\n * An interface to provide a bridge to Symfony composite constraints.\n */\ninterface CompositeConstraintInterface {\n\n  /**\n   * Returns the name of the property or properties that contain constraints.\n   *\n   * This method should be a static implementation of\n   * Composite::getCompositeOption().\n   *\n   * @return array|string\n   *   The name of the property or properties that contain constraints.\n   *\n   * @see \\Symfony\\Component\\Validator\\Constraints\\Composite::getCompositeOption()\n   */\n  public static function getCompositeOptionStatic(): array|string;\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Validation/CompositeConstraintInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "CompositeConstraintInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: JsonSchemaValidator\nSource file: <source_file>\nFile name hint: JsonSchemaValidator.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Service;\n\nuse JsonSchema\\Validator;\nuse JsonSchema\\Constraints\\Constraint;\n\n/**\n * Service for validating data against JSON Schema.\n *\n * Uses justinrainbow/json-schema library for validation.\n * Supports both strict and soft validation modes.\n */\nclass JsonSchemaValidator {\n\n  /**\n   * Validate data against a JSON Schema.\n   *\n   * @param mixed $data\n   *   The data to validate.\n   * @param array<string, mixed> $schema\n   *   The JSON Schema definition.\n   * @param string $mode\n   *   Validation mode: \"strict\" or \"soft\".\n   *   - strict: Throws exception on validation failure.\n   *   - soft: Returns validation result without throwing.\n   *\n   * @return array{valid: bool, errors: array<int, array{property: string, message: string}>}\n   *   Validation result with valid flag and array of errors.\n   *\n   * @throws \\InvalidArgumentException\n   *   When validation fails in strict mode.\n   */\n  public function validate(mixed $data, array $schema, string $mode = \"soft\"): array {\n    // If no schema provided, consider it valid.\n    if (empty($schema)) {\n      return [\n        \"valid\" => TRUE,\n        \"errors\" => [],\n      ];\n    }\n\n    // Convert PHP array to object for json-schema library.\n    $dataObject = $this->convertToObject($data);\n    $schemaObject = $this->convertToObject($schema);\n\n    // Create validator and validate.\n    $validator = new Validator();\n    $validator->validate(\n      $dataObject,\n      $schemaObject,\n      Constraint::CHECK_MODE_TYPE_CAST\n    );\n\n    // Collect errors.\n    $errors = [];\n    if (!$validator->isValid()) {\n      foreach ($validator->getErrors() as $error) {\n        $errors[] = [\n          \"property\" => $error[\"property\"] ?? \"\",\n          \"message\" => $error[\"message\"] ?? \"Unknown validation error\",\n        ];\n      }\n    }\n\n    $isValid = $validator->isValid();\n\n    // In strict mode, throw exception if invalid.\n    if ($mode === \"strict\" && !$isValid) {\n      $errorMessages = array_map(\n        fn(array $err): string => sprintf(\"[%s] %s\", $err[\"property\"], $err[\"message\"]),\n        $errors\n      );\n      throw new \\InvalidArgumentException(\n        sprintf(\"Schema validation failed: %s\", implode(\"; \", $errorMessages))\n      );\n    }\n\n    return [\n      \"valid\" => $isValid,\n      \"errors\" => $errors,\n    ];\n  }\n\n  /**\n   * Convert PHP array to object recursively for json-schema validation.\n   *\n   * The json-schema library expects stdClass objects for object validation.\n   *\n   * @param mixed $data\n   *   The data to convert.\n   *\n   * @return mixed\n   *   The converted data with arrays as stdClass where appropriate.\n   */\n  protected function convertToObject(mixed $data): mixed {\n    if (!is_array($data)) {\n      return $data;\n    }\n\n    // Check if this is an associative array (object) or sequential array.\n    if ($this->isAssociativeArray($data)) {\n      $object = new \\stdClass();\n      foreach ($data as $key => $value) {\n        $object->{$key} = $this->convertToObject($value);\n      }\n      return $object;\n    }\n\n    // Sequential array - convert items but keep as array.\n    return array_map([$this, \"convertToObject\"], $data);\n  }\n\n  /**\n   * Check if an array is associative (has string keys).\n   *\n   * @param array<mixed> $array\n   *   The array to check.", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_node_processor\\Service;\n\nuse JsonSchema\\Validator;\nuse JsonSchema\\Constraints\\Constraint;\n\n/**\n * Service for validating data against JSON Schema.\n *\n * Uses justinrainbow/json-schema library for validation.\n * Supports both strict and soft validation modes.\n */\nclass JsonSchemaValidator {\n\n  /**\n   * Validate data against a JSON Schema.\n   *\n   * @param mixed $data\n   *   The data to validate.\n   * @param array<string, mixed> $schema\n   *   The JSON Schema definition.\n   * @param string $mode\n   *   Validation mode: \"strict\" or \"soft\".\n   *   - strict: Throws exception on validation failure.\n   *   - soft: Returns validation result without throwing.\n   *\n   * @return array{valid: bool, errors: array<int, array{property: string, message: string}>}\n   *   Validation result with valid flag and array of errors.\n   *\n   * @throws \\InvalidArgumentException\n   *   When validation fails in strict mode.\n   */\n  public function validate(mixed $data, array $schema, string $mode = \"soft\"): array {\n    // If no schema provided, consider it valid.\n    if (empty($schema)) {\n      return [\n        \"valid\" => TRUE,\n        \"errors\" => [],\n      ];\n    }\n\n    // Convert PHP array to object for json-schema library.\n    $dataObject = $this->convertToObject($data);\n    $schemaObject = $this->convertToObject($schema);\n\n    // Create validator and validate.\n    $validator = new Validator();\n    $validator->validate(\n      $dataObject,\n      $schemaObject,\n      Constraint::CHECK_MODE_TYPE_CAST\n    );\n\n    // Collect errors.\n    $errors = [];\n    if (!$validator->isValid()) {\n      foreach ($validator->getErrors() as $error) {\n        $errors[] = [\n          \"property\" => $error[\"property\"] ?? \"\",\n          \"message\" => $error[\"message\"] ?? \"Unknown validation error\",\n        ];\n      }\n    }\n\n    $isValid = $validator->isValid();\n\n    // In strict mode, throw exception if invalid.\n    if ($mode === \"strict\" && !$isValid) {\n      $errorMessages = array_map(\n        fn(array $err): string => sprintf(\"[%s] %s\", $err[\"property\"], $err[\"message\"]),\n        $errors\n      );\n      throw new \\InvalidArgumentException(\n        sprintf(\"Schema validation failed: %s\", implode(\"; \", $errorMessages))\n      );\n    }\n\n    return [\n      \"valid\" => $isValid,\n      \"errors\" => $errors,\n    ];\n  }\n\n  /**\n   * Convert PHP array to object recursively for json-schema validation.\n   *\n   * The json-schema library expects stdClass objects for object validation.\n   *\n   * @param mixed $data\n   *   The data to convert.\n   *\n   * @return mixed\n   *   The converted data with arrays as stdClass where appropriate.\n   */\n  protected function convertToObject(mixed $data): mixed {\n    if (!is_array($data)) {\n      return $data;\n    }\n\n    // Check if this is an associative array (object) or sequential array.\n    if ($this->isAssociativeArray($data)) {\n      $object = new \\stdClass();\n      foreach ($data as $key => $value) {\n        $object->{$key} = $this->convertToObject($value);\n      }\n      return $object;\n    }\n\n    // Sequential array - convert items but keep as array.\n    return array_map([$this, \"convertToObject\"], $data);\n  }\n\n  /**\n   * Check if an array is associative (has string keys).\n   *\n   * @param array<mixed> $array\n   *   The array to check.\n   *\n   * @return bool\n   *   TRUE if associative, FALSE if sequential.\n   */\n  protected function isAssociativeArray(array $array): bool {\n    if (empty($array)) {\n      return FALSE;\n    }\n\n    return array_keys($array) !== range(0, count($array) - 1);\n  }\n\n  /**\n   * Generate a default schema from sample data.\n   *\n   * This is a helper method for users to generate initial schemas.\n   *\n   * @param mixed $data\n   *   The sample data.\n   *\n   * @return array<string, mixed>\n   *   A basic JSON Schema derived from the data.\n   */\n  public function generateSchemaFromData(mixed $data): array {\n    return $this->inferSchema($data);\n  }\n\n  /**\n   * Infer schema from data recursively.\n   *\n   * @param mixed $data\n   *   The data to infer schema from.\n   *\n   * @return array<string, mixed>\n   *   The inferred schema.\n   */\n  protected function inferSchema(mixed $data): array {\n    if ($data === NULL) {\n      return [\"type\" => \"null\"];\n    }\n\n    if (is_bool($data)) {\n      return [\"type\" => \"boolean\"];\n    }\n\n    if (is_int($data)) {\n      return [\"type\" => \"integer\"];\n    }\n\n    if (is_float($data)) {\n      return [\"type\" => \"number\"];\n    }\n\n    if (is_string($data)) {\n      return [\"type\" => \"string\"];\n    }\n\n    if (is_array($data)) {\n      // Check if sequential or associative.\n      if (empty($data)) {\n        return [\"type\" => \"array\", \"items\" => []];\n      }\n\n      if ($this->isAssociativeArray($data)) {\n        $properties = [];\n        foreach ($data as $key => $value) {\n          $properties[$key] = $this->inferSchema($value);\n        }\n        return [\n          \"type\" => \"object\",\n          \"properties\" => $properties,\n        ];\n      }\n\n      // Sequential array - infer from first item.\n      return [\n        \"type\" => \"array\",\n        \"items\" => $this->inferSchema($data[0]),\n      ];\n    }\n\n    if (is_object($data)) {\n      $properties = [];\n      foreach (get_object_vars($data) as $key => $value) {\n        $properties[$key] = $this->inferSchema($value);\n      }\n      return [\n        \"type\" => \"object\",\n        \"properties\" => $properties,\n      ];\n    }\n\n    return [\"type\" => \"mixed\"];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_processor/src/Service/JsonSchemaValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "JsonSchemaValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: StringItem.php\nTarget symbol: class StringItem\nNamespace: Drupal\\Core\\Field\\Plugin\\Field\\FieldType\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for StringItem.\n- Include required imports:\n  - Drupal\\Component\\Utility\\Random\n  - Drupal\\Core\\Field\\Attribute\\FieldType\n  - Drupal\\Core\\Field\\FieldDefinitionInterface\n  - Drupal\\Core\\Field\\FieldStorageDefinitionInterface\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\StringTranslation\\TranslatableMarkup\n- Ensure these methods exist where relevant:\n  - defaultStorageSettings()\n  - generateSampleValue()\n  - getConstraints()\n  - schema()\n  - storageSettingsForm()", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldType;\n\nuse Drupal\\Component\\Utility\\Random;\nuse Drupal\\Core\\Field\\Attribute\\FieldType;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldStorageDefinitionInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines the 'string' entity field type.\n */\n#[FieldType(\n  id: \"string\",\n  label: new TranslatableMarkup(\"Short text\"),\n  description: [\n    new TranslatableMarkup(\"Uses a one-line text field for input\"),\n    new TranslatableMarkup(\"Efficient storage\"),\n    new TranslatableMarkup(\"Fixed maximum length (up to 16383 characters)\"),\n    new TranslatableMarkup(\"May be faster for searching and sorting\"),\n    new TranslatableMarkup(\"Recommended for titles and names\"),\n  ],\n  category: \"plain_text\",\n  weight: -10,\n  default_widget: \"string_textfield\",\n  default_formatter: \"string\"\n)]\nclass StringItem extends StringItemBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function defaultStorageSettings() {\n    return [\n      'max_length' => 255,\n      'is_ascii' => FALSE,\n    ] + parent::defaultStorageSettings();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function schema(FieldStorageDefinitionInterface $field_definition) {\n    return [\n      'columns' => [\n        'value' => [\n          'type' => $field_definition->getSetting('is_ascii') === TRUE ? 'varchar_ascii' : 'varchar',\n          'length' => (int) $field_definition->getSetting('max_length'),\n          'binary' => $field_definition->getSetting('case_sensitive'),\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConstraints() {\n    $constraints = parent::getConstraints();\n\n    if ($max_length = $this->getSetting('max_length')) {\n      $constraint_manager = \\Drupal::typedDataManager()->getValidationConstraintManager();\n      $options['max'] = $max_length;\n      if ($label = $this->getFieldDefinition()->getLabel()) {\n        $options['maxMessage'] = $this->t('%name: may not be longer than @max characters.', [\n          '%name' => $label,\n          '@max' => $max_length,\n        ]);\n      }\n      $constraints[] = $constraint_manager->create('ComplexData', [\n        'properties' => [\n          'value' => [\n            'Length' => $options,\n          ],\n        ],\n      ]);\n    }\n\n    return $constraints;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function generateSampleValue(FieldDefinitionInterface $field_definition) {\n    $random = new Random();\n    $max_length = $field_definition->getSetting('max_length');\n\n    // When the maximum length is less than 15, or the field needs to be unique,\n    // generate a random word using the maximum length.\n    if ($max_length <= 15 || $field_definition->getConstraint('UniqueField')) {\n      $values['value'] = ucfirst($random->word($max_length));\n\n      return $values;\n    }\n\n    // The minimum length is either 10% of the maximum length, or 15 characters\n    // long, whichever is greater.\n    $min_length = max(ceil($max_length * 0.10), 15);\n\n    // Reduce the max length to allow us to add a period.\n    $max_length -= 1;\n\n    // The random value is generated multiple times to create a slight\n    // preference towards values that are closer to the minimum length of the\n    // string. For values larger than 255 (which is the default maximum value),\n    // the bias towards minimum length is increased. This is because the default\n    // maximum length of 255 is often used for fields that include shorter\n    // values (i.e. title).\n    $length = mt_rand($min_length, mt_rand($min_length, $max_length >= 255 ? mt_rand($min_length, $max_length) : $max_length));\n\n    $string = $random->sentences(1);\n    while (mb_strlen($string) < $length) {\n      $string .= \" {$random->sentences(1)}\";\n    }\n\n    if (mb_strlen($string) > $max_length) {\n      $string = substr($string, 0, $length);\n      $string = substr($string, 0, strrpos($string, ' '));\n    }\n\n    $string = rtrim($string, ' .');\n\n    // Ensure that the string ends with a full stop if there are multiple\n    // sentences.\n    $values['value'] = $string . (str_contains($string, '.') ? '.' : '');\n\n    return $values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function storageSettingsForm(array &$form, FormStateInterface $form_state, $has_data) {\n    $element = [];\n\n    $element['max_length'] = [\n      '#type' => 'number',\n      '#title' => $this->t('Maximum length'),\n      '#default_value' => $this->getSetting('max_length'),\n      '#required' => TRUE,\n      '#description' => $this->t('The maximum length of the field in characters.'),\n      '#min' => 1,\n      '#disabled' => $has_data,\n    ];\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldType/StringItem.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StringItem", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: instead\nSource file: <source_file>\nFile name hint: Merge.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\sqlite\\Driver\\Database\\sqlite;\n\nuse Drupal\\Core\\Database\\Query\\Merge as QueryMerge;\n\n@trigger_error('Extending from \\Drupal\\sqlite\\Driver\\Database\\sqlite\\Merge is deprecated in drupal:11.0.0 and is removed from drupal:12.0.0. Extend from the base class instead. See https://www.drupal.org/node/3256524', E_USER_DEPRECATED);\n\n/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Query\\Merge.\n */\nclass Merge extends QueryMerge {\n}", "output": "<?php\n\nnamespace Drupal\\sqlite\\Driver\\Database\\sqlite;\n\nuse Drupal\\Core\\Database\\Query\\Merge as QueryMerge;\n\n@trigger_error('Extending from \\Drupal\\sqlite\\Driver\\Database\\sqlite\\Merge is deprecated in drupal:11.0.0 and is removed from drupal:12.0.0. Extend from the base class instead. See https://www.drupal.org/node/3256524', E_USER_DEPRECATED);\n\n/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Query\\Merge.\n */\nclass Merge extends QueryMerge {\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/sqlite/src/Driver/Database/sqlite/Merge.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Merge", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Refactor this Drupal 11 interface for readability and maintainability while preserving behavior.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: TranslationStatusInterface.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\TypedData;\n\n/**\n * Defines an interface for checking the status of an entity translation.\n */\ninterface TranslationStatusInterface {\n\n  /**\n   * Status code identifying a removed translation.\n   */\n  const TRANSLATION_REMOVED = 0;\n\n  /**\n   * Status code identifying an existing translation.\n   */\n  const TRANSLATION_EXISTING = 1;\n\n  /**\n   * Status code identifying a newly created translation.\n   */\n  const TRANSLATION_CREATED = 2;\n\n  /**\n   * Returns the translation status.\n   *\n   * @param string $langcode\n   *   The language code identifying the translation.\n   *\n   * @return int|null\n   *   One of the TRANSLATION_* constants or NULL if the given translation does\n   *   not exist.\n   */\n  public function getTranslationStatus($langcode);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData;\n\n/**\n * Defines an interface for checking the status of an entity translation.\n */\ninterface TranslationStatusInterface {\n\n  /**\n   * Status code identifying a removed translation.\n   */\n  const TRANSLATION_REMOVED = 0;\n\n  /**\n   * Status code identifying an existing translation.\n   */\n  const TRANSLATION_EXISTING = 1;\n\n  /**\n   * Status code identifying a newly created translation.\n   */\n  const TRANSLATION_CREATED = 2;\n\n  /**\n   * Returns the translation status.\n   *\n   * @param string $langcode\n   *   The language code identifying the translation.\n   *\n   * @return int|null\n   *   One of the TRANSLATION_* constants or NULL if the given translation does\n   *   not exist.\n   */\n  public function getTranslationStatus($langcode);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/TranslationStatusInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "TranslationStatusInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Fix this broken Drupal 11 interface implementation and return corrected PHP code.", "input": "Symbol: for\nSource file: <source_file>\nFile name hint: ExecutableInterface.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\Core\\Executable;\n\n/**\n * An interface for executable plugins.\n *\n * @ingroup plugin_api\n */\ninterface ExecutableInterface {\n\n  /**\n   * Executes the plugin.\n   *\n   * phpcs:ignore Drupal.Commenting.FunctionComment.ParamNameNoMatch\n   * @param object|null $object\n   *   (optional) An object to execute the plugin on/with.\n   *\n   * @see https://www.drupal.org/project/drupal/issues/3354672\n   *\n   * @todo Uncomment the new $object method parameter before drupal:12.0.0.\n   */\n  function execute(/* ?object $object = NULL */);\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Executable;\n\n/**\n * An interface for executable plugins.\n *\n * @ingroup plugin_api\n */\ninterface ExecutableInterface {\n\n  /**\n   * Executes the plugin.\n   *\n   * phpcs:ignore Drupal.Commenting.FunctionComment.ParamNameNoMatch\n   * @param object|null $object\n   *   (optional) An object to execute the plugin on/with.\n   *\n   * @see https://www.drupal.org/project/drupal/issues/3354672\n   *\n   * @todo Uncomment the new $object method parameter before drupal:12.0.0.\n   */\n  public function execute(/* ?object $object = NULL */);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Executable/ExecutableInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "ExecutableInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class FieldInstanceSettings in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\field\\Plugin\\migrate\\process\\d6;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n// cspell:ignore filefield imagefield\n\n/**\n * Determines the field instance settings.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess('d6_field_field_settings')]\nclass FieldInstanceSettings extends ProcessPluginBase {\n\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n  }\n\n  /**\n   * {@inheritdoc}\n   *\n   * Set the field instance defaults.\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    [$widget_type, $widget_settings, $field_settings] = $value;\n    $settings = [];\n    switch ($widget_type) {\n      case 'number':\n        $settings['min'] = $field_settings['min'];\n        $settings['max'] = $field_settings['max'];\n        $settings['prefix'] = $field_settings['prefix'];\n        $settings['suffix'] = $field_settings['suffix'];\n        break;\n\n      case 'link':\n        // $settings['url'] = $widget_settings['default_value'][0]['url'];\n        // D6 has optional, required, value and none. D8 only has disabled (0)\n        // optional (1) and required (2).\n        $map = ['disabled' => 0, 'optional' => 1, 'required' => 2];\n        $settings['title'] = $map[$field_settings['title']];\n        break;\n\n      case 'filefield_widget':\n        $settings['file_extensions'] = $widget_settings['file_extensions'];\n        $settings['file_directory'] = $widget_settings['file_path'];\n        $settings['description_field'] = $field_settings['description_field'];\n        $settings['max_filesize'] = $this->convertSizeUnit($widget_settings['max_filesize_per_file']);\n        break;\n\n      case 'imagefield_widget':\n        $settings['file_extensions'] = $widget_settings['file_extensions'];\n        $settings['file_directory'] = $widget_settings['file_path'];\n        $settings['max_filesize'] = $this->convertSizeUnit($widget_settings['max_filesize_per_file'] ?? '');\n        $settings['alt_field'] = $widget_settings['alt'];\n        $settings['alt_field_required'] = $widget_settings['custom_alt'];\n        $settings['title_field'] = $widget_settings['title'];\n        $settings['title_field_required'] = $widget_settings['custom_title'];\n        // With nothing entered for min or max resolution in Drupal 6, zero is\n        // stored. For Drupal 8 this should be an empty string.\n        $settings['max_resolution'] = !empty($widget_settings['max_resolution']) ? $widget_settings['max_resolution'] : '';\n        $settings['min_resolution'] = !empty($widget_settings['min_resolution']) ? $widget_settings['min_resolution'] : '';\n        break;\n\n    }\n    return $settings;\n  }\n\n  /**\n   * Convert file size strings into their D8 format.\n   *\n   * D6 stores file size using a \"K\" for kilobytes and \"M\" for megabytes where\n   * as D8 uses \"KB\" and \"MB\" respectively.\n   *\n   * @param string $size_string\n   *   The size string, eg \"10M\".\n   *\n   * @return string\n   *   The D8 version of the size string.\n   */\n  protected function convertSizeUnit($size_string) {\n    $size_unit = substr($size_string, strlen($size_string) - 1);\n    if ($size_unit == \"M\" || $size_unit == \"K\") {\n      return $size_string . \"B\";\n    }\n    return $size_string;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/field/src/Plugin/migrate/process/d6/FieldInstanceSettings.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldInstanceSettings", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: WordPress to Drupal Migrate", "input": "", "output": "# WordPress to Drupal Migrate\n\nA Drupal module that migrates WordPress content to Drupal via direct database connection.\n\n## Features\n\n- **Direct Database Connection**: Connects directly to your WordPress MySQL database for fast, reliable migration\n- **Comprehensive Content Migration**:\n  - Users (with metadata)\n  - Categories \u2192 Taxonomy terms\n  - Tags \u2192 Taxonomy terms\n  - Posts \u2192 Article nodes\n  - Pages \u2192 Page nodes\n  - Media/Attachments \u2192 Media entities\n  - Comments\n- **Admin UI**: User-friendly configuration and execution forms\n- **Flexible Options**:\n  - Skip media migration if not needed\n  - Update existing records\n  - Rollback migrations\n- **WordPress Content Processing**:\n  - Converts common shortcodes to HTML\n  - Cleans up WordPress-specific markup\n  - Preserves year/month folder structure for media\n\n## Requirements\n\n- Drupal 10 or 11\n- PHP 8.1+\n- [Migrate Plus](https://www.drupal.org/project/migrate_plus) module\n- [Migrate Tools](https://www.drupal.org/project/migrate_tools) module\n- Access to WordPress MySQL database\n\n## Installation\n\n1. Install via Composer:\n   ```bash\n   composer require drupal/wp_drupal_migrate\n   ```\n\n2. Enable the module:\n   ```bash\n   drush en wp_drupal_migrate\n   ```\n\n## Configuration\n\n1. Navigate to **Configuration \u2192 Content authoring \u2192 WordPress Migration** (`/admin/config/content/wp-migrate`)\n\n2. Enter your WordPress database credentials:\n   - **Database Host**: For DDEV, use `ddev-wordpress-db` to connect to a WordPress DDEV instance\n   - **Port**: Default is `3306`\n   - **Database Name**: Your WordPress database name\n   - **Username/Password**: Database credentials\n   - **Table Prefix**: WordPress table prefix (default: `wp_`)\n   - **WordPress Uploads URL**: Full URL to WordPress uploads directory (e.g., `http://wordpress.example.com/wp-content/uploads`)\n\n3. Click **Test Connection** to verify the database connection\n\n## Usage\n\n### Via Admin UI\n\n1. Go to **Configuration \u2192 Content authoring \u2192 WordPress Migration \u2192 Execute Migrations** (`/admin/config/content/wp-migrate/execute`)\n\n2. The connection status will be displayed at the top\n\n3. Select migrations to run or use the action buttons:\n   - **Execute**: Run selected migrations\n   - **Import All**: Run all migrations\n   - **Rollback All**: Revert all migrations\n\n4. Options:\n   - **Update existing records**: Re-import and update previously migrated content\n   - **Skip media migration**: Skip media files if download is failing or not needed\n\n### Via Drush\n\n```bash\n# Import all WordPress content\ndrush migrate:import --tag=WordPress\n\n# Import specific migration\ndrush migrate:import wp_users\ndrush migrate:import wp_posts\n\n# Check migration status\ndrush migrate:status --tag=WordPress\n\n# Rollback migrations\ndrush migrate:rollback --tag=WordPress\n\n# Reset stuck migrations\ndrush migrate:reset-status wp_media\n```\n\n## Content Mapping\n\n| WordPress | Drupal | Notes |\n|-----------|--------|-------|\n| Users | user | Includes first name, last name, bio |\n| Categories | taxonomy_term:categories | Hierarchical structure preserved |\n| Tags | taxonomy_term:tags | |\n| Posts | node:article | With categories, tags, featured image |\n| Pages | node:page | With featured image |\n| Attachments | media:image | Downloaded to `public://wp-imports/` |\n| Comments | comment | Threaded comments supported |\n\n## DDEV Setup (Local Development)\n\nIf using DDEV for both WordPress and Drupal:\n\n1. **Create WordPress DDEV instance** (if not exists):\n   ```bash\n   mkdir -p ~/Projects/wordpress && cd ~/Projects/wordpress\n   ddev config --project-type=wordpress --project-name=wordpress\n   ddev start\n   ```\n\n2. **Database connection settings**:\n   - Host: `ddev-wordpress-db`\n   - Port: `3306`\n   - Database: `db`\n   - Username: `db`\n   - Password: `db`\n\nBoth DDEV projects share the `ddev_default` network automatically.\n\n## Troubleshooting\n\n### \"No database connection configured for source plugin variable\"\n\nThis error comes from the `migrate_drupal` module. If you're not migrating from Drupal 6/7, disable it:\n```bash\ndrush pm:uninstall migrate_drupal\n```\n\n### Media migration fails or skips all items\n\n1. Check if WordPress has the file metadata:\n   ```bash\n   # In WordPress database\n   SELECT COUNT(*) FROM wp_postmeta WHERE meta_key = '_wp_attached_file';\n   ```\n\n2. Verify the WordPress Uploads URL is accessible from your Drupal server\n\n3. Use \"Skip media migration\" option to import content without media\n\n### Migration stuck in \"Importing\" status\n\nReset the migration status:\n```bash\ndrush migrate:reset-status wp_media\n```\n\n## Extending\n\n### Custom Post Types\n\nCreate a new migration YAML in your module's `migrations/` directory:\n\n```yaml\nid: wp_custom_posts\nlabel: 'WordPress Custom Posts'\nmigration_tags:\n  - WordPress\nsource:\n  plugin: wp_posts\n  post_type: your_custom_post_type\nprocess:\n  type:\n    plugin: default_value\n    default_value: your_drupal_content_type\n  title: post_title\n  # ... add field mappings\ndestination:\n  plugin: entity:node\n```\n\n### Custom Taxonomies\n\n```yaml\nid: wp_custom_taxonomy\nlabel: 'WordPress Custom Taxonomy'\nmigration_tags:\n  - WordPress\nsource:\n  plugin: wp_terms\n  taxonomy: your_taxonomy_name\nprocess:\n  vid:\n    plugin: default_value\n    default_value: your_drupal_vocabulary\n  name: name\ndestination:\n  plugin: entity:taxonomy_term\n```\n\n## License\n\nThis project is licensed under the GPL-2.0-or-later license.\n\n## Author\n\n- **Talish Khan** - *Initial work and maintenance*\n\n## Contributing\n\nIssues and pull requests are welcome on the [Drupal.org project page](https://www.drupal.org/project/wp_drupal_migrate).\n", "metadata": {"source": "repos/wp_drupal_migrate/README.md", "type": "doc_summary", "topic": "WordPress to Drupal Migrate"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: HelpHook.php\nTarget symbol: class HelpHook\nNamespace: Drupal\\api_normalization\\Hook\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for HelpHook.\n- Include required imports:\n  - Drupal\\Core\\Routing\\RouteMatchInterface\n  - Drupal\\Core\\Attribute\\Hook\n- Ensure these methods exist where relevant:\n  - help()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Hook;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Attribute\\Hook;\n\n/**\n * Hook implementations for hook_help().\n *\n * Provides help text for the API Normalization module.\n */\nclass HelpHook {\n\n  /**\n   * Implements hook_help().\n   *\n   * @param string $route_name\n   *   The route name for the current page.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match object.\n   *\n   * @return string|null\n   *   A render array containing help text, or NULL if no help is available.\n   */\n  #[Hook('help')]\n  public function help(string $route_name, RouteMatchInterface $route_match): ?string {\n    // Delegate to the procedural implementation for now.\n    // This allows gradual migration while maintaining backward compatibility.\n    return api_normalization_help($route_name, $route_match);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Hook/HelpHook.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HelpHook", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for page titles.\n *\n * Available variables:\n * - title_attributes: HTML attributes for the page title element.\n * - title_prefix: Additional output populated by modules, intended to be\n *   displayed in front of the main title tag that appears in the template.\n * - title: The page title, for use in the actual content.\n * - title_suffix: Additional output populated by modules, intended to be\n *   displayed after the main title tag that appears in the template.\n */\n#}\n{{ title_prefix }}\n{% if title %}\n  <h1{{ title_attributes.addClass('page-title') }}>{{ title }}</h1>\n{% endif %}\n{{ title_suffix }}\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/content/page-title.html.twig", "type": "twig_reference"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<html>\n  <head>\n    <title>Redirection Intercepted</title>\n  </head>\n  <body>\n    <div class=\"sf-reset\">\n      <div class=\"block-exception\">\n        <h1>This request redirects to <a href=\"{{ location }}\">{{ location }}</a>.</h1>\n\n        <p>\n          <small>\n            The redirect was intercepted by the webprofiler toolbar to help debugging.\n            For more information, see the \"intercept-redirects\" option of the Profiler.\n          </small>\n        </p>\n      </div>\n    </div>\n  </body>\n</html>\n", "metadata": {"source": "repos/webprofiler/templates/Profiler/toolbar_redirect.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the interface UnroutedUrlAssemblerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Utility;\n\n/**\n * Provides a way to build external or non Drupal local domain URLs.\n */\ninterface UnroutedUrlAssemblerInterface {\n\n  /**\n   * Builds a domain-local or external URL from a URI.\n   *\n   * For actual implementations the logic probably has to be split up between\n   * domain-local URIs and external URLs.\n   *\n   * @param string $uri\n   *   A local URI or an external URL being linked to, such as \"base:foo\"\n   *    or \"https://example.com/foo\".\n   *   - If you provide a full URL, it will be considered an external URL as\n   *     long as it has an allowed protocol.\n   *   - If you provide only a local URI (e.g. \"base:foo\"), it will be\n   *     considered a path local to Drupal, but not handled by the routing\n   *     system.  The base path (the subdirectory where the front controller\n   *     is found) will be added to the path. Additional query arguments for\n   *     local paths must be supplied in $options['query'], not part of $uri.\n   *   - If your external URL contains a query (e.g.\n   *     https://example.com/foo?a=b), then you can either URL encode the query\n   *     keys and values yourself and include them in $uri, or use\n   *     $options['query'] to let this method URL encode them.\n   * @param array $options\n   *   (optional) An associative array of additional options, with the following\n   *   elements:\n   *   - 'query': An array of query key/value-pairs (without any URL-encoding)\n   *      to append to the URL.\n   *   - 'fragment': A fragment identifier (named anchor) to append to the URL.\n   *     Do not include the leading '#' character.\n   *   - 'absolute': Defaults to FALSE. Whether to force the output to be an\n   *     absolute link (beginning with http:). Useful for links that will be\n   *     displayed outside the site, such as in an RSS feed.\n   *   - 'https': Whether this URL should point to a secure location. If not\n   *     defined, the current scheme is used, so the user stays on HTTP or HTTPS\n   *     respectively. TRUE enforces HTTPS and FALSE enforces HTTP.\n   * @param bool $collect_bubbleable_metadata\n   *   (optional) Defaults to FALSE. When TRUE, both the generated URL and its\n   *   associated bubbleable metadata are returned.\n   *\n   * @return string|\\Drupal\\Core\\GeneratedUrl\n   *   A string containing a relative or absolute URL.\n   *   When $collect_bubbleable_metadata is TRUE, a GeneratedUrl object is\n   *   returned, containing the generated URL plus bubbleable metadata.\n   *\n   * @throws \\InvalidArgumentException\n   *   Thrown when the passed in path has no scheme.\n   */\n  public function assemble($uri, array $options = [], $collect_bubbleable_metadata = FALSE);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Utility/UnroutedUrlAssemblerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "UnroutedUrlAssemblerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class EntityView in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity\\EntityView\\Attribute;\n\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\pinto_entity\\EntityView\\Bundle;\nuse Drupal\\pinto_entity\\EntityView\\EntityViewContext;\nuse Drupal\\pinto_entity\\EntityView\\ViewMode;\nuse Nette\\Utils\\Type;\n\n/**\n * @phpstan-type EntityViewMapping array{Bundle, ViewMode, string, string[], string[]}\n */\n#[\\Attribute(flags: \\Attribute::TARGET_METHOD)]\nfinal class EntityView {\n\n  private ?self $fallback = NULL;\n\n  /**\n   * Provide the entity type, and bundles and view modes.\n   *\n   * Entity type and bundle may be left empty when #[EntityView] is used on methods in a bundle class.\n   *\n   * @phpstan-param string|null $entityType\n   * @phpstan-param string|string[]|null $bundles\n   * @phpstan-param string|string[] $viewModes\n   */\n  public function __construct(\n    private string|null $entityType = NULL,\n    private string|array|null $bundles = NULL,\n    private string|array|null $viewModes = NULL,\n  ) {\n    if (($entityType === NULL || $bundles === NULL || $viewModes === NULL) && $entityType !== $bundles) {\n      throw new \\LogicException('Both of $entityType and $bundles must be NULL, or not at all.');\n    }\n  }\n\n  /**\n   * @phpstan-return iterable<\\Drupal\\pinto_entity\\EntityView\\Bundle>\n   */\n  public function bundles(): iterable {\n    return \\array_map(\n      callback: fn (string $bundle): Bundle => new Bundle(entityType: $this->entityType ?? ($this->fallback->entityType ?? throw new \\LogicException('No fallback entity type available when not used with a bundle class')), bundle: $bundle),\n      array: (array) ($this->bundles ?? ($this->fallback->bundles ?? throw new \\LogicException('No fallback bundle available when not used with a bundle class'))),\n    );\n  }\n\n  /**\n   * @phpstan-return iterable<\\Drupal\\pinto_entity\\EntityView\\ViewMode>\n   */\n  public function viewModes(): iterable {\n    return \\array_map(\n      callback: static fn (string $viewMode): ViewMode => new ViewMode(viewMode: $viewMode),\n      array: (array) ($this->viewModes ?? ($this->fallback->viewModes ?? throw new \\LogicException('No fallback view mode available when not used with a bundle class'))),\n    );\n  }\n\n  /**\n   * @phpstan-return iterable<Bundle, ViewMode>\n   */\n  public function all(): iterable {\n    foreach ($this->bundles() as $bundle) {\n      foreach ($this->viewModes() as $viewMode) {\n        yield $bundle => $viewMode;\n      }\n    }\n  }\n\n  /**\n   * @phpstan-param \\ReflectionClass<covariant object> $rClass\n   * @phpstan-param array<class-string<object>> $validFactoryReturnTypes\n   * @phpstan-return iterable<EntityViewMapping>\n   */\n  public static function findOnClass(\\ReflectionClass $rClass, array $validFactoryReturnTypes, ?self $fallback = NULL): iterable {\n    // All must be public static.\n    foreach ($rClass->getMethods(\\ReflectionMethod::IS_PUBLIC) as $rMethod) {\n      $attributes = $rMethod->getAttributes(EntityView::class);\n\n      if ([] === $attributes) {\n        continue;\n      }\n\n      if (FALSE === $rMethod->isStatic()) {\n        throw new \\LogicException(\\sprintf('Method %s::%s() using %s attribute is expected to be public and static.', $rMethod->getDeclaringClass()->getName(), $rMethod->getName(), EntityView::class));\n      }\n\n      $validReturnType = FALSE;\n      foreach ($validFactoryReturnTypes as $factoryReturnType) {\n        if (Type::fromString($factoryReturnType)->allows(Type::fromReflection($rMethod) ?? throw new \\LogicException('Unable to determine reflection for method'))) {\n          $validReturnType = TRUE;\n          break;\n        }\n      }\n\n      if (FALSE === $validReturnType) {\n        throw new \\LogicException(\\sprintf('The return type for %s::%s() is not typed with a known Pinto component. Allowed types may extend any one of %s', $rMethod->getDeclaringClass()->getName(), $rMethod->getName(), \\implode(', ', $validFactoryReturnTypes)));\n      }\n\n      $factoryMethod = \\sprintf('%s::%s', $rMethod->getDeclaringClass()->getName(), $rMethod->getName());\n      $entityParams = static::findEntityParameters($rMethod);\n      $contextParams = static::findEntityViewContextParameters($rMethod);\n\n      foreach ($attributes as $attribute) {\n        /** @var EntityView $entityView */\n        $entityView = $attribute->newInstance();\n        $entityView->fallback = $fallback;\n        foreach ($entityView->all() as $bundle => $viewMode) {\n          yield [$bundle, $viewMode, $factoryMethod, $entityParams, $contextParams];\n        }\n      }\n    }\n  }\n\n  /**\n   * @phpstan-return string[]\n   */\n  private static function findEntityParameters(\\ReflectionMethod $rMethod): array {\n    $parameters = [];\n\n    foreach ($rMethod->getParameters() as $rParam) {\n      // Nette is used to resolve types like `self`.\n      if (Type::fromString(EntityInterface::class)->allows(Type::fromReflection($rParam) ?? throw new \\LogicException('Unable to determine reflection for parameter'))) {\n        $parameters[] = $rParam->getName();\n      }\n    }\n\n    return $parameters;\n  }\n\n  /**\n   * @phpstan-return string[]\n   */\n  private static function findEntityViewContextParameters(\\ReflectionMethod $rMethod): array {\n    $parameters = [];\n\n    foreach ($rMethod->getParameters() as $rParam) {\n      $paramType = $rParam->getType();\n      if ($paramType instanceof \\ReflectionNamedType && $paramType->getName() === EntityViewContext::class) {\n        $parameters[] = $rParam->getName();\n      }\n    }\n\n    return $parameters;\n  }\n\n}\n", "metadata": {"source": "repos/pinto_entity/src/EntityView/Attribute/EntityView.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EntityView", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class CacheFactoryWrapper in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Cache;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Cache\\CacheFactoryInterface;\nuse Drupal\\webprofiler\\DataCollector\\CacheDataCollector;\n\n/**\n * Wraps a cache factory to register all calls to the cache system.\n */\nclass CacheFactoryWrapper implements CacheFactoryInterface {\n\n  /**\n   * All wrapped cache backends.\n   *\n   * @var \\Drupal\\webprofiler\\Cache\\CacheBackendWrapper[]\n   */\n  protected array $cacheBackends = [];\n\n  /**\n   * Creates a new CacheFactoryWrapper instance.\n   *\n   * @param \\Drupal\\Core\\Cache\\CacheFactoryInterface $cacheFactory\n   *   The cache factory.\n   * @param \\Drupal\\webprofiler\\DataCollector\\CacheDataCollector $cacheDataCollector\n   *   The cache data collector.\n   */\n  public function __construct(\n    protected readonly CacheFactoryInterface $cacheFactory,\n    protected readonly CacheDataCollector $cacheDataCollector,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get($bin): CacheBackendInterface {\n    if (!isset($this->cacheBackends[$bin])) {\n      $cache_backend = $this->cacheFactory->get($bin);\n      $this->cacheBackends[$bin] = new CacheBackendWrapper($this->cacheDataCollector, $cache_backend, $bin);\n    }\n\n    return $this->cacheBackends[$bin];\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Cache/CacheFactoryWrapper.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CacheFactoryWrapper", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the trait SectionListTrait in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\layout_builder;\n\n/**\n * Provides a trait for maintaining a list of sections.\n *\n * @see \\Drupal\\layout_builder\\SectionListInterface\n */\ntrait SectionListTrait {\n\n  /**\n   * Stores the information for all sections.\n   *\n   * Implementations of this method are expected to call array_values() to rekey\n   * the list of sections.\n   *\n   * @param \\Drupal\\layout_builder\\Section[] $sections\n   *   An array of section objects.\n   *\n   * @return $this\n   */\n  abstract protected function setSections(array $sections);\n\n  /**\n   * {@inheritdoc}\n   */\n  public function count(): int {\n    if ($this->hasBlankSection()) {\n      return 0;\n    }\n\n    return count($this->getSections());\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSection($delta) {\n    if (!$this->hasSection($delta)) {\n      throw new \\OutOfBoundsException(sprintf(\n        'Invalid section delta \"%s\", there are %d sections.',\n        $delta,\n        $this->count()\n      ));\n    }\n    return $this->getSections()[$delta];\n  }\n\n  /**\n   * Sets the section for the given delta on the display.\n   *\n   * @param int $delta\n   *   The delta of the section.\n   * @param \\Drupal\\layout_builder\\Section $section\n   *   The layout section.\n   *\n   * @return $this\n   */\n  public function setSection($delta, Section $section) {\n    $sections = $this->getSections();\n    $sections[$delta] = $section;\n    $this->setSections($sections);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function appendSection(Section $section) {\n    $delta = $this->count();\n\n    $this->setSection($delta, $section);\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function insertSection($delta, Section $section) {\n    // Clear the section list if there is currently a blank section.\n    if ($this->hasBlankSection()) {\n      $this->removeAllSections();\n    }\n\n    if ($this->hasSection($delta)) {\n      // @todo Use https://www.drupal.org/node/66183 once resolved.\n      $start = array_slice($this->getSections(), 0, $delta);\n      $end = array_slice($this->getSections(), $delta);\n      $this->setSections(array_merge($start, [$section], $end));\n    }\n    else {\n      $this->appendSection($section);\n    }\n    return $this;\n  }\n\n  /**\n   * Adds a blank section to the list.\n   *\n   * @return $this\n   *\n   * @see \\Drupal\\layout_builder\\Plugin\\Layout\\BlankLayout\n   */\n  protected function addBlankSection() {\n    if ($this->hasSection(0)) {\n      throw new \\Exception('A blank section must only be added to an empty list');\n    }\n\n    $this->appendSection(new Section('layout_builder_blank'));\n    return $this;\n  }\n\n  /**\n   * Indicates if this section list contains a blank section.\n   *\n   * A blank section is used to differentiate the difference between a layout\n   * that has never been instantiated and one that has purposefully had all\n   * sections removed.\n   *\n   * @return bool\n   *   TRUE if the section list contains a blank section, FALSE otherwise.\n   *\n   * @see \\Drupal\\layout_builder\\Plugin\\Layout\\BlankLayout\n   */\n  protected function hasBlankSection() {\n    // A blank section will only ever exist when the delta is 0, as added by\n    // ::removeSection().\n    return $this->hasSection(0) && $this->getSection(0)->getLayoutId() === 'layout_builder_blank';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function removeSection($delta) {\n    // Clear the section list if there is currently a blank section.\n    if ($this->hasBlankSection()) {\n      $this->removeAllSections();\n    }\n\n    $sections = $this->getSections();\n    unset($sections[$delta]);\n    $this->setSections($sections);\n    // Add a blank section when the last section is removed.\n    if (empty($sections)) {\n      $this->addBlankSection();\n    }\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function removeAllSections($set_blank = FALSE) {\n    $this->setSections([]);\n    if ($set_blank) {\n      $this->addBlankSection();\n    }\n    return $this;\n  }\n\n  /**\n   * Indicates if there is a section at the specified delta.\n   *\n   * @param int $delta\n   *   The delta of the section.\n   *\n   * @return bool\n   *   TRUE if there is a section for this delta, FALSE otherwise.\n   */\n  protected function hasSection($delta) {\n    return isset($this->getSections()[$delta]);\n  }\n\n  /**\n   * Magic method: Implements a deep clone.\n   */\n  public function __clone() {\n    $sections = $this->getSections();\n\n    foreach ($sections as $delta => $item) {\n      $sections[$delta] = clone $item;\n    }\n\n    $this->setSections($sections);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/layout_builder/src/SectionListTrait.php", "type": "code_reference", "symbol_kind": "trait", "symbol_name": "SectionListTrait", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface NexiXpayManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\nexi_xpay\\Service;\n\nuse Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface;\nuse Drupal\\nexi_xpay\\Value\\ModeHandleResult;\nuse Drupal\\nexi_xpay\\Value\\ModeStartResult;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\n/**\n * Interface for NexiXpayManager.\n */\ninterface NexiXpayManagerInterface {\n\n  /**\n   * Starts the payment process.\n   */\n  public function startPayment(NexiXpayTransactionInterface $transaction, Request $request): ModeStartResult;\n\n  /**\n   * Handles the return from Nexi.\n   */\n  public function handleReturn(NexiXpayTransactionInterface $transaction, Request $request): ModeHandleResult;\n\n  /**\n   * Handles the notification from Nexi.\n   */\n  public function handleNotify(NexiXpayTransactionInterface $transaction, Request $request): ModeHandleResult;\n\n  /**\n   * Builds the public pay page (order summary + CTA).\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   *\n   * @return array<string, mixed>\n   *   Render array for the pay page.\n   */\n  public function buildPayPage(NexiXpayTransactionInterface $transaction, Request $request): array;\n\n  /**\n   * Builds the public return page after handling return logic.\n   *\n   * @param \\Drupal\\nexi_xpay\\Entity\\NexiXpayTransactionInterface $transaction\n   *   The transaction entity.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   * @param \\Drupal\\nexi_xpay\\Value\\ModeHandleResult $handle\n   *   The result of handling the return.\n   *\n   * @return array<string, mixed>\n   *   The render array for the return page.\n   */\n  public function buildReturnPage(NexiXpayTransactionInterface $transaction, Request $request, ModeHandleResult $handle): array;\n\n}\n", "metadata": {"source": "repos/nexi_xpay/src/Service/NexiXpayManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "NexiXpayManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "db_wipe.admin:\n  path: '/admin/config/development/db-wipe'\n  defaults:\n    _controller: '\\Drupal\\system\\Controller\\SystemController::systemAdminMenuBlockPage'\n    _title: 'DB Wipe'\n  requirements:\n    _permission: 'administer site configuration'\n", "metadata": {"source": "repos/db_wipe/db_wipe.routing.yml", "type": "yaml_reference", "topic": "db wipe.routing"}}
{"instruction": "Show me the implementation of the class EmailItem in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Field\\Plugin\\Field\\FieldType;\n\nuse Drupal\\Component\\Utility\\Random;\nuse Drupal\\Core\\Field\\Attribute\\FieldType;\nuse Drupal\\Core\\Field\\FieldDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldStorageDefinitionInterface;\nuse Drupal\\Core\\Field\\FieldItemBase;\nuse Drupal\\Core\\Render\\Element\\Email;\nuse Drupal\\Core\\TypedData\\DataDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Defines the 'email' field type.\n */\n#[FieldType(\n  id: \"email\",\n  label: new TranslatableMarkup(\"Email\"),\n  description: new TranslatableMarkup(\"An email address, optionally displayed as an email link\"),\n  default_widget: \"email_default\",\n  default_formatter: \"basic_string\"\n)]\nclass EmailItem extends FieldItemBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function propertyDefinitions(FieldStorageDefinitionInterface $field_definition) {\n    $properties['value'] = DataDefinition::create('email')\n      ->setLabel(new TranslatableMarkup('Email'))\n      ->setRequired(TRUE);\n\n    return $properties;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function schema(FieldStorageDefinitionInterface $field_definition) {\n    return [\n      'columns' => [\n        'value' => [\n          'type' => 'varchar',\n          'length' => Email::EMAIL_MAX_LENGTH,\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getConstraints() {\n    $constraint_manager = \\Drupal::typedDataManager()->getValidationConstraintManager();\n    $constraints = parent::getConstraints();\n\n    $constraints[] = $constraint_manager->create('ComplexData', [\n      'properties' => [\n        'value' => [\n          'Length' => [\n            'max' => Email::EMAIL_MAX_LENGTH,\n            'maxMessage' => $this->t('%name: the email address can not be longer than @max characters.', [\n              '%name' => $this->getFieldDefinition()->getLabel(),\n              '@max' => Email::EMAIL_MAX_LENGTH,\n            ]),\n          ],\n        ],\n      ],\n    ]);\n\n    return $constraints;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function generateSampleValue(FieldDefinitionInterface $field_definition) {\n    $random = new Random();\n    $values['value'] = $random->name() . '@example.com';\n    return $values;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isEmpty() {\n    return $this->value === NULL || $this->value === '';\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Field/Plugin/Field/FieldType/EmailItem.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EmailItem", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class ExecutionController in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Extension\\ModuleExtensionList;\nuse Drupal\\Core\\Url;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Controller for the execution overview page.\n *\n * Provides a landing page for all execution-related actions in FlowDrop.\n */\nclass ExecutionController extends ControllerBase {\n\n  /**\n   * The module extension list.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleExtensionList\n   */\n  protected ModuleExtensionList $moduleExtensionList;\n\n  /**\n   * Constructs an ExecutionController.\n   *\n   * @param \\Drupal\\Core\\Extension\\ModuleExtensionList $moduleExtensionList\n   *   The module extension list service.\n   */\n  public function __construct(ModuleExtensionList $moduleExtensionList) {\n    $this->moduleExtensionList = $moduleExtensionList;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get(\"extension.list.module\"),\n    );\n  }\n\n  /**\n   * Renders the execution overview page.\n   *\n   * @return array<string, mixed>\n   *   A render array for the execution overview.\n   */\n  public function overview(): array {\n    // Get module path for assets.\n    $modulePath = \"/\" . $this->moduleExtensionList->getPath(\"flowdrop_ui_components\");\n\n    $build = [\n      \"#type\" => \"container\",\n      \"#attributes\" => [\n        \"class\" => [\"fd-fullscreen-layout\"],\n      ],\n      \"#attached\" => [\n        \"library\" => [\n          \"flowdrop_ui_components/fullscreen-layout\",\n          \"flowdrop_ui_components/base\",\n        ],\n      ],\n    ];\n\n    // Main content.\n    $build[\"main\"] = [\n      \"#type\" => \"container\",\n      \"#attributes\" => [\n        \"class\" => [\"fd-fullscreen-main\", \"fd-fullscreen-main--constrained\"],\n      ],\n    ];\n\n    $build[\"main\"][\"description\"] = [\n      \"#type\" => \"html_tag\",\n      \"#tag\" => \"p\",\n      \"#value\" => $this->t(\"Execute workflows and pipelines, or interact with running executions.\"),\n      \"#attributes\" => [\n        \"class\" => [\"fd-text-secondary\", \"fd-mb-6\"],\n      ],\n    ];\n\n    $links = [\n      \"#type\" => \"container\",\n      \"#attributes\" => [\n        \"class\" => [\"fd-actions-grid\", \"fd-stagger-in\"],\n      ],\n    ];\n\n    // Execute Workflow.\n    $links[\"execute_workflow\"] = [\n      \"#type\" => \"component\",\n      \"#component\" => \"flowdrop_ui_components:action-link\",\n      \"#props\" => [\n        \"title\" => $this->t(\"Run Workflow\"),\n        \"description\" => $this->t(\"Start a workflow execution with pipeline options\"),\n        \"url\" => Url::fromRoute(\"flowdrop.execute.workflow\")->toString(),\n        \"icon\" => '<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5.25 5.653c0-1.426 1.526-2.33 2.777-1.643l11.54 6.348c1.554.855 1.554 3.031 0 3.886l-11.54 6.347c-1.251.688-2.777-.217-2.777-1.643V5.653z\"/></svg>',\n      ],\n    ];\n\n    // Execute Pipeline.\n    $links[\"execute_pipeline\"] = [\n      \"#type\" => \"component\",\n      \"#component\" => \"flowdrop_ui_components:action-link\",\n      \"#props\" => [\n        \"title\" => $this->t(\"Run Pipeline\"),\n        \"description\" => $this->t(\"Run an existing pipeline directly\"),\n        \"url\" => Url::fromRoute(\"flowdrop.execute.pipeline\")->toString(),\n        \"icon\" => '<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5.25 5.653c0-1.426 1.526-2.33 2.777-1.643l11.54 6.348c1.554.855 1.554 3.031 0 3.886l-11.54 6.347c-1.251.688-2.777-.217-2.777-1.643V5.653z\"/></svg>',\n      ],\n    ];\n\n    // Pipeline Interaction.\n    $links[\"interact\"] = [\n      \"#type\" => \"component\",\n      \"#component\" => \"flowdrop_ui_components:action-link\",\n      \"#props\" => [\n        \"title\" => $this->t(\"Pipeline Interaction\"),\n        \"description\" => $this->t(\"Manage and control running pipelines\"),\n        \"url\" => Url::fromRoute(\"flowdrop.execute.interact\")->toString(),\n        \"icon\" => '<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"size-6\">\n  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z\" />\n</svg>\n',\n      ],\n    ];\n\n    $build[\"main\"][\"links\"] = $links;\n\n    return $build;\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Controller/ExecutionController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ExecutionController", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: DuplicateInfoFileValidator\nSource file: <source_file>\nFile name hint: DuplicateInfoFileValidator.php\nBroken snippet:\n<?php\n\ndeclare(strict_types=0);\n\nnamespace Drupal\\package_manager\\Validator;\n\nuse Drupal\\Core\\Extension\\ExtensionDiscovery;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\package_manager\\Event\\PreApplyEvent;\nuse Drupal\\package_manager\\PathLocator;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Validates the stage does not have duplicate info.yml not present in active.\n *\n * @internal\n *   This is an internal part of Package Manager and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class DuplicateInfoFileValidator implements EventSubscriberInterface {\n\n  use StringTranslationTrait;\n\n  public function __construct(private readonly PathLocator $pathLocator) {\n  }\n\n  /**\n   * Validates the stage does not have duplicate info.yml not present in active.\n   */\n  public function validate(PreApplyEvent $event): void {\n    $active_dir = $this->pathLocator->getProjectRoot();\n    $stage_dir = $event->sandboxManager->getSandboxDirectory();\n    $active_info_files = $this->findInfoFiles($active_dir);\n    $stage_info_files = $this->findInfoFiles($stage_dir);\n\n    foreach ($stage_info_files as $stage_info_file => $stage_info_count) {\n      if (isset($active_info_files[$stage_info_file])) {\n        // Check if stage directory has more info.yml files matching\n        // $stage_info_file than in the active directory.\n        if ($stage_info_count > $active_info_files[$stage_info_file]) {\n          $event->addError([\n            $this->t('The stage directory has @stage_count instances of @stage_info_file as compared to @active_count in the active directory. This likely indicates that a duplicate extension was installed.', [\n              '@stage_info_file' => $stage_info_file,\n              '@stage_count' => $stage_info_count,\n              '@active_count' => $active_info_files[$stage_info_file],\n            ]),\n          ]);\n        }\n      }\n      // Check if stage directory has two or more info.yml files matching\n      // $stage_info_file which are not in active directory.\n      elseif ($stage_info_count > 1) {\n        $event->addError([\n          $this->t('The stage directory has @stage_count instances of @stage_info_file. This likely indicates that a duplicate extension was installed.', [\n            '@stage_info_file' => $stage_info_file,\n            '@stage_count' => $stage_info_count,\n          ]),\n        ]);\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      PreApplyEvent::class => 'validate',\n    ];\n  }\n\n  /**\n   * Recursively finds info.yml files in a directory.\n   *\n   * @param string $dir\n   *   The path of the directory to check.\n   *\n   * @return int[]\n   *   Array of count of info.yml files in the directory keyed by file name.\n   */\n  private function findInfoFiles(string $dir): array {\n    // Use the official extension discovery mechanism, but tweak it, because by\n    // default it resolves duplicates.\n    // @see \\Drupal\\Core\\Extension\\ExtensionDiscovery::process()\n    $duplicate_aware_extension_discovery = new class($dir, FALSE, []) extends ExtensionDiscovery {\n\n      /**\n       * {@inheritdoc}\n       */\n      protected function process(array $all_files) {\n        // Unlike parent implementation: no processing, to retain duplicates.\n        return $all_files;\n      }\n\n    };\n\n    // Scan all 4 extension types, explicitly ignoring tests.\n    $extension_info_files = array_merge(\n      array_keys($duplicate_aware_extension_discovery->scan('module', FALSE)),\n      array_keys($duplicate_aware_extension_discovery->scan('theme', FALSE)),\n      array_keys($duplicate_aware_extension_discovery->scan('profile', FALSE)),\n      array_keys($duplicate_aware_extension_discovery->scan('theme_engine', FALSE)),\n    );\n\n    $info_files = [];\n    foreach ($extension_info_files as $info_file) {\n      $file_name = basename($info_file);\n      $info_files[$file_name] = ($info_files[$file_name] ?? 0) + 1;\n    }\n    return $info_files;\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\package_manager\\Validator;\n\nuse Drupal\\Core\\Extension\\ExtensionDiscovery;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\package_manager\\Event\\PreApplyEvent;\nuse Drupal\\package_manager\\PathLocator;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\n/**\n * Validates the stage does not have duplicate info.yml not present in active.\n *\n * @internal\n *   This is an internal part of Package Manager and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class DuplicateInfoFileValidator implements EventSubscriberInterface {\n\n  use StringTranslationTrait;\n\n  public function __construct(private readonly PathLocator $pathLocator) {\n  }\n\n  /**\n   * Validates the stage does not have duplicate info.yml not present in active.\n   */\n  public function validate(PreApplyEvent $event): void {\n    $active_dir = $this->pathLocator->getProjectRoot();\n    $stage_dir = $event->sandboxManager->getSandboxDirectory();\n    $active_info_files = $this->findInfoFiles($active_dir);\n    $stage_info_files = $this->findInfoFiles($stage_dir);\n\n    foreach ($stage_info_files as $stage_info_file => $stage_info_count) {\n      if (isset($active_info_files[$stage_info_file])) {\n        // Check if stage directory has more info.yml files matching\n        // $stage_info_file than in the active directory.\n        if ($stage_info_count > $active_info_files[$stage_info_file]) {\n          $event->addError([\n            $this->t('The stage directory has @stage_count instances of @stage_info_file as compared to @active_count in the active directory. This likely indicates that a duplicate extension was installed.', [\n              '@stage_info_file' => $stage_info_file,\n              '@stage_count' => $stage_info_count,\n              '@active_count' => $active_info_files[$stage_info_file],\n            ]),\n          ]);\n        }\n      }\n      // Check if stage directory has two or more info.yml files matching\n      // $stage_info_file which are not in active directory.\n      elseif ($stage_info_count > 1) {\n        $event->addError([\n          $this->t('The stage directory has @stage_count instances of @stage_info_file. This likely indicates that a duplicate extension was installed.', [\n            '@stage_info_file' => $stage_info_file,\n            '@stage_count' => $stage_info_count,\n          ]),\n        ]);\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      PreApplyEvent::class => 'validate',\n    ];\n  }\n\n  /**\n   * Recursively finds info.yml files in a directory.\n   *\n   * @param string $dir\n   *   The path of the directory to check.\n   *\n   * @return int[]\n   *   Array of count of info.yml files in the directory keyed by file name.\n   */\n  private function findInfoFiles(string $dir): array {\n    // Use the official extension discovery mechanism, but tweak it, because by\n    // default it resolves duplicates.\n    // @see \\Drupal\\Core\\Extension\\ExtensionDiscovery::process()\n    $duplicate_aware_extension_discovery = new class($dir, FALSE, []) extends ExtensionDiscovery {\n\n      /**\n       * {@inheritdoc}\n       */\n      protected function process(array $all_files) {\n        // Unlike parent implementation: no processing, to retain duplicates.\n        return $all_files;\n      }\n\n    };\n\n    // Scan all 4 extension types, explicitly ignoring tests.\n    $extension_info_files = array_merge(\n      array_keys($duplicate_aware_extension_discovery->scan('module', FALSE)),\n      array_keys($duplicate_aware_extension_discovery->scan('theme', FALSE)),\n      array_keys($duplicate_aware_extension_discovery->scan('profile', FALSE)),\n      array_keys($duplicate_aware_extension_discovery->scan('theme_engine', FALSE)),\n    );\n\n    $info_files = [];\n    foreach ($extension_info_files as $info_file) {\n      $file_name = basename($info_file);\n      $info_files[$file_name] = ($info_files[$file_name] ?? 0) + 1;\n    }\n    return $info_files;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/package_manager/src/Validator/DuplicateInfoFileValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DuplicateInfoFileValidator", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Show me the implementation of the class ActiveTheme in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Theme;\n\n/**\n * Defines a theme and its information needed at runtime.\n *\n * The theme manager will store the active theme object.\n *\n * @see \\Drupal\\Core\\Theme\\ThemeManager\n * @see \\Drupal\\Core\\Theme\\ThemeInitialization\n */\nclass ActiveTheme {\n\n  /**\n   * The machine name of the active theme.\n   *\n   * @var string\n   */\n  protected $name;\n\n  /**\n   * The path to the logo.\n   *\n   * @var string\n   */\n  protected $logo;\n\n  /**\n   * The path to the theme.\n   *\n   * @var string\n   */\n  protected $path;\n\n  /**\n   * The engine of the theme.\n   *\n   * @var string\n   */\n  protected $engine;\n\n  /**\n   * The path to the theme engine for root themes.\n   *\n   * @var string\n   */\n  protected $owner;\n\n\n  /**\n   * An array of base theme extension objects keyed by name.\n   *\n   * @var \\Drupal\\Core\\Extension\\Extension[]\n   */\n  protected $baseThemeExtensions = [];\n\n  /**\n   * The extension object.\n   *\n   * @var \\Drupal\\Core\\Extension\\Extension\n   */\n  protected $extension;\n\n  /**\n   * The libraries provided by the theme.\n   *\n   * @var array\n   */\n  protected $libraries;\n\n  /**\n   * The regions provided by the theme.\n   *\n   * @var array\n   */\n  protected $regions;\n\n  /**\n   * The libraries or library assets overridden by the theme.\n   *\n   * @var array\n   */\n  protected $librariesOverride;\n\n  /**\n   * The list of libraries-extend definitions.\n   *\n   * @var array\n   */\n  protected $librariesExtend;\n\n  /**\n   * Constructs an ActiveTheme object.\n   *\n   * @param array $values\n   *   The properties of the object, keyed by the names.\n   */\n  public function __construct(array $values) {\n    $values += [\n      'path' => '',\n      'engine' => 'twig',\n      'owner' => 'twig',\n      'logo' => '',\n      'libraries' => [],\n      'extension' => 'html.twig',\n      'base_theme_extensions' => [],\n      'regions' => [],\n      'libraries_override' => [],\n      'libraries_extend' => [],\n    ];\n\n    $this->name = $values['name'];\n    $this->logo = $values['logo'];\n    $this->path = $values['path'];\n    $this->engine = $values['engine'];\n    $this->owner = $values['owner'];\n    $this->libraries = $values['libraries'];\n    $this->extension = $values['extension'];\n    $this->baseThemeExtensions = $values['base_theme_extensions'];\n    $this->regions = $values['regions'];\n    $this->librariesOverride = $values['libraries_override'];\n    $this->librariesExtend = $values['libraries_extend'];\n  }\n\n  /**\n   * Returns the machine name of the theme.\n   *\n   * @return string\n   *   The machine name for the theme.\n   */\n  public function getName() {\n    return $this->name;\n  }\n\n  /**\n   * Returns the path to the theme directory.\n   *\n   * @return string\n   *   The file path of the theme directory.\n   */\n  public function getPath() {\n    return $this->path;\n  }\n\n  /**\n   * Returns the theme engine.\n   *\n   * @return string\n   *   The engine of the theme.\n   */\n  public function getEngine() {\n    return $this->engine;\n  }\n\n  /**\n   * Returns the path to the theme engine for root themes.\n   *\n   * @return mixed\n   *   The path to the theme engine for root themes.\n   *\n   * @see \\Drupal\\Core\\Extension\\ThemeExtensionList::doList()\n   */\n  public function getOwner() {\n    @trigger_error(__METHOD__ . '() is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. Theme engines are now tagged services instead of extensions. See https://www.drupal.org/node/3547356', E_USER_DEPRECATED);\n    return $this->owner;\n  }\n\n  /**\n   * Returns the extension object.\n   *\n   * @return \\Drupal\\Core\\Extension\\Extension\n   *   The extension object for the theme.\n   */\n  public function getExtension() {\n    return $this->extension;\n  }\n\n  /**\n   * Returns the libraries provided by the theme.\n   *\n   * @return mixed\n   *   The libraries provided by the theme.\n   */\n  public function getLibraries() {\n    return $this->libraries;\n  }\n\n  /**\n   * Returns an array of base theme extension objects keyed by name.\n   *\n   * The order starts with the base theme of $this and ends with the root of\n   * the dependency chain. For most use cases, parent themes are expected to\n   * be called first, so this order needs to be reversed with array_reverse()\n   *\n   * @return \\Drupal\\Core\\Extension\\Extension[]\n   *   An array of base theme extension objects keyed by name.\n   */\n  public function getBaseThemeExtensions() {\n    return $this->baseThemeExtensions;\n  }\n\n  /**\n   * Returns the logo provided by the theme.\n   *\n   * @return string\n   *   The logo path.\n   */\n  public function getLogo() {\n    return $this->logo;\n  }\n\n  /**\n   * The regions used by the theme.\n   *\n   * @return string[]\n   *   The list of region machine names supported by the theme.\n   *\n   * @see system_region_list()\n   */\n  public function getRegions() {\n    return array_keys($this->regions);\n  }\n\n  /**\n   * Returns the libraries or library assets overridden by the active theme.\n   *\n   * @return array\n   *   The list of libraries overrides.\n   */\n  public function getLibrariesOverride() {\n    return $this->librariesOverride;\n  }\n\n  /**\n   * Returns the libraries extended by the active theme.\n   *\n   * @return array\n   *   The list of libraries-extend definitions.\n   */\n  public function getLibrariesExtend() {\n    return $this->librariesExtend;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/ActiveTheme.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ActiveTheme", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class TokenBrowser in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Provides alternative token browser element.\n */\n\nuse Drupal\\token_browser\\Hook\\TokenBrowserThemeHooks;\n\n/**\n * Theme a link to a token tree shown as a dialog.\n */\nfunction template_preprocess_token_browser_link(&$variables): void {\n  \\Drupal::service(TokenBrowserThemeHooks::class)->preprocessTokenBrowserLink($variables);\n}\n", "metadata": {"source": "repos/token_browser/token_browser.module", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TokenBrowser", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: AJAX API", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal APIs](/docs/develop/drupal-apis)\n\n* [Access Policy API](/docs/develop/drupal-apis/access-policy-api)\n* [AJAX API](/docs/develop/drupal-apis/ajax-api)\n* [Authentication API](/docs/develop/drupal-apis/authentication-api)\n* [Batch API](/docs/drupal-apis/batch-api)\n* [Block API](/docs/drupal-apis/block-api)\n* [Cache API](/docs/develop/drupal-apis/cache-api)\n* [(deprecated) CKEditor 4 API](/docs/drupal-apis/deprecated-ckeditor-4-api-drupal-8-and-9)\n* [CKEditor 5 API](/docs/drupal-apis/ckeditor-5-api)\n* [Configuration API](/docs/drupal-apis/configuration-api)\n* [Database API](/docs/develop/drupal-apis/database-api)\n* [Entity API](/docs/drupal-apis/entity-api)\n* [Filter API](/docs/drupal-apis/filter-api)\n* [Form API](/docs/drupal-apis/form-api)\n* [JavaScript API](/docs/develop/drupal-apis/javascript-api)\n* [Layout API](/docs/drupal-apis/layout-api)\n* [Logging API](/docs/drupal-apis/logging-api)\n* [Menu API](/docs/drupal-apis/menu-api)\n* [Middleware API](/docs/drupal-apis/middleware-api)\n* [Migrate API](/docs/drupal-apis/migrate-api)\n* [Plugin API](/docs/drupal-apis/plugin-api)\n* [RESTful Web Services API](/docs/develop/drupal-apis/restful-web-services-api)\n* [Render API](/docs/drupal-apis/render-api)\n* [Responses](/docs/drupal-apis/responses)\n* [Routing system](/docs/drupal-apis/routing-system)\n* [Runtime Assertions](/docs/develop/drupal-apis/runtime-assertions)\n* [Serialization API](/docs/drupal-apis/serialization-api)\n* [Services and dependency injection](/docs/drupal-apis/services-and-dependency-injection)\n* [State API](/docs/develop/drupal-apis/state-api)\n* [Text Editor API](/docs/drupal-apis/text-editor-api)\n* [Tour API](/docs/drupal-apis/tour-api)\n* [Translation API](/docs/develop/drupal-apis/translation-api-code-text)\n* [Typed Data API](/docs/develop/drupal-apis/typed-data-api)\n* [Update API](/docs/drupal-apis/update-api)\n* [HTMX](/docs/develop/drupal-apis/htmx)\n* [Icon API](/docs/develop/drupal-apis/icon-api)\n* [Token API](/docs/develop/drupal-apis/token-api)\n\n# AJAX API\n\nThe AJAX API allows information displayed on forms to be updated dynamically without reloading the entire page.\u00a0 This API allows replacing DOM elements with new HTML or executing jQuery commands.\u00a0 The following pages will show how to use the built in AJAX API to modify your own pages.\n\n**THIS IS A WORK IN PROGRESS**, please feel free to add to this documentation.\n\n## [Basic Concepts](/docs/develop/drupal-apis/ajax-api/basic-concepts)\n\nBasic Concepts of Using the AJAX API.\n\n## [Core AJAX Callback Commands](/docs/develop/drupal-apis/ajax-api/core-ajax-callback-commands)\n\nDescription of AJAX Callback Commands from Core.\n\n## [Ajax Dialog Boxes](/docs/develop/drupal-apis/ajax-api/ajax-dialog-boxes)\n\nDialogs are a quick way to display results of your Ajax requests. Drupal offers different types of dialogs, modal, non modal and off canvas.\n\n## Related Content\n\n## [Conditional Form Fields](/docs/drupal-apis/form-api/conditional-form-fields)\n\nShow or hide, enable, disable or require form fields based on values of other fields using the #states property of form render arrays.\n\n[FormElement](/taxonomy/term/187932)\n\n[#states](/taxonomy/term/192009)\n\n## [AJAX Forms](/docs/develop/drupal-apis/javascript-api/ajax-forms)\n\nUsing AJAX callbacks to dynamically react on user input, alter form elements, show dialog boxes or run custom Javascript functions.\n\n[Ajax](/taxonomy/term/189112)\n\n[FormElement](/taxonomy/term/187932)\n\n[forms](/taxonomy/term/183073)\n\n## Tags\n\n[Ajax](/taxonomy/term/189112)\n\n[API](/taxonomy/term/187496)\n\n## Guide maintainers\n\n[![kwfinken's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-2514950-1767711855.jpg?itok=4tMJge2d)](/user/2514950 \"View kwfinken's profile\")\n\n[![lowfidelity's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-1620860-1732872818.png?itok=AC7uCfJs)](/user/1620860 \"View lowfidelity's profile\")\n\n[![mcdwayne's picture](https://www.drupal.org/files/styles/drupalorg_user_picture/public/user-pictures/picture-2813305-1456692880.jpg?itok=_5rPyY74)](/user/2813305 \"View mcdwayne's profile\")\n", "metadata": {"source": "docs/www_drupal_org/docs/develop/drupal-apis/ajax-api.md", "type": "doc_summary", "topic": "AJAX API"}}
{"instruction": "Show me the implementation of the class ApiToAgentContextService in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization_agents\\Service;\n\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse GuzzleHttp\\ClientInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Converts API responses to agent-consumable context.\n */\nfinal class ApiToAgentContextService {\n\n  /**\n   * Constructs an ApiToAgentContextService object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entityTypeManager\n   *   The entity type manager.\n   * @param \\GuzzleHttp\\ClientInterface $httpClient\n   *   The HTTP client.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger channel.\n   */\n  public function __construct(\n    private readonly EntityTypeManagerInterface $entityTypeManager,\n    private readonly ClientInterface $httpClient,\n    private readonly LoggerInterface $logger,\n  ) {}\n\n  /**\n   * Transforms API response data for agent consumption.\n   *\n   * @param array<string, mixed> $responseData\n   *   The raw API response data.\n   * @param string $format\n   *   The desired output format (text, json, structured).\n   * @param int $maxTokens\n   *   Maximum tokens to include in output.\n   *\n   * @return array<string, mixed>\n   *   Transformed data suitable for agent context.\n   */\n  public function transformResponse(array $responseData, string $format = 'structured', int $maxTokens = 2000): array {\n    try {\n      return match ($format) {\n        'text' => $this->transformToText($responseData, $maxTokens),\n        'json' => $this->transformToJson($responseData, $maxTokens),\n        'structured' => $this->transformToStructured($responseData, $maxTokens),\n        default => ['error' => 'Unknown format'],\n      };\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to transform response: @message', [\n        '@message' => $e->getMessage(),\n      ]);\n      return ['error' => $e->getMessage()];\n    }\n  }\n\n  /**\n   * Transforms response to plain text format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   Text-formatted response.\n   */\n  private function transformToText(array $data, int $maxTokens): array {\n    $text = $this->flattenArray($data);\n    $text = $this->truncateToTokenLimit($text, $maxTokens);\n\n    return [\n      'format' => 'text',\n      'content' => $text,\n      'tokens_estimate' => $this->estimateTokens($text),\n    ];\n  }\n\n  /**\n   * Transforms response to JSON format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   JSON-formatted response.\n   */\n  private function transformToJson(array $data, int $maxTokens): array {\n    $json = json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES);\n    $json = $this->truncateToTokenLimit($json, $maxTokens);\n\n    return [\n      'format' => 'json',\n      'content' => $json,\n      'tokens_estimate' => $this->estimateTokens($json),\n    ];\n  }\n\n  /**\n   * Transforms response to structured format.\n   *\n   * @param array<string, mixed> $data\n   *   The response data.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return array<string, mixed>\n   *   Structured response.\n   */\n  private function transformToStructured(array $data, int $maxTokens): array {\n    return [\n      'format' => 'structured',\n      'content' => $data,\n      'tokens_estimate' => $this->estimateTokens(json_encode($data)),\n    ];\n  }\n\n  /**\n   * Flattens array to text representation.\n   *\n   * @param array<string, mixed> $array\n   *   The array to flatten.\n   * @param string $prefix\n   *   Key prefix for nested values.\n   *\n   * @return string\n   *   Flattened text.\n   */\n  private function flattenArray(array $array, string $prefix = ''): string {\n    $result = '';\n\n    foreach ($array as $key => $value) {\n      $fullKey = $prefix === '' ? (string) $key : \"{$prefix}.{$key}\";\n\n      if (is_array($value)) {\n        $result .= $this->flattenArray($value, $fullKey);\n      }\n      else {\n        $result .= \"{$fullKey}: {$value}\\n\";\n      }\n    }\n\n    return $result;\n  }\n\n  /**\n   * Truncates text to token limit.\n   *\n   * @param string $text\n   *   The text to truncate.\n   * @param int $maxTokens\n   *   Maximum tokens.\n   *\n   * @return string\n   *   Truncated text.\n   */\n  private function truncateToTokenLimit(string $text, int $maxTokens): string {\n    // Rough estimate: 1 token \u2248 4 characters.\n    $maxChars = $maxTokens * 4;\n\n    if (strlen($text) <= $maxChars) {\n      return $text;\n    }\n\n    return substr($text, 0, $maxChars) . \"\\n... (truncated)\";\n  }\n\n  /**\n   * Estimates token count from text.\n   *\n   * @param string $text\n   *   The text.\n   *\n   * @return int\n   *   Estimated token count.\n   */\n  private function estimateTokens(string $text): int {\n    // Rough estimate: 1 token \u2248 4 characters.\n    return (int) ceil(strlen($text) / 4);\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_agents/src/Service/ApiToAgentContextService.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiToAgentContextService", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class AdminDemoNegotiator in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block\\Theme;\n\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Theme\\ThemeNegotiatorInterface;\n\n/**\n * Negotiates the theme for the block admin demo page via the URL.\n */\nclass AdminDemoNegotiator implements ThemeNegotiatorInterface {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function applies(RouteMatchInterface $route_match) {\n    return $route_match->getRouteName() == 'block.admin_demo';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function determineActiveTheme(RouteMatchInterface $route_match) {\n    // We return exactly what was passed in, to guarantee that the page will\n    // always be displayed using the theme whose blocks are being configured.\n    return $route_match->getParameter('theme');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block/src/Theme/AdminDemoNegotiator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AdminDemoNegotiator", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "db_wipe_db.settings:\n  type: config_object\n  label: 'DB Wipe Database settings'\n  mapping:\n    allowed_tables:\n      type: sequence\n      label: 'Allowed tables for truncation'\n      sequence:\n        type: string\n        label: 'Table name'\n    protected_tables:\n      type: sequence\n      label: 'Protected tables (never truncate)'\n      sequence:\n        type: string\n        label: 'Table name'\n    logging:\n      type: mapping\n      label: 'Logging settings'\n      mapping:\n        enabled:\n          type: boolean\n          label: 'Enable logging of truncate operations'\n        log_row_counts:\n          type: boolean\n          label: 'Log row counts before truncation'\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_db/config/schema/db_wipe_db.schema.yml", "type": "yaml_reference", "topic": "db wipe db.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "book.admin:\n  title: Books\n  description: 'Manage your site''s book outlines.'\n  parent: system.admin_structure\n  route_name: book.admin\nbook.render:\n  title: Books\n  route_name: book.render\n  enabled: 0\n", "metadata": {"source": "repos/livre/book/book.links.menu.yml", "type": "yaml_reference", "topic": "book.links.menu"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: CountryBlockSubscriber.php\nTarget symbol: class CountryBlockSubscriber\nNamespace: Drupal\\country_block\\EventSubscriber\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CountryBlockSubscriber.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Session\\AccountInterface\n  - Symfony\\Component\\EventDispatcher\\EventSubscriberInterface\n  - Symfony\\Component\\HttpKernel\\Event\\RequestEvent\n  - Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException\n  - Symfony\\Component\\HttpKernel\\KernelEvents\n- Ensure these methods exist where relevant:\n  - __construct()\n  - checkCountryBlock()\n  - getSubscribedEvents()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\country_block\\EventSubscriber;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Symfony\\Component\\HttpKernel\\Event\\RequestEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException;\nuse Symfony\\Component\\HttpKernel\\KernelEvents;\n\n/**\n * Blocks users from specific countries based on IP address.\n *\n * This subscriber listens to kernel requests and denies access to users\n * from countries defined in the module's configuration.\n */\nfinal class CountryBlockSubscriber implements EventSubscriberInterface {\n\n  /**\n   * Constructs a new CountryBlockSubscriber.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $currentUser\n   *   The current user.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory.\n   */\n  public function __construct(\n    private readonly AccountInterface $currentUser,\n    private readonly ConfigFactoryInterface $configFactory,\n  ) {}\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents(): array {\n    return [\n      KernelEvents::REQUEST => ['checkCountryBlock'],\n    ];\n  }\n\n  /**\n   * Checks the user's country and blocks them if they are from a blocked\n   * country.\n   *\n   * This method is called for every kernel request.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\RequestEvent $event\n   *   The dispatched event.\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException\n   *   Thrown when the user's country is in the blocked list.\n   */\n  public function checkCountryBlock(RequestEvent $event): void {\n    // Do not block users with permission to administer site configuration.\n    if ($this->currentUser->hasPermission('administer site configuration')) {\n      return;\n    }\n\n    $config = $this->configFactory->get('country_block.settings');\n    $blocked_countries = $config->get('blocked_countries') ?? [];\n\n    if (empty($blocked_countries)) {\n      return;\n    }\n\n    // Current visitor location.\n    /** @var \\Drupal\\smart_ip\\SmartIpLocation $locationService */\n    $locationService = \\Drupal::service('smart_ip.smart_ip_location');\n    $location = $locationService->getData();\n    if (empty($location)) {\n      return;\n    }\n\n    $country_code = $location->get('countryCode');\n\n    if ($country_code !== NULL && in_array($country_code, $blocked_countries, TRUE)) {\n      $message = $config->get('message') ?? 'Access from your country is not permitted.';\n      throw new AccessDeniedHttpException($message);\n    }\n  }\n\n}\n", "metadata": {"source": "repos/country_block/src/EventSubscriber/CountryBlockSubscriber.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CountryBlockSubscriber", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<sl-dropdown {{ attributes.setAttribute('placement', placement|default('bottom-start')) }}>\n  {% if tooltip %}\n    <sl-tooltip slot=\"trigger\" content=\"{{ tooltip }}\" style=\"display: inline-block;\">\n      {{ button|set_attribute('caret', 'caret') }}\n    </sl-tooltip>\n  {% else %}\n    {{ button|set_attribute('slot', 'trigger')|set_attribute('caret', 'caret') }}\n  {% endif %}\n  {{ content }}\n</sl-dropdown>\n", "metadata": {"source": "repos/display_builder/components/shoelace/dropdown/dropdown.twig", "type": "twig_reference"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{% extends \"block.html.twig\" %}\n{#\n/**\n * @file\n * Theme override for a disclaimer block.\n *\n * Displays Umami Disclaimer and Copyright text.\n *\n * Available variables:\n * - content.field_disclaimer: Content of Disclaimer formatted text field.\n * - content.field_copyright: Content of Copyright formatted text field.\n */\n#}\n{% block content %}\n  {% embed 'umami:disclaimer' with {\n    attributes: create_attribute(),\n    content,\n  } only %}\n    {% block copyright %}\n      {{ content.field_copyright }}\n    {% endblock %}\n    {% block disclaimer %}\n      {{ content.field_disclaimer }}\n    {% endblock %}\n  {% endembed %}\n{% endblock %}\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/components/disclaimer/block--bundle--disclaimer-block.html.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class RouteAccessController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\book\\Controller;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\book\\Entity\\Node\\Book;\nuse Drupal\\node\\NodeInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Controller for route access.\n */\nclass RouteAccessController extends ControllerBase implements ContainerInjectionInterface {\n\n  /**\n   * Constructs the route access controller.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The BookManager service.\n   */\n  public function __construct(\n    protected BookManagerInterface $bookManager,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager')\n    );\n  }\n\n  /**\n   * Checks access for a specific request.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   Run access checks for this account.\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The book node.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(AccountInterface $account, NodeInterface $node): AccessResultInterface {\n    // Checks if user has permission to reorder pages.\n    $hasAccess = $account->hasPermission('reorder book pages');\n\n    // Checks if book has children.\n    $haveChildren = $this->checkIfBookHasChildren($node);\n\n    if ($haveChildren) {\n      // Checks if number of book page is more than one.\n      $ifExceedsCount = $this->checkIfChildIsGreaterThanOne($node);\n    }\n    else {\n      $ifExceedsCount = FALSE;\n    }\n\n    return AccessResult::allowedIf($hasAccess && $haveChildren && $ifExceedsCount);\n  }\n\n  /**\n   * Checks if a book have children.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The book node.\n   */\n  public function checkIfBookHasChildren(NodeInterface $node): bool {\n    assert($node instanceof Book);\n    return (bool) ($node->getBook()['has_children'] ?? FALSE);\n  }\n\n  /**\n   * Checks if child of a book is more than one.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The book node.\n   */\n  public function checkIfChildIsGreaterThanOne(NodeInterface $node): bool {\n    assert($node instanceof Book);\n    $children = $this->bookManager->bookSubtreeData($node->getBook());\n    $child = reset($children);\n\n    return !empty($child['below']) && count($child['below']) > 1;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Controller/RouteAccessController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RouteAccessController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "langcode: en\nstatus: true\ndependencies:\n  module:\n    - soap_client\n  enforced:\n    module:\n      - soap_client\nid: soap_response.default\nlabel: Default\ntargetEntityType: soap_response\ncache: true\n", "metadata": {"source": "repos/soap_client/config/install/core.entity_view_mode.soap_response.default.yml", "type": "yaml_reference", "topic": "core.entity view mode.soap response.default"}}
{"instruction": "Show me the implementation of the class SiteExportCommand in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\drupal_cms_helper\\Drush\\Commands;\n\nuse Composer\\InstalledVersions;\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\Recipe\\Recipe;\nuse Drupal\\drupal_cms_helper\\SiteExporter;\nuse Drush\\Commands\\AutowireTrait;\nuse Drush\\Style\\DrushStyle;\nuse Symfony\\Component\\Console\\Attribute\\AsCommand;\nuse Symfony\\Component\\Console\\Command\\Command;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Input\\InputOption;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\n/**\n * @internal\n *   This is an internal part of Drupal CMS and may be changed or removed at any\n *   time without warning. External code should not interact with this class.\n */\n#[AsCommand(\n  name: 'site:export',\n  description: \"Exports the site's configuration and content as a recipe.\",\n  aliases: ['siex', 'six'],\n)]\nfinal class SiteExportCommand extends Command {\n\n  use AutowireTrait;\n\n  public function __construct(private readonly SiteExporter $exporter) {\n    parent::__construct();\n  }\n\n  #[\\Override]\n  protected function configure(): void {\n    $this->addOption('destination', NULL, InputOption::VALUE_REQUIRED, 'The destination directory where the site should be exported. Defaults to the location where Composer installs recipes.');\n  }\n\n  #[\\Override]\n  protected function execute(InputInterface $input, OutputInterface $output): int {\n    $destination = $input->getOption('destination') ?? $this->findDestination();\n    $this->exporter->export($destination);\n\n    (new DrushStyle($input, $output))\n      ->success(\"Recipe created at $destination\");\n    return self::SUCCESS;\n  }\n\n  private function findDestination(): string {\n    ['install_path' => $project_root] = InstalledVersions::getRootPackage();\n    // There's no need to use the realpath() method of FileSystemInterface; its\n    // purpose is to handle stream wrappers, which are irrelevant here.\n    $project_root = realpath($project_root);\n    $data = file_get_contents($project_root . DIRECTORY_SEPARATOR . 'composer.json');\n    $data = Json::decode($data);\n\n    $installer_paths = $data['extra']['installer-paths'] ?? [];\n    foreach ($installer_paths as $path => $criteria) {\n      if (in_array('type:' . Recipe::COMPOSER_PROJECT_TYPE, $criteria, TRUE)) {\n        $path = ltrim($path, '.' . DIRECTORY_SEPARATOR);\n        return str_replace('{$name}', 'site_export', $project_root . DIRECTORY_SEPARATOR . $path);\n      }\n    }\n    throw new \\RuntimeException('Could not determine where Composer installs recipes.');\n  }\n\n}\n", "metadata": {"source": "repos/drupal_cms_helper/src/Drush/Commands/SiteExportCommand.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SiteExportCommand", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  inline_image_saver.saver:\n    class: Drupal\\inline_image_saver\\InlineImageSaver\n    autowire: true\n  Drupal\\inline_image_saver\\InlineImageSaverInterface: '@inline_image_saver.saver'\n", "metadata": {"source": "repos/inline_image_saver/inline_image_saver.services.yml", "type": "yaml_reference", "topic": "inline image saver.services"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: RouteAccessController.php\nTarget symbol: class RouteAccessController\nNamespace: Drupal\\book\\Controller\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for RouteAccessController.\n- Include required imports:\n  - Drupal\\Core\\Access\\AccessResult\n  - Drupal\\Core\\Access\\AccessResultInterface\n  - Drupal\\Core\\Controller\\ControllerBase\n  - Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface\n  - Drupal\\Core\\Session\\AccountInterface\n  - Drupal\\book\\BookManagerInterface\n  - Drupal\\book\\Entity\\Node\\Book\n  - Drupal\\node\\NodeInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - access()\n  - checkIfBookHasChildren()\n  - checkIfChildIsGreaterThanOne()\n  - create()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\book\\Controller;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\DependencyInjection\\ContainerInjectionInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\book\\BookManagerInterface;\nuse Drupal\\book\\Entity\\Node\\Book;\nuse Drupal\\node\\NodeInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Controller for route access.\n */\nclass RouteAccessController extends ControllerBase implements ContainerInjectionInterface {\n\n  /**\n   * Constructs the route access controller.\n   *\n   * @param \\Drupal\\book\\BookManagerInterface $bookManager\n   *   The BookManager service.\n   */\n  public function __construct(\n    protected BookManagerInterface $bookManager,\n  ) {\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container): static {\n    return new static(\n      $container->get('book.manager')\n    );\n  }\n\n  /**\n   * Checks access for a specific request.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   Run access checks for this account.\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The book node.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   */\n  public function access(AccountInterface $account, NodeInterface $node): AccessResultInterface {\n    // Checks if user has permission to reorder pages.\n    $hasAccess = $account->hasPermission('reorder book pages');\n\n    // Checks if book has children.\n    $haveChildren = $this->checkIfBookHasChildren($node);\n\n    if ($haveChildren) {\n      // Checks if number of book page is more than one.\n      $ifExceedsCount = $this->checkIfChildIsGreaterThanOne($node);\n    }\n    else {\n      $ifExceedsCount = FALSE;\n    }\n\n    return AccessResult::allowedIf($hasAccess && $haveChildren && $ifExceedsCount);\n  }\n\n  /**\n   * Checks if a book have children.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The book node.\n   */\n  public function checkIfBookHasChildren(NodeInterface $node): bool {\n    assert($node instanceof Book);\n    return (bool) ($node->getBook()['has_children'] ?? FALSE);\n  }\n\n  /**\n   * Checks if child of a book is more than one.\n   *\n   * @param \\Drupal\\node\\NodeInterface $node\n   *   The book node.\n   */\n  public function checkIfChildIsGreaterThanOne(NodeInterface $node): bool {\n    assert($node instanceof Book);\n    $children = $this->bookManager->bookSubtreeData($node->getBook());\n    $child = reset($children);\n\n    return !empty($child['below']) && count($child['below']) > 1;\n  }\n\n}\n", "metadata": {"source": "repos/livre/book/src/Controller/RouteAccessController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RouteAccessController", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface BlockManagerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Block;\n\nuse Drupal\\Component\\Plugin\\CategorizingPluginManagerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextAwarePluginManagerInterface;\nuse Drupal\\Core\\Plugin\\FilteredPluginManagerInterface;\n\n/**\n * Provides an interface for the discovery and instantiation of block plugins.\n */\ninterface BlockManagerInterface extends ContextAwarePluginManagerInterface, CategorizingPluginManagerInterface, FilteredPluginManagerInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Block/BlockManagerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "BlockManagerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: SharedTempStoreFactory.php\nTarget symbol: class SharedTempStoreFactory\nNamespace: Drupal\\Core\\TempStore\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for SharedTempStoreFactory.\n- Include required imports:\n  - Drupal\\Component\\Utility\\Crypt\n  - Drupal\\Core\\KeyValueStore\\KeyValueExpirableFactoryInterface\n  - Drupal\\Core\\Lock\\LockBackendInterface\n  - Drupal\\Core\\Session\\AccountProxyInterface\n  - Symfony\\Component\\HttpFoundation\\RequestStack\n- Ensure these methods exist where relevant:\n  - __construct()\n  - get()", "output": "<?php\n\nnamespace Drupal\\Core\\TempStore;\n\nuse Drupal\\Component\\Utility\\Crypt;\nuse Drupal\\Core\\KeyValueStore\\KeyValueExpirableFactoryInterface;\nuse Drupal\\Core\\Lock\\LockBackendInterface;\nuse Drupal\\Core\\Session\\AccountProxyInterface;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n/**\n * Creates a shared temporary storage for a collection.\n */\nclass SharedTempStoreFactory {\n\n  /**\n   * The storage factory creating the backend to store the data.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueExpirableFactoryInterface\n   */\n  protected $storageFactory;\n\n  /**\n   * The lock object used for this data.\n   *\n   * @var \\Drupal\\Core\\Lock\\LockBackendInterface\n   */\n  protected $lockBackend;\n\n  /**\n   * The request stack.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   */\n  protected $requestStack;\n\n  /**\n   * The current user.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountProxyInterface\n   */\n  protected $currentUser;\n\n  /**\n   * The time to live for items in seconds.\n   *\n   * @var int\n   */\n  protected $expire;\n\n  /**\n   * Constructs a Drupal\\Core\\TempStore\\SharedTempStoreFactory object.\n   *\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueExpirableFactoryInterface $storage_factory\n   *   The key/value store factory.\n   * @param \\Drupal\\Core\\Lock\\LockBackendInterface $lock_backend\n   *   The lock object used for this data.\n   * @param \\Symfony\\Component\\HttpFoundation\\RequestStack $request_stack\n   *   The request stack.\n   * @param \\Drupal\\Core\\Session\\AccountProxyInterface $current_user\n   *   The current user.\n   * @param int $expire\n   *   The time to live for items, in seconds.\n   */\n  public function __construct(KeyValueExpirableFactoryInterface $storage_factory, LockBackendInterface $lock_backend, RequestStack $request_stack, AccountProxyInterface $current_user, $expire = 604800) {\n    $this->storageFactory = $storage_factory;\n    $this->lockBackend = $lock_backend;\n    $this->requestStack = $request_stack;\n    $this->currentUser = $current_user;\n    $this->expire = $expire;\n  }\n\n  /**\n   * Creates a SharedTempStore for the current user or anonymous session.\n   *\n   * @param string $collection\n   *   The collection name to use for this key/value store. This is typically\n   *   a shared namespace or module name, e.g. 'views', 'entity', etc.\n   * @param mixed $owner\n   *   (optional) The owner of this SharedTempStore. By default, the\n   *   SharedTempStore is owned by the currently authenticated user, or by the\n   *   active anonymous session if no user is logged in.\n   *\n   * @return \\Drupal\\Core\\TempStore\\SharedTempStore\n   *   An instance of the key/value store.\n   */\n  public function get($collection, $owner = NULL) {\n    // Use the currently authenticated user ID or the active user ID unless\n    // the owner is overridden.\n    if (!isset($owner)) {\n      $owner = $this->currentUser->id();\n      if ($this->currentUser->isAnonymous()) {\n        $owner = $this->requestStack->getSession()->get('core.tempstore.shared.owner', Crypt::randomBytesBase64());\n      }\n    }\n\n    // Store the data for this collection in the database.\n    $storage = $this->storageFactory->get(\"tempstore.shared.$collection\");\n    return new SharedTempStore($storage, $this->lockBackend, $owner, $this->requestStack, $this->currentUser, $this->expire);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TempStore/SharedTempStoreFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SharedTempStoreFactory", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class SoapResponse in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\soap_client\\Entity;\n\nuse Drupal\\Core\\Entity\\ContentEntityBase;\nuse Drupal\\Core\\Entity\\EntityChangedTrait;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Field\\BaseFieldDefinition;\nuse Drupal\\user\\UserInterface;\n\n/**\n * Defines the SOAP Response entity.\n *\n * @ContentEntityType(\n *   id = \"soap_response\",\n *   label = @Translation(\"SOAP Response\"),\n *   label_collection = @Translation(\"SOAP Responses\"),\n *   label_singular = @Translation(\"SOAP response\"),\n *   label_plural = @Translation(\"SOAP responses\"),\n *   label_count = @PluralTranslation(\n *     singular = \"@count SOAP response\",\n *     plural = \"@count SOAP responses\",\n *   ),\n *   bundle_label = @Translation(\"SOAP Operation\"),\n *   handlers = {\n *     \"view_builder\" = \"Drupal\\Core\\Entity\\EntityViewBuilder\",\n *     \"list_builder\" =\n *       \"Drupal\\soap_client\\Entity\\Controller\\SoapResponseListBuilder\",\n *     \"views_data\" =\n *       \"Drupal\\soap_client\\Entity\\SoapResponseViewsData\",\n *     \"form\" = {\n *       \"default\" = \"Drupal\\Core\\Entity\\ContentEntityForm\",\n *       \"edit\" = \"Drupal\\Core\\Entity\\ContentEntityForm\",\n *       \"delete\" = \"Drupal\\Core\\Entity\\ContentEntityDeleteForm\",\n *     },\n *     \"access\" = \"Drupal\\Core\\Entity\\EntityAccessControlHandler\",\n *     \"route_provider\" = {\n *       \"html\" = \"Drupal\\Core\\Entity\\Routing\\AdminHtmlRouteProvider\"\n *     },\n *   },\n *   base_table = \"soap_response\",\n *   translatable = FALSE,\n *   fieldable = TRUE,\n *   entity_keys = {\n *     \"id\" = \"id\",\n *     \"bundle\" = \"bundle\",\n *     \"label\" = \"name\",\n *     \"uuid\" = \"uuid\",\n *   },\n *   links = {\n *     \"canonical\" = \"/admin/structure/soap-client/responses/{soap_response}\",\n *     \"add-page\" = \"/admin/structure/soap-client/responses/add\",\n *     \"add-form\" =\n *       \"/admin/structure/soap-client/responses/add/{soap_operation}\",\n *     \"edit-form\" =\n *       \"/admin/structure/soap-client/responses/{soap_response}/edit\",\n *     \"delete-form\" =\n *       \"/admin/structure/soap-client/responses/{soap_response}/delete\",\n *     \"collection\" = \"/admin/structure/soap-client/responses\",\n *   },\n *   bundle_entity_type = \"soap_operation\",\n *   field_ui_base_route = \"entity.soap_operation.edit_form\",\n *   admin_permission = \"administer soap responses\",\n * )\n */\nclass SoapResponse extends ContentEntityBase implements\n  SoapResponseInterface\n{\n  use EntityChangedTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function baseFieldDefinitions(\n    EntityTypeInterface $entity_type,\n  ): array {\n    $fields = parent::baseFieldDefinitions($entity_type);\n    $fields['name'] = BaseFieldDefinition::create('string')\n      ->setLabel(t('Name'))\n      ->setDescription(t('The name of the SOAP response.'))\n      ->setRequired(TRUE)\n      ->setSetting('max_length', 255)\n      ->setDisplayOptions('view', [\n        'label' => 'hidden',\n        'type' => 'string',\n        'weight' => -4,\n      ])\n      ->setDisplayOptions('form', [\n        'type' => 'string_textfield',\n        'weight' => -4,\n      ])\n      ->setDisplayConfigurable('form', TRUE)\n      ->setDisplayConfigurable('view', TRUE);\n\n    $fields['uid'] = BaseFieldDefinition::create('entity_reference')\n      ->setLabel(t('Authored by'))\n      ->setDescription(t('The user ID of the response author.'))\n      ->setSetting('target_type', 'user')\n      ->setDisplayOptions('view', [\n        'label' => 'above',\n        'type' => 'author',\n        'weight' => 15,\n      ])\n      ->setDisplayOptions('form', [\n        'type' => 'entity_reference_autocomplete',\n        'weight' => 15,\n        'settings' => [\n          'match_operator' => 'CONTAINS',\n          'size' => '60',\n          'placeholder' => '',\n        ],\n      ])\n      ->setDisplayConfigurable('form', TRUE)\n      ->setDisplayConfigurable('view', TRUE);\n\n    $fields['created'] = BaseFieldDefinition::create('created')\n      ->setLabel(t('Created'))\n      ->setDescription(t('The time the response was created.'));\n\n    return $fields;\n  }\n\n  /**\n   * Returns the entity owner.\n   *\n   * @return \\Drupal\\user\\UserInterface|null\n   *   The owner user entity.\n   */\n  public function owner(): ?UserInterface {\n    return $this->get('uid')->entity;\n  }\n\n  /**\n   * Sets the owner user ID.\n   *\n   * @param int $uid\n   *   The user ID.\n   *\n   * @return $this\n   *   Reference to self.\n   */\n  public function setOwnerId(int $uid): static {\n    $this->set('uid', $uid);\n    return $this;\n  }\n\n  /**\n   * Returns the entity creation timestamp.\n   *\n   * @return int\n   *   The UNIX timestamp of when the entity was created.\n   */\n  public function getCreatedTime(): int {\n    return (int) $this->get('created')->value;\n  }\n\n  /**\n   * Sets the entity creation timestamp.\n   *\n   * @param int $timestamp\n   *   The UNIX timestamp of when the entity was created.\n   *\n   * @return $this\n   *   Reference to self.\n   */\n  public function setCreatedTime(int $timestamp): static {\n    $this->set('created', $timestamp);\n    return $this;\n  }\n\n}\n", "metadata": {"source": "repos/soap_client/src/Entity/SoapResponse.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SoapResponse", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface MediaTypeInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\media;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Entity\\EntityDescriptionInterface;\nuse Drupal\\Core\\Entity\\RevisionableEntityBundleInterface;\n\n/**\n * Provides an interface defining a media type entity.\n *\n * Media types are bundles for media items. They are used to group media with\n * the same semantics. Media types are not about where media comes from. They\n * are about the semantics that media has in the context of a given Drupal site.\n *\n * Media sources, on the other hand, are aware where media comes from and know\n * how to represent and handle it in Drupal's context. They are aware of the low\n * level details, while the media types don't care about them at all. That said,\n * media types can not exist without media sources.\n *\n * Consider the following examples:\n * - oEmbed media source which can represent any oEmbed resource. Media types\n *   that could be used with this source are \"Videos\", \"Charts\", \"Music\", etc.\n *   All of them are retrieved using the same protocol, but they represent very\n *   different things.\n * - Media sources that represent files could be used with media types like\n *   \"Invoices\", \"Subtitles\", \"Meeting notes\", etc. They are all files stored on\n *   some kind of storage, but their meaning and uses in a Drupal site are\n *   different.\n *\n * @see \\Drupal\\media\\MediaSourceInterface\n */\ninterface MediaTypeInterface extends ConfigEntityInterface, EntityDescriptionInterface, RevisionableEntityBundleInterface {\n\n  /**\n   * Returns whether thumbnail downloads are queued.\n   *\n   * When using remote media sources, the thumbnail generation could be a slow\n   * process. Using a queue allows for this process to be handled in the\n   * background.\n   *\n   * @return bool\n   *   TRUE if thumbnails are queued for download later, FALSE if they should be\n   *   downloaded now.\n   */\n  public function thumbnailDownloadsAreQueued();\n\n  /**\n   * Sets a flag to indicate that thumbnails should be downloaded via a queue.\n   *\n   * @param bool $queue_thumbnail_downloads\n   *   The queue downloads flag.\n   *\n   * @return $this\n   */\n  public function setQueueThumbnailDownloadsStatus($queue_thumbnail_downloads);\n\n  /**\n   * Returns the media source plugin.\n   *\n   * @return \\Drupal\\media\\MediaSourceInterface\n   *   The media source.\n   */\n  public function getSource();\n\n  /**\n   * Sets whether new revisions should be created by default.\n   *\n   * @param bool $new_revision\n   *   TRUE if media items of this type should create new revisions by default.\n   *\n   * @return $this\n   */\n  public function setNewRevision($new_revision);\n\n  /**\n   * Returns the metadata field map.\n   *\n   * Field mapping allows site builders to map media item-related metadata to\n   * entity fields. This information will be used when saving a given media item\n   * and if metadata values will be available they are going to be automatically\n   * copied to the corresponding entity fields.\n   *\n   * @return array\n   *   Field mapping array provided by media source with metadata attribute\n   *   names as keys and entity field names as values.\n   */\n  public function getFieldMap();\n\n  /**\n   * Sets the metadata field map.\n   *\n   * @param array $map\n   *   Field mapping array with metadata attribute names as keys and entity\n   *   field names as values.\n   *\n   * @return $this\n   */\n  public function setFieldMap(array $map);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/media/src/MediaTypeInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "MediaTypeInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class StringLabelProvider in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\block_description_modifier\\Provider\\LabelProvider;\n\nuse Drupal\\block_content\\BlockContentInterface;\nuse Drupal\\block_description_modifier\\Service\\InlineBlockLabelApplier;\n\n/**\n * Uses a fixed string from configuration.\n */\nfinal class StringLabelProvider implements LabelProviderInterface {\n\n  public function id(): string {\n    return 'string';\n  }\n\n  public function label(): string {\n    return 'String';\n  }\n\n  public function provide(BlockContentInterface $block, string $bundle, array $bundleConfig): string {\n    $value = (string) ($bundleConfig['string_value'] ?? '');\n    if ($value === '') {\n      return InlineBlockLabelApplier::FALLBACK_CORRUPTED_FIELD;\n    }\n    return $value;\n  }\n\n}\n", "metadata": {"source": "repos/block_description_modifier/src/Provider/LabelProvider/StringLabelProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "StringLabelProvider", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nslots:\n  items:\n    - type: component\n      component: display_builder:tree_item\n      slots:\n        label: Deciduous\n        children:\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Birch\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Maple\n              children:\n                - type: component\n                  component: display_builder:tree_item\n                  slots:\n                    label: Field maple\n                - type: component\n                  component: display_builder:tree_item\n                  slots:\n                    label: Red maple\n                - type: component\n                  component: display_builder:tree_item\n                  slots:\n                    label: Sugar maple\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Oak\n    - type: component\n      component: display_builder:tree_item\n      slots:\n        label: Coniferous\n        children:\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Cedar\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Pine\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Spruce\n    - type: component\n      component: display_builder:tree_item\n      slots:\n        label: Non-trees\n        children:\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Bamboo\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Cactus\n          - type: component\n            component: display_builder:tree_item\n            slots:\n              label: Fern\n", "metadata": {"source": "repos/display_builder/components/shoelace/tree/tree.default.story.yml", "type": "yaml_reference", "topic": "tree.default.story"}}
{"instruction": "Show me the implementation of the class EckEntityTypeListBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\eck\\Controller;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityListBuilder;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\EntityTypeManagerInterface;\nuse Drupal\\Core\\Url;\nuse Drupal\\eck\\EckEntityTypeBundleInfo;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Provides a listing of ECK entities.\n *\n * @ingroup eck\n */\nclass EckEntityTypeListBuilder extends ConfigEntityListBuilder {\n\n  /**\n   * The entity type manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityTypeManagerInterface\n   */\n  protected $entityTypeManager;\n\n\n  /**\n   * EckEntityTypeBundleInfo service.\n   *\n   * @var \\Drupal\\eck\\EckEntityTypeBundleInfo\n   */\n  protected $eckBundleInfo;\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function createInstance(ContainerInterface $container, EntityTypeInterface $entity_type) {\n    return new static(\n      $entity_type,\n      $container->get('entity_type.manager'),\n      $container->get('eck.entity_type.bundle.info')\n    );\n  }\n\n  /**\n   * Constructs a new EntityListBuilder object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager.\n   * @param \\Drupal\\eck\\EckEntityTypeBundleInfo $bundle_info\n   *   ECK Entity Bundle Info service.\n   */\n  public function __construct(EntityTypeInterface $entity_type, EntityTypeManagerInterface $entity_type_manager, EckEntityTypeBundleInfo $bundle_info) {\n    $storage = $entity_type_manager->getStorage($entity_type->id());\n    parent::__construct($entity_type, $storage);\n    $this->entityTypeManager = $entity_type_manager;\n    $this->eckBundleInfo = $bundle_info;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildHeader() {\n    $header['label'] = $this->t('Entity Type');\n    $header['description'] = $this->t('Description');\n    $header['machine_name'] = $this->t('Machine Name');\n\n    return $header + parent::buildHeader();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildRow(EntityInterface $entity) {\n    $row['label'] = $entity->label();\n    $row['description'] = $entity->getDescription();\n    $row['machine_name'] = $entity->id();\n\n    if (!$this->eckBundleInfo->entityTypeHasBundles($entity->id())) {\n      $row['operations']['data']['#links']['add_bundle'] = [\n        'title' => $this->t('Add bundle'),\n        'url' => new Url('eck.entity.' . $entity->id() . '_type.add'),\n      ];\n    }\n    else {\n      // Add link to list operation.\n      $row['operations']['data']['#links']['add_content'] = [\n        'title' => $this->t('Add content'),\n        'url' => new Url('eck.entity.add_page', ['eck_entity_type' => $entity->id()]),\n      ];\n      // Directly link to the add entity page if there is only one bundle.\n      if ($this->eckBundleInfo->entityTypeBundleCount($entity->id()) === 1) {\n        $bundle_machine_names = $this->eckBundleInfo->getEntityTypeBundleMachineNames($entity->id());\n        $arguments = [\n          'eck_entity_type' => $entity->id(),\n          'eck_entity_bundle' => reset($bundle_machine_names),\n        ];\n        $row['operations']['data']['#links']['add_content']['url'] = new Url('eck.entity.add', $arguments);\n      }\n\n      $contentExists = (bool) $this->entityTypeManager->getStorage($entity->id())\n        ->getQuery()\n        ->accessCheck(FALSE)\n        ->range(0, 1)\n        ->execute();\n      if ($contentExists) {\n        // Add link to list operation.\n        $row['operations']['data']['#links']['content_list'] = [\n          'title' => $this->t('Content list'),\n          'url' => new Url('eck.entity.' . $entity->id() . '.list'),\n        ];\n      }\n    }\n\n    $row['operations']['data']['#links']['bundle_list'] = [\n      'title' => $this->t('Bundle list'),\n      'url' => new Url('eck.entity.' . $entity->id() . '_type.list'),\n    ];\n\n    return array_merge_recursive($row, parent::buildRow($entity));\n  }\n\n}\n", "metadata": {"source": "repos/eck/src/Controller/EckEntityTypeListBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EckEntityTypeListBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class SystemApi in the file <source_file>.", "input": "", "output": "<?php\n\n/**\n * @file\n * Hooks provided by the System module.\n */\n\nuse Drupal\\Core\\Url;\n\n/**\n * @addtogroup hooks\n * @{\n */\n\n/**\n * Alters theme operation links.\n *\n * @param array $theme_groups\n *   An associative array containing groups of themes.\n *\n * @see system_themes_page()\n */\nfunction hook_system_themes_page_alter(&$theme_groups) {\n  foreach ($theme_groups as $state => &$group) {\n    foreach ($theme_groups[$state] as &$theme) {\n      // Add a foo link to each list of theme operations.\n      $theme->operations[] = [\n        'title' => t('Foo'),\n        'url' => Url::fromRoute('system.themes_page'),\n        'query' => ['theme' => $theme->getName()],\n      ];\n    }\n  }\n}\n\n/**\n * @} End of \"addtogroup hooks\".\n */\n", "metadata": {"source": "repos/drupal_core/core/modules/system/system.api.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SystemApi", "symbol_extraction_method": "path_fallback"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: DynamicSchemaEndpoint.php\nTarget symbol: class DynamicSchemaEndpoint\nNamespace: Drupal\\flowdrop\\DTO\\ConfigEdit\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for DynamicSchemaEndpoint.\n- Ensure these methods exist where relevant:\n  - __construct()\n  - fromArray()\n  - toArray()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop\\DTO\\ConfigEdit;\n\n/**\n * Value object for dynamic schema endpoint configuration.\n *\n * Represents the configuration for fetching a node's config schema\n * dynamically from a REST endpoint at runtime. This is useful when:\n * - Config options depend on external data (e.g., available models, API keys)\n * - Options change based on user authentication or permissions\n * - Schema needs to be refreshed periodically.\n *\n * @see config-edit.md for full specification\n */\nfinal class DynamicSchemaEndpoint {\n\n  /**\n   * Constructs a DynamicSchemaEndpoint.\n   *\n   * @param string $url\n   *   The URL endpoint to fetch the schema from.\n   *   Supports template variables like {nodeTypeId}, {instanceId}.\n   * @param string $method\n   *   HTTP method to use (GET, POST). Defaults to GET.\n   * @param array<string, string> $parameterMapping\n   *   Maps URL template variables to node data paths.\n   *   Example: [\"nodeTypeId\" => \"metadata.id\", \"instanceId\" => \"id\"].\n   * @param array<string, string> $headers\n   *   Additional HTTP headers to include in the request.\n   * @param bool $cacheSchema\n   *   Whether to cache the fetched schema. Default TRUE.\n   *   Set to FALSE if schema varies by dynamic parameters.\n   * @param int $timeout\n   *   Request timeout in milliseconds. Default 10000 (10 seconds).\n   */\n  public function __construct(\n    public readonly string $url,\n    public readonly string $method = \"GET\",\n    public readonly array $parameterMapping = [],\n    public readonly array $headers = [],\n    public readonly bool $cacheSchema = TRUE,\n    public readonly int $timeout = 10000,\n  ) {}\n\n  /**\n   * Creates an instance from an array.\n   *\n   * @param array<string, mixed> $data\n   *   The array data to create the instance from.\n   *\n   * @return self\n   *   The created instance.\n   */\n  public static function fromArray(array $data): self {\n    return new self(\n      url: $data[\"url\"] ?? \"\",\n      method: $data[\"method\"] ?? \"GET\",\n      parameterMapping: $data[\"parameterMapping\"] ?? [],\n      headers: $data[\"headers\"] ?? [],\n      cacheSchema: $data[\"cacheSchema\"] ?? TRUE,\n      timeout: $data[\"timeout\"] ?? 10000,\n    );\n  }\n\n  /**\n   * Converts the object to an array suitable for JSON serialization.\n   *\n   * @return array<string, mixed>\n   *   The array representation.\n   */\n  public function toArray(): array {\n    return [\n      \"url\" => $this->url,\n      \"method\" => $this->method,\n      \"parameterMapping\" => $this->parameterMapping,\n      \"headers\" => $this->headers,\n      \"cacheSchema\" => $this->cacheSchema,\n      \"timeout\" => $this->timeout,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/flowdrop/src/DTO/ConfigEdit/DynamicSchemaEndpoint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DynamicSchemaEndpoint", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: KeyRotationOptions.php\nTarget symbol: class KeyRotationOptions\nNamespace: Drupal\\easy_encryption\\KeyManagement\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for KeyRotationOptions.\n- Ensure these methods exist where relevant:\n  - __construct()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\n/**\n * Options for the rotation operation.\n */\nfinal class KeyRotationOptions {\n\n  public function __construct(\n    public readonly bool $reencryptKeys = FALSE,\n    public readonly bool $failOnReencryptErrors = TRUE,\n  ) {}\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyRotationOptions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyRotationOptions", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the interface IntegerInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\TypedData\\Type;\n\nuse Drupal\\Core\\TypedData\\PrimitiveInterface;\n\n/**\n * Interface for integer numbers.\n *\n * The plain value of an integer is a regular PHP integer. For setting the value\n * any PHP variable that casts to an integer may be passed.\n *\n * @ingroup typed_data\n */\ninterface IntegerInterface extends PrimitiveInterface {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/Type/IntegerInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "IntegerInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: FieldLabelDescriptionTranslation\nSource file: <source_file>\nFile name hint: FieldLabelDescriptionTranslation.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\field\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\DrupalSqlBase;\n\n// cspell:ignore objectid objectindex plid textgroup\n\n/**\n * Drupal 7 i18n field label and description source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d7_field_instance_label_description_translation\",\n *   source_module = \"i18n_field\"\n * )\n */\nclass FieldLabelDescriptionTranslation extends DrupalSqlBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  function query() {\n    // Get translations for field labels and descriptions.\n    $query = $this->select('i18n_string', 'i18n')\n      ->fields('i18n')\n      ->fields('lt', [\n        'lid',\n        'translation',\n        'language',\n        'plid',\n        'plural',\n        'i18n_status',\n      ])\n      ->fields('fci', [\n        'id',\n        'field_id',\n        'field_name',\n        'entity_type',\n        'bundle',\n        'data',\n        'deleted',\n      ])\n      ->condition('i18n.textgroup', 'field');\n    $condition = $query->orConditionGroup()\n      ->condition('textgroup', 'field')\n      ->condition('objectid', '#allowed_values', '!=');\n    $query->condition($condition);\n    $query->innerJoin('locales_target', 'lt', '[lt].[lid] = [i18n].[lid]');\n\n    $query->leftJoin('field_config_instance', 'fci', '[fci].[bundle] = [i18n].[objectid] AND [fci].[field_name] = [i18n].[type]');\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    return [\n      'lid' => $this->t('Locales target language ID.'),\n      'textgroup' => $this->t('A module defined group of translations'),\n      'context' => $this->t('Full string ID for quick search: type:objectid:property.'),\n      'objectid' => $this->t('Object ID'),\n      'type' => $this->t('Object type for this string'),\n      'property' => $this->t('Object property for this string'),\n      'objectindex' => $this->t('Integer value of Object ID'),\n      'format' => $this->t('The {filter_format}.format of the string'),\n      'translation' => $this->t('Translation'),\n      'language' => $this->t('Language code'),\n      'plid' => $this->t('Parent lid'),\n      'plural' => $this->t('Plural index number'),\n      'i18n_status' => $this->t('Translation needs update'),\n      'id' => $this->t('The field instance ID.'),\n      'field_id' => $this->t('The field ID.'),\n      'field_name' => $this->t('The field name.'),\n      'entity_type' => $this->t('The entity type.'),\n      'bundle' => $this->t('The entity bundle.'),\n      'data' => $this->t('The field instance data.'),\n      'deleted' => $this->t('Deleted'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['property']['type'] = 'string';\n    $ids['language']['type'] = 'string';\n    $ids['lid']['type'] = 'integer';\n    $ids['lid']['alias'] = 'lt';\n    return $ids;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\field\\Plugin\\migrate\\source\\d7;\n\nuse Drupal\\migrate_drupal\\Plugin\\migrate\\source\\DrupalSqlBase;\n\n// cspell:ignore objectid objectindex plid textgroup\n\n/**\n * Drupal 7 i18n field label and description source from database.\n *\n * For available configuration keys, refer to the parent classes.\n *\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SqlBase\n * @see \\Drupal\\migrate\\Plugin\\migrate\\source\\SourcePluginBase\n *\n * @MigrateSource(\n *   id = \"d7_field_instance_label_description_translation\",\n *   source_module = \"i18n_field\"\n * )\n */\nclass FieldLabelDescriptionTranslation extends DrupalSqlBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Get translations for field labels and descriptions.\n    $query = $this->select('i18n_string', 'i18n')\n      ->fields('i18n')\n      ->fields('lt', [\n        'lid',\n        'translation',\n        'language',\n        'plid',\n        'plural',\n        'i18n_status',\n      ])\n      ->fields('fci', [\n        'id',\n        'field_id',\n        'field_name',\n        'entity_type',\n        'bundle',\n        'data',\n        'deleted',\n      ])\n      ->condition('i18n.textgroup', 'field');\n    $condition = $query->orConditionGroup()\n      ->condition('textgroup', 'field')\n      ->condition('objectid', '#allowed_values', '!=');\n    $query->condition($condition);\n    $query->innerJoin('locales_target', 'lt', '[lt].[lid] = [i18n].[lid]');\n\n    $query->leftJoin('field_config_instance', 'fci', '[fci].[bundle] = [i18n].[objectid] AND [fci].[field_name] = [i18n].[type]');\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function fields() {\n    return [\n      'lid' => $this->t('Locales target language ID.'),\n      'textgroup' => $this->t('A module defined group of translations'),\n      'context' => $this->t('Full string ID for quick search: type:objectid:property.'),\n      'objectid' => $this->t('Object ID'),\n      'type' => $this->t('Object type for this string'),\n      'property' => $this->t('Object property for this string'),\n      'objectindex' => $this->t('Integer value of Object ID'),\n      'format' => $this->t('The {filter_format}.format of the string'),\n      'translation' => $this->t('Translation'),\n      'language' => $this->t('Language code'),\n      'plid' => $this->t('Parent lid'),\n      'plural' => $this->t('Plural index number'),\n      'i18n_status' => $this->t('Translation needs update'),\n      'id' => $this->t('The field instance ID.'),\n      'field_id' => $this->t('The field ID.'),\n      'field_name' => $this->t('The field name.'),\n      'entity_type' => $this->t('The entity type.'),\n      'bundle' => $this->t('The entity bundle.'),\n      'data' => $this->t('The field instance data.'),\n      'deleted' => $this->t('Deleted'),\n    ];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getIds() {\n    $ids['property']['type'] = 'string';\n    $ids['language']['type'] = 'string';\n    $ids['lid']['type'] = 'integer';\n    $ids['lid']['alias'] = 'lt';\n    return $ids;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/field/src/Plugin/migrate/source/d7/FieldLabelDescriptionTranslation.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FieldLabelDescriptionTranslation", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  multilingual_tokens.token_provider:\n    class: Drupal\\multilingual_tokens\\Token\\MultilingualTokenProvider\n    arguments:\n     - '@language_manager'\n     - '@entity.repository'\n     - '@token'\n     - '@entity_type.manager'\n     - '@content_translation.manager'\n     - '@event_dispatcher'\n", "metadata": {"source": "repos/multilingual_tokens/multilingual_tokens.services.yml", "type": "yaml_reference", "topic": "multilingual tokens.services"}}
{"instruction": "Fix this broken Drupal 11 class implementation and return corrected PHP code.", "input": "Symbol: EckEntityLabel\nSource file: <source_file>\nFile name hint: EckEntityLabel.php\nBroken snippet:\n<?php\n\nnamespace Drupal\\eck\\Plugin\\views\\field;\n\nuse Drupal\\Core\\Entity\\EntityMalformedException;\nuse Drupal\\Core\\Entity\\Exception\\UndefinedLinkTemplateException;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Plugin\\views\\field\\FieldPluginBase;\nuse Drupal\\views\\ResultRow;\n\n/**\n * Field handler to return the ECK entity's label.\n *\n * @ingroup views_field_handlers\n *\n * @ViewsField(\"eck_entity_label\")\n */\nclass EckEntityLabel extends FieldPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['link_to_entity'] = ['default' => FALSE];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    $form['link_to_entity'] = [\n      '#title' => $this->t('Link to entity'),\n      '#description' => $this->t('Make entity label a link to entity page.'),\n      '#type' => 'checkbox',\n      '#default_value' => !empty($this->options['link_to_entity']),\n    ];\n    parent::buildOptionsForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(ResultRow $values) {\n    /** @var \\Drupal\\Core\\Entity\\EntityInterface $entity */\n    $entity = $values->_entity;\n\n    if (!empty($this->options['link_to_entity'])) {\n      try {\n        $this->options['alter']['url'] = $entity->toUrl();\n        $this->options['alter']['make_link'] = TRUE;\n      }\n      catch (UndefinedLinkTemplateException $e) {\n        $this->options['alter']['make_link'] = FALSE;\n      }\n      catch (EntityMalformedException $e) {\n        $this->options['alter']['make_link'] = FALSE;\n      }\n    }\n\n    return $entity->label();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Leave empty to avoid a query on this field.\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\eck\\Plugin\\views\\field;\n\nuse Drupal\\Core\\Entity\\EntityMalformedException;\nuse Drupal\\Core\\Entity\\Exception\\UndefinedLinkTemplateException;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\views\\Plugin\\views\\field\\FieldPluginBase;\nuse Drupal\\views\\ResultRow;\n\n/**\n * Field handler to return the ECK entity's label.\n *\n * @ingroup views_field_handlers\n *\n * @ViewsField(\"eck_entity_label\")\n */\nclass EckEntityLabel extends FieldPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function defineOptions() {\n    $options = parent::defineOptions();\n    $options['link_to_entity'] = ['default' => FALSE];\n    return $options;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildOptionsForm(&$form, FormStateInterface $form_state) {\n    $form['link_to_entity'] = [\n      '#title' => $this->t('Link to entity'),\n      '#description' => $this->t('Make entity label a link to entity page.'),\n      '#type' => 'checkbox',\n      '#default_value' => !empty($this->options['link_to_entity']),\n    ];\n    parent::buildOptionsForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function render(ResultRow $values) {\n    /** @var \\Drupal\\Core\\Entity\\EntityInterface $entity */\n    $entity = $values->_entity;\n\n    if (!empty($this->options['link_to_entity'])) {\n      try {\n        $this->options['alter']['url'] = $entity->toUrl();\n        $this->options['alter']['make_link'] = TRUE;\n      }\n      catch (UndefinedLinkTemplateException $e) {\n        $this->options['alter']['make_link'] = FALSE;\n      }\n      catch (EntityMalformedException $e) {\n        $this->options['alter']['make_link'] = FALSE;\n      }\n    }\n\n    return $entity->label();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function query() {\n    // Leave empty to avoid a query on this field.\n  }\n\n}\n", "metadata": {"source": "repos/eck/src/Plugin/views/field/EckEntityLabel.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "EckEntityLabel", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "bugfix"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "eca_ng.template.apply:\n  path: '/system/eca/template/apply'\n  defaults:\n    _controller: 'Drupal\\eca_ng\\Controller\\Template:apply'\n  requirements:\n    _permission: 'modeler api edit eca'\n    _csrf_request_header_token: true\n  options:\n    _admin_route: true\n    _method: 'POST'\n", "metadata": {"source": "repos/eca_ng/eca_ng.routing.yml", "type": "yaml_reference", "topic": "eca ng.routing"}}
{"instruction": "Show me the implementation of the class Log in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\process;\n\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\ProcessPluginBase;\nuse Drupal\\migrate\\Row;\n\n/**\n * Logs values without changing them.\n *\n * The log plugin will log the values that are being processed by other plugins.\n *\n * Example:\n * @code\n * process:\n *   bar:\n *     plugin: log\n *     source: foo\n * @endcode\n *\n * @see \\Drupal\\migrate\\Plugin\\MigrateProcessInterface\n */\n#[MigrateProcess('log')]\nclass Log extends ProcessPluginBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    $is_object = is_object($value);\n    if (is_null($value) || is_bool($value)) {\n      $export = var_export($value, TRUE);\n    }\n    elseif (is_float($value)) {\n      $export = sprintf('%f', $value);\n    }\n    elseif ($is_object && method_exists($value, 'toString')) {\n      $export = print_r($value->toString(), TRUE);\n    }\n    elseif ($is_object && method_exists($value, 'toArray')) {\n      $export = print_r($value->toArray(), TRUE);\n    }\n    elseif (is_string($value) || is_numeric($value) || is_array($value)) {\n      $export = print_r($value, TRUE);\n    }\n    elseif ($is_object && method_exists($value, '__toString')) {\n      $export = print_r((string) $value, TRUE);\n    }\n    else {\n      $export = NULL;\n    }\n\n    $class_name = $export !== NULL && $is_object\n      ? $class_name = get_class($value) . \":\\n\"\n      : '';\n\n    $message = $export === NULL\n      ? \"Unable to log the value for '$destination_property'\"\n      : \"'$destination_property' value is $class_name'$export'\";\n\n    // Log the value.\n    $migrate_executable->saveMessage($message);\n    // Pass through the same value we received.\n    return $value;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/process/Log.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Log", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: FileLinkFormatterFactory.php\nTarget symbol: class to\nNamespace: Drupal\\webprofiler\\Debug\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for to.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n- Ensure these methods exist where relevant:\n  - getFileLinkFormatter()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\webprofiler\\Debug;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\n\n/**\n * Factory class to create FileLinkFormatter service instances.\n */\nclass FileLinkFormatterFactory {\n\n  /**\n   * Return a FileLinkFormatter configured with WebProfiler settings.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $configFactory\n   *   The config factory service.\n   *\n   * @return \\Drupal\\webprofiler\\Debug\\FileLinkFormatter\n   *   A FileLinkFormatter configured with WebProfiler settings.\n   */\n  final public static function getFileLinkFormatter(\n    ConfigFactoryInterface $configFactory,\n  ): FileLinkFormatter {\n    $settings = $configFactory->get('webprofiler.settings');\n    $ide = $settings->get('ide') ?? '';\n    $ide_remote_path = $settings->get('ide_remote_path') ?? '';\n    $ide_local_path = $settings->get('ide_local_path') ?? '';\n\n    return new FileLinkFormatter($ide, $ide_remote_path, $ide_local_path);\n  }\n\n}\n", "metadata": {"source": "repos/webprofiler/src/Debug/FileLinkFormatterFactory.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FileLinkFormatterFactory", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: AccessResultAllowed.php\nTarget symbol: class AccessResultAllowed\nNamespace: Drupal\\Core\\Access\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for AccessResultAllowed.\n- Ensure these methods exist where relevant:\n  - isAllowed()", "output": "<?php\n\nnamespace Drupal\\Core\\Access;\n\n/**\n * Value object indicating an allowed access result, with cacheability metadata.\n */\nclass AccessResultAllowed extends AccessResult {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isAllowed() {\n    return TRUE;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Access/AccessResultAllowed.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AccessResultAllowed", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class AdminController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Controller;\n\nuse Drupal\\Core\\Controller\\ControllerBase;\nuse Drupal\\Core\\Extension\\ModuleExtensionList;\nuse Drupal\\system\\ModuleAdminLinksHelper;\nuse Drupal\\user\\ModulePermissionsLinkHelper;\n\n/**\n * Controller for admin section.\n */\nclass AdminController extends ControllerBase {\n\n  /**\n   * AdminController constructor.\n   */\n  public function __construct(\n    protected ModuleExtensionList $moduleExtensionList,\n    protected ModuleAdminLinksHelper $moduleAdminLinks,\n    protected ModulePermissionsLinkHelper $modulePermissionsLinks,\n  ) {\n  }\n\n  /**\n   * Prints a listing of admin tasks, organized by module.\n   *\n   * @return array\n   *   A render array containing the listing.\n   */\n  public function index() {\n    $extensions = array_intersect_key($this->moduleExtensionList->getList(), $this->moduleHandler()->getModuleList());\n\n    uasort($extensions, [ModuleExtensionList::class, 'sortByName']);\n    $menu_items = [];\n\n    foreach ($extensions as $module => $extension) {\n      // Only display a section if there are any available tasks.\n      $admin_tasks = $this->moduleAdminLinks->getModuleAdminLinks($module);\n      if ($module_permissions_link = $this->modulePermissionsLinks->getModulePermissionsLink($module, $extension->info['name'])) {\n        $admin_tasks[\"user.admin_permissions.{$module}\"] = $module_permissions_link;\n      }\n      if (!empty($admin_tasks)) {\n        // Sort links by title.\n        uasort($admin_tasks, ['\\Drupal\\Component\\Utility\\SortArray', 'sortByTitleElement']);\n        // Move 'Configure permissions' links to the bottom of each section.\n        $permission_key = \"user.admin_permissions.$module\";\n        if (isset($admin_tasks[$permission_key])) {\n          $permission_task = $admin_tasks[$permission_key];\n          unset($admin_tasks[$permission_key]);\n          $admin_tasks[$permission_key] = $permission_task;\n        }\n\n        $menu_items[$extension->info['name']] = [$extension->info['description'], $admin_tasks];\n      }\n    }\n\n    $output = [\n      '#theme' => 'system_admin_index',\n      '#menu_items' => $menu_items,\n    ];\n\n    return $output;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Controller/AdminController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AdminController", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "excluded_field_types:\n  - 'boolean'\n  - 'created'\n  - 'changed'\n  - 'entity_reference'\n  - 'image'\n  - 'file'\n  - 'timestamp'\n  - 'uuid'\n  - 'user'\n", "metadata": {"source": "repos/tmgmt_laratranslate/config/install/tmgmt_laratranslate.settings.yml", "type": "yaml_reference", "topic": "tmgmt laratranslate.settings"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: with\nSource file: <source_file>\nFile name hint: ApiKeyAccessControlHandler.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\llm\\Access\\ConfigurableEntityAccessControlHandler;\n\n/**\n * Access controller for the API Key entity.\n *\n * Uses DRY base class with owner-based access control.\n * Users can view, edit, and delete their own API keys.\n * Administrators can manage all API keys.\n */\n/**\n * Access control handler for apikey.\n *\n * @ingroup api_normalization\n */\nclass ApiKeyAccessControlHandler extends ConfigurableEntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected string $entityLabel = 'api normalizer keys';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected string $adminPermission = 'administer api normalizer keys';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account): AccessResultInterface {\n    /** @var \\Drupal\\api_normalization\\Entity\\ApiKey $entity */\n\n    // Admin permission grants full access.\n    $admin_result = $this->checkAdminAccess($account);\n    if ($admin_result->isAllowed()) {\n      return $admin_result;\n    }\n\n    // Users can manage their own API keys for all operations.\n    if ($entity->get('uid')->target_id == $account->id()) {\n      return AccessResult::allowed()\n        ->cachePerUser()\n        ->addCacheableDependency($entity);\n    }\n\n    return AccessResult::neutral()\n      ->cachePerUser()\n      ->addCacheableDependency($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkCreateAccess(AccountInterface $account, array $context, $entity_bundle = NULL): AccessResultInterface {\n    return AccessResult::allowedIfHasPermission($account, 'create api normalizer keys')\n      ->orIf($this->checkAdminAccess($account));\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Access;\n\nuse Drupal\\Core\\Access\\AccessResult;\nuse Drupal\\Core\\Access\\AccessResultInterface;\nuse Drupal\\Core\\Entity\\EntityInterface;\nuse Drupal\\Core\\Session\\AccountInterface;\nuse Drupal\\llm\\Access\\ConfigurableEntityAccessControlHandler;\n\n/**\n * Access controller for the API Key entity.\n *\n * Uses DRY base class with owner-based access control.\n * Users can view, edit, and delete their own API keys.\n * Administrators can manage all API keys.\n */\n/**\n * Access control handler for apikey.\n *\n * @ingroup api_normalization\n */\nclass ApiKeyAccessControlHandler extends ConfigurableEntityAccessControlHandler {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected string $entityLabel = 'api normalizer keys';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected string $adminPermission = 'administer api normalizer keys';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkAccess(EntityInterface $entity, $operation, AccountInterface $account): AccessResultInterface {\n    /** @var \\Drupal\\api_normalization\\Entity\\ApiKey $entity */\n\n    // Admin permission grants full access.\n    $admin_result = $this->checkAdminAccess($account);\n    if ($admin_result->isAllowed()) {\n      return $admin_result;\n    }\n\n    // Users can manage their own API keys for all operations.\n    if ($entity->get('uid')->target_id == $account->id()) {\n      return AccessResult::allowed()\n        ->cachePerUser()\n        ->addCacheableDependency($entity);\n    }\n\n    return AccessResult::neutral()\n      ->cachePerUser()\n      ->addCacheableDependency($entity);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function checkCreateAccess(AccountInterface $account, array $context, $entity_bundle = NULL): AccessResultInterface {\n    return AccessResult::allowedIfHasPermission($account, 'create api normalizer keys')\n      ->orIf($this->checkAdminAccess($account));\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Access/ApiKeyAccessControlHandler.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiKeyAccessControlHandler", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class DateFormat in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Datetime\\Entity;\n\nuse Drupal\\Core\\Entity\\Attribute\\ConfigEntityType;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityBase;\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityInterface;\nuse Drupal\\Core\\Datetime\\DateFormatInterface;\nuse Drupal\\system\\DateFormatAccessControlHandler;\n\n/**\n * Defines the Date Format configuration entity class.\n */\n#[ConfigEntityType(\n  id: 'date_format',\n  label: new TranslatableMarkup('Date format'),\n  entity_keys: [\n    'id' => 'id',\n    'label' => 'label',\n  ],\n  handlers: ['access' => DateFormatAccessControlHandler::class],\n  admin_permission: 'administer site configuration',\n  list_cache_tags: ['rendered'],\n  config_export: [\n    'id',\n    'label',\n    'locked',\n    'pattern',\n  ],\n  )]\nclass DateFormat extends ConfigEntityBase implements DateFormatInterface {\n\n  /**\n   * The date format machine name.\n   *\n   * @var string\n   */\n  protected $id;\n\n  /**\n   * The human-readable name of the date format entity.\n   *\n   * @var string\n   */\n  protected $label;\n\n  /**\n   * The date format pattern.\n   *\n   * @var string\n   */\n  protected $pattern;\n\n  /**\n   * The locked status of this date format.\n   *\n   * @var bool\n   */\n  protected $locked = FALSE;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPattern() {\n    return $this->pattern;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setPattern($pattern) {\n    $this->pattern = $pattern;\n    return $this;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isLocked() {\n    return (bool) $this->locked;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function sort(ConfigEntityInterface $a, ConfigEntityInterface $b) {\n    if ($a->isLocked() == $b->isLocked()) {\n      $a_label = $a->label();\n      $b_label = $b->label();\n      return strnatcasecmp($a_label, $b_label);\n    }\n    return $a->isLocked() ? 1 : -1;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getCacheTagsToInvalidate() {\n    return ['rendered'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Datetime/Entity/DateFormat.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateFormat", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class AnalyticsProcessing in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\api_normalization\\Service\\MetricsCollector;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Processes analytics data from queue.\n *\n * @QueueWorker(\n *   id = \"api_normalization_analytics_processing\",\n *   title = @Translation(\"Analytics Processing\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass AnalyticsProcessing extends QueueWorkerBase {\n\n  /**\n   * The metrics collector.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\MetricsCollector\n   */\n  protected MetricsCollector $metrics;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs an AnalyticsProcessing queue worker.\n   *\n   * @param array $configuration\n   *   Configuration.\n   * @param string $plugin_id\n   *   Plugin ID.\n   * @param mixed $plugin_definition\n   *   Plugin definition.\n   * @param \\Drupal\\api_normalization\\Service\\MetricsCollector $metrics\n   *   The metrics collector.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    MetricsCollector $metrics,\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->metrics = $metrics;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    if (!isset($data['event_type']) || !isset($data['timestamp'])) {\n      $this->logger->error('Invalid analytics queue item data');\n      return;\n    }\n\n    try {\n      // Log analytics event to watchdog for metrics collection.\n      \\Drupal::logger('api_normalization')->info('Analytics event: @type', [\n        '@type' => $data['event_type'],\n      ], [\n        'context' => [\n          'endpoint' => $data['endpoint'] ?? '',\n          'response_time' => $data['response_time'] ?? 0,\n          'status_code' => $data['status_code'] ?? 200,\n        ],\n      ]);\n\n      $this->logger->debug('Processed analytics event: @type', [\n        '@type' => $data['event_type'],\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process analytics event: @error', [\n        '@error' => $e->getMessage(),\n      ]);\n      throw $e;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/QueueWorker/AnalyticsProcessing.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AnalyticsProcessing", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: PintoEntityServiceProvider\nSource file: <source_file>\nFile name hint: PintoEntityServiceProvider.php\nCurrent implementation:\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderInterface;\nuse Drupal\\pinto_entity\\DependencyInjection\\PintoEntityCompilerPass;\n\nfinal class PintoEntityServiceProvider implements ServiceProviderInterface {\n\n  public function register(ContainerBuilder $container): void {\n    $container->addCompilerPass(new PintoEntityCompilerPass());\n  }\n\n}", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\pinto_entity;\n\nuse Drupal\\Core\\DependencyInjection\\ContainerBuilder;\nuse Drupal\\Core\\DependencyInjection\\ServiceProviderInterface;\nuse Drupal\\pinto_entity\\DependencyInjection\\PintoEntityCompilerPass;\n\nfinal class PintoEntityServiceProvider implements ServiceProviderInterface {\n\n  public function register(ContainerBuilder $container): void {\n    $container->addCompilerPass(new PintoEntityCompilerPass());\n  }\n\n}\n", "metadata": {"source": "repos/pinto_entity/src/PintoEntityServiceProvider.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PintoEntityServiceProvider", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# cspell:ignore languageswitcher\nlangcode: en\nstatus: true\ndependencies:\n  module:\n    - language\n  theme:\n    - umami\nid: umami_languageswitcher\ntheme: umami\nregion: pre_header\nweight: 0\nprovider: null\nplugin: 'language_block:language_interface'\nsettings:\n  id: 'language_block:language_interface'\n  label: 'Language switcher'\n  label_display: '0'\n  provider: language\nvisibility: {  }\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/config/install/block.block.umami_languageswitcher.yml", "type": "yaml_reference", "topic": "block.block.umami languageswitcher"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "id: bundles\nenabled: true\nlabel: Bundles\ndescription: 'Pre-built workflow components and reusable node packages that combine multiple nodes into a single, easy-to-use building block.'\nicon: 'mdi:package-variant'\ncolor: '#64748b'\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_node_category/config/install/flowdrop_node_category.flowdrop_node_category.bundles.yml", "type": "yaml_reference", "topic": "flowdrop node category.flowdrop node category.bundles"}}
{"instruction": "Show me the implementation of the class DynamicEntityReferenceFieldBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\ai_context\\Plugin\\diff\\Field;\n\nuse Drupal\\Core\\Field\\FieldItemListInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\diff\\FieldDiffBuilderBase;\n\n/**\n * Plugin to diff dynamic entity reference fields.\n *\n * @FieldDiffBuilder(\n *   id = \"dynamic_entity_reference_field_diff_builder\",\n *   label = @Translation(\"Dynamic Entity Reference Field Diff\"),\n *   field_types = {\n *     \"dynamic_entity_reference\"\n *   },\n * )\n */\nclass DynamicEntityReferenceFieldBuilder extends FieldDiffBuilderBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function build(FieldItemListInterface $field_items) {\n    $result = [];\n\n    foreach ($field_items as $field_key => $field_item) {\n      if (!$field_item->isEmpty()) {\n        $values = $field_item->getValue();\n        $entity = $field_item->entity;\n\n        if ($entity) {\n          if ($this->configuration['compare_entity_reference'] == 'label') {\n            $result[$field_key][] = $entity->getEntityTypeId() . ': ' . $entity->label();\n          }\n          else {\n            $result[$field_key][] = $this->t('@type ID: @id', [\n              '@type' => $values['target_type'],\n              '@id' => $values['target_id'],\n            ]);\n          }\n        }\n      }\n    }\n\n    return $result;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildConfigurationForm(array $form, FormStateInterface $form_state) {\n    $form['compare_entity_reference'] = [\n      '#type' => 'select',\n      '#title' => $this->t('Compare'),\n      '#options' => [\n        'id' => $this->t('Entity type and ID'),\n        'label' => $this->t('Entity type and label'),\n      ],\n      '#default_value' => $this->configuration['compare_entity_reference'],\n    ];\n\n    return parent::buildConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitConfigurationForm(array &$form, FormStateInterface $form_state) {\n    $this->configuration['compare_entity_reference'] = $form_state->getValue('compare_entity_reference');\n    parent::submitConfigurationForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function defaultConfiguration() {\n    return [\n      'compare_entity_reference' => 'label',\n    ] + parent::defaultConfiguration();\n  }\n\n}\n", "metadata": {"source": "repos/ai_context/src/Plugin/diff/Field/DynamicEntityReferenceFieldBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DynamicEntityReferenceFieldBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PerComponentEntityDisplay in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\migrate\\Plugin\\migrate\\destination;\n\nuse Drupal\\migrate\\Attribute\\MigrateDestination;\n\n/**\n * This class imports one component of an entity display.\n *\n * Destination properties expected in the imported row:\n * - entity_type: The entity type ID.\n * - bundle: The entity bundle.\n * - view_mode: The machine name of the view mode.\n * - field_name: The machine name of the field to be imported into the display.\n * - options: (optional) An array of options for displaying the field in this\n *   view mode.\n *\n * Examples:\n *\n * @code\n * source:\n *   constants:\n *     entity_type: user\n *     bundle: user\n *     view_mode: default\n *     field_name: user_picture\n *     type: image\n *     options:\n *       label: hidden\n *       settings:\n *         image_style: ''\n *         image_link: content\n * process:\n *   entity_type: 'constants/entity_type'\n *   bundle: 'constants/bundle'\n *   view_mode: 'constants/view_mode'\n *   field_name: 'constants/field_name'\n *   type: 'constants/type'\n *   options: 'constants/options'\n *   'options/type': '@type'\n * destination:\n *   plugin: component_entity_display\n * @endcode\n *\n * This will add the \"user_picture\" image field to the \"default\" view mode of\n * the \"user\" bundle of the \"user\" entity type with options as defined by the\n * \"options\" constant, for example the label will be hidden.\n */\n#[MigrateDestination('component_entity_display')]\nclass PerComponentEntityDisplay extends ComponentEntityDisplayBase {\n\n  const MODE_NAME = 'view_mode';\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEntity($entity_type, $bundle, $view_mode) {\n    return $this->entityDisplayRepository->getViewDisplay($entity_type, $bundle, $view_mode);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/migrate/src/Plugin/migrate/destination/PerComponentEntityDisplay.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PerComponentEntityDisplay", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: OptionsProviderInterface.php\nTarget symbol: interface is\nNamespace: Drupal\\Core\\TypedData\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for is.\n- Include required imports:\n  - Drupal\\Core\\Session\\AccountInterface\n- Ensure these methods exist where relevant:\n  - getPossibleOptions()\n  - getPossibleValues()\n  - getSettableOptions()\n  - getSettableValues()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\Core\\TypedData;\n\nuse Drupal\\Core\\Session\\AccountInterface;\n\n/**\n * Interface for retrieving all possible and settable values.\n *\n * While possible values specify which values existing data might have, settable\n * values define the values that are allowed to be set by a user.\n *\n * For example, in a workflow scenario, the settable values for a state field\n * might depend on the currently set state, while possible values are all\n * states. Thus settable values would be used in an editing context, while\n * possible values would be used for presenting filtering options in a search.\n *\n * For convenience, lists of both settable and possible values are also provided\n * as structured options arrays that can be used in an Options widget such as a\n * select box or checkboxes.\n *\n * Note that this interface is mostly applicable for primitive data values, but\n * can be used on complex data structures if a (primitive) main property is\n * specified. In that case, the allowed values and options apply to the main\n * property only.\n *\n * @see \\Drupal\\Core\\Field\\Plugin\\Field\\FieldWidget\\OptionsWidgetBase\n */\ninterface OptionsProviderInterface {\n\n  /**\n   * Returns an array of possible values.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values viewable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the possible values. If\n   *   omitted, all possible values are returned.\n   *\n   * @return array\n   *   An array of possible values.\n   */\n  public function getPossibleValues(?AccountInterface $account = NULL);\n\n  /**\n   * Returns an array of possible values with labels for display.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values viewable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the possible options.\n   *   If omitted, all possible options are returned.\n   *\n   * @return array\n   *   An array of possible options for the object that may be used in an\n   *   Options widget, for example when existing data should be filtered. It may\n   *   either be a flat array of option labels keyed by values, or a\n   *   two-dimensional array of option groups (array of flat option arrays,\n   *   keyed by option group label). Note that labels should NOT be sanitized.\n   */\n  public function getPossibleOptions(?AccountInterface $account = NULL);\n\n  /**\n   * Returns an array of settable values.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values settable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the settable values. If\n   *   omitted, all settable values are returned.\n   *\n   * @return array\n   *   An array of settable values.\n   */\n  public function getSettableValues(?AccountInterface $account = NULL);\n\n  /**\n   * Returns an array of settable values with labels for display.\n   *\n   * If the optional $account parameter is passed, then the array is filtered to\n   * values settable by the account.\n   *\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   (optional) The user account for which to filter the settable options. If\n   *   omitted, all settable options are returned.\n   *\n   * @return array\n   *   An array of settable options for the object that may be used in an\n   *   Options widget, usually when new data should be entered. It may either be\n   *   a flat array of option labels keyed by values, or a two-dimensional array\n   *   of option groups (array of flat option arrays, keyed by option group\n   *   label). Note that labels should NOT be sanitized.\n   */\n  public function getSettableOptions(?AccountInterface $account = NULL);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/TypedData/OptionsProviderInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "OptionsProviderInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class ResourceTypeField in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\jsonapi\\ResourceType;\n\n/**\n * Abstract value object containing all metadata for a JSON:API resource field.\n *\n * @internal JSON:API maintains no PHP API since its API is the HTTP API. This\n *   class may change at any time and this will break any dependencies on it.\n *\n * @see https://www.drupal.org/project/drupal/issues/3032787\n * @see jsonapi.api.php\n *\n * @see \\Drupal\\jsonapi\\ResourceType\\ResourceTypeRepository\n */\nabstract class ResourceTypeField {\n\n  /**\n   * The internal field name.\n   *\n   * @var string\n   */\n  protected $internalName;\n\n  /**\n   * The public field name.\n   *\n   * @var string\n   */\n  protected $publicName;\n\n  /**\n   * Whether the field is disabled.\n   *\n   * @var bool\n   */\n  protected $enabled;\n\n  /**\n   * Whether the field can only have one value.\n   *\n   * @var bool\n   */\n  protected $hasOne;\n\n  /**\n   * ResourceTypeField constructor.\n   *\n   * @param string $internal_name\n   *   The internal field name.\n   * @param string $public_name\n   *   (optional) The public field name. Defaults to the internal field name.\n   * @param bool $enabled\n   *   (optional) Whether the field is enabled. Defaults to TRUE.\n   * @param bool $has_one\n   *   (optional) Whether the field can only have ony value. Defaults to TRUE.\n   */\n  public function __construct($internal_name, $public_name = NULL, $enabled = TRUE, $has_one = TRUE) {\n    $this->internalName = $internal_name;\n    $this->publicName = $public_name ?: $internal_name;\n    $this->enabled = $enabled;\n    $this->hasOne = $has_one;\n  }\n\n  /**\n   * Gets the internal name of the field.\n   *\n   * @return string\n   *   The internal name of the field.\n   */\n  public function getInternalName() {\n    return $this->internalName;\n  }\n\n  /**\n   * Gets the public name of the field.\n   *\n   * @return string\n   *   The public name of the field.\n   */\n  public function getPublicName() {\n    return $this->publicName;\n  }\n\n  /**\n   * Establishes a new public name for the field.\n   *\n   * @param string $public_name\n   *   The public name.\n   *\n   * @return static\n   *   A new instance of the field with the given public name.\n   */\n  public function withPublicName($public_name) {\n    return new static($this->internalName, $public_name, $this->enabled, $this->hasOne);\n  }\n\n  /**\n   * Gets a new instance of the field that is disabled.\n   *\n   * @return static\n   *   A new instance of the field that is disabled.\n   */\n  public function disabled() {\n    return new static($this->internalName, $this->publicName, FALSE, $this->hasOne);\n  }\n\n  /**\n   * Gets a new instance of the field that is enabled.\n   *\n   * @return static\n   *   A new instance of the field that is enabled.\n   */\n  public function enabled(): static {\n    return new static($this->internalName, $this->publicName, TRUE, $this->hasOne);\n  }\n\n  /**\n   * Whether the field is enabled.\n   *\n   * @return bool\n   *   Whether the field is enabled. FALSE if the field should not be in the\n   *   JSON:API response.\n   */\n  public function isFieldEnabled() {\n    return $this->enabled;\n  }\n\n  /**\n   * Whether the field can only have one value.\n   *\n   * @return bool\n   *   TRUE if the field can have only one value, FALSE otherwise.\n   */\n  public function hasOne() {\n    return $this->hasOne;\n  }\n\n  /**\n   * Whether the field can have many values.\n   *\n   * @return bool\n   *   TRUE if the field can have more than one value, FALSE otherwise.\n   */\n  public function hasMany() {\n    return !$this->hasOne;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/jsonapi/src/ResourceType/ResourceTypeField.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ResourceTypeField", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "services:\n  mcp_tools_menus.menu:\n    class: Drupal\\mcp_tools_menus\\Service\\MenuService\n    arguments:\n      - '@entity_type.manager'\n      - '@plugin.manager.menu.link'\n      - '@mcp_tools.access_manager'\n      - '@mcp_tools.audit_logger'\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_menus/mcp_tools_menus.services.yml", "type": "yaml_reference", "topic": "mcp tools menus.services"}}
{"instruction": "Show me the implementation of the class UpdateMenuLink in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\mcp_tools_menus\\Plugin\\tool\\Tool;\n\nuse Drupal\\mcp_tools_menus\\Service\\MenuService;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Plugin\\Context\\ContextDefinition;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\mcp_tools\\Tool\\McpToolsToolBase;\nuse Drupal\\tool\\Attribute\\Tool;\nuse Drupal\\tool\\Tool\\ToolOperation;\nuse Drupal\\tool\\TypedData\\InputDefinition;\n\n/**\n * Tool plugin implementation.\n */\n#[Tool(\n  id: 'mcp_menus_update_menu_link',\n  label: new TranslatableMarkup('Update Menu Link'),\n  description: new TranslatableMarkup('Update an existing menu link\\'s title, URL, weight, or other properties.'),\n  operation: ToolOperation::Write,\n  input_definitions: [\n    'link_id' => new InputDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Link ID'),\n      description: new TranslatableMarkup('Menu link content entity ID'),\n      required: TRUE,\n    ),\n    'updates' => new InputDefinition(\n      data_type: 'map',\n      label: new TranslatableMarkup('Updates'),\n      description: new TranslatableMarkup('Fields to update: title, uri, weight, expanded, description'),\n      required: TRUE,\n    ),\n  ],\n  output_definitions: [\n    'id' => new ContextDefinition(\n      data_type: 'integer',\n      label: new TranslatableMarkup('Link ID'),\n      description: new TranslatableMarkup(''),\n    ),\n    'title' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Title'),\n      description: new TranslatableMarkup(''),\n    ),\n    'message' => new ContextDefinition(\n      data_type: 'string',\n      label: new TranslatableMarkup('Result Message'),\n      description: new TranslatableMarkup(''),\n    ),\n  ],\n)]\nclass UpdateMenuLink extends McpToolsToolBase {\n\n  protected const MCP_CATEGORY = 'menus';\n\n\n  protected MenuService $menuService;\n\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $instance = parent::create($container, $configuration, $plugin_id, $plugin_definition);\n    $instance->menuService = $container->get('mcp_tools_menus.menu');\n    return $instance;\n  }\n\n  protected function executeLegacy(array $input): array {\n    $linkId = $input['link_id'] ?? 0;\n\n    if (empty($linkId)) {\n      return ['success' => FALSE, 'error' => 'Link ID is required.'];\n    }\n\n    $updates = $input['updates'] ?? [];\n\n    if (empty($updates)) {\n      return ['success' => FALSE, 'error' => 'At least one field to update is required.'];\n    }\n\n    return $this->menuService->updateMenuLink((int) $linkId, $updates);\n  }\n\n\n}\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_menus/src/Plugin/tool/Tool/UpdateMenuLink.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UpdateMenuLink", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class RequestProcessing in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\api_normalization\\Plugin\\QueueWorker;\n\nuse Drupal\\api_normalization\\Service\\NormalizationOrchestrator;\nuse Drupal\\Core\\Queue\\QueueWorkerBase;\nuse Psr\\Log\\LoggerInterface;\n\n/**\n * Processes API normalization requests from queue.\n *\n * @QueueWorker(\n *   id = \"api_normalization_request_processing\",\n *   title = @Translation(\"Request Processing\"),\n *   cron = {\"time\" = 60}\n * )\n */\nclass RequestProcessing extends QueueWorkerBase {\n\n  /**\n   * The normalization orchestrator.\n   *\n   * @var \\Drupal\\api_normalization\\Service\\NormalizationOrchestrator\n   */\n  protected NormalizationOrchestrator $orchestrator;\n\n  /**\n   * The logger.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   */\n  protected LoggerInterface $logger;\n\n  /**\n   * Constructs a RequestProcessing queue worker.\n   *\n   * @param array $configuration\n   *   Configuration.\n   * @param string $plugin_id\n   *   Plugin ID.\n   * @param mixed $plugin_definition\n   *   Plugin definition.\n   * @param \\Drupal\\api_normalization\\Service\\NormalizationOrchestrator $orchestrator\n   *   The normalization orchestrator.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   The logger.\n   */\n  public function __construct(\n    array $configuration,\n    $plugin_id,\n    $plugin_definition,\n    NormalizationOrchestrator $orchestrator,\n    LoggerInterface $logger,\n  ) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->orchestrator = $orchestrator;\n    $this->logger = $logger;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function processItem($data): void {\n    if (!isset($data['endpoint_data']) || !is_array($data['endpoint_data'])) {\n      $this->logger->error('Invalid queue item data');\n      return;\n    }\n\n    try {\n      $this->orchestrator->normalize($data['endpoint_data'], $data['options'] ?? []);\n      $this->logger->info('Processed request from queue: @id', [\n        '@id' => $data['request_id'] ?? 'unknown',\n      ]);\n    }\n    catch (\\Exception $e) {\n      $this->logger->error('Failed to process request from queue: @error', [\n        '@error' => $e->getMessage(),\n      ]);\n      throw $e;\n    }\n  }\n\n}\n", "metadata": {"source": "repos/api_normalization/src/Plugin/QueueWorker/RequestProcessing.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "RequestProcessing", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Tables allowed for truncation (logs, cache, sessions, etc.)\nallowed_tables:\n  - watchdog\n  - sessions\n  - flood\n  - queue\n  - batch\n  - semaphore\n  - advancedqueue\n  - ultimate_cron_log\n  - ultimate_cron_signal\n  # Cache tables (add more as needed)\n  - cache_bootstrap\n  - cache_config\n  - cache_container\n  - cache_data\n  - cache_default\n  - cache_discovery\n  - cache_dynamic_page_cache\n  - cache_entity\n  - cache_menu\n  - cache_page\n  - cache_render\n  - cache_toolbar\n  - cachetags\n\n# Tables that can NEVER be truncated\nprotected_tables:\n  - users\n  - users_field_data\n  - user__roles\n  - role\n  - config\n  - key_value\n  - key_value_expire\n  - sequences\n  - router\n  - menu_tree\n\nlogging:\n  enabled: true\n  log_row_counts: true\n", "metadata": {"source": "repos/db_wipe/modules/db_wipe_db/config/install/db_wipe_db.settings.yml", "type": "yaml_reference", "topic": "db wipe db.settings"}}
{"instruction": "Show me the implementation of the class BlockRegion in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\block\\Plugin\\migrate\\process;\n\nuse Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\nuse Drupal\\migrate\\Attribute\\MigrateProcess;\nuse Drupal\\migrate\\MigrateExecutableInterface;\nuse Drupal\\migrate\\Plugin\\migrate\\process\\StaticMap;\nuse Drupal\\migrate\\Row;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Determines the region for a block.\n *\n * @deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3533560\n */\n#[MigrateProcess('block_region')]\nclass BlockRegion extends StaticMap implements ContainerFactoryPluginInterface {\n\n  /**\n   * List of regions, keyed by theme.\n   *\n   * @var array[]\n   */\n  protected $regions;\n\n  /**\n   * Constructs a BlockRegion plugin instance.\n   *\n   * @param array $configuration\n   *   The plugin configuration.\n   * @param string $plugin_id\n   *   The plugin ID.\n   * @param mixed $plugin_definition\n   *   The plugin definition.\n   * @param array $regions\n   *   Array of region maps, keyed by theme.\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition, array $regions) {\n    @trigger_error(__CLASS__ . ' is deprecated in drupal:11.3.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3533560', E_USER_DEPRECATED);\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    $this->regions = $regions;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n    $regions = [];\n    foreach ($container->get('theme_handler')->listInfo() as $key => $theme) {\n      $regions[$key] = $theme->info['regions'];\n    }\n    return new static($configuration, $plugin_id, $plugin_definition, $regions);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function transform($value, MigrateExecutableInterface $migrate_executable, Row $row, $destination_property) {\n    // Set the destination region, based on the source region and theme as well\n    // as the current destination default theme.\n    [$source_theme, $destination_theme, $region] = $value;\n\n    // Theme is the same on both source and destination, so ensure that the\n    // region exists in the destination theme.\n    if (strtolower($source_theme) == strtolower($destination_theme)) {\n      if (isset($this->regions[$destination_theme][$region])) {\n        return $region;\n      }\n    }\n\n    // Fall back to static mapping.\n    return parent::transform($value, $migrate_executable, $row, $destination_property);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/block/src/Plugin/migrate/process/BlockRegion.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BlockRegion", "symbol_extraction_method": "declaration"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: CKEditor5Plugin.php\nTarget symbol: class CKEditor5Plugin\nNamespace: Drupal\\ckeditor5\\Annotation\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for CKEditor5Plugin.\n- Include required imports:\n  - Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition\n  - Drupal\\Component\\Annotation\\Plugin\n- Ensure these methods exist where relevant:\n  - __construct()\n  - get()\n  - getClass()\n  - setClass()", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Annotation;\n\nuse Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition;\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a CKEditor5Plugin annotation object.\n *\n * Plugin Namespace: Plugin\\CKEditor5Plugin.\n *\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginInterface\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginManagerInterface\n * @see plugin_api\n *\n * @Annotation\n * @see \\Drupal\\ckeditor5\\Annotation\\CKEditor5AspectsOfCKEditor5Plugin\n * @see \\Drupal\\ckeditor5\\Annotation\\DrupalAspectsOfCKEditor5Plugin\n */\nclass CKEditor5Plugin extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The CKEditor 5 aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Annotation\\CKEditor5AspectsOfCKEditor5Plugin\n   */\n  public $ckeditor5;\n\n  /**\n   * The Drupal aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Annotation\\DrupalAspectsOfCKEditor5Plugin\n   */\n  public $drupal;\n\n  /**\n   * {@inheritdoc}\n   *\n   * Overridden for compatibility with the AnnotationBridgeDecorator, which\n   * ensures YAML-defined CKEditor 5 plugin definitions are also processed by\n   * annotations. Unfortunately it does not (yet) support nested annotations.\n   * Force YAML-defined plugin definitions to be parsed by the\n   * annotations, to ensure consistent handling of defaults.\n   *\n   * @see \\Drupal\\Component\\Annotation\\Plugin\\Discovery\\AnnotationBridgeDecorator::getDefinitions()\n   */\n  public function __construct($values) {\n    if (isset($values['ckeditor5']) && is_array($values['ckeditor5'])) {\n      $values['ckeditor5'] = new CKEditor5AspectsOfCKEditor5Plugin($values['ckeditor5']);\n    }\n    if (isset($values['drupal']) && is_array($values['drupal'])) {\n      $values['drupal'] = new DrupalAspectsOfCKEditor5Plugin($values['drupal']);\n    }\n    parent::__construct($values);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClass() {\n    return $this->definition['drupal']['class'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setClass($class) {\n    $this->definition['drupal']['class'] = $class;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get(): CKEditor5PluginDefinition {\n    return new CKEditor5PluginDefinition($this->definition);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Annotation/CKEditor5Plugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CKEditor5Plugin", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Theme override for a 'textarea' #type form element.\n *\n * Available variables\n * - wrapper_attributes: A list of HTML attributes for the wrapper element.\n * - attributes: A list of HTML attributes for the <textarea> element.\n * - resizable: An indicator for whether the textarea is resizable.\n * - required: An indicator for whether the textarea is required.\n * - value: The textarea content.\n *\n * @see\\Drupal\\Core\\Form\\FormPreprocess::preprocessTextarea()\n */\n#}\n{%\n  set classes = [\n    'form-textarea',\n    resizable ? 'resize-' ~ resizable,\n    required ? 'required',\n  ]\n%}\n<div{{ wrapper_attributes.addClass('form-textarea-wrapper') }}>\n  <textarea{{ attributes.addClass(classes) }}>{{ value }}</textarea>\n</div>\n", "metadata": {"source": "repos/drupal_core/core/profiles/demo_umami/themes/umami/templates/classy/form/textarea.html.twig", "type": "twig_reference"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * FlowDrop Job Timeline Component\n *\n * Displays jobs as a vertical timeline showing execution progression.\n *\n * Available variables:\n * - jobs: Array of job items\n *   - id: Job ID\n *   - label: Job name\n *   - url: Link to job detail\n *   - status: Job status\n *   - node_type: Node type name\n *   - node_type_url: Link to node type\n *   - duration: Execution duration\n *   - error_message: Error if failed\n */\n#}\n\n{% set status_map = {\n  'idle': {'variant': 'neutral', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Idle'},\n  'pending': {'variant': 'warning', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Pending'},\n  'running': {'variant': 'info', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0v2.43l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Running'},\n  'completed': {'variant': 'success', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Completed'},\n  'failed': {'variant': 'error', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Failed'},\n  'cancelled': {'variant': 'neutral', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM6.75 9.25a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Cancelled'},\n  'skipped': {'variant': 'neutral', 'icon': '<svg viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM6.75 6.75a.75.75 0 000 1.5h2.69l-3.22 3.22a.75.75 0 101.06 1.06l3.22-3.22v2.69a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5z\" clip-rule=\"evenodd\"/></svg>', 'label': 'Skipped'}\n} %}\n\n<div class=\"fd-job-timeline\">\n  {% for job in jobs %}\n    {% set config = status_map[job.status]|default({'variant': 'neutral', 'icon': '', 'label': job.status|capitalize}) %}\n    {% set is_last = loop.last %}\n    {% set is_first = loop.first %}\n\n    <div class=\"fd-job-timeline__item fd-job-timeline__item--{{ config.variant }}{% if is_first %} fd-job-timeline__item--first{% endif %}{% if is_last %} fd-job-timeline__item--last{% endif %}\">\n      {# Timeline Track (left side with continuous line via CSS) #}\n      <div class=\"fd-job-timeline__track\">\n        <div class=\"fd-job-timeline__node fd-job-timeline__node--{{ config.variant }}\" aria-label=\"{{ config.label }}\">\n          {{ config.icon|raw }}\n        </div>\n      </div>\n\n      {# Job Content Card #}\n      <a href=\"{{ job.url }}\" class=\"fd-job-timeline__card fd-job-timeline__card--{{ config.variant }}\">\n        <div class=\"fd-job-timeline__card-content\">\n          <div class=\"fd-job-timeline__card-main\">\n            <span class=\"fd-job-timeline__title\">{{ job.label }}</span>\n            {% if job.node_type %}\n              <span class=\"fd-job-timeline__type\">{{ job.node_type }}</span>\n            {% endif %}\n          </div>\n\n          <div class=\"fd-job-timeline__card-meta\">\n            {% if job.duration %}\n              <span class=\"fd-job-timeline__duration\" title=\"Duration\">\n                <svg viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\n                  <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z\" clip-rule=\"evenodd\"/>\n                </svg>\n                {{ job.duration }}\n              </span>\n            {% endif %}\n            <span class=\"fd-job-timeline__badge fd-job-timeline__badge--{{ config.variant }}\">\n              {{ config.label }}\n            </span>\n          </div>\n        </div>\n\n        {% if job.error_message %}\n          <div class=\"fd-job-timeline__error\">\n            <svg viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\n              <path fill-rule=\"evenodd\" d=\"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z\" clip-rule=\"evenodd\"/>\n            </svg>\n            <span>{{ job.error_message }}</span>\n          </div>\n        {% endif %}\n      </a>\n    </div>\n  {% endfor %}\n</div>\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_ui_components/components/job-timeline/job-timeline.twig", "type": "twig_reference"}}
{"instruction": "Show me the implementation of the class UniqueLabelInListConstraint in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Plugin\\Validation\\Constraint;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Validation\\Attribute\\Constraint;\nuse Symfony\\Component\\Validator\\Attribute\\HasNamedArguments;\nuse Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n\n/**\n * Uniquely labeled list item constraint.\n *\n * @internal\n */\n#[Constraint(\n  id: 'UniqueLabelInList',\n  label: new TranslatableMarkup('Unique label in list', [], ['context' => 'Validation'])\n)]\nclass UniqueLabelInListConstraint extends SymfonyConstraint {\n\n  /**\n   * The key of the label that this validation constraint should check.\n   *\n   * @var null|string\n   */\n  public $labelKey = NULL;\n\n  #[HasNamedArguments]\n  public function __construct(\n    mixed $options = NULL,\n    ?string $labelKey = NULL,\n    public $message = 'The label %label is not unique.',\n    ?array $groups = NULL,\n    mixed $payload = NULL,\n  ) {\n    parent::__construct($options, $groups, $payload);\n    $this->labelKey = $labelKey ?? $this->labelKey;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getRequiredOptions(): array {\n    return ['labelKey'];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Plugin/Validation/Constraint/UniqueLabelInListConstraint.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UniqueLabelInListConstraint", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "image_hotspot_agent.settings:\n  title: 'Image Hotspot Agent'\n  description: 'Configure color themes and hotspot sizes.'\n  route_name: image_hotspot_agent.settings\n  parent: system.admin_config_content\n  weight: 100\n", "metadata": {"source": "repos/image_hotspots_agent/image_hotspot_agent.links.menu.yml", "type": "yaml_reference", "topic": "image hotspot agent.links.menu"}}
{"instruction": "Show me the implementation of the class SystemCompactLink in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Link as BaseLink;\nuse Drupal\\Core\\Render\\Attribute\\RenderElement;\nuse Drupal\\Core\\Url as BaseUrl;\nuse Drupal\\Component\\Utility\\NestedArray;\n\n/**\n * Provides a link to show or hide help text on administration pages.\n *\n * Usage example:\n * @code\n * $form['system_compact_link'] = [\n *   '#type' => 'system_compact_link',\n * ];\n * @endcode\n */\n#[RenderElement('system_compact_link')]\nclass SystemCompactLink extends Link {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getInfo() {\n    return [\n      '#pre_render' => [\n        [static::class, 'preRenderCompactLink'],\n        [static::class, 'preRenderLink'],\n      ],\n      '#theme_wrappers' => [\n        'container' => [\n          '#attributes' => ['class' => ['compact-link']],\n        ],\n      ],\n    ];\n  }\n\n  /**\n   * Pre-render callback: Renders a link into #markup.\n   *\n   * Doing so during pre_render gives modules a chance to alter the link parts.\n   *\n   * @param array $element\n   *   A structured array whose keys form the arguments to Drupal::l():\n   *   - #title: The link text to pass as argument to Drupal::l().\n   *   - One of the following:\n   *     - #route_name and (optionally) a #route_parameters array; The route\n   *       name and route parameters which will be passed into the link\n   *       generator.\n   *     - #href: The system path or URL to pass as argument to Drupal::l().\n   *   - #options: (optional) An array of options to pass to Drupal::l() or the\n   *     link generator.\n   *\n   * @return array\n   *   The passed-in element containing the system compact link default values.\n   */\n  public static function preRenderCompactLink($element) {\n    // By default, link options to pass to l() are normally set in #options.\n    $element += ['#options' => []];\n\n    if (system_admin_compact_mode()) {\n      $element['#title'] = t('Show descriptions');\n      $element['#url'] = BaseUrl::fromRoute('system.admin_compact_page', ['mode' => 'off']);\n      $element['#options'] = [\n        'attributes' => ['title' => t('Expand layout to include descriptions.')],\n        'query' => \\Drupal::destination()->getAsArray(),\n      ];\n    }\n    else {\n      $element['#title'] = t('Hide descriptions');\n      $element['#url'] = BaseUrl::fromRoute('system.admin_compact_page', ['mode' => 'on']);\n      $element['#options'] = [\n        'attributes' => ['title' => t('Compress layout by hiding descriptions.')],\n        'query' => \\Drupal::destination()->getAsArray(),\n      ];\n    }\n\n    $options = NestedArray::mergeDeep($element['#url']->getOptions(), $element['#options']);\n    $element['#markup'] = BaseLink::fromTextAndUrl($element['#title'], $element['#url']->setOptions($options))->toString();\n\n    return $element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/SystemCompactLink.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "SystemCompactLink", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PathExtractor in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Core\\Theme\\Plugin\\IconExtractor;\n\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Theme\\Icon\\Attribute\\IconExtractor;\nuse Drupal\\Core\\Theme\\Icon\\IconDefinition;\nuse Drupal\\Core\\Theme\\Icon\\IconExtractorWithFinder;\nuse Drupal\\Core\\Theme\\Icon\\IconPackExtractorForm;\n\n/**\n * Plugin implementation of the icon_extractor.\n *\n * @internal\n *   This API is experimental.\n */\n#[IconExtractor(\n  id: 'path',\n  label: new TranslatableMarkup('Path or URL'),\n  description: new TranslatableMarkup('Handles paths or URLs for icons.'),\n  forms: [\n    'settings' => IconPackExtractorForm::class,\n  ]\n)]\nclass PathExtractor extends IconExtractorWithFinder {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function discoverIcons(): array {\n    $files = $this->getFilesFromSources();\n\n    if (empty($files)) {\n      return [];\n    }\n\n    $icons = [];\n    foreach ($files as $file) {\n      $id = IconDefinition::createIconId($this->configuration['id'], $file['icon_id']);\n      $icons[$id] = [\n        'absolute_path' => $file['absolute_path'],\n        'source' => $file['source'],\n        'group' => $file['group'] ?? NULL,\n      ];\n    }\n\n    return $icons;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Theme/Plugin/IconExtractor/PathExtractor.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathExtractor", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<article{{ attributes.addClass('teaser') }}>\n  <header>\n    {% block prefix %}{% endblock %}\n    <div class=\"teaser__meta\">\n      {% block meta %}{% endblock %}\n    </div>\n    <div class=\"teaser__top\">\n      <div class=\"teaser__image\">{% block image %}{% endblock %}</div>\n      {% block title %}{% endblock %}\n    </div>\n  </header>\n  <div class=\"teaser__content\">\n    {% block content %}{% endblock %}\n  </div>\n</article>\n", "metadata": {"source": "repos/drupal_core/core/themes/olivero/components/teaser/teaser.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "# Schema for the views plugins of the Comment module.\n\nviews.argument.argument_comment_user_uid:\n  type: views_argument\n  label: 'Commented user ID'\n\nviews.field.comment_depth:\n  type: views_field\n  label: 'Comment depth'\n\nviews.field.comment_entity_link:\n  type: views_field\n  label: 'Comment link'\n  mapping:\n    teaser:\n      type: boolean\n      label: 'Show teaser-style link'\n\nviews.field.comment_bulk_form:\n  type: views_field_bulk_form\n  label: 'Comment bulk form'\n\nviews.field.commented_entity:\n  type: views.field.field\n  label: 'Commented entity'\n\nviews.field.comment_last_timestamp:\n  type: views.field.date\n  label: 'Last comment date'\n\nviews.field.comment_link_approve:\n  type: views.field.comment_link\n  label: 'Comment approve link'\n  mapping:\n    text:\n      type: label\n      label: 'Text to display'\n\nviews.field.comment_link_reply:\n  type: views.field.comment_link\n  label: 'Comment reply link'\n\nviews.field.node_new_comments:\n  type: views.field.numeric\n  label: 'Number of new comments'\n  mapping:\n    link_to_comment:\n      type: boolean\n      label: 'Link this field to new comments'\n\nviews.field.comment_ces_last_comment_name:\n  type: views_field\n  label: 'Name of last comment poster'\n\nviews.field.comment_ces_last_updated:\n  type: views.field.date\n  label: 'Newer of last comment / node updated'\n\nviews.filter.node_comment:\n  type: views.filter.in_operator\n  label: 'Comment node status'\n\nviews.filter.comment_ces_last_updated:\n  type: views.filter.date\n  label: 'Newer of last comment / node updated'\n\nviews.filter.comment_user_uid:\n  type: views_filter\n  label: 'Node user posted comment'\n\nviews.row.comment_rss:\n  type: views_row\n  label: 'Comment'\n  mapping:\n    view_mode:\n      type: string\n      label: 'Display type'\n\nviews.sort.comment_ces_last_comment_name:\n  type: views_sort\n  label: 'Last comment name'\n\nviews.sort.comment_ces_last_updated:\n  type: views.sort.date\n  label: 'Newer of last comment / entity updated'\n\nviews.sort.comment_thread:\n  type: views_sort\n  label: 'Thread'\n", "metadata": {"source": "repos/drupal_core/core/modules/comment/config/schema/comment.views.schema.yml", "type": "yaml_reference", "topic": "comment.views.schema"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'MCP Tools - Views'\ntype: module\ndescription: 'Views management: create, update, delete, and configure views.'\npackage: MCP Tools\ncore_version_requirement: ^10.3 || ^11\ndependencies:\n  - mcp_tools:mcp_tools\n  - drupal:views\nlifecycle: experimental\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_views/mcp_tools_views.info.yml", "type": "yaml_reference", "topic": "mcp tools views.info"}}
{"instruction": "Show me the implementation of the class DateFormatFormBase in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\Entity\\ConfigEntityStorageInterface;\nuse Drupal\\Core\\Datetime\\DateFormatterInterface;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\Language\\LanguageInterface;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\nuse Drupal\\Core\\Entity\\EntityForm;\n\n/**\n * Provides a base form for date formats.\n */\nabstract class DateFormatFormBase extends EntityForm {\n\n  /**\n   * The date formatter service.\n   *\n   * @var \\Drupal\\Core\\Datetime\\DateFormatterInterface\n   */\n  protected $dateFormatter;\n\n  /**\n   * The date format storage.\n   *\n   * @var \\Drupal\\Core\\Config\\Entity\\ConfigEntityStorageInterface\n   */\n  protected $dateFormatStorage;\n\n  /**\n   * Constructs a new date format form.\n   *\n   * @param \\Drupal\\Core\\Datetime\\DateFormatterInterface $date_formatter\n   *   The date service.\n   * @param \\Drupal\\Core\\Config\\Entity\\ConfigEntityStorageInterface $date_format_storage\n   *   The date format storage.\n   */\n  public function __construct(DateFormatterInterface $date_formatter, ConfigEntityStorageInterface $date_format_storage) {\n    $this->dateFormatter = $date_formatter;\n    $this->dateFormatStorage = $date_format_storage;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('date.formatter'),\n      $container->get('entity_type.manager')->getStorage('date_format')\n    );\n  }\n\n  /**\n   * Checks for an existing date format.\n   *\n   * @param string|int $entity_id\n   *   The entity ID.\n   * @param array $element\n   *   The form element.\n   *\n   * @return bool\n   *   TRUE if this format already exists, FALSE otherwise.\n   */\n  public function exists($entity_id, array $element) {\n    return (bool) $this->dateFormatStorage\n      ->getQuery()\n      ->condition('id', $element['#field_prefix'] . $entity_id)\n      ->execute();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function form(array $form, FormStateInterface $form_state) {\n    $form['label'] = [\n      '#type' => 'textfield',\n      '#title' => 'Name',\n      '#maxlength' => 100,\n      '#description' => $this->t('Name of the date format'),\n      '#default_value' => $this->entity->label(),\n    ];\n\n    $form['id'] = [\n      '#type' => 'machine_name',\n      '#description' => $this->t('A unique machine-readable name. Can only contain lowercase letters, numbers, and underscores.'),\n      '#disabled' => !$this->entity->isNew(),\n      '#default_value' => $this->entity->id(),\n      '#machine_name' => [\n        'exists' => [$this, 'exists'],\n        'replace_pattern' => '([^a-z0-9_]+)|(^custom$)',\n        'error' => $this->t('The machine-readable name must be unique, and can only contain lowercase letters, numbers, and underscores. Additionally, it can not be the reserved word \"custom\".'),\n      ],\n    ];\n    $form['date_format_pattern'] = [\n      '#type' => 'textfield',\n      '#title' => $this->t('Format string'),\n      '#maxlength' => 100,\n      '#description' => $this->t('A user-defined date format. See the <a href=\"https://www.php.net/manual/datetime.format.php#refsect1-datetime.format-parameters\">PHP manual</a> for available options.'),\n      '#required' => TRUE,\n      '#attributes' => [\n        'data-drupal-date-formatter' => 'source',\n      ],\n      '#field_suffix' => ' <small class=\"js-hide\" data-drupal-date-formatter=\"preview\">' . $this->t('Displayed as %date_format', ['%date_format' => '']) . '</small>',\n    ];\n\n    $form['langcode'] = [\n      '#type' => 'language_select',\n      '#title' => $this->t('Language'),\n      '#languages' => LanguageInterface::STATE_ALL,\n      '#default_value' => $this->entity->language()->getId(),\n    ];\n    $form['#attached']['drupalSettings']['dateFormats'] = $this->dateFormatter->getSampleDateFormats();\n    $form['#attached']['library'][] = 'system/drupal.system.date';\n    return parent::form($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state) {\n    parent::validateForm($form, $form_state);\n\n    // The machine name field should already check to see if the requested\n    // machine name is available.\n    $pattern = trim($form_state->getValue('date_format_pattern'));\n    foreach ($this->dateFormatStorage->loadMultiple() as $format) {\n      if ($format->getPattern() == $pattern && ($format->id() == $this->entity->id())) {\n        $this->messenger()->addStatus($this->t('The existing format/name combination has not been altered.'));\n        continue;\n      }\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $form_state->setValue('pattern', trim($form_state->getValue('date_format_pattern')));\n    parent::submitForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function save(array $form, FormStateInterface $form_state) {\n    $status = $this->entity->save();\n    if ($status == SAVED_UPDATED) {\n      $this->messenger()->addStatus($this->t('Custom date format updated.'));\n    }\n    else {\n      $this->messenger()->addStatus($this->t('Custom date format added.'));\n    }\n    $form_state->setRedirectUrl($this->entity->toUrl('collection'));\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/DateFormatFormBase.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "DateFormatFormBase", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PagerManager in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Pager;\n\nuse Drupal\\Core\\DependencyInjection\\DependencySerializationTrait;\n\n/**\n * Provides a manager for pagers.\n *\n * Pagers are cached, and can be retrieved when rendering.\n */\nclass PagerManager implements PagerManagerInterface {\n\n  use DependencySerializationTrait;\n\n  /**\n   * The pager parameters.\n   *\n   * @var \\Drupal\\Core\\Pager\\PagerParametersInterface\n   */\n  protected $pagerParams;\n\n  /**\n   * An associative array of pagers.\n   *\n   * Implemented as an array consisting of:\n   *   - key: the element id integer.\n   *   - value: a \\Drupal\\Core\\Pager\\Pager.\n   *\n   * @var array\n   */\n  protected $pagers;\n\n  /**\n   * The highest pager ID created so far.\n   *\n   * @var int\n   */\n  protected $maxPagerElementId = -1;\n\n  /**\n   * Construct a PagerManager object.\n   *\n   * @param \\Drupal\\Core\\Pager\\PagerParametersInterface $pager_params\n   *   The pager parameters.\n   */\n  public function __construct(PagerParametersInterface $pager_params) {\n    $this->pagerParams = $pager_params;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function createPager($total, $limit, $element = 0) {\n    $currentPage = $this->pagerParams->findPage($element);\n    $pager = new Pager($total, $limit, $currentPage);\n    $this->setPager($pager, $element);\n    return $pager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getPager($element = 0) {\n    return $this->pagers[$element] ?? NULL;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function findPage(int $pager_id = 0): int {\n    return $this->pagerParams->findPage($pager_id);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getUpdatedParameters(array $query, $element, $index) {\n    // Build the 'page' query parameter. This is built based on the current\n    // page of each pager element (or NULL if the pager is not set), with the\n    // exception of the requested page index for the current element.\n    $element_pages = [];\n    $max = $this->getMaxPagerElementId();\n    for ($i = 0; $i <= $max; $i++) {\n      $currentPage = ($pager = $this->getPager($i)) ? $pager->getCurrentPage() : NULL;\n      $element_pages[] = ($i == $element) ? $index : $currentPage;\n    }\n    $query['page'] = implode(',', $element_pages);\n\n    // Merge the query parameters passed to this function with the parameters\n    // from the current request. In case of collision, the parameters passed\n    // into this function take precedence.\n    if ($current_query = $this->pagerParams->getQueryParameters()) {\n      $query = array_merge($current_query, $query);\n    }\n    return $query;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getMaxPagerElementId() {\n    return $this->maxPagerElementId;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function reservePagerElementId(int $element): void {\n    $this->maxPagerElementId = max($element, $this->maxPagerElementId);\n  }\n\n  /**\n   * Saves a pager to the static cache.\n   *\n   * @param \\Drupal\\Core\\Pager\\Pager $pager\n   *   The pager.\n   * @param int $element\n   *   The pager index.\n   */\n  protected function setPager(Pager $pager, $element = 0) {\n    $this->maxPagerElementId = max($element, $this->maxPagerElementId);\n    $this->pagers[$element] = $pager;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Pager/PagerManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PagerManager", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class AllowedScaffoldPackagesValidator in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\package_manager\\Validator;\n\nuse Drupal\\Component\\Serialization\\Json;\nuse Drupal\\Core\\StringTranslation\\StringTranslationTrait;\nuse Drupal\\package_manager\\Event\\StatusCheckEvent;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\nuse Drupal\\package_manager\\ComposerInspector;\nuse Drupal\\package_manager\\Event\\PreApplyEvent;\nuse Drupal\\package_manager\\Event\\PreCreateEvent;\nuse Drupal\\package_manager\\Event\\SandboxValidationEvent;\nuse Drupal\\package_manager\\PathLocator;\n\n/**\n * Validates the list of packages that are allowed to scaffold files.\n *\n * @internal\n *   This is an internal part of Package Manager and may be changed or removed\n *   at any time without warning. External code should not interact with this\n *   class.\n */\nfinal class AllowedScaffoldPackagesValidator implements EventSubscriberInterface {\n\n  use StringTranslationTrait;\n\n  public function __construct(\n    private readonly ComposerInspector $composerInspector,\n    private readonly PathLocator $pathLocator,\n  ) {}\n\n  /**\n   * Validates that only the implicitly allowed packages can use scaffolding.\n   */\n  public function validate(SandboxValidationEvent $event): void {\n    $sandbox_manager = $event->sandboxManager;\n    $path = $event instanceof PreApplyEvent\n      ? $sandbox_manager->getSandboxDirectory()\n      : $this->pathLocator->getProjectRoot();\n\n    // @see https://www.drupal.org/docs/develop/using-composer/using-drupals-composer-scaffold\n    $implicitly_allowed_packages = [\n      \"drupal/legacy-scaffold-assets\",\n      \"drupal/core\",\n    ];\n    $extra = Json::decode($this->composerInspector->getConfig('extra', $path . '/composer.json'));\n    $allowed_packages = $extra['drupal-scaffold']['allowed-packages'] ?? [];\n    $extra_packages = array_diff($allowed_packages, $implicitly_allowed_packages);\n    if (!empty($extra_packages)) {\n      $event->addError(\n        // phpcs:ignore Drupal.Semantics.FunctionT.NotLiteralString\n        array_map($this->t(...), $extra_packages),\n        $this->t('Any packages other than the implicitly allowed packages are not allowed to scaffold files. See <a href=\":url\">the scaffold documentation</a> for more information.', [\n          ':url' => 'https://www.drupal.org/docs/develop/using-composer/using-drupals-composer-scaffold',\n        ])\n      );\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function getSubscribedEvents() : array {\n    return [\n      StatusCheckEvent::class => 'validate',\n      PreCreateEvent::class => 'validate',\n      PreApplyEvent::class => 'validate',\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/package_manager/src/Validator/AllowedScaffoldPackagesValidator.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "AllowedScaffoldPackagesValidator", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class InstallerRouteBuilder in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Installer;\n\nuse Drupal\\Core\\Routing\\RouteBuilder;\n\n/**\n * Manages the router in the installer.\n */\nclass InstallerRouteBuilder extends RouteBuilder {\n\n  /**\n   * {@inheritdoc}\n   *\n   * Overridden to return no routes.\n   *\n   * @todo Convert installer steps into routes; add an installer.routing.yml.\n   */\n  protected function getRouteDefinitions() {\n    return [];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Installer/InstallerRouteBuilder.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "InstallerRouteBuilder", "symbol_extraction_method": "declaration"}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "<iframe\n        src=\"{{ iframe_url }}\"\n        width=\"100%\"\n        height=\"{{ height }}\"\n        frameborder=\"0\"\n></iframe>\n", "metadata": {"source": "repos/metabase/templates/metabase-dashboard.html.twig", "type": "twig_reference"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: ImageToolkitForm.php\nTarget symbol: class ImageToolkitForm\nNamespace: Drupal\\system\\Form\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for ImageToolkitForm.\n- Include required imports:\n  - Drupal\\Core\\Config\\ConfigFactoryInterface\n  - Drupal\\Core\\Config\\TypedConfigManagerInterface\n  - Drupal\\Core\\Form\\ConfigFormBase\n  - Drupal\\Core\\Form\\FormStateInterface\n  - Drupal\\Core\\ImageToolkit\\ImageToolkitManager\n  - Symfony\\Component\\DependencyInjection\\ContainerInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - buildForm()\n  - create()\n  - getEditableConfigNames()\n  - getFormId()\n  - submitForm()\n  - validateForm()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\system\\Form;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Config\\TypedConfigManagerInterface;\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\FormStateInterface;\nuse Drupal\\Core\\ImageToolkit\\ImageToolkitManager;\nuse Symfony\\Component\\DependencyInjection\\ContainerInterface;\n\n/**\n * Configures image toolkit settings for this site.\n *\n * @internal\n */\nclass ImageToolkitForm extends ConfigFormBase {\n\n  /**\n   * An array containing currently available toolkits.\n   *\n   * @var \\Drupal\\Core\\ImageToolkit\\ImageToolkitInterface[]\n   */\n  protected $availableToolkits = [];\n\n  /**\n   * Constructs an ImageToolkitForm object.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The factory for configuration objects.\n   * @param \\Drupal\\Core\\Config\\TypedConfigManagerInterface $typedConfigManager\n   *   The typed config manager.\n   * @param \\Drupal\\Core\\ImageToolkit\\ImageToolkitManager $manager\n   *   The image toolkit plugin manager.\n   */\n  public function __construct(ConfigFactoryInterface $config_factory, TypedConfigManagerInterface $typedConfigManager, ImageToolkitManager $manager) {\n    parent::__construct($config_factory, $typedConfigManager);\n\n    foreach ($manager->getAvailableToolkits() as $id => $definition) {\n      $this->availableToolkits[$id] = $manager->createInstance($id);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function create(ContainerInterface $container) {\n    return new static(\n      $container->get('config.factory'),\n      $container->get('config.typed'),\n      $container->get('image.toolkit.manager')\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'system_image_toolkit_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['system.image'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form['image_toolkit'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Select an image processing toolkit'),\n      '#config_target' => 'system.image:toolkit',\n      '#options' => [],\n    ];\n\n    // If we have more than one image toolkit, allow the user to select the one\n    // to use, and load each of the toolkits' settings form.\n    foreach ($this->availableToolkits as $id => $toolkit) {\n      $definition = $toolkit->getPluginDefinition();\n      $form['image_toolkit']['#options'][$id] = $definition['title'];\n      $form['image_toolkit_settings'][$id] = [\n        '#type' => 'details',\n        '#title' => $this->t('@toolkit settings', ['@toolkit' => $definition['title']]),\n        '#open' => TRUE,\n        '#tree' => TRUE,\n        '#states' => [\n          'visible' => [\n            ':radio[name=\"image_toolkit\"]' => ['value' => $id],\n          ],\n        ],\n      ];\n      $form['image_toolkit_settings'][$id] += $toolkit->buildConfigurationForm([], $form_state);\n    }\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function validateForm(array &$form, FormStateInterface $form_state) {\n    parent::validateForm($form, $form_state);\n\n    // Call the form validation handler for each of the toolkits.\n    foreach ($this->availableToolkits as $toolkit) {\n      $toolkit->validateConfigurationForm($form, $form_state);\n    }\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    // Call the form submit handler for each of the toolkits.\n    foreach ($this->availableToolkits as $toolkit) {\n      $toolkit->submitConfigurationForm($form, $form_state);\n    }\n\n    parent::submitForm($form, $form_state);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/system/src/Form/ImageToolkitForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ImageToolkitForm", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Show me the implementation of the class PathMatcher in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Path;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\Url;\n\n/**\n * Provides a path matcher.\n */\nclass PathMatcher implements PathMatcherInterface {\n\n  /**\n   * Whether the current page is the front page.\n   *\n   * @var bool\n   */\n  protected $isCurrentFrontPage;\n\n  /**\n   * The default front page.\n   *\n   * @var string\n   */\n  protected $frontPage;\n\n  /**\n   * The cache of regular expressions.\n   *\n   * @var array\n   */\n  protected $regexes;\n\n  /**\n   * The config factory service.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   */\n  protected $configFactory;\n\n  /**\n   * The current route match.\n   *\n   * @var \\Drupal\\Core\\Routing\\RouteMatchInterface\n   */\n  protected $routeMatch;\n\n  /**\n   * Creates a new PathMatcher.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The current route match.\n   */\n  public function __construct(ConfigFactoryInterface $config_factory, RouteMatchInterface $route_match) {\n    $this->configFactory = $config_factory;\n    $this->routeMatch = $route_match;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function matchPath($path, $patterns) {\n\n    if (!isset($this->regexes[$patterns])) {\n      // Convert path settings to a regular expression.\n      $to_replace = [\n        // Replace newlines with a logical 'or'.\n        '/(\\r\\n?|\\n)/',\n        // Quote asterisks.\n        '/\\\\\\\\\\*/',\n        // Quote <front> keyword.\n        '/(^|\\|)\\\\\\\\<front\\\\\\\\>($|\\|)/',\n      ];\n      $replacements = [\n        '|',\n        '.*',\n        '\\1' . preg_quote($this->getFrontPagePath(), '/') . '\\2',\n      ];\n      $patterns_quoted = preg_quote($patterns, '/');\n      $this->regexes[$patterns] = '/^(' . preg_replace($to_replace, $replacements, $patterns_quoted) . ')$/';\n    }\n    return (bool) preg_match($this->regexes[$patterns], $path);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function isFrontPage() {\n    // Cache the result as this is called often.\n    if (!isset($this->isCurrentFrontPage)) {\n      $this->isCurrentFrontPage = FALSE;\n      // Ensure that the code can also be executed when there is no active\n      // route match, like on exception responses.\n      if ($this->routeMatch->getRouteName()) {\n        $url = Url::fromRouteMatch($this->routeMatch);\n        $this->isCurrentFrontPage = ($url->getRouteName() && '/' . $url->getInternalPath() === $this->getFrontPagePath());\n      }\n    }\n    return $this->isCurrentFrontPage;\n  }\n\n  /**\n   * Gets the current front page path.\n   *\n   * @return string\n   *   The front page path.\n   */\n  protected function getFrontPagePath() {\n    // Lazy-load front page config.\n    if (!isset($this->frontPage)) {\n      $this->frontPage = $this->configFactory->get('system.site')\n        ->get('page.front') ?? '';\n    }\n    return $this->frontPage;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Path/PathMatcher.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PathMatcher", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: MessagesBlockPluginInterface.php", "input": "", "output": "[![Main menu](/themes/contrib/bluecheese/images/icon-w-menu.svg)](#block-system-main-menu)\n\n# MessagesBlockPluginInterface.php\n\nSame filename and directory in other branches\n\n1. [10 core/lib/Drupal/Core/Block/MessagesBlockPluginInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21MessagesBlockPluginInterface.php/10)\n2. [9 core/lib/Drupal/Core/Block/MessagesBlockPluginInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21MessagesBlockPluginInterface.php/9)\n3. [8.9.x core/lib/Drupal/Core/Block/MessagesBlockPluginInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21MessagesBlockPluginInterface.php/8.9.x)\n\n### Namespace\n\n[Drupal\\Core\\Block](/api/drupal/namespace/Drupal%21Core%21Block/11.x)\n\n### File\n\n[View on git.drupalcode.org](https://git.drupalcode.org/project/drupal/-/blob/11.x/core/lib/Drupal/Core/Block/MessagesBlockPluginInterface.php)\n\ncore/lib/Drupal/Core/Block/[MessagesBlockPluginInterface.php](/api/drupal/core%21lib%21Drupal%21Core%21Block%21MessagesBlockPluginInterface.php/11.x)\n\nView source\n\n```\n<?php\n\nnamespace Drupal\\Core\\Block;\n\n/**\n * The interface for \"messages\" (#type => status_messages) blocks.\n *\n * @see \\Drupal\\Core\\Messenger\\MessengerInterface\n * @see \\Drupal\\Core\\Render\\Element\\StatusMessages\n * @see \\Drupal\\block\\Plugin\\DisplayVariant\\BlockPageVariant\n *\n * @ingroup block_api\n */\ninterface MessagesBlockPluginInterface extends BlockPluginInterface {\n\n}\n```\n\n### Interfaces\n\n| Title | Deprecated | Summary |\n| --- | --- | --- |\n| [MessagesBlockPluginInterface](/api/drupal/core%21lib%21Drupal%21Core%21Block%21MessagesBlockPluginInterface.php/interface/MessagesBlockPluginInterface/11.x) |  | The interface for \"messages\" (#type => status\\_messages) blocks. |\n\n---\n\n**Buggy or inaccurate documentation?** Please [file an issue](https://drupal.org/node/add/project-issue/drupal?component=documentation&categories=2&version=11.x-dev&body=API%20page%3A%20https%3A//api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Block%2521MessagesBlockPluginInterface.php/11.x%0A%0AEnter%20a%20descriptive%20title%20%28above%29%2C%20then%20describe%20the%20problem%20you%20have%20found%3A%0A). Need [support](https://drupal.org/support)? Need help programming? Connect with the [Drupal community](https://drupal.org/community).\n", "metadata": {"source": "docs/api_drupal_org/api/drupal/core%21lib%21Drupal%21Core%21Block%21MessagesBlockPluginInterface.php/11.x.md", "type": "doc_summary", "topic": "MessagesBlockPluginInterface.php"}}
{"instruction": "Show me the implementation of the class TestFileParser in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Test\\RunTests;\n\nuse PHPUnit\\Framework\\TestCase;\n\n@trigger_error('Drupal\\Core\\Test\\RunTests\\TestFileParser is deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. There is no replacement. See https://www.drupal.org/node/3447698', E_USER_DEPRECATED);\n\n/**\n * Parses class names from PHP files without loading them.\n *\n * @deprecated in drupal:11.2.0 and is removed from drupal:12.0.0. There is no\n *   replacement.\n *\n * @see https://www.drupal.org/node/3447698\n *\n * @internal\n */\nclass TestFileParser {\n\n  /**\n   * Gets the classes from a PHP file.\n   *\n   * @param string $file\n   *   The path to the file to parse.\n   *\n   * @return string[]\n   *   Array of fully qualified class names within the PHP file.\n   */\n  public function getTestListFromFile($file) {\n    $test_list = $this->parseContents(file_get_contents($file));\n    return array_filter($test_list, function ($class) {\n      return is_subclass_of($class, TestCase::class);\n    });\n  }\n\n  /**\n   * Parse class names out of PHP file contents.\n   *\n   * @param string $contents\n   *   The contents of a PHP file.\n   *\n   * @return string[]\n   *   Array of fully qualified class names within the PHP file contents.\n   */\n  protected function parseContents($contents) {\n    // Extract a potential namespace.\n    $namespace = FALSE;\n    if (preg_match('@^\\s*namespace ([^ ;]+)@m', $contents, $matches)) {\n      $namespace = $matches[1];\n    }\n    $test_list = [];\n    // Extract all class names. Abstract classes are excluded on purpose.\n    preg_match_all('@^\\s*(?!abstract\\s+)(?:final\\s+|\\s*)class ([^ ]+)@m', $contents, $matches);\n    if (!$namespace) {\n      $test_list = $matches[1];\n    }\n    else {\n      foreach ($matches[1] as $class_name) {\n        $namespace_class = $namespace . '\\\\' . $class_name;\n        $test_list[] = $namespace_class;\n      }\n    }\n    return $test_list;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Test/RunTests/TestFileParser.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "TestFileParser", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Preface", "input": "", "output": "Advertising sustains the DA. Ads are hidden for members. [Join today](/association/individual-membership)\n\n## [Drupal User Guide](/docs/user_guide/en/index.html)\n\n* [Preface](/docs/user_guide/en/preface.html)\n* [Chapter 1. Understanding Drupal](/docs/user_guide/en/understanding-chapter.html)\n* [Chapter 2. Planning Your Site](/docs/user_guide/en/planning-chapter.html)\n* [Chapter 3. Installation](/docs/user_guide/en/installation-chapter.html)\n* [Chapter 4. Basic Site Configuration](/docs/user_guide/en/config-chapter.html)\n* [Chapter 5. Basic Page Management](/docs/user_guide/en/content-chapter.html)\n* [Chapter 6. Setting Up Content Structure](/docs/user_guide/en/content-structure-chapter.html)\n* [Chapter 7. Managing User Accounts](/docs/user_guide/en/user-chapter.html)\n* [Chapter 8. Blocks](/docs/user_guide/en/blocks-chapter.html)\n* [Chapter 9. Creating Listings with Views](/docs/user_guide/en/views-chapter.html)\n* [Chapter 10. Making Your Site Multilingual](/docs/user_guide/en/multilingual-chapter.html)\n* [Chapter 11. Extending and Customizing Your Site](/docs/user_guide/en/extend-chapter.html)\n* [Chapter 12. Preventing and Fixing Problems](/docs/user_guide/en/prevent-chapter.html)\n* [Chapter 13. Security and Maintenance](/docs/user_guide/en/security-chapter.html)\n* [Chapter 14. Final Thoughts](/docs/user_guide/en/thoughts-chapter.html)\n* [Glossary](/docs/user_guide/en/glossary.html)\n* [Index](/docs/user_guide/en/_index.html)\n* [Appendix A. Appendix](/docs/user_guide/en/appendix.html)\n\n* [Catal\u00e0](/ca/docs/user_guide/ca/preface.html \"Prefaci\")\n* [Magyar](/hu/docs/user_guide/hu/preface.html \"El\u0151sz\u00f3\")\n* [Espa\u00f1ol](/es/docs/user_guide/es/preface.html \"Prefacio\")\n* [\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430](/uk/docs/user_guide/uk/preface.html \"\u0412\u0441\u0442\u0443\u043f\")\n* [\u7b80\u4f53\u4e2d\u6587](/zh-hans/docs/user_guide/zh-hans/preface.html \"\u524d\u8a00\")\n* [Fran\u00e7ais](/fr/docs/user_guide/fr/preface.html \"Pr\u00e9face\")\n* [Deutsch](/de/docs/user_guide/de/preface.html \"Vorwort\")\n* [\u0641\u0627\u0631\u0633\u06cc](/fa/docs/user_guide/fa/preface.html \"\u0645\u0642\u062f\u0645\u0647\")\n* [Bahasa Indonesia](/id/docs/user_guide/id/preface.html \"Pengantar\")\n* [\u65e5\u672c\u8a9e](/ja/docs/user_guide/ja/preface.html \"\u307e\u3048\u304c\u304d\")\n* [Portugu\u00eas](/pt-br/docs/user_guide/pt-br/preface.html \"Pref\u00e1cio\")\n* [\u0420\u0443\u0441\u0441\u043a\u0438\u0439](/ru/docs/user_guide/ru/preface.html \"\u041f\u0440\u0435\u0434\u0438\u0441\u043b\u043e\u0432\u0438\u0435\")\n\n# Preface\n\n## [i.1. Copyright](/docs/user_guide/en/copyright.html)\n\nCopyright information for this guide.\n\n## [i.2. Audience and Goal](/docs/user_guide/en/preface-audience.html)\n\nUnderstanding the target audience for this guide, and what they will learn from\nit.\n\n## [i.3. Organization](/docs/user_guide/en/preface-organization.html)\n\nUnderstanding the organizational structure of this guide for better navigation\nthrough topics.\n\n## [i.4. Reporting Problems](/docs/user_guide/en/preface-reporting.html)\n\nHow to report an issue with this guide (with detailed steps).\n\n## [i.5. Conventions of the Guide](/docs/user_guide/en/preface-conventions.html)\n\nUnderstanding the conventions used in this guide.\n\n## [i.6. Guiding Scenario](/docs/user_guide/en/preface-scenario.html)\n\nUnderstanding the project scenario used in this guide to follow the topics\nbetter.\n\nThis page is generated from [AsciiDoc](http://asciidoc.org/) source from the [User Guide](/project/user_guide). To propose a change, edit the source and attach the file to a [new issue in the User Guide project](/node/add/project-issue/user_guide). PDF and e-book formats are available on the [User Guide project page](/project/user_guide).\n\nSource file: guide.asciidoc\n", "metadata": {"source": "docs/www_drupal_org/docs/user_guide/en/preface.md", "type": "doc_summary", "topic": "Preface"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: JobStorageInterface.php\nTarget symbol: interface abstracts\nNamespace: Drupal\\flowdrop_runtime\\Service\\Storage\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete interface implementation for abstracts.\n- Include required imports:\n  - Drupal\\flowdrop_job\\FlowDropJobInterface\n  - Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface\n- Ensure these methods exist where relevant:\n  - create()\n  - delete()\n  - getByPipeline()\n  - getByPipelineAndStatus()\n  - getReadyJobs()\n  - load()\n  - loadMultiple()\n  - resetCache()\n  - save()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\flowdrop_runtime\\Service\\Storage;\n\nuse Drupal\\flowdrop_job\\FlowDropJobInterface;\nuse Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface;\n\n/**\n * Interface for job storage operations.\n *\n * This interface abstracts job persistence, allowing different storage\n * backends (Drupal entities, in-memory, Redis, etc.) to be used interchangeably.\n *\n * Implementations:\n * - DrupalJobStorage: Persistent storage using Drupal entities\n * - InMemoryJobStorage: Fast ephemeral storage for synchronous execution\n * - (Future) RedisJobStorage: Fast persistent storage\n */\ninterface JobStorageInterface {\n\n  /**\n   * Creates a new job.\n   *\n   * @param array $data\n   *   The job data with the following keys:\n   *   - label: (string) Human-readable label\n   *   - bundle: (string) Bundle/type (default: 'default')\n   *   - node_id: (string) The workflow node ID\n   *   - pipeline_id: (string|int) The parent pipeline ID\n   *   - metadata: (array|string) Job metadata (JSON encoded if string)\n   *   - status: (string) Initial status (default: 'idle')\n   *   - priority: (int) Job priority\n   *   - max_retries: (int) Maximum retry count\n   *   - dependent_jobs: (array) IDs of jobs this job depends on\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface\n   *   The created job (not yet saved).\n   */\n  public function create(array $data): FlowDropJobInterface;\n\n  /**\n   * Loads a job by ID.\n   *\n   * @param string|int $id\n   *   The job ID.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface|null\n   *   The job entity, or NULL if not found.\n   */\n  public function load(string|int $id): ?FlowDropJobInterface;\n\n  /**\n   * Loads multiple jobs by ID.\n   *\n   * @param array $ids\n   *   Array of job IDs.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of job entities keyed by ID.\n   */\n  public function loadMultiple(array $ids): array;\n\n  /**\n   * Saves a job.\n   *\n   * @param \\Drupal\\flowdrop_job\\FlowDropJobInterface $job\n   *   The job to save.\n   */\n  public function save(FlowDropJobInterface $job): void;\n\n  /**\n   * Deletes a job.\n   *\n   * @param \\Drupal\\flowdrop_job\\FlowDropJobInterface $job\n   *   The job to delete.\n   */\n  public function delete(FlowDropJobInterface $job): void;\n\n  /**\n   * Gets all jobs for a pipeline.\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of job entities.\n   */\n  public function getByPipeline(FlowDropPipelineInterface $pipeline): array;\n\n  /**\n   * Gets jobs for a pipeline filtered by status.\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline.\n   * @param string $status\n   *   The status to filter by (e.g., 'idle', 'pending', 'completed', 'failed').\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of job entities with the specified status.\n   */\n  public function getByPipelineAndStatus(FlowDropPipelineInterface $pipeline, string $status): array;\n\n  /**\n   * Gets jobs that are ready to run.\n   *\n   * A job is ready when:\n   * - Its status is 'pending' OR\n   * - Its status is 'idle' AND all dependent jobs are completed\n   *\n   * @param \\Drupal\\flowdrop_pipeline\\Entity\\FlowDropPipelineInterface $pipeline\n   *   The pipeline.\n   *\n   * @return \\Drupal\\flowdrop_job\\FlowDropJobInterface[]\n   *   Array of ready job entities.\n   */\n  public function getReadyJobs(FlowDropPipelineInterface $pipeline): array;\n\n  /**\n   * Resets the storage cache.\n   *\n   * For entity-based storage, this clears the static entity cache.\n   * For in-memory storage, this may be a no-op.\n   *\n   * @param array|null $ids\n   *   Optional array of job IDs to reset. If NULL, reset all.\n   */\n  public function resetCache(?array $ids = NULL): void;\n\n}\n", "metadata": {"source": "repos/flowdrop/modules/flowdrop_runtime/src/Service/Storage/JobStorageInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "JobStorageInterface", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: PrimitiveDataNormalizer.php\nTarget symbol: class PrimitiveDataNormalizer\nNamespace: Drupal\\serialization\\Normalizer\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for PrimitiveDataNormalizer.\n- Include required imports:\n  - Drupal\\Core\\Field\\FieldItemInterface\n  - Drupal\\Core\\TypedData\\PrimitiveInterface\n  - Drupal\\Core\\TypedData\\TypedDataInterface\n- Ensure these methods exist where relevant:\n  - doNormalize()\n  - getNormalizationSchema()\n  - getSupportedTypes()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\nnamespace Drupal\\serialization\\Normalizer;\n\nuse Drupal\\Core\\Field\\FieldItemInterface;\nuse Drupal\\Core\\TypedData\\PrimitiveInterface;\nuse Drupal\\Core\\TypedData\\TypedDataInterface;\n\n/**\n * Converts primitive data objects to their casted values.\n */\nclass PrimitiveDataNormalizer extends NormalizerBase {\n\n  use SerializedColumnNormalizerTrait;\n  use SchematicNormalizerTrait;\n  use JsonSchemaReflectionTrait;\n\n  /**\n   * {@inheritdoc}\n   */\n  public function doNormalize($object, $format = NULL, array $context = []): array|string|int|float|bool|\\ArrayObject|NULL {\n    // Add cacheability if applicable.\n    $this->addCacheableDependency($context, $object);\n\n    $parent = $object->getParent();\n    if ($parent instanceof FieldItemInterface && $object->getValue()) {\n      $serialized_property_names = $this->getCustomSerializedPropertyNames($parent);\n      if (in_array($object->getName(), $serialized_property_names, TRUE)) {\n        return unserialize($object->getValue());\n      }\n    }\n\n    // Typed data casts NULL objects to their empty variants, so for example\n    // the empty string ('') for string type data, or 0 for integer typed data.\n    // In a better world with typed data implementing algebraic data types,\n    // getCastedValue would return NULL, but as typed data is not aware of real\n    // optional values on the primitive level, we implement our own optional\n    // value normalization here.\n    return $object->getValue() === NULL ? NULL : $object->getCastedValue();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getNormalizationSchema(mixed $object, array $context = []): array {\n    $nullable = !$object instanceof TypedDataInterface || !$object->getDataDefinition()->isRequired();\n    return $this->getJsonSchemaForMethod(\n      $object,\n      'getCastedValue',\n      ['$comment' => 'Unable to provide schema, no type specified.'],\n      $nullable,\n    );\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getSupportedTypes(?string $format): array {\n    return [\n      PrimitiveInterface::class => TRUE,\n    ];\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/serialization/src/Normalizer/PrimitiveDataNormalizer.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PrimitiveDataNormalizer", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: country.tokens.inc\nTarget symbol: class country.tokens.inc\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for country.tokens.inc.\n- Include required imports:\n  - Drupal\\Core\\Entity\\ContentEntityInterface\n  - Drupal\\Core\\Render\\BubbleableMetadata\n- Ensure these methods exist where relevant:\n  - country_token_info()\n  - country_tokens()", "output": "<?php\n\n/**\n * @file\n * Provides Token integration for country.\n */\n\nuse Drupal\\Core\\Entity\\ContentEntityInterface;\nuse Drupal\\Core\\Render\\BubbleableMetadata;\n\n/**\n * Implements hook_token_info().\n */\nfunction country_token_info() {\n  if (!\\Drupal::hasService('token.entity_mapper')) {\n    return;\n  }\n\n  $types = [];\n  $tokens = [];\n  foreach (\\Drupal::entityTypeManager()->getDefinitions() as $entity_type_id => $entity_type) {\n    if (!$entity_type->entityClassImplements(ContentEntityInterface::class)) {\n      continue;\n    }\n    $token_type = \\Drupal::service('token.entity_mapper')->getTokenTypeForEntityType($entity_type_id);\n    if (empty($token_type)) {\n      continue;\n    }\n\n    // Build country name tokens for all country fields.\n    $fields = \\Drupal::service('entity_field.manager')->getFieldStorageDefinitions($entity_type_id);\n    foreach ($fields as $field_name => $field) {\n      if ($field->getType() != 'country') {\n        continue;\n      }\n\n      $tokens[$token_type . '-' . $field_name]['country_original_name'] = [\n        'name' => t('The country name'),\n        'description' => NULL,\n        'module' => 'country',\n      ];\n    }\n  }\n\n  return [\n    'types' => $types,\n    'tokens' => $tokens,\n  ];\n}\n\n/**\n * Implements hook_tokens().\n */\nfunction country_tokens($type, $tokens, array $data, array $options, BubbleableMetadata $bubbleable_metadata) {\n  $replacements = [];\n\n  if (!empty($data['field_property'])) {\n    foreach ($tokens as $token => $original) {\n      $delta = 0;\n      $parts = explode(':', $token);\n      if (is_numeric($parts[0])) {\n        if (count($parts) > 1) {\n          $delta = $parts[0];\n          $property_name = $parts[1];\n        }\n        else {\n          continue;\n        }\n      }\n      else {\n        $property_name = $parts[0];\n      }\n      if ($property_name != 'country_original_name') {\n        continue;\n      }\n      if (!isset($data[$data['field_name']][$delta])) {\n        continue;\n      }\n\n      $field_item = $data[$data['field_name']][$delta];\n\n      $country_name = \"\";\n      if ($country_code = $field_item->value) {\n        $field_definition = $field_item->getFieldDefinition();\n        $countries = \\Drupal::service('country.field.manager')->getSelectableCountries($field_definition);\n        $country_name = $countries[$country_code];\n      }\n      $replacements[$original] = $country_name->render();\n    }\n  }\n\n  return $replacements;\n}\n", "metadata": {"source": "repos/country/country.tokens.inc", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CountryTokens", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show me the implementation of the class CKEditor5Plugin in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types = 1);\n\nnamespace Drupal\\ckeditor5\\Annotation;\n\nuse Drupal\\ckeditor5\\Plugin\\CKEditor5PluginDefinition;\nuse Drupal\\Component\\Annotation\\Plugin;\n\n/**\n * Defines a CKEditor5Plugin annotation object.\n *\n * Plugin Namespace: Plugin\\CKEditor5Plugin.\n *\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginInterface\n * @see \\Drupal\\ckeditor5\\Plugin\\CKEditor5PluginManagerInterface\n * @see plugin_api\n *\n * @Annotation\n * @see \\Drupal\\ckeditor5\\Annotation\\CKEditor5AspectsOfCKEditor5Plugin\n * @see \\Drupal\\ckeditor5\\Annotation\\DrupalAspectsOfCKEditor5Plugin\n */\nclass CKEditor5Plugin extends Plugin {\n\n  /**\n   * The plugin ID.\n   *\n   * @var string\n   */\n  public $id;\n\n  /**\n   * The CKEditor 5 aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Annotation\\CKEditor5AspectsOfCKEditor5Plugin\n   */\n  public $ckeditor5;\n\n  /**\n   * The Drupal aspects of the plugin definition.\n   *\n   * @var \\Drupal\\ckeditor5\\Annotation\\DrupalAspectsOfCKEditor5Plugin\n   */\n  public $drupal;\n\n  /**\n   * {@inheritdoc}\n   *\n   * Overridden for compatibility with the AnnotationBridgeDecorator, which\n   * ensures YAML-defined CKEditor 5 plugin definitions are also processed by\n   * annotations. Unfortunately it does not (yet) support nested annotations.\n   * Force YAML-defined plugin definitions to be parsed by the\n   * annotations, to ensure consistent handling of defaults.\n   *\n   * @see \\Drupal\\Component\\Annotation\\Plugin\\Discovery\\AnnotationBridgeDecorator::getDefinitions()\n   */\n  public function __construct($values) {\n    if (isset($values['ckeditor5']) && is_array($values['ckeditor5'])) {\n      $values['ckeditor5'] = new CKEditor5AspectsOfCKEditor5Plugin($values['ckeditor5']);\n    }\n    if (isset($values['drupal']) && is_array($values['drupal'])) {\n      $values['drupal'] = new DrupalAspectsOfCKEditor5Plugin($values['drupal']);\n    }\n    parent::__construct($values);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getClass() {\n    return $this->definition['drupal']['class'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function setClass($class) {\n    $this->definition['drupal']['class'] = $class;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function get(): CKEditor5PluginDefinition {\n    return new CKEditor5PluginDefinition($this->definition);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/ckeditor5/src/Annotation/CKEditor5Plugin.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "CKEditor5Plugin", "symbol_extraction_method": "declaration"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: Default\nprops:\n  items:\n    - url: \"#\"\n      title: \"\u00ab First\"\n    - url: \"#\"\n      title: \"\u2039 Previous\"\n    - url: \"#\"\n      title: \"1\"\n    - url: \"#\"\n      title: \"2\"\n    - url: \"#\"\n      title: \"3\"\n    - url: \"#\"\n      title: \"Next \u203a\"\n    - url: \"#\"\n      title: \"Last \u00bb\"\n  variant: default\n", "metadata": {"source": "repos/bootstrap_components/components/pagination/stories/pagination.default.story.yml", "type": "yaml_reference", "topic": "pagination.default.story"}}
{"instruction": "Implement this Drupal 11 component from the specification. Return complete PHP code.", "input": "Source file: <source_file>\nFile name hint: FormElement.php\nTarget symbol: class for\nNamespace: Drupal\\Core\\Render\\Element\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for for.\n- Include required imports:\n  - Drupal\\Core\\Form\\FormStateInterface\n- Ensure these methods exist where relevant:\n  - __construct()\n  - preRenderAjaxForm()\n  - preRenderGroup()\n  - processAjaxForm()\n  - processAutocomplete()\n  - processGroup()\n  - processPattern()\n  - setAttributes()\n  - validatePattern()\n  - valueCallback()", "output": "<?php\n\nnamespace Drupal\\Core\\Render\\Element;\n\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Provides a base class for form element plugins.\n *\n * @deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. use\n *   \\Drupal\\Core\\Render\\Element\\FormElementBase instead.\n *\n * @see https://www.drupal.org/node/3436275\n */\nabstract class FormElement extends FormElementBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function __construct(array $configuration, $plugin_id, $plugin_definition) {\n    parent::__construct($configuration, $plugin_id, $plugin_definition);\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function setAttributes(&$element, $class = []) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::setAttributes() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::setAttributes() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    parent::setAttributes($element, $class);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function preRenderGroup($element) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::preRenderGroup() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::preRenderGroup() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::preRenderGroup($element);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function processAjaxForm(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::processAjaxForm() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::processAjaxForm() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::processAjaxForm($element, $form_state, $complete_form);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function preRenderAjaxForm($element) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::preRenderAjaxForm() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::preRenderAjaxForm() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::preRenderAjaxForm($element);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function processGroup(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::processGroup() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::processGroup() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::processGroup($element, $form_state, $complete_form);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function valueCallback(&$element, $input, FormStateInterface $form_state) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::valueCallback() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::valueCallback() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::valueCallback($element, $input, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function processPattern(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::processPattern() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::processPattern() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::processPattern($element, $form_state, $complete_form);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function validatePattern(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::validatePattern() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::validatePattern() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    parent::validatePattern($element, $form_state, $complete_form);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public static function processAutocomplete(&$element, FormStateInterface $form_state, &$complete_form) {\n    @trigger_error('\\Drupal\\Core\\Render\\Element\\FormElement::processAutocomplete() is deprecated in drupal:10.3.0 and is removed from drupal:12.0.0. Use \\Drupal\\Core\\Render\\Element\\FormElementBase::processAutocomplete() instead. See https://www.drupal.org/node/3436275', E_USER_DEPRECATED);\n    return parent::processAutocomplete($element, $form_state, $complete_form);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Render/Element/FormElement.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "FormElement", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "write_from_spec"}}}
{"instruction": "Show the Twig template implementation in <source_file> for Drupal 11 theming.", "input": "", "output": "{#\n/**\n * @file\n * Template for AI provider list page.\n *\n * Available variables:\n * - providers: Array of AI provider configurations\n */\n#}\n<div class=\"api-normalization-provider-list\">\n  <h1>{{ 'AI Providers'|t }}</h1>\n\n  {% if providers %}\n    <div class=\"provider-grid\">\n      {% for provider_id, provider in providers %}\n        <div class=\"provider-card provider-{{ provider_id }}\">\n          <h2>{{ provider.name }}</h2>\n          <p class=\"provider-description\">{{ provider.description }}</p>\n          <div class=\"provider-status\">\n            <span class=\"status-badge status-{{ provider.status }}\">{{ provider.status|capitalize }}</span>\n          </div>\n          <div class=\"provider-actions\">\n            <a href=\"{{ url('api_normalization.provider.configure', {'provider_id': provider_id}) }}\" class=\"button\">{{ 'Configure'|t }}</a>\n            <a href=\"{{ url('api_normalization.provider.test', {'provider_id': provider_id}) }}\" class=\"button\">{{ 'Test'|t }}</a>\n          </div>\n        </div>\n      {% endfor %}\n    </div>\n  {% else %}\n    <p>{{ 'No providers configured.'|t }}</p>\n  {% endif %}\n</div>\n", "metadata": {"source": "repos/api_normalization/templates/api-normalization-provider-list.html.twig", "type": "twig_reference"}}
{"instruction": "Provide the Drupal 11 YAML configuration from <source_file>.", "input": "", "output": "name: 'MCP Tools - Entity Clone'\ntype: module\ndescription: 'Entity Clone integration: clone entities with references and configurable options.'\npackage: MCP Tools\ncore_version_requirement: ^10.3 || ^11\ndependencies:\n  - mcp_tools:mcp_tools\n  - entity_clone:entity_clone\nlifecycle: experimental\n", "metadata": {"source": "repos/mcp_tools/modules/mcp_tools_entity_clone/mcp_tools_entity_clone.info.yml", "type": "yaml_reference", "topic": "mcp tools entity clone.info"}}
{"instruction": "Show me the implementation of the class Standard in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\views\\Plugin\\views\\argument;\n\nuse Drupal\\views\\Attribute\\ViewsArgument;\n\n/**\n * Default implementation of the base argument plugin.\n *\n * @ingroup views_argument_handlers\n  */\n#[ViewsArgument(\n  id: 'standard',\n)]\nclass Standard extends ArgumentPluginBase {\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/views/src/Plugin/views/argument/Standard.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Standard", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class PagerSelectExtender in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Database\\Query;\n\nuse Drupal\\Core\\Database\\Connection;\n\n/**\n * Query extender for pager queries.\n *\n * This is the \"default\" pager mechanism.  It creates a paged query with a fixed\n * number of entries per page.\n *\n * When adding this extender along with other extenders, be sure to add\n * PagerSelectExtender last, so that its range and count are based on the full\n * query.\n */\nclass PagerSelectExtender extends SelectExtender {\n\n  /**\n   * The number of elements per page to allow.\n   *\n   * @var int\n   */\n  protected $limit = 10;\n\n  /**\n   * The unique ID of this pager on this page.\n   *\n   * @var int\n   */\n  protected $element = NULL;\n\n  /**\n   * The count query that will be used for this pager.\n   *\n   * @var \\Drupal\\Core\\Database\\Query\\SelectInterface\n   */\n  protected $customCountQuery = FALSE;\n\n  /**\n   * Constructs a PagerSelectExtender object.\n   *\n   * @param \\Drupal\\Core\\Database\\Query\\SelectInterface $query\n   *   Select query object.\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   Database connection object.\n   */\n  public function __construct(SelectInterface $query, Connection $connection) {\n    parent::__construct($query, $connection);\n\n    // Add pager tag. Do this here to ensure that it is always added before\n    // preExecute() is called.\n    $this->addTag('pager');\n  }\n\n  /**\n   * Override the execute method.\n   *\n   * Before we run the query, we need to add pager-based range() instructions\n   * to it.\n   */\n  public function execute() {\n    // By calling preExecute() here, we force it to preprocess the extender\n    // object rather than just the base query object. That means\n    // hook_query_alter() gets access to the extended object.\n    if (!$this->preExecute($this)) {\n      return NULL;\n    }\n\n    // A NULL limit is the \"kill switch\" for pager queries.\n    if (empty($this->limit)) {\n      return;\n    }\n    $this->ensureElement();\n\n    $total_items = $this->getCountQuery()->execute()->fetchField();\n    $pager = $this->connection->getPagerManager()->createPager($total_items, $this->limit, $this->element);\n    $this->range($pager->getCurrentPage() * $this->limit, $this->limit);\n\n    // Now that we've added our pager-based range instructions, run the query\n    // normally.\n    return $this->query->execute();\n  }\n\n  /**\n   * Ensure that there is an element associated with this query.\n   *\n   * After running this method, access $this->element to get the element for\n   * this query.\n   */\n  protected function ensureElement() {\n    if (!isset($this->element)) {\n      $this->element($this->connection->getPagerManager()->getMaxPagerElementId() + 1);\n    }\n  }\n\n  /**\n   * Specify the count query object to use for this pager.\n   *\n   * You will rarely need to specify a count query directly.  If not specified,\n   * one is generated off of the pager query itself.\n   *\n   * @param \\Drupal\\Core\\Database\\Query\\SelectInterface $query\n   *   The count query object. It must return a single row with a single column,\n   *   which is the total number of records.\n   */\n  public function setCountQuery(SelectInterface $query) {\n    $this->customCountQuery = $query;\n  }\n\n  /**\n   * Retrieve the count query for this pager.\n   *\n   * The count query may be specified manually or, by default, taken from the\n   * query we are extending.\n   *\n   * @return \\Drupal\\Core\\Database\\Query\\SelectInterface\n   *   A count query object.\n   */\n  public function getCountQuery() {\n    if ($this->customCountQuery) {\n      return $this->customCountQuery;\n    }\n    else {\n      return $this->query->countQuery();\n    }\n  }\n\n  /**\n   * Specify the maximum number of elements per page for this query.\n   *\n   * The default if not specified is 10 items per page.\n   *\n   * @param int|false $limit\n   *   An integer specifying the number of elements per page. If passed a false\n   *   value (FALSE, 0, NULL), the pager is disabled.\n   */\n  public function limit($limit = 10) {\n    $this->limit = $limit;\n    return $this;\n  }\n\n  /**\n   * Specify the element ID for this pager query.\n   *\n   * The element is used to differentiate different pager queries on the same\n   * page so that they may be operated independently.  If you do not specify an\n   * element, every pager query on the page will get a unique element.  If for\n   * whatever reason you want to explicitly define an element for a given query,\n   * you may do so here.\n   *\n   * Note that no collision detection is done when setting an element ID\n   * explicitly, so it is possible for two pagers to end up using the same ID\n   * if both are set explicitly.\n   *\n   * @param array $element\n   *   Element ID that is used to differentiate different pager queries.\n   */\n  public function element($element) {\n    $this->element = $element;\n    $this->connection->getPagerManager()->reservePagerElementId($this->element);\n    return $this;\n  }\n\n  /**\n   * Gets the element ID for this pager query.\n   *\n   * The element is used to differentiate different pager queries on the same\n   * page so that they may be operated independently.\n   *\n   * @return int\n   *   Element ID that is used to differentiate between different pager\n   *   queries.\n   */\n  public function getElement(): int {\n    $this->ensureElement();\n    return $this->element;\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Database/Query/PagerSelectExtender.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "PagerSelectExtender", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the implementation plan in up to 3 bullet points, then provide the complete Drupal 11 PHP implementation.", "input": "Source file: <source_file>\nFile name hint: api_normalization_ui.install\nTarget symbol: class api_normalization_ui.install\nNamespace: Drupal\\Custom\nRequirements:\n- Use Drupal 11 and PHP 8.3 compatible patterns.\n- Provide a complete class implementation for api_normalization_ui.install.\n- Ensure these methods exist where relevant:\n  - api_normalization_ui_install()", "output": "- Follow Drupal 11 architecture and PHP 8.3 typing.\n- Preserve expected behavior and APIs from the specification.\n- Keep implementation concise and production-ready.\n\n<?php\n\n/**\n * @file\n * Install, update and uninstall functions for the API Normalization UI module.\n */\n\ndeclare(strict_types=1);\n\n/**\n * Implements hook_install().\n */\nfunction api_normalization_ui_install() {\n  // Set schema version for fresh installs.\n  \\Drupal::keyValue('system.schema')->set('api_normalization_ui', 8000);\n}\n", "metadata": {"source": "repos/api_normalization/modules/api_normalization_ui/api_normalization_ui.install", "type": "code_reference", "symbol_kind": "class", "symbol_name": "ApiNormalizationUi", "symbol_extraction_method": "path_fallback", "refinement": {"augmentation_type": "explain_and_implement"}}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: Query\nSource file: <source_file>\nFile name hint: Query.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\Core\\Entity\\KeyValueStore\\Query;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Query\\QueryBase;\nuse Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface;\n\n/**\n * Defines the entity query for entities stored in a key value backend.\n */\nclass Query extends QueryBase {\n\n  /**\n   * The key value factory.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface\n   */\n  protected $keyValueFactory;\n\n  /**\n   * Constructs a new Query.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string $conjunction\n   *   - AND: all of the conditions on the query need to match.\n   *   - OR: at least one of the conditions on the query need to match.\n   * @param array $namespaces\n   *   List of potential namespaces of the classes belonging to this query.\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface $key_value_factory\n   *   The key value factory.\n   */\n  public function __construct(EntityTypeInterface $entity_type, $conjunction, array $namespaces, KeyValueFactoryInterface $key_value_factory) {\n    parent::__construct($entity_type, $conjunction, $namespaces);\n    $this->keyValueFactory = $key_value_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    // Load the relevant records.\n    $records = $this->keyValueFactory->get('entity_storage__' . $this->entityTypeId)->getAll();\n\n    // Apply conditions.\n    $result = $this->condition->compile($records);\n\n    // Apply sort settings.\n    foreach ($this->sort as $sort) {\n      $direction = $sort['direction'] == 'ASC' ? -1 : 1;\n      $field = $sort['field'];\n      uasort($result, function ($a, $b) use ($field, $direction) {\n        return ($a[$field] <= $b[$field]) ? $direction : -$direction;\n      });\n    }\n\n    // Let the pager do its work.\n    $this->initializePager();\n\n    if ($this->range) {\n      $result = array_slice($result, $this->range['start'], $this->range['length'], TRUE);\n    }\n    if ($this->count) {\n      return count($result);\n    }\n\n    // Create the expected structure of entity_id => entity_id.\n    $entity_ids = array_keys($result);\n    return array_combine($entity_ids, $entity_ids);\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\Core\\Entity\\KeyValueStore\\Query;\n\nuse Drupal\\Core\\Entity\\EntityTypeInterface;\nuse Drupal\\Core\\Entity\\Query\\QueryBase;\nuse Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface;\n\n/**\n * Defines the entity query for entities stored in a key value backend.\n */\nclass Query extends QueryBase {\n\n  /**\n   * The key value factory.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface\n   */\n  protected $keyValueFactory;\n\n  /**\n   * Constructs a new Query.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string $conjunction\n   *   - AND: all of the conditions on the query need to match.\n   *   - OR: at least one of the conditions on the query need to match.\n   * @param array $namespaces\n   *   List of potential namespaces of the classes belonging to this query.\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueFactoryInterface $key_value_factory\n   *   The key value factory.\n   */\n  public function __construct(EntityTypeInterface $entity_type, $conjunction, array $namespaces, KeyValueFactoryInterface $key_value_factory) {\n    parent::__construct($entity_type, $conjunction, $namespaces);\n    $this->keyValueFactory = $key_value_factory;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function execute() {\n    // Load the relevant records.\n    $records = $this->keyValueFactory->get('entity_storage__' . $this->entityTypeId)->getAll();\n\n    // Apply conditions.\n    $result = $this->condition->compile($records);\n\n    // Apply sort settings.\n    foreach ($this->sort as $sort) {\n      $direction = $sort['direction'] == 'ASC' ? -1 : 1;\n      $field = $sort['field'];\n      uasort($result, function ($a, $b) use ($field, $direction) {\n        return ($a[$field] <= $b[$field]) ? $direction : -$direction;\n      });\n    }\n\n    // Let the pager do its work.\n    $this->initializePager();\n\n    if ($this->range) {\n      $result = array_slice($result, $this->range['start'], $this->range['length'], TRUE);\n    }\n    if ($this->count) {\n      return count($result);\n    }\n\n    // Create the expected structure of entity_id => entity_id.\n    $entity_ids = array_keys($result);\n    return array_combine($entity_ids, $entity_ids);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Entity/KeyValueStore/Query/Query.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "Query", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
{"instruction": "Show me the implementation of the class BusinessIdentityTwigExtension in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\business_identity\\Twig;\n\nuse Drupal\\business_identity\\BusinessIdentityManagerInterface;\nuse Twig\\Extension\\AbstractExtension;\nuse Twig\\TwigFunction;\n\n/**\n * Twig extension for business identity.\n */\nclass BusinessIdentityTwigExtension extends AbstractExtension {\n\n  /**\n   * The business identity manager.\n   *\n   * @var \\Drupal\\business_identity\\BusinessIdentityManagerInterface\n   */\n  protected $businessIdentityManager;\n\n  /**\n   * Constructor.\n   */\n  public function __construct(BusinessIdentityManagerInterface $business_identity_manager) {\n    $this->businessIdentityManager = $business_identity_manager;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFunctions(): array {\n    return [\n      new TwigFunction('business_info', [$this, 'getBusinessInfo']),\n      new TwigFunction('business_name', [$this, 'getBusinessName']),\n      new TwigFunction('business_contact', [$this, 'getBusinessContact']),\n      new TwigFunction('business_address', [$this, 'getBusinessAddress']),\n      new TwigFunction('business_social_links', [$this, 'getSocialLinks']),\n      new TwigFunction('business_is_open', [$this, 'isBusinessOpen']),\n    ];\n  }\n\n  /**\n   * Gets business information.\n   */\n  public function getBusinessInfo(): array {\n    return $this->businessIdentityManager->getBusinessInfo()->toArray();\n  }\n\n  /**\n   * Gets business name.\n   */\n  public function getBusinessName(): string {\n    return $this->businessIdentityManager->getBusinessName();\n  }\n\n  /**\n   * Gets business contact information.\n   */\n  public function getBusinessContact(): array {\n    return $this->businessIdentityManager->getPrimaryContact();\n  }\n\n  /**\n   * Gets formatted business address.\n   */\n  public function getBusinessAddress(string $type = 'headquarters', string $format = 'html'): string {\n    return $this->businessIdentityManager->getFormattedAddress($type, $format);\n  }\n\n  /**\n   * Gets social links.\n   */\n  public function getSocialLinks(): array {\n    return $this->businessIdentityManager->getSocialLinks();\n  }\n\n  /**\n   * Checks if business is open.\n   */\n  public function isBusinessOpen(): bool {\n    return $this->businessIdentityManager->isOpen();\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getName(): string {\n    return 'business_identity.twig_extension';\n  }\n\n}\n", "metadata": {"source": "repos/business_identity/src/Twig/BusinessIdentityTwigExtension.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "BusinessIdentityTwigExtension", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the interface UserAuthInterface in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\user;\n\n/**\n * An interface for validating user authentication credentials.\n */\ninterface UserAuthInterface {\n\n  /**\n   * Validates user authentication credentials.\n   *\n   * @param string $username\n   *   The user name to authenticate.\n   * @param string $password\n   *   A plain-text password, such as trimmed text from form values.\n   *\n   * @return int|false\n   *   The user's uid on success, or FALSE on failure to authenticate.\n   */\n  public function authenticate($username, #[\\SensitiveParameter] $password);\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/user/src/UserAuthInterface.php", "type": "code_reference", "symbol_kind": "interface", "symbol_name": "UserAuthInterface", "symbol_extraction_method": "declaration"}}
{"instruction": "Explain the following topic based on Drupal 11 documentation: Encryption domain (API surface)", "input": "", "output": "# Encryption domain (API surface)\n<DOCUMENT_TAGS>\ndomain, encryption\n</DOCUMENT_TAGS>\n```\n// Structure of documents\n\u2514\u2500\u2500 src/\n    \u2514\u2500\u2500 Encryption/\n        \u2514\u2500\u2500 EncryptedValue.php\n        \u2514\u2500\u2500 EncryptionException.php\n        \u2514\u2500\u2500 EncryptionKeyId.php\n        \u2514\u2500\u2500 EncryptorInterface.php\n\n```\n###  Path: `/src/Encryption/EncryptedValue.php`\n\n```php\nnamespace Drupal\\easy_encryption\\Encryption;\n\n/**\n * Immutable value object representing encrypted data with key metadata.\n *\n * The ciphertext is stored internally as raw binary data. Use\n * getCiphertextHex() for storage in configuration, databases, or files that\n * expect string data.\n *\n * @immutable\n */\nfinal class EncryptedValue\n{\n\tpublic function __construct(\n\t\tprivate readonly string $ciphertext,\n\t\tpublic readonly EncryptionKeyId $keyId,\n\t) {\n\t\t/* ... */\n\t}\n\n\n\t/**\n\t * Returns the raw binary ciphertext.\n\t *\n\t * @return string\n\t *   The binary ciphertext.\n\t */\n\tpublic function getCiphertext(): string\n\t{\n\t\t/* ... */\n\t}\n\n\n\t/**\n\t * Returns hex-encoded ciphertext for storage.\n\t *\n\t * Use this method when persisting encrypted data to configuration, databases,\n\t * or files. To reconstruct the object from stored hex, use\n\t * EncryptedValue::fromHex().\n\t *\n\t * @return string\n\t *   The hex-encoded ciphertext.\n\t */\n\tpublic function getCiphertextHex(): string\n\t{\n\t\t/* ... */\n\t}\n\n\n\t/**\n\t * Creates an EncryptedValue from hex-encoded ciphertext.\n\t *\n\t * Use this factory method when reading encrypted data from storage that was\n\t * previously encoded with getCiphertextHex().\n\t *\n\t * @param string $hex\n\t *   The hex-encoded ciphertext.\n\t * @param string $keyId\n\t *   The key pair identifier.\n\t *\n\t * @return static\n\t *   A new EncryptedValue instance.\n\t *\n\t * @throws \\InvalidArgumentException\n\t *   If the ciphertext is empty or invalid, or the key ID is empty.\n\t */\n\tpublic static function fromHex(string $hex, string $keyId): self\n\t{\n\t\t/* ... */\n\t}\n}\n\n\n```\n###  Path: `/src/Encryption/EncryptionException.php`\n\n```php\nnamespace Drupal\\easy_encryption\\Encryption;\n\n/**\n * Thrown when an encryption or decryption operation fails.\n */\nclass EncryptionException extends \\RuntimeException\n{\n}\n\n\n```\n###  Path: `/src/Encryption/EncryptionKeyId.php`\n\n```php\nnamespace Drupal\\easy_encryption\\Encryption;\n\n/**\n * Value object representing an Encryption key identifier.\n *\n * Instances are immutable and always contain a safe, normalized identifier\n * consisting only of lowercase letters, digits, and underscores.\n *\n * This is a shared domain concept used by both key management (generation,\n * rotation, transfer) and encryption (encryptors/ciphertexts). It is not the\n * same as a Key module Key entity ID.\n */\nfinal class EncryptionKeyId implements \\Stringable\n{\n\tprivate const NORMALIZED_PATTERN = '/^[a-z0-9_]+$/';\n\n\t/**\n\t * Creates a EncryptionKeyId from arbitrary input by normalizing it.\n\t *\n\t * Normalization rules:\n\t * - lowercases\n\t * - replaces any run of characters not in [a-z0-9_] with a single underscore\n\t * - trims leading/trailing underscores.\n\t */\n\tpublic static function fromUserInput(string $keyPairId): self\n\t{\n\t\t/* ... */\n\t}\n\n\n\t/**\n\t * Creates a EncryptionKeyId from an already-normalized value.\n\t */\n\tpublic static function fromNormalized(string $keyPairId): self\n\t{\n\t\t/* ... */\n\t}\n\n\n\t/**\n\t * {@inheritdoc}\n\t */\n\tpublic function __toString(): string\n\t{\n\t\t/* ... */\n\t}\n}\n\n\n```\n###  Path: `/src/Encryption/EncryptorInterface.php`\n\n```php\nnamespace Drupal\\easy_encryption\\Encryption;\n\n/**\n * Defines an interface for encrypting and decrypting sensitive data.\n */\ninterface EncryptorInterface\n{\n\t/**\n\t * Encrypts a value.\n\t *\n\t * @param string $value\n\t *   The plaintext value to encrypt.\n\t *\n\t * @return \\Drupal\\easy_encryption\\Encryption\\EncryptedValue\n\t *   The encrypted value with metadata.\n\t *\n\t * @throws \\InvalidArgumentException\n\t *   If the value is empty.\n\t * @throws \\Drupal\\easy_encryption\\Encryption\\EncryptionException\n\t *   If encryption fails.\n\t */\n\tpublic function encrypt(\n\t\t#[\\SensitiveParameter]\n\t\tstring $value,\n\t): EncryptedValue;\n\n\n\t/**\n\t * Decrypts a value.\n\t *\n\t * @param \\Drupal\\easy_encryption\\Encryption\\EncryptedValue $value\n\t *   The encrypted value to decrypt.\n\t *\n\t * @return string\n\t *   The decrypted plaintext.\n\t *\n\t * @throws \\Drupal\\easy_encryption\\Encryption\\EncryptionException\n\t *   If decryption fails.\n\t */\n\tpublic function decrypt(EncryptedValue $value): string;\n\n\n\t/**\n\t * Validates that encryption and decryption work correctly.\n\t *\n\t * Implementations may skip this test silently if the environment does not\n\t * support decryption (for example, when only a public key is available).\n\t *\n\t * @throws \\Drupal\\easy_encryption\\Encryption\\EncryptionException\n\t *   If the self-test fails.\n\t */\n\tpublic function selfTest(): void;\n}\n\n\n```\n---\n**File Statistics**\n- **Size**: 4.76 KB\n- **Lines**: 223\nFile: `core/domain/encryption.md`\n", "metadata": {"source": "repos/easy_encryption/.context/core/domain/encryption.md", "type": "doc_summary", "topic": "Encryption domain (API surface)"}}
{"instruction": "Show me the implementation of the class KeyRotationOptions in the file <source_file>.", "input": "", "output": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\easy_encryption\\KeyManagement;\n\n/**\n * Options for the rotation operation.\n */\nfinal class KeyRotationOptions {\n\n  public function __construct(\n    public readonly bool $reencryptKeys = FALSE,\n    public readonly bool $failOnReencryptErrors = TRUE,\n  ) {}\n\n}\n", "metadata": {"source": "repos/easy_encryption/src/KeyManagement/KeyRotationOptions.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "KeyRotationOptions", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class UpdateSettingsForm in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\update;\n\nuse Drupal\\Core\\Form\\ConfigFormBase;\nuse Drupal\\Core\\Form\\ConfigTarget;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\nuse Drupal\\Core\\Url;\nuse Drupal\\Core\\Form\\FormStateInterface;\n\n/**\n * Configure update settings for this site.\n *\n * @internal\n */\nclass UpdateSettingsForm extends ConfigFormBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  public function getFormId() {\n    return 'update_settings';\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getEditableConfigNames() {\n    return ['update.settings'];\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function buildForm(array $form, FormStateInterface $form_state) {\n    $form['update_check_frequency'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Check for updates'),\n      '#config_target' => new ConfigTarget(\n        'update.settings',\n        'check.interval_days',\n        toConfig: fn($value) => intval($value)),\n      '#options' => [\n        1 => $this->t('Daily'),\n        7 => $this->t('Weekly'),\n      ],\n      '#description' => $this->t('Select how frequently you want to automatically check for new releases of your currently installed modules and themes.'),\n    ];\n\n    $form['update_check_disabled'] = [\n      '#type' => 'checkbox',\n      '#title' => $this->t('Check for updates of uninstalled modules and themes'),\n      '#config_target' => 'update.settings:check.disabled_extensions',\n    ];\n\n    $form['update_notify_emails'] = [\n      '#type' => 'textarea',\n      '#title' => $this->t('Email addresses to notify when updates are available'),\n      '#rows' => 4,\n      '#config_target' => new ConfigTarget(\n        'update.settings',\n        'notification.emails',\n        static::class . '::arrayToMultiLineString',\n        static::class . '::multiLineStringToArray',\n      ),\n      '#description' => $this->t('Whenever your site checks for available updates and finds new releases, it can notify a list of users via email. Put each address on a separate line. If blank, no emails will be sent.'),\n    ];\n\n    $form['update_notification_threshold'] = [\n      '#type' => 'radios',\n      '#title' => $this->t('Email notification threshold'),\n      '#config_target' => 'update.settings:notification.threshold',\n      '#options' => [\n        'all' => $this->t('All newer versions'),\n        'security' => $this->t('Only security updates'),\n      ],\n      '#description' => $this->t(\n        'You can choose to send email only if a security update is available, or to be notified about all newer versions. If there are updates available of Drupal core or any of your installed modules and themes, your site will always print a message on the <a href=\":status_report\">status report</a> page. If there is a security update, an error message will be printed on administration pages for users with <a href=\":update_permissions\">permission to view update notifications</a>.',\n        [\n          ':status_report' => Url::fromRoute('system.status')->toString(),\n          ':update_permissions' => Url::fromRoute('user.admin_permissions', [], ['fragment' => 'module-update'])\n            ->toString(),\n        ]\n      ),\n    ];\n\n    return parent::buildForm($form, $form_state);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function formatMultipleViolationsMessage(string $form_element_name, array $violations): TranslatableMarkup {\n    if ($form_element_name !== 'update_notify_emails') {\n      return parent::formatMultipleViolationsMessage($form_element_name, $violations);\n    }\n\n    $invalid_email_addresses = [];\n    foreach ($violations as $violation) {\n      $invalid_email_addresses[] = $violation->getInvalidValue();\n    }\n    return $this->t('%emails are not valid email addresses.', ['%emails' => implode(', ', $invalid_email_addresses)]);\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  public function submitForm(array &$form, FormStateInterface $form_state) {\n    $config = $this->config('update.settings');\n    // See if the update_check_disabled setting is being changed, and if so,\n    // invalidate all update status data.\n    if ($form_state->getValue('update_check_disabled') != $config->get('check.disabled_extensions')) {\n      update_storage_clear();\n    }\n\n    parent::submitForm($form, $form_state);\n  }\n\n  /**\n   * Prepares the submitted value to be stored in the notify_emails property.\n   *\n   * @param string $value\n   *   The submitted value.\n   *\n   * @return array\n   *   The value to be stored in config.\n   */\n  public static function multiLineStringToArray(string $value): array {\n    return trim($value) ? array_map('trim', explode(\"\\n\", $value)) : [];\n  }\n\n  /**\n   * Prepares the saved notify_emails property to be displayed in the form.\n   *\n   * @param array $value\n   *   The value saved in config.\n   *\n   * @return string\n   *   The value of the form element.\n   */\n  public static function arrayToMultiLineString(array $value): string {\n    return implode(\"\\n\", $value);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/modules/update/src/UpdateSettingsForm.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "UpdateSettingsForm", "symbol_extraction_method": "declaration"}}
{"instruction": "Show me the implementation of the class HtmlFormController in the file <source_file>.", "input": "", "output": "<?php\n\nnamespace Drupal\\Core\\Controller;\n\nuse Drupal\\Core\\Form\\FormBuilderInterface;\nuse Drupal\\Core\\Routing\\RouteMatchInterface;\nuse Drupal\\Core\\DependencyInjection\\ClassResolverInterface;\nuse Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface;\n\n/**\n * Wrapping controller for forms that serve as the main page body.\n */\nclass HtmlFormController extends FormController {\n\n  /**\n   * The class resolver.\n   *\n   * @var \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface\n   */\n  protected $classResolver;\n\n  /**\n   * Constructs a new \\Drupal\\Core\\Controller\\HtmlFormController object.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Controller\\ArgumentResolverInterface $argument_resolver\n   *   The argument resolver.\n   * @param \\Drupal\\Core\\Form\\FormBuilderInterface $form_builder\n   *   The form builder.\n   * @param \\Drupal\\Core\\DependencyInjection\\ClassResolverInterface $class_resolver\n   *   The class resolver.\n   */\n  public function __construct(ArgumentResolverInterface $argument_resolver, FormBuilderInterface $form_builder, ClassResolverInterface $class_resolver) {\n    parent::__construct($argument_resolver, $form_builder);\n    $this->classResolver = $class_resolver;\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getFormArgument(RouteMatchInterface $route_match) {\n    return $route_match->getRouteObject()->getDefault('_form');\n  }\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function getFormObject(RouteMatchInterface $route_match, $form_arg) {\n    return $this->classResolver->getInstanceFromDefinition($form_arg);\n  }\n\n}\n", "metadata": {"source": "repos/drupal_core/core/lib/Drupal/Core/Controller/HtmlFormController.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "HtmlFormController", "symbol_extraction_method": "declaration"}}
{"instruction": "Refactor this Drupal 11 class for readability and maintainability while preserving behavior.", "input": "Symbol: WipePluginManager\nSource file: <source_file>\nFile name hint: WipePluginManager.php\nCurrent implementation:\n<?php\n\nnamespace Drupal\\db_wipe;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\db_wipe\\Annotation\\WipePlugin;\n\n/**\n * Plugin manager for Wipe plugins.\n */\nclass WipePluginManager extends DefaultPluginManager {\n\n  public function __construct(\n    \\Traversable $namespaces,\n    CacheBackendInterface $cache_backend,\n    ModuleHandlerInterface $module_handler,\n  ) {\n    parent::__construct(\n      'Plugin/Wipe',\n      $namespaces,\n      $module_handler,\n      'Drupal\\db_wipe\\Plugin\\WipePluginInterface',\n      WipePlugin::class\n    );\n\n    $this->alterInfo('wipe_plugin_info');\n    $this->setCacheBackend($cache_backend, 'wipe_plugins');\n  }\n\n  /**\n   * Gets all available plugins sorted by weight and label.\n   */\n  public function getAvailablePlugins(): array {\n    $definitions = $this->getDefinitions();\n\n    // Sort by weight and then by label.\n    uasort($definitions, function ($a, $b) {\n      $weight_diff = ($a['weight'] ?? 0) <=> ($b['weight'] ?? 0);\n      if ($weight_diff !== 0) {\n        return $weight_diff;\n      }\n      return strcmp($a['label'], $b['label']);\n    });\n\n    return $definitions;\n  }\n\n  /**\n   * Gets plugins in a specific category.\n   */\n  public function getPluginsByCategory(string $category): array {\n    $definitions = $this->getDefinitions();\n    return array_filter($definitions, function ($definition) use ($category) {\n      return ($definition['category'] ?? 'general') === $category;\n    });\n  }\n\n  /**\n   * Finds a plugin that supports the target.\n   */\n  public function getPluginForTarget($target): ?object {\n    foreach ($this->getAvailablePlugins() as $plugin_id => $definition) {\n      $plugin = $this->createInstance($plugin_id);\n      if ($plugin->supports($target)) {\n        return $plugin;\n      }\n    }\n    return NULL;\n  }\n\n}", "output": "<?php\n\nnamespace Drupal\\db_wipe;\n\nuse Drupal\\Core\\Cache\\CacheBackendInterface;\nuse Drupal\\Core\\Extension\\ModuleHandlerInterface;\nuse Drupal\\Core\\Plugin\\DefaultPluginManager;\nuse Drupal\\db_wipe\\Annotation\\WipePlugin;\n\n/**\n * Plugin manager for Wipe plugins.\n */\nclass WipePluginManager extends DefaultPluginManager {\n\n  public function __construct(\n    \\Traversable $namespaces,\n    CacheBackendInterface $cache_backend,\n    ModuleHandlerInterface $module_handler,\n  ) {\n    parent::__construct(\n      'Plugin/Wipe',\n      $namespaces,\n      $module_handler,\n      'Drupal\\db_wipe\\Plugin\\WipePluginInterface',\n      WipePlugin::class\n    );\n\n    $this->alterInfo('wipe_plugin_info');\n    $this->setCacheBackend($cache_backend, 'wipe_plugins');\n  }\n\n  /**\n   * Gets all available plugins sorted by weight and label.\n   */\n  public function getAvailablePlugins(): array {\n    $definitions = $this->getDefinitions();\n\n    // Sort by weight and then by label.\n    uasort($definitions, function ($a, $b) {\n      $weight_diff = ($a['weight'] ?? 0) <=> ($b['weight'] ?? 0);\n      if ($weight_diff !== 0) {\n        return $weight_diff;\n      }\n      return strcmp($a['label'], $b['label']);\n    });\n\n    return $definitions;\n  }\n\n  /**\n   * Gets plugins in a specific category.\n   */\n  public function getPluginsByCategory(string $category): array {\n    $definitions = $this->getDefinitions();\n    return array_filter($definitions, function ($definition) use ($category) {\n      return ($definition['category'] ?? 'general') === $category;\n    });\n  }\n\n  /**\n   * Finds a plugin that supports the target.\n   */\n  public function getPluginForTarget($target): ?object {\n    foreach ($this->getAvailablePlugins() as $plugin_id => $definition) {\n      $plugin = $this->createInstance($plugin_id);\n      if ($plugin->supports($target)) {\n        return $plugin;\n      }\n    }\n    return NULL;\n  }\n\n}\n", "metadata": {"source": "repos/db_wipe/src/WipePluginManager.php", "type": "code_reference", "symbol_kind": "class", "symbol_name": "WipePluginManager", "symbol_extraction_method": "declaration", "refinement": {"augmentation_type": "refactor"}}}
